!function(){function e(e,t){try{var n=atob(e),r=[];for(var s=0;s<n.length;s++)r.push(n.charCodeAt(s));var a=new TextDecoder("utf-8").decode(new Uint8Array(r)),o="";for(var s=0;s<a.length;s++){var i=a.charCodeAt(s)^t.charCodeAt(s%t.length);o+=String.fromCharCode(i)}return o}catch(e){throw new Error("解密失败")}}function t(e){try{var t=JSON.parse(e);return typeof t==="object"&&t!==null}catch(t){return!1}}function n(e,n){var r=document.createElement("div");return r.style.cssText="border:1px solid #ddd;padding:20px;margin:10px 0;border-radius:5px;background:#f9f9f9;text-align:center",r.innerHTML='🔒 <strong style="color:#666">此内容已加密，请输入密码查看</strong><br><div style="margin:10px 0;padding:8px;background:#fff3cd;border:1px solid #ffeaa7;border-radius:3px;color:#856404;font-size:14px;">💡 <strong>提示：</strong>如需查看内部内容，请联系我获取访问密码</div><br><input type="password" id="pwd-'+e+'" placeholder="请输入密码" style="padding:8px;margin:5px;border:1px solid #ccc;border-radius:3px;width:200px"><br><button onclick="unlkCnt(\''+e+"','"+n+'\')" style="padding:8px 15px;margin:10px 5px;background:#007cba;color:white;border:none;border-radius:3px;cursor:pointer">解锁内容</button>',r}function r(){var r=document.querySelector('meta[name="description"]');if(!r)return;var s=r.getAttribute("content"),a=/<!--encrypt:\s*([^>]+)-->\s*<!--([^>]+)-->\s*<!--\/encrypt-->/g,o=document.getElementById("postBody"),i=s,c;while((c=a.exec(s))!==null){var l=c[1].trim(),u=c[2].trim(),d=localStorage.getItem("gmk_"+l);if(d){try{var g=e(u,d);if(g&&(g.includes("#")||g.includes("*")||g.includes("`")||g.includes("\n")||g.length>10)){i=i.replace(c[0],g)}else{localStorage.removeItem("gmk_"+l);var p=n(l,u);i=i.replace(c[0],p.outerHTML)}}catch(e){localStorage.removeItem("gmk_"+l);var p=n(l,u);i=i.replace(c[0],p.outerHTML)}}else{var p=n(l,u);i=i.replace(c[0],p.outerHTML)}}if(i!==s){if(window.marked){o.innerHTML=marked(i)}else{var m=i.split(/<!--encrypt:[^>]+-->|<!--[^>]+-->|<!--\/encrypt-->/g).filter(function(e){return e.trim()}).join("");o.innerHTML=m}}}window.unlkCnt=function(r,s){var a=document.getElementById("pwd-"+r).value;if(!a){alert("请输入密码");return}try{var o=e(s,a);if(!o||(!o.includes("#")&&!o.includes("*")&&!o.includes("`")&&!o.includes("\n")&&o.length<=10)||/[\x00-\x08\x0E-\x1F\x7F-\x9F]/.test(o)){alert("密码错误，请重试");return}if(!t(o)&&(o.includes("#")||o.includes("*")||o.includes("`")||o.includes("\n")||o.length>20)){localStorage.setItem("gmk_"+r,a),location.reload()}else{alert("密码错误，请重试")}}catch(e){alert("密码错误，请重试")}},document.addEventListener("DOMContentLoaded",function(){setTimeout(r,50)})}();